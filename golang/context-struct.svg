<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: context_struct Pages: 1 -->
<svg width="1127pt" height="571pt"
 viewBox="0.00 0.00 1127.00 571.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 567)">
<title>context_struct</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-567 1123,-567 1123,4 -4,4"/>
<!-- Context -->
<g id="node1" class="node">
<title>Context</title>
<polygon fill="none" stroke="#000000" points="618,-360.5 618,-475.5 861,-475.5 861,-360.5 618,-360.5"/>
<text text-anchor="middle" x="739.5" y="-460.3" font-family="Times,serif" font-size="14.00" fill="#000000">Context 接口</text>
<polyline fill="none" stroke="#000000" points="618,-452.5 861,-452.5 "/>
<text text-anchor="start" x="626" y="-437.3" font-family="Times,serif" font-size="14.00" fill="#000000">Deadline() (deadline time.Time, ok bool)</text>
<polyline fill="none" stroke="#000000" points="618,-429.5 861,-429.5 "/>
<text text-anchor="start" x="626" y="-414.3" font-family="Times,serif" font-size="14.00" fill="#000000">Done() &lt;&#45;chan struct{}</text>
<polyline fill="none" stroke="#000000" points="618,-406.5 861,-406.5 "/>
<text text-anchor="start" x="626" y="-391.3" font-family="Times,serif" font-size="14.00" fill="#000000">Err() error</text>
<polyline fill="none" stroke="#000000" points="618,-383.5 861,-383.5 "/>
<text text-anchor="start" x="626" y="-368.3" font-family="Times,serif" font-size="14.00" fill="#000000">Value(key interface{}) interface{}</text>
</g>
<!-- emptyCtx -->
<g id="node2" class="node">
<title>emptyCtx</title>
<polygon fill="none" stroke="#000000" points="402,-472 402,-548 524,-548 524,-472 402,-472"/>
<text text-anchor="middle" x="463" y="-532.8" font-family="Times,serif" font-size="14.00" fill="#000000">emptyCtx</text>
<polyline fill="none" stroke="#000000" points="402,-525 524,-525 "/>
<text text-anchor="start" x="410" y="-509.8" font-family="Times,serif" font-size="14.00" fill="#000000">默认的ctx,</text>
<text text-anchor="start" x="410" y="-494.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 可作为顶层的ctx</text>
<text text-anchor="start" x="410" y="-479.8" font-family="Times,serif" font-size="14.00" fill="#000000"> type emptyCtx int</text>
</g>
<!-- emptyCtx&#45;&gt;Context -->
<g id="edge3" class="edge">
<title>emptyCtx&#45;&gt;Context</title>
<path fill="none" stroke="#000000" d="M524.0214,-489.6963C548.9912,-481.3881 578.9099,-471.4332 608.3942,-461.6229"/>
<polygon fill="#000000" stroke="#000000" points="609.5614,-464.9233 617.9449,-458.4451 607.3513,-458.2813 609.5614,-464.9233"/>
<text text-anchor="middle" x="587" y="-475.8" font-family="Times,serif" font-size="14.00" fill="#000000">impl</text>
</g>
<!-- cancelCtx -->
<g id="node3" class="node">
<title>cancelCtx</title>
<polygon fill="none" stroke="#000000" points="370,-226 370,-364 556,-364 556,-226 370,-226"/>
<text text-anchor="middle" x="463" y="-348.8" font-family="Times,serif" font-size="14.00" fill="#000000">cancelCtx</text>
<polyline fill="none" stroke="#000000" points="370,-341 556,-341 "/>
<text text-anchor="start" x="378" y="-325.8" font-family="Times,serif" font-size="14.00" fill="#000000">Context</text>
<polyline fill="none" stroke="#000000" points="370,-318 556,-318 "/>
<text text-anchor="start" x="378" y="-302.8" font-family="Times,serif" font-size="14.00" fill="#000000">mu sync.Mutex</text>
<polyline fill="none" stroke="#000000" points="370,-295 556,-295 "/>
<text text-anchor="start" x="378" y="-279.8" font-family="Times,serif" font-size="14.00" fill="#000000">done chan struct{}</text>
<polyline fill="none" stroke="#000000" points="370,-272 556,-272 "/>
<text text-anchor="start" x="378" y="-256.8" font-family="Times,serif" font-size="14.00" fill="#000000">children map[canceler]struct{}</text>
<polyline fill="none" stroke="#000000" points="370,-249 556,-249 "/>
<text text-anchor="middle" x="463" y="-233.8" font-family="Times,serif" font-size="14.00" fill="#000000">err error</text>
</g>
<!-- cancelCtx&#45;&gt;Context -->
<g id="edge4" class="edge">
<title>cancelCtx&#45;&gt;Context</title>
<path fill="none" stroke="#000000" d="M556.2248,-336.4707C573.0467,-343.9539 590.867,-351.8812 608.5285,-359.7378"/>
<polygon fill="#000000" stroke="#000000" points="607.1843,-362.9705 617.7437,-363.8372 610.0295,-356.5748 607.1843,-362.9705"/>
</g>
<!-- timerCtx -->
<g id="node4" class="node">
<title>timerCtx</title>
<polygon fill="none" stroke="#000000" points="169.5,-255 169.5,-347 293.5,-347 293.5,-255 169.5,-255"/>
<text text-anchor="middle" x="231.5" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#000000">timerCtx</text>
<polyline fill="none" stroke="#000000" points="169.5,-324 293.5,-324 "/>
<text text-anchor="start" x="177.5" y="-308.8" font-family="Times,serif" font-size="14.00" fill="#000000">cancelCtx</text>
<polyline fill="none" stroke="#000000" points="169.5,-301 293.5,-301 "/>
<text text-anchor="start" x="177.5" y="-285.8" font-family="Times,serif" font-size="14.00" fill="#000000">timer *time.Timer</text>
<polyline fill="none" stroke="#000000" points="169.5,-278 293.5,-278 "/>
<text text-anchor="start" x="177.5" y="-262.8" font-family="Times,serif" font-size="14.00" fill="#000000">deadline time.Time</text>
</g>
<!-- timerCtx&#45;&gt;cancelCtx -->
<g id="edge6" class="edge">
<title>timerCtx&#45;&gt;cancelCtx</title>
<path fill="none" stroke="#000000" d="M293.5378,-299.3921C313.863,-298.8653 337.0273,-298.265 359.562,-297.6809"/>
<polygon fill="#000000" stroke="#000000" points="359.9531,-301.172 369.859,-297.414 359.7716,-294.1744 359.9531,-301.172"/>
</g>
<!-- valueCtx -->
<g id="node5" class="node">
<title>valueCtx</title>
<polygon fill="none" stroke="#000000" points="400.5,-383.5 400.5,-452.5 525.5,-452.5 525.5,-383.5 400.5,-383.5"/>
<text text-anchor="middle" x="463" y="-437.3" font-family="Times,serif" font-size="14.00" fill="#000000">valueCtx</text>
<polyline fill="none" stroke="#000000" points="400.5,-429.5 525.5,-429.5 "/>
<text text-anchor="start" x="408.5" y="-414.3" font-family="Times,serif" font-size="14.00" fill="#000000">Context </text>
<polyline fill="none" stroke="#000000" points="400.5,-406.5 525.5,-406.5 "/>
<text text-anchor="start" x="408.5" y="-391.3" font-family="Times,serif" font-size="14.00" fill="#000000">key, val interface{}</text>
</g>
<!-- valueCtx&#45;&gt;Context -->
<g id="edge5" class="edge">
<title>valueCtx&#45;&gt;Context</title>
<path fill="none" stroke="#000000" d="M525.7421,-418C550.1859,-418 579.1725,-418 607.7851,-418"/>
<polygon fill="#000000" stroke="#000000" points="607.882,-421.5001 617.882,-418 607.882,-414.5001 607.882,-421.5001"/>
</g>
<!-- time_AfterFunc -->
<g id="node6" class="node">
<title>time_AfterFunc</title>
<polygon fill="none" stroke="#000000" points="170.5,-109 170.5,-155 292.5,-155 292.5,-109 170.5,-109"/>
<text text-anchor="middle" x="231.5" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#000000">time.AfterFunc</text>
<polyline fill="none" stroke="#000000" points="170.5,-132 292.5,-132 "/>
<text text-anchor="start" x="178.5" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#000000">超时后调用cancel</text>
</g>
<!-- cancel -->
<g id="node8" class="node">
<title>cancel</title>
<polygon fill="none" stroke="#000000" points="379.5,-99.5 379.5,-198.5 546.5,-198.5 546.5,-99.5 379.5,-99.5"/>
<text text-anchor="middle" x="463" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#000000">cancel</text>
<polyline fill="none" stroke="#000000" points="379.5,-175.5 546.5,-175.5 "/>
<text text-anchor="start" x="387.5" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#000000">关闭done chan </text>
<text text-anchor="start" x="387.5" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 并调用所有child的cancel</text>
<polyline fill="none" stroke="#000000" points="379.5,-137.5 546.5,-137.5 "/>
<text text-anchor="start" x="387.5" y="-122.3" font-family="Times,serif" font-size="14.00" fill="#000000">cancel中加了检查，</text>
<text text-anchor="start" x="387.5" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 可以被调用多次</text>
</g>
<!-- time_AfterFunc&#45;&gt;cancel -->
<g id="edge18" class="edge">
<title>time_AfterFunc&#45;&gt;cancel</title>
<path fill="none" stroke="#000000" d="M292.6267,-136.4888C316.0422,-138.2083 343.3273,-140.2119 369.1107,-142.1053"/>
<polygon fill="#000000" stroke="#000000" points="369.0569,-145.6107 379.2864,-142.8526 369.5696,-138.6295 369.0569,-145.6107"/>
</g>
<!-- func_cancel -->
<g id="node7" class="node">
<title>func_cancel</title>
<polygon fill="none" stroke="#000000" points="130,-174.5 130,-235.5 333,-235.5 333,-174.5 130,-174.5"/>
<text text-anchor="middle" x="231.5" y="-220.3" font-family="Times,serif" font-size="14.00" fill="#000000">func_cancel</text>
<polyline fill="none" stroke="#000000" points="130,-212.5 333,-212.5 "/>
<text text-anchor="start" x="138" y="-197.3" font-family="Times,serif" font-size="14.00" fill="#000000">返回CancelFunc函数</text>
<text text-anchor="start" x="138" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#000000"> func(){c.cancel(true, Canceled);}</text>
</g>
<!-- func_cancel&#45;&gt;cancel -->
<g id="edge17" class="edge">
<title>func_cancel&#45;&gt;cancel</title>
<path fill="none" stroke="#000000" d="M333.0393,-180.4376C345.093,-177.5218 357.3555,-174.5555 369.2932,-171.6677"/>
<polygon fill="#000000" stroke="#000000" points="370.336,-175.0165 379.2327,-169.2634 368.6901,-168.2127 370.336,-175.0165"/>
</g>
<!-- close_done_chan -->
<g id="node9" class="node">
<title>close_done_chan</title>
<polygon fill="none" stroke="#000000" points="653.5,-111 653.5,-187 825.5,-187 825.5,-111 653.5,-111"/>
<text text-anchor="middle" x="739.5" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#000000">close_done_chan</text>
<polyline fill="none" stroke="#000000" points="653.5,-164 825.5,-164 "/>
<text text-anchor="start" x="661.5" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#000000">关闭done chan，通知所有</text>
<text text-anchor="start" x="661.5" y="-133.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 等待的goroutine</text>
<text text-anchor="start" x="661.5" y="-118.8" font-family="Times,serif" font-size="14.00" fill="#000000"> close(c.done)</text>
</g>
<!-- cancel&#45;&gt;close_done_chan -->
<g id="edge19" class="edge">
<title>cancel&#45;&gt;close_done_chan</title>
<path fill="none" stroke="#000000" d="M546.7095,-149C577.1156,-149 611.7136,-149 643.1265,-149"/>
<polygon fill="#000000" stroke="#000000" points="643.2043,-152.5001 653.2042,-149 643.2042,-145.5001 643.2043,-152.5001"/>
</g>
<!-- wait_done_go -->
<g id="node10" class="node">
<title>wait_done_go</title>
<polygon fill="none" stroke="#000000" points="898,-118.5 898,-179.5 1119,-179.5 1119,-118.5 898,-118.5"/>
<text text-anchor="middle" x="1008.5" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#000000">go routine</text>
<polyline fill="none" stroke="#000000" points="898,-156.5 1119,-156.5 "/>
<text text-anchor="start" x="906" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#000000">等待ctx.Done的goroutine</text>
<text text-anchor="start" x="906" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#000000"> select { case &lt;&#45; ctx.Done(): return; }</text>
</g>
<!-- close_done_chan&#45;&gt;wait_done_go -->
<g id="edge20" class="edge">
<title>close_done_chan&#45;&gt;wait_done_go</title>
<path fill="none" stroke="#000000" d="M825.7232,-149C845.4008,-149 866.6679,-149 887.4987,-149"/>
<polygon fill="#000000" stroke="#000000" points="887.6809,-152.5001 897.6808,-149 887.6808,-145.5001 887.6809,-152.5001"/>
</g>
<!-- Background -->
<g id="node11" class="node">
<title>Background</title>
<polygon fill="none" stroke="#000000" points="88,-509 5,-509 5,-473 88,-473 88,-509"/>
<text text-anchor="middle" x="46.5" y="-487.3" font-family="Times,serif" font-size="14.00" fill="#000000">Background</text>
</g>
<!-- Background&#45;&gt;emptyCtx -->
<g id="edge1" class="edge">
<title>Background&#45;&gt;emptyCtx</title>
<path fill="none" stroke="#000000" d="M88.3426,-492.9088C159.3805,-496.1494 304.3455,-502.7625 391.6569,-506.7455"/>
<polygon fill="#000000" stroke="#000000" points="391.5994,-510.2464 401.7486,-507.2058 391.9185,-503.2536 391.5994,-510.2464"/>
</g>
<!-- TODO -->
<g id="node12" class="node">
<title>TODO</title>
<polygon fill="none" stroke="#000000" points="73.5,-563 19.5,-563 19.5,-527 73.5,-527 73.5,-563"/>
<text text-anchor="middle" x="46.5" y="-541.3" font-family="Times,serif" font-size="14.00" fill="#000000">TODO</text>
</g>
<!-- TODO&#45;&gt;emptyCtx -->
<g id="edge2" class="edge">
<title>TODO&#45;&gt;emptyCtx</title>
<path fill="none" stroke="#000000" d="M73.5068,-542.7305C137.0763,-537.3885 297.8536,-523.8779 391.7733,-515.9854"/>
<polygon fill="#000000" stroke="#000000" points="392.0938,-519.4709 401.7656,-515.1457 391.5076,-512.4955 392.0938,-519.4709"/>
</g>
<!-- WithTimeout -->
<g id="node13" class="node">
<title>WithTimeout</title>
<polygon fill="none" stroke="#000000" points="92,-221 1,-221 1,-185 92,-185 92,-221"/>
<text text-anchor="middle" x="46.5" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#000000">WithTimeout</text>
</g>
<!-- WithDeadline -->
<g id="node14" class="node">
<title>WithDeadline</title>
<polygon fill="none" stroke="#000000" points="93,-149 0,-149 0,-113 93,-113 93,-149"/>
<text text-anchor="middle" x="46.5" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#000000">WithDeadline</text>
</g>
<!-- WithTimeout&#45;&gt;WithDeadline -->
<g id="edge7" class="edge">
<title>WithTimeout&#45;&gt;WithDeadline</title>
<path fill="none" stroke="#000000" d="M46.5,-184.9539C46.5,-176.4073 46.5,-167.8607 46.5,-159.3142"/>
<polygon fill="#000000" stroke="#000000" points="50.0001,-159.2812 46.5,-149.2813 43.0001,-159.2813 50.0001,-159.2812"/>
</g>
<!-- WithDeadline&#45;&gt;timerCtx -->
<g id="edge8" class="edge">
<title>WithDeadline&#45;&gt;timerCtx</title>
<path fill="none" stroke="#000000" d="M67.8215,-149.0237C76.2676,-156.7975 85.6863,-166.3192 93,-176 113.9758,-203.7647 105.542,-220.2478 130,-245 138.8736,-253.9803 149.493,-261.9221 160.4698,-268.7951"/>
<polygon fill="#000000" stroke="#000000" points="158.9421,-271.9592 169.323,-274.0773 162.5287,-265.9478 158.9421,-271.9592"/>
</g>
<!-- WithDeadline&#45;&gt;time_AfterFunc -->
<g id="edge9" class="edge">
<title>WithDeadline&#45;&gt;time_AfterFunc</title>
<path fill="none" stroke="#000000" d="M93.1833,-131.2523C113.5118,-131.3622 137.79,-131.4935 160.2909,-131.6151"/>
<polygon fill="#000000" stroke="#000000" points="160.4647,-135.116 170.4835,-131.6702 160.5026,-128.1161 160.4647,-135.116"/>
</g>
<!-- WithDeadline&#45;&gt;func_cancel -->
<g id="edge10" class="edge">
<title>WithDeadline&#45;&gt;func_cancel</title>
<path fill="none" stroke="#000000" d="M91.7561,-149.1024C108.0449,-155.618 127.0055,-163.2022 145.6078,-170.6431"/>
<polygon fill="#000000" stroke="#000000" points="144.4064,-173.9321 154.9911,-174.3964 147.0062,-167.4328 144.4064,-173.9321"/>
</g>
<!-- WithCancel -->
<g id="node15" class="node">
<title>WithCancel</title>
<polygon fill="none" stroke="#000000" points="87.5,-75 5.5,-75 5.5,-39 87.5,-39 87.5,-75"/>
<text text-anchor="middle" x="46.5" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#000000">WithCancel</text>
</g>
<!-- WithDeadline&#45;&gt;WithCancel -->
<g id="edge11" class="edge">
<title>WithDeadline&#45;&gt;WithCancel</title>
<path fill="none" stroke="#000000" d="M46.5,-112.6942C46.5,-103.6162 46.5,-94.5383 46.5,-85.4603"/>
<polygon fill="#000000" stroke="#000000" points="50.0001,-85.2109 46.5,-75.2109 43.0001,-85.211 50.0001,-85.2109"/>
</g>
<!-- newCancelCtx -->
<g id="node16" class="node">
<title>newCancelCtx</title>
<polygon fill="none" stroke="#000000" points="279.5,-90 183.5,-90 183.5,-54 279.5,-54 279.5,-90"/>
<text text-anchor="middle" x="231.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#000000">newCancelCtx</text>
</g>
<!-- WithDeadline&#45;&gt;newCancelCtx -->
<g id="edge12" class="edge">
<title>WithDeadline&#45;&gt;newCancelCtx</title>
<path fill="none" stroke="#000000" d="M91.2567,-112.8459C103.7061,-108.0709 117.2974,-103.1108 130,-99 144.0252,-94.4612 159.3145,-90.0965 173.6708,-86.2485"/>
<polygon fill="#000000" stroke="#000000" points="174.6583,-89.6078 183.4337,-83.6712 172.8716,-82.8396 174.6583,-89.6078"/>
</g>
<!-- propagateCancel -->
<g id="node17" class="node">
<title>propagateCancel</title>
<polygon fill="none" stroke="#000000" points="285,-36 178,-36 178,0 285,0 285,-36"/>
<text text-anchor="middle" x="231.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#000000">propagateCancel</text>
</g>
<!-- WithDeadline&#45;&gt;propagateCancel -->
<g id="edge13" class="edge">
<title>WithDeadline&#45;&gt;propagateCancel</title>
<path fill="none" stroke="#000000" d="M64.6974,-112.785C73.3191,-104.1096 83.7351,-93.5629 93,-84 109.6252,-66.84 109.4561,-57.1989 130,-45 141.5568,-38.1376 154.8733,-32.9885 167.9781,-29.1351"/>
<polygon fill="#000000" stroke="#000000" points="169.1921,-32.4323 177.9255,-26.4341 167.3577,-25.6769 169.1921,-32.4323"/>
</g>
<!-- WithCancel&#45;&gt;newCancelCtx -->
<g id="edge15" class="edge">
<title>WithCancel&#45;&gt;newCancelCtx</title>
<path fill="none" stroke="#000000" d="M87.5575,-60.329C112.7762,-62.3737 145.475,-65.025 173.3324,-67.2837"/>
<polygon fill="#000000" stroke="#000000" points="173.1036,-70.7766 183.3538,-68.0963 173.6694,-63.7994 173.1036,-70.7766"/>
</g>
<!-- WithCancel&#45;&gt;propagateCancel -->
<g id="edge16" class="edge">
<title>WithCancel&#45;&gt;propagateCancel</title>
<path fill="none" stroke="#000000" d="M87.5575,-48.3446C111.1553,-43.37 141.3026,-37.0146 167.9043,-31.4067"/>
<polygon fill="#000000" stroke="#000000" points="168.842,-34.786 177.9049,-29.2984 167.398,-27.9365 168.842,-34.786"/>
</g>
<!-- newCancelCtx&#45;&gt;cancelCtx -->
<g id="edge21" class="edge">
<title>newCancelCtx&#45;&gt;cancelCtx</title>
<path fill="none" stroke="#000000" d="M279.6237,-75.1531C298.302,-78.6441 318.6146,-85.5509 333,-99 370.371,-133.9384 342.2644,-165.0114 370,-208 372.1632,-211.3528 374.4835,-214.6652 376.9282,-217.9263"/>
<polygon fill="#000000" stroke="#000000" points="374.2973,-220.2423 383.242,-225.9205 379.7906,-215.9036 374.2973,-220.2423"/>
</g>
<!-- WithValue -->
<g id="node18" class="node">
<title>WithValue</title>
<polygon fill="none" stroke="#000000" points="85,-436 8,-436 8,-400 85,-400 85,-436"/>
<text text-anchor="middle" x="46.5" y="-414.3" font-family="Times,serif" font-size="14.00" fill="#000000">WithValue</text>
</g>
<!-- WithValue&#45;&gt;valueCtx -->
<g id="edge14" class="edge">
<title>WithValue&#45;&gt;valueCtx</title>
<path fill="none" stroke="#000000" d="M85.3093,-418C154.7552,-418 301.2955,-418 390.0416,-418"/>
<polygon fill="#000000" stroke="#000000" points="390.3028,-421.5001 400.3028,-418 390.3028,-414.5001 390.3028,-421.5001"/>
</g>
</g>
</svg>
