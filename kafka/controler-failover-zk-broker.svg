<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: controller_failover_zk Pages: 1 -->
<svg width="2117pt" height="1242pt"
 viewBox="0.00 0.00 2117.05 1242.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1238.2033)">
<title>controller_failover_zk</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1238.2033 2113.0518,-1238.2033 2113.0518,4 -4,4"/>
<g id="clust18" class="cluster">
<title>cluster_zkClient</title>
<path fill="none" stroke="#000000" d="M190.1313,-919.2033C190.1313,-919.2033 1028.8052,-919.2033 1028.8052,-919.2033 1034.8052,-919.2033 1040.8052,-925.2033 1040.8052,-931.2033 1040.8052,-931.2033 1040.8052,-1041.2033 1040.8052,-1041.2033 1040.8052,-1047.2033 1034.8052,-1053.2033 1028.8052,-1053.2033 1028.8052,-1053.2033 190.1313,-1053.2033 190.1313,-1053.2033 184.1313,-1053.2033 178.1313,-1047.2033 178.1313,-1041.2033 178.1313,-1041.2033 178.1313,-931.2033 178.1313,-931.2033 178.1313,-925.2033 184.1313,-919.2033 190.1313,-919.2033"/>
<text text-anchor="middle" x="609.4683" y="-1033.2033" font-family="Times,serif" font-size="20.00" fill="#000000">zkClient</text>
</g>
<g id="clust1" class="cluster">
<title>cluster_controllerContext</title>
<path fill="none" stroke="#000000" d="M495.2456,-13.2033C495.2456,-13.2033 2054.4551,-13.2033 2054.4551,-13.2033 2060.4551,-13.2033 2066.4551,-19.2033 2066.4551,-25.2033 2066.4551,-25.2033 2066.4551,-311.2033 2066.4551,-311.2033 2066.4551,-317.2033 2060.4551,-323.2033 2054.4551,-323.2033 2054.4551,-323.2033 495.2456,-323.2033 495.2456,-323.2033 489.2456,-323.2033 483.2456,-317.2033 483.2456,-311.2033 483.2456,-311.2033 483.2456,-25.2033 483.2456,-25.2033 483.2456,-19.2033 489.2456,-13.2033 495.2456,-13.2033"/>
<text text-anchor="middle" x="1274.8503" y="-303.2033" font-family="Times,serif" font-size="20.00" fill="#000000">controllerContext</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_ControllerChannelManager</title>
<path fill="none" stroke="#000000" d="M491.7354,-1063.2033C491.7354,-1063.2033 2039.2964,-1063.2033 2039.2964,-1063.2033 2045.2964,-1063.2033 2051.2964,-1069.2033 2051.2964,-1075.2033 2051.2964,-1075.2033 2051.2964,-1214.2033 2051.2964,-1214.2033 2051.2964,-1220.2033 2045.2964,-1226.2033 2039.2964,-1226.2033 2039.2964,-1226.2033 491.7354,-1226.2033 491.7354,-1226.2033 485.7354,-1226.2033 479.7354,-1220.2033 479.7354,-1214.2033 479.7354,-1214.2033 479.7354,-1075.2033 479.7354,-1075.2033 479.7354,-1069.2033 485.7354,-1063.2033 491.7354,-1063.2033"/>
<text text-anchor="middle" x="1265.5159" y="-1206.2033" font-family="Times,serif" font-size="20.00" fill="#000000">ControllerChannelManager</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_replicaStateMachine</title>
<path fill="none" stroke="#000000" d="M811.2495,-787.2033C811.2495,-787.2033 1866.7754,-787.2033 1866.7754,-787.2033 1872.7754,-787.2033 1878.7754,-793.2033 1878.7754,-799.2033 1878.7754,-799.2033 1878.7754,-869.2033 1878.7754,-869.2033 1878.7754,-875.2033 1872.7754,-881.2033 1866.7754,-881.2033 1866.7754,-881.2033 811.2495,-881.2033 811.2495,-881.2033 805.2495,-881.2033 799.2495,-875.2033 799.2495,-869.2033 799.2495,-869.2033 799.2495,-799.2033 799.2495,-799.2033 799.2495,-793.2033 805.2495,-787.2033 811.2495,-787.2033"/>
<text text-anchor="middle" x="1339.0125" y="-861.2033" font-family="Times,serif" font-size="20.00" fill="#000000">replicaStateMachine</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_PartitionStateMachine</title>
<path fill="none" stroke="#000000" d="M1129.5742,-511.2033C1129.5742,-511.2033 2089.0518,-511.2033 2089.0518,-511.2033 2095.0518,-511.2033 2101.0518,-517.2033 2101.0518,-523.2033 2101.0518,-523.2033 2101.0518,-701.2033 2101.0518,-701.2033 2101.0518,-707.2033 2095.0518,-713.2033 2089.0518,-713.2033 2089.0518,-713.2033 1129.5742,-713.2033 1129.5742,-713.2033 1123.5742,-713.2033 1117.5742,-707.2033 1117.5742,-701.2033 1117.5742,-701.2033 1117.5742,-523.2033 1117.5742,-523.2033 1117.5742,-517.2033 1123.5742,-511.2033 1129.5742,-511.2033"/>
<text text-anchor="middle" x="1609.313" y="-693.2033" font-family="Times,serif" font-size="20.00" fill="#000000">PartitionStateMachine</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_topicDeletionManager</title>
<path fill="none" stroke="#000000" d="M1149.2432,-377.2033C1149.2432,-377.2033 1320.8643,-377.2033 1320.8643,-377.2033 1326.8643,-377.2033 1332.8643,-383.2033 1332.8643,-389.2033 1332.8643,-389.2033 1332.8643,-445.2033 1332.8643,-445.2033 1332.8643,-451.2033 1326.8643,-457.2033 1320.8643,-457.2033 1320.8643,-457.2033 1149.2432,-457.2033 1149.2432,-457.2033 1143.2432,-457.2033 1137.2432,-451.2033 1137.2432,-445.2033 1137.2432,-445.2033 1137.2432,-389.2033 1137.2432,-389.2033 1137.2432,-383.2033 1143.2432,-377.2033 1149.2432,-377.2033"/>
<text text-anchor="middle" x="1235.0537" y="-437.2033" font-family="Times,serif" font-size="20.00" fill="#000000">topicDeletionManager</text>
</g>
<!-- partitionsInStates -->
<g id="node1" class="node">
<title>partitionsInStates</title>
<polygon fill="none" stroke="#000000" points="1555.168,-233.2033 1441.1953,-233.2033 1441.1953,-197.2033 1555.168,-197.2033 1555.168,-233.2033"/>
<text text-anchor="middle" x="1498.1816" y="-211.0033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsInStates</text>
</g>
<!-- partitionStates -->
<g id="node2" class="node">
<title>partitionStates</title>
<polygon fill="#95e1d3" stroke="#000000" points="1694.5854,-183.4034 1694.5854,-233.0033 1828.02,-233.0033 1828.02,-183.4034 1694.5854,-183.4034"/>
<text text-anchor="start" x="1702.5854" y="-217.8033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionStates</text>
<polyline fill="none" stroke="#000000" points="1694.5854,-211.0033 1828.02,-211.0033 "/>
<text text-anchor="start" x="1702.5854" y="-195.8033" font-family="Times,serif" font-size="14.00" fill="#000000">所有partition的状态</text>
</g>
<!-- partitionsInStates&#45;&gt;partitionStates -->
<g id="edge1" class="edge">
<title>partitionsInStates&#45;&gt;partitionStates</title>
<path fill="none" stroke="#000000" d="M1555.275,-213.6844C1593.1152,-212.6778 1643.2106,-211.345 1684.5286,-210.2458"/>
<polygon fill="#000000" stroke="#000000" points="1684.6547,-213.7438 1694.558,-209.979 1684.4685,-206.7463 1684.6547,-213.7438"/>
</g>
<!-- updateBrokerMetadata -->
<g id="node3" class="node">
<title>updateBrokerMetadata</title>
<polygon fill="none" stroke="#000000" points="1570.4583,-287.2033 1425.905,-287.2033 1425.905,-251.2033 1570.4583,-251.2033 1570.4583,-287.2033"/>
<text text-anchor="middle" x="1498.1816" y="-265.0033" font-family="Times,serif" font-size="14.00" fill="#000000">updateBrokerMetadata</text>
</g>
<!-- liveBrokers -->
<g id="node4" class="node">
<title>liveBrokers</title>
<polygon fill="none" stroke="#000000" points="1802.1207,-287.2033 1720.4847,-287.2033 1720.4847,-251.2033 1802.1207,-251.2033 1802.1207,-287.2033"/>
<text text-anchor="middle" x="1761.3027" y="-265.0033" font-family="Times,serif" font-size="14.00" fill="#000000">liveBrokers</text>
</g>
<!-- updateBrokerMetadata&#45;&gt;liveBrokers -->
<g id="edge2" class="edge">
<title>updateBrokerMetadata&#45;&gt;liveBrokers</title>
<path fill="none" stroke="#000000" d="M1570.4287,-269.2033C1614.7942,-269.2033 1670.5415,-269.2033 1710.3131,-269.2033"/>
<polygon fill="#000000" stroke="#000000" points="1710.3182,-272.7034 1720.3182,-269.2033 1710.3181,-265.7034 1710.3182,-272.7034"/>
</g>
<!-- liveBrokerEpochs -->
<g id="node5" class="node">
<title>liveBrokerEpochs</title>
<polygon fill="#95e1d3" stroke="#000000" points="1941.3721,-110.2033 1941.3721,-146.2033 2058.4551,-146.2033 2058.4551,-110.2033 1941.3721,-110.2033"/>
<text text-anchor="middle" x="1999.9136" y="-124.0033" font-family="Times,serif" font-size="14.00" fill="#000000">liveBrokerEpochs</text>
</g>
<!-- liveBrokers&#45;&gt;liveBrokerEpochs -->
<g id="edge3" class="edge">
<title>liveBrokers&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M1802.0436,-265.2084C1825.5499,-261.6234 1855.0553,-254.8701 1878.7754,-242.2033 1919.9217,-220.2308 1957.3693,-180.6037 1979.406,-154.3466"/>
<polygon fill="#000000" stroke="#000000" points="1982.3513,-156.2758 1986.0044,-146.3307 1976.9468,-151.827 1982.3513,-156.2758"/>
</g>
<!-- partitionLeadershipInfo -->
<g id="node6" class="node">
<title>partitionLeadershipInfo</title>
<polygon fill="none" stroke="#000000" points="1572.6338,-179.2033 1423.7295,-179.2033 1423.7295,-143.2033 1572.6338,-143.2033 1572.6338,-179.2033"/>
<text text-anchor="middle" x="1498.1816" y="-157.0033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionLeadershipInfo</text>
</g>
<!-- replicasOnOfflineDirs -->
<g id="node7" class="node">
<title>replicasOnOfflineDirs</title>
<polygon fill="#95e1d3" stroke="#000000" points="1691.0957,-41.4034 1691.0957,-91.0033 1831.5098,-91.0033 1831.5098,-41.4034 1691.0957,-41.4034"/>
<text text-anchor="middle" x="1761.3027" y="-75.8033" font-family="Times,serif" font-size="14.00" fill="#000000">replicasOnOfflineDirs</text>
<polyline fill="none" stroke="#000000" points="1691.0957,-69.0033 1831.5098,-69.0033 "/>
<text text-anchor="middle" x="1761.3027" y="-53.8033" font-family="Times,serif" font-size="14.00" fill="#000000">这个作用是？</text>
</g>
<!-- isReplicaOnline -->
<g id="node8" class="node">
<title>isReplicaOnline</title>
<polygon fill="none" stroke="#000000" points="1551.382,-125.2033 1444.9813,-125.2033 1444.9813,-89.2033 1551.382,-89.2033 1551.382,-125.2033"/>
<text text-anchor="middle" x="1498.1816" y="-103.0033" font-family="Times,serif" font-size="14.00" fill="#000000">isReplicaOnline</text>
</g>
<!-- isReplicaOnline&#45;&gt;replicasOnOfflineDirs -->
<g id="edge4" class="edge">
<title>isReplicaOnline&#45;&gt;replicasOnOfflineDirs</title>
<path fill="none" stroke="#000000" d="M1551.4281,-98.9064C1588.5466,-93.1225 1638.7418,-85.301 1680.736,-78.7574"/>
<polygon fill="#000000" stroke="#000000" points="1681.3249,-82.208 1690.6668,-77.21 1680.2471,-75.2914 1681.3249,-82.208"/>
</g>
<!-- liveOrShuttingDownBrokerIds -->
<g id="node9" class="node">
<title>liveOrShuttingDownBrokerIds</title>
<polygon fill="none" stroke="#000000" points="1856.231,-165.2033 1666.3745,-165.2033 1666.3745,-129.2033 1856.231,-129.2033 1856.231,-165.2033"/>
<text text-anchor="middle" x="1761.3027" y="-143.0033" font-family="Times,serif" font-size="14.00" fill="#000000">liveOrShuttingDownBrokerIds</text>
</g>
<!-- isReplicaOnline&#45;&gt;liveOrShuttingDownBrokerIds -->
<g id="edge5" class="edge">
<title>isReplicaOnline&#45;&gt;liveOrShuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M1551.4281,-115.2979C1581.5568,-119.8781 1620.3011,-125.7681 1656.282,-131.238"/>
<polygon fill="#000000" stroke="#000000" points="1655.9353,-134.7254 1666.3477,-132.7682 1656.9874,-127.8049 1655.9353,-134.7254"/>
</g>
<!-- liveOrShuttingDownBrokerIds&#45;&gt;liveBrokerEpochs -->
<g id="edge8" class="edge">
<title>liveOrShuttingDownBrokerIds&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M1856.2937,-139.6394C1881.313,-137.6472 1907.8222,-135.5364 1931.1637,-133.6777"/>
<polygon fill="#000000" stroke="#000000" points="1931.6123,-137.1532 1941.3029,-132.8704 1931.0566,-130.1753 1931.6123,-137.1532"/>
</g>
<!-- partitionsBeingReassigned -->
<g id="node10" class="node">
<title>partitionsBeingReassigned</title>
<polygon fill="#95e1d3" stroke="#000000" points="1152.0088,-225.4034 1152.0088,-275.0033 1318.0986,-275.0033 1318.0986,-225.4034 1152.0088,-225.4034"/>
<text text-anchor="middle" x="1235.0537" y="-259.8033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsBeingReassigned</text>
<polyline fill="none" stroke="#000000" points="1152.0088,-253.0033 1318.0986,-253.0033 "/>
<text text-anchor="middle" x="1235.0537" y="-237.8033" font-family="Times,serif" font-size="14.00" fill="#000000">迁移中的partition;</text>
</g>
<!-- addLiveBrokersAndEpochs -->
<g id="node11" class="node">
<title>addLiveBrokersAndEpochs</title>
<polygon fill="none" stroke="#000000" points="491.2456,-163.6034 491.2456,-232.8033 662.7632,-232.8033 662.7632,-163.6034 491.2456,-163.6034"/>
<text text-anchor="middle" x="577.0044" y="-217.6033" font-family="Times,serif" font-size="14.00" fill="#000000">addLiveBrokersAndEpochs</text>
<polyline fill="none" stroke="#000000" points="491.2456,-210.8033 662.7632,-210.8033 "/>
<text text-anchor="start" x="499.2456" y="-195.6033" font-family="Times,serif" font-size="14.00" fill="#000000">将新增的broker加入</text>
<text text-anchor="start" x="499.2456" y="-176.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 到liveBrokerEpochs中</text>
</g>
<!-- addLiveBrokersAndEpochs&#45;&gt;liveBrokerEpochs -->
<g id="edge7" class="edge">
<title>addLiveBrokersAndEpochs&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M662.7888,-185.1399C688.3693,-181.2687 716.4718,-177.0399 742.3115,-173.2033 1025.853,-131.1047 1094.6333,-100.9242 1380.5332,-80.2033 1484.836,-72.6439 1514.5972,-53.9713 1615.8301,-80.2033 1633.5482,-84.7946 1634.3104,-94.9049 1651.8301,-100.2033 1664.9486,-104.1708 1833.2481,-116.5064 1930.928,-123.407"/>
<polygon fill="#000000" stroke="#000000" points="1930.8018,-126.9067 1941.0232,-124.1186 1931.294,-119.924 1930.8018,-126.9067"/>
</g>
<!-- removeLiveBrokers -->
<g id="node12" class="node">
<title>removeLiveBrokers</title>
<polygon fill="none" stroke="#000000" points="495.7129,-48.6034 495.7129,-117.8033 658.2959,-117.8033 658.2959,-48.6034 495.7129,-48.6034"/>
<text text-anchor="middle" x="577.0044" y="-102.6033" font-family="Times,serif" font-size="14.00" fill="#000000">removeLiveBrokers</text>
<polyline fill="none" stroke="#000000" points="495.7129,-95.8033 658.2959,-95.8033 "/>
<text text-anchor="start" x="503.7129" y="-80.6033" font-family="Times,serif" font-size="14.00" fill="#000000">将挂掉的broker从</text>
<text text-anchor="start" x="503.7129" y="-61.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> liveBrokerEpochs中删掉</text>
</g>
<!-- removeLiveBrokers&#45;&gt;liveBrokerEpochs -->
<g id="edge6" class="edge">
<title>removeLiveBrokers&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M658.3374,-70.7856C782.4039,-52.9501 1026.5238,-22.2033 1235.0537,-22.2033 1235.0537,-22.2033 1235.0537,-22.2033 1498.1816,-22.2033 1667.3928,-22.2033 1719.7191,25.5333 1878.7754,-32.2033 1918.2074,-46.517 1954.6532,-79.1477 1977.0556,-102.3871"/>
<polygon fill="#000000" stroke="#000000" points="1974.6955,-104.9863 1984.0986,-109.8682 1979.7923,-100.188 1974.6955,-104.9863"/>
</g>
<!-- replicasOnBrokers -->
<g id="node13" class="node">
<title>replicasOnBrokers</title>
<polygon fill="none" stroke="#000000" points="814.6323,-237.4034 814.6323,-287.0033 1017.2534,-287.0033 1017.2534,-237.4034 814.6323,-237.4034"/>
<text text-anchor="middle" x="915.9429" y="-271.8033" font-family="Times,serif" font-size="14.00" fill="#000000">replicasOnBrokers</text>
<polyline fill="none" stroke="#000000" points="814.6323,-265.0033 1017.2534,-265.0033 "/>
<text text-anchor="middle" x="915.9429" y="-249.8033" font-family="Times,serif" font-size="14.00" fill="#000000">获取broker列表上的所有replica</text>
</g>
<!-- partitionAssignment -->
<g id="node15" class="node">
<title>partitionAssignment</title>
<polygon fill="#95e1d3" stroke="#000000" points="1164.0537,-156.4034 1164.0537,-206.0033 1306.0537,-206.0033 1306.0537,-156.4034 1164.0537,-156.4034"/>
<text text-anchor="middle" x="1235.0537" y="-190.8033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionAssignment</text>
<polyline fill="none" stroke="#000000" points="1164.0537,-184.0033 1306.0537,-184.0033 "/>
<text text-anchor="middle" x="1235.0537" y="-168.8033" font-family="Times,serif" font-size="14.00" fill="#000000">记录了所有分区映射</text>
</g>
<!-- replicasOnBrokers&#45;&gt;partitionAssignment -->
<g id="edge9" class="edge">
<title>replicasOnBrokers&#45;&gt;partitionAssignment</title>
<path fill="none" stroke="#000000" d="M1017.3759,-246.0818C1041.2952,-241.254 1066.5323,-235.3091 1089.5742,-228.2033 1102.5121,-224.2135 1104.8431,-220.8105 1117.5742,-216.2033 1129.2591,-211.9748 1141.7254,-207.8543 1154.0088,-204.0127"/>
<polygon fill="#000000" stroke="#000000" points="1155.2764,-207.2846 1163.8022,-200.9948 1153.2149,-200.595 1155.2764,-207.2846"/>
</g>
<!-- shuttingDownBrokerIds -->
<g id="node14" class="node">
<title>shuttingDownBrokerIds</title>
<polygon fill="#95e1d3" stroke="#000000" points="840.2808,-182.2033 840.2808,-218.2033 991.605,-218.2033 991.605,-182.2033 840.2808,-182.2033"/>
<text text-anchor="middle" x="915.9429" y="-196.0033" font-family="Times,serif" font-size="14.00" fill="#000000">shuttingDownBrokerIds</text>
</g>
<!-- sendRequest -->
<g id="node16" class="node">
<title>sendRequest</title>
<polygon fill="none" stroke="#000000" points="2043.1795,-1107.2033 1956.6476,-1107.2033 1956.6476,-1071.2033 2043.1795,-1071.2033 2043.1795,-1107.2033"/>
<text text-anchor="middle" x="1999.9136" y="-1085.0033" font-family="Times,serif" font-size="14.00" fill="#000000">sendRequest</text>
</g>
<!-- controllerChannelManager_removeBroker -->
<g id="node17" class="node">
<title>controllerChannelManager_removeBroker</title>
<polygon fill="none" stroke="#000000" points="487.7354,-1140.4034 487.7354,-1190.0033 666.2734,-1190.0033 666.2734,-1140.4034 487.7354,-1140.4034"/>
<text text-anchor="middle" x="577.0044" y="-1174.8033" font-family="Times,serif" font-size="14.00" fill="#000000">removeBroker</text>
<polyline fill="none" stroke="#000000" points="487.7354,-1168.0033 666.2734,-1168.0033 "/>
<text text-anchor="start" x="495.7354" y="-1152.8033" font-family="Times,serif" font-size="14.00" fill="#000000">删掉挂掉的broker通信线程</text>
</g>
<!-- controllerChannelManager_addBroker -->
<g id="node18" class="node">
<title>controllerChannelManager_addBroker</title>
<polygon fill="none" stroke="#000000" points="491.5122,-1071.4034 491.5122,-1121.0033 662.4966,-1121.0033 662.4966,-1071.4034 491.5122,-1071.4034"/>
<text text-anchor="middle" x="577.0044" y="-1105.8033" font-family="Times,serif" font-size="14.00" fill="#000000">addBroker</text>
<polyline fill="none" stroke="#000000" points="491.5122,-1099.0033 662.4966,-1099.0033 "/>
<text text-anchor="start" x="499.5122" y="-1083.8033" font-family="Times,serif" font-size="14.00" fill="#000000">新增broker, 创建通信线程</text>
</g>
<!-- sendUpdateMetadataRequest -->
<g id="node19" class="node">
<title>sendUpdateMetadataRequest</title>
<polygon fill="none" stroke="#000000" points="1851.0793,-1107.2033 1671.5262,-1107.2033 1671.5262,-1071.2033 1851.0793,-1071.2033 1851.0793,-1107.2033"/>
<text text-anchor="middle" x="1761.3027" y="-1085.0033" font-family="Times,serif" font-size="14.00" fill="#000000">sendUpdateMetadataRequest</text>
</g>
<!-- sendUpdateMetadataRequest&#45;&gt;sendRequest -->
<g id="edge46" class="edge">
<title>sendUpdateMetadataRequest&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1851.1713,-1089.2033C1883.2919,-1089.2033 1918.449,-1089.2033 1946.5149,-1089.2033"/>
<polygon fill="#000000" stroke="#000000" points="1946.5154,-1092.7034 1956.5154,-1089.2033 1946.5154,-1085.7034 1946.5154,-1092.7034"/>
</g>
<!-- replicaStateMachine_handleStateChanges_OnlineReplica -->
<g id="node20" class="node">
<title>replicaStateMachine_handleStateChanges_OnlineReplica</title>
<polygon fill="none" stroke="#000000" points="807.2495,-795.4034 807.2495,-845.0033 1024.6362,-845.0033 1024.6362,-795.4034 807.2495,-795.4034"/>
<text text-anchor="middle" x="915.9429" y="-829.8033" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChanges_OnlineReplica</text>
<polyline fill="none" stroke="#000000" points="807.2495,-823.0033 1024.6362,-823.0033 "/>
<text text-anchor="middle" x="915.9429" y="-807.8033" font-family="Times,serif" font-size="14.00" fill="#000000">将副本设置为在线状态</text>
</g>
<!-- replicaStateMachine_handleStateChanges_OnlineReplica&#45;&gt;sendRequest -->
<g id="edge47" class="edge">
<title>replicaStateMachine_handleStateChanges_OnlineReplica&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1024.7981,-835.4629C1214.3663,-862.1441 1587.7179,-915.2097 1615.8301,-923.2033 1745.0571,-959.9486 1888.0292,-1030.2411 1957.4389,-1066.4302"/>
<polygon fill="#000000" stroke="#000000" points="1955.8531,-1069.5506 1966.3352,-1071.0923 1959.1023,-1063.3504 1955.8531,-1069.5506"/>
</g>
<!-- replicaStateMachine_handleStateChanges_OfflineReplica -->
<g id="node21" class="node">
<title>replicaStateMachine_handleStateChanges_OfflineReplica</title>
<polygon fill="none" stroke="#000000" points="1651.8301,-795.4034 1651.8301,-845.0033 1870.7754,-845.0033 1870.7754,-795.4034 1651.8301,-795.4034"/>
<text text-anchor="middle" x="1761.3027" y="-829.8033" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChanges_OfflineReplica</text>
<polyline fill="none" stroke="#000000" points="1651.8301,-823.0033 1870.7754,-823.0033 "/>
<text text-anchor="middle" x="1761.3027" y="-807.8033" font-family="Times,serif" font-size="14.00" fill="#000000">将副本设置为离线状态</text>
</g>
<!-- replicaStateMachine_handleStateChanges_OfflineReplica&#45;&gt;sendRequest -->
<g id="edge48" class="edge">
<title>replicaStateMachine_handleStateChanges_OfflineReplica&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1857.6482,-845.0804C1865.2123,-849.1095 1872.3832,-853.7833 1878.7754,-859.2033 1943.7148,-914.2667 1978.7292,-1013.0824 1992.6571,-1061.2604"/>
<polygon fill="#000000" stroke="#000000" points="1989.3201,-1062.3239 1995.3859,-1071.0105 1996.0611,-1060.4372 1989.3201,-1062.3239"/>
</g>
<!-- triggerOnlinePartitionStateChange -->
<g id="node22" class="node">
<title>triggerOnlinePartitionStateChange</title>
<polygon fill="none" stroke="#000000" points="1129.8535,-519.6034 1129.8535,-588.8033 1340.2539,-588.8033 1340.2539,-519.6034 1129.8535,-519.6034"/>
<text text-anchor="middle" x="1235.0537" y="-573.6033" font-family="Times,serif" font-size="14.00" fill="#000000">triggerOnlinePartitionStateChange</text>
<polyline fill="none" stroke="#000000" points="1129.8535,-566.8033 1340.2539,-566.8033 "/>
<text text-anchor="start" x="1137.8535" y="-551.6033" font-family="Times,serif" font-size="14.00" fill="#000000">从partitionStates过滤出处于</text>
<text text-anchor="start" x="1137.8535" y="-532.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> Newpartition和Offline的partition</text>
</g>
<!-- triggerOnlinePartitionStateChange&#45;&gt;partitionsInStates -->
<g id="edge10" class="edge">
<title>triggerOnlinePartitionStateChange&#45;&gt;partitionsInStates</title>
<path fill="none" stroke="#000000" d="M1336.2198,-519.2117C1339.2272,-516.4342 1342.0178,-513.4371 1344.5332,-510.2033 1418.3216,-415.3417 1299.5528,-331.0044 1380.5332,-242.2033 1393.4602,-228.0279 1412.1867,-220.5381 1430.9117,-216.7651"/>
<polygon fill="#000000" stroke="#000000" points="1431.6925,-220.183 1440.9739,-215.0737 1430.5321,-213.2799 1431.6925,-220.183"/>
</g>
<!-- triggerOnlineStateChangeForPartitions -->
<g id="node23" class="node">
<title>triggerOnlineStateChangeForPartitions</title>
<polygon fill="none" stroke="#000000" points="1615.9787,-581.2033 1380.3846,-581.2033 1380.3846,-545.2033 1615.9787,-545.2033 1615.9787,-581.2033"/>
<text text-anchor="middle" x="1498.1816" y="-559.0033" font-family="Times,serif" font-size="14.00" fill="#000000">triggerOnlineStateChangeForPartitions</text>
</g>
<!-- triggerOnlinePartitionStateChange&#45;&gt;triggerOnlineStateChangeForPartitions -->
<g id="edge11" class="edge">
<title>triggerOnlinePartitionStateChange&#45;&gt;triggerOnlineStateChangeForPartitions</title>
<path fill="none" stroke="#000000" d="M1340.5618,-557.8121C1350.2183,-558.1424 1360.0699,-558.4794 1369.8971,-558.8155"/>
<polygon fill="#000000" stroke="#000000" points="1370.0062,-562.3212 1380.1201,-559.1652 1370.2456,-555.3253 1370.0062,-562.3212"/>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition -->
<g id="node24" class="node">
<title>partitionStateMachine_handleStateChange_OnlinePartition</title>
<polygon fill="none" stroke="#000000" points="1652.6025,-572.4034 1652.6025,-622.0033 1870.0029,-622.0033 1870.0029,-572.4034 1652.6025,-572.4034"/>
<text text-anchor="middle" x="1761.3027" y="-606.8033" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange_OnlinePartition</text>
<polyline fill="none" stroke="#000000" points="1652.6025,-600.0033 1870.0029,-600.0033 "/>
<text text-anchor="middle" x="1761.3027" y="-584.8033" font-family="Times,serif" font-size="14.00" fill="#000000">触发partition leader选举</text>
</g>
<!-- triggerOnlineStateChangeForPartitions&#45;&gt;partitionStateMachine_handleStateChange_OnlinePartition -->
<g id="edge12" class="edge">
<title>triggerOnlineStateChangeForPartitions&#45;&gt;partitionStateMachine_handleStateChange_OnlinePartition</title>
<path fill="none" stroke="#000000" d="M1615.8895,-578.4133C1624.7376,-579.5567 1633.6701,-580.7109 1642.5247,-581.8551"/>
<polygon fill="#000000" stroke="#000000" points="1642.1139,-585.331 1652.48,-583.1415 1643.011,-578.3887 1642.1139,-585.331"/>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;sendRequest -->
<g id="edge49" class="edge">
<title>partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1838.0936,-622.139C1853.2842,-630.0468 1867.8788,-640.2265 1878.7754,-653.2033 1905.8673,-685.4674 1972.6094,-969.7802 1993.5332,-1061.097"/>
<polygon fill="#000000" stroke="#000000" points="1990.1582,-1062.0393 1995.7978,-1071.0084 1996.9824,-1060.48 1990.1582,-1062.0393"/>
</g>
<!-- electLeaderForPartitions -->
<g id="node26" class="node">
<title>electLeaderForPartitions</title>
<polygon fill="none" stroke="#000000" points="1906.7754,-572.4034 1906.7754,-622.0033 2093.0518,-622.0033 2093.0518,-572.4034 1906.7754,-572.4034"/>
<text text-anchor="middle" x="1999.9136" y="-606.8033" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaderForPartitions</text>
<polyline fill="none" stroke="#000000" points="1906.7754,-600.0033 2093.0518,-600.0033 "/>
<text text-anchor="middle" x="1999.9136" y="-584.8033" font-family="Times,serif" font-size="14.00" fill="#000000">从备选的replica中选出leader</text>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;electLeaderForPartitions -->
<g id="edge13" class="edge">
<title>partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;electLeaderForPartitions</title>
<path fill="none" stroke="#000000" d="M1870.1343,-597.2033C1878.8803,-597.2033 1887.702,-597.2033 1896.4093,-597.2033"/>
<polygon fill="#000000" stroke="#000000" points="1896.5671,-600.7034 1906.5671,-597.2033 1896.567,-593.7034 1896.5671,-600.7034"/>
</g>
<!-- partitionStateMachine_handleStateChange_OfflinePartition -->
<g id="node25" class="node">
<title>partitionStateMachine_handleStateChange_OfflinePartition</title>
<polygon fill="none" stroke="#000000" points="1125.5742,-607.6034 1125.5742,-676.8033 1344.5332,-676.8033 1344.5332,-607.6034 1125.5742,-607.6034"/>
<text text-anchor="middle" x="1235.0537" y="-661.6033" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange_OfflinePartition</text>
<polyline fill="none" stroke="#000000" points="1125.5742,-654.8033 1344.5332,-654.8033 "/>
<text text-anchor="start" x="1133.5742" y="-639.6033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionleader挂了</text>
<text text-anchor="start" x="1133.5742" y="-620.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 将partition设置为offline状态</text>
</g>
<!-- partitionStateMachine_handleStateChange_OfflinePartition&#45;&gt;sendRequest -->
<g id="edge50" class="edge">
<title>partitionStateMachine_handleStateChange_OfflinePartition&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1344.8085,-636.6355C1484.9418,-635.5019 1727.3476,-654.4252 1878.7754,-783.2033 1965.2067,-856.7068 1990.4385,-1000.2978 1997.4091,-1061.0167"/>
<polygon fill="#000000" stroke="#000000" points="1993.9356,-1061.4519 1998.4765,-1071.0243 2000.8961,-1060.7095 1993.9356,-1061.4519"/>
</g>
<!-- failReplicaDeletion -->
<g id="node27" class="node">
<title>failReplicaDeletion</title>
<polygon fill="none" stroke="#000000" points="1297.6754,-421.2033 1172.432,-421.2033 1172.432,-385.2033 1297.6754,-385.2033 1297.6754,-421.2033"/>
<text text-anchor="middle" x="1235.0537" y="-399.0033" font-family="Times,serif" font-size="14.00" fill="#000000">failReplicaDeletion</text>
</g>
<!-- onBrokerFailure -->
<g id="node28" class="node">
<title>onBrokerFailure</title>
<polygon fill="#f38181" stroke="#000000" points="463.4438,-331.6034 463.4438,-400.8033 690.5649,-400.8033 690.5649,-331.6034 463.4438,-331.6034"/>
<text text-anchor="middle" x="577.0044" y="-385.6033" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerFailure</text>
<polyline fill="none" stroke="#000000" points="463.4438,-378.8033 690.5649,-378.8033 "/>
<text text-anchor="start" x="471.4438" y="-363.6033" font-family="Times,serif" font-size="14.00" fill="#000000">1. 对于dead broker调用onBrokerFail</text>
<text text-anchor="middle" x="577.0044" y="-344.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 取消注册brokerModify zk回调</text>
</g>
<!-- onBrokerFailure&#45;&gt;replicasOnOfflineDirs -->
<g id="edge30" class="edge">
<title>onBrokerFailure&#45;&gt;replicasOnOfflineDirs</title>
<path fill="none" stroke="#000000" d="M690.7321,-340.2863C696.3991,-336.4965 701.6578,-332.1613 706.3115,-327.2033 754.4164,-275.9534 691.0923,-221.341 742.3115,-173.2033 1004.7933,73.4864 1489.6166,-3.1464 1680.7881,-45.9488"/>
<polygon fill="#000000" stroke="#000000" points="1680.2382,-49.413 1690.7648,-48.2118 1681.7868,-42.5864 1680.2382,-49.413"/>
</g>
<!-- onBrokerFailure&#45;&gt;replicasOnBrokers -->
<g id="edge31" class="edge">
<title>onBrokerFailure&#45;&gt;replicasOnBrokers</title>
<path fill="none" stroke="#000000" d="M690.6861,-334.3131C696.0318,-332.0671 701.267,-329.6977 706.3115,-327.2033 724.0034,-318.4554 724.3163,-309.309 742.3115,-301.2033 761.8542,-292.4006 783.5561,-285.5048 804.8119,-280.1288"/>
<polygon fill="#000000" stroke="#000000" points="805.6473,-283.5278 814.5373,-277.7643 803.9935,-276.7259 805.6473,-283.5278"/>
</g>
<!-- onBrokerFailure&#45;&gt;shuttingDownBrokerIds -->
<g id="edge32" class="edge">
<title>onBrokerFailure&#45;&gt;shuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M690.6578,-339.2356C696.2676,-335.7052 701.5413,-331.7144 706.3115,-327.2033 740.3287,-295.0345 706.2312,-258.0397 742.3115,-228.2033 766.5176,-208.1863 799.3069,-199.7353 829.8726,-196.7871"/>
<polygon fill="#000000" stroke="#000000" points="830.4388,-200.2538 840.1376,-195.9895 829.8964,-193.2748 830.4388,-200.2538"/>
</g>
<!-- onReplicasBecomeOffline -->
<g id="node29" class="node">
<title>onReplicasBecomeOffline</title>
<polygon fill="none" stroke="#000000" points="742.3115,-473.8035 742.3115,-562.6032 1089.5742,-562.6032 1089.5742,-473.8035 742.3115,-473.8035"/>
<text text-anchor="middle" x="915.9429" y="-547.4032" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicasBecomeOffline</text>
<polyline fill="none" stroke="#000000" points="742.3115,-540.6032 1089.5742,-540.6032 "/>
<text text-anchor="start" x="750.3115" y="-525.4032" font-family="Times,serif" font-size="14.00" fill="#000000">1. 将该broker上的replica设置为离线</text>
<text text-anchor="start" x="750.3115" y="-505.8033" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 如果parition leader为该broker，将partition设置offline</text>
<text text-anchor="start" x="750.3115" y="-486.2034" font-family="Times,serif" font-size="14.00" fill="#000000"> 3. 更新所有live broker的metadata</text>
</g>
<!-- onBrokerFailure&#45;&gt;onReplicasBecomeOffline -->
<g id="edge33" class="edge">
<title>onBrokerFailure&#45;&gt;onReplicasBecomeOffline</title>
<path fill="none" stroke="#000000" d="M654.3389,-400.8847C699.678,-421.2174 757.6579,-447.219 807.5063,-469.574"/>
<polygon fill="#000000" stroke="#000000" points="806.1579,-472.8051 816.7146,-473.7035 809.0224,-466.418 806.1579,-472.8051"/>
</g>
<!-- unregisterBrokerModificationsHandler -->
<g id="node38" class="node">
<title>unregisterBrokerModificationsHandler</title>
<polygon fill="none" stroke="#000000" points="1032.6676,-963.2033 799.2181,-963.2033 799.2181,-927.2033 1032.6676,-927.2033 1032.6676,-963.2033"/>
<text text-anchor="middle" x="915.9429" y="-941.0033" font-family="Times,serif" font-size="14.00" fill="#000000">unregisterBrokerModificationsHandler</text>
</g>
<!-- onBrokerFailure&#45;&gt;unregisterBrokerModificationsHandler -->
<g id="edge34" class="edge">
<title>onBrokerFailure&#45;&gt;unregisterBrokerModificationsHandler</title>
<path fill="none" stroke="#000000" d="M620.9491,-400.9582C650.5086,-427.0555 687.4086,-465.5224 706.3115,-508.2033 740.3917,-585.153 690.2718,-819.0627 742.3115,-885.2033 755.7366,-902.2662 774.2995,-914.4972 794.3184,-923.2595"/>
<polygon fill="#000000" stroke="#000000" points="793.0241,-926.5114 803.6054,-927.0462 795.6671,-920.0296 793.0241,-926.5114"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;sendUpdateMetadataRequest -->
<g id="edge35" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;sendUpdateMetadataRequest</title>
<path fill="none" stroke="#000000" d="M947.1465,-562.8612C983.6596,-612.7317 1048.0353,-693.5999 1117.5742,-748.2033 1221.2208,-829.5889 1258.4822,-835.5067 1380.5332,-885.2033 1481.7017,-926.397 1520.8645,-902.2264 1615.8301,-956.2033 1665.8662,-984.6431 1712.9464,-1033.1203 1739.3578,-1063.0311"/>
<polygon fill="#000000" stroke="#000000" points="1737.0389,-1065.6979 1746.2443,-1070.943 1742.3189,-1061.1022 1737.0389,-1065.6979"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;replicaStateMachine_handleStateChanges_OfflineReplica -->
<g id="edge36" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;replicaStateMachine_handleStateChanges_OfflineReplica</title>
<path fill="none" stroke="#000000" d="M947.4674,-562.715C983.1033,-609.3426 1045.6141,-680.7636 1117.5742,-717.2033 1123.4108,-720.1589 1456.8859,-772.6169 1641.4848,-801.4987"/>
<polygon fill="#000000" stroke="#000000" points="1641.099,-804.9809 1651.5198,-803.0685 1642.1809,-798.065 1641.099,-804.9809"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;triggerOnlinePartitionStateChange -->
<g id="edge37" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;triggerOnlinePartitionStateChange</title>
<path fill="none" stroke="#000000" d="M1089.9715,-537.8361C1100.0382,-538.9718 1110.0274,-540.0987 1119.7771,-541.1986"/>
<polygon fill="#000000" stroke="#000000" points="1119.5145,-544.6911 1129.8439,-542.3343 1120.2993,-537.7352 1119.5145,-544.6911"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;partitionStateMachine_handleStateChange_OfflinePartition -->
<g id="edge38" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;partitionStateMachine_handleStateChange_OfflinePartition</title>
<path fill="none" stroke="#000000" d="M1026.9853,-562.7069C1056.3927,-574.3706 1088.146,-586.8556 1117.5742,-598.2033 1122.4036,-600.0656 1127.3488,-601.9613 1132.3466,-603.8681"/>
<polygon fill="#000000" stroke="#000000" points="1131.4152,-607.2585 1142.0062,-607.5431 1133.9044,-600.716 1131.4152,-607.2585"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;failReplicaDeletion -->
<g id="edge39" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;failReplicaDeletion</title>
<path fill="none" stroke="#000000" d="M1039.3195,-473.7413C1086.0462,-456.9021 1137.1428,-438.4881 1175.4093,-424.6978"/>
<polygon fill="#000000" stroke="#000000" points="1176.6301,-427.9782 1184.8512,-421.2951 1174.2568,-421.3928 1176.6301,-427.9782"/>
</g>
<!-- partitionsWithoutLeader -->
<g id="node39" class="node">
<title>partitionsWithoutLeader</title>
<polygon fill="none" stroke="#000000" points="1311.6211,-501.2033 1158.4863,-501.2033 1158.4863,-465.2033 1311.6211,-465.2033 1311.6211,-501.2033"/>
<text text-anchor="middle" x="1235.0537" y="-479.0033" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsWithoutLeader</text>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;partitionsWithoutLeader -->
<g id="edge40" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;partitionsWithoutLeader</title>
<path fill="none" stroke="#000000" d="M1089.9715,-499.1159C1110.1528,-496.9024 1130.0227,-494.7231 1148.2754,-492.7212"/>
<polygon fill="#000000" stroke="#000000" points="1148.6824,-496.1976 1158.2412,-491.6281 1147.9192,-489.2393 1148.6824,-496.1976"/>
</g>
<!-- onBrokerStartup -->
<g id="node30" class="node">
<title>onBrokerStartup</title>
<polygon fill="#f38181" stroke="#000000" points="447.6973,-517.4036 447.6973,-665.0031 706.3115,-665.0031 706.3115,-517.4036 447.6973,-517.4036"/>
<text text-anchor="middle" x="577.0044" y="-649.8031" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerStartup</text>
<polyline fill="none" stroke="#000000" points="447.6973,-643.0031 706.3115,-643.0031 "/>
<text text-anchor="start" x="455.6973" y="-627.8031" font-family="Times,serif" font-size="14.00" fill="#000000">新增的broker，调用onBrokerStartup</text>
<text text-anchor="start" x="455.6973" y="-608.2032" font-family="Times,serif" font-size="14.00" fill="#000000"> 1. 注册brokerModify的zk回调</text>
<text text-anchor="start" x="455.6973" y="-588.6033" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 向所有live broker发送updateMeta请求</text>
<text text-anchor="start" x="455.6973" y="-569.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 3. 将该broker上的replica设置为在线</text>
<text text-anchor="start" x="455.6973" y="-549.4034" font-family="Times,serif" font-size="14.00" fill="#000000"> 4. 可能触发partition leader选举</text>
<text text-anchor="start" x="455.6973" y="-529.8035" font-family="Times,serif" font-size="14.00" fill="#000000"> 5. 检查是否要恢复parition 迁移</text>
</g>
<!-- onBrokerStartup&#45;&gt;replicasOnBrokers -->
<g id="edge24" class="edge">
<title>onBrokerStartup&#45;&gt;replicasOnBrokers</title>
<path fill="none" stroke="#000000" d="M634.5258,-517.0376C658.13,-485.0448 684.8845,-446.6604 706.3115,-410.2033 725.2497,-377.9809 715.2398,-359.9727 742.3115,-334.2033 761.8035,-315.649 786.7548,-301.5773 811.6256,-291.0255"/>
<polygon fill="#000000" stroke="#000000" points="813.1996,-294.1637 821.1421,-287.1517 810.5605,-287.6802 813.1996,-294.1637"/>
</g>
<!-- onBrokerStartup&#45;&gt;sendUpdateMetadataRequest -->
<g id="edge25" class="edge">
<title>onBrokerStartup&#45;&gt;sendUpdateMetadataRequest</title>
<path fill="none" stroke="#000000" d="M596.8318,-665.1098C619.6559,-734.5286 664.4151,-835.0123 742.3115,-885.2033 807.423,-927.1566 1012.7951,-904.979 1089.5742,-915.2033 1325.1664,-946.5761 1391.6094,-931.3805 1615.8301,-1010.2033 1655.3414,-1024.0932 1697.009,-1047.7692 1725.5744,-1065.5888"/>
<polygon fill="#000000" stroke="#000000" points="1724.0463,-1068.7634 1734.3692,-1071.1487 1727.7869,-1062.8467 1724.0463,-1068.7634"/>
</g>
<!-- onBrokerStartup&#45;&gt;replicaStateMachine_handleStateChanges_OnlineReplica -->
<g id="edge26" class="edge">
<title>onBrokerStartup&#45;&gt;replicaStateMachine_handleStateChanges_OnlineReplica</title>
<path fill="none" stroke="#000000" d="M686.5799,-665.2368C749.0324,-707.4321 823.9387,-758.0417 870.7504,-789.6695"/>
<polygon fill="#000000" stroke="#000000" points="868.9093,-792.6496 879.1548,-795.3479 872.8282,-786.8494 868.9093,-792.6496"/>
</g>
<!-- onBrokerStartup&#45;&gt;triggerOnlinePartitionStateChange -->
<g id="edge27" class="edge">
<title>onBrokerStartup&#45;&gt;triggerOnlinePartitionStateChange</title>
<path fill="none" stroke="#000000" d="M706.4747,-589.4817C810.2154,-587.3608 959.4246,-582.6477 1089.5742,-572.2033 1099.2774,-571.4247 1109.3288,-570.4768 1119.4077,-569.4278"/>
<polygon fill="#000000" stroke="#000000" points="1119.914,-572.8937 1129.4839,-568.3475 1119.1678,-565.9336 1119.914,-572.8937"/>
</g>
<!-- maybeResumeReassignments -->
<g id="node36" class="node">
<title>maybeResumeReassignments</title>
<polygon fill="none" stroke="#000000" points="824.7358,-343.6034 824.7358,-412.8033 1007.1499,-412.8033 1007.1499,-343.6034 824.7358,-343.6034"/>
<text text-anchor="middle" x="915.9429" y="-397.6033" font-family="Times,serif" font-size="14.00" fill="#000000">maybeResumeReassignments</text>
<polyline fill="none" stroke="#000000" points="824.7358,-390.8033 1007.1499,-390.8033 "/>
<text text-anchor="start" x="832.7358" y="-375.6033" font-family="Times,serif" font-size="14.00" fill="#000000">判断partition是否在迁移中</text>
<text text-anchor="start" x="832.7358" y="-356.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 触发partition迁移</text>
</g>
<!-- onBrokerStartup&#45;&gt;maybeResumeReassignments -->
<g id="edge28" class="edge">
<title>onBrokerStartup&#45;&gt;maybeResumeReassignments</title>
<path fill="none" stroke="#000000" d="M666.5264,-517.3693C690.4831,-499.0323 716.8212,-480.0953 742.3115,-464.2033 769.4864,-447.2611 800.4609,-431.0269 828.6512,-417.317"/>
<polygon fill="#000000" stroke="#000000" points="830.2091,-420.4515 837.6977,-412.9568 827.1698,-414.1457 830.2091,-420.4515"/>
</g>
<!-- registerBrokerModificationsHandler -->
<g id="node37" class="node">
<title>registerBrokerModificationsHandler</title>
<polygon fill="none" stroke="#000000" points="1025.6677,-1017.2033 806.2181,-1017.2033 806.2181,-981.2033 1025.6677,-981.2033 1025.6677,-1017.2033"/>
<text text-anchor="middle" x="915.9429" y="-995.0033" font-family="Times,serif" font-size="14.00" fill="#000000">registerBrokerModificationsHandler</text>
</g>
<!-- onBrokerStartup&#45;&gt;registerBrokerModificationsHandler -->
<g id="edge29" class="edge">
<title>onBrokerStartup&#45;&gt;registerBrokerModificationsHandler</title>
<path fill="none" stroke="#000000" d="M604.6082,-665.0102C644.5479,-770.0554 716.4936,-952.2548 742.3115,-972.2033 757.9032,-984.2504 776.6796,-991.9373 796.0414,-996.6972"/>
<polygon fill="#000000" stroke="#000000" points="795.3738,-1000.134 805.8924,-998.866 796.8789,-993.2977 795.3738,-1000.134"/>
</g>
<!-- onControllerFailover -->
<g id="node31" class="node">
<title>onControllerFailover</title>
<polygon fill="none" stroke="#000000" points="137.3971,-990.2033 2.9964,-990.2033 2.9964,-954.2033 137.3971,-954.2033 137.3971,-990.2033"/>
<text text-anchor="middle" x="70.1968" y="-968.0033" font-family="Times,serif" font-size="14.00" fill="#000000">onControllerFailover</text>
</g>
<!-- registerZNodeChildChangeHandler -->
<g id="node32" class="node">
<title>registerZNodeChildChangeHandler</title>
<polygon fill="none" stroke="#000000" points="401.8736,-990.2033 186.2172,-990.2033 186.2172,-954.2033 401.8736,-954.2033 401.8736,-990.2033"/>
<text text-anchor="middle" x="294.0454" y="-968.0033" font-family="Times,serif" font-size="14.00" fill="#000000">registerZNodeChildChangeHandler</text>
</g>
<!-- onControllerFailover&#45;&gt;registerZNodeChildChangeHandler -->
<g id="edge14" class="edge">
<title>onControllerFailover&#45;&gt;registerZNodeChildChangeHandler</title>
<path fill="none" stroke="#000000" d="M137.3587,-972.2033C149.5708,-972.2033 162.6341,-972.2033 175.8144,-972.2033"/>
<polygon fill="#000000" stroke="#000000" points="175.9042,-975.7034 185.9041,-972.2033 175.9041,-968.7034 175.9042,-975.7034"/>
</g>
<!-- processBrokerChange -->
<g id="node33" class="node">
<title>processBrokerChange</title>
<polygon fill="none" stroke="#000000" points="176.3936,-438.0035 176.3936,-546.4032 411.6973,-546.4032 411.6973,-438.0035 176.3936,-438.0035"/>
<text text-anchor="middle" x="294.0454" y="-531.2032" font-family="Times,serif" font-size="14.00" fill="#000000">processBrokerChange</text>
<polyline fill="none" stroke="#000000" points="176.3936,-524.4032 411.6973,-524.4032 "/>
<text text-anchor="start" x="184.3936" y="-509.2032" font-family="Times,serif" font-size="14.00" fill="#000000">从zk中获取所有的BrokerAndEpochsl</text>
<text text-anchor="start" x="184.3936" y="-489.6033" font-family="Times,serif" font-size="14.00" fill="#000000"> 和context中的作比较，</text>
<text text-anchor="start" x="184.3936" y="-470.0033" font-family="Times,serif" font-size="14.00" fill="#000000"> 计算出新增的和挂掉的</text>
<text text-anchor="start" x="184.3936" y="-450.4034" font-family="Times,serif" font-size="14.00" fill="#000000"> 然后分别处理</text>
</g>
<!-- processBrokerChange&#45;&gt;liveOrShuttingDownBrokerIds -->
<g id="edge16" class="edge">
<title>processBrokerChange&#45;&gt;liveOrShuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M411.832,-496.0426C501.2751,-493.004 622.7291,-475.3914 706.3115,-410.2033 735.7834,-387.2175 711.1706,-354.8717 742.3115,-334.2033 823.2552,-280.4807 1539.3017,-356.0483 1615.8301,-296.2033 1660.3638,-261.3781 1610.963,-213.2665 1651.8301,-174.2033 1653.7492,-172.3689 1655.7723,-170.653 1657.8829,-169.0483"/>
<polygon fill="#000000" stroke="#000000" points="1660.0168,-171.8332 1666.4229,-163.3944 1656.1525,-165.9964 1660.0168,-171.8332"/>
</g>
<!-- processBrokerChange&#45;&gt;addLiveBrokersAndEpochs -->
<g id="edge17" class="edge">
<title>processBrokerChange&#45;&gt;addLiveBrokersAndEpochs</title>
<path fill="none" stroke="#000000" d="M341.524,-437.7052C371.4088,-403.9001 411.117,-359.8797 447.6973,-322.2033 474.8918,-294.1939 506.5037,-263.8419 531.6641,-240.1777"/>
<polygon fill="#000000" stroke="#000000" points="534.3547,-242.4527 539.2533,-233.0583 529.5655,-237.3474 534.3547,-242.4527"/>
</g>
<!-- processBrokerChange&#45;&gt;removeLiveBrokers -->
<g id="edge18" class="edge">
<title>processBrokerChange&#45;&gt;removeLiveBrokers</title>
<path fill="none" stroke="#000000" d="M307.1683,-437.8736C326.9866,-365.5894 370.6703,-237.2746 447.6973,-154.2033 458.801,-142.2283 472.3958,-131.8138 486.5518,-122.9254"/>
<polygon fill="#000000" stroke="#000000" points="488.6576,-125.7431 495.4212,-117.588 485.0483,-119.7453 488.6576,-125.7431"/>
</g>
<!-- processBrokerChange&#45;&gt;controllerChannelManager_removeBroker -->
<g id="edge19" class="edge">
<title>processBrokerChange&#45;&gt;controllerChannelManager_removeBroker</title>
<path fill="none" stroke="#000000" d="M311.1294,-546.4964C335.8658,-626.5515 381.9436,-781.263 411.6973,-915.2033 432.7074,-1009.7837 382.6421,-1058.4072 447.6973,-1130.2033 456.1379,-1139.5186 466.7786,-1146.4606 478.3141,-1151.6161"/>
<polygon fill="#000000" stroke="#000000" points="477.1474,-1154.9189 487.7322,-1155.379 479.7445,-1148.4185 477.1474,-1154.9189"/>
</g>
<!-- processBrokerChange&#45;&gt;controllerChannelManager_addBroker -->
<g id="edge20" class="edge">
<title>processBrokerChange&#45;&gt;controllerChannelManager_addBroker</title>
<path fill="none" stroke="#000000" d="M309.5822,-546.5154C332.4839,-626.9152 376.404,-782.4178 411.6973,-915.2033 428.4217,-978.1264 402.6981,-1010.1492 447.6973,-1057.2033 457.2171,-1067.1579 469.1764,-1074.5975 481.9544,-1080.1522"/>
<polygon fill="#000000" stroke="#000000" points="480.7936,-1083.4568 491.3803,-1083.8728 483.3637,-1076.9457 480.7936,-1083.4568"/>
</g>
<!-- processBrokerChange&#45;&gt;onBrokerFailure -->
<g id="edge21" class="edge">
<title>processBrokerChange&#45;&gt;onBrokerFailure</title>
<path fill="none" stroke="#000000" d="M398.7516,-437.9487C415.0096,-430.0435 431.7125,-422.2153 447.6973,-415.2033 455.8505,-411.6268 464.3552,-408.0582 472.9383,-404.5702"/>
<polygon fill="#000000" stroke="#000000" points="474.296,-407.7967 482.2699,-400.8205 471.6859,-401.3015 474.296,-407.7967"/>
</g>
<!-- processBrokerChange&#45;&gt;onBrokerStartup -->
<g id="edge22" class="edge">
<title>processBrokerChange&#45;&gt;onBrokerStartup</title>
<path fill="none" stroke="#000000" d="M411.9965,-533.4714C420.4802,-536.4396 429.08,-539.4484 437.6692,-542.4536"/>
<polygon fill="#000000" stroke="#000000" points="436.7607,-545.8437 447.3555,-545.8426 439.0725,-539.2364 436.7607,-545.8437"/>
</g>
<!-- getAllBrokerAndEpochsInCluster -->
<g id="node34" class="node">
<title>getAllBrokerAndEpochsInCluster</title>
<polygon fill="none" stroke="#000000" points="461.2974,-927.4034 461.2974,-977.0033 692.7114,-977.0033 692.7114,-927.4034 461.2974,-927.4034"/>
<text text-anchor="middle" x="577.0044" y="-961.8033" font-family="Times,serif" font-size="14.00" fill="#000000">getAllBrokerAndEpochsInCluster</text>
<polyline fill="none" stroke="#000000" points="461.2974,-955.0033 692.7114,-955.0033 "/>
<text text-anchor="start" x="469.2974" y="-939.8033" font-family="Times,serif" font-size="14.00" fill="#000000">从zk中获取所有的BrokerAndEpochs</text>
</g>
<!-- processBrokerChange&#45;&gt;getAllBrokerAndEpochsInCluster -->
<g id="edge23" class="edge">
<title>processBrokerChange&#45;&gt;getAllBrokerAndEpochsInCluster</title>
<path fill="none" stroke="#000000" d="M327.6157,-546.7778C386.8188,-643.023 508.089,-840.1691 556.4397,-918.7717"/>
<polygon fill="#000000" stroke="#000000" points="553.4767,-920.6351 561.6972,-927.3188 559.439,-916.9675 553.4767,-920.6351"/>
</g>
<!-- brokerChangeHandler -->
<g id="node35" class="node">
<title>brokerChangeHandler</title>
<polygon fill="none" stroke="#000000" points="140.5909,-510.2033 -.1973,-510.2033 -.1973,-474.2033 140.5909,-474.2033 140.5909,-510.2033"/>
<text text-anchor="middle" x="70.1968" y="-488.0033" font-family="Times,serif" font-size="14.00" fill="#000000">brokerChangeHandler</text>
</g>
<!-- brokerChangeHandler&#45;&gt;processBrokerChange -->
<g id="edge15" class="edge">
<title>brokerChangeHandler&#45;&gt;processBrokerChange</title>
<path fill="none" stroke="#000000" d="M140.4097,-492.2033C148.6116,-492.2033 157.1623,-492.2033 165.8465,-492.2033"/>
<polygon fill="#000000" stroke="#000000" points="166.0895,-495.7034 176.0895,-492.2033 166.0895,-488.7034 166.0895,-495.7034"/>
</g>
<!-- maybeResumeReassignments&#45;&gt;partitionsBeingReassigned -->
<g id="edge44" class="edge">
<title>maybeResumeReassignments&#45;&gt;partitionsBeingReassigned</title>
<path fill="none" stroke="#000000" d="M1007.2428,-355.118C1034.1451,-347.321 1063.3813,-337.8553 1089.5742,-327.2033 1122.1566,-313.953 1157.0384,-295.644 1184.4763,-280.2039"/>
<polygon fill="#000000" stroke="#000000" points="1186.515,-283.0712 1193.4819,-275.0891 1183.0579,-276.9844 1186.515,-283.0712"/>
</g>
<!-- onPartitionReassignment -->
<g id="node41" class="node">
<title>onPartitionReassignment</title>
<polygon fill="none" stroke="#000000" points="1313.3195,-367.2033 1156.7879,-367.2033 1156.7879,-331.2033 1313.3195,-331.2033 1313.3195,-367.2033"/>
<text text-anchor="middle" x="1235.0537" y="-345.0033" font-family="Times,serif" font-size="14.00" fill="#000000">onPartitionReassignment</text>
</g>
<!-- maybeResumeReassignments&#45;&gt;onPartitionReassignment -->
<g id="edge45" class="edge">
<title>maybeResumeReassignments&#45;&gt;onPartitionReassignment</title>
<path fill="none" stroke="#000000" d="M1007.3872,-369.8931C1051.1283,-365.918 1103.277,-361.1789 1146.6212,-357.2399"/>
<polygon fill="#000000" stroke="#000000" points="1146.9395,-360.7255 1156.5817,-356.3347 1146.306,-353.7542 1146.9395,-360.7255"/>
</g>
<!-- processBrokerModification -->
<g id="node42" class="node">
<title>processBrokerModification</title>
<polygon fill="none" stroke="#000000" points="1319.7472,-1009.2033 1150.3602,-1009.2033 1150.3602,-973.2033 1319.7472,-973.2033 1319.7472,-1009.2033"/>
<text text-anchor="middle" x="1235.0537" y="-987.0033" font-family="Times,serif" font-size="14.00" fill="#000000">processBrokerModification</text>
</g>
<!-- registerBrokerModificationsHandler&#45;&gt;processBrokerModification -->
<g id="edge51" class="edge">
<title>registerBrokerModificationsHandler&#45;&gt;processBrokerModification</title>
<path fill="none" stroke="#000000" d="M1025.7627,-996.4502C1063.0062,-995.5165 1104.2668,-994.4821 1140.24,-993.5803"/>
<polygon fill="#000000" stroke="#000000" points="1140.3293,-997.0792 1150.2384,-993.3296 1140.1538,-990.0814 1140.3293,-997.0792"/>
</g>
<!-- partitionsWithoutLeader&#45;&gt;partitionLeadershipInfo -->
<g id="edge41" class="edge">
<title>partitionsWithoutLeader&#45;&gt;partitionLeadershipInfo</title>
<path fill="none" stroke="#000000" d="M1311.7351,-480.3662C1324.1105,-476.6298 1335.7284,-470.6206 1344.5332,-461.2033 1428.1157,-371.8068 1298.1779,-278.7317 1380.5332,-188.2033 1389.467,-178.383 1401.1839,-171.7696 1413.7594,-167.3773"/>
<polygon fill="#000000" stroke="#000000" points="1414.9486,-170.6744 1423.5114,-164.4351 1412.9267,-163.9727 1414.9486,-170.6744"/>
</g>
<!-- partitionsWithoutLeader&#45;&gt;isReplicaOnline -->
<g id="edge42" class="edge">
<title>partitionsWithoutLeader&#45;&gt;isReplicaOnline</title>
<path fill="none" stroke="#000000" d="M1311.6231,-480.6048C1324.0867,-476.8598 1335.7645,-470.7861 1344.5332,-461.2033 1443.2371,-353.3362 1283.3098,-243.4068 1380.5332,-134.2033 1394.2421,-118.8053 1414.7889,-111.2545 1434.8936,-107.7938"/>
<polygon fill="#000000" stroke="#000000" points="1435.5952,-111.2297 1445.0107,-106.3718 1434.6209,-104.2978 1435.5952,-111.2297"/>
</g>
<!-- isTopicQueuedUpForDeletion -->
<g id="node40" class="node">
<title>isTopicQueuedUpForDeletion</title>
<polygon fill="none" stroke="#000000" points="1591.0013,-501.2033 1405.362,-501.2033 1405.362,-465.2033 1591.0013,-465.2033 1591.0013,-501.2033"/>
<text text-anchor="middle" x="1498.1816" y="-479.0033" font-family="Times,serif" font-size="14.00" fill="#000000">isTopicQueuedUpForDeletion</text>
</g>
<!-- partitionsWithoutLeader&#45;&gt;isTopicQueuedUpForDeletion -->
<g id="edge43" class="edge">
<title>partitionsWithoutLeader&#45;&gt;isTopicQueuedUpForDeletion</title>
<path fill="none" stroke="#000000" d="M1311.8685,-483.2033C1337.9428,-483.2033 1367.509,-483.2033 1395.2837,-483.2033"/>
<polygon fill="#000000" stroke="#000000" points="1395.4256,-486.7034 1405.4256,-483.2033 1395.4256,-479.7034 1395.4256,-486.7034"/>
</g>
<!-- processBrokerModification&#45;&gt;updateBrokerMetadata -->
<g id="edge52" class="edge">
<title>processBrokerModification&#45;&gt;updateBrokerMetadata</title>
<path fill="none" stroke="#000000" d="M1319.8675,-986.0892C1329.2435,-982.2804 1337.8122,-976.8467 1344.5332,-969.2033 1419.9973,-883.3828 1345.0388,-564.8318 1380.5332,-456.2033 1401.1799,-393.0153 1447.7929,-329.6761 1475.7507,-295.3515"/>
<polygon fill="#000000" stroke="#000000" points="1478.7583,-297.2063 1482.4295,-287.2678 1473.3619,-292.7477 1478.7583,-297.2063"/>
</g>
<!-- getBroker -->
<g id="node43" class="node">
<title>getBroker</title>
<polygon fill="none" stroke="#000000" points="1534.1611,-1055.2033 1462.2021,-1055.2033 1462.2021,-1019.2033 1534.1611,-1019.2033 1534.1611,-1055.2033"/>
<text text-anchor="middle" x="1498.1816" y="-1033.0033" font-family="Times,serif" font-size="14.00" fill="#000000">getBroker</text>
</g>
<!-- processBrokerModification&#45;&gt;getBroker -->
<g id="edge53" class="edge">
<title>processBrokerModification&#45;&gt;getBroker</title>
<path fill="none" stroke="#000000" d="M1319.7574,-1006.0112C1363.7014,-1013.6935 1415.6684,-1022.7784 1452.1496,-1029.156"/>
<polygon fill="#000000" stroke="#000000" points="1451.5556,-1032.6052 1462.0089,-1030.8796 1452.7611,-1025.7098 1451.5556,-1032.6052"/>
</g>
<!-- onBrokerUpdate -->
<g id="node44" class="node">
<title>onBrokerUpdate</title>
<polygon fill="none" stroke="#000000" points="1552.9858,-1001.2033 1443.3775,-1001.2033 1443.3775,-965.2033 1552.9858,-965.2033 1552.9858,-1001.2033"/>
<text text-anchor="middle" x="1498.1816" y="-979.0033" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerUpdate</text>
</g>
<!-- processBrokerModification&#45;&gt;onBrokerUpdate -->
<g id="edge54" class="edge">
<title>processBrokerModification&#45;&gt;onBrokerUpdate</title>
<path fill="none" stroke="#000000" d="M1319.7574,-988.6281C1356.5182,-987.5104 1398.8936,-986.222 1433.1211,-985.1814"/>
<polygon fill="#000000" stroke="#000000" points="1433.5777,-988.6692 1443.4666,-984.8669 1433.3649,-981.6725 1433.5777,-988.6692"/>
</g>
<!-- onBrokerUpdate&#45;&gt;sendUpdateMetadataRequest -->
<g id="edge55" class="edge">
<title>onBrokerUpdate&#45;&gt;sendUpdateMetadataRequest</title>
<path fill="none" stroke="#000000" d="M1543.1148,-1001.3049C1588.5244,-1019.5985 1658.7205,-1047.8774 1707.169,-1067.3952"/>
<polygon fill="#000000" stroke="#000000" points="1705.9714,-1070.6861 1716.5549,-1071.1764 1708.5872,-1064.1931 1705.9714,-1070.6861"/>
</g>
</g>
</svg>
