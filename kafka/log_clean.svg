<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: logClean Pages: 1 -->
<svg width="2024pt" height="474pt"
 viewBox="0.00 0.00 2024.00 474.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 470)">
<title>logClean</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-470 2020,-470 2020,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_segment</title>
<polygon fill="none" stroke="#000000" points="1832,-59 1832,-167 2008,-167 2008,-59 1832,-59"/>
<text text-anchor="middle" x="1920" y="-147" font-family="Times,serif" font-size="20.00" fill="#000000">segment</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_log</title>
<polygon fill="none" stroke="#000000" points="642,-8 642,-292 1812,-292 1812,-8 642,-8"/>
<text text-anchor="middle" x="1227" y="-272" font-family="Times,serif" font-size="20.00" fill="#000000">log</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_logManager</title>
<polygon fill="none" stroke="#000000" points="138,-300 138,-458 887,-458 887,-300 138,-300"/>
<text text-anchor="middle" x="512.5" y="-438" font-family="Times,serif" font-size="20.00" fill="#000000">logManager</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_KafkaServer</title>
<polygon fill="none" stroke="#000000" points="0,-337 0,-419 118,-419 118,-337 0,-337"/>
<text text-anchor="middle" x="59" y="-399" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaServer</text>
</g>
<!-- segment_deleteIfExists -->
<g id="node1" class="node">
<title>segment_deleteIfExists</title>
<polygon fill="none" stroke="#000000" points="1840,-67.5 1840,-128.5 2000,-128.5 2000,-67.5 1840,-67.5"/>
<text text-anchor="middle" x="1920" y="-113.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteIfExists</text>
<polyline fill="none" stroke="#000000" points="1840,-105.5 2000,-105.5 "/>
<text text-anchor="start" x="1848" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#000000">删除log，offsetIndex,</text>
<text text-anchor="middle" x="1920" y="-75.3" font-family="Times,serif" font-size="14.00" fill="#000000"> timeIndex, txnIndex文件</text>
</g>
<!-- log_delete -->
<g id="node2" class="node">
<title>log_delete</title>
<polygon fill="none" stroke="#000000" points="650,-180.5 650,-241.5 856,-241.5 856,-180.5 650,-180.5"/>
<text text-anchor="middle" x="753" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#000000">delete</text>
<polyline fill="none" stroke="#000000" points="650,-218.5 856,-218.5 "/>
<text text-anchor="start" x="658" y="-203.3" font-family="Times,serif" font-size="14.00" fill="#000000">完全删除该log目录</text>
<text text-anchor="middle" x="753" y="-188.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 删除文件时候，采用同步方法</text>
</g>
<!-- removeAndDeleteSegments -->
<g id="node3" class="node">
<title>removeAndDeleteSegments</title>
<polygon fill="none" stroke="#000000" points="1384,-101.5 1384,-162.5 1637,-162.5 1637,-101.5 1384,-101.5"/>
<text text-anchor="middle" x="1510.5" y="-147.3" font-family="Times,serif" font-size="14.00" fill="#000000">removeAndDeleteSegments</text>
<polyline fill="none" stroke="#000000" points="1384,-139.5 1637,-139.5 "/>
<text text-anchor="start" x="1392" y="-124.3" font-family="Times,serif" font-size="14.00" fill="#000000">从segments列表中删除这些segment</text>
<text text-anchor="middle" x="1510.5" y="-109.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 并删除这些segment对应的文件和index</text>
</g>
<!-- log_delete&#45;&gt;removeAndDeleteSegments -->
<g id="edge1" class="edge">
<title>log_delete&#45;&gt;removeAndDeleteSegments</title>
<path fill="none" stroke="#000000" d="M856.3432,-200.2223C990.5077,-186.2302 1225.0368,-161.7711 1373.8072,-146.2558"/>
<polygon fill="#000000" stroke="#000000" points="1374.341,-149.7192 1383.924,-145.2007 1373.6149,-142.7569 1374.341,-149.7192"/>
</g>
<!-- checkIfMemoryMappedBufferClosed -->
<g id="node6" class="node">
<title>checkIfMemoryMappedBufferClosed</title>
<polygon fill="none" stroke="#000000" points="1622,-217 1399,-217 1399,-181 1622,-181 1622,-217"/>
<text text-anchor="middle" x="1510.5" y="-195.3" font-family="Times,serif" font-size="14.00" fill="#000000">checkIfMemoryMappedBufferClosed</text>
</g>
<!-- log_delete&#45;&gt;checkIfMemoryMappedBufferClosed -->
<g id="edge2" class="edge">
<title>log_delete&#45;&gt;checkIfMemoryMappedBufferClosed</title>
<path fill="none" stroke="#000000" d="M856.3432,-209.3629C995.158,-207.1638 1241.4153,-203.2627 1388.9598,-200.9254"/>
<polygon fill="#000000" stroke="#000000" points="1389.0281,-204.4248 1398.9714,-200.7668 1388.9172,-197.4257 1389.0281,-204.4248"/>
</g>
<!-- removeLogMetrics -->
<g id="node7" class="node">
<title>removeLogMetrics</title>
<polygon fill="none" stroke="#000000" points="1093,-254 971,-254 971,-218 1093,-218 1093,-254"/>
<text text-anchor="middle" x="1032" y="-232.3" font-family="Times,serif" font-size="14.00" fill="#000000">removeLogMetrics</text>
</g>
<!-- log_delete&#45;&gt;removeLogMetrics -->
<g id="edge3" class="edge">
<title>log_delete&#45;&gt;removeLogMetrics</title>
<path fill="none" stroke="#000000" d="M856.0966,-220.238C890.8337,-223.3507 928.8088,-226.7535 960.5555,-229.5982"/>
<polygon fill="#000000" stroke="#000000" points="960.3595,-233.0945 970.632,-230.5011 960.9843,-226.1225 960.3595,-233.0945"/>
</g>
<!-- deleteSegmentFiles -->
<g id="node4" class="node">
<title>deleteSegmentFiles</title>
<polygon fill="none" stroke="#000000" points="1673,-67.5 1673,-128.5 1804,-128.5 1804,-67.5 1673,-67.5"/>
<text text-anchor="middle" x="1738.5" y="-113.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteSegmentFiles</text>
<polyline fill="none" stroke="#000000" points="1673,-105.5 1804,-105.5 "/>
<text text-anchor="start" x="1681" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#000000">删除文件可以同步</text>
<text text-anchor="start" x="1681" y="-75.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 或者异步的删除</text>
</g>
<!-- removeAndDeleteSegments&#45;&gt;deleteSegmentFiles -->
<g id="edge13" class="edge">
<title>removeAndDeleteSegments&#45;&gt;deleteSegmentFiles</title>
<path fill="none" stroke="#000000" d="M1637.1681,-113.1109C1645.9124,-111.8069 1654.5561,-110.5179 1662.8899,-109.2752"/>
<polygon fill="#000000" stroke="#000000" points="1663.5131,-112.721 1672.8875,-107.7843 1662.4806,-105.7976 1663.5131,-112.721"/>
</g>
<!-- segments -->
<g id="node13" class="node">
<title>segments</title>
<polygon fill="#95e1d3" stroke="#000000" points="1772.5,-183 1708.5,-183 1704.5,-179 1704.5,-147 1768.5,-147 1772.5,-151 1772.5,-183"/>
<polyline fill="none" stroke="#000000" points="1768.5,-179 1704.5,-179 "/>
<polyline fill="none" stroke="#000000" points="1768.5,-179 1768.5,-147 "/>
<polyline fill="none" stroke="#000000" points="1768.5,-179 1772.5,-183 "/>
<text text-anchor="middle" x="1738.5" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#000000">segments</text>
</g>
<!-- removeAndDeleteSegments&#45;&gt;segments -->
<g id="edge14" class="edge">
<title>removeAndDeleteSegments&#45;&gt;segments</title>
<path fill="none" stroke="#ff0000" d="M1637.1681,-150.3335C1657.7093,-153.3066 1677.695,-156.1993 1694.413,-158.619"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1693.9775,-162.0923 1704.3757,-160.061 1694.9802,-155.1645 1693.9775,-162.0923"/>
</g>
<!-- deleteSegmentFiles&#45;&gt;segment_deleteIfExists -->
<g id="edge15" class="edge">
<title>deleteSegmentFiles&#45;&gt;segment_deleteIfExists</title>
<path fill="none" stroke="#000000" d="M1804.0257,-98C1812.3456,-98 1820.9728,-98 1829.5958,-98"/>
<polygon fill="#000000" stroke="#000000" points="1829.698,-101.5001 1839.698,-98 1829.6979,-94.5001 1829.698,-101.5001"/>
</g>
<!-- deleteSegments -->
<g id="node5" class="node">
<title>deleteSegments</title>
<polygon fill="none" stroke="#000000" points="1185,-77.5 1185,-138.5 1348,-138.5 1348,-77.5 1185,-77.5"/>
<text text-anchor="middle" x="1266.5" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteSegments</text>
<polyline fill="none" stroke="#000000" points="1185,-115.5 1348,-115.5 "/>
<text text-anchor="start" x="1193" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#000000">删除segmentsfile时候</text>
<text text-anchor="start" x="1193" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 采用后台线程异步删除</text>
</g>
<!-- deleteSegments&#45;&gt;removeAndDeleteSegments -->
<g id="edge10" class="edge">
<title>deleteSegments&#45;&gt;removeAndDeleteSegments</title>
<path fill="none" stroke="#000000" d="M1348.0877,-116.025C1356.3525,-116.8379 1364.8962,-117.6783 1373.5417,-118.5287"/>
<polygon fill="#000000" stroke="#000000" points="1373.4322,-122.0347 1383.7268,-119.5305 1374.1175,-115.0683 1373.4322,-122.0347"/>
</g>
<!-- deleteSegments&#45;&gt;checkIfMemoryMappedBufferClosed -->
<g id="edge11" class="edge">
<title>deleteSegments&#45;&gt;checkIfMemoryMappedBufferClosed</title>
<path fill="none" stroke="#000000" d="M1315.0316,-138.5425C1335.6564,-150.4217 1360.3638,-163.2509 1384,-172 1389.9429,-174.1998 1396.1126,-176.2427 1402.387,-178.1365"/>
<polygon fill="#000000" stroke="#000000" points="1401.7376,-181.5915 1412.3154,-180.991 1403.6719,-174.8641 1401.7376,-181.5915"/>
</g>
<!-- maybeIncrementLogStartOffset -->
<g id="node12" class="node">
<title>maybeIncrementLogStartOffset</title>
<polygon fill="none" stroke="#000000" points="1605.5,-83 1415.5,-83 1415.5,-47 1605.5,-47 1605.5,-83"/>
<text text-anchor="middle" x="1510.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeIncrementLogStartOffset</text>
</g>
<!-- deleteSegments&#45;&gt;maybeIncrementLogStartOffset -->
<g id="edge12" class="edge">
<title>deleteSegments&#45;&gt;maybeIncrementLogStartOffset</title>
<path fill="none" stroke="#000000" d="M1348.0877,-93.6218C1366.4919,-90.3785 1386.2793,-86.8914 1405.4932,-83.5053"/>
<polygon fill="#000000" stroke="#000000" points="1406.2374,-86.9282 1415.4782,-81.7456 1405.0225,-80.0344 1406.2374,-86.9282"/>
</g>
<!-- deleteOldSegments -->
<g id="node8" class="node">
<title>deleteOldSegments</title>
<polygon fill="none" stroke="#000000" points="814,-133 692,-133 692,-97 814,-97 814,-133"/>
<text text-anchor="middle" x="753" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteOldSegments</text>
</g>
<!-- deleteRetentionMsBreachedSegments -->
<g id="node9" class="node">
<title>deleteRetentionMsBreachedSegments</title>
<polygon fill="none" stroke="#000000" points="1144,-52 920,-52 920,-16 1144,-16 1144,-52"/>
<text text-anchor="middle" x="1032" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteRetentionMsBreachedSegments</text>
</g>
<!-- deleteOldSegments&#45;&gt;deleteRetentionMsBreachedSegments -->
<g id="edge4" class="edge">
<title>deleteOldSegments&#45;&gt;deleteRetentionMsBreachedSegments</title>
<path fill="none" stroke="#000000" d="M802.97,-96.9773C834.8009,-85.8376 877.0442,-71.6795 915,-61 922.9328,-58.768 931.2055,-56.5815 939.5241,-54.4796"/>
<polygon fill="#000000" stroke="#000000" points="940.4312,-57.8608 949.2927,-52.0535 938.7439,-51.0671 940.4312,-57.8608"/>
</g>
<!-- deleteRetentionSizeBreachedSegments -->
<g id="node10" class="node">
<title>deleteRetentionSizeBreachedSegments</title>
<polygon fill="none" stroke="#000000" points="1146.5,-106 917.5,-106 917.5,-70 1146.5,-70 1146.5,-106"/>
<text text-anchor="middle" x="1032" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteRetentionSizeBreachedSegments</text>
</g>
<!-- deleteOldSegments&#45;&gt;deleteRetentionSizeBreachedSegments -->
<g id="edge5" class="edge">
<title>deleteOldSegments&#45;&gt;deleteRetentionSizeBreachedSegments</title>
<path fill="none" stroke="#000000" d="M814.2277,-109.0747C841.6297,-106.4229 874.9891,-103.1946 907.2802,-100.0697"/>
<polygon fill="#000000" stroke="#000000" points="907.6432,-103.551 917.2595,-99.1039 906.9688,-96.5835 907.6432,-103.551"/>
</g>
<!-- deleteLogStartOffsetBreachedSegments -->
<g id="node11" class="node">
<title>deleteLogStartOffsetBreachedSegments</title>
<polygon fill="none" stroke="#000000" points="1149,-160 915,-160 915,-124 1149,-124 1149,-160"/>
<text text-anchor="middle" x="1032" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#000000">deleteLogStartOffsetBreachedSegments</text>
</g>
<!-- deleteOldSegments&#45;&gt;deleteLogStartOffsetBreachedSegments -->
<g id="edge6" class="edge">
<title>deleteOldSegments&#45;&gt;deleteLogStartOffsetBreachedSegments</title>
<path fill="none" stroke="#000000" d="M814.2277,-120.9253C840.8603,-123.5026 873.1204,-126.6246 904.5576,-129.6669"/>
<polygon fill="#000000" stroke="#000000" points="904.4368,-133.1714 914.7274,-130.651 905.1111,-126.204 904.4368,-133.1714"/>
</g>
<!-- deleteRetentionMsBreachedSegments&#45;&gt;deleteSegments -->
<g id="edge7" class="edge">
<title>deleteRetentionMsBreachedSegments&#45;&gt;deleteSegments</title>
<path fill="none" stroke="#000000" d="M1117.0878,-52.0162C1127.8975,-54.7787 1138.7553,-57.7899 1149,-61 1160.9111,-64.7322 1173.3223,-69.1227 1185.4252,-73.6954"/>
<polygon fill="#000000" stroke="#000000" points="1184.4598,-77.0739 1195.0498,-77.3926 1186.97,-70.5394 1184.4598,-77.0739"/>
</g>
<!-- deleteRetentionSizeBreachedSegments&#45;&gt;deleteSegments -->
<g id="edge8" class="edge">
<title>deleteRetentionSizeBreachedSegments&#45;&gt;deleteSegments</title>
<path fill="none" stroke="#000000" d="M1146.5022,-97.7656C1155.9794,-98.5739 1165.4806,-99.3843 1174.7578,-100.1755"/>
<polygon fill="#000000" stroke="#000000" points="1174.4638,-103.663 1184.7251,-101.0256 1175.0587,-96.6884 1174.4638,-103.663"/>
</g>
<!-- deleteLogStartOffsetBreachedSegments&#45;&gt;deleteSegments -->
<g id="edge9" class="edge">
<title>deleteLogStartOffsetBreachedSegments&#45;&gt;deleteSegments</title>
<path fill="none" stroke="#000000" d="M1149.25,-125C1157.7974,-123.7607 1166.3448,-122.5214 1174.7105,-121.3085"/>
<polygon fill="#000000" stroke="#000000" points="1175.4182,-124.7426 1184.8125,-119.8438 1174.4137,-117.815 1175.4182,-124.7426"/>
</g>
<!-- logManager_startup -->
<g id="node14" class="node">
<title>logManager_startup</title>
<polygon fill="none" stroke="#000000" points="200,-381 146,-381 146,-345 200,-345 200,-381"/>
<text text-anchor="middle" x="173" y="-359.3" font-family="Times,serif" font-size="14.00" fill="#000000">startup</text>
</g>
<!-- scheduler_schedule -->
<g id="node15" class="node">
<title>scheduler_schedule</title>
<polygon fill="none" stroke="#000000" points="236,-340 236,-386 367,-386 367,-340 236,-340"/>
<text text-anchor="middle" x="301.5" y="-370.8" font-family="Times,serif" font-size="14.00" fill="#000000">scheduler.schedule</text>
<polyline fill="none" stroke="#000000" points="236,-363 367,-363 "/>
<text text-anchor="start" x="244" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#000000">后台启动定时任务</text>
</g>
<!-- logManager_startup&#45;&gt;scheduler_schedule -->
<g id="edge16" class="edge">
<title>logManager_startup&#45;&gt;scheduler_schedule</title>
<path fill="none" stroke="#000000" d="M200.2515,-363C207.9882,-363 216.8107,-363 225.948,-363"/>
<polygon fill="#000000" stroke="#000000" points="225.9501,-366.5001 235.9501,-363 225.9501,-359.5001 225.9501,-366.5001"/>
</g>
<!-- cleanupLogs -->
<g id="node16" class="node">
<title>cleanupLogs</title>
<polygon fill="none" stroke="#000000" points="446,-308 446,-354 548,-354 548,-308 446,-308"/>
<text text-anchor="middle" x="497" y="-338.8" font-family="Times,serif" font-size="14.00" fill="#000000">cleanupLogs</text>
<polyline fill="none" stroke="#000000" points="446,-331 548,-331 "/>
<text text-anchor="start" x="454" y="-315.8" font-family="Times,serif" font-size="14.00" fill="#000000">清理过期日志</text>
</g>
<!-- scheduler_schedule&#45;&gt;cleanupLogs -->
<g id="edge17" class="edge">
<title>scheduler_schedule&#45;&gt;cleanupLogs</title>
<path fill="none" stroke="#000000" d="M367.1425,-352.2554C389.2634,-348.6346 413.8522,-344.6099 435.6306,-341.0451"/>
<polygon fill="#000000" stroke="#000000" points="436.4422,-344.4589 445.7454,-339.3895 435.3114,-337.5509 436.4422,-344.4589"/>
</g>
<!-- deleteLogs -->
<g id="node17" class="node">
<title>deleteLogs</title>
<polygon fill="none" stroke="#000000" points="403,-373 403,-419 591,-419 591,-373 403,-373"/>
<text text-anchor="middle" x="497" y="-403.8" font-family="Times,serif" font-size="14.00" fill="#000000">deleteLogs</text>
<polyline fill="none" stroke="#000000" points="403,-396 591,-396 "/>
<text text-anchor="start" x="411" y="-380.8" font-family="Times,serif" font-size="14.00" fill="#000000">定时删除标记为删除的日志</text>
</g>
<!-- scheduler_schedule&#45;&gt;deleteLogs -->
<g id="edge18" class="edge">
<title>scheduler_schedule&#45;&gt;deleteLogs</title>
<path fill="none" stroke="#000000" d="M367.1425,-374.0803C375.3546,-375.4665 383.9068,-376.9101 392.5291,-378.3655"/>
<polygon fill="#000000" stroke="#000000" points="392.2238,-381.8634 402.6669,-380.0768 393.389,-374.9611 392.2238,-381.8634"/>
</g>
<!-- cleanupLogs&#45;&gt;deleteOldSegments -->
<g id="edge19" class="edge">
<title>cleanupLogs&#45;&gt;deleteOldSegments</title>
<path fill="none" stroke="#000000" d="M510.6908,-307.9873C531.8734,-274.0557 575.5603,-210.3775 627,-171 645.2968,-156.9937 667.6482,-145.6029 688.4183,-136.8411"/>
<polygon fill="#000000" stroke="#000000" points="689.8935,-140.0194 697.8297,-133.0004 687.2486,-133.5382 689.8935,-140.0194"/>
</g>
<!-- pauseCleaningForNonCompactedPartitions -->
<g id="node18" class="node">
<title>pauseCleaningForNonCompactedPartitions</title>
<polygon fill="none" stroke="#000000" points="879,-349 627,-349 627,-313 879,-313 879,-349"/>
<text text-anchor="middle" x="753" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#000000">pauseCleaningForNonCompactedPartitions</text>
</g>
<!-- cleanupLogs&#45;&gt;pauseCleaningForNonCompactedPartitions -->
<g id="edge20" class="edge">
<title>cleanupLogs&#45;&gt;pauseCleaningForNonCompactedPartitions</title>
<path fill="none" stroke="#000000" d="M548.1901,-331C568.2603,-331 592.3284,-331 616.798,-331"/>
<polygon fill="#000000" stroke="#000000" points="616.9255,-334.5001 626.9255,-331 616.9254,-327.5001 616.9255,-334.5001"/>
</g>
<!-- deleteLogs&#45;&gt;log_delete -->
<g id="edge21" class="edge">
<title>deleteLogs&#45;&gt;log_delete</title>
<path fill="none" stroke="#000000" d="M578.6809,-372.7899C583.047,-370.1629 587.1957,-367.2436 591,-364 617.0219,-341.8134 604.1419,-321.434 627,-296 643.9751,-277.112 665.9945,-260.4124 686.8665,-246.9253"/>
<polygon fill="#000000" stroke="#000000" points="688.8205,-249.8309 695.4121,-241.5362 685.0866,-243.91 688.8205,-249.8309"/>
</g>
<!-- startup -->
<g id="node19" class="node">
<title>startup</title>
<polygon fill="none" stroke="#000000" points="86,-381 32,-381 32,-345 86,-345 86,-381"/>
<text text-anchor="middle" x="59" y="-359.3" font-family="Times,serif" font-size="14.00" fill="#000000">startup</text>
</g>
<!-- startup&#45;&gt;logManager_startup -->
<g id="edge22" class="edge">
<title>startup&#45;&gt;logManager_startup</title>
<path fill="none" stroke="#000000" d="M86.0164,-363C100.8155,-363 119.3844,-363 135.5611,-363"/>
<polygon fill="#000000" stroke="#000000" points="135.7825,-366.5001 145.7824,-363 135.7824,-359.5001 135.7825,-366.5001"/>
</g>
</g>
</svg>
