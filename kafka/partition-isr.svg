<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: partition_isr Pages: 1 -->
<svg width="3533pt" height="1336pt"
 viewBox="0.00 0.00 3533.00 1336.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1332)">
<title>partition_isr</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1332 3529,-1332 3529,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_zk</title>
<polygon fill="none" stroke="#000000" points="3363,-359 3363,-521 3517,-521 3517,-359 3363,-359"/>
<text text-anchor="middle" x="3440" y="-501" font-family="Times,serif" font-size="20.00" fill="#000000">zk server</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KafkaZkClient</title>
<polygon fill="none" stroke="#000000" points="2999.5,-348 2999.5,-430 3343,-430 3343,-348 2999.5,-348"/>
<text text-anchor="middle" x="3171.25" y="-410" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaZkClient</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_replicaManager</title>
<polygon fill="none" stroke="#000000" points="215,-98 215,-272 3145,-272 3145,-98 215,-98"/>
<text text-anchor="middle" x="1680" y="-252" font-family="Times,serif" font-size="20.00" fill="#000000">replicaManager</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_ZkPartitionStateStore</title>
<polygon fill="none" stroke="#000000" points="2630.5,-280 2630.5,-416 2941.5,-416 2941.5,-280 2630.5,-280"/>
<text text-anchor="middle" x="2786" y="-396" font-family="Times,serif" font-size="20.00" fill="#000000">ZkPartitionStateStore</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_replica</title>
<polygon fill="none" stroke="#000000" points="2590.5,-1158 2590.5,-1320 3154,-1320 3154,-1158 2590.5,-1158"/>
<text text-anchor="middle" x="2872.25" y="-1300" font-family="Times,serif" font-size="20.00" fill="#000000">replica</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_Partition</title>
<polygon fill="none" stroke="#000000" points="1876,-424 1876,-1150 2969,-1150 2969,-424 1876,-424"/>
<text text-anchor="middle" x="2422.5" y="-1130" font-family="Times,serif" font-size="20.00" fill="#000000">Partition</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_fetchThread</title>
<polygon fill="none" stroke="#000000" points="752,-280 752,-404 1312,-404 1312,-280 752,-280"/>
<text text-anchor="middle" x="1032" y="-384" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaFetcher thread</text>
</g>
<g id="clust21" class="cluster">
<title>cluster_KafkaApi</title>
<polygon fill="none" stroke="#000000" points="8,-8 8,-90 1474,-90 1474,-8 8,-8"/>
<text text-anchor="middle" x="741" y="-70" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<!-- zk_partitionState -->
<g id="node1" class="node">
<title>zk_partitionState</title>
<polygon fill="#95e1d3" stroke="#000000" points="3371,-367.5 3371,-482.5 3509,-482.5 3509,-367.5 3371,-367.5"/>
<text text-anchor="middle" x="3440" y="-467.3" font-family="Times,serif" font-size="14.00" fill="#000000">partitionState</text>
<polyline fill="none" stroke="#000000" points="3371,-459.5 3509,-459.5 "/>
<text text-anchor="start" x="3379" y="-444.3" font-family="Times,serif" font-size="14.00" fill="#000000">ControllerEpoch int32</text>
<polyline fill="none" stroke="#000000" points="3371,-436.5 3509,-436.5 "/>
<text text-anchor="start" x="3379" y="-421.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader int32</text>
<polyline fill="none" stroke="#000000" points="3371,-413.5 3509,-413.5 "/>
<text text-anchor="start" x="3379" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader_epoch int32</text>
<polyline fill="none" stroke="#000000" points="3371,-390.5 3509,-390.5 "/>
<text text-anchor="start" x="3379" y="-375.3" font-family="Times,serif" font-size="14.00" fill="#000000">isr []int32</text>
</g>
<!-- updateLeaderAndIsr -->
<g id="node2" class="node">
<title>updateLeaderAndIsr</title>
<polygon fill="none" stroke="#000000" points="3135.5,-392 3007.5,-392 3007.5,-356 3135.5,-356 3135.5,-392"/>
<text text-anchor="middle" x="3071.5" y="-370.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateLeaderAndIsr</text>
</g>
<!-- setTopicAssignmentRaw -->
<g id="node3" class="node">
<title>setTopicAssignmentRaw</title>
<polygon fill="none" stroke="#000000" points="3335,-392 3182,-392 3182,-356 3335,-356 3335,-392"/>
<text text-anchor="middle" x="3258.5" y="-370.3" font-family="Times,serif" font-size="14.00" fill="#000000">setTopicAssignmentRaw</text>
</g>
<!-- updateLeaderAndIsr&#45;&gt;setTopicAssignmentRaw -->
<g id="edge1" class="edge">
<title>updateLeaderAndIsr&#45;&gt;setTopicAssignmentRaw</title>
<path fill="none" stroke="#000000" d="M3135.5932,-374C3147.2398,-374 3159.5641,-374 3171.7354,-374"/>
<polygon fill="#000000" stroke="#000000" points="3171.9052,-377.5001 3181.9051,-374 3171.9051,-370.5001 3171.9052,-377.5001"/>
</g>
<!-- setTopicAssignmentRaw&#45;&gt;zk_partitionState -->
<g id="edge2" class="edge">
<title>setTopicAssignmentRaw&#45;&gt;zk_partitionState</title>
<path fill="none" stroke="#000000" d="M3322.7455,-392.0525C3335.1787,-395.5461 3348.3394,-399.2441 3361.1761,-402.8511"/>
<polygon fill="#000000" stroke="#000000" points="3360.3379,-406.2511 3370.9119,-405.5868 3362.2316,-399.5121 3360.3379,-406.2511"/>
</g>
<!-- isrShrinkRate -->
<g id="node4" class="node">
<title>isrShrinkRate</title>
<polygon fill="none" stroke="#000000" points="2924,-234 2833,-234 2833,-198 2924,-198 2924,-234"/>
<text text-anchor="middle" x="2878.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#000000">isrShrinkRate</text>
</g>
<!-- isrExpandRate -->
<g id="node5" class="node">
<title>isrExpandRate</title>
<polygon fill="none" stroke="#000000" points="2926.5,-180 2830.5,-180 2830.5,-144 2926.5,-144 2926.5,-180"/>
<text text-anchor="middle" x="2878.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#000000">isrExpandRate</text>
</g>
<!-- recordIsrChange -->
<g id="node6" class="node">
<title>recordIsrChange</title>
<polygon fill="none" stroke="#000000" points="3125,-180 3018,-180 3018,-144 3125,-144 3125,-180"/>
<text text-anchor="middle" x="3071.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#000000">recordIsrChange</text>
</g>
<!-- failedIsrUpdatesRate -->
<g id="node7" class="node">
<title>failedIsrUpdatesRate</title>
<polygon fill="none" stroke="#000000" points="3137,-234 3006,-234 3006,-198 3137,-198 3137,-234"/>
<text text-anchor="middle" x="3071.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#000000">failedIsrUpdatesRate</text>
</g>
<!-- stateStore_expandIsr -->
<g id="node8" class="node">
<title>stateStore_expandIsr</title>
<polygon fill="none" stroke="#000000" points="2708.5,-324 2638.5,-324 2638.5,-288 2708.5,-288 2708.5,-324"/>
<text text-anchor="middle" x="2673.5" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#000000">expandIsr</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;isrExpandRate -->
<g id="edge5" class="edge">
<title>stateStore_expandIsr&#45;&gt;isrExpandRate</title>
<path fill="none" stroke="#000000" d="M2708.6257,-304.516C2725.9242,-302.0846 2746.0135,-296.4869 2760,-284 2793.682,-253.9294 2763.3477,-220.1856 2796,-189 2802.9562,-182.3562 2811.5723,-177.347 2820.588,-173.5702"/>
<polygon fill="#000000" stroke="#000000" points="2821.9088,-176.8135 2830.0753,-170.0637 2819.482,-170.2476 2821.9088,-176.8135"/>
</g>
<!-- updateFetchState -->
<g id="node11" class="node">
<title>updateFetchState</title>
<polygon fill="none" stroke="#000000" points="2933.5,-324 2823.5,-324 2823.5,-288 2933.5,-288 2933.5,-324"/>
<text text-anchor="middle" x="2878.5" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchState</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;updateFetchState -->
<g id="edge6" class="edge">
<title>stateStore_expandIsr&#45;&gt;updateFetchState</title>
<path fill="none" stroke="#000000" d="M2708.7408,-306C2737.3937,-306 2778.6011,-306 2813.241,-306"/>
<polygon fill="#000000" stroke="#000000" points="2813.2889,-309.5001 2823.2888,-306 2813.2888,-302.5001 2813.2889,-309.5001"/>
</g>
<!-- LeaderAndIsr -->
<g id="node15" class="node">
<title>LeaderAndIsr</title>
<polygon fill="#95e1d3" stroke="#000000" points="2825,-432.5 2825,-547.5 2932,-547.5 2932,-432.5 2825,-432.5"/>
<text text-anchor="middle" x="2878.5" y="-532.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsr</text>
<polyline fill="none" stroke="#000000" points="2825,-524.5 2932,-524.5 "/>
<text text-anchor="start" x="2833" y="-509.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader: Int</text>
<polyline fill="none" stroke="#000000" points="2825,-501.5 2932,-501.5 "/>
<text text-anchor="start" x="2833" y="-486.3" font-family="Times,serif" font-size="14.00" fill="#000000">leaderEpoch: Int</text>
<polyline fill="none" stroke="#000000" points="2825,-478.5 2932,-478.5 "/>
<text text-anchor="start" x="2833" y="-463.3" font-family="Times,serif" font-size="14.00" fill="#000000">isr: List[Int]</text>
<polyline fill="none" stroke="#000000" points="2825,-455.5 2932,-455.5 "/>
<text text-anchor="start" x="2833" y="-440.3" font-family="Times,serif" font-size="14.00" fill="#000000">zkVersion: Int</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;LeaderAndIsr -->
<g id="edge27" class="edge">
<title>stateStore_expandIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M2692.3477,-324.0454C2716.1901,-346.755 2758.6493,-386.806 2796,-420 2802.8053,-426.0479 2809.9909,-432.315 2817.1691,-438.5013"/>
<polygon fill="#000000" stroke="#000000" points="2815.069,-441.3112 2824.9367,-445.1684 2819.6281,-435.9995 2815.069,-441.3112"/>
</g>
<!-- stateStore_shrinkIsr -->
<g id="node9" class="node">
<title>stateStore_shrinkIsr</title>
<polygon fill="none" stroke="#000000" points="2706,-378 2641,-378 2641,-342 2706,-342 2706,-378"/>
<text text-anchor="middle" x="2673.5" y="-356.3" font-family="Times,serif" font-size="14.00" fill="#000000">shrinkIsr</text>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;isrShrinkRate -->
<g id="edge3" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;isrShrinkRate</title>
<path fill="none" stroke="#000000" d="M2706.1285,-357.7841C2723.5586,-355.1929 2744.544,-349.6741 2760,-338 2785.4261,-318.7953 2774.6553,-299.6583 2796,-276 2808.3965,-262.2598 2824.4181,-249.7401 2839.0401,-239.7337"/>
<polygon fill="#000000" stroke="#000000" points="2841.0602,-242.5936 2847.4496,-234.1422 2837.1844,-236.7645 2841.0602,-242.5936"/>
</g>
<!-- updateIsr -->
<g id="node10" class="node">
<title>updateIsr</title>
<polygon fill="none" stroke="#000000" points="2912,-378 2845,-378 2845,-342 2912,-342 2912,-378"/>
<text text-anchor="middle" x="2878.5" y="-356.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateIsr</text>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;updateIsr -->
<g id="edge4" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;updateIsr</title>
<path fill="none" stroke="#000000" d="M2706.4368,-360C2741.1976,-360 2796.1681,-360 2834.5948,-360"/>
<polygon fill="#000000" stroke="#000000" points="2834.9639,-363.5001 2844.9639,-360 2834.9639,-356.5001 2834.9639,-363.5001"/>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;LeaderAndIsr -->
<g id="edge28" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M2702.0044,-378.0759C2731.4613,-396.7559 2778.3765,-426.5071 2816.4347,-450.6415"/>
<polygon fill="#000000" stroke="#000000" points="2814.5869,-453.6142 2824.9064,-456.0138 2818.3357,-447.7026 2814.5869,-453.6142"/>
</g>
<!-- updateIsr&#45;&gt;updateLeaderAndIsr -->
<g id="edge7" class="edge">
<title>updateIsr&#45;&gt;updateLeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M2912.118,-362.4386C2935.594,-364.1415 2967.8642,-366.4824 2997.23,-368.6125"/>
<polygon fill="#000000" stroke="#000000" points="2997.2497,-372.1231 3007.4768,-369.3558 2997.7562,-365.1414 2997.2497,-372.1231"/>
</g>
<!-- updateIsr&#45;&gt;recordIsrChange -->
<g id="edge8" class="edge">
<title>updateIsr&#45;&gt;recordIsrChange</title>
<path fill="none" stroke="#000000" d="M2912.2851,-358.2926C2931.5696,-355.5072 2954.6835,-348.7913 2969,-333 3012.7917,-284.6973 2954.6213,-238.5471 2997,-189 3000.4329,-184.9864 3004.5117,-181.5694 3008.9653,-178.6602"/>
<polygon fill="#000000" stroke="#000000" points="3010.8901,-181.5944 3017.9208,-173.6686 3007.482,-175.4801 3010.8901,-181.5944"/>
</g>
<!-- updateIsr&#45;&gt;failedIsrUpdatesRate -->
<g id="edge9" class="edge">
<title>updateIsr&#45;&gt;failedIsrUpdatesRate</title>
<path fill="none" stroke="#000000" d="M2912.2235,-354.6271C2930.1225,-350.6604 2951.8902,-343.9825 2969,-333 3005.548,-309.5404 3036.6275,-269.3827 3054.6858,-242.7646"/>
<polygon fill="#000000" stroke="#000000" points="3057.6891,-244.5686 3060.2998,-234.3004 3051.8556,-240.6994 3057.6891,-244.5686"/>
</g>
<!-- Replica -->
<g id="node12" class="node">
<title>Replica</title>
<polygon fill="none" stroke="#000000" points="2997,-1166.5 2997,-1281.5 3146,-1281.5 3146,-1166.5 2997,-1166.5"/>
<text text-anchor="middle" x="3071.5" y="-1266.3" font-family="Times,serif" font-size="14.00" fill="#000000">Replica</text>
<polyline fill="none" stroke="#000000" points="2997,-1258.5 3146,-1258.5 "/>
<text text-anchor="start" x="3005" y="-1243.3" font-family="Times,serif" font-size="14.00" fill="#000000">brokerId</text>
<polyline fill="none" stroke="#000000" points="2997,-1235.5 3146,-1235.5 "/>
<text text-anchor="start" x="3005" y="-1220.3" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartition</text>
<polyline fill="none" stroke="#000000" points="2997,-1212.5 3146,-1212.5 "/>
<text text-anchor="start" x="3005" y="-1197.3" font-family="Times,serif" font-size="14.00" fill="#000000">logEndOffsetMetadata</text>
<polyline fill="none" stroke="#000000" points="2997,-1189.5 3146,-1189.5 "/>
<text text-anchor="start" x="3005" y="-1174.3" font-family="Times,serif" font-size="14.00" fill="#000000">lastSentHighWatermark</text>
</g>
<!-- replica_updateFetchState -->
<g id="node13" class="node">
<title>replica_updateFetchState</title>
<polygon fill="none" stroke="#000000" points="2618.5,-1231 2618.5,-1277 2728.5,-1277 2728.5,-1231 2618.5,-1231"/>
<text text-anchor="middle" x="2673.5" y="-1261.8" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchState</text>
<polyline fill="none" stroke="#000000" points="2618.5,-1254 2728.5,-1254 "/>
<text text-anchor="start" x="2626.5" y="-1238.8" font-family="Times,serif" font-size="14.00" fill="#000000">更新replica状态</text>
</g>
<!-- replica_updateFetchState&#45;&gt;Replica -->
<g id="edge11" class="edge">
<title>replica_updateFetchState&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M2728.8402,-1249.8286C2795.6839,-1244.7902 2908.832,-1236.2614 2986.7064,-1230.3915"/>
<polygon fill="#000000" stroke="#000000" points="2987.2663,-1233.8593 2996.9749,-1229.6175 2986.7401,-1226.8791 2987.2663,-1233.8593"/>
</g>
<!-- replica_resetLastCaughtUpTime -->
<g id="node14" class="node">
<title>replica_resetLastCaughtUpTime</title>
<polygon fill="none" stroke="#000000" points="2598.5,-1166 2598.5,-1212 2748.5,-1212 2748.5,-1166 2598.5,-1166"/>
<text text-anchor="middle" x="2673.5" y="-1196.8" font-family="Times,serif" font-size="14.00" fill="#000000">resetLastCaughtUpTime</text>
<polyline fill="none" stroke="#000000" points="2598.5,-1189 2748.5,-1189 "/>
<text text-anchor="start" x="2606.5" y="-1173.8" font-family="Times,serif" font-size="14.00" fill="#000000">更新replica状态</text>
</g>
<!-- replica_resetLastCaughtUpTime&#45;&gt;Replica -->
<g id="edge10" class="edge">
<title>replica_resetLastCaughtUpTime&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M2748.8287,-1195.6244C2816.5969,-1201.5839 2916.0671,-1210.3313 2986.6237,-1216.536"/>
<polygon fill="#000000" stroke="#000000" points="2986.5485,-1220.0428 2996.8167,-1217.4324 2987.1618,-1213.0697 2986.5485,-1220.0428"/>
</g>
<!-- LeaderAndIsr&#45;&gt;zk_partitionState -->
<g id="edge29" class="edge">
<title>LeaderAndIsr&#45;&gt;zk_partitionState</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2932.0846,-483.797C3031.3361,-472.3075 3244.2166,-447.6642 3360.3805,-434.2169"/>
<polygon fill="#000000" stroke="#000000" points="3361.0972,-437.6574 3370.6283,-433.0306 3360.2922,-430.7038 3361.0972,-437.6574"/>
</g>
<!-- remoteReplicasMap -->
<g id="node16" class="node">
<title>remoteReplicasMap</title>
<polygon fill="#95e1d3" stroke="#000000" points="2942,-668 2819,-668 2815,-664 2815,-632 2938,-632 2942,-636 2942,-668"/>
<polyline fill="none" stroke="#000000" points="2938,-664 2815,-664 "/>
<polyline fill="none" stroke="#000000" points="2938,-664 2938,-632 "/>
<polyline fill="none" stroke="#000000" points="2938,-664 2942,-668 "/>
<text text-anchor="middle" x="2878.5" y="-646.3" font-family="Times,serif" font-size="14.00" fill="#000000">remoteReplicasMap</text>
</g>
<!-- remoteReplicasMap&#45;&gt;Replica -->
<g id="edge12" class="edge">
<title>remoteReplicasMap&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M2942.0897,-659.2522C2952.2363,-663.2683 2961.7589,-668.9582 2969,-677 3031.7889,-746.7326 3058.305,-1025.5541 3067.4447,-1156.0274"/>
<polygon fill="#000000" stroke="#000000" points="3063.9727,-1156.5572 3068.1494,-1166.294 3070.9563,-1156.0778 3063.9727,-1156.5572"/>
</g>
<!-- updateAssignmentAndIsr -->
<g id="node17" class="node">
<title>updateAssignmentAndIsr</title>
<polygon fill="#f38181" stroke="#000000" points="2593,-743 2593,-819 2754,-819 2754,-743 2593,-743"/>
<text text-anchor="middle" x="2673.5" y="-803.8" font-family="Times,serif" font-size="14.00" fill="#000000">updateAssignmentAndIsr</text>
<polyline fill="none" stroke="#000000" points="2593,-796 2754,-796 "/>
<text text-anchor="start" x="2601" y="-780.8" font-family="Times,serif" font-size="14.00" fill="#000000">使用partitionState中信息</text>
<text text-anchor="start" x="2601" y="-765.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 更新topic partition 分配</text>
<text text-anchor="start" x="2601" y="-750.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 以及ISR</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;remoteReplicasMap -->
<g id="edge13" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;remoteReplicasMap</title>
<path fill="none" stroke="#ff0000" d="M2754.2651,-743.9459C2756.2481,-742.3523 2758.165,-740.7039 2760,-739 2783.3497,-717.3182 2771.2337,-697.0484 2796,-677 2799.0748,-674.5109 2802.3865,-672.2484 2805.8541,-670.1922"/>
<polygon fill="#ff0000" stroke="#ff0000" points="2807.5409,-673.2595 2814.7487,-665.4943 2804.2717,-667.0698 2807.5409,-673.2595"/>
</g>
<!-- inSyncReplicaIds -->
<g id="node18" class="node">
<title>inSyncReplicaIds</title>
<polygon fill="#95e1d3" stroke="#000000" points="2815,-567 2815,-613 2942,-613 2942,-567 2815,-567"/>
<text text-anchor="middle" x="2878.5" y="-597.8" font-family="Times,serif" font-size="14.00" fill="#000000">inSyncReplicaIds</text>
<polyline fill="none" stroke="#000000" points="2815,-590 2942,-590 "/>
<text text-anchor="start" x="2823" y="-574.8" font-family="Times,serif" font-size="14.00" fill="#000000">处于同步的副本id</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;inSyncReplicaIds -->
<g id="edge14" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#ff0000" d="M2754.0701,-745.1594C2756.1651,-743.2043 2758.1504,-741.1525 2760,-739 2795.1806,-698.0573 2759.3782,-662.6588 2796,-623 2799.0857,-619.6584 2802.5549,-616.6489 2806.2785,-613.9391"/>
<polygon fill="#ff0000" stroke="#ff0000" points="2808.2644,-616.8233 2814.786,-608.4734 2804.4808,-610.934 2808.2644,-616.8233"/>
</g>
<!-- assignmentState -->
<g id="node19" class="node">
<title>assignmentState</title>
<polygon fill="#95e1d3" stroke="#000000" points="2805.5,-686.5 2805.5,-793.5 2951.5,-793.5 2951.5,-686.5 2805.5,-686.5"/>
<text text-anchor="start" x="2813.5" y="-778.3" font-family="Times,serif" font-size="14.00" fill="#000000">assignmentState</text>
<text text-anchor="start" x="2813.5" y="-763.3" font-family="Times,serif" font-size="14.00" fill="#000000"> partion assigment状态</text>
<polyline fill="none" stroke="#000000" points="2805.5,-755.5 2951.5,-755.5 "/>
<text text-anchor="start" x="2813.5" y="-740.3" font-family="Times,serif" font-size="14.00" fill="#000000">replicas Seq[Int]</text>
<polyline fill="none" stroke="#000000" points="2805.5,-732.5 2951.5,-732.5 "/>
<text text-anchor="start" x="2813.5" y="-717.3" font-family="Times,serif" font-size="14.00" fill="#000000">replicationFactor Int</text>
<polyline fill="none" stroke="#000000" points="2805.5,-709.5 2951.5,-709.5 "/>
<text text-anchor="start" x="2813.5" y="-694.3" font-family="Times,serif" font-size="14.00" fill="#000000">isAddingReplica bool </text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;assignmentState -->
<g id="edge15" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;assignmentState</title>
<path fill="none" stroke="#ff0000" d="M2754.2272,-764.8546C2767.62,-762.176 2781.5327,-759.3935 2794.9927,-756.7015"/>
<polygon fill="#ff0000" stroke="#ff0000" points="2796.0618,-760.057 2805.1812,-754.6638 2794.6889,-753.193 2796.0618,-760.057"/>
</g>
<!-- partitionState -->
<g id="node32" class="node">
<title>partitionState</title>
<polygon fill="#95e1d3" stroke="#000000" points="2796,-812.5 2796,-1111.5 2961,-1111.5 2961,-812.5 2796,-812.5"/>
<text text-anchor="middle" x="2878.5" y="-1096.3" font-family="Times,serif" font-size="14.00" fill="#000000">partitionState</text>
<polyline fill="none" stroke="#000000" points="2796,-1088.5 2961,-1088.5 "/>
<text text-anchor="start" x="2804" y="-1073.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsrPartitionState</text>
<polyline fill="none" stroke="#000000" points="2796,-1065.5 2961,-1065.5 "/>
<text text-anchor="middle" x="2878.5" y="-1050.3" font-family="Times,serif" font-size="14.00" fill="#000000">TopicName string</text>
<polyline fill="none" stroke="#000000" points="2796,-1042.5 2961,-1042.5 "/>
<text text-anchor="middle" x="2878.5" y="-1027.3" font-family="Times,serif" font-size="14.00" fill="#000000">PartitionIndex int32</text>
<polyline fill="none" stroke="#000000" points="2796,-1019.5 2961,-1019.5 "/>
<text text-anchor="middle" x="2878.5" y="-1004.3" font-family="Times,serif" font-size="14.00" fill="#000000">ControllerEpoch int32</text>
<polyline fill="none" stroke="#000000" points="2796,-996.5 2961,-996.5 "/>
<text text-anchor="middle" x="2878.5" y="-981.3" font-family="Times,serif" font-size="14.00" fill="#000000">Leader int32</text>
<polyline fill="none" stroke="#000000" points="2796,-973.5 2961,-973.5 "/>
<text text-anchor="middle" x="2878.5" y="-958.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderEpoch int32</text>
<polyline fill="none" stroke="#000000" points="2796,-950.5 2961,-950.5 "/>
<text text-anchor="middle" x="2878.5" y="-935.3" font-family="Times,serif" font-size="14.00" fill="#000000">Isr []int32</text>
<polyline fill="none" stroke="#000000" points="2796,-927.5 2961,-927.5 "/>
<text text-anchor="middle" x="2878.5" y="-912.3" font-family="Times,serif" font-size="14.00" fill="#000000">zkVersion int32</text>
<polyline fill="none" stroke="#000000" points="2796,-904.5 2961,-904.5 "/>
<text text-anchor="middle" x="2878.5" y="-889.3" font-family="Times,serif" font-size="14.00" fill="#000000">Replicas []int32</text>
<polyline fill="none" stroke="#000000" points="2796,-881.5 2961,-881.5 "/>
<text text-anchor="middle" x="2878.5" y="-866.3" font-family="Times,serif" font-size="14.00" fill="#000000">AddingReplicas []int32</text>
<polyline fill="none" stroke="#000000" points="2796,-858.5 2961,-858.5 "/>
<text text-anchor="middle" x="2878.5" y="-843.3" font-family="Times,serif" font-size="14.00" fill="#000000">RemovingReplicas []int32</text>
<polyline fill="none" stroke="#000000" points="2796,-835.5 2961,-835.5 "/>
<text text-anchor="middle" x="2878.5" y="-820.3" font-family="Times,serif" font-size="14.00" fill="#000000">isNew bool</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;partitionState -->
<g id="edge43" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M2716.9752,-819.3854C2737.7452,-837.7238 2763.4201,-860.3929 2788.1397,-882.2185"/>
<polygon fill="#000000" stroke="#000000" points="2785.9613,-884.9642 2795.7742,-888.9591 2790.5944,-879.7168 2785.9613,-884.9642"/>
</g>
<!-- maybeExpandIsr -->
<g id="node20" class="node">
<title>maybeExpandIsr</title>
<polygon fill="#ffd3b6" stroke="#000000" points="2147,-440.5 2147,-501.5 2291,-501.5 2291,-440.5 2147,-440.5"/>
<text text-anchor="middle" x="2219" y="-486.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeExpandIsr</text>
<polyline fill="none" stroke="#000000" points="2147,-478.5 2291,-478.5 "/>
<text text-anchor="start" x="2155" y="-463.3" font-family="Times,serif" font-size="14.00" fill="#000000">follower已经in sync了</text>
<text text-anchor="start" x="2155" y="-448.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 增加ISR</text>
</g>
<!-- isFollowerInSync -->
<g id="node22" class="node">
<title>isFollowerInSync</title>
<polygon fill="none" stroke="#000000" points="2327,-678 2327,-724 2551,-724 2551,-678 2327,-678"/>
<text text-anchor="middle" x="2439" y="-708.8" font-family="Times,serif" font-size="14.00" fill="#000000">isFollowerInSync</text>
<polyline fill="none" stroke="#000000" points="2327,-701 2551,-701 "/>
<text text-anchor="start" x="2335" y="-685.8" font-family="Times,serif" font-size="14.00" fill="#000000">判断follower的replica是否已经sync</text>
</g>
<!-- maybeExpandIsr&#45;&gt;isFollowerInSync -->
<g id="edge16" class="edge">
<title>maybeExpandIsr&#45;&gt;isFollowerInSync</title>
<path fill="none" stroke="#000000" d="M2252.7742,-501.866C2266.2866,-515.7543 2280.988,-533.0492 2291,-551 2317.1198,-597.8309 2289.4213,-630.6711 2324.2521,-670.4329"/>
<polygon fill="#000000" stroke="#000000" points="2322.0442,-673.1848 2331.5105,-677.9428 2327.0775,-668.32 2322.0442,-673.1848"/>
</g>
<!-- expandIsr -->
<g id="node23" class="node">
<title>expandIsr</title>
<polygon fill="none" stroke="#000000" points="2474,-489 2404,-489 2404,-453 2474,-453 2474,-489"/>
<text text-anchor="middle" x="2439" y="-467.3" font-family="Times,serif" font-size="14.00" fill="#000000">expandIsr</text>
</g>
<!-- maybeExpandIsr&#45;&gt;expandIsr -->
<g id="edge17" class="edge">
<title>maybeExpandIsr&#45;&gt;expandIsr</title>
<path fill="none" stroke="#000000" d="M2291.0362,-471C2324.8899,-471 2364.2116,-471 2393.8063,-471"/>
<polygon fill="#000000" stroke="#000000" points="2393.8438,-474.5001 2403.8438,-471 2393.8437,-467.5001 2393.8438,-474.5001"/>
</g>
<!-- maybeShrinkIsr -->
<g id="node21" class="node">
<title>maybeShrinkIsr</title>
<polygon fill="#dcedc1" stroke="#000000" points="1884,-497.5 1884,-558.5 2111,-558.5 2111,-497.5 1884,-497.5"/>
<text text-anchor="middle" x="1997.5" y="-543.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeShrinkIsr</text>
<polyline fill="none" stroke="#000000" points="1884,-535.5 2111,-535.5 "/>
<text text-anchor="start" x="1892" y="-520.3" font-family="Times,serif" font-size="14.00" fill="#000000">从ISR中踢掉out sync的replica</text>
<text text-anchor="start" x="1892" y="-505.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 该操作只会在partition的leader上做</text>
</g>
<!-- shrinkIsr -->
<g id="node24" class="node">
<title>shrinkIsr</title>
<polygon fill="none" stroke="#000000" points="2471.5,-544 2406.5,-544 2406.5,-508 2471.5,-508 2471.5,-544"/>
<text text-anchor="middle" x="2439" y="-522.3" font-family="Times,serif" font-size="14.00" fill="#000000">shrinkIsr</text>
</g>
<!-- maybeShrinkIsr&#45;&gt;shrinkIsr -->
<g id="edge18" class="edge">
<title>maybeShrinkIsr&#45;&gt;shrinkIsr</title>
<path fill="none" stroke="#000000" d="M2111.1972,-527.485C2204.1334,-527.0639 2330.4713,-526.4916 2395.842,-526.1955"/>
<polygon fill="#000000" stroke="#000000" points="2396.1924,-529.6941 2406.1764,-526.1487 2396.1607,-522.6941 2396.1924,-529.6941"/>
</g>
<!-- getOutOfSyncReplicas -->
<g id="node25" class="node">
<title>getOutOfSyncReplicas</title>
<polygon fill="none" stroke="#000000" points="2289.5,-596 2148.5,-596 2148.5,-560 2289.5,-560 2289.5,-596"/>
<text text-anchor="middle" x="2219" y="-574.3" font-family="Times,serif" font-size="14.00" fill="#000000">getOutOfSyncReplicas</text>
</g>
<!-- maybeShrinkIsr&#45;&gt;getOutOfSyncReplicas -->
<g id="edge19" class="edge">
<title>maybeShrinkIsr&#45;&gt;getOutOfSyncReplicas</title>
<path fill="none" stroke="#000000" d="M2111.1699,-553.6591C2120.3538,-555.7322 2129.5109,-557.7993 2138.3884,-559.8032"/>
<polygon fill="#000000" stroke="#000000" points="2137.7538,-563.248 2148.279,-562.0359 2139.2952,-556.4198 2137.7538,-563.248"/>
</g>
<!-- leaderEpochStartOffsetOpt -->
<g id="node30" class="node">
<title>leaderEpochStartOffsetOpt</title>
<polygon fill="#95e1d3" stroke="#000000" points="2591.5,-678 2591.5,-724 2755.5,-724 2755.5,-678 2591.5,-678"/>
<text text-anchor="middle" x="2673.5" y="-708.8" font-family="Times,serif" font-size="14.00" fill="#000000">leaderEpochStartOffsetOpt</text>
<polyline fill="none" stroke="#000000" points="2591.5,-701 2755.5,-701 "/>
<text text-anchor="start" x="2599.5" y="-685.8" font-family="Times,serif" font-size="14.00" fill="#000000">记录leader的LogOffset</text>
</g>
<!-- isFollowerInSync&#45;&gt;leaderEpochStartOffsetOpt -->
<g id="edge34" class="edge">
<title>isFollowerInSync&#45;&gt;leaderEpochStartOffsetOpt</title>
<path fill="none" stroke="#000000" d="M2551.0989,-701C2561.1495,-701 2571.2507,-701 2581.1062,-701"/>
<polygon fill="#000000" stroke="#000000" points="2581.2755,-704.5001 2591.2755,-701 2581.2754,-697.5001 2581.2755,-704.5001"/>
</g>
<!-- expandIsr&#45;&gt;stateStore_expandIsr -->
<g id="edge24" class="edge">
<title>expandIsr&#45;&gt;stateStore_expandIsr</title>
<path fill="none" stroke="#000000" d="M2474.1581,-470.0055C2497.3468,-467.9817 2527.6376,-462.6323 2551,-449 2576.4205,-434.1668 2626.6861,-369.4526 2654.2694,-332.3662"/>
<polygon fill="#000000" stroke="#000000" points="2657.3101,-334.1409 2660.4415,-324.0194 2651.6817,-329.9789 2657.3101,-334.1409"/>
</g>
<!-- expandIsr&#45;&gt;LeaderAndIsr -->
<g id="edge25" class="edge">
<title>expandIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M2474.2232,-472.5227C2548.1432,-475.7184 2720.3739,-483.1641 2814.4184,-487.2297"/>
<polygon fill="#000000" stroke="#000000" points="2814.5141,-490.737 2824.6559,-487.6723 2814.8165,-483.7435 2814.5141,-490.737"/>
</g>
<!-- maybeUpdateIsrAndVersion -->
<g id="node26" class="node">
<title>maybeUpdateIsrAndVersion</title>
<polygon fill="none" stroke="#000000" points="2760,-546 2587,-546 2587,-510 2760,-510 2760,-546"/>
<text text-anchor="middle" x="2673.5" y="-524.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeUpdateIsrAndVersion</text>
</g>
<!-- expandIsr&#45;&gt;maybeUpdateIsrAndVersion -->
<g id="edge26" class="edge">
<title>expandIsr&#45;&gt;maybeUpdateIsrAndVersion</title>
<path fill="none" stroke="#000000" d="M2474.107,-479.5335C2504.496,-486.9201 2549.6795,-497.9029 2589.3545,-507.5467"/>
<polygon fill="#000000" stroke="#000000" points="2588.7665,-511.0056 2599.3103,-509.9667 2590.4199,-504.2037 2588.7665,-511.0056"/>
</g>
<!-- shrinkIsr&#45;&gt;stateStore_shrinkIsr -->
<g id="edge20" class="edge">
<title>shrinkIsr&#45;&gt;stateStore_shrinkIsr</title>
<path fill="none" stroke="#000000" d="M2471.56,-527.361C2495.9199,-526.692 2528.7336,-522.0034 2551,-504 2582.5848,-478.4622 2561.3144,-451.4647 2587,-420 2599.3847,-404.8288 2616.557,-391.8458 2632.339,-381.8772"/>
<polygon fill="#000000" stroke="#000000" points="2634.2001,-384.8419 2640.9245,-376.6545 2630.5621,-378.8615 2634.2001,-384.8419"/>
</g>
<!-- shrinkIsr&#45;&gt;LeaderAndIsr -->
<g id="edge21" class="edge">
<title>shrinkIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M2471.6749,-523.3236C2544.229,-517.3806 2719.8452,-502.9956 2814.8813,-495.2111"/>
<polygon fill="#000000" stroke="#000000" points="2815.2592,-498.6919 2824.9401,-494.3872 2814.6877,-491.7153 2815.2592,-498.6919"/>
</g>
<!-- shrinkIsr&#45;&gt;maybeUpdateIsrAndVersion -->
<g id="edge22" class="edge">
<title>shrinkIsr&#45;&gt;maybeUpdateIsrAndVersion</title>
<path fill="none" stroke="#000000" d="M2471.6062,-526.2781C2498.8115,-526.5101 2539.0349,-526.8532 2576.4336,-527.1721"/>
<polygon fill="#000000" stroke="#000000" points="2576.8644,-530.6758 2586.8939,-527.2614 2576.9242,-523.6761 2576.8644,-530.6758"/>
</g>
<!-- getOutOfSyncReplicas&#45;&gt;inSyncReplicaIds -->
<g id="edge33" class="edge">
<title>getOutOfSyncReplicas&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#000000" d="M2289.5781,-579.2842C2415.2692,-581.5712 2676.6765,-586.3277 2804.6686,-588.6566"/>
<polygon fill="#000000" stroke="#000000" points="2804.7062,-592.1578 2814.7683,-588.8404 2804.8337,-585.1589 2804.7062,-592.1578"/>
</g>
<!-- isFollowerOutOfSync -->
<g id="node28" class="node">
<title>isFollowerOutOfSync</title>
<polygon fill="none" stroke="#000000" points="2342,-597.5 2342,-658.5 2536,-658.5 2536,-597.5 2342,-597.5"/>
<text text-anchor="middle" x="2439" y="-643.3" font-family="Times,serif" font-size="14.00" fill="#000000">isFollowerOutOfSync</text>
<polyline fill="none" stroke="#000000" points="2342,-635.5 2536,-635.5 "/>
<text text-anchor="start" x="2350" y="-620.3" font-family="Times,serif" font-size="14.00" fill="#000000">根据logEndoffset和maxLagMx</text>
<text text-anchor="start" x="2350" y="-605.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 判断follower是否同步</text>
</g>
<!-- getOutOfSyncReplicas&#45;&gt;isFollowerOutOfSync -->
<g id="edge31" class="edge">
<title>getOutOfSyncReplicas&#45;&gt;isFollowerOutOfSync</title>
<path fill="none" stroke="#000000" d="M2289.5172,-594.0266C2302.9965,-597.0901 2317.3879,-600.3609 2331.7178,-603.6177"/>
<polygon fill="#000000" stroke="#000000" points="2331.0896,-607.0641 2341.6166,-605.8674 2332.641,-600.2382 2331.0896,-607.0641"/>
</g>
<!-- maybeUpdateIsrAndVersion&#45;&gt;inSyncReplicaIds -->
<g id="edge23" class="edge">
<title>maybeUpdateIsrAndVersion&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#000000" d="M2733.0699,-546.0163C2755.6164,-552.8352 2781.5454,-560.6772 2805.2084,-567.8338"/>
<polygon fill="#000000" stroke="#000000" points="2804.2602,-571.2035 2814.8453,-570.7483 2806.2867,-564.5032 2804.2602,-571.2035"/>
</g>
<!-- updateFollowerFetchState -->
<g id="node27" class="node">
<title>updateFollowerFetchState</title>
<polygon fill="none" stroke="#000000" points="1903.5,-432 1903.5,-478 2091.5,-478 2091.5,-432 1903.5,-432"/>
<text text-anchor="middle" x="1997.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#000000">updateFollowerFetchState</text>
<polyline fill="none" stroke="#000000" points="1903.5,-455 2091.5,-455 "/>
<text text-anchor="middle" x="1997.5" y="-439.8" font-family="Times,serif" font-size="14.00" fill="#000000">检查follower是否已经in&#45;sync</text>
</g>
<!-- updateFollowerFetchState&#45;&gt;maybeExpandIsr -->
<g id="edge30" class="edge">
<title>updateFollowerFetchState&#45;&gt;maybeExpandIsr</title>
<path fill="none" stroke="#000000" d="M2091.7571,-461.8086C2106.7773,-462.8936 2122.2114,-464.0085 2136.921,-465.071"/>
<polygon fill="#000000" stroke="#000000" points="2136.7485,-468.5676 2146.9747,-465.7973 2137.2529,-461.5858 2136.7485,-468.5676"/>
</g>
<!-- getReplicaOrException -->
<g id="node29" class="node">
<title>getReplicaOrException</title>
<polygon fill="none" stroke="#000000" points="2745,-652 2602,-652 2602,-616 2745,-616 2745,-652"/>
<text text-anchor="middle" x="2673.5" y="-630.3" font-family="Times,serif" font-size="14.00" fill="#000000">getReplicaOrException</text>
</g>
<!-- isFollowerOutOfSync&#45;&gt;getReplicaOrException -->
<g id="edge32" class="edge">
<title>isFollowerOutOfSync&#45;&gt;getReplicaOrException</title>
<path fill="none" stroke="#000000" d="M2536.0729,-630.4837C2554.5915,-630.9576 2573.8026,-631.4491 2591.7825,-631.9091"/>
<polygon fill="#000000" stroke="#000000" points="2591.8348,-635.4115 2601.9211,-632.1686 2592.0139,-628.4138 2591.8348,-635.4115"/>
</g>
<!-- getReplicaOrException&#45;&gt;remoteReplicasMap -->
<g id="edge35" class="edge">
<title>getReplicaOrException&#45;&gt;remoteReplicasMap</title>
<path fill="none" stroke="#000000" d="M2745.1991,-639.596C2764.4702,-641.1001 2785.3427,-642.7292 2804.7246,-644.2419"/>
<polygon fill="#000000" stroke="#000000" points="2804.4658,-647.7323 2814.7079,-645.0211 2805.0106,-640.7535 2804.4658,-647.7323"/>
</g>
<!-- makeLeader -->
<g id="node31" class="node">
<title>makeLeader</title>
<polygon fill="none" stroke="#000000" points="2481,-865 2397,-865 2397,-829 2481,-829 2481,-865"/>
<text text-anchor="middle" x="2439" y="-843.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeader</text>
</g>
<!-- makeLeader&#45;&gt;replica_updateFetchState -->
<g id="edge36" class="edge">
<title>makeLeader&#45;&gt;replica_updateFetchState</title>
<path fill="none" stroke="#000000" d="M2440.61,-865.1264C2446.9672,-925.7019 2475.7248,-1123.1333 2587,-1227 2593.2821,-1232.8638 2600.8217,-1237.4546 2608.796,-1241.0485"/>
<polygon fill="#000000" stroke="#000000" points="2607.7219,-1244.3878 2618.3077,-1244.8262 2610.3057,-1237.8821 2607.7219,-1244.3878"/>
</g>
<!-- makeLeader&#45;&gt;replica_resetLastCaughtUpTime -->
<g id="edge37" class="edge">
<title>makeLeader&#45;&gt;replica_resetLastCaughtUpTime</title>
<path fill="none" stroke="#000000" d="M2442.2036,-865.0112C2452.6744,-918.5535 2490.9038,-1078.2156 2587,-1162 2587.8597,-1162.7495 2588.7401,-1163.4783 2589.6393,-1164.1868"/>
<polygon fill="#000000" stroke="#000000" points="2587.9595,-1167.2782 2598.19,-1170.0331 2591.9104,-1161.4997 2587.9595,-1167.2782"/>
</g>
<!-- makeLeader&#45;&gt;updateAssignmentAndIsr -->
<g id="edge38" class="edge">
<title>makeLeader&#45;&gt;updateAssignmentAndIsr</title>
<path fill="none" stroke="#000000" d="M2481.1012,-840.2814C2502.2534,-836.5148 2528.174,-831.3025 2551,-825 2561.4233,-822.122 2572.23,-818.7827 2582.9126,-815.2549"/>
<polygon fill="#000000" stroke="#000000" points="2584.3123,-818.4768 2592.6737,-811.97 2582.0796,-811.8424 2584.3123,-818.4768"/>
</g>
<!-- makeLeader&#45;&gt;leaderEpochStartOffsetOpt -->
<g id="edge39" class="edge">
<title>makeLeader&#45;&gt;leaderEpochStartOffsetOpt</title>
<path fill="none" stroke="#000000" d="M2481.1587,-844.6593C2503.0484,-842.0134 2529.6129,-836.4825 2551,-825 2592.738,-802.5913 2629.2379,-761.2197 2651.2982,-732.4568"/>
<polygon fill="#000000" stroke="#000000" points="2654.1899,-734.4348 2657.4002,-724.338 2648.5941,-730.2291 2654.1899,-734.4348"/>
</g>
<!-- makeLeader&#45;&gt;partitionState -->
<g id="edge40" class="edge">
<title>makeLeader&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M2463.1499,-865.1706C2491.2725,-885.2686 2539.905,-916.8133 2587,-932 2651.2906,-952.7317 2727.3078,-960.0282 2785.5923,-962.2491"/>
<polygon fill="#000000" stroke="#000000" points="2785.7804,-965.7574 2795.8926,-962.5961 2786.0161,-958.7613 2785.7804,-965.7574"/>
</g>
<!-- makeFollower -->
<g id="node33" class="node">
<title>makeFollower</title>
<polygon fill="none" stroke="#000000" points="2486.5,-799 2391.5,-799 2391.5,-763 2486.5,-763 2486.5,-799"/>
<text text-anchor="middle" x="2439" y="-777.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollower</text>
</g>
<!-- makeFollower&#45;&gt;updateAssignmentAndIsr -->
<g id="edge41" class="edge">
<title>makeFollower&#45;&gt;updateAssignmentAndIsr</title>
<path fill="none" stroke="#000000" d="M2486.7372,-781C2514.286,-781 2549.8476,-781 2582.5356,-781"/>
<polygon fill="#000000" stroke="#000000" points="2582.5759,-784.5001 2592.5759,-781 2582.5759,-777.5001 2582.5759,-784.5001"/>
</g>
<!-- makeFollower&#45;&gt;partitionState -->
<g id="edge42" class="edge">
<title>makeFollower&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M2459.5327,-799.2913C2486.7964,-822.6606 2537.3122,-862.8476 2587,-886 2650.4107,-915.5467 2727.1397,-934.9657 2785.9573,-946.7739"/>
<polygon fill="#000000" stroke="#000000" points="2785.4916,-950.2494 2795.9794,-948.7474 2786.844,-943.3813 2785.4916,-950.2494"/>
</g>
<!-- startup -->
<g id="node34" class="node">
<title>startup</title>
<polygon fill="none" stroke="#000000" points="1430,-221 1376,-221 1376,-185 1430,-185 1430,-221"/>
<text text-anchor="middle" x="1403" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#000000">startup</text>
</g>
<!-- scheduler_schedule -->
<g id="node35" class="node">
<title>scheduler_schedule</title>
<polygon fill="none" stroke="#000000" points="1502,-172.5 1502,-233.5 1621,-233.5 1621,-172.5 1502,-172.5"/>
<text text-anchor="middle" x="1561.5" y="-218.3" font-family="Times,serif" font-size="14.00" fill="#000000">scheduler.schedule</text>
<polyline fill="none" stroke="#000000" points="1502,-210.5 1621,-210.5 "/>
<text text-anchor="start" x="1510" y="-195.3" font-family="Times,serif" font-size="14.00" fill="#000000">后台线程</text>
<text text-anchor="start" x="1510" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 周期性调用</text>
</g>
<!-- startup&#45;&gt;scheduler_schedule -->
<g id="edge44" class="edge">
<title>startup&#45;&gt;scheduler_schedule</title>
<path fill="none" stroke="#000000" d="M1430.2471,-203C1447.2101,-203 1469.864,-203 1491.5718,-203"/>
<polygon fill="#000000" stroke="#000000" points="1491.788,-206.5001 1501.7879,-203 1491.7879,-199.5001 1491.788,-206.5001"/>
</g>
<!-- replicaManager_maybeShrinkIsr -->
<g id="node36" class="node">
<title>replicaManager_maybeShrinkIsr</title>
<polygon fill="#dcedc1" stroke="#000000" points="1657,-187 1657,-233 1848,-233 1848,-187 1657,-187"/>
<text text-anchor="middle" x="1752.5" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#000000">maybeShrinkIsr</text>
<polyline fill="none" stroke="#000000" points="1657,-210 1848,-210 "/>
<text text-anchor="start" x="1665" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#000000">从ISR中踢掉out sync的replica</text>
</g>
<!-- scheduler_schedule&#45;&gt;replicaManager_maybeShrinkIsr -->
<g id="edge45" class="edge">
<title>scheduler_schedule&#45;&gt;replicaManager_maybeShrinkIsr</title>
<path fill="none" stroke="#000000" d="M1621.1479,-205.1861C1629.3298,-205.4859 1637.9224,-205.8008 1646.6313,-206.12"/>
<polygon fill="#000000" stroke="#000000" points="1646.7692,-209.6273 1656.8907,-206.496 1647.0256,-202.632 1646.7692,-209.6273"/>
</g>
<!-- replicaManager_maybeShrinkIsr&#45;&gt;maybeShrinkIsr -->
<g id="edge49" class="edge">
<title>replicaManager_maybeShrinkIsr&#45;&gt;maybeShrinkIsr</title>
<path fill="none" stroke="#000000" d="M1755.8661,-233.3345C1764.6506,-285.8177 1793.1088,-414.2337 1876.3647,-492.4136"/>
<polygon fill="#000000" stroke="#000000" points="1874.0185,-495.0109 1883.7848,-499.1183 1878.7116,-489.817 1874.0185,-495.0109"/>
</g>
<!-- replicaManager_updateFollowerFetchState -->
<g id="node37" class="node">
<title>replicaManager_updateFollowerFetchState</title>
<polygon fill="none" stroke="#000000" points="1657,-106.5 1657,-167.5 1848,-167.5 1848,-106.5 1657,-106.5"/>
<text text-anchor="middle" x="1752.5" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFollowerFetchState</text>
<polyline fill="none" stroke="#000000" points="1657,-144.5 1848,-144.5 "/>
<text text-anchor="start" x="1665" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#000000">如果是从follower发送过来的</text>
<text text-anchor="start" x="1665" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 请求，就更新follower状态</text>
</g>
<!-- replicaManager_updateFollowerFetchState&#45;&gt;updateFollowerFetchState -->
<g id="edge50" class="edge">
<title>replicaManager_updateFollowerFetchState&#45;&gt;updateFollowerFetchState</title>
<path fill="none" stroke="#000000" d="M1839.2673,-167.5035C1842.4732,-170.3899 1845.4138,-173.547 1848,-177 1915.0245,-266.4889 1801.6138,-343.53 1876,-427 1881.1487,-432.7774 1887.2288,-437.4872 1893.8798,-441.315"/>
<polygon fill="#000000" stroke="#000000" points="1892.7593,-444.6676 1903.2693,-446.0054 1895.8875,-438.4055 1892.7593,-444.6676"/>
</g>
<!-- fetchMessages -->
<g id="node38" class="node">
<title>fetchMessages</title>
<polygon fill="none" stroke="#000000" points="1610,-148 1513,-148 1513,-112 1610,-112 1610,-148"/>
<text text-anchor="middle" x="1561.5" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchMessages</text>
</g>
<!-- fetchMessages&#45;&gt;replicaManager_updateFollowerFetchState -->
<g id="edge46" class="edge">
<title>fetchMessages&#45;&gt;replicaManager_updateFollowerFetchState</title>
<path fill="none" stroke="#000000" d="M1610.1916,-131.7845C1621.4417,-132.1968 1633.8433,-132.6513 1646.4938,-133.115"/>
<polygon fill="#000000" stroke="#000000" points="1646.5539,-136.6194 1656.6754,-133.4881 1646.8103,-129.6241 1646.5539,-136.6194"/>
</g>
<!-- becomLeaderOrFollower -->
<g id="node39" class="node">
<title>becomLeaderOrFollower</title>
<polygon fill="none" stroke="#000000" points="377,-180 223,-180 223,-144 377,-144 377,-180"/>
<text text-anchor="middle" x="300" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#000000">becomLeaderOrFollower</text>
</g>
<!-- makeFollowers -->
<g id="node40" class="node">
<title>makeFollowers</title>
<polygon fill="none" stroke="#000000" points="514,-180 413,-180 413,-144 514,-144 514,-180"/>
<text text-anchor="middle" x="463.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollowers</text>
</g>
<!-- becomLeaderOrFollower&#45;&gt;makeFollowers -->
<g id="edge47" class="edge">
<title>becomLeaderOrFollower&#45;&gt;makeFollowers</title>
<path fill="none" stroke="#000000" d="M377.4407,-162C385.9138,-162 394.4488,-162 402.6803,-162"/>
<polygon fill="#000000" stroke="#000000" points="402.917,-165.5001 412.9169,-162 402.9169,-158.5001 402.917,-165.5001"/>
</g>
<!-- makeLeaders -->
<g id="node41" class="node">
<title>makeLeaders</title>
<polygon fill="none" stroke="#000000" points="508,-234 419,-234 419,-198 508,-198 508,-234"/>
<text text-anchor="middle" x="463.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeaders</text>
</g>
<!-- becomLeaderOrFollower&#45;&gt;makeLeaders -->
<g id="edge48" class="edge">
<title>becomLeaderOrFollower&#45;&gt;makeLeaders</title>
<path fill="none" stroke="#000000" d="M354.898,-180.1314C372.2692,-185.8687 391.4602,-192.207 408.8164,-197.9394"/>
<polygon fill="#000000" stroke="#000000" points="408.2027,-201.4226 418.7959,-201.2353 410.398,-194.7757 408.2027,-201.4226"/>
</g>
<!-- makeFollowers&#45;&gt;makeFollower -->
<g id="edge51" class="edge">
<title>makeFollowers&#45;&gt;makeFollower</title>
<path fill="none" stroke="#000000" d="M463.8171,-180.0825C465.6415,-260.9971 477.4723,-588.676 550,-653 635.2503,-728.6075 692.0522,-667 806,-667 806,-667 806,-667 1997.5,-667 2149.5456,-667 2179.0671,-723.8756 2327,-759 2344.5674,-763.1711 2363.818,-767.16 2381.328,-770.5681"/>
<polygon fill="#000000" stroke="#000000" points="2380.93,-774.0555 2391.4107,-772.5045 2382.2503,-767.1812 2380.93,-774.0555"/>
</g>
<!-- addFetcherForPartitions -->
<g id="node42" class="node">
<title>addFetcherForPartitions</title>
<polygon fill="none" stroke="#000000" points="550,-152.5 550,-213.5 724,-213.5 724,-152.5 550,-152.5"/>
<text text-anchor="middle" x="637" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#000000">addFetcherForPartitions</text>
<polyline fill="none" stroke="#000000" points="550,-190.5 724,-190.5 "/>
<text text-anchor="start" x="558" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#000000">follower启动和</text>
<text text-anchor="start" x="558" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#000000"> partition leader同步的线程</text>
</g>
<!-- makeFollowers&#45;&gt;addFetcherForPartitions -->
<g id="edge52" class="edge">
<title>makeFollowers&#45;&gt;addFetcherForPartitions</title>
<path fill="none" stroke="#000000" d="M514.1498,-168.1305C522.289,-169.1157 530.9443,-170.1633 539.746,-171.2286"/>
<polygon fill="#000000" stroke="#000000" points="539.3777,-174.7095 549.7258,-172.4366 540.2189,-167.7602 539.3777,-174.7095"/>
</g>
<!-- makeLeaders&#45;&gt;makeLeader -->
<g id="edge53" class="edge">
<title>makeLeaders&#45;&gt;makeLeader</title>
<path fill="none" stroke="#000000" d="M464.9581,-234.2149C472.5194,-326.4862 508.5131,-739.4052 550,-777 634.4365,-853.5152 692.0522,-791 806,-791 806,-791 806,-791 1997.5,-791 2072.3091,-791 2286.5646,-823.0427 2386.4975,-838.6518"/>
<polygon fill="#000000" stroke="#000000" points="2386.2451,-842.1549 2396.6664,-840.2451 2387.3287,-835.2393 2386.2451,-842.1549"/>
</g>
<!-- fetcherThread -->
<g id="node43" class="node">
<title>fetcherThread</title>
<polygon fill="none" stroke="#000000" points="852,-324 760,-324 760,-288 852,-288 852,-324"/>
<text text-anchor="middle" x="806" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetcherThread</text>
</g>
<!-- addFetcherForPartitions&#45;&gt;fetcherThread -->
<g id="edge56" class="edge">
<title>addFetcherForPartitions&#45;&gt;fetcherThread</title>
<path fill="none" stroke="#000000" d="M666.4782,-213.9046C686.8498,-234.0435 715.488,-260.0831 751.1103,-282.9825"/>
<polygon fill="#000000" stroke="#000000" points="749.4775,-286.0894 759.8118,-288.4248 753.1894,-280.1546 749.4775,-286.0894"/>
</g>
<!-- processFetchRequest -->
<g id="node44" class="node">
<title>processFetchRequest</title>
<polygon fill="none" stroke="#000000" points="1019,-334 888,-334 888,-298 1019,-298 1019,-334"/>
<text text-anchor="middle" x="953.5" y="-312.3" font-family="Times,serif" font-size="14.00" fill="#000000">processFetchRequest</text>
</g>
<!-- fetcherThread&#45;&gt;processFetchRequest -->
<g id="edge54" class="edge">
<title>fetcherThread&#45;&gt;processFetchRequest</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M852.2652,-309.1366C860.4023,-309.6883 869.0603,-310.2753 877.7553,-310.8648"/>
<polygon fill="#000000" stroke="#000000" points="877.7365,-314.3714 887.9504,-311.556 878.2101,-307.3875 877.7365,-314.3714"/>
</g>
<!-- fetchFromLeader -->
<g id="node45" class="node">
<title>fetchFromLeader</title>
<polygon fill="#ffd3b6" stroke="#000000" points="1055,-289 1055,-365 1304,-365 1304,-289 1055,-289"/>
<text text-anchor="middle" x="1179.5" y="-349.8" font-family="Times,serif" font-size="14.00" fill="#000000">fetchFromLeader</text>
<polyline fill="none" stroke="#000000" points="1055,-342 1304,-342 "/>
<text text-anchor="start" x="1063" y="-326.8" font-family="Times,serif" font-size="14.00" fill="#000000">每个partition的follower broker</text>
<text text-anchor="start" x="1063" y="-311.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 有个线程负从leader 所在的broker发送</text>
<text text-anchor="start" x="1063" y="-296.8" font-family="Times,serif" font-size="14.00" fill="#000000"> fetchMessage请求</text>
</g>
<!-- processFetchRequest&#45;&gt;fetchFromLeader -->
<g id="edge55" class="edge">
<title>processFetchRequest&#45;&gt;fetchFromLeader</title>
<path fill="none" stroke="#000000" d="M1019.1721,-319.1964C1027.4102,-319.5974 1036.0579,-320.0183 1044.8884,-320.4481"/>
<polygon fill="#000000" stroke="#000000" points="1044.7657,-323.9462 1054.9241,-320.9366 1045.1061,-316.9545 1044.7657,-323.9462"/>
</g>
<!-- handleFetchRequest -->
<g id="node46" class="node">
<title>handleFetchRequest</title>
<polygon fill="none" stroke="#000000" points="1466,-52 1340,-52 1340,-16 1466,-16 1466,-52"/>
<text text-anchor="middle" x="1403" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#000000">handleFetchRequest</text>
</g>
<!-- fetchFromLeader&#45;&gt;handleFetchRequest -->
<g id="edge57" class="edge">
<title>fetchFromLeader&#45;&gt;handleFetchRequest</title>
<path fill="none" stroke="#000000" d="M1304.1951,-292.0345C1306.968,-289.5371 1309.5804,-286.8631 1312,-284 1367.096,-218.8068 1300.7319,-169.7875 1340,-94 1346.9334,-80.6184 1358.033,-68.5531 1368.9977,-58.8109"/>
<polygon fill="#000000" stroke="#000000" points="1371.5134,-61.2675 1376.8964,-52.142 1366.9976,-55.9189 1371.5134,-61.2675"/>
</g>
<!-- handleFetchRequest&#45;&gt;fetchMessages -->
<g id="edge59" class="edge">
<title>handleFetchRequest&#45;&gt;fetchMessages</title>
<path fill="none" stroke="#000000" d="M1432.8126,-52.0569C1458.3017,-67.495 1495.1509,-89.8138 1522.8914,-106.6156"/>
<polygon fill="#000000" stroke="#000000" points="1521.1853,-109.6742 1531.552,-111.8612 1524.8118,-103.6868 1521.1853,-109.6742"/>
</g>
<!-- handleLeaderAndIsrRequest -->
<g id="node47" class="node">
<title>handleLeaderAndIsrRequest</title>
<polygon fill="none" stroke="#000000" points="187,-52 16,-52 16,-16 187,-16 187,-52"/>
<text text-anchor="middle" x="101.5" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#000000">handleLeaderAndIsrRequest</text>
</g>
<!-- handleLeaderAndIsrRequest&#45;&gt;becomLeaderOrFollower -->
<g id="edge58" class="edge">
<title>handleLeaderAndIsrRequest&#45;&gt;becomLeaderOrFollower</title>
<path fill="none" stroke="#000000" d="M115.9771,-52.2986C134.5911,-74.6517 169.1262,-112.3613 214.0487,-138.9378"/>
<polygon fill="#000000" stroke="#000000" points="212.4362,-142.0469 222.8622,-143.9305 215.8864,-135.9562 212.4362,-142.0469"/>
</g>
</g>
</svg>
