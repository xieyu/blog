<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: replica_leader_election Pages: 1 -->
<svg width="2114pt" height="802pt"
 viewBox="0.00 0.00 2114.45 802.15" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 798.1453)">
<title>replica_leader_election</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-798.1453 2110.4521,-798.1453 2110.4521,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_KafkaBroker</title>
<polygon fill="none" stroke="#000000" points="217.6655,-74.1453 217.6655,-374.1453 1596.6963,-374.1453 1596.6963,-74.1453 217.6655,-74.1453"/>
<text text-anchor="middle" x="907.1809" y="-354.1453" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaBroker</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KafkaApi</title>
<polygon fill="none" stroke="#000000" points="225.6655,-84.1453 225.6655,-218.1453 417.8247,-218.1453 417.8247,-84.1453 225.6655,-84.1453"/>
<text text-anchor="middle" x="321.7451" y="-198.1453" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_partition</title>
<polygon fill="none" stroke="#000000" points="1245.7544,-82.1453 1245.7544,-216.1453 1588.6963,-216.1453 1588.6963,-82.1453 1245.7544,-82.1453"/>
<text text-anchor="middle" x="1417.2253" y="-196.1453" font-family="Times,serif" font-size="20.00" fill="#000000">partition</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_ReplicaFetchThread</title>
<polygon fill="none" stroke="#000000" points="1203.7646,-224.1453 1203.7646,-338.1453 1400.6133,-338.1453 1400.6133,-224.1453 1203.7646,-224.1453"/>
<text text-anchor="middle" x="1302.189" y="-318.1453" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaFetchThread</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_ReplicaManager</title>
<polygon fill="none" stroke="#000000" points="475.9727,-144.1453 475.9727,-332.1453 1115.2241,-332.1453 1115.2241,-144.1453 475.9727,-144.1453"/>
<text text-anchor="middle" x="795.5984" y="-312.1453" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_KafkaController</title>
<polygon fill="none" stroke="#000000" points="8,-382.1453 8,-786.1453 2098.4521,-786.1453 2098.4521,-382.1453 8,-382.1453"/>
<text text-anchor="middle" x="1053.2261" y="-766.1453" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaController</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_PartionStateMachine</title>
<polygon fill="none" stroke="#000000" points="1420.6133,-532.1453 1420.6133,-660.1453 2090.4521,-660.1453 2090.4521,-532.1453 1420.6133,-532.1453"/>
<text text-anchor="middle" x="1755.5327" y="-640.1453" font-family="Times,serif" font-size="20.00" fill="#000000">PartionStateMachine</text>
</g>
<g id="clust12" class="cluster">
<title>cluster_ControllerChannelManager</title>
<polygon fill="none" stroke="#000000" points="1624.2686,-390.1453 1624.2686,-524.1453 1883.7207,-524.1453 1883.7207,-390.1453 1624.2686,-390.1453"/>
<text text-anchor="middle" x="1753.9946" y="-504.1453" font-family="Times,serif" font-size="20.00" fill="#000000">ControllerChannelManager</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_KafkaAdminClient</title>
<polygon fill="none" stroke="#000000" points="20.9067,-131.1453 20.9067,-225.1453 189.6313,-225.1453 189.6313,-131.1453 20.9067,-131.1453"/>
<text text-anchor="middle" x="105.269" y="-205.1453" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaAdminClient</text>
</g>
<!-- handleLeaderAndIsrRequest -->
<g id="node1" class="node">
<title>handleLeaderAndIsrRequest</title>
<polygon fill="none" stroke="#000000" points="409.9044,-128.1453 233.5859,-128.1453 233.5859,-92.1453 409.9044,-92.1453 409.9044,-128.1453"/>
<text text-anchor="middle" x="321.7451" y="-105.9453" font-family="Times,serif" font-size="14.00" fill="#000000">handleLeaderAndIsrRequest</text>
</g>
<!-- LeaderAndIsrRequest -->
<g id="node12" class="node">
<title>LeaderAndIsrRequest</title>
<polygon fill="#95e1d3" stroke="#000000" points="457.9141,-91.1453 457.9141,-135.1453 596.7559,-135.1453 596.7559,-91.1453 457.9141,-91.1453"/>
<text text-anchor="middle" x="527.335" y="-119.9453" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsrRequest</text>
<polyline fill="none" stroke="#000000" points="457.9141,-113.1453 596.7559,-113.1453 "/>
<text text-anchor="start" x="465.9141" y="-97.9453" font-family="Times,serif" font-size="14.00" fill="#000000">field </text>
</g>
<!-- handleLeaderAndIsrRequest&#45;&gt;LeaderAndIsrRequest -->
<g id="edge7" class="edge">
<title>handleLeaderAndIsrRequest&#45;&gt;LeaderAndIsrRequest</title>
<path fill="none" stroke="#000000" d="M409.8284,-111.4306C422.3447,-111.6132 435.1581,-111.8002 447.5056,-111.9804"/>
<polygon fill="#000000" stroke="#000000" points="447.7012,-115.4835 457.7512,-112.1299 447.8034,-108.4843 447.7012,-115.4835"/>
</g>
<!-- handleElectReplicaLeader -->
<g id="node2" class="node">
<title>handleElectReplicaLeader</title>
<polygon fill="none" stroke="#000000" points="403.4358,-182.1453 240.0544,-182.1453 240.0544,-146.1453 403.4358,-146.1453 403.4358,-182.1453"/>
<text text-anchor="middle" x="321.7451" y="-159.9453" font-family="Times,serif" font-size="14.00" fill="#000000">handleElectReplicaLeader</text>
</g>
<!-- replica_electLeaders -->
<g id="node11" class="node">
<title>replica_electLeaders</title>
<polygon fill="none" stroke="#000000" points="570.56,-243.1453 484.1099,-243.1453 484.1099,-207.1453 570.56,-207.1453 570.56,-243.1453"/>
<text text-anchor="middle" x="527.335" y="-220.9453" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
</g>
<!-- handleElectReplicaLeader&#45;&gt;replica_electLeaders -->
<g id="edge9" class="edge">
<title>handleElectReplicaLeader&#45;&gt;replica_electLeaders</title>
<path fill="none" stroke="#000000" d="M379.6004,-182.2015C401.3156,-188.8947 426.2343,-196.4756 448.9521,-203.1453 457.0425,-205.5205 465.6187,-207.9834 474.015,-210.3641"/>
<polygon fill="#000000" stroke="#000000" points="473.1743,-213.7635 483.749,-213.1109 475.0755,-207.0266 473.1743,-213.7635"/>
</g>
<!-- makeLeader -->
<g id="node3" class="node">
<title>makeLeader</title>
<polygon fill="none" stroke="#000000" points="1344.862,-126.1453 1259.5159,-126.1453 1259.5159,-90.1453 1344.862,-90.1453 1344.862,-126.1453"/>
<text text-anchor="middle" x="1302.189" y="-103.9453" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeader</text>
</g>
<!-- createLogIfNotExists -->
<g id="node5" class="node">
<title>createLogIfNotExists</title>
<polygon fill="none" stroke="#000000" points="1580.4525,-153.1453 1444.4293,-153.1453 1444.4293,-117.1453 1580.4525,-117.1453 1580.4525,-153.1453"/>
<text text-anchor="middle" x="1512.4409" y="-130.9453" font-family="Times,serif" font-size="14.00" fill="#000000">createLogIfNotExists</text>
</g>
<!-- makeLeader&#45;&gt;createLogIfNotExists -->
<g id="edge1" class="edge">
<title>makeLeader&#45;&gt;createLogIfNotExists</title>
<path fill="none" stroke="#000000" d="M1344.99,-113.6417C1370.5559,-116.9248 1403.8187,-121.1963 1433.9546,-125.0663"/>
<polygon fill="#000000" stroke="#000000" points="1433.6747,-128.559 1444.0391,-126.3613 1434.5664,-121.616 1433.6747,-128.559"/>
</g>
<!-- makeFollower -->
<g id="node4" class="node">
<title>makeFollower</title>
<polygon fill="none" stroke="#000000" points="1350.5582,-180.1453 1253.8197,-180.1453 1253.8197,-144.1453 1350.5582,-144.1453 1350.5582,-180.1453"/>
<text text-anchor="middle" x="1302.189" y="-157.9453" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollower</text>
</g>
<!-- makeFollower&#45;&gt;createLogIfNotExists -->
<g id="edge2" class="edge">
<title>makeFollower&#45;&gt;createLogIfNotExists</title>
<path fill="none" stroke="#000000" d="M1350.689,-155.917C1375.4233,-152.7407 1406.1187,-148.7989 1434.1012,-145.2054"/>
<polygon fill="#000000" stroke="#000000" points="1434.799,-148.6447 1444.2717,-143.8994 1433.9074,-141.7017 1434.799,-148.6447"/>
</g>
<!-- ReplicaFetcherThread -->
<g id="node6" class="node">
<title>ReplicaFetcherThread</title>
<polygon fill="none" stroke="#000000" points="1211.7646,-232.5453 1211.7646,-301.7452 1392.6133,-301.7452 1392.6133,-232.5453 1211.7646,-232.5453"/>
<text text-anchor="middle" x="1302.189" y="-286.5452" font-family="Times,serif" font-size="14.00" fill="#000000">ReplicaFetcherThread</text>
<polyline fill="none" stroke="#000000" points="1211.7646,-279.7452 1392.6133,-279.7452 "/>
<text text-anchor="start" x="1219.7646" y="-264.5452" font-family="Times,serif" font-size="14.00" fill="#000000">follower启动fetch线程，</text>
<text text-anchor="start" x="1219.7646" y="-244.9453" font-family="Times,serif" font-size="14.00" fill="#000000"> 同步和partion leader的消息</text>
</g>
<!-- becomeLeaderOrFollower -->
<g id="node7" class="node">
<title>becomeLeaderOrFollower</title>
<polygon fill="none" stroke="#000000" points="650.4814,-165.7454 650.4814,-254.5451 891.6025,-254.5451 891.6025,-165.7454 650.4814,-165.7454"/>
<text text-anchor="middle" x="771.042" y="-239.3451" font-family="Times,serif" font-size="14.00" fill="#000000">becomeLeaderOrFollower</text>
<polyline fill="none" stroke="#000000" points="650.4814,-232.5451 891.6025,-232.5451 "/>
<text text-anchor="start" x="658.4814" y="-217.3451" font-family="Times,serif" font-size="14.00" fill="#000000">根据收到的LeaderAndIsrRequest</text>
<text text-anchor="start" x="658.4814" y="-197.7452" font-family="Times,serif" font-size="14.00" fill="#000000"> 以及自己的brokerID</text>
<text text-anchor="start" x="658.4814" y="-178.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> 来判断自己是成为leader还是follower</text>
</g>
<!-- makeLeaders -->
<g id="node8" class="node">
<title>makeLeaders</title>
<polygon fill="none" stroke="#000000" points="1101.1873,-188.1453 1010.9435,-188.1453 1010.9435,-152.1453 1101.1873,-152.1453 1101.1873,-188.1453"/>
<text text-anchor="middle" x="1056.0654" y="-165.9453" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeaders</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;makeLeaders -->
<g id="edge3" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;makeLeaders</title>
<path fill="none" stroke="#000000" d="M891.9176,-193.1817C929.6769,-187.8825 969.511,-182.2922 1000.4818,-177.9458"/>
<polygon fill="#000000" stroke="#000000" points="1001.2129,-181.3776 1010.6294,-176.5217 1000.24,-174.4456 1001.2129,-181.3776"/>
</g>
<!-- makeFollowers -->
<g id="node9" class="node">
<title>makeFollowers</title>
<polygon fill="none" stroke="#000000" points="1107.3833,-242.1453 1004.7476,-242.1453 1004.7476,-206.1453 1107.3833,-206.1453 1107.3833,-242.1453"/>
<text text-anchor="middle" x="1056.0654" y="-219.9453" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollowers</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;makeFollowers -->
<g id="edge4" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;makeFollowers</title>
<path fill="none" stroke="#000000" d="M891.9176,-216.0825C927.2055,-217.8158 964.3054,-219.6381 994.2896,-221.1109"/>
<polygon fill="#000000" stroke="#000000" points="994.4243,-224.6217 1004.584,-221.6166 994.7677,-217.6301 994.4243,-224.6217"/>
</g>
<!-- allPartitions -->
<g id="node10" class="node">
<title>allPartitions</title>
<polygon fill="#95e1d3" stroke="#000000" points="1097.7282,-296.1453 1018.4026,-296.1453 1014.4026,-292.1453 1014.4026,-260.1453 1093.7282,-260.1453 1097.7282,-264.1453 1097.7282,-296.1453"/>
<polyline fill="none" stroke="#000000" points="1093.7282,-292.1453 1014.4026,-292.1453 "/>
<polyline fill="none" stroke="#000000" points="1093.7282,-292.1453 1093.7282,-260.1453 "/>
<polyline fill="none" stroke="#000000" points="1093.7282,-292.1453 1097.7282,-296.1453 "/>
<text text-anchor="middle" x="1056.0654" y="-273.9453" font-family="Times,serif" font-size="14.00" fill="#000000">allPartitions</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;allPartitions -->
<g id="edge5" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;allPartitions</title>
<path fill="none" stroke="#000000" d="M891.9601,-240.4469C906.9038,-244.099 921.9782,-247.7388 936.3662,-251.1453 958.5459,-256.3964 983.0942,-261.9744 1004.1571,-266.6888"/>
<polygon fill="#000000" stroke="#000000" points="1003.6692,-270.1659 1014.1915,-268.9285 1005.1942,-263.334 1003.6692,-270.1659"/>
</g>
<!-- makeLeaders&#45;&gt;makeLeader -->
<g id="edge10" class="edge">
<title>makeLeaders&#45;&gt;makeLeader</title>
<path fill="none" stroke="#000000" d="M1101.2083,-158.7735C1143.0514,-148.233 1205.3115,-132.5493 1249.4307,-121.4354"/>
<polygon fill="#000000" stroke="#000000" points="1250.5501,-124.7628 1259.3922,-118.926 1248.8402,-117.9749 1250.5501,-124.7628"/>
</g>
<!-- makeFollowers&#45;&gt;makeFollower -->
<g id="edge11" class="edge">
<title>makeFollowers&#45;&gt;makeFollower</title>
<path fill="none" stroke="#000000" d="M1107.4532,-213.1242C1128.659,-208.4282 1153.4496,-202.7474 1175.7646,-197.1453 1198.0752,-191.5442 1222.4607,-184.9145 1243.8109,-178.9399"/>
<polygon fill="#000000" stroke="#000000" points="1245.0269,-182.2337 1253.7059,-176.1572 1243.1318,-175.4951 1245.0269,-182.2337"/>
</g>
<!-- makeFollowers&#45;&gt;ReplicaFetcherThread -->
<g id="edge6" class="edge">
<title>makeFollowers&#45;&gt;ReplicaFetcherThread</title>
<path fill="none" stroke="#000000" d="M1107.3614,-233.1071C1134.6838,-237.8806 1169.2609,-243.9215 1201.6767,-249.5849"/>
<polygon fill="#000000" stroke="#000000" points="1201.2038,-253.0552 1211.657,-251.3285 1202.4086,-246.1596 1201.2038,-253.0552"/>
</g>
<!-- controller_electLeaders -->
<g id="node13" class="node">
<title>controller_electLeaders</title>
<polygon fill="none" stroke="#000000" points="814.267,-426.1453 727.8169,-426.1453 727.8169,-390.1453 814.267,-390.1453 814.267,-426.1453"/>
<text text-anchor="middle" x="771.042" y="-403.9453" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
</g>
<!-- replica_electLeaders&#45;&gt;controller_electLeaders -->
<g id="edge12" class="edge">
<title>replica_electLeaders&#45;&gt;controller_electLeaders</title>
<path fill="none" stroke="#000000" d="M543.1296,-243.1743C564.1203,-266.4654 603.0751,-307.4223 641.7178,-336.1453 667.2496,-355.123 698.3306,-372.5834 723.6232,-385.5561"/>
<polygon fill="#000000" stroke="#000000" points="722.1554,-388.7359 732.6586,-390.1269 725.3153,-382.4897 722.1554,-388.7359"/>
</g>
<!-- LeaderAndIsrRequest&#45;&gt;becomeLeaderOrFollower -->
<g id="edge8" class="edge">
<title>LeaderAndIsrRequest&#45;&gt;becomeLeaderOrFollower</title>
<path fill="none" stroke="#000000" d="M592.4722,-135.1979C596.9673,-136.8379 601.4173,-138.4964 605.7178,-140.1453 623.3138,-146.8918 641.8199,-154.3562 659.8247,-161.823"/>
<polygon fill="#000000" stroke="#000000" points="658.61,-165.1084 669.1869,-165.724 661.3024,-158.6469 658.61,-165.1084"/>
</g>
<!-- processReplicaLeaderElection -->
<g id="node18" class="node">
<title>processReplicaLeaderElection</title>
<polygon fill="none" stroke="#000000" points="1149.3146,-426.1453 962.8162,-426.1453 962.8162,-390.1453 1149.3146,-390.1453 1149.3146,-426.1453"/>
<text text-anchor="middle" x="1056.0654" y="-403.9453" font-family="Times,serif" font-size="14.00" fill="#000000">processReplicaLeaderElection</text>
</g>
<!-- controller_electLeaders&#45;&gt;processReplicaLeaderElection -->
<g id="edge15" class="edge">
<title>controller_electLeaders&#45;&gt;processReplicaLeaderElection</title>
<path fill="none" stroke="#000000" d="M814.3309,-408.1453C850.9691,-408.1453 904.9772,-408.1453 952.6562,-408.1453"/>
<polygon fill="#000000" stroke="#000000" points="952.7258,-411.6454 962.7258,-408.1453 952.7257,-404.6454 952.7258,-411.6454"/>
</g>
<!-- handleStateChange -->
<g id="node14" class="node">
<title>handleStateChange</title>
<polygon fill="none" stroke="#000000" points="1428.6133,-540.5453 1428.6133,-623.7452 1596.2686,-623.7452 1596.2686,-540.5453 1428.6133,-540.5453"/>
<text text-anchor="middle" x="1512.4409" y="-608.5452" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange</text>
<polyline fill="none" stroke="#000000" points="1428.6133,-601.7452 1596.2686,-601.7452 "/>
<text text-anchor="start" x="1436.6133" y="-586.5452" font-family="Times,serif" font-size="14.00" fill="#000000">将partion状态改变转换为</text>
<text text-anchor="start" x="1436.6133" y="-566.9453" font-family="Times,serif" font-size="14.00" fill="#000000"> LeaderAndIsrReuest</text>
<text text-anchor="start" x="1436.6133" y="-552.9453" font-family="Times,serif" font-size="14.00" fill="#000000"> 群发给所有的broker</text>
</g>
<!-- electLeaderForPartitions -->
<g id="node15" class="node">
<title>electLeaderForPartitions</title>
<polygon fill="none" stroke="#000000" points="1831.3887,-600.1453 1676.6006,-600.1453 1676.6006,-564.1453 1831.3887,-564.1453 1831.3887,-600.1453"/>
<text text-anchor="middle" x="1753.9946" y="-577.9453" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaderForPartitions</text>
</g>
<!-- handleStateChange&#45;&gt;electLeaderForPartitions -->
<g id="edge13" class="edge">
<title>handleStateChange&#45;&gt;electLeaderForPartitions</title>
<path fill="none" stroke="#000000" d="M1596.5856,-582.1453C1619.2392,-582.1453 1643.7919,-582.1453 1666.6173,-582.1453"/>
<polygon fill="#000000" stroke="#000000" points="1666.6254,-585.6454 1676.6253,-582.1453 1666.6253,-578.6454 1666.6254,-585.6454"/>
</g>
<!-- sendRequest -->
<g id="node17" class="node">
<title>sendRequest</title>
<polygon fill="none" stroke="#000000" points="1632.2686,-398.7454 1632.2686,-487.5451 1875.7207,-487.5451 1875.7207,-398.7454 1632.2686,-398.7454"/>
<text text-anchor="middle" x="1753.9946" y="-472.3451" font-family="Times,serif" font-size="14.00" fill="#000000">sendRequest</text>
<polyline fill="none" stroke="#000000" points="1632.2686,-465.5451 1875.7207,-465.5451 "/>
<text text-anchor="start" x="1640.2686" y="-450.3451" font-family="Times,serif" font-size="14.00" fill="#000000">Controller和每个broker之间</text>
<text text-anchor="start" x="1640.2686" y="-430.7452" font-family="Times,serif" font-size="14.00" fill="#000000"> 都有个发送请求的线程</text>
<text text-anchor="middle" x="1753.9946" y="-411.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> 线程由ControllerChannelManager管理</text>
</g>
<!-- handleStateChange&#45;&gt;sendRequest -->
<g id="edge17" class="edge">
<title>handleStateChange&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1584.915,-540.4407C1610.9974,-525.4318 1640.6781,-508.3523 1667.814,-492.7371"/>
<polygon fill="#000000" stroke="#000000" points="1669.6055,-495.7445 1676.5272,-487.7232 1666.1141,-489.6773 1669.6055,-495.7445"/>
</g>
<!-- doElectLeaderForPartitions -->
<g id="node16" class="node">
<title>doElectLeaderForPartitions</title>
<polygon fill="#f38181" stroke="#000000" points="1911.7207,-557.3453 1911.7207,-606.9452 2082.4521,-606.9452 2082.4521,-557.3453 1911.7207,-557.3453"/>
<text text-anchor="middle" x="1997.0864" y="-591.7452" font-family="Times,serif" font-size="14.00" fill="#000000">doElectLeaderForPartitions</text>
<polyline fill="none" stroke="#000000" points="1911.7207,-584.9452 2082.4521,-584.9452 "/>
<text text-anchor="start" x="1919.7207" y="-569.7452" font-family="Times,serif" font-size="14.00" fill="#000000">根据选举策略做选举</text>
</g>
<!-- electLeaderForPartitions&#45;&gt;doElectLeaderForPartitions -->
<g id="edge14" class="edge">
<title>electLeaderForPartitions&#45;&gt;doElectLeaderForPartitions</title>
<path fill="none" stroke="#000000" d="M1831.2444,-582.1453C1853.5275,-582.1453 1878.1117,-582.1453 1901.3725,-582.1453"/>
<polygon fill="#000000" stroke="#000000" points="1901.6004,-585.6454 1911.6004,-582.1453 1901.6003,-578.6454 1901.6004,-585.6454"/>
</g>
<!-- sendRequest&#45;&gt;handleLeaderAndIsrRequest -->
<g id="edge20" class="edge">
<title>sendRequest&#45;&gt;handleLeaderAndIsrRequest</title>
<path fill="none" stroke="#000000" d="M1751.6828,-398.4295C1744.5555,-312.1382 1715.4596,-123.6362 1596.6963,-38.1453 1490.3449,38.411 1433.2289,-24.1453 1302.189,-24.1453 771.042,-24.1453 771.042,-24.1453 771.042,-24.1453 627.3889,-24.1453 587.8156,-14.3598 448.9521,-51.1453 418.3822,-59.2434 386.082,-74.315 361.679,-87.1977"/>
<polygon fill="#000000" stroke="#000000" points="359.8825,-84.1898 352.7331,-92.0089 363.198,-90.3548 359.8825,-84.1898"/>
</g>
<!-- sendRequest&#45;&gt;handleElectReplicaLeader -->
<g id="edge21" class="edge">
<title>sendRequest&#45;&gt;handleElectReplicaLeader</title>
<path fill="none" stroke="#000000" d="M1749.545,-398.4588C1738.9683,-318.7456 1704.507,-153.3493 1596.6963,-78.1453 1489.1838,-3.1493 1433.2741,-62.1453 1302.189,-62.1453 771.042,-62.1453 771.042,-62.1453 771.042,-62.1453 699.3989,-62.1453 509.2223,-37.4122 448.9521,-76.1453 423.347,-92.6006 441.3676,-117.8544 417.8247,-137.1453 416.2165,-138.463 414.5479,-139.7166 412.8281,-140.9091"/>
<polygon fill="#000000" stroke="#000000" points="410.5678,-138.1875 403.8457,-146.3769 414.2075,-144.1669 410.5678,-138.1875"/>
</g>
<!-- onReplicaElection -->
<g id="node19" class="node">
<title>onReplicaElection</title>
<polygon fill="none" stroke="#000000" points="1362.0969,-553.1453 1242.281,-553.1453 1242.281,-517.1453 1362.0969,-517.1453 1362.0969,-553.1453"/>
<text text-anchor="middle" x="1302.189" y="-530.9453" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicaElection</text>
</g>
<!-- processReplicaLeaderElection&#45;&gt;onReplicaElection -->
<g id="edge26" class="edge">
<title>processReplicaLeaderElection&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1149.2853,-424.8165C1158.4259,-427.7358 1167.4024,-431.1518 1175.7646,-435.1453 1215.1859,-453.9714 1253.5397,-487.0217 1277.4694,-509.9484"/>
<polygon fill="#000000" stroke="#000000" points="1275.1093,-512.5355 1284.715,-517.0055 1279.9934,-507.521 1275.1093,-512.5355"/>
</g>
<!-- onReplicaElection&#45;&gt;handleStateChange -->
<g id="edge16" class="edge">
<title>onReplicaElection&#45;&gt;handleStateChange</title>
<path fill="none" stroke="#000000" d="M1362.1574,-548.5507C1379.7285,-552.4786 1399.3777,-556.871 1418.5252,-561.1512"/>
<polygon fill="#000000" stroke="#000000" points="1417.956,-564.6103 1428.4787,-563.3762 1419.4831,-557.7789 1417.956,-564.6103"/>
</g>
<!-- onBrokerFailure -->
<g id="node20" class="node">
<title>onBrokerFailure</title>
<polygon fill="#f38181" stroke="#000000" points="959.7964,-660.7454 959.7964,-749.5451 1152.3345,-749.5451 1152.3345,-660.7454 959.7964,-660.7454"/>
<text text-anchor="middle" x="1056.0654" y="-734.3451" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerFailure</text>
<polyline fill="none" stroke="#000000" points="959.7964,-727.5451 1152.3345,-727.5451 "/>
<text text-anchor="start" x="967.7964" y="-712.3451" font-family="Times,serif" font-size="14.00" fill="#000000">broker下线了，它上面的所有</text>
<text text-anchor="start" x="967.7964" y="-692.7452" font-family="Times,serif" font-size="14.00" fill="#000000"> leader partition都下线了</text>
<text text-anchor="middle" x="1056.0654" y="-673.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> , 需要重新选取leader</text>
</g>
<!-- onReplicaBecomeOffline -->
<g id="node21" class="node">
<title>onReplicaBecomeOffline</title>
<polygon fill="none" stroke="#000000" points="1381.4793,-661.1453 1222.8987,-661.1453 1222.8987,-625.1453 1381.4793,-625.1453 1381.4793,-661.1453"/>
<text text-anchor="middle" x="1302.189" y="-638.9453" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicaBecomeOffline</text>
</g>
<!-- onBrokerFailure&#45;&gt;onReplicaBecomeOffline -->
<g id="edge18" class="edge">
<title>onBrokerFailure&#45;&gt;onReplicaBecomeOffline</title>
<path fill="none" stroke="#000000" d="M1152.6336,-680.8192C1175.1735,-675.1412 1198.9583,-669.1497 1220.7655,-663.6563"/>
<polygon fill="#000000" stroke="#000000" points="1221.7923,-667.0071 1230.6343,-661.1703 1220.0823,-660.2192 1221.7923,-667.0071"/>
</g>
<!-- onReplicaBecomeOffline&#45;&gt;handleStateChange -->
<g id="edge19" class="edge">
<title>onReplicaBecomeOffline&#45;&gt;handleStateChange</title>
<path fill="none" stroke="#000000" d="M1364.4181,-625.0908C1381.4568,-620.1474 1400.3102,-614.6775 1418.694,-609.3439"/>
<polygon fill="#000000" stroke="#000000" points="1419.9185,-612.633 1428.5472,-606.4852 1417.968,-605.9103 1419.9185,-612.633"/>
</g>
<!-- onBrokerStartup -->
<g id="node22" class="node">
<title>onBrokerStartup</title>
<polygon fill="#f38181" stroke="#000000" points="16,-444.3453 16,-507.9452 194.5381,-507.9452 194.5381,-444.3453 16,-444.3453"/>
<text text-anchor="middle" x="105.269" y="-492.7452" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerStartup</text>
<polyline fill="none" stroke="#000000" points="16,-485.9452 194.5381,-485.9452 "/>
<text text-anchor="start" x="24" y="-470.7452" font-family="Times,serif" font-size="14.00" fill="#000000">新启动一个broker可能触发</text>
<text text-anchor="middle" x="105.269" y="-451.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> partition leader rebalance;</text>
</g>
<!-- maybeResumeReassignments -->
<g id="node23" class="node">
<title>maybeResumeReassignments</title>
<polygon fill="none" stroke="#000000" points="413.1597,-492.1453 230.3306,-492.1453 230.3306,-456.1453 413.1597,-456.1453 413.1597,-492.1453"/>
<text text-anchor="middle" x="321.7451" y="-469.9453" font-family="Times,serif" font-size="14.00" fill="#000000">maybeResumeReassignments</text>
</g>
<!-- onBrokerStartup&#45;&gt;maybeResumeReassignments -->
<g id="edge22" class="edge">
<title>onBrokerStartup&#45;&gt;maybeResumeReassignments</title>
<path fill="none" stroke="#000000" d="M194.568,-475.3202C203.0227,-475.2421 211.6365,-475.1625 220.1944,-475.0835"/>
<polygon fill="#000000" stroke="#000000" points="220.2349,-478.5834 230.2021,-474.991 220.1701,-471.5837 220.2349,-478.5834"/>
</g>
<!-- onPartitionReassignment -->
<g id="node24" class="node">
<title>onPartitionReassignment</title>
<polygon fill="none" stroke="#000000" points="605.6008,-490.1453 449.0692,-490.1453 449.0692,-454.1453 605.6008,-454.1453 605.6008,-490.1453"/>
<text text-anchor="middle" x="527.335" y="-467.9453" font-family="Times,serif" font-size="14.00" fill="#000000">onPartitionReassignment</text>
</g>
<!-- maybeResumeReassignments&#45;&gt;onPartitionReassignment -->
<g id="edge23" class="edge">
<title>maybeResumeReassignments&#45;&gt;onPartitionReassignment</title>
<path fill="none" stroke="#000000" d="M413.1171,-473.2564C421.58,-473.1741 430.1475,-473.0907 438.5863,-473.0086"/>
<polygon fill="#000000" stroke="#000000" points="438.8348,-476.5065 448.8002,-472.9093 438.7666,-469.5068 438.8348,-476.5065"/>
</g>
<!-- removePartitionFromReassigningPartitions -->
<g id="node25" class="node">
<title>removePartitionFromReassigningPartitions</title>
<polygon fill="none" stroke="#000000" points="900.1907,-487.1453 641.8933,-487.1453 641.8933,-451.1453 900.1907,-451.1453 900.1907,-487.1453"/>
<text text-anchor="middle" x="771.042" y="-464.9453" font-family="Times,serif" font-size="14.00" fill="#000000">removePartitionFromReassigningPartitions</text>
</g>
<!-- onPartitionReassignment&#45;&gt;removePartitionFromReassigningPartitions -->
<g id="edge24" class="edge">
<title>onPartitionReassignment&#45;&gt;removePartitionFromReassigningPartitions</title>
<path fill="none" stroke="#000000" d="M605.7869,-471.1795C614.1781,-471.0762 622.8852,-470.9691 631.7173,-470.8603"/>
<polygon fill="#000000" stroke="#000000" points="631.7759,-474.36 641.732,-470.737 631.6897,-467.3605 631.7759,-474.36"/>
</g>
<!-- removePartitionFromReassigningPartitions&#45;&gt;processReplicaLeaderElection -->
<g id="edge25" class="edge">
<title>removePartitionFromReassigningPartitions&#45;&gt;processReplicaLeaderElection</title>
<path fill="none" stroke="#000000" d="M855.4015,-451.0908C888.8683,-443.9284 927.4994,-435.6606 961.8757,-428.3035"/>
<polygon fill="#000000" stroke="#000000" points="962.8763,-431.6687 971.9223,-426.1534 961.4113,-424.8237 962.8763,-431.6687"/>
</g>
<!-- onControllerFailover -->
<g id="node26" class="node">
<title>onControllerFailover</title>
<polygon fill="#f38181" stroke="#000000" points="961.5635,-552.7454 961.5635,-641.5451 1150.5674,-641.5451 1150.5674,-552.7454 961.5635,-552.7454"/>
<text text-anchor="middle" x="1056.0654" y="-626.3451" font-family="Times,serif" font-size="14.00" fill="#000000">onControllerFailover</text>
<polyline fill="none" stroke="#000000" points="961.5635,-619.5451 1150.5674,-619.5451 "/>
<text text-anchor="start" x="969.5635" y="-604.3451" font-family="Times,serif" font-size="14.00" fill="#000000">Controller故障了</text>
<text text-anchor="start" x="969.5635" y="-584.7452" font-family="Times,serif" font-size="14.00" fill="#000000"> 会选举新的controller</text>
<text text-anchor="middle" x="1056.0654" y="-565.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> ,然后触发新的leader election</text>
</g>
<!-- onControllerFailover&#45;&gt;onReplicaElection -->
<g id="edge27" class="edge">
<title>onControllerFailover&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1150.8712,-573.2631C1178.0087,-566.427 1207.0842,-559.1027 1232.4231,-552.7197"/>
<polygon fill="#000000" stroke="#000000" points="1233.461,-556.0677 1242.3031,-550.2309 1231.751,-549.2797 1233.461,-556.0677"/>
</g>
<!-- checkAndTriggerAutoLeaderRebalance -->
<g id="node27" class="node">
<title>checkAndTriggerAutoLeaderRebalance</title>
<polygon fill="#f38181" stroke="#000000" points="936.3662,-444.7454 936.3662,-533.5451 1175.7646,-533.5451 1175.7646,-444.7454 936.3662,-444.7454"/>
<text text-anchor="middle" x="1056.0654" y="-518.3451" font-family="Times,serif" font-size="14.00" fill="#000000">checkAndTriggerAutoLeaderRebalance</text>
<polyline fill="none" stroke="#000000" points="936.3662,-511.5451 1175.7646,-511.5451 "/>
<text text-anchor="start" x="944.3662" y="-496.3451" font-family="Times,serif" font-size="14.00" fill="#000000">后台周期性检查</text>
<text text-anchor="start" x="944.3662" y="-476.7452" font-family="Times,serif" font-size="14.00" fill="#000000"> 是否要leader rebalance</text>
<text text-anchor="start" x="944.3662" y="-457.1453" font-family="Times,serif" font-size="14.00" fill="#000000"> 需要的话会触发leader election</text>
</g>
<!-- checkAndTriggerAutoLeaderRebalance&#45;&gt;onReplicaElection -->
<g id="edge28" class="edge">
<title>checkAndTriggerAutoLeaderRebalance&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1175.8827,-511.5389C1195.1976,-515.1488 1214.6192,-518.7786 1232.2424,-522.0724"/>
<polygon fill="#000000" stroke="#000000" points="1231.9236,-525.5733 1242.3964,-523.9702 1233.2097,-518.6925 1231.9236,-525.5733"/>
</g>
<!-- partitionAssignments -->
<g id="node28" class="node">
<title>partitionAssignments</title>
<polygon fill="#95e1d3" stroke="#000000" points="173.0417,-426.1453 41.4964,-426.1453 37.4964,-422.1453 37.4964,-390.1453 169.0417,-390.1453 173.0417,-394.1453 173.0417,-426.1453"/>
<polyline fill="none" stroke="#000000" points="169.0417,-422.1453 37.4964,-422.1453 "/>
<polyline fill="none" stroke="#000000" points="169.0417,-422.1453 169.0417,-390.1453 "/>
<polyline fill="none" stroke="#000000" points="169.0417,-422.1453 173.0417,-426.1453 "/>
<text text-anchor="middle" x="105.269" y="-403.9453" font-family="Times,serif" font-size="14.00" fill="#000000">partitionAssignments</text>
</g>
<!-- admin_electLeaders -->
<g id="node29" class="node">
<title>admin_electLeaders</title>
<polygon fill="#f38181" stroke="#000000" points="33.9067,-139.3453 33.9067,-188.9452 176.6313,-188.9452 176.6313,-139.3453 33.9067,-139.3453"/>
<text text-anchor="middle" x="105.269" y="-173.7452" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
<polyline fill="none" stroke="#000000" points="33.9067,-166.9452 176.6313,-166.9452 "/>
<text text-anchor="middle" x="105.269" y="-151.7452" font-family="Times,serif" font-size="14.00" fill="#000000">手动出发electLeaders</text>
</g>
<!-- admin_electLeaders&#45;&gt;handleElectReplicaLeader -->
<g id="edge29" class="edge">
<title>admin_electLeaders&#45;&gt;handleElectReplicaLeader</title>
<path fill="none" stroke="#000000" d="M176.7514,-164.1453C193.635,-164.1453 211.8725,-164.1453 229.5284,-164.1453"/>
<polygon fill="#000000" stroke="#000000" points="229.8421,-167.6454 239.8421,-164.1453 229.8421,-160.6454 229.8421,-167.6454"/>
</g>
</g>
</svg>
