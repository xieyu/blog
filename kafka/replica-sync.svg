<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: replica_sync Pages: 1 -->
<svg width="2846pt" height="648pt"
 viewBox="0.00 0.00 2846.00 648.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 644)">
<title>replica_sync</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-644 2842,-644 2842,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_BlockingSend</title>
<polygon fill="none" stroke="#000000" points="1632,-292 1632,-400 1800,-400 1800,-292 1632,-292"/>
<text text-anchor="middle" x="1716" y="-380" font-family="Times,serif" font-size="20.00" fill="#000000">BlockingSend</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_FetchSessionHandler</title>
<polygon fill="none" stroke="#000000" points="1300.5,-8 1300.5,-90 1485.5,-90 1485.5,-8 1300.5,-8"/>
<text text-anchor="middle" x="1393" y="-70" font-family="Times,serif" font-size="20.00" fill="#000000">FetchSessionHandler</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_fetcherThread</title>
<polygon fill="none" stroke="#000000" points="383,-98 383,-488 1561,-488 1561,-98 383,-98"/>
<text text-anchor="middle" x="972" y="-468" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaFetcherThread</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_replicaFetcherManager</title>
<polygon fill="none" stroke="#000000" points="162,-496 162,-632 689,-632 689,-496 162,-496"/>
<text text-anchor="middle" x="425.5" y="-612" font-family="Times,serif" font-size="20.00" fill="#000000">replicaFetcherManager</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_ZkServer</title>
<polygon fill="none" stroke="#000000" points="2676,-258 2676,-420 2830,-420 2830,-258 2676,-258"/>
<text text-anchor="middle" x="2753" y="-400" font-family="Times,serif" font-size="20.00" fill="#000000">ZkServer</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_log</title>
<polygon fill="none" stroke="#000000" points="2204.5,-439 2204.5,-521 2484,-521 2484,-439 2204.5,-439"/>
<text text-anchor="middle" x="2344.25" y="-501" font-family="Times,serif" font-size="20.00" fill="#000000">log</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_PartionLeaderBroker</title>
<polygon fill="none" stroke="#000000" points="2171,-277 2171,-431 2664,-431 2664,-277 2171,-277"/>
<text text-anchor="middle" x="2417.5" y="-411" font-family="Times,serif" font-size="20.00" fill="#000000">Broker: PartitionLeader </text>
</g>
<g id="clust16" class="cluster">
<title>cluster_Partition</title>
<polygon fill="none" stroke="#000000" points="2385,-298 2385,-380 2656,-380 2656,-298 2385,-298"/>
<text text-anchor="middle" x="2520.5" y="-360" font-family="Times,serif" font-size="20.00" fill="#000000">Partition</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_ReplicaManager</title>
<polygon fill="none" stroke="#000000" points="2179,-285 2179,-393 2365,-393 2365,-285 2179,-285"/>
<text text-anchor="middle" x="2272" y="-373" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_Partition</title>
<polygon fill="none" stroke="#000000" points="1581,-416 1581,-509 2159,-509 2159,-416 1581,-416"/>
<text text-anchor="middle" x="1870" y="-489" font-family="Times,serif" font-size="20.00" fill="#000000">Partition</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_replicaManager</title>
<polygon fill="none" stroke="#000000" points="0,-496 0,-578 142,-578 142,-496 0,-496"/>
<text text-anchor="middle" x="71" y="-558" font-family="Times,serif" font-size="20.00" fill="#000000">replicaManager</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_KafkaApi</title>
<polygon fill="none" stroke="#000000" points="1944,-302 1944,-384 2086,-384 2086,-302 1944,-302"/>
<text text-anchor="middle" x="2015" y="-364" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<!-- leaderEndpoint_sendRequest -->
<g id="node1" class="node">
<title>leaderEndpoint_sendRequest</title>
<polygon fill="none" stroke="#000000" points="1640,-300.5 1640,-361.5 1792,-361.5 1792,-300.5 1640,-300.5"/>
<text text-anchor="middle" x="1716" y="-346.3" font-family="Times,serif" font-size="14.00" fill="#000000">sendRequest</text>
<polyline fill="none" stroke="#000000" points="1640,-338.5 1792,-338.5 "/>
<text text-anchor="start" x="1648" y="-323.3" font-family="Times,serif" font-size="14.00" fill="#000000">向partionLeader </text>
<text text-anchor="middle" x="1716" y="-308.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 发送fetchMessage请求</text>
</g>
<!-- handleFetchRequest -->
<g id="node33" class="node">
<title>handleFetchRequest</title>
<polygon fill="none" stroke="#000000" points="2078,-346 1952,-346 1952,-310 2078,-310 2078,-346"/>
<text text-anchor="middle" x="2015" y="-324.3" font-family="Times,serif" font-size="14.00" fill="#000000">handleFetchRequest</text>
</g>
<!-- leaderEndpoint_sendRequest&#45;&gt;handleFetchRequest -->
<g id="edge32" class="edge">
<title>leaderEndpoint_sendRequest&#45;&gt;handleFetchRequest</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1792.224,-330.2352C1838.0675,-329.7752 1896.124,-329.1927 1941.4758,-328.7377"/>
<polygon fill="#000000" stroke="#000000" points="1941.5726,-332.237 1951.5369,-328.6368 1941.5023,-325.2374 1941.5726,-332.237"/>
</g>
<!-- FetchSessionHandler -->
<g id="node2" class="node">
<title>FetchSessionHandler</title>
<polygon fill="none" stroke="#000000" points="1458.5,-52 1327.5,-52 1327.5,-16 1458.5,-16 1458.5,-52"/>
<text text-anchor="middle" x="1393" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#000000">FetchSessionHandler</text>
</g>
<!-- addPartitions -->
<g id="node3" class="node">
<title>addPartitions</title>
<polygon fill="none" stroke="#000000" points="479,-450 391,-450 391,-414 479,-414 479,-450"/>
<text text-anchor="middle" x="435" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#000000">addPartitions</text>
</g>
<!-- ReplicaFetcherThread -->
<g id="node4" class="node">
<title>ReplicaFetcherThread</title>
<polygon fill="none" stroke="#000000" points="854,-450 717,-450 717,-414 854,-414 854,-450"/>
<text text-anchor="middle" x="785.5" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#000000">ReplicaFetcherThread</text>
</g>
<!-- fetcherThread_start -->
<g id="node5" class="node">
<title>fetcherThread_start</title>
<polygon fill="none" stroke="#000000" points="644,-381 590,-381 590,-345 644,-345 644,-381"/>
<text text-anchor="middle" x="617" y="-359.3" font-family="Times,serif" font-size="14.00" fill="#000000">start</text>
</g>
<!-- doWork -->
<g id="node6" class="node">
<title>doWork</title>
<polygon fill="none" stroke="#000000" points="816.5,-313 754.5,-313 754.5,-277 816.5,-277 816.5,-313"/>
<text text-anchor="middle" x="785.5" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#000000">doWork</text>
</g>
<!-- fetcherThread_start&#45;&gt;doWork -->
<g id="edge1" class="edge">
<title>fetcherThread_start&#45;&gt;doWork</title>
<path fill="none" stroke="#000000" d="M644.0724,-352.0746C671.3882,-341.0511 713.8871,-323.9001 745.1708,-311.2753"/>
<polygon fill="#000000" stroke="#000000" points="746.5267,-314.5024 754.4902,-307.5143 743.907,-308.0111 746.5267,-314.5024"/>
</g>
<!-- maybeTruncate -->
<g id="node8" class="node">
<title>maybeTruncate</title>
<polygon fill="none" stroke="#000000" points="991,-256 890,-256 890,-220 991,-220 991,-256"/>
<text text-anchor="middle" x="940.5" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeTruncate</text>
</g>
<!-- doWork&#45;&gt;maybeTruncate -->
<g id="edge2" class="edge">
<title>doWork&#45;&gt;maybeTruncate</title>
<path fill="none" stroke="#000000" d="M816.8666,-283.4652C835.5143,-276.6076 859.7648,-267.6897 881.8432,-259.5706"/>
<polygon fill="#000000" stroke="#000000" points="883.2995,-262.7642 891.477,-256.0278 880.8835,-256.1944 883.2995,-262.7642"/>
</g>
<!-- maybeFetch -->
<g id="node9" class="node">
<title>maybeFetch</title>
<polygon fill="none" stroke="#000000" points="982,-313 899,-313 899,-277 982,-277 982,-313"/>
<text text-anchor="middle" x="940.5" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeFetch</text>
</g>
<!-- doWork&#45;&gt;maybeFetch -->
<g id="edge3" class="edge">
<title>doWork&#45;&gt;maybeFetch</title>
<path fill="none" stroke="#000000" d="M816.8666,-295C837.4407,-295 864.835,-295 888.6076,-295"/>
<polygon fill="#000000" stroke="#000000" points="888.8896,-298.5001 898.8896,-295 888.8896,-291.5001 888.8896,-298.5001"/>
</g>
<!-- fetchFromLeader -->
<g id="node7" class="node">
<title>fetchFromLeader</title>
<polygon fill="#f38181" stroke="#000000" points="1325.5,-322.5 1325.5,-383.5 1460.5,-383.5 1460.5,-322.5 1325.5,-322.5"/>
<text text-anchor="middle" x="1393" y="-368.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchFromLeader</text>
<polyline fill="none" stroke="#000000" points="1325.5,-360.5 1460.5,-360.5 "/>
<text text-anchor="start" x="1333.5" y="-345.3" font-family="Times,serif" font-size="14.00" fill="#000000">向partionLeader发送</text>
<text text-anchor="start" x="1333.5" y="-330.3" font-family="Times,serif" font-size="14.00" fill="#000000"> fetchMessage请求</text>
</g>
<!-- fetchFromLeader&#45;&gt;leaderEndpoint_sendRequest -->
<g id="edge9" class="edge">
<title>fetchFromLeader&#45;&gt;leaderEndpoint_sendRequest</title>
<path fill="none" stroke="#000000" d="M1460.7114,-348.3881C1509.8933,-345.0382 1576.8339,-340.4788 1629.8287,-336.8693"/>
<polygon fill="#000000" stroke="#000000" points="1630.1538,-340.3553 1639.8929,-336.1838 1629.6781,-333.3715 1630.1538,-340.3553"/>
</g>
<!-- fetchTruncatingPartitions -->
<g id="node14" class="node">
<title>fetchTruncatingPartitions</title>
<polygon fill="none" stroke="#000000" points="1189.5,-142 1034.5,-142 1034.5,-106 1189.5,-106 1189.5,-142"/>
<text text-anchor="middle" x="1112" y="-120.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchTruncatingPartitions</text>
</g>
<!-- maybeTruncate&#45;&gt;fetchTruncatingPartitions -->
<g id="edge11" class="edge">
<title>maybeTruncate&#45;&gt;fetchTruncatingPartitions</title>
<path fill="none" stroke="#000000" d="M954.1476,-219.7757C969.7387,-200.1567 997.001,-169.3069 1027,-151 1029.6248,-149.3982 1032.3539,-147.8825 1035.1553,-146.449"/>
<polygon fill="#000000" stroke="#000000" points="1036.7475,-149.5681 1044.3089,-142.1467 1033.7699,-143.2329 1036.7475,-149.5681"/>
</g>
<!-- truncateToEpochEndOffsets -->
<g id="node15" class="node">
<title>truncateToEpochEndOffsets</title>
<polygon fill="none" stroke="#000000" points="1197,-316 1027,-316 1027,-280 1197,-280 1197,-316"/>
<text text-anchor="middle" x="1112" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#000000">truncateToEpochEndOffsets</text>
</g>
<!-- maybeTruncate&#45;&gt;truncateToEpochEndOffsets -->
<g id="edge12" class="edge">
<title>maybeTruncate&#45;&gt;truncateToEpochEndOffsets</title>
<path fill="none" stroke="#000000" d="M986.5596,-256.1284C999.5796,-261.1011 1013.7984,-266.3892 1027,-271 1032.525,-272.9297 1038.2715,-274.8781 1044.0535,-276.7976"/>
<polygon fill="#000000" stroke="#000000" points="1043.1922,-280.1986 1053.7851,-279.9925 1045.3757,-273.5479 1043.1922,-280.1986"/>
</g>
<!-- truncateToHighWatermark -->
<g id="node16" class="node">
<title>truncateToHighWatermark</title>
<polygon fill="none" stroke="#000000" points="1194,-196 1030,-196 1030,-160 1194,-160 1194,-196"/>
<text text-anchor="middle" x="1112" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#000000">truncateToHighWatermark</text>
</g>
<!-- maybeTruncate&#45;&gt;truncateToHighWatermark -->
<g id="edge13" class="edge">
<title>maybeTruncate&#45;&gt;truncateToHighWatermark</title>
<path fill="none" stroke="#000000" d="M988.4299,-219.9182C1000.9511,-215.2908 1014.4544,-210.3853 1027,-206 1033.3067,-203.7955 1039.8929,-201.5416 1046.4868,-199.3171"/>
<polygon fill="#000000" stroke="#000000" points="1047.7519,-202.5845 1056.1214,-196.0881 1045.5275,-195.9473 1047.7519,-202.5845"/>
</g>
<!-- buildFetch -->
<g id="node10" class="node">
<title>buildFetch</title>
<polygon fill="none" stroke="#000000" points="1061.5,-215 1061.5,-261 1162.5,-261 1162.5,-215 1061.5,-215"/>
<text text-anchor="middle" x="1112" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#000000">buildFetch</text>
<polyline fill="none" stroke="#000000" points="1061.5,-238 1162.5,-238 "/>
<text text-anchor="start" x="1069.5" y="-222.8" font-family="Times,serif" font-size="14.00" fill="#000000">构造fetch请求</text>
</g>
<!-- maybeFetch&#45;&gt;buildFetch -->
<g id="edge4" class="edge">
<title>maybeFetch&#45;&gt;buildFetch</title>
<path fill="none" stroke="#000000" d="M982.0154,-281.2019C1002.92,-274.254 1028.6545,-265.7008 1051.6943,-258.0433"/>
<polygon fill="#000000" stroke="#000000" points="1052.9959,-261.299 1061.3815,-254.8236 1050.788,-254.6563 1052.9959,-261.299"/>
</g>
<!-- processFetchRequest -->
<g id="node11" class="node">
<title>processFetchRequest</title>
<polygon fill="none" stroke="#000000" points="1177.5,-370 1046.5,-370 1046.5,-334 1177.5,-334 1177.5,-370"/>
<text text-anchor="middle" x="1112" y="-348.3" font-family="Times,serif" font-size="14.00" fill="#000000">processFetchRequest</text>
</g>
<!-- maybeFetch&#45;&gt;processFetchRequest -->
<g id="edge5" class="edge">
<title>maybeFetch&#45;&gt;processFetchRequest</title>
<path fill="none" stroke="#000000" d="M982.2216,-309.718C996.4056,-314.6555 1012.3681,-320.1397 1027,-325 1032.648,-326.8761 1038.5163,-328.7975 1044.4112,-330.7083"/>
<polygon fill="#000000" stroke="#000000" points="1043.7314,-334.1666 1054.323,-333.9042 1045.8796,-327.5043 1043.7314,-334.1666"/>
</g>
<!-- buildFetch&#45;&gt;FetchSessionHandler -->
<g id="edge10" class="edge">
<title>buildFetch&#45;&gt;FetchSessionHandler</title>
<path fill="none" stroke="#000000" d="M1162.7409,-226.5898C1175.2838,-221.7041 1187.759,-214.7804 1197,-205 1232.6184,-167.3024 1197.1644,-131.4912 1233,-94 1255.2843,-70.6862 1287.4951,-56.3531 1317.1833,-47.5776"/>
<polygon fill="#000000" stroke="#000000" points="1318.4402,-50.861 1327.1368,-44.8097 1316.5647,-44.1169 1318.4402,-50.861"/>
</g>
<!-- processFetchRequest&#45;&gt;fetchFromLeader -->
<g id="edge6" class="edge">
<title>processFetchRequest&#45;&gt;fetchFromLeader</title>
<path fill="none" stroke="#000000" d="M1177.5274,-352.2332C1218.6652,-352.3796 1271.9301,-352.5691 1315.2081,-352.7232"/>
<polygon fill="#000000" stroke="#000000" points="1315.4004,-356.2238 1325.4128,-352.7595 1315.4253,-349.2238 1315.4004,-356.2238"/>
</g>
<!-- processPartitionData -->
<g id="node12" class="node">
<title>processPartitionData</title>
<polygon fill="none" stroke="#000000" points="1298,-403 1298,-449 1488,-449 1488,-403 1298,-403"/>
<text text-anchor="middle" x="1393" y="-433.8" font-family="Times,serif" font-size="14.00" fill="#000000">processPartitionData</text>
<polyline fill="none" stroke="#000000" points="1298,-426 1488,-426 "/>
<text text-anchor="middle" x="1393" y="-410.8" font-family="Times,serif" font-size="14.00" fill="#000000">存储取到的partion leader msg</text>
</g>
<!-- processFetchRequest&#45;&gt;processPartitionData -->
<g id="edge7" class="edge">
<title>processFetchRequest&#45;&gt;processPartitionData</title>
<path fill="none" stroke="#000000" d="M1160.7356,-370.0439C1182.6352,-377.7541 1208.9187,-386.4635 1233,-393 1250.6336,-397.7864 1269.5245,-402.2536 1287.9233,-406.2591"/>
<polygon fill="#000000" stroke="#000000" points="1287.274,-409.6994 1297.7855,-408.3732 1288.7413,-402.8549 1287.274,-409.6994"/>
</g>
<!-- handlePartitionsWithErrors -->
<g id="node13" class="node">
<title>handlePartitionsWithErrors</title>
<polygon fill="none" stroke="#000000" points="1476,-304 1310,-304 1310,-268 1476,-268 1476,-304"/>
<text text-anchor="middle" x="1393" y="-282.3" font-family="Times,serif" font-size="14.00" fill="#000000">handlePartitionsWithErrors</text>
</g>
<!-- processFetchRequest&#45;&gt;handlePartitionsWithErrors -->
<g id="edge8" class="edge">
<title>processFetchRequest&#45;&gt;handlePartitionsWithErrors</title>
<path fill="none" stroke="#000000" d="M1169.1884,-333.9566C1178.4915,-330.9862 1188.0188,-327.9231 1197,-325 1213.0374,-319.7803 1216.636,-317.082 1233,-313 1254.451,-307.649 1277.7869,-303.0414 1299.8359,-299.2242"/>
<polygon fill="#000000" stroke="#000000" points="1300.5893,-302.6465 1309.8646,-297.5261 1299.4206,-295.7448 1300.5893,-302.6465"/>
</g>
<!-- appendRecordsToFollowerOrFutureReplica -->
<g id="node20" class="node">
<title>appendRecordsToFollowerOrFutureReplica</title>
<polygon fill="none" stroke="#000000" points="1589,-424 1589,-470 1843,-470 1843,-424 1589,-424"/>
<text text-anchor="middle" x="1716" y="-454.8" font-family="Times,serif" font-size="14.00" fill="#000000">appendRecordsToFollowerOrFutureReplica</text>
<polyline fill="none" stroke="#000000" points="1589,-447 1843,-447 "/>
<text text-anchor="start" x="1597" y="-431.8" font-family="Times,serif" font-size="14.00" fill="#000000">将records保存起来</text>
</g>
<!-- processPartitionData&#45;&gt;appendRecordsToFollowerOrFutureReplica -->
<g id="edge17" class="edge">
<title>processPartitionData&#45;&gt;appendRecordsToFollowerOrFutureReplica</title>
<path fill="none" stroke="#000000" d="M1488.1637,-432.1871C1516.5021,-434.0295 1548.1387,-436.0864 1578.6046,-438.0672"/>
<polygon fill="#000000" stroke="#000000" points="1578.6791,-441.5793 1588.8852,-438.7356 1579.1333,-434.5941 1578.6791,-441.5793"/>
</g>
<!-- fetchEpochEndOffsets -->
<g id="node17" class="node">
<title>fetchEpochEndOffsets</title>
<polygon fill="none" stroke="#000000" points="1462.5,-196 1323.5,-196 1323.5,-160 1462.5,-160 1462.5,-196"/>
<text text-anchor="middle" x="1393" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchEpochEndOffsets</text>
</g>
<!-- truncateToEpochEndOffsets&#45;&gt;fetchEpochEndOffsets -->
<g id="edge14" class="edge">
<title>truncateToEpochEndOffsets&#45;&gt;fetchEpochEndOffsets</title>
<path fill="none" stroke="#000000" d="M1183.7367,-279.8577C1188.456,-277.2847 1192.9382,-274.349 1197,-271 1222.7803,-249.7439 1205.7923,-224.3956 1233,-205 1256.0856,-188.543 1285.7479,-180.8525 1313.2481,-177.5793"/>
<polygon fill="#000000" stroke="#000000" points="1313.6691,-181.0547 1323.2657,-176.5652 1312.964,-174.0903 1313.6691,-181.0547"/>
</g>
<!-- maybeTruncateToEpochEndOffsets -->
<g id="node18" class="node">
<title>maybeTruncateToEpochEndOffsets</title>
<polygon fill="none" stroke="#000000" points="1499,-250 1287,-250 1287,-214 1499,-214 1499,-250"/>
<text text-anchor="middle" x="1393" y="-228.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeTruncateToEpochEndOffsets</text>
</g>
<!-- truncateToEpochEndOffsets&#45;&gt;maybeTruncateToEpochEndOffsets -->
<g id="edge15" class="edge">
<title>truncateToEpochEndOffsets&#45;&gt;maybeTruncateToEpochEndOffsets</title>
<path fill="none" stroke="#000000" d="M1169.1884,-279.9566C1178.4915,-276.9862 1188.0188,-273.9231 1197,-271 1213.0374,-265.7803 1216.636,-263.082 1233,-259 1246.991,-255.5099 1261.7839,-252.336 1276.4986,-249.4915"/>
<polygon fill="#000000" stroke="#000000" points="1277.4841,-252.8674 1286.6624,-247.5749 1276.187,-245.9886 1277.4841,-252.8674"/>
</g>
<!-- updateFetchOffsetAndMaybeMarkTruncationComplete -->
<g id="node19" class="node">
<title>updateFetchOffsetAndMaybeMarkTruncationComplete</title>
<polygon fill="none" stroke="#000000" points="1553,-142 1233,-142 1233,-106 1553,-106 1553,-142"/>
<text text-anchor="middle" x="1393" y="-120.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchOffsetAndMaybeMarkTruncationComplete</text>
</g>
<!-- truncateToEpochEndOffsets&#45;&gt;updateFetchOffsetAndMaybeMarkTruncationComplete -->
<g id="edge16" class="edge">
<title>truncateToEpochEndOffsets&#45;&gt;updateFetchOffsetAndMaybeMarkTruncationComplete</title>
<path fill="none" stroke="#000000" d="M1186.1543,-279.7666C1190.0803,-277.2166 1193.742,-274.3109 1197,-271 1236.0544,-231.3113 1191.258,-187.8518 1233,-151 1234.1549,-149.9804 1235.3335,-148.992 1236.5342,-148.0341"/>
<polygon fill="#000000" stroke="#000000" points="1238.6697,-150.8098 1244.7638,-142.1431 1234.5952,-145.1178 1238.6697,-150.8098"/>
</g>
<!-- doAppendRecordsToFollowerOrFutureReplica -->
<g id="node31" class="node">
<title>doAppendRecordsToFollowerOrFutureReplica</title>
<polygon fill="none" stroke="#000000" points="2151,-467 1879,-467 1879,-431 2151,-431 2151,-467"/>
<text text-anchor="middle" x="2015" y="-445.3" font-family="Times,serif" font-size="14.00" fill="#000000">doAppendRecordsToFollowerOrFutureReplica</text>
</g>
<!-- appendRecordsToFollowerOrFutureReplica&#45;&gt;doAppendRecordsToFollowerOrFutureReplica -->
<g id="edge27" class="edge">
<title>appendRecordsToFollowerOrFutureReplica&#45;&gt;doAppendRecordsToFollowerOrFutureReplica</title>
<path fill="none" stroke="#000000" d="M1843.2365,-447.8511C1851.6904,-447.9076 1860.2415,-447.9648 1868.7783,-448.0219"/>
<polygon fill="#000000" stroke="#000000" points="1868.7634,-451.5218 1878.7866,-448.0889 1868.8103,-444.522 1868.7634,-451.5218"/>
</g>
<!-- addFetcherForPartitions -->
<g id="node21" class="node">
<title>addFetcherForPartitions</title>
<polygon fill="none" stroke="#000000" points="317,-540 170,-540 170,-504 317,-504 317,-540"/>
<text text-anchor="middle" x="243.5" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">addFetcherForPartitions</text>
</g>
<!-- addFetcherForPartitions&#45;&gt;addPartitions -->
<g id="edge18" class="edge">
<title>addFetcherForPartitions&#45;&gt;addPartitions</title>
<path fill="none" stroke="#000000" d="M282.2529,-503.7872C312.5917,-489.5287 354.9341,-469.6289 387.3452,-454.3965"/>
<polygon fill="#000000" stroke="#000000" points="389.0704,-457.4531 396.632,-450.032 386.0929,-451.1178 389.0704,-457.4531"/>
</g>
<!-- addAndStartFetcherThread -->
<g id="node22" class="node">
<title>addAndStartFetcherThread</title>
<polygon fill="none" stroke="#000000" points="517,-540 353,-540 353,-504 517,-504 517,-540"/>
<text text-anchor="middle" x="435" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">addAndStartFetcherThread</text>
</g>
<!-- addFetcherForPartitions&#45;&gt;addAndStartFetcherThread -->
<g id="edge19" class="edge">
<title>addFetcherForPartitions&#45;&gt;addAndStartFetcherThread</title>
<path fill="none" stroke="#000000" d="M317.265,-522C325.671,-522 334.3161,-522 342.9215,-522"/>
<polygon fill="#000000" stroke="#000000" points="342.9887,-525.5001 352.9887,-522 342.9886,-518.5001 342.9887,-525.5001"/>
</g>
<!-- addAndStartFetcherThread&#45;&gt;fetcherThread_start -->
<g id="edge20" class="edge">
<title>addAndStartFetcherThread&#45;&gt;fetcherThread_start</title>
<path fill="none" stroke="#000000" d="M496.5251,-503.8722C503.7484,-500.4958 510.7579,-496.5612 517,-492 554.7807,-464.3929 585.4287,-418.7279 602.4262,-389.7874"/>
<polygon fill="#000000" stroke="#000000" points="605.5143,-391.4381 607.457,-381.0229 599.4433,-387.9533 605.5143,-391.4381"/>
</g>
<!-- createFetcherThread -->
<g id="node23" class="node">
<title>createFetcherThread</title>
<polygon fill="none" stroke="#000000" points="681,-540 553,-540 553,-504 681,-504 681,-540"/>
<text text-anchor="middle" x="617" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">createFetcherThread</text>
</g>
<!-- addAndStartFetcherThread&#45;&gt;createFetcherThread -->
<g id="edge21" class="edge">
<title>addAndStartFetcherThread&#45;&gt;createFetcherThread</title>
<path fill="none" stroke="#000000" d="M517.2143,-522C525.7197,-522 534.3285,-522 542.7396,-522"/>
<polygon fill="#000000" stroke="#000000" points="542.8811,-525.5001 552.8811,-522 542.8811,-518.5001 542.8811,-525.5001"/>
</g>
<!-- fetcherThreadMap -->
<g id="node24" class="node">
<title>fetcherThreadMap</title>
<polygon fill="#95e1d3" stroke="#000000" points="676,-594 562,-594 558,-590 558,-558 672,-558 676,-562 676,-594"/>
<polyline fill="none" stroke="#000000" points="672,-590 558,-590 "/>
<polyline fill="none" stroke="#000000" points="672,-590 672,-558 "/>
<polyline fill="none" stroke="#000000" points="672,-590 676,-594 "/>
<text text-anchor="middle" x="617" y="-572.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetcherThreadMap</text>
</g>
<!-- addAndStartFetcherThread&#45;&gt;fetcherThreadMap -->
<g id="edge22" class="edge">
<title>addAndStartFetcherThread&#45;&gt;fetcherThreadMap</title>
<path fill="none" stroke="#000000" d="M495.8564,-540.0563C512.5284,-545.0029 530.7222,-550.4011 547.8234,-555.4751"/>
<polygon fill="#000000" stroke="#000000" points="547.1637,-558.9301 557.7462,-558.4192 549.1549,-552.2192 547.1637,-558.9301"/>
</g>
<!-- createFetcherThread&#45;&gt;ReplicaFetcherThread -->
<g id="edge23" class="edge">
<title>createFetcherThread&#45;&gt;ReplicaFetcherThread</title>
<path fill="none" stroke="#000000" d="M663.5964,-503.8811C672.1579,-500.188 680.9337,-496.1537 689,-492 710.1016,-481.1339 732.6831,-467.229 750.6928,-455.5415"/>
<polygon fill="#000000" stroke="#000000" points="752.6949,-458.4141 759.1401,-450.0052 748.8578,-452.5595 752.6949,-458.4141"/>
</g>
<!-- partitionState -->
<g id="node25" class="node">
<title>partitionState</title>
<polygon fill="#95e1d3" stroke="#000000" points="2684,-266.5 2684,-381.5 2822,-381.5 2822,-266.5 2684,-266.5"/>
<text text-anchor="middle" x="2753" y="-366.3" font-family="Times,serif" font-size="14.00" fill="#000000">partitionState</text>
<polyline fill="none" stroke="#000000" points="2684,-358.5 2822,-358.5 "/>
<text text-anchor="start" x="2692" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#000000">ControllerEpoch int32</text>
<polyline fill="none" stroke="#000000" points="2684,-335.5 2822,-335.5 "/>
<text text-anchor="start" x="2692" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader int32</text>
<polyline fill="none" stroke="#000000" points="2684,-312.5 2822,-312.5 "/>
<text text-anchor="start" x="2692" y="-297.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader_epoch int32</text>
<polyline fill="none" stroke="#000000" points="2684,-289.5 2822,-289.5 "/>
<text text-anchor="start" x="2692" y="-274.3" font-family="Times,serif" font-size="14.00" fill="#000000">isr []int32</text>
</g>
<!-- appendAsFollower -->
<g id="node26" class="node">
<title>appendAsFollower</title>
<polygon fill="none" stroke="#000000" points="2331.5,-483 2212.5,-483 2212.5,-447 2331.5,-447 2331.5,-483"/>
<text text-anchor="middle" x="2272" y="-461.3" font-family="Times,serif" font-size="14.00" fill="#000000">appendAsFollower</text>
</g>
<!-- append -->
<g id="node27" class="node">
<title>append</title>
<polygon fill="none" stroke="#000000" points="2476,-483 2420,-483 2420,-447 2476,-447 2476,-483"/>
<text text-anchor="middle" x="2448" y="-461.3" font-family="Times,serif" font-size="14.00" fill="#000000">append</text>
</g>
<!-- appendAsFollower&#45;&gt;append -->
<g id="edge24" class="edge">
<title>appendAsFollower&#45;&gt;append</title>
<path fill="none" stroke="#000000" d="M2331.5856,-465C2357.2405,-465 2386.5047,-465 2409.2743,-465"/>
<polygon fill="#000000" stroke="#000000" points="2409.5637,-468.5001 2419.5637,-465 2409.5636,-461.5001 2409.5637,-468.5001"/>
</g>
<!-- updateFetchState -->
<g id="node28" class="node">
<title>updateFetchState</title>
<polygon fill="none" stroke="#000000" points="2503,-342 2393,-342 2393,-306 2503,-306 2503,-342"/>
<text text-anchor="middle" x="2448" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchState</text>
</g>
<!-- maybeExpandIsr -->
<g id="node29" class="node">
<title>maybeExpandIsr</title>
<polygon fill="none" stroke="#000000" points="2648,-342 2539,-342 2539,-306 2648,-306 2648,-342"/>
<text text-anchor="middle" x="2593.5" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeExpandIsr</text>
</g>
<!-- updateFetchState&#45;&gt;maybeExpandIsr -->
<g id="edge25" class="edge">
<title>updateFetchState&#45;&gt;maybeExpandIsr</title>
<path fill="none" stroke="#000000" d="M2503.0073,-324C2511.4521,-324 2520.2366,-324 2528.8669,-324"/>
<polygon fill="#000000" stroke="#000000" points="2528.8975,-327.5001 2538.8975,-324 2528.8975,-320.5001 2528.8975,-327.5001"/>
</g>
<!-- maybeExpandIsr&#45;&gt;partitionState -->
<g id="edge26" class="edge">
<title>maybeExpandIsr&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2648.3909,-324C2656.6164,-324 2665.2341,-324 2673.8425,-324"/>
<polygon fill="#000000" stroke="#000000" points="2673.9198,-327.5001 2683.9198,-324 2673.9197,-320.5001 2673.9198,-327.5001"/>
</g>
<!-- fetchMessages -->
<g id="node30" class="node">
<title>fetchMessages</title>
<polygon fill="#f38181" stroke="#000000" points="2187,-293.5 2187,-354.5 2357,-354.5 2357,-293.5 2187,-293.5"/>
<text text-anchor="middle" x="2272" y="-339.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchMessages</text>
<polyline fill="none" stroke="#000000" points="2187,-331.5 2357,-331.5 "/>
<text text-anchor="start" x="2195" y="-316.3" font-family="Times,serif" font-size="14.00" fill="#000000">在partionLeader的broker中</text>
<text text-anchor="start" x="2195" y="-301.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 处理follower的fetch请求</text>
</g>
<!-- fetchMessages&#45;&gt;updateFetchState -->
<g id="edge30" class="edge">
<title>fetchMessages&#45;&gt;updateFetchState</title>
<path fill="none" stroke="#000000" d="M2357.1645,-324C2365.7729,-324 2374.4176,-324 2382.7685,-324"/>
<polygon fill="#000000" stroke="#000000" points="2382.7869,-327.5001 2392.7869,-324 2382.7869,-320.5001 2382.7869,-327.5001"/>
</g>
<!-- doAppendRecordsToFollowerOrFutureReplica&#45;&gt;appendAsFollower -->
<g id="edge28" class="edge">
<title>doAppendRecordsToFollowerOrFutureReplica&#45;&gt;appendAsFollower</title>
<path fill="none" stroke="#000000" d="M2151.0255,-457.4685C2168.7049,-458.5692 2186.1937,-459.658 2202.1471,-460.6512"/>
<polygon fill="#000000" stroke="#000000" points="2202.1974,-464.161 2212.3956,-461.2892 2202.6324,-457.1745 2202.1974,-464.161"/>
</g>
<!-- makeFollowers -->
<g id="node32" class="node">
<title>makeFollowers</title>
<polygon fill="none" stroke="#000000" points="121,-540 20,-540 20,-504 121,-504 121,-540"/>
<text text-anchor="middle" x="70.5" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollowers</text>
</g>
<!-- makeFollowers&#45;&gt;addFetcherForPartitions -->
<g id="edge29" class="edge">
<title>makeFollowers&#45;&gt;addFetcherForPartitions</title>
<path fill="none" stroke="#000000" d="M121.0038,-522C133.1635,-522 146.4782,-522 159.7083,-522"/>
<polygon fill="#000000" stroke="#000000" points="159.7885,-525.5001 169.7885,-522 159.7884,-518.5001 159.7885,-525.5001"/>
</g>
<!-- handleFetchRequest&#45;&gt;fetchMessages -->
<g id="edge31" class="edge">
<title>handleFetchRequest&#45;&gt;fetchMessages</title>
<path fill="none" stroke="#000000" d="M2078.1984,-327.0164C2107.8303,-326.5552 2143.7718,-325.9958 2176.6158,-325.4846"/>
<polygon fill="#000000" stroke="#000000" points="2176.7546,-328.9829 2186.6988,-325.3276 2176.6456,-321.9838 2176.7546,-328.9829"/>
</g>
</g>
</svg>
