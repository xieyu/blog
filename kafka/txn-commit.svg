<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: txn_end Pages: 1 -->
<svg width="4234pt" height="1043pt"
 viewBox="0.00 0.00 4233.83 1043.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1039)">
<title>txn_end</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1039 4229.8262,-1039 4229.8262,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ReplicaManager</title>
<path fill="none" stroke="#000000" d="M2376.376,-470C2376.376,-470 2500.4658,-470 2500.4658,-470 2506.4658,-470 2512.4658,-476 2512.4658,-482 2512.4658,-482 2512.4658,-572 2512.4658,-572 2512.4658,-578 2506.4658,-584 2500.4658,-584 2500.4658,-584 2376.376,-584 2376.376,-584 2370.376,-584 2364.376,-578 2364.376,-572 2364.376,-572 2364.376,-482 2364.376,-482 2364.376,-476 2370.376,-470 2376.376,-470"/>
<text text-anchor="middle" x="2438.4209" y="-564" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M799.4985,-805C799.4985,-805 4205.8262,-805 4205.8262,-805 4211.8262,-805 4217.8262,-811 4217.8262,-817 4217.8262,-817 4217.8262,-1015 4217.8262,-1015 4217.8262,-1021 4211.8262,-1027 4205.8262,-1027 4205.8262,-1027 799.4985,-1027 799.4985,-1027 793.4985,-1027 787.4985,-1021 787.4985,-1015 787.4985,-1015 787.4985,-817 787.4985,-817 787.4985,-811 793.4985,-805 799.4985,-805"/>
<text text-anchor="middle" x="2502.6624" y="-1007" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMetadata</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_TransactionStateManager</title>
<path fill="none" stroke="#000000" d="M2117.7256,-592C2117.7256,-592 3909.0654,-592 3909.0654,-592 3915.0654,-592 3921.0654,-598 3921.0654,-604 3921.0654,-604 3921.0654,-785 3921.0654,-785 3921.0654,-791 3915.0654,-797 3909.0654,-797 3909.0654,-797 2117.7256,-797 2117.7256,-797 2111.7256,-797 2105.7256,-791 2105.7256,-785 2105.7256,-785 2105.7256,-604 2105.7256,-604 2105.7256,-598 2111.7256,-592 2117.7256,-592"/>
<text text-anchor="middle" x="3013.3955" y="-777" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionStateManager</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_TransactionMarkerChannelManager</title>
<path fill="none" stroke="#000000" d="M241.876,-8C241.876,-8 3878.4746,-8 3878.4746,-8 3884.4746,-8 3890.4746,-14 3890.4746,-20 3890.4746,-20 3890.4746,-450 3890.4746,-450 3890.4746,-456 3884.4746,-462 3878.4746,-462 3878.4746,-462 241.876,-462 241.876,-462 235.876,-462 229.876,-456 229.876,-450 229.876,-450 229.876,-20 229.876,-20 229.876,-14 235.876,-8 241.876,-8"/>
<text text-anchor="middle" x="2060.1753" y="-442" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMarkerChannelManager</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_TransactionMarkerRequestCompletionHandler</title>
<path fill="none" stroke="#000000" d="M665.3398,-272C665.3398,-272 1038.0576,-272 1038.0576,-272 1044.0576,-272 1050.0576,-278 1050.0576,-284 1050.0576,-284 1050.0576,-414 1050.0576,-414 1050.0576,-420 1044.0576,-426 1038.0576,-426 1038.0576,-426 665.3398,-426 665.3398,-426 659.3398,-426 653.3398,-420 653.3398,-414 653.3398,-414 653.3398,-284 653.3398,-284 653.3398,-278 659.3398,-272 665.3398,-272"/>
<text text-anchor="middle" x="851.6987" y="-406" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMarkerRequestCompletionHandler</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_InterBrokerSendThread</title>
<path fill="none" stroke="#000000" d="M16,-66C16,-66 197.876,-66 197.876,-66 203.876,-66 209.876,-72 209.876,-78 209.876,-78 209.876,-148 209.876,-148 209.876,-154 203.876,-160 197.876,-160 197.876,-160 16,-160 16,-160 10,-160 4,-154 4,-148 4,-148 4,-78 4,-78 4,-72 10,-66 16,-66"/>
<text text-anchor="middle" x="106.938" y="-140" font-family="Times,serif" font-size="20.00" fill="#000000">InterBrokerSendThread</text>
</g>
<!-- appendRecords -->
<g id="node1" class="node">
<title>appendRecords</title>
<polygon fill="none" stroke="#000000" points="2379.376,-478.4001 2379.376,-547.5999 2496.4658,-547.5999 2496.4658,-478.4001 2379.376,-478.4001"/>
<text text-anchor="middle" x="2437.9209" y="-532.3999" font-family="Times,serif" font-size="14.00" fill="#000000">appendRecords</text>
<polyline fill="none" stroke="#000000" points="2379.376,-525.5999 2496.4658,-525.5999 "/>
<text text-anchor="start" x="2387.376" y="-510.3999" font-family="Times,serif" font-size="14.00" fill="#000000">将日志写入kafka</text>
<text text-anchor="start" x="2387.376" y="-490.8" font-family="Times,serif" font-size="14.00" fill="#000000"> internal topic中</text>
</g>
<!-- updateCacheCallback -->
<g id="node13" class="node">
<title>updateCacheCallback</title>
<polygon fill="none" stroke="#000000" points="2602.9648,-600.4001 2602.9648,-669.5999 2741.0205,-669.5999 2741.0205,-600.4001 2602.9648,-600.4001"/>
<text text-anchor="middle" x="2671.9927" y="-654.3999" font-family="Times,serif" font-size="14.00" fill="#000000">updateCacheCallback</text>
<polyline fill="none" stroke="#000000" points="2602.9648,-647.5999 2741.0205,-647.5999 "/>
<text text-anchor="start" x="2610.9648" y="-632.3999" font-family="Times,serif" font-size="14.00" fill="#000000">日志写入成功</text>
<text text-anchor="middle" x="2671.9927" y="-612.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 后的回调</text>
</g>
<!-- appendRecords&#45;&gt;updateCacheCallback -->
<g id="edge43" class="edge">
<title>appendRecords&#45;&gt;updateCacheCallback</title>
<path fill="none" stroke="#000000" d="M2496.685,-543.6283C2526.8885,-559.3706 2564.0436,-578.7361 2596.3628,-595.5811"/>
<polygon fill="#000000" stroke="#000000" points="2594.8549,-598.742 2605.3404,-600.2603 2598.0903,-592.5346 2594.8549,-598.742"/>
</g>
<!-- TransactionMetadata -->
<g id="node2" class="node">
<title>TransactionMetadata</title>
<polygon fill="#95e1d3" stroke="#000000" points="3949.0654,-814 3949.0654,-990 4209.8262,-990 4209.8262,-814 3949.0654,-814"/>
<text text-anchor="middle" x="4079.4458" y="-974.8" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionMetadata</text>
<polyline fill="none" stroke="#000000" points="3949.0654,-968 4209.8262,-968 "/>
<text text-anchor="start" x="3957.0654" y="-952.8" font-family="Times,serif" font-size="14.00" fill="#000000">transactionalId: String </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-946 4209.8262,-946 "/>
<text text-anchor="start" x="3957.0654" y="-930.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerId: long </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-924 4209.8262,-924 "/>
<text text-anchor="start" x="3957.0654" y="-908.8" font-family="Times,serif" font-size="14.00" fill="#000000">lastProducerId: Long </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-902 4209.8262,-902 "/>
<text text-anchor="start" x="3957.0654" y="-886.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerEpoch: short </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-880 4209.8262,-880 "/>
<text text-anchor="start" x="3957.0654" y="-864.8" font-family="Times,serif" font-size="14.00" fill="#000000">txnTimeoutMs: Int </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-858 4209.8262,-858 "/>
<text text-anchor="start" x="3957.0654" y="-842.8" font-family="Times,serif" font-size="14.00" fill="#000000">state: TransactionState </text>
<polyline fill="none" stroke="#000000" points="3949.0654,-836 4209.8262,-836 "/>
<text text-anchor="start" x="3957.0654" y="-820.8" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartitions: mutable.Set[TopicPartition]</text>
</g>
<!-- removePartition -->
<g id="node3" class="node">
<title>removePartition</title>
<polygon fill="none" stroke="#000000" points="1962.5002,-867 1856.0994,-867 1856.0994,-831 1962.5002,-831 1962.5002,-867"/>
<text text-anchor="middle" x="1909.2998" y="-844.8" font-family="Times,serif" font-size="14.00" fill="#000000">removePartition</text>
</g>
<!-- removePartition&#45;&gt;TransactionMetadata -->
<g id="edge1" class="edge">
<title>removePartition&#45;&gt;TransactionMetadata:tp</title>
<path fill="none" stroke="#000000" d="M1962.5504,-852.1802C2057.8532,-857.589 2263.8959,-868 2437.9209,-868 2437.9209,-868 2437.9209,-868 3532.6001,-868 3715.3922,-868 3761.5033,-826.5809 3939.2232,-825.0439"/>
<polygon fill="#000000" stroke="#000000" points="3939.4609,-828.543 3949.4458,-825 3939.4308,-821.543 3939.4609,-828.543"/>
</g>
<!-- prepareTransitionTo -->
<g id="node4" class="node">
<title>prepareTransitionTo</title>
<polygon fill="none" stroke="#000000" points="1078.0576,-813.4001 1078.0576,-882.5999 1278.3887,-882.5999 1278.3887,-813.4001 1078.0576,-813.4001"/>
<text text-anchor="middle" x="1178.2231" y="-867.3999" font-family="Times,serif" font-size="14.00" fill="#000000">prepareTransitionTo</text>
<polyline fill="none" stroke="#000000" points="1078.0576,-860.5999 1278.3887,-860.5999 "/>
<text text-anchor="start" x="1086.0576" y="-845.3999" font-family="Times,serif" font-size="14.00" fill="#000000">将状态设置为CompleteCommit</text>
<text text-anchor="start" x="1086.0576" y="-825.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 或者CompleteAbort</text>
</g>
<!-- completeTransitionTo -->
<g id="node5" class="node">
<title>completeTransitionTo</title>
<polygon fill="none" stroke="#000000" points="2987.0855,-849 2848.1968,-849 2848.1968,-813 2987.0855,-813 2987.0855,-849"/>
<text text-anchor="middle" x="2917.6411" y="-826.8" font-family="Times,serif" font-size="14.00" fill="#000000">completeTransitionTo</text>
</g>
<!-- topicPartitions_clear -->
<g id="node6" class="node">
<title>topicPartitions_clear</title>
<polygon fill="none" stroke="#000000" points="3295.6348,-849 3163.9237,-849 3163.9237,-813 3295.6348,-813 3295.6348,-849"/>
<text text-anchor="middle" x="3229.7793" y="-826.8" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartitions_clear</text>
</g>
<!-- completeTransitionTo&#45;&gt;topicPartitions_clear -->
<g id="edge2" class="edge">
<title>completeTransitionTo&#45;&gt;topicPartitions_clear</title>
<path fill="none" stroke="#000000" d="M2987.3025,-831C3036.6385,-831 3102.7965,-831 3153.5438,-831"/>
<polygon fill="#000000" stroke="#000000" points="3153.8023,-834.5001 3163.8023,-831 3153.8023,-827.5001 3153.8023,-834.5001"/>
</g>
<!-- prepareComplete -->
<g id="node7" class="node">
<title>prepareComplete</title>
<polygon fill="none" stroke="#000000" points="908.0998,-857 795.2976,-857 795.2976,-821 908.0998,-821 908.0998,-857"/>
<text text-anchor="middle" x="851.6987" y="-834.8" font-family="Times,serif" font-size="14.00" fill="#000000">prepareComplete</text>
</g>
<!-- prepareComplete&#45;&gt;prepareTransitionTo -->
<g id="edge3" class="edge">
<title>prepareComplete&#45;&gt;prepareTransitionTo</title>
<path fill="none" stroke="#000000" d="M908.2022,-840.5574C952.015,-841.765 1014.0938,-843.4761 1067.6829,-844.9532"/>
<polygon fill="#000000" stroke="#000000" points="1067.8386,-848.4587 1077.9313,-845.2357 1068.0315,-841.4614 1067.8386,-848.4587"/>
</g>
<!-- appendTransactionToLog -->
<g id="node8" class="node">
<title>appendTransactionToLog</title>
<polygon fill="none" stroke="#000000" points="2113.7256,-600.4001 2113.7256,-669.5999 2272.877,-669.5999 2272.877,-600.4001 2113.7256,-600.4001"/>
<text text-anchor="middle" x="2193.3013" y="-654.3999" font-family="Times,serif" font-size="14.00" fill="#000000">appendTransactionToLog</text>
<polyline fill="none" stroke="#000000" points="2113.7256,-647.5999 2272.877,-647.5999 "/>
<text text-anchor="start" x="2121.7256" y="-632.3999" font-family="Times,serif" font-size="14.00" fill="#000000">将事务日志对应的</text>
<text text-anchor="start" x="2121.7256" y="-612.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入topic_partition</text>
</g>
<!-- appendTransactionToLog&#45;&gt;appendRecords -->
<g id="edge10" class="edge">
<title>appendTransactionToLog&#45;&gt;appendRecords</title>
<path fill="none" stroke="#000000" d="M2262.7451,-600.366C2296.3142,-583.624 2336.4623,-563.6008 2369.8491,-546.9497"/>
<polygon fill="#000000" stroke="#000000" points="2371.6888,-549.9434 2379.0755,-542.3482 2368.5646,-543.6792 2371.6888,-549.9434"/>
</g>
<!-- appendTransactionToLog&#45;&gt;updateCacheCallback -->
<g id="edge4" class="edge">
<title>appendTransactionToLog&#45;&gt;updateCacheCallback</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2273.1357,-627.188C2285.104,-626.2793 2297.3071,-625.4996 2308.877,-625 2423.4759,-620.0515 2452.3883,-619.5577 2566.9648,-625 2575.3152,-625.3966 2584.0264,-625.9697 2592.7043,-626.6437"/>
<polygon fill="#000000" stroke="#000000" points="2592.5998,-630.1468 2602.8526,-627.4767 2593.1725,-623.1702 2592.5998,-630.1468"/>
</g>
<!-- TRANSACTION_STATE_TOPIC_NAME -->
<g id="node15" class="node">
<title>TRANSACTION_STATE_TOPIC_NAME</title>
<polygon fill="none" stroke="#000000" points="2567.0088,-670 2308.833,-670 2308.833,-634 2567.0088,-634 2567.0088,-670"/>
<text text-anchor="middle" x="2437.9209" y="-647.8" font-family="Times,serif" font-size="14.00" fill="#000000">TRANSACTION_STATE_TOPIC_NAME</text>
</g>
<!-- appendTransactionToLog&#45;&gt;TRANSACTION_STATE_TOPIC_NAME -->
<g id="edge11" class="edge">
<title>appendTransactionToLog&#45;&gt;TRANSACTION_STATE_TOPIC_NAME</title>
<path fill="none" stroke="#000000" d="M2273.0604,-640.5429C2281.2777,-641.114 2289.7877,-641.7054 2298.4141,-642.3049"/>
<polygon fill="#000000" stroke="#000000" points="2298.3651,-645.8098 2308.5837,-643.0116 2298.8505,-638.8267 2298.3651,-645.8098"/>
</g>
<!-- getTransactionState -->
<g id="node9" class="node">
<title>getTransactionState</title>
<polygon fill="none" stroke="#000000" points="2832.2515,-641.2 2832.2515,-690.8 3003.0308,-690.8 3003.0308,-641.2 2832.2515,-641.2"/>
<text text-anchor="middle" x="2917.6411" y="-675.6" font-family="Times,serif" font-size="14.00" fill="#000000">getTransactionState</text>
<polyline fill="none" stroke="#000000" points="2832.2515,-668.8 3003.0308,-668.8 "/>
<text text-anchor="middle" x="2917.6411" y="-653.6" font-family="Times,serif" font-size="14.00" fill="#000000">根据tid获取事务对应状态</text>
</g>
<!-- getAndMaybeAddTransactionState -->
<g id="node14" class="node">
<title>getAndMaybeAddTransactionState</title>
<polygon fill="none" stroke="#000000" points="3336.5704,-684 3122.9882,-684 3122.9882,-648 3336.5704,-648 3336.5704,-684"/>
<text text-anchor="middle" x="3229.7793" y="-661.8" font-family="Times,serif" font-size="14.00" fill="#000000">getAndMaybeAddTransactionState</text>
</g>
<!-- getTransactionState&#45;&gt;getAndMaybeAddTransactionState -->
<g id="edge7" class="edge">
<title>getTransactionState&#45;&gt;getAndMaybeAddTransactionState</title>
<path fill="none" stroke="#000000" d="M3003.3471,-666C3037.0833,-666 3076.3672,-666 3112.6514,-666"/>
<polygon fill="#000000" stroke="#000000" points="3112.7988,-669.5001 3122.7987,-666 3112.7987,-662.5001 3112.7988,-669.5001"/>
</g>
<!-- transactionMetadataCache -->
<g id="node10" class="node">
<title>transactionMetadataCache</title>
<polygon fill="#95e1d3" stroke="#000000" points="3401.2969,-600.2 3401.2969,-663.8 3663.9033,-663.8 3663.9033,-600.2 3401.2969,-600.2"/>
<text text-anchor="middle" x="3532.6001" y="-648.6" font-family="Times,serif" font-size="14.00" fill="#000000">transactionMetadataCache</text>
<polyline fill="none" stroke="#000000" points="3401.2969,-641.8 3663.9033,-641.8 "/>
<text text-anchor="start" x="3409.2969" y="-626.6" font-family="Times,serif" font-size="14.00" fill="#000000">mutable.Map[Int, TxnMetadataCacheEntry]</text>
<text text-anchor="middle" x="3532.6001" y="-612.6" font-family="Times,serif" font-size="14.00" fill="#000000"> parition 到cacheEntry的映射</text>
</g>
<!-- TxnMetadataCacheEntry -->
<g id="node11" class="node">
<title>TxnMetadataCacheEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="3699.9033,-630.2 3699.9033,-729.8 3913.0654,-729.8 3913.0654,-630.2 3699.9033,-630.2"/>
<text text-anchor="middle" x="3806.4844" y="-714.6" font-family="Times,serif" font-size="14.00" fill="#000000">TxnMetadataCacheEntry</text>
<polyline fill="none" stroke="#000000" points="3699.9033,-707.8 3913.0654,-707.8 "/>
<text text-anchor="start" x="3707.9033" y="-692.6" font-family="Times,serif" font-size="14.00" fill="#000000">coordinatorEpoch Int </text>
<polyline fill="none" stroke="#000000" points="3699.9033,-685.8 3913.0654,-685.8 "/>
<text text-anchor="start" x="3707.9033" y="-670.6" font-family="Times,serif" font-size="14.00" fill="#000000">metadataPerTransactionalId </text>
<text text-anchor="start" x="3707.9033" y="-656.6" font-family="Times,serif" font-size="14.00" fill="#000000"> Pool[String, TransactionMetadata]</text>
<text text-anchor="middle" x="3806.4844" y="-642.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 事务ID到事务metadata映射</text>
</g>
<!-- transactionMetadataCache&#45;&gt;TxnMetadataCacheEntry -->
<g id="edge5" class="edge">
<title>transactionMetadataCache:entry&#45;&gt;TxnMetadataCacheEntry</title>
<path fill="none" stroke="#000000" d="M3663.6001,-621C3677.3136,-621 3691.2453,-623.3506 3704.7616,-627.1134"/>
<polygon fill="#000000" stroke="#000000" points="3703.935,-630.5204 3714.5211,-630.0894 3705.9768,-623.8248 3703.935,-630.5204"/>
</g>
<!-- TxnMetadataCacheEntry&#45;&gt;TransactionMetadata -->
<g id="edge6" class="edge">
<title>TxnMetadataCacheEntry:meta&#45;&gt;TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M3913.4844,-658C3987.8577,-658 4031.2495,-736.4648 4054.8809,-804.4031"/>
<polygon fill="#000000" stroke="#000000" points="4051.5746,-805.5521 4058.0854,-813.9104 4058.208,-803.3163 4051.5746,-805.5521"/>
</g>
<!-- partitionFor -->
<g id="node12" class="node">
<title>partitionFor</title>
<polygon fill="none" stroke="#000000" points="3418.4619,-683.2 3418.4619,-760.8 3646.7383,-760.8 3646.7383,-683.2 3418.4619,-683.2"/>
<text text-anchor="middle" x="3532.6001" y="-745.6" font-family="Times,serif" font-size="14.00" fill="#000000">partitionFor</text>
<polyline fill="none" stroke="#000000" points="3418.4619,-738.8 3646.7383,-738.8 "/>
<text text-anchor="start" x="3426.4619" y="-723.6" font-family="Times,serif" font-size="14.00" fill="#000000">Utils.abs(transactionalId.hashCode)%</text>
<text text-anchor="start" x="3426.4619" y="-709.6" font-family="Times,serif" font-size="14.00" fill="#000000"> transactionTopicPartitionCount </text>
<text text-anchor="start" x="3426.4619" y="-695.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 根据事务id获取对应的partition</text>
</g>
<!-- updateCacheCallback&#45;&gt;completeTransitionTo -->
<g id="edge45" class="edge">
<title>updateCacheCallback&#45;&gt;completeTransitionTo</title>
<path fill="none" stroke="#000000" d="M2684.4439,-669.7811C2700.0148,-708.087 2730.4283,-768.5443 2777.0205,-801 2794.8799,-813.4407 2816.8861,-820.8871 2838.1427,-825.2981"/>
<polygon fill="#000000" stroke="#000000" points="2837.693,-828.7746 2848.1661,-827.1731 2838.9802,-821.8939 2837.693,-828.7746"/>
</g>
<!-- updateCacheCallback&#45;&gt;getTransactionState -->
<g id="edge46" class="edge">
<title>updateCacheCallback&#45;&gt;getTransactionState</title>
<path fill="none" stroke="#000000" d="M2741.0732,-643.7177C2766.1138,-646.8778 2794.8667,-650.5063 2821.7989,-653.905"/>
<polygon fill="#000000" stroke="#000000" points="2821.6607,-657.4153 2832.0202,-655.1949 2822.5372,-650.4704 2821.6607,-657.4153"/>
</g>
<!-- appendCallback -->
<g id="node26" class="node">
<title>appendCallback</title>
<polygon fill="none" stroke="#000000" points="2777.0205,-336.6001 2777.0205,-425.3999 3058.2617,-425.3999 3058.2617,-336.6001 2777.0205,-336.6001"/>
<text text-anchor="middle" x="2917.6411" y="-410.1999" font-family="Times,serif" font-size="14.00" fill="#000000">appendCallback</text>
<polyline fill="none" stroke="#000000" points="2777.0205,-403.3999 3058.2617,-403.3999 "/>
<text text-anchor="start" x="2785.0205" y="-388.1999" font-family="Times,serif" font-size="14.00" fill="#000000">对于COORDINATOR_NOT_AVALIBLE错误</text>
<text text-anchor="start" x="2785.0205" y="-368.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 加入重试队列,InterBroker线程</text>
<text text-anchor="start" x="2785.0205" y="-349" font-family="Times,serif" font-size="14.00" fill="#000000"> 会尝试重新发送</text>
</g>
<!-- updateCacheCallback&#45;&gt;appendCallback -->
<g id="edge47" class="edge">
<title>updateCacheCallback&#45;&gt;appendCallback</title>
<path fill="none" stroke="#000000" d="M2705.634,-600.215C2747.3787,-557.051 2818.9437,-483.053 2867.2504,-433.1039"/>
<polygon fill="#000000" stroke="#000000" points="2870.0627,-435.2306 2874.4987,-425.6091 2865.0309,-430.3642 2870.0627,-435.2306"/>
</g>
<!-- getAndMaybeAddTransactionState&#45;&gt;transactionMetadataCache -->
<g id="edge8" class="edge">
<title>getAndMaybeAddTransactionState&#45;&gt;transactionMetadataCache</title>
<path fill="none" stroke="#000000" d="M3336.9687,-653.965C3354.4826,-651.9986 3372.8618,-649.935 3391.0504,-647.8929"/>
<polygon fill="#000000" stroke="#000000" points="3391.5818,-651.3553 3401.1289,-646.7613 3390.8008,-644.399 3391.5818,-651.3553"/>
</g>
<!-- getAndMaybeAddTransactionState&#45;&gt;partitionFor -->
<g id="edge9" class="edge">
<title>getAndMaybeAddTransactionState&#45;&gt;partitionFor</title>
<path fill="none" stroke="#000000" d="M3327.2606,-684.027C3353.1305,-688.8111 3381.4166,-694.042 3408.4974,-699.0499"/>
<polygon fill="#000000" stroke="#000000" points="3407.9435,-702.5068 3418.4132,-700.8837 3409.2164,-695.6235 3407.9435,-702.5068"/>
</g>
<!-- TransactionMarkerRequestCompletionHandler -->
<g id="node16" class="node">
<title>TransactionMarkerRequestCompletionHandler</title>
<polygon fill="none" stroke="#000000" points="661.3398,-280.8002 661.3398,-389.1998 1042.0576,-389.1998 1042.0576,-280.8002 661.3398,-280.8002"/>
<text text-anchor="middle" x="851.6987" y="-373.9998" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionMarkerRequestCompletionHandler</text>
<polyline fill="none" stroke="#000000" points="661.3398,-367.1998 1042.0576,-367.1998 "/>
<text text-anchor="start" x="669.3398" y="-351.9998" font-family="Times,serif" font-size="14.00" fill="#000000">处理parition broker对writeMark的响应</text>
<text text-anchor="start" x="669.3398" y="-332.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.首先判断自己是否还是tid对应的coordinator</text>
<text text-anchor="start" x="669.3398" y="-312.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 检查epoch能否对的上 如果不是的就removeMarkersForTxnId</text>
<text text-anchor="start" x="669.3398" y="-293.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 2.将出错的partition加入retry队列</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;removePartition -->
<g id="edge37" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;removePartition</title>
<path fill="none" stroke="#000000" d="M867.8834,-389.3004C895.9395,-473.2763 962.0191,-633.1736 1078.0576,-712 1203.8823,-797.4742 1673.9953,-834.4944 1845.8611,-845.3719"/>
<polygon fill="#000000" stroke="#000000" points="1845.8164,-848.8758 1856.0151,-846.006 1846.2528,-841.8894 1845.8164,-848.8758"/>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;getTransactionState -->
<g id="edge38" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;getTransactionState</title>
<path fill="none" stroke="#000000" d="M896.2689,-389.3448C984.6955,-490.6096 1193.4458,-698 1419.9751,-698 1419.9751,-698 1419.9751,-698 2437.9209,-698 2571.3418,-698 2725.1737,-685.5245 2821.9124,-676.1526"/>
<polygon fill="#000000" stroke="#000000" points="2822.3529,-679.6263 2831.965,-675.1699 2821.6719,-672.6595 2822.3529,-679.6263"/>
</g>
<!-- completeSendMarkersForTxnId -->
<g id="node23" class="node">
<title>completeSendMarkersForTxnId</title>
<polygon fill="none" stroke="#000000" points="1080.4023,-356.4001 1080.4023,-425.5999 1276.0439,-425.5999 1276.0439,-356.4001 1080.4023,-356.4001"/>
<text text-anchor="middle" x="1178.2231" y="-410.3999" font-family="Times,serif" font-size="14.00" fill="#000000">completeSendMarkersForTxnId</text>
<polyline fill="none" stroke="#000000" points="1080.4023,-403.5999 1276.0439,-403.5999 "/>
<text text-anchor="start" x="1088.4023" y="-388.3999" font-family="Times,serif" font-size="14.00" fill="#000000">所有marker请求都处理成功了</text>
<text text-anchor="start" x="1088.4023" y="-368.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入日志</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;completeSendMarkersForTxnId -->
<g id="edge39" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;completeSendMarkersForTxnId</title>
<path fill="none" stroke="#000000" d="M1042.1118,-367.6565C1051.5669,-369.278 1060.897,-370.8782 1069.9705,-372.4343"/>
<polygon fill="#000000" stroke="#000000" points="1069.6508,-375.9305 1080.0986,-374.1713 1070.8341,-369.0312 1069.6508,-375.9305"/>
</g>
<!-- removeMarkersForTxnId -->
<g id="node32" class="node">
<title>removeMarkersForTxnId</title>
<polygon fill="none" stroke="#000000" points="1257.5134,-338 1098.9328,-338 1098.9328,-302 1257.5134,-302 1257.5134,-338"/>
<text text-anchor="middle" x="1178.2231" y="-315.8" font-family="Times,serif" font-size="14.00" fill="#000000">removeMarkersForTxnId</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;removeMarkersForTxnId -->
<g id="edge40" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;removeMarkersForTxnId</title>
<path fill="none" stroke="#000000" d="M1042.1118,-326.2527C1058.2562,-325.5111 1074.0362,-324.7862 1088.7962,-324.1081"/>
<polygon fill="#000000" stroke="#000000" points="1089.0148,-327.6019 1098.8437,-323.6466 1088.6936,-320.6092 1089.0148,-327.6019"/>
</g>
<!-- addTxnMarkersToBrokerQueue -->
<g id="node33" class="node">
<title>addTxnMarkersToBrokerQueue</title>
<polygon fill="none" stroke="#000000" points="1276.1259,-275 1080.3204,-275 1080.3204,-239 1276.1259,-239 1276.1259,-275"/>
<text text-anchor="middle" x="1178.2231" y="-252.8" font-family="Times,serif" font-size="14.00" fill="#000000">addTxnMarkersToBrokerQueue</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;addTxnMarkersToBrokerQueue -->
<g id="edge41" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;addTxnMarkersToBrokerQueue</title>
<path fill="none" stroke="#000000" d="M1042.1118,-289.5142C1059.5593,-285.3464 1076.5812,-281.2802 1092.35,-277.5133"/>
<polygon fill="#000000" stroke="#000000" points="1093.6102,-280.8109 1102.5233,-275.0831 1091.9837,-274.0024 1093.6102,-280.8109"/>
</g>
<!-- retryLogAppends -->
<g id="node17" class="node">
<title>retryLogAppends</title>
<polygon fill="none" stroke="#000000" points="908.951,-106 794.4465,-106 794.4465,-70 908.951,-70 908.951,-106"/>
<text text-anchor="middle" x="851.6987" y="-83.8" font-family="Times,serif" font-size="14.00" fill="#000000">retryLogAppends</text>
</g>
<!-- txnLogAppendRetryQueue -->
<g id="node18" class="node">
<title>txnLogAppendRetryQueue</title>
<polygon fill="#95e1d3" stroke="#000000" points="3314.187,-208 3149.3716,-208 3145.3716,-204 3145.3716,-172 3310.187,-172 3314.187,-176 3314.187,-208"/>
<polyline fill="none" stroke="#000000" points="3310.187,-204 3145.3716,-204 "/>
<polyline fill="none" stroke="#000000" points="3310.187,-204 3310.187,-172 "/>
<polyline fill="none" stroke="#000000" points="3310.187,-204 3314.187,-208 "/>
<text text-anchor="middle" x="3229.7793" y="-185.8" font-family="Times,serif" font-size="14.00" fill="#000000">txnLogAppendRetryQueue</text>
</g>
<!-- retryLogAppends&#45;&gt;txnLogAppendRetryQueue -->
<g id="edge12" class="edge">
<title>retryLogAppends&#45;&gt;txnLogAppendRetryQueue</title>
<path fill="none" stroke="#000000" d="M909.2502,-95.7513C1011.7248,-108.8609 1232.6521,-134 1419.9751,-134 1419.9751,-134 1419.9751,-134 2193.3013,-134 2541.0579,-134 2953.4916,-165.8213 3135.4849,-181.4891"/>
<polygon fill="#000000" stroke="#000000" points="3135.2935,-184.9855 3145.5578,-182.3601 3135.8966,-178.0116 3135.2935,-184.9855"/>
</g>
<!-- TxnIdAndMarkerEntry -->
<g id="node19" class="node">
<title>TxnIdAndMarkerEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="3428.5039,-77 3428.5039,-143 3636.6963,-143 3636.6963,-77 3428.5039,-77"/>
<text text-anchor="middle" x="3532.6001" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#000000">TxnIdAndMarkerEntry</text>
<polyline fill="none" stroke="#000000" points="3428.5039,-121 3636.6963,-121 "/>
<text text-anchor="middle" x="3532.6001" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">txnId: String</text>
<polyline fill="none" stroke="#000000" points="3428.5039,-99 3636.6963,-99 "/>
<text text-anchor="middle" x="3532.6001" y="-83.8" font-family="Times,serif" font-size="14.00" fill="#000000">txnMarkerEntry: TxnMarkerEntry</text>
</g>
<!-- TxnMarkerEntry -->
<g id="node20" class="node">
<title>TxnMarkerEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="3730.4941,-22 3730.4941,-154 3882.4746,-154 3882.4746,-22 3730.4941,-22"/>
<text text-anchor="middle" x="3806.4844" y="-138.8" font-family="Times,serif" font-size="14.00" fill="#000000">TxnMarkerEntry</text>
<polyline fill="none" stroke="#000000" points="3730.4941,-132 3882.4746,-132 "/>
<text text-anchor="middle" x="3806.4844" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerId long</text>
<polyline fill="none" stroke="#000000" points="3730.4941,-110 3882.4746,-110 "/>
<text text-anchor="middle" x="3806.4844" y="-94.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerEpoch short</text>
<polyline fill="none" stroke="#000000" points="3730.4941,-88 3882.4746,-88 "/>
<text text-anchor="middle" x="3806.4844" y="-72.8" font-family="Times,serif" font-size="14.00" fill="#000000">coordinatorEpoch int</text>
<polyline fill="none" stroke="#000000" points="3730.4941,-66 3882.4746,-66 "/>
<text text-anchor="middle" x="3806.4844" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionResult result</text>
<polyline fill="none" stroke="#000000" points="3730.4941,-44 3882.4746,-44 "/>
<text text-anchor="start" x="3738.4941" y="-28.8" font-family="Times,serif" font-size="14.00" fill="#000000">partitions </text>
</g>
<!-- TxnIdAndMarkerEntry&#45;&gt;TxnMarkerEntry -->
<g id="edge28" class="edge">
<title>TxnIdAndMarkerEntry:entry&#45;&gt;TxnMarkerEntry</title>
<path fill="none" stroke="#000000" d="M3636.6001,-88C3663.7989,-88 3693.4472,-88 3720.2507,-88"/>
<polygon fill="#000000" stroke="#000000" points="3720.3731,-91.5001 3730.3731,-88 3720.3731,-84.5001 3720.3731,-91.5001"/>
</g>
<!-- markersPerTxnTopicPartition -->
<g id="node21" class="node">
<title>markersPerTxnTopicPartition</title>
<polygon fill="#95e1d3" stroke="#000000" points="3094.2617,-99 3094.2617,-143 3365.2969,-143 3365.2969,-99 3094.2617,-99"/>
<text text-anchor="middle" x="3229.7793" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#000000">markersPerTxnTopicPartition</text>
<polyline fill="none" stroke="#000000" points="3094.2617,-121 3365.2969,-121 "/>
<text text-anchor="middle" x="3229.7793" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#000000">[Int, BlockingQueue[TxnIdAndMarkerEntry]</text>
</g>
<!-- markersPerTxnTopicPartition&#45;&gt;TxnIdAndMarkerEntry -->
<g id="edge29" class="edge">
<title>markersPerTxnTopicPartition:txn&#45;&gt;TxnIdAndMarkerEntry</title>
<path fill="none" stroke="#000000" d="M3365.2969,-110C3382.2931,-110 3400.2607,-110 3417.8674,-110"/>
<polygon fill="#000000" stroke="#000000" points="3418.1822,-113.5001 3428.1822,-110 3418.1822,-106.5001 3418.1822,-113.5001"/>
</g>
<!-- addTxnMarkersToSend -->
<g id="node22" class="node">
<title>addTxnMarkersToSend</title>
<polygon fill="#f38181" stroke="#000000" points="765.1538,-212.2 765.1538,-261.8 938.2437,-261.8 938.2437,-212.2 765.1538,-212.2"/>
<text text-anchor="middle" x="851.6987" y="-246.6" font-family="Times,serif" font-size="14.00" fill="#000000">addTxnMarkersToSend</text>
<polyline fill="none" stroke="#000000" points="765.1538,-239.8 938.2437,-239.8 "/>
<text text-anchor="middle" x="851.6987" y="-224.6" font-family="Times,serif" font-size="14.00" fill="#000000">将txnMarker加入发送队列</text>
</g>
<!-- addTxnMarkersToSend&#45;&gt;addTxnMarkersToBrokerQueue -->
<g id="edge19" class="edge">
<title>addTxnMarkersToSend&#45;&gt;addTxnMarkersToBrokerQueue</title>
<path fill="none" stroke="#000000" d="M938.344,-242.3071C978.8362,-244.7873 1027.4602,-247.7656 1070.3133,-250.3904"/>
<polygon fill="#000000" stroke="#000000" points="1070.306,-253.8964 1080.5013,-251.0144 1070.734,-246.9095 1070.306,-253.8964"/>
</g>
<!-- tryCompleteElseWatch -->
<g id="node34" class="node">
<title>tryCompleteElseWatch</title>
<polygon fill="none" stroke="#000000" points="1250.7308,-203 1105.7155,-203 1105.7155,-167 1250.7308,-167 1250.7308,-203"/>
<text text-anchor="middle" x="1178.2231" y="-180.8" font-family="Times,serif" font-size="14.00" fill="#000000">tryCompleteElseWatch</text>
</g>
<!-- addTxnMarkersToSend&#45;&gt;tryCompleteElseWatch -->
<g id="edge20" class="edge">
<title>addTxnMarkersToSend&#45;&gt;tryCompleteElseWatch</title>
<path fill="none" stroke="#000000" d="M938.344,-223.2015C987.0271,-215.4485 1047.4648,-205.8237 1095.4955,-198.1746"/>
<polygon fill="#000000" stroke="#000000" points="1096.2226,-201.603 1105.5477,-196.5738 1095.1217,-194.6901 1096.2226,-201.603"/>
</g>
<!-- checkAndComplete -->
<g id="node30" class="node">
<title>checkAndComplete</title>
<polygon fill="none" stroke="#000000" points="1483.6618,-407 1356.2884,-407 1356.2884,-371 1483.6618,-371 1483.6618,-407"/>
<text text-anchor="middle" x="1419.9751" y="-384.8" font-family="Times,serif" font-size="14.00" fill="#000000">checkAndComplete</text>
</g>
<!-- completeSendMarkersForTxnId&#45;&gt;checkAndComplete -->
<g id="edge13" class="edge">
<title>completeSendMarkersForTxnId&#45;&gt;checkAndComplete</title>
<path fill="none" stroke="#000000" d="M1276.2044,-390.1894C1299.4804,-389.9968 1323.9321,-389.7946 1345.9346,-389.6125"/>
<polygon fill="#000000" stroke="#000000" points="1346.2189,-393.1104 1356.1896,-389.5277 1346.1609,-386.1106 1346.2189,-393.1104"/>
</g>
<!-- generateRequests -->
<g id="node24" class="node">
<title>generateRequests</title>
<polygon fill="none" stroke="#000000" points="237.876,-64.4001 237.876,-133.5999 375.0156,-133.5999 375.0156,-64.4001 237.876,-64.4001"/>
<text text-anchor="middle" x="306.4458" y="-118.3999" font-family="Times,serif" font-size="14.00" fill="#000000">generateRequests</text>
<polyline fill="none" stroke="#000000" points="237.876,-111.5999 375.0156,-111.5999 "/>
<text text-anchor="start" x="245.876" y="-96.3999" font-family="Times,serif" font-size="14.00" fill="#000000">遍历marker队列</text>
<text text-anchor="start" x="245.876" y="-76.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 生成WriteMark请求</text>
</g>
<!-- drainQueuedTransactionMarkers -->
<g id="node29" class="node">
<title>drainQueuedTransactionMarkers</title>
<polygon fill="none" stroke="#000000" points="411.0156,-64.4001 411.0156,-133.5999 625.3398,-133.5999 625.3398,-64.4001 411.0156,-64.4001"/>
<text text-anchor="middle" x="518.1777" y="-118.3999" font-family="Times,serif" font-size="14.00" fill="#000000">drainQueuedTransactionMarkers</text>
<polyline fill="none" stroke="#000000" points="411.0156,-111.5999 625.3398,-111.5999 "/>
<text text-anchor="start" x="419.0156" y="-96.3999" font-family="Times,serif" font-size="14.00" fill="#000000">从各种队列中生成TxnMarks请求</text>
<text text-anchor="start" x="419.0156" y="-76.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 并设置请求回调</text>
</g>
<!-- generateRequests&#45;&gt;drainQueuedTransactionMarkers -->
<g id="edge30" class="edge">
<title>generateRequests&#45;&gt;drainQueuedTransactionMarkers</title>
<path fill="none" stroke="#000000" d="M375.1891,-99C383.4341,-99 392.0231,-99 400.7176,-99"/>
<polygon fill="#000000" stroke="#000000" points="400.9585,-102.5001 410.9585,-99 400.9585,-95.5001 400.9585,-102.5001"/>
</g>
<!-- WriteTxnMarkersRequest -->
<g id="node25" class="node">
<title>WriteTxnMarkersRequest</title>
<polygon fill="none" stroke="#000000" points="770.8892,-124.4001 770.8892,-193.5999 932.5083,-193.5999 932.5083,-124.4001 770.8892,-124.4001"/>
<text text-anchor="middle" x="851.6987" y="-178.3999" font-family="Times,serif" font-size="14.00" fill="#000000">WriteTxnMarkersRequest</text>
<polyline fill="none" stroke="#000000" points="770.8892,-171.5999 932.5083,-171.5999 "/>
<text text-anchor="start" x="778.8892" y="-156.3999" font-family="Times,serif" font-size="14.00" fill="#000000">生成对broker的</text>
<text text-anchor="start" x="778.8892" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#000000"> WriteTxnMarkers请求</text>
</g>
<!-- appendCallback&#45;&gt;txnLogAppendRetryQueue -->
<g id="edge18" class="edge">
<title>appendCallback&#45;&gt;txnLogAppendRetryQueue</title>
<path fill="none" stroke="#000000" d="M2990.4297,-336.46C3053.3081,-297.9842 3141.6924,-243.9011 3191.5839,-213.3721"/>
<polygon fill="#000000" stroke="#000000" points="3193.4374,-216.3412 3200.1404,-208.1363 3189.7838,-210.3704 3193.4374,-216.3412"/>
</g>
<!-- sendTxnMarkersCallback -->
<g id="node27" class="node">
<title>sendTxnMarkersCallback</title>
<polygon fill="#f38181" stroke="#000000" points="412.7793,-220.2003 412.7793,-367.7997 623.5762,-367.7997 623.5762,-220.2003 412.7793,-220.2003"/>
<text text-anchor="middle" x="518.1777" y="-352.5997" font-family="Times,serif" font-size="14.00" fill="#000000">sendTxnMarkersCallback</text>
<polyline fill="none" stroke="#000000" points="412.7793,-345.7997 623.5762,-345.7997 "/>
<text text-anchor="start" x="420.7793" y="-330.5997" font-family="Times,serif" font-size="14.00" fill="#000000">prepareAbortOrCommit 事务日志</text>
<text text-anchor="start" x="420.7793" y="-310.9998" font-family="Times,serif" font-size="14.00" fill="#000000"> 写成功后的回调</text>
<text text-anchor="start" x="420.7793" y="-291.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> coordinator开始向各个broker</text>
<text text-anchor="start" x="420.7793" y="-271.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 发送txnMark请求</text>
<text text-anchor="start" x="420.7793" y="-252.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 不断尝试直到成功</text>
<text text-anchor="start" x="420.7793" y="-232.6002" font-family="Times,serif" font-size="14.00" fill="#000000"> 并将状态设置为Complete</text>
</g>
<!-- sendTxnMarkersCallback&#45;&gt;prepareComplete -->
<g id="edge42" class="edge">
<title>sendTxnMarkersCallback&#45;&gt;prepareComplete</title>
<path fill="none" stroke="#000000" d="M563.505,-368.0683C638.7924,-491.094 786.2037,-731.9758 835.3299,-812.252"/>
<polygon fill="#000000" stroke="#000000" points="832.3569,-814.0992 840.5621,-820.8018 838.3276,-810.4453 832.3569,-814.0992"/>
</g>
<!-- sendTxnMarkersCallback&#45;&gt;addTxnMarkersToSend -->
<g id="edge44" class="edge">
<title>sendTxnMarkersCallback&#45;&gt;addTxnMarkersToSend</title>
<path fill="none" stroke="#000000" d="M623.6262,-273.3462C633.6609,-271.4921 643.688,-269.682 653.3398,-268 686.3256,-262.2517 722.4865,-256.4523 754.7949,-251.4497"/>
<polygon fill="#000000" stroke="#000000" points="755.3406,-254.907 764.6902,-249.9237 754.2736,-247.9888 755.3406,-254.907"/>
</g>
<!-- tryAppendToLog -->
<g id="node28" class="node">
<title>tryAppendToLog</title>
<polygon fill="none" stroke="#000000" points="1740.874,-351.4001 1740.874,-420.5999 2077.7256,-420.5999 2077.7256,-351.4001 1740.874,-351.4001"/>
<text text-anchor="middle" x="1909.2998" y="-405.3999" font-family="Times,serif" font-size="14.00" fill="#000000">tryAppendToLog</text>
<polyline fill="none" stroke="#000000" points="1740.874,-398.5999 2077.7256,-398.5999 "/>
<text text-anchor="start" x="1748.874" y="-383.3999" font-family="Times,serif" font-size="14.00" fill="#000000">尝试写入Complete事务日志</text>
<text text-anchor="start" x="1748.874" y="-363.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 如果遇到COORDINATOR_NOT_AVAILABLE就重试</text>
</g>
<!-- tryAppendToLog&#45;&gt;appendTransactionToLog -->
<g id="edge16" class="edge">
<title>tryAppendToLog&#45;&gt;appendTransactionToLog</title>
<path fill="none" stroke="#000000" d="M1948.789,-420.6224C2000.4653,-465.9299 2090.925,-545.241 2146.1411,-593.652"/>
<polygon fill="#000000" stroke="#000000" points="2143.8641,-596.3104 2153.6907,-600.2712 2148.4789,-591.0469 2143.8641,-596.3104"/>
</g>
<!-- tryAppendToLog&#45;&gt;appendCallback -->
<g id="edge17" class="edge">
<title>tryAppendToLog&#45;&gt;appendCallback</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2077.7895,-385.1645C2270.1408,-384.2107 2581.9617,-382.6645 2766.675,-381.7486"/>
<polygon fill="#000000" stroke="#000000" points="2766.7575,-385.2483 2776.7399,-381.6987 2766.7227,-378.2484 2766.7575,-385.2483"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;TransactionMarkerRequestCompletionHandler -->
<g id="edge35" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;TransactionMarkerRequestCompletionHandler</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M557.7505,-133.7061C579.7362,-154.5011 606.3918,-182.3945 625.3398,-211 642.7104,-237.224 629.8286,-255.1038 653.3398,-276 653.4993,-276.1417 653.6591,-276.2831 653.8192,-276.4241"/>
<polygon fill="#000000" stroke="#000000" points="651.2947,-278.8787 661.2352,-282.5445 655.7504,-273.4799 651.2947,-278.8787"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;retryLogAppends -->
<g id="edge33" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;retryLogAppends</title>
<path fill="none" stroke="#000000" d="M625.5417,-95.459C677.5909,-93.7423 738.5201,-91.7328 784.0148,-90.2323"/>
<polygon fill="#000000" stroke="#000000" points="784.1826,-93.7288 794.0618,-89.9009 783.9518,-86.7326 784.1826,-93.7288"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;WriteTxnMarkersRequest -->
<g id="edge34" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;WriteTxnMarkersRequest</title>
<path fill="none" stroke="#000000" d="M625.5417,-118.3146C669.1745,-126.1641 719.0477,-135.1363 760.8374,-142.6542"/>
<polygon fill="#000000" stroke="#000000" points="760.2631,-146.107 770.7248,-144.4329 761.5026,-139.2176 760.2631,-146.107"/>
</g>
<!-- forEachTxnTopicPartition -->
<g id="node40" class="node">
<title>forEachTxnTopicPartition</title>
<polygon fill="none" stroke="#000000" points="932.9528,-52 770.4446,-52 770.4446,-16 932.9528,-16 932.9528,-52"/>
<text text-anchor="middle" x="851.6987" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#000000">forEachTxnTopicPartition</text>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;forEachTxnTopicPartition -->
<g id="edge31" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;forEachTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M625.5596,-67.3589C634.9156,-65.0437 644.2705,-62.8826 653.3398,-61 687.8797,-53.8301 726.2125,-48.1013 759.9009,-43.798"/>
<polygon fill="#000000" stroke="#000000" points="760.7101,-47.224 770.1975,-42.5082 759.84,-40.2783 760.7101,-47.224"/>
</g>
<!-- appendToLogCallback -->
<g id="node31" class="node">
<title>appendToLogCallback</title>
<polygon fill="none" stroke="#000000" points="1705.0306,-404 1561.4049,-404 1561.4049,-368 1705.0306,-368 1705.0306,-404"/>
<text text-anchor="middle" x="1633.2178" y="-381.8" font-family="Times,serif" font-size="14.00" fill="#000000">appendToLogCallback</text>
</g>
<!-- checkAndComplete&#45;&gt;appendToLogCallback -->
<g id="edge14" class="edge">
<title>checkAndComplete&#45;&gt;appendToLogCallback</title>
<path fill="none" stroke="#000000" d="M1483.6661,-388.104C1504.8449,-387.806 1528.7366,-387.4699 1551.1064,-387.1552"/>
<polygon fill="#000000" stroke="#000000" points="1551.3125,-390.6527 1561.2622,-387.0123 1551.2139,-383.6534 1551.3125,-390.6527"/>
</g>
<!-- appendToLogCallback&#45;&gt;tryAppendToLog -->
<g id="edge15" class="edge">
<title>appendToLogCallback&#45;&gt;tryAppendToLog</title>
<path fill="none" stroke="#000000" d="M1705.0344,-386C1713.2182,-386 1721.809,-386 1730.6434,-386"/>
<polygon fill="#000000" stroke="#000000" points="1730.7126,-389.5001 1740.7125,-386 1730.7125,-382.5001 1730.7126,-389.5001"/>
</g>
<!-- cancelForKey -->
<g id="node39" class="node">
<title>cancelForKey</title>
<polygon fill="none" stroke="#000000" points="1466.9939,-352 1372.9563,-352 1372.9563,-316 1466.9939,-316 1466.9939,-352"/>
<text text-anchor="middle" x="1419.9751" y="-329.8" font-family="Times,serif" font-size="14.00" fill="#000000">cancelForKey</text>
</g>
<!-- removeMarkersForTxnId&#45;&gt;cancelForKey -->
<g id="edge27" class="edge">
<title>removeMarkersForTxnId&#45;&gt;cancelForKey</title>
<path fill="none" stroke="#000000" d="M1257.3818,-324.5841C1291.6521,-326.5687 1331.0217,-328.8487 1362.4366,-330.6679"/>
<polygon fill="#000000" stroke="#000000" points="1362.5809,-334.182 1372.7665,-331.2661 1362.9856,-327.1937 1362.5809,-334.182"/>
</g>
<!-- addMarkersForBroker -->
<g id="node36" class="node">
<title>addMarkersForBroker</title>
<polygon fill="none" stroke="#000000" points="1490.6617,-244 1349.2885,-244 1349.2885,-208 1490.6617,-208 1490.6617,-244"/>
<text text-anchor="middle" x="1419.9751" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#000000">addMarkersForBroker</text>
</g>
<!-- addTxnMarkersToBrokerQueue&#45;&gt;addMarkersForBroker -->
<g id="edge23" class="edge">
<title>addTxnMarkersToBrokerQueue&#45;&gt;addMarkersForBroker</title>
<path fill="none" stroke="#000000" d="M1276.2044,-244.4358C1297.1424,-241.7509 1319.0317,-238.944 1339.2338,-236.3535"/>
<polygon fill="#000000" stroke="#000000" points="1339.8424,-239.8042 1349.316,-235.0607 1338.952,-232.8611 1339.8424,-239.8042"/>
</g>
<!-- markersQueueForUnknownBroker -->
<g id="node37" class="node">
<title>markersQueueForUnknownBroker</title>
<polygon fill="none" stroke="#000000" points="1525.648,-298 1314.3022,-298 1314.3022,-262 1525.648,-262 1525.648,-298"/>
<text text-anchor="middle" x="1419.9751" y="-275.8" font-family="Times,serif" font-size="14.00" fill="#000000">markersQueueForUnknownBroker</text>
</g>
<!-- addTxnMarkersToBrokerQueue&#45;&gt;markersQueueForUnknownBroker -->
<g id="edge24" class="edge">
<title>addTxnMarkersToBrokerQueue&#45;&gt;markersQueueForUnknownBroker</title>
<path fill="none" stroke="#000000" d="M1276.2044,-266.3218C1285.4318,-267.1997 1294.8439,-268.0952 1304.215,-268.9867"/>
<polygon fill="#000000" stroke="#000000" points="1304.0702,-272.4887 1314.3568,-269.9516 1304.7333,-265.5201 1304.0702,-272.4887"/>
</g>
<!-- DelayedTxnMarker -->
<g id="node35" class="node">
<title>DelayedTxnMarker</title>
<polygon fill="none" stroke="#000000" points="1483.3693,-190 1356.5809,-190 1356.5809,-154 1483.3693,-154 1483.3693,-190"/>
<text text-anchor="middle" x="1419.9751" y="-167.8" font-family="Times,serif" font-size="14.00" fill="#000000">DelayedTxnMarker</text>
</g>
<!-- tryCompleteElseWatch&#45;&gt;DelayedTxnMarker -->
<g id="edge21" class="edge">
<title>tryCompleteElseWatch&#45;&gt;DelayedTxnMarker</title>
<path fill="none" stroke="#000000" d="M1250.7567,-181.0996C1280.996,-179.4735 1316.068,-177.5875 1346.4152,-175.9556"/>
<polygon fill="#000000" stroke="#000000" points="1346.7143,-179.4447 1356.5119,-175.4127 1346.3384,-172.4548 1346.7143,-179.4447"/>
</g>
<!-- DelayedTxnMarker&#45;&gt;appendToLogCallback -->
<g id="edge22" class="edge">
<title>DelayedTxnMarker&#45;&gt;appendToLogCallback</title>
<path fill="none" stroke="#000000" d="M1483.427,-179.6091C1498.3027,-183.6264 1513.3552,-189.7324 1525.5615,-199 1579.7462,-240.1395 1611.232,-317.0198 1624.9554,-358.227"/>
<polygon fill="#000000" stroke="#000000" points="1621.6701,-359.4439 1628.0647,-367.8914 1628.3337,-357.3 1621.6701,-359.4439"/>
</g>
<!-- addMarkers -->
<g id="node38" class="node">
<title>addMarkers</title>
<polygon fill="none" stroke="#000000" points="2234.6637,-203 2151.9389,-203 2151.9389,-167 2234.6637,-167 2234.6637,-203"/>
<text text-anchor="middle" x="2193.3013" y="-180.8" font-family="Times,serif" font-size="14.00" fill="#000000">addMarkers</text>
</g>
<!-- addMarkersForBroker&#45;&gt;addMarkers -->
<g id="edge25" class="edge">
<title>addMarkersForBroker&#45;&gt;addMarkers</title>
<path fill="none" stroke="#000000" d="M1490.6527,-222.2528C1644.5497,-214.0936 2006.9515,-194.8798 2141.6738,-187.7372"/>
<polygon fill="#000000" stroke="#000000" points="2141.9313,-191.2285 2151.7319,-187.2039 2141.5606,-184.2383 2141.9313,-191.2285"/>
</g>
<!-- addMarkers&#45;&gt;markersPerTxnTopicPartition -->
<g id="edge26" class="edge">
<title>addMarkers&#45;&gt;markersPerTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M2234.8935,-182.4318C2376.3571,-173.6967 2843.4239,-144.8565 3083.8876,-130.0085"/>
<polygon fill="#000000" stroke="#000000" points="3084.3422,-133.4871 3094.1074,-129.3774 3083.9107,-126.5005 3084.3422,-133.4871"/>
</g>
<!-- forEachTxnTopicPartition&#45;&gt;markersPerTxnTopicPartition -->
<g id="edge32" class="edge">
<title>forEachTxnTopicPartition&#45;&gt;markersPerTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M932.9674,-43.5609C1043.1462,-55.6761 1246.131,-75 1419.9751,-75 1419.9751,-75 1419.9751,-75 2671.9927,-75 2812.2937,-75 2971.7759,-89.6341 3084.1675,-102.394"/>
<polygon fill="#000000" stroke="#000000" points="3083.8801,-105.8839 3094.2133,-103.5438 3084.6761,-98.9293 3083.8801,-105.8839"/>
</g>
<!-- doWork -->
<g id="node41" class="node">
<title>doWork</title>
<polygon fill="#f38181" stroke="#000000" points="16,-74.2 16,-123.8 196.876,-123.8 196.876,-74.2 16,-74.2"/>
<text text-anchor="middle" x="106.438" y="-108.6" font-family="Times,serif" font-size="14.00" fill="#000000">doWork</text>
<polyline fill="none" stroke="#000000" points="16,-101.8 196.876,-101.8 "/>
<text text-anchor="middle" x="106.438" y="-86.6" font-family="Times,serif" font-size="14.00" fill="#000000">Broker之间发送请求的线程</text>
</g>
<!-- doWork&#45;&gt;generateRequests -->
<g id="edge36" class="edge">
<title>doWork&#45;&gt;generateRequests</title>
<path fill="none" stroke="#000000" d="M197.0787,-99C207.2046,-99 217.4597,-99 227.4238,-99"/>
<polygon fill="#000000" stroke="#000000" points="227.6845,-102.5001 237.6844,-99 227.6844,-95.5001 227.6845,-102.5001"/>
</g>
</g>
</svg>
