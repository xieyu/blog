<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: txn_end Pages: 1 -->
<svg width="3340pt" height="931pt"
 viewBox="0.00 0.00 3339.96 930.68" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 926.6791)">
<title>txn_end</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-926.6791 3335.9551,-926.6791 3335.9551,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ReplicaManager</title>
<path fill="none" stroke="#000000" d="M2490.9053,-604.6791C2490.9053,-604.6791 2614.209,-604.6791 2614.209,-604.6791 2620.209,-604.6791 2626.209,-610.6791 2626.209,-616.6791 2626.209,-616.6791 2626.209,-672.6791 2626.209,-672.6791 2626.209,-678.6791 2620.209,-684.6791 2614.209,-684.6791 2614.209,-684.6791 2490.9053,-684.6791 2490.9053,-684.6791 2484.9053,-684.6791 2478.9053,-678.6791 2478.9053,-672.6791 2478.9053,-672.6791 2478.9053,-616.6791 2478.9053,-616.6791 2478.9053,-610.6791 2484.9053,-604.6791 2490.9053,-604.6791"/>
<text text-anchor="middle" x="2552.5571" y="-664.6791" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M1068.2832,-692.6791C1068.2832,-692.6791 3311.9551,-692.6791 3311.9551,-692.6791 3317.9551,-692.6791 3323.9551,-698.6791 3323.9551,-704.6791 3323.9551,-704.6791 3323.9551,-902.6791 3323.9551,-902.6791 3323.9551,-908.6791 3317.9551,-914.6791 3311.9551,-914.6791 3311.9551,-914.6791 1068.2832,-914.6791 1068.2832,-914.6791 1062.2832,-914.6791 1056.2832,-908.6791 1056.2832,-902.6791 1056.2832,-902.6791 1056.2832,-704.6791 1056.2832,-704.6791 1056.2832,-698.6791 1062.2832,-692.6791 1068.2832,-692.6791"/>
<text text-anchor="middle" x="2190.1191" y="-894.6791" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMetadata</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_TransactionStateManager</title>
<path fill="none" stroke="#000000" d="M1086.1729,-391.6791C1086.1729,-391.6791 2877.9092,-391.6791 2877.9092,-391.6791 2883.9092,-391.6791 2889.9092,-397.6791 2889.9092,-403.6791 2889.9092,-403.6791 2889.9092,-584.6791 2889.9092,-584.6791 2889.9092,-590.6791 2883.9092,-596.6791 2877.9092,-596.6791 2877.9092,-596.6791 1086.1729,-596.6791 1086.1729,-596.6791 1080.1729,-596.6791 1074.1729,-590.6791 1074.1729,-584.6791 1074.1729,-584.6791 1074.1729,-403.6791 1074.1729,-403.6791 1074.1729,-397.6791 1080.1729,-391.6791 1086.1729,-391.6791"/>
<text text-anchor="middle" x="1982.041" y="-576.6791" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionStateManager</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_TransactionMarkerRequestCompletionHandler</title>
<path fill="none" stroke="#000000" d="M651.5654,-361.6791C651.5654,-361.6791 1024.2832,-361.6791 1024.2832,-361.6791 1030.2832,-361.6791 1036.2832,-367.6791 1036.2832,-373.6791 1036.2832,-373.6791 1036.2832,-521.6791 1036.2832,-521.6791 1036.2832,-527.6791 1030.2832,-533.6791 1024.2832,-533.6791 1024.2832,-533.6791 651.5654,-533.6791 651.5654,-533.6791 645.5654,-533.6791 639.5654,-527.6791 639.5654,-521.6791 639.5654,-521.6791 639.5654,-373.6791 639.5654,-373.6791 639.5654,-367.6791 645.5654,-361.6791 651.5654,-361.6791"/>
<text text-anchor="middle" x="837.9243" y="-513.6791" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMarkerRequestCompletionHandler</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_TransactionMarkerChannelManager</title>
<path fill="none" stroke="#000000" d="M241.876,-37.6791C241.876,-37.6791 2893.085,-37.6791 2893.085,-37.6791 2899.085,-37.6791 2905.085,-43.6791 2905.085,-49.6791 2905.085,-49.6791 2905.085,-341.6791 2905.085,-341.6791 2905.085,-347.6791 2899.085,-353.6791 2893.085,-353.6791 2893.085,-353.6791 241.876,-353.6791 241.876,-353.6791 235.876,-353.6791 229.876,-347.6791 229.876,-341.6791 229.876,-341.6791 229.876,-49.6791 229.876,-49.6791 229.876,-43.6791 235.876,-37.6791 241.876,-37.6791"/>
<text text-anchor="middle" x="1567.4805" y="-333.6791" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMarkerChannelManager</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_InterBrokerSendThread</title>
<path fill="none" stroke="#000000" d="M16,-119.6791C16,-119.6791 197.876,-119.6791 197.876,-119.6791 203.876,-119.6791 209.876,-125.6791 209.876,-131.6791 209.876,-131.6791 209.876,-201.6791 209.876,-201.6791 209.876,-207.6791 203.876,-213.6791 197.876,-213.6791 197.876,-213.6791 16,-213.6791 16,-213.6791 10,-213.6791 4,-207.6791 4,-201.6791 4,-201.6791 4,-131.6791 4,-131.6791 4,-125.6791 10,-119.6791 16,-119.6791"/>
<text text-anchor="middle" x="106.938" y="-193.6791" font-family="Times,serif" font-size="20.00" fill="#000000">InterBrokerSendThread</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_TransactionCoordinator</title>
<path fill="none" stroke="#000000" d="M747.1909,-541.6791C747.1909,-541.6791 928.6577,-541.6791 928.6577,-541.6791 934.6577,-541.6791 940.6577,-547.6791 940.6577,-553.6791 940.6577,-553.6791 940.6577,-609.6791 940.6577,-609.6791 940.6577,-615.6791 934.6577,-621.6791 928.6577,-621.6791 928.6577,-621.6791 747.1909,-621.6791 747.1909,-621.6791 741.1909,-621.6791 735.1909,-615.6791 735.1909,-609.6791 735.1909,-609.6791 735.1909,-553.6791 735.1909,-553.6791 735.1909,-547.6791 741.1909,-541.6791 747.1909,-541.6791"/>
<text text-anchor="middle" x="837.9243" y="-601.6791" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionCoordinator</text>
</g>
<g id="clust17" class="cluster">
<title>cluster_KafkaApi</title>
<path fill="none" stroke="#000000" d="M443.5283,-541.6791C443.5283,-541.6791 579.0527,-541.6791 579.0527,-541.6791 585.0527,-541.6791 591.0527,-547.6791 591.0527,-553.6791 591.0527,-553.6791 591.0527,-609.6791 591.0527,-609.6791 591.0527,-615.6791 585.0527,-621.6791 579.0527,-621.6791 579.0527,-621.6791 443.5283,-621.6791 443.5283,-621.6791 437.5283,-621.6791 431.5283,-615.6791 431.5283,-609.6791 431.5283,-609.6791 431.5283,-553.6791 431.5283,-553.6791 431.5283,-547.6791 437.5283,-541.6791 443.5283,-541.6791"/>
<text text-anchor="middle" x="511.2905" y="-601.6791" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<!-- appendRecords -->
<g id="node1" class="node">
<title>appendRecords</title>
<polygon fill="none" stroke="#000000" points="2603.3613,-648.6791 2500.753,-648.6791 2500.753,-612.6791 2603.3613,-612.6791 2603.3613,-648.6791"/>
<text text-anchor="middle" x="2552.0571" y="-626.4791" font-family="Times,serif" font-size="14.00" fill="#000000">appendRecords</text>
</g>
<!-- updateCacheCallback -->
<g id="node14" class="node">
<title>updateCacheCallback</title>
<polygon fill="none" stroke="#000000" points="2743.8535,-491.0792 2743.8535,-560.279 2881.9092,-560.279 2881.9092,-491.0792 2743.8535,-491.0792"/>
<text text-anchor="middle" x="2812.8813" y="-545.079" font-family="Times,serif" font-size="14.00" fill="#000000">updateCacheCallback</text>
<polyline fill="none" stroke="#000000" points="2743.8535,-538.279 2881.9092,-538.279 "/>
<text text-anchor="start" x="2751.8535" y="-523.079" font-family="Times,serif" font-size="14.00" fill="#000000">日志写入</text>
<text text-anchor="start" x="2751.8535" y="-503.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> 成功回调</text>
</g>
<!-- appendRecords&#45;&gt;updateCacheCallback -->
<g id="edge11" class="edge">
<title>appendRecords&#45;&gt;updateCacheCallback</title>
<path fill="none" stroke="#000000" d="M2603.4335,-624.1151C2630.6355,-619.5571 2664.2098,-612.1822 2692.6777,-600.6791 2714.928,-591.6883 2737.6773,-578.6574 2757.3137,-565.9716"/>
<polygon fill="#000000" stroke="#000000" points="2759.3858,-568.7979 2765.8149,-560.3766 2755.5375,-562.9506 2759.3858,-568.7979"/>
</g>
<!-- TransactionMetadata -->
<g id="node2" class="node">
<title>TransactionMetadata</title>
<polygon fill="#95e1d3" stroke="#000000" points="2109.5386,-701.6791 2109.5386,-877.6791 2370.2993,-877.6791 2370.2993,-701.6791 2109.5386,-701.6791"/>
<text text-anchor="middle" x="2239.9189" y="-862.4791" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionMetadata</text>
<polyline fill="none" stroke="#000000" points="2109.5386,-855.6791 2370.2993,-855.6791 "/>
<text text-anchor="start" x="2117.5386" y="-840.4791" font-family="Times,serif" font-size="14.00" fill="#000000">transactionalId: String </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-833.6791 2370.2993,-833.6791 "/>
<text text-anchor="start" x="2117.5386" y="-818.4791" font-family="Times,serif" font-size="14.00" fill="#000000">producerId: long </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-811.6791 2370.2993,-811.6791 "/>
<text text-anchor="start" x="2117.5386" y="-796.4791" font-family="Times,serif" font-size="14.00" fill="#000000">lastProducerId: Long </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-789.6791 2370.2993,-789.6791 "/>
<text text-anchor="start" x="2117.5386" y="-774.4791" font-family="Times,serif" font-size="14.00" fill="#000000">producerEpoch: short </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-767.6791 2370.2993,-767.6791 "/>
<text text-anchor="start" x="2117.5386" y="-752.4791" font-family="Times,serif" font-size="14.00" fill="#000000">txnTimeoutMs: Int </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-745.6791 2370.2993,-745.6791 "/>
<text text-anchor="start" x="2117.5386" y="-730.4791" font-family="Times,serif" font-size="14.00" fill="#000000">state: TransactionState </text>
<polyline fill="none" stroke="#000000" points="2109.5386,-723.6791 2370.2993,-723.6791 "/>
<text text-anchor="start" x="2117.5386" y="-708.4791" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartitions: mutable.Set[TopicPartition]</text>
</g>
<!-- prepareTransitionTo -->
<g id="node3" class="node">
<title>prepareTransitionTo</title>
<polygon fill="none" stroke="#000000" points="1348.9375,-761.6791 1348.9375,-797.6791 1478.5371,-797.6791 1478.5371,-761.6791 1348.9375,-761.6791"/>
<text text-anchor="middle" x="1413.7373" y="-775.4791" font-family="Times,serif" font-size="14.00" fill="#000000">prepareTransitionTo</text>
</g>
<!-- pendingState -->
<g id="node5" class="node">
<title>pendingState</title>
<polygon fill="#95e1d3" stroke="#000000" points="1732.5328,-797.6791 1647.3393,-797.6791 1643.3393,-793.6791 1643.3393,-761.6791 1728.5328,-761.6791 1732.5328,-765.6791 1732.5328,-797.6791"/>
<polyline fill="none" stroke="#000000" points="1728.5328,-793.6791 1643.3393,-793.6791 "/>
<polyline fill="none" stroke="#000000" points="1728.5328,-793.6791 1728.5328,-761.6791 "/>
<polyline fill="none" stroke="#000000" points="1728.5328,-793.6791 1732.5328,-797.6791 "/>
<text text-anchor="middle" x="1687.936" y="-775.4791" font-family="Times,serif" font-size="14.00" fill="#000000">pendingState</text>
</g>
<!-- prepareTransitionTo&#45;&gt;pendingState -->
<g id="edge2" class="edge">
<title>prepareTransitionTo&#45;&gt;pendingState</title>
<path fill="none" stroke="#000000" d="M1478.7186,-779.6791C1525.734,-779.6791 1588.5676,-779.6791 1633.0686,-779.6791"/>
<polygon fill="#000000" stroke="#000000" points="1633.118,-783.1792 1643.118,-779.6791 1633.1179,-776.1792 1633.118,-783.1792"/>
</g>
<!-- completeTransitionTo -->
<g id="node4" class="node">
<title>completeTransitionTo</title>
<polygon fill="none" stroke="#000000" points="2933.085,-701.2792 2933.085,-798.079 3106.585,-798.079 3106.585,-701.2792 2933.085,-701.2792"/>
<text text-anchor="middle" x="3019.835" y="-782.879" font-family="Times,serif" font-size="14.00" fill="#000000">completeTransitionTo</text>
<polyline fill="none" stroke="#000000" points="2933.085,-776.079 3106.585,-776.079 "/>
<text text-anchor="middle" x="3019.835" y="-760.879" font-family="Times,serif" font-size="14.00" fill="#000000">在PrepareCommit</text>
<polyline fill="none" stroke="#000000" points="2933.085,-748.479 3106.585,-748.479 "/>
<text text-anchor="start" x="2941.085" y="-733.279" font-family="Times,serif" font-size="14.00" fill="#000000">PrepareAbort状态下，</text>
<text text-anchor="start" x="2941.085" y="-713.6791" font-family="Times,serif" font-size="14.00" fill="#000000"> 如果状态不对，抛出异常</text>
</g>
<!-- throwStateTransitionFailure -->
<g id="node8" class="node">
<title>throwStateTransitionFailure</title>
<polygon fill="none" stroke="#000000" points="3316.1405,-767.6791 3142.3995,-767.6791 3142.3995,-731.6791 3316.1405,-731.6791 3316.1405,-767.6791"/>
<text text-anchor="middle" x="3229.27" y="-745.4791" font-family="Times,serif" font-size="14.00" fill="#000000">throwStateTransitionFailure</text>
</g>
<!-- completeTransitionTo&#45;&gt;throwStateTransitionFailure -->
<g id="edge3" class="edge">
<title>completeTransitionTo&#45;&gt;throwStateTransitionFailure</title>
<path fill="none" stroke="#000000" d="M3106.8348,-749.6791C3115.3165,-749.6791 3123.9579,-749.6791 3132.5277,-749.6791"/>
<polygon fill="#000000" stroke="#000000" points="3132.5411,-753.1792 3142.541,-749.6791 3132.541,-746.1792 3132.5411,-753.1792"/>
</g>
<!-- prepareAbortOrCommit -->
<g id="node6" class="node">
<title>prepareAbortOrCommit</title>
<polygon fill="none" stroke="#000000" points="1064.2832,-754.8791 1064.2832,-804.479 1270.8418,-804.479 1270.8418,-754.8791 1064.2832,-754.8791"/>
<text text-anchor="middle" x="1167.5625" y="-789.279" font-family="Times,serif" font-size="14.00" fill="#000000">prepareAbortOrCommit</text>
<polyline fill="none" stroke="#000000" points="1064.2832,-782.479 1270.8418,-782.479 "/>
<text text-anchor="middle" x="1167.5625" y="-767.279" font-family="Times,serif" font-size="14.00" fill="#000000">将状态切换为Commit或者Abort</text>
</g>
<!-- prepareAbortOrCommit&#45;&gt;prepareTransitionTo -->
<g id="edge1" class="edge">
<title>prepareAbortOrCommit&#45;&gt;prepareTransitionTo</title>
<path fill="none" stroke="#000000" d="M1270.8928,-779.6791C1293.621,-779.6791 1317.272,-779.6791 1338.6362,-779.6791"/>
<polygon fill="#000000" stroke="#000000" points="1338.9264,-783.1792 1348.9264,-779.6791 1338.9263,-776.1792 1338.9264,-783.1792"/>
</g>
<!-- removePartition -->
<g id="node7" class="node">
<title>removePartition</title>
<polygon fill="none" stroke="#000000" points="1220.7629,-736.6791 1114.3621,-736.6791 1114.3621,-700.6791 1220.7629,-700.6791 1220.7629,-736.6791"/>
<text text-anchor="middle" x="1167.5625" y="-714.4791" font-family="Times,serif" font-size="14.00" fill="#000000">removePartition</text>
</g>
<!-- appendTransactionToLog -->
<g id="node9" class="node">
<title>appendTransactionToLog</title>
<polygon fill="none" stroke="#000000" points="2160.3433,-400.0792 2160.3433,-469.279 2319.4946,-469.279 2319.4946,-400.0792 2160.3433,-400.0792"/>
<text text-anchor="middle" x="2239.9189" y="-454.079" font-family="Times,serif" font-size="14.00" fill="#000000">appendTransactionToLog</text>
<polyline fill="none" stroke="#000000" points="2160.3433,-447.279 2319.4946,-447.279 "/>
<text text-anchor="start" x="2168.3433" y="-432.079" font-family="Times,serif" font-size="14.00" fill="#000000">将事务日志对应的</text>
<text text-anchor="start" x="2168.3433" y="-412.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入topic_partition</text>
</g>
<!-- appendTransactionToLog&#45;&gt;appendRecords -->
<g id="edge9" class="edge">
<title>appendTransactionToLog&#45;&gt;appendRecords</title>
<path fill="none" stroke="#000000" d="M2265.8252,-469.4628C2296.3073,-507.771 2350.5457,-568.2303 2411.4365,-600.6791 2435.6496,-613.5822 2464.9921,-620.9357 2490.5964,-625.1264"/>
<polygon fill="#000000" stroke="#000000" points="2490.1638,-628.6007 2500.5744,-626.6337 2491.2094,-621.6792 2490.1638,-628.6007"/>
</g>
<!-- TRANSACTION_STATE_TOPIC_NAME -->
<g id="node16" class="node">
<title>TRANSACTION_STATE_TOPIC_NAME</title>
<polygon fill="none" stroke="#000000" points="2681.145,-452.6791 2422.9692,-452.6791 2422.9692,-416.6791 2681.145,-416.6791 2681.145,-452.6791"/>
<text text-anchor="middle" x="2552.0571" y="-430.4791" font-family="Times,serif" font-size="14.00" fill="#000000">TRANSACTION_STATE_TOPIC_NAME</text>
</g>
<!-- appendTransactionToLog&#45;&gt;TRANSACTION_STATE_TOPIC_NAME -->
<g id="edge10" class="edge">
<title>appendTransactionToLog&#45;&gt;TRANSACTION_STATE_TOPIC_NAME</title>
<path fill="none" stroke="#000000" d="M2319.897,-434.6791C2348.1756,-434.6791 2380.8671,-434.6791 2412.6286,-434.6791"/>
<polygon fill="#000000" stroke="#000000" points="2412.9014,-438.1792 2422.9014,-434.6791 2412.9013,-431.1792 2412.9014,-438.1792"/>
</g>
<!-- appendCallback -->
<g id="node27" class="node">
<title>appendCallback</title>
<polygon fill="none" stroke="#000000" points="2411.4365,-232.0792 2411.4365,-301.279 2692.6777,-301.279 2692.6777,-232.0792 2411.4365,-232.0792"/>
<text text-anchor="middle" x="2552.0571" y="-286.079" font-family="Times,serif" font-size="14.00" fill="#000000">appendCallback</text>
<polyline fill="none" stroke="#000000" points="2411.4365,-279.279 2692.6777,-279.279 "/>
<text text-anchor="start" x="2419.4365" y="-264.079" font-family="Times,serif" font-size="14.00" fill="#000000">对于COORDINATOR_NOT_AVALIBLE错误</text>
<text text-anchor="middle" x="2552.0571" y="-244.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> 加入队列</text>
</g>
<!-- appendTransactionToLog&#45;&gt;appendCallback -->
<g id="edge18" class="edge">
<title>appendTransactionToLog&#45;&gt;appendCallback</title>
<path fill="none" stroke="#000000" d="M2304.2157,-400.0731C2354.9118,-372.7873 2425.6448,-334.7171 2478.5757,-306.2285"/>
<polygon fill="#000000" stroke="#000000" points="2480.4292,-309.2057 2487.576,-301.3843 2477.1116,-303.0418 2480.4292,-309.2057"/>
</g>
<!-- getTransactionState -->
<g id="node10" class="node">
<title>getTransactionState</title>
<polygon fill="none" stroke="#000000" points="1082.1729,-453.8791 1082.1729,-503.479 1252.9521,-503.479 1252.9521,-453.8791 1082.1729,-453.8791"/>
<text text-anchor="middle" x="1167.5625" y="-488.279" font-family="Times,serif" font-size="14.00" fill="#000000">getTransactionState</text>
<polyline fill="none" stroke="#000000" points="1082.1729,-481.479 1252.9521,-481.479 "/>
<text text-anchor="middle" x="1167.5625" y="-466.279" font-family="Times,serif" font-size="14.00" fill="#000000">根据tid获取事务对应状态</text>
</g>
<!-- getAndMaybeAddTransactionState -->
<g id="node15" class="node">
<title>getAndMaybeAddTransactionState</title>
<polygon fill="none" stroke="#000000" points="1520.5284,-496.6791 1306.9462,-496.6791 1306.9462,-460.6791 1520.5284,-460.6791 1520.5284,-496.6791"/>
<text text-anchor="middle" x="1413.7373" y="-474.4791" font-family="Times,serif" font-size="14.00" fill="#000000">getAndMaybeAddTransactionState</text>
</g>
<!-- getTransactionState&#45;&gt;getAndMaybeAddTransactionState -->
<g id="edge6" class="edge">
<title>getTransactionState&#45;&gt;getAndMaybeAddTransactionState</title>
<path fill="none" stroke="#000000" d="M1252.9716,-478.6791C1267.0755,-478.6791 1281.9099,-478.6791 1296.63,-478.6791"/>
<polygon fill="#000000" stroke="#000000" points="1296.7922,-482.1792 1306.7921,-478.6791 1296.7921,-475.1792 1296.7922,-482.1792"/>
</g>
<!-- transactionMetadataCache -->
<g id="node11" class="node">
<title>transactionMetadataCache</title>
<polygon fill="#95e1d3" stroke="#000000" points="1556.6328,-399.8791 1556.6328,-463.479 1819.2393,-463.479 1819.2393,-399.8791 1556.6328,-399.8791"/>
<text text-anchor="middle" x="1687.936" y="-448.279" font-family="Times,serif" font-size="14.00" fill="#000000">transactionMetadataCache</text>
<polyline fill="none" stroke="#000000" points="1556.6328,-441.479 1819.2393,-441.479 "/>
<text text-anchor="start" x="1564.6328" y="-426.279" font-family="Times,serif" font-size="14.00" fill="#000000">mutable.Map[Int, TxnMetadataCacheEntry]</text>
<text text-anchor="middle" x="1687.936" y="-412.279" font-family="Times,serif" font-size="14.00" fill="#000000"> parition 到cacheEntry的映射</text>
</g>
<!-- TxnMetadataCacheEntry -->
<g id="node12" class="node">
<title>TxnMetadataCacheEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="1855.2393,-429.8791 1855.2393,-529.479 2068.4014,-529.479 2068.4014,-429.8791 1855.2393,-429.8791"/>
<text text-anchor="middle" x="1961.8203" y="-514.279" font-family="Times,serif" font-size="14.00" fill="#000000">TxnMetadataCacheEntry</text>
<polyline fill="none" stroke="#000000" points="1855.2393,-507.479 2068.4014,-507.479 "/>
<text text-anchor="start" x="1863.2393" y="-492.279" font-family="Times,serif" font-size="14.00" fill="#000000">coordinatorEpoch Int </text>
<polyline fill="none" stroke="#000000" points="1855.2393,-485.479 2068.4014,-485.479 "/>
<text text-anchor="start" x="1863.2393" y="-470.279" font-family="Times,serif" font-size="14.00" fill="#000000">metadataPerTransactionalId </text>
<text text-anchor="start" x="1863.2393" y="-456.279" font-family="Times,serif" font-size="14.00" fill="#000000"> Pool[String, TransactionMetadata]</text>
<text text-anchor="middle" x="1961.8203" y="-442.279" font-family="Times,serif" font-size="14.00" fill="#000000"> 事务ID到事务metadata映射</text>
</g>
<!-- transactionMetadataCache&#45;&gt;TxnMetadataCacheEntry -->
<g id="edge4" class="edge">
<title>transactionMetadataCache:entry&#45;&gt;TxnMetadataCacheEntry</title>
<path fill="none" stroke="#000000" d="M1818.936,-420.6791C1832.6496,-420.6791 1846.5812,-423.0297 1860.0975,-426.7925"/>
<polygon fill="#000000" stroke="#000000" points="1859.271,-430.1995 1869.857,-429.7685 1861.3128,-423.5038 1859.271,-430.1995"/>
</g>
<!-- TxnMetadataCacheEntry&#45;&gt;TransactionMetadata -->
<g id="edge5" class="edge">
<title>TxnMetadataCacheEntry:meta&#45;&gt;TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M2068.4014,-457.6791C2133.94,-457.6791 2076.8218,-541.2259 2104.4014,-600.6791 2119.1696,-632.515 2139.5319,-664.5205 2159.9871,-692.9104"/>
<polygon fill="#000000" stroke="#000000" points="2157.3202,-695.1933 2166.0421,-701.2083 2162.9749,-691.0672 2157.3202,-695.1933"/>
</g>
<!-- partitionFor -->
<g id="node13" class="node">
<title>partitionFor</title>
<polygon fill="none" stroke="#000000" points="1573.7979,-482.8791 1573.7979,-560.479 1802.0742,-560.479 1802.0742,-482.8791 1573.7979,-482.8791"/>
<text text-anchor="middle" x="1687.936" y="-545.279" font-family="Times,serif" font-size="14.00" fill="#000000">partitionFor</text>
<polyline fill="none" stroke="#000000" points="1573.7979,-538.479 1802.0742,-538.479 "/>
<text text-anchor="start" x="1581.7979" y="-523.279" font-family="Times,serif" font-size="14.00" fill="#000000">Utils.abs(transactionalId.hashCode)%</text>
<text text-anchor="start" x="1581.7979" y="-509.279" font-family="Times,serif" font-size="14.00" fill="#000000"> transactionTopicPartitionCount </text>
<text text-anchor="start" x="1581.7979" y="-495.279" font-family="Times,serif" font-size="14.00" fill="#000000"> 根据事务id获取对应的partition</text>
</g>
<!-- updateCacheCallback&#45;&gt;completeTransitionTo -->
<g id="edge12" class="edge">
<title>updateCacheCallback&#45;&gt;completeTransitionTo</title>
<path fill="none" stroke="#000000" d="M2845.2178,-560.6791C2878.1417,-596.3148 2929.6889,-652.1079 2968.2568,-693.8525"/>
<polygon fill="#000000" stroke="#000000" points="2965.6997,-696.2425 2975.0566,-701.2124 2970.8412,-691.4922 2965.6997,-696.2425"/>
</g>
<!-- getAndMaybeAddTransactionState&#45;&gt;transactionMetadataCache -->
<g id="edge7" class="edge">
<title>getAndMaybeAddTransactionState&#45;&gt;transactionMetadataCache</title>
<path fill="none" stroke="#000000" d="M1518.9655,-460.6421C1527.9492,-459.1022 1537.1262,-457.5292 1546.3303,-455.9515"/>
<polygon fill="#000000" stroke="#000000" points="1547.0556,-459.3783 1556.3205,-454.2391 1545.8729,-452.4789 1547.0556,-459.3783"/>
</g>
<!-- getAndMaybeAddTransactionState&#45;&gt;partitionFor -->
<g id="edge8" class="edge">
<title>getAndMaybeAddTransactionState&#45;&gt;partitionFor</title>
<path fill="none" stroke="#000000" d="M1520.5348,-495.4271C1534.7074,-497.6497 1549.3347,-499.9435 1563.7691,-502.2072"/>
<polygon fill="#000000" stroke="#000000" points="1563.3018,-505.6766 1573.7234,-503.7682 1564.3864,-498.7611 1563.3018,-505.6766"/>
</g>
<!-- TransactionMarkerRequestCompletionHandler -->
<g id="node17" class="node">
<title>TransactionMarkerRequestCompletionHandler</title>
<polygon fill="none" stroke="#000000" points="647.5654,-369.6793 647.5654,-497.6789 1028.2832,-497.6789 1028.2832,-369.6793 647.5654,-369.6793"/>
<text text-anchor="middle" x="837.9243" y="-482.4789" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionMarkerRequestCompletionHandler</text>
<polyline fill="none" stroke="#000000" points="647.5654,-475.6789 1028.2832,-475.6789 "/>
<text text-anchor="start" x="655.5654" y="-460.4789" font-family="Times,serif" font-size="14.00" fill="#000000">处理parition broker对</text>
<text text-anchor="start" x="655.5654" y="-440.879" font-family="Times,serif" font-size="14.00" fill="#000000"> writeMark的响应</text>
<text text-anchor="start" x="655.5654" y="-421.279" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.首先判断自己是否还是tid对应的coordinator</text>
<text text-anchor="start" x="655.5654" y="-401.6791" font-family="Times,serif" font-size="14.00" fill="#000000"> 检查epoch能否对的上 如果不是的就removeMarkersForTxnId</text>
<text text-anchor="start" x="655.5654" y="-382.0792" font-family="Times,serif" font-size="14.00" fill="#000000"> 2.将出错的partition加入retry</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;removePartition -->
<g id="edge43" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;removePartition</title>
<path fill="none" stroke="#000000" d="M991.2948,-497.7051C1008.0076,-509.2121 1023.5437,-522.4818 1036.2832,-537.6791 1055.1555,-560.1924 1041.3879,-575.3583 1056.2832,-600.6791 1077.7983,-637.2529 1112.5419,-671.6557 1137.4855,-693.7706"/>
<polygon fill="#000000" stroke="#000000" points="1135.3731,-696.5724 1145.2106,-700.5062 1139.9734,-691.2963 1135.3731,-696.5724"/>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;getTransactionState -->
<g id="edge44" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;getTransactionState</title>
<path fill="none" stroke="#000000" d="M1028.7216,-459.7255C1043.6158,-461.7587 1058.2196,-463.7523 1072.03,-465.6376"/>
<polygon fill="#000000" stroke="#000000" points="1071.5571,-469.1054 1081.9386,-466.9903 1072.504,-462.1698 1071.5571,-469.1054"/>
</g>
<!-- completeSendMarkersForTxnId -->
<g id="node24" class="node">
<title>completeSendMarkersForTxnId</title>
<polygon fill="none" stroke="#000000" points="1069.752,-86.2792 1069.752,-175.079 1265.373,-175.079 1265.373,-86.2792 1069.752,-86.2792"/>
<text text-anchor="middle" x="1167.5625" y="-159.879" font-family="Times,serif" font-size="14.00" fill="#000000">completeSendMarkersForTxnId</text>
<polyline fill="none" stroke="#000000" points="1069.752,-153.079 1265.373,-153.079 "/>
<text text-anchor="start" x="1077.752" y="-137.879" font-family="Times,serif" font-size="14.00" fill="#000000">所有marker请求</text>
<text text-anchor="start" x="1077.752" y="-118.279" font-family="Times,serif" font-size="14.00" fill="#000000"> 都处理成功了</text>
<text text-anchor="start" x="1077.752" y="-98.6791" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入日志</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;completeSendMarkersForTxnId -->
<g id="edge45" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;completeSendMarkersForTxnId</title>
<path fill="none" stroke="#000000" d="M1025.6931,-369.6611C1029.4611,-365.8931 1033.0046,-361.9035 1036.2832,-357.6791 1083.7391,-296.5329 1011.4965,-247.8064 1056.2832,-184.6791 1058.2092,-181.9644 1060.3098,-179.3806 1062.557,-176.9216"/>
<polygon fill="#000000" stroke="#000000" points="1065.0164,-179.4119 1069.7098,-169.9133 1060.1174,-174.4119 1065.0164,-179.4119"/>
</g>
<!-- removeMarkersForTxnId -->
<g id="node31" class="node">
<title>removeMarkersForTxnId</title>
<polygon fill="none" stroke="#000000" points="1246.8528,-229.6791 1088.2722,-229.6791 1088.2722,-193.6791 1246.8528,-193.6791 1246.8528,-229.6791"/>
<text text-anchor="middle" x="1167.5625" y="-207.4791" font-family="Times,serif" font-size="14.00" fill="#000000">removeMarkersForTxnId</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;removeMarkersForTxnId -->
<g id="edge46" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;removeMarkersForTxnId</title>
<path fill="none" stroke="#000000" d="M1025.4061,-369.4324C1029.2583,-365.7315 1032.8971,-361.8178 1036.2832,-357.6791 1070.2433,-316.1705 1019.7407,-277.9333 1056.2832,-238.6791 1062.6496,-231.8402 1070.4293,-226.6024 1078.8886,-222.6083"/>
<polygon fill="#000000" stroke="#000000" points="1080.3778,-225.7805 1088.2998,-218.7455 1077.7198,-219.3047 1080.3778,-225.7805"/>
</g>
<!-- addTxnMarkersToBrokerQueue -->
<g id="node32" class="node">
<title>addTxnMarkersToBrokerQueue</title>
<polygon fill="none" stroke="#000000" points="1511.6401,-317.6791 1315.8345,-317.6791 1315.8345,-281.6791 1511.6401,-281.6791 1511.6401,-317.6791"/>
<text text-anchor="middle" x="1413.7373" y="-295.4791" font-family="Times,serif" font-size="14.00" fill="#000000">addTxnMarkersToBrokerQueue</text>
</g>
<!-- TransactionMarkerRequestCompletionHandler&#45;&gt;addTxnMarkersToBrokerQueue -->
<g id="edge47" class="edge">
<title>TransactionMarkerRequestCompletionHandler&#45;&gt;addTxnMarkersToBrokerQueue</title>
<path fill="none" stroke="#000000" d="M1028.4871,-376.7192C1037.865,-374.264 1047.1682,-371.9024 1056.2832,-369.6791 1080.685,-363.727 1212.4767,-338.2014 1308.964,-319.6901"/>
<polygon fill="#000000" stroke="#000000" points="1309.907,-323.0731 1319.0689,-317.7523 1308.5886,-316.1984 1309.907,-323.0731"/>
</g>
<!-- retryLogAppends -->
<g id="node18" class="node">
<title>retryLogAppends</title>
<polygon fill="none" stroke="#000000" points="2019.0725,-81.6791 1904.5681,-81.6791 1904.5681,-45.6791 2019.0725,-45.6791 2019.0725,-81.6791"/>
<text text-anchor="middle" x="1961.8203" y="-59.4791" font-family="Times,serif" font-size="14.00" fill="#000000">retryLogAppends</text>
</g>
<!-- txnLogAppendRetryQueue -->
<g id="node19" class="node">
<title>txnLogAppendRetryQueue</title>
<polygon fill="#95e1d3" stroke="#000000" points="2897.2891,-266.6791 2732.4736,-266.6791 2728.4736,-262.6791 2728.4736,-230.6791 2893.2891,-230.6791 2897.2891,-234.6791 2897.2891,-266.6791"/>
<polyline fill="none" stroke="#000000" points="2893.2891,-262.6791 2728.4736,-262.6791 "/>
<polyline fill="none" stroke="#000000" points="2893.2891,-262.6791 2893.2891,-230.6791 "/>
<polyline fill="none" stroke="#000000" points="2893.2891,-262.6791 2897.2891,-266.6791 "/>
<text text-anchor="middle" x="2812.8813" y="-244.4791" font-family="Times,serif" font-size="14.00" fill="#000000">txnLogAppendRetryQueue</text>
</g>
<!-- retryLogAppends&#45;&gt;txnLogAppendRetryQueue -->
<g id="edge13" class="edge">
<title>retryLogAppends&#45;&gt;txnLogAppendRetryQueue</title>
<path fill="none" stroke="#000000" d="M2019.5584,-47.9065C2152.9444,-15.1684 2486.8025,45.1359 2692.6777,-106.6791 2729.3525,-133.7235 2698.8099,-168.2646 2728.6777,-202.6791 2736.5254,-211.7214 2746.6039,-219.3122 2757.0421,-225.5539"/>
<polygon fill="#000000" stroke="#000000" points="2755.4174,-228.6554 2765.8536,-230.4819 2758.8342,-222.546 2755.4174,-228.6554"/>
</g>
<!-- TxnIdAndMarkerEntry -->
<g id="node20" class="node">
<title>TxnIdAndMarkerEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="2447.9609,-116.6791 2447.9609,-182.6791 2656.1533,-182.6791 2656.1533,-116.6791 2447.9609,-116.6791"/>
<text text-anchor="middle" x="2552.0571" y="-167.4791" font-family="Times,serif" font-size="14.00" fill="#000000">TxnIdAndMarkerEntry</text>
<polyline fill="none" stroke="#000000" points="2447.9609,-160.6791 2656.1533,-160.6791 "/>
<text text-anchor="middle" x="2552.0571" y="-145.4791" font-family="Times,serif" font-size="14.00" fill="#000000">txnId: String</text>
<polyline fill="none" stroke="#000000" points="2447.9609,-138.6791 2656.1533,-138.6791 "/>
<text text-anchor="middle" x="2552.0571" y="-123.4791" font-family="Times,serif" font-size="14.00" fill="#000000">txnMarkerEntry: TxnMarkerEntry</text>
</g>
<!-- TxnMarkerEntry -->
<g id="node21" class="node">
<title>TxnMarkerEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="2736.8911,-61.6791 2736.8911,-193.6791 2888.8716,-193.6791 2888.8716,-61.6791 2736.8911,-61.6791"/>
<text text-anchor="middle" x="2812.8813" y="-178.4791" font-family="Times,serif" font-size="14.00" fill="#000000">TxnMarkerEntry</text>
<polyline fill="none" stroke="#000000" points="2736.8911,-171.6791 2888.8716,-171.6791 "/>
<text text-anchor="middle" x="2812.8813" y="-156.4791" font-family="Times,serif" font-size="14.00" fill="#000000">producerId long</text>
<polyline fill="none" stroke="#000000" points="2736.8911,-149.6791 2888.8716,-149.6791 "/>
<text text-anchor="middle" x="2812.8813" y="-134.4791" font-family="Times,serif" font-size="14.00" fill="#000000">producerEpoch short</text>
<polyline fill="none" stroke="#000000" points="2736.8911,-127.6791 2888.8716,-127.6791 "/>
<text text-anchor="middle" x="2812.8813" y="-112.4791" font-family="Times,serif" font-size="14.00" fill="#000000">coordinatorEpoch int</text>
<polyline fill="none" stroke="#000000" points="2736.8911,-105.6791 2888.8716,-105.6791 "/>
<text text-anchor="middle" x="2812.8813" y="-90.4791" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionResult result</text>
<polyline fill="none" stroke="#000000" points="2736.8911,-83.6791 2888.8716,-83.6791 "/>
<text text-anchor="start" x="2744.8911" y="-68.4791" font-family="Times,serif" font-size="14.00" fill="#000000">partitions </text>
</g>
<!-- TxnIdAndMarkerEntry&#45;&gt;TxnMarkerEntry -->
<g id="edge29" class="edge">
<title>TxnIdAndMarkerEntry:entry&#45;&gt;TxnMarkerEntry</title>
<path fill="none" stroke="#000000" d="M2656.0571,-127.6791C2678.9438,-127.6791 2703.7093,-127.6791 2726.652,-127.6791"/>
<polygon fill="#000000" stroke="#000000" points="2726.7056,-131.1792 2736.7056,-127.6791 2726.7056,-124.1792 2726.7056,-131.1792"/>
</g>
<!-- markersPerTxnTopicPartition -->
<g id="node22" class="node">
<title>markersPerTxnTopicPartition</title>
<polygon fill="#95e1d3" stroke="#000000" points="2104.4014,-138.6791 2104.4014,-182.6791 2375.4365,-182.6791 2375.4365,-138.6791 2104.4014,-138.6791"/>
<text text-anchor="middle" x="2239.9189" y="-167.4791" font-family="Times,serif" font-size="14.00" fill="#000000">markersPerTxnTopicPartition</text>
<polyline fill="none" stroke="#000000" points="2104.4014,-160.6791 2375.4365,-160.6791 "/>
<text text-anchor="middle" x="2239.9189" y="-145.4791" font-family="Times,serif" font-size="14.00" fill="#000000">[Int, BlockingQueue[TxnIdAndMarkerEntry]</text>
</g>
<!-- markersPerTxnTopicPartition&#45;&gt;TxnIdAndMarkerEntry -->
<g id="edge30" class="edge">
<title>markersPerTxnTopicPartition:txn&#45;&gt;TxnIdAndMarkerEntry</title>
<path fill="none" stroke="#000000" d="M2375.4365,-149.6791C2395.5952,-149.6791 2417.0482,-149.6791 2437.8012,-149.6791"/>
<polygon fill="#000000" stroke="#000000" points="2437.9241,-153.1792 2447.924,-149.6791 2437.924,-146.1792 2437.9241,-153.1792"/>
</g>
<!-- addTxnMarkersToSend -->
<g id="node23" class="node">
<title>addTxnMarkersToSend</title>
<polygon fill="none" stroke="#000000" points="1082.9624,-248.0792 1082.9624,-317.279 1252.1626,-317.279 1252.1626,-248.0792 1082.9624,-248.0792"/>
<text text-anchor="middle" x="1167.5625" y="-302.079" font-family="Times,serif" font-size="14.00" fill="#000000">addTxnMarkersToSend</text>
<polyline fill="none" stroke="#000000" points="1082.9624,-295.279 1252.1626,-295.279 "/>
<text text-anchor="start" x="1090.9624" y="-280.079" font-family="Times,serif" font-size="14.00" fill="#000000">将Marker请求放入队列中</text>
<text text-anchor="middle" x="1167.5625" y="-260.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> 由专门的线程处理</text>
</g>
<!-- addTxnMarkersToSend&#45;&gt;addTxnMarkersToBrokerQueue -->
<g id="edge20" class="edge">
<title>addTxnMarkersToSend&#45;&gt;addTxnMarkersToBrokerQueue</title>
<path fill="none" stroke="#000000" d="M1252.2819,-288.5295C1269.3726,-289.7097 1287.5598,-290.9657 1305.3328,-292.193"/>
<polygon fill="#000000" stroke="#000000" points="1305.5205,-295.7142 1315.7379,-292.9116 1306.0028,-288.7309 1305.5205,-295.7142"/>
</g>
<!-- tryCompleteElseWatch -->
<g id="node33" class="node">
<title>tryCompleteElseWatch</title>
<polygon fill="none" stroke="#000000" points="1486.245,-263.6791 1341.2296,-263.6791 1341.2296,-227.6791 1486.245,-227.6791 1486.245,-263.6791"/>
<text text-anchor="middle" x="1413.7373" y="-241.4791" font-family="Times,serif" font-size="14.00" fill="#000000">tryCompleteElseWatch</text>
</g>
<!-- addTxnMarkersToSend&#45;&gt;tryCompleteElseWatch -->
<g id="edge21" class="edge">
<title>addTxnMarkersToSend&#45;&gt;tryCompleteElseWatch</title>
<path fill="none" stroke="#000000" d="M1252.2819,-269.9458C1277.8207,-266.1073 1305.808,-261.9008 1331.2026,-258.084"/>
<polygon fill="#000000" stroke="#000000" points="1331.798,-261.5339 1341.1667,-256.5864 1330.7575,-254.6117 1331.798,-261.5339"/>
</g>
<!-- checkAndComplete -->
<g id="node28" class="node">
<title>checkAndComplete</title>
<polygon fill="none" stroke="#000000" points="1477.424,-151.6791 1350.0506,-151.6791 1350.0506,-115.6791 1477.424,-115.6791 1477.424,-151.6791"/>
<text text-anchor="middle" x="1413.7373" y="-129.4791" font-family="Times,serif" font-size="14.00" fill="#000000">checkAndComplete</text>
</g>
<!-- completeSendMarkersForTxnId&#45;&gt;checkAndComplete -->
<g id="edge14" class="edge">
<title>completeSendMarkersForTxnId&#45;&gt;checkAndComplete</title>
<path fill="none" stroke="#000000" d="M1265.5646,-131.8734C1290.3259,-132.1751 1316.5016,-132.4941 1339.85,-132.7787"/>
<polygon fill="#000000" stroke="#000000" points="1339.9741,-136.2803 1350.016,-132.9025 1340.0594,-129.2809 1339.9741,-136.2803"/>
</g>
<!-- generateRequests -->
<g id="node25" class="node">
<title>generateRequests</title>
<polygon fill="none" stroke="#000000" points="237.876,-118.0792 237.876,-187.279 375.0156,-187.279 375.0156,-118.0792 237.876,-118.0792"/>
<text text-anchor="middle" x="306.4458" y="-172.079" font-family="Times,serif" font-size="14.00" fill="#000000">generateRequests</text>
<polyline fill="none" stroke="#000000" points="237.876,-165.279 375.0156,-165.279 "/>
<text text-anchor="start" x="245.876" y="-150.079" font-family="Times,serif" font-size="14.00" fill="#000000">遍历marker队列</text>
<text text-anchor="start" x="245.876" y="-130.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> 生成WriteMark请求</text>
</g>
<!-- drainQueuedTransactionMarkers -->
<g id="node39" class="node">
<title>drainQueuedTransactionMarkers</title>
<polygon fill="none" stroke="#000000" points="611.3408,-170.6791 411.2402,-170.6791 411.2402,-134.6791 611.3408,-134.6791 611.3408,-170.6791"/>
<text text-anchor="middle" x="511.2905" y="-148.4791" font-family="Times,serif" font-size="14.00" fill="#000000">drainQueuedTransactionMarkers</text>
</g>
<!-- generateRequests&#45;&gt;drainQueuedTransactionMarkers -->
<g id="edge31" class="edge">
<title>generateRequests&#45;&gt;drainQueuedTransactionMarkers</title>
<path fill="none" stroke="#000000" d="M375.226,-152.6791C383.4964,-152.6791 392.0961,-152.6791 400.7738,-152.6791"/>
<polygon fill="#000000" stroke="#000000" points="400.9814,-156.1792 410.9814,-152.6791 400.9813,-149.1792 400.9814,-156.1792"/>
</g>
<!-- WriteTxnMarkersRequest -->
<g id="node26" class="node">
<title>WriteTxnMarkersRequest</title>
<polygon fill="none" stroke="#000000" points="757.1147,-46.0792 757.1147,-115.279 918.7339,-115.279 918.7339,-46.0792 757.1147,-46.0792"/>
<text text-anchor="middle" x="837.9243" y="-100.079" font-family="Times,serif" font-size="14.00" fill="#000000">WriteTxnMarkersRequest</text>
<polyline fill="none" stroke="#000000" points="757.1147,-93.279 918.7339,-93.279 "/>
<text text-anchor="start" x="765.1147" y="-78.079" font-family="Times,serif" font-size="14.00" fill="#000000">生成对broker的</text>
<text text-anchor="start" x="765.1147" y="-58.4791" font-family="Times,serif" font-size="14.00" fill="#000000"> WriteTxnMarkers请求</text>
</g>
<!-- appendCallback&#45;&gt;txnLogAppendRetryQueue -->
<g id="edge19" class="edge">
<title>appendCallback&#45;&gt;txnLogAppendRetryQueue</title>
<path fill="none" stroke="#000000" d="M2692.7755,-256.9678C2701.4139,-256.3717 2709.9916,-255.7797 2718.3557,-255.2025"/>
<polygon fill="#000000" stroke="#000000" points="2718.7067,-258.6867 2728.4419,-254.5064 2718.2247,-251.7033 2718.7067,-258.6867"/>
</g>
<!-- appendToLogCallback -->
<g id="node29" class="node">
<title>appendToLogCallback</title>
<polygon fill="none" stroke="#000000" points="1759.7489,-162.6791 1616.1232,-162.6791 1616.1232,-126.6791 1759.7489,-126.6791 1759.7489,-162.6791"/>
<text text-anchor="middle" x="1687.936" y="-140.4791" font-family="Times,serif" font-size="14.00" fill="#000000">appendToLogCallback</text>
</g>
<!-- checkAndComplete&#45;&gt;appendToLogCallback -->
<g id="edge15" class="edge">
<title>checkAndComplete&#45;&gt;appendToLogCallback</title>
<path fill="none" stroke="#000000" d="M1477.3332,-136.2304C1515.6257,-137.7665 1564.7796,-139.7384 1605.9679,-141.3908"/>
<polygon fill="#000000" stroke="#000000" points="1605.8508,-144.8888 1615.9831,-141.7926 1606.1315,-137.8944 1605.8508,-144.8888"/>
</g>
<!-- tryAppendToLog -->
<g id="node30" class="node">
<title>tryAppendToLog</title>
<polygon fill="none" stroke="#000000" points="2018.3223,-163.6791 1905.3184,-163.6791 1905.3184,-127.6791 2018.3223,-127.6791 2018.3223,-163.6791"/>
<text text-anchor="middle" x="1961.8203" y="-141.4791" font-family="Times,serif" font-size="14.00" fill="#000000">tryAppendToLog</text>
</g>
<!-- appendToLogCallback&#45;&gt;tryAppendToLog -->
<g id="edge16" class="edge">
<title>appendToLogCallback&#45;&gt;tryAppendToLog</title>
<path fill="none" stroke="#000000" d="M1759.8959,-144.9418C1801.6829,-145.0944 1853.979,-145.2853 1894.8797,-145.4347"/>
<polygon fill="#000000" stroke="#000000" points="1895.0066,-148.9351 1905.0194,-145.4717 1895.0322,-141.9351 1895.0066,-148.9351"/>
</g>
<!-- tryAppendToLog&#45;&gt;appendTransactionToLog -->
<g id="edge17" class="edge">
<title>tryAppendToLog&#45;&gt;appendTransactionToLog</title>
<path fill="none" stroke="#000000" d="M2018.3641,-150.4897C2036.6484,-154.795 2055.5088,-162.617 2068.4014,-176.6791 2123.83,-237.1354 2056.3974,-291.174 2104.4014,-357.6791 2116.5145,-374.4607 2133.4862,-388.0879 2151.332,-398.9476"/>
<polygon fill="#000000" stroke="#000000" points="2149.7388,-402.0696 2160.1454,-404.0581 2153.2502,-396.014 2149.7388,-402.0696"/>
</g>
<!-- cancelForKey -->
<g id="node38" class="node">
<title>cancelForKey</title>
<polygon fill="none" stroke="#000000" points="1460.7561,-209.6791 1366.7185,-209.6791 1366.7185,-173.6791 1460.7561,-173.6791 1460.7561,-209.6791"/>
<text text-anchor="middle" x="1413.7373" y="-187.4791" font-family="Times,serif" font-size="14.00" fill="#000000">cancelForKey</text>
</g>
<!-- removeMarkersForTxnId&#45;&gt;cancelForKey -->
<g id="edge28" class="edge">
<title>removeMarkersForTxnId&#45;&gt;cancelForKey</title>
<path fill="none" stroke="#000000" d="M1246.8088,-205.2409C1282.448,-202.3454 1323.7278,-198.9917 1356.3208,-196.3438"/>
<polygon fill="#000000" stroke="#000000" points="1356.8958,-199.8087 1366.5795,-195.5103 1356.3289,-192.8317 1356.8958,-199.8087"/>
</g>
<!-- addMarkersForBroker -->
<g id="node35" class="node">
<title>addMarkersForBroker</title>
<polygon fill="none" stroke="#000000" points="1758.6227,-263.6791 1617.2494,-263.6791 1617.2494,-227.6791 1758.6227,-227.6791 1758.6227,-263.6791"/>
<text text-anchor="middle" x="1687.936" y="-241.4791" font-family="Times,serif" font-size="14.00" fill="#000000">addMarkersForBroker</text>
</g>
<!-- addTxnMarkersToBrokerQueue&#45;&gt;addMarkersForBroker -->
<g id="edge24" class="edge">
<title>addTxnMarkersToBrokerQueue&#45;&gt;addMarkersForBroker</title>
<path fill="none" stroke="#000000" d="M1505.4227,-281.6228C1538.2957,-275.1489 1575.0957,-267.9016 1606.9929,-261.6198"/>
<polygon fill="#000000" stroke="#000000" points="1608.0305,-264.9828 1617.1657,-259.6164 1606.6778,-258.1147 1608.0305,-264.9828"/>
</g>
<!-- markersQueueForUnknownBroker -->
<g id="node36" class="node">
<title>markersQueueForUnknownBroker</title>
<polygon fill="none" stroke="#000000" points="1793.609,-317.6791 1582.2631,-317.6791 1582.2631,-281.6791 1793.609,-281.6791 1793.609,-317.6791"/>
<text text-anchor="middle" x="1687.936" y="-295.4791" font-family="Times,serif" font-size="14.00" fill="#000000">markersQueueForUnknownBroker</text>
</g>
<!-- addTxnMarkersToBrokerQueue&#45;&gt;markersQueueForUnknownBroker -->
<g id="edge25" class="edge">
<title>addTxnMarkersToBrokerQueue&#45;&gt;markersQueueForUnknownBroker</title>
<path fill="none" stroke="#000000" d="M1511.5681,-299.6791C1531.1722,-299.6791 1551.9463,-299.6791 1572.0928,-299.6791"/>
<polygon fill="#000000" stroke="#000000" points="1572.2416,-303.1792 1582.2416,-299.6791 1572.2415,-296.1792 1572.2416,-303.1792"/>
</g>
<!-- DelayedTxnMarker -->
<g id="node34" class="node">
<title>DelayedTxnMarker</title>
<polygon fill="none" stroke="#000000" points="2025.2145,-221.6791 1898.4261,-221.6791 1898.4261,-185.6791 2025.2145,-185.6791 2025.2145,-221.6791"/>
<text text-anchor="middle" x="1961.8203" y="-199.4791" font-family="Times,serif" font-size="14.00" fill="#000000">DelayedTxnMarker</text>
</g>
<!-- tryCompleteElseWatch&#45;&gt;DelayedTxnMarker -->
<g id="edge22" class="edge">
<title>tryCompleteElseWatch&#45;&gt;DelayedTxnMarker</title>
<path fill="none" stroke="#000000" d="M1486.4804,-229.7559C1508.8748,-225.4428 1533.676,-221.2581 1556.6328,-218.6791 1672.0173,-205.7163 1806.9249,-203.2306 1888.2962,-203.1023"/>
<polygon fill="#000000" stroke="#000000" points="1888.4388,-206.6024 1898.4373,-203.0982 1888.4359,-199.6024 1888.4388,-206.6024"/>
</g>
<!-- DelayedTxnMarker&#45;&gt;appendTransactionToLog -->
<g id="edge23" class="edge">
<title>DelayedTxnMarker&#45;&gt;appendTransactionToLog</title>
<path fill="none" stroke="#000000" d="M2025.1054,-208.516C2040.9262,-212.5129 2056.7001,-219.3022 2068.4014,-230.6791 2110.4651,-271.5767 2068.1923,-311.5176 2104.4014,-357.6791 2116.9597,-373.6892 2133.8327,-386.9373 2151.4021,-397.6648"/>
<polygon fill="#000000" stroke="#000000" points="2149.6676,-400.705 2160.0672,-402.7296 2153.2,-394.6616 2149.6676,-400.705"/>
</g>
<!-- addMarkers -->
<g id="node37" class="node">
<title>addMarkers</title>
<polygon fill="none" stroke="#000000" points="2003.1827,-275.6791 1920.4579,-275.6791 1920.4579,-239.6791 2003.1827,-239.6791 2003.1827,-275.6791"/>
<text text-anchor="middle" x="1961.8203" y="-253.4791" font-family="Times,serif" font-size="14.00" fill="#000000">addMarkers</text>
</g>
<!-- addMarkersForBroker&#45;&gt;addMarkers -->
<g id="edge26" class="edge">
<title>addMarkersForBroker&#45;&gt;addMarkers</title>
<path fill="none" stroke="#000000" d="M1758.8242,-248.785C1806.1194,-250.8572 1867.2369,-253.535 1910.0009,-255.4087"/>
<polygon fill="#000000" stroke="#000000" points="1910.0429,-258.9138 1920.1865,-255.8549 1910.3494,-251.9205 1910.0429,-258.9138"/>
</g>
<!-- addMarkers&#45;&gt;markersPerTxnTopicPartition -->
<g id="edge27" class="edge">
<title>addMarkers&#45;&gt;markersPerTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M2003.2001,-248.6153C2023.101,-243.8971 2047.1865,-237.6577 2068.4014,-230.6791 2106.7743,-218.0564 2148.7808,-200.9695 2181.6184,-186.8376"/>
<polygon fill="#000000" stroke="#000000" points="2183.2779,-189.933 2191.0625,-182.7461 2180.4952,-183.5099 2183.2779,-189.933"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;TransactionMarkerRequestCompletionHandler -->
<g id="edge34" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;TransactionMarkerRequestCompletionHandler</title>
<path fill="none" stroke="#000000" d="M517.9437,-170.7447C533.3308,-210.158 575.0652,-304.5767 639.5654,-357.6791 641.9009,-359.6019 644.2904,-361.4795 646.7281,-363.3128"/>
<polygon fill="#000000" stroke="#000000" points="645.0254,-366.3985 655.193,-369.3769 649.102,-360.708 645.0254,-366.3985"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;retryLogAppends -->
<g id="edge35" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;retryLogAppends</title>
<path fill="none" stroke="#000000" d="M611.4211,-146.3188C620.9331,-145.7494 630.4315,-145.1941 639.5654,-144.6791 683.6312,-142.1943 1001.6756,-152.0702 1036.2832,-124.6791 1061.3193,-104.8636 1030.7561,-74.8578 1056.2832,-55.6791 1221.2818,68.2853 1314.2637,-53.8082 1520.6328,-55.6791 1652.9506,-56.8786 1807.5631,-60.1014 1894.1474,-62.0712"/>
<polygon fill="#000000" stroke="#000000" points="1894.2857,-65.5751 1904.3632,-62.3049 1894.4459,-58.577 1894.2857,-65.5751"/>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;WriteTxnMarkersRequest -->
<g id="edge36" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;WriteTxnMarkersRequest</title>
<path fill="none" stroke="#000000" d="M593.2924,-134.6034C640.1431,-124.2761 698.9801,-111.3066 747.2105,-100.6752"/>
<polygon fill="#000000" stroke="#000000" points="748.0082,-104.0834 757.0203,-98.5128 746.5013,-97.2475 748.0082,-104.0834"/>
</g>
<!-- forEachTxnTopicPartition -->
<g id="node40" class="node">
<title>forEachTxnTopicPartition</title>
<polygon fill="none" stroke="#000000" points="919.1784,-189.6791 756.6702,-189.6791 756.6702,-153.6791 919.1784,-153.6791 919.1784,-189.6791"/>
<text text-anchor="middle" x="837.9243" y="-167.4791" font-family="Times,serif" font-size="14.00" fill="#000000">forEachTxnTopicPartition</text>
</g>
<!-- drainQueuedTransactionMarkers&#45;&gt;forEachTxnTopicPartition -->
<g id="edge32" class="edge">
<title>drainQueuedTransactionMarkers&#45;&gt;forEachTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M611.5112,-158.5088C654.4761,-161.0081 704.3257,-163.9078 746.2952,-166.3491"/>
<polygon fill="#000000" stroke="#000000" points="746.3212,-169.8564 756.5077,-166.9431 746.7278,-162.8682 746.3212,-169.8564"/>
</g>
<!-- forEachTxnTopicPartition&#45;&gt;markersPerTxnTopicPartition -->
<g id="edge33" class="edge">
<title>forEachTxnTopicPartition&#45;&gt;markersPerTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M919.5511,-177.3277C959.0187,-175.7572 1004.5846,-167.0173 1036.2832,-139.6791 1058.5296,-120.4929 1032.5752,-94.0267 1056.2832,-76.6791 1093.2571,-49.6245 1592.26,-48.4795 2068.4014,-118.6791 2096.3588,-122.801 2126.4207,-129.4 2153.4468,-136.1578"/>
<polygon fill="#000000" stroke="#000000" points="2152.7029,-139.5799 2163.2569,-138.6504 2154.4268,-132.7955 2152.7029,-139.5799"/>
</g>
<!-- doWork -->
<g id="node41" class="node">
<title>doWork</title>
<polygon fill="none" stroke="#000000" points="16,-127.8791 16,-177.479 196.876,-177.479 196.876,-127.8791 16,-127.8791"/>
<text text-anchor="middle" x="106.438" y="-162.279" font-family="Times,serif" font-size="14.00" fill="#000000">doWork</text>
<polyline fill="none" stroke="#000000" points="16,-155.479 196.876,-155.479 "/>
<text text-anchor="middle" x="106.438" y="-140.279" font-family="Times,serif" font-size="14.00" fill="#000000">Broker之间发送请求的线程</text>
</g>
<!-- doWork&#45;&gt;generateRequests -->
<g id="edge37" class="edge">
<title>doWork&#45;&gt;generateRequests</title>
<path fill="none" stroke="#000000" d="M197.0787,-152.6791C207.2046,-152.6791 217.4597,-152.6791 227.4238,-152.6791"/>
<polygon fill="#000000" stroke="#000000" points="227.6845,-156.1792 237.6844,-152.6791 227.6844,-149.1792 227.6845,-156.1792"/>
</g>
<!-- handleEndTransaction -->
<g id="node42" class="node">
<title>handleEndTransaction</title>
<polygon fill="none" stroke="#000000" points="908.8919,-585.6791 766.9567,-585.6791 766.9567,-549.6791 908.8919,-549.6791 908.8919,-585.6791"/>
<text text-anchor="middle" x="837.9243" y="-563.4791" font-family="Times,serif" font-size="14.00" fill="#000000">handleEndTransaction</text>
</g>
<!-- handleEndTransaction&#45;&gt;prepareAbortOrCommit -->
<g id="edge38" class="edge">
<title>handleEndTransaction&#45;&gt;prepareAbortOrCommit</title>
<path fill="none" stroke="#000000" d="M855.145,-585.8072C889.9136,-621.41 972.3584,-700.8901 1056.2832,-745.6791 1059.5969,-747.4476 1063.0164,-749.1385 1066.5086,-750.7538"/>
<polygon fill="#000000" stroke="#000000" points="1065.3354,-754.0606 1075.9004,-754.8545 1068.1364,-747.6454 1065.3354,-754.0606"/>
</g>
<!-- handleEndTransaction&#45;&gt;appendTransactionToLog -->
<g id="edge39" class="edge">
<title>handleEndTransaction&#45;&gt;appendTransactionToLog</title>
<path fill="none" stroke="#000000" d="M908.8796,-575.5465C951.0961,-576.1612 1002.7869,-569.1691 1036.2832,-537.6791 1067.0867,-508.7205 1024.87,-472.9751 1056.2832,-444.6791 1182.5727,-330.9217 1649.5,-381.8265 1819.2393,-390.6791 1933.7511,-396.6513 2065.0849,-411.7086 2150.1132,-422.5456"/>
<polygon fill="#000000" stroke="#000000" points="2149.8847,-426.0449 2160.2487,-423.8454 2150.7752,-419.1018 2149.8847,-426.0449"/>
</g>
<!-- handleEndTransaction&#45;&gt;getTransactionState -->
<g id="edge40" class="edge">
<title>handleEndTransaction&#45;&gt;getTransactionState</title>
<path fill="none" stroke="#000000" d="M908.7059,-561.7022C947.019,-557.2926 994.8525,-549.873 1036.2832,-537.6791 1061.6703,-530.2071 1088.5204,-518.8196 1111.2781,-508.0352"/>
<polygon fill="#000000" stroke="#000000" points="1112.9464,-511.1165 1120.437,-503.6237 1109.9088,-504.8099 1112.9464,-511.1165"/>
</g>
<!-- handleEndTransaction&#45;&gt;addTxnMarkersToSend -->
<g id="edge41" class="edge">
<title>handleEndTransaction&#45;&gt;addTxnMarkersToSend</title>
<path fill="none" stroke="#000000" d="M908.9723,-576.5977C951.7696,-577.7455 1004.0501,-570.9477 1036.2832,-537.6791 1062.4447,-510.6771 1037.8353,-402.4389 1056.2832,-369.6791 1066.3654,-351.7752 1081.7686,-336.2713 1097.9297,-323.5142"/>
<polygon fill="#000000" stroke="#000000" points="1100.0462,-326.3019 1105.9042,-317.4739 1095.8195,-320.7219 1100.0462,-326.3019"/>
</g>
<!-- handleEndTxnRequest -->
<g id="node43" class="node">
<title>handleEndTxnRequest</title>
<polygon fill="none" stroke="#000000" points="582.8157,-585.6791 439.7653,-585.6791 439.7653,-549.6791 582.8157,-549.6791 582.8157,-585.6791"/>
<text text-anchor="middle" x="511.2905" y="-563.4791" font-family="Times,serif" font-size="14.00" fill="#000000">handleEndTxnRequest</text>
</g>
<!-- handleEndTxnRequest&#45;&gt;handleEndTransaction -->
<g id="edge42" class="edge">
<title>handleEndTxnRequest&#45;&gt;handleEndTransaction</title>
<path fill="none" stroke="#000000" d="M582.9717,-567.6791C634.3107,-567.6791 703.5119,-567.6791 756.8637,-567.6791"/>
<polygon fill="#000000" stroke="#000000" points="756.9726,-571.1792 766.9726,-567.6791 756.9726,-564.1792 756.9726,-571.1792"/>
</g>
</g>
</svg>
