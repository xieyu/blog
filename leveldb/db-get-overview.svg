<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: db_get_overview Pages: 1 -->
<svg width="1101pt" height="645pt"
 viewBox="0.00 0.00 1101.44 644.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 640.5)">
<title>db_get_overview</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-640.5 1097.4395,-640.5 1097.4395,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_Memory</title>
<path fill="none" stroke="#000000" d="M214.25,-304.5C214.25,-304.5 910.0547,-304.5 910.0547,-304.5 916.0547,-304.5 922.0547,-310.5 922.0547,-316.5 922.0547,-316.5 922.0547,-616.5 922.0547,-616.5 922.0547,-622.5 916.0547,-628.5 910.0547,-628.5 910.0547,-628.5 214.25,-628.5 214.25,-628.5 208.25,-628.5 202.25,-622.5 202.25,-616.5 202.25,-616.5 202.25,-316.5 202.25,-316.5 202.25,-310.5 208.25,-304.5 214.25,-304.5"/>
<text text-anchor="middle" x="562.1523" y="-608.5" font-family="Times,serif" font-size="20.00" fill="#000000">Memory</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Version</title>
<path fill="none" stroke="#000000" d="M222.25,-458.5C222.25,-458.5 882.8306,-458.5 882.8306,-458.5 888.8306,-458.5 894.8306,-464.5 894.8306,-470.5 894.8306,-470.5 894.8306,-580.5 894.8306,-580.5 894.8306,-586.5 888.8306,-592.5 882.8306,-592.5 882.8306,-592.5 222.25,-592.5 222.25,-592.5 216.25,-592.5 210.25,-586.5 210.25,-580.5 210.25,-580.5 210.25,-470.5 210.25,-470.5 210.25,-464.5 216.25,-458.5 222.25,-458.5"/>
<text text-anchor="middle" x="552.5403" y="-572.5" font-family="Times,serif" font-size="20.00" fill="#000000">Version</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Disk</title>
<path fill="none" stroke="#000000" d="M507.5093,-162.5C507.5093,-162.5 1073.4395,-162.5 1073.4395,-162.5 1079.4395,-162.5 1085.4395,-168.5 1085.4395,-174.5 1085.4395,-174.5 1085.4395,-284.5 1085.4395,-284.5 1085.4395,-290.5 1079.4395,-296.5 1073.4395,-296.5 1073.4395,-296.5 507.5093,-296.5 507.5093,-296.5 501.5093,-296.5 495.5093,-290.5 495.5093,-284.5 495.5093,-284.5 495.5093,-174.5 495.5093,-174.5 495.5093,-168.5 501.5093,-162.5 507.5093,-162.5"/>
<text text-anchor="middle" x="790.4744" y="-276.5" font-family="Times,serif" font-size="20.00" fill="#000000">Disk</text>
</g>
<!-- MemTable -->
<g id="node1" class="node">
<title>MemTable</title>
<polygon fill="none" stroke="#000000" points="218.3525,-380.9001 218.3525,-450.0999 396.2959,-450.0999 396.2959,-380.9001 218.3525,-380.9001"/>
<text text-anchor="middle" x="307.3242" y="-434.8999" font-family="Times,serif" font-size="14.00" fill="#000000">MemTable</text>
<polyline fill="none" stroke="#000000" points="218.3525,-428.0999 396.2959,-428.0999 "/>
<text text-anchor="start" x="226.3525" y="-412.8999" font-family="Times,serif" font-size="14.00" fill="#000000">先从memtable中找</text>
<text text-anchor="start" x="226.3525" y="-393.3" font-family="Times,serif" font-size="14.00" fill="#000000"> MemTable中数据为最新的</text>
</g>
<!-- ImmTable -->
<g id="node2" class="node">
<title>ImmTable</title>
<polygon fill="none" stroke="#000000" points="230.5,-312.7 230.5,-362.3 384.1484,-362.3 384.1484,-312.7 230.5,-312.7"/>
<text text-anchor="middle" x="307.3242" y="-347.1" font-family="Times,serif" font-size="14.00" fill="#000000">ImmTable</text>
<polyline fill="none" stroke="#000000" points="230.5,-340.3 384.1484,-340.3 "/>
<text text-anchor="start" x="238.5" y="-325.1" font-family="Times,serif" font-size="14.00" fill="#000000">然后从Immtable中查找</text>
</g>
<!-- LRUCache -->
<g id="node3" class="node">
<title>LRUCache</title>
<polygon fill="none" stroke="#000000" points="550.7695,-313.5 550.7695,-401.5 629.749,-401.5 629.749,-313.5 550.7695,-313.5"/>
<text text-anchor="middle" x="590.2593" y="-386.3" font-family="Times,serif" font-size="14.00" fill="#000000">LRUCache</text>
<polyline fill="none" stroke="#000000" points="550.7695,-379.5 629.749,-379.5 "/>
<text text-anchor="middle" x="590.2593" y="-364.3" font-family="Times,serif" font-size="14.00" fill="#000000">cache1</text>
<polyline fill="none" stroke="#000000" points="550.7695,-357.5 629.749,-357.5 "/>
<text text-anchor="middle" x="590.2593" y="-342.3" font-family="Times,serif" font-size="14.00" fill="#000000">...</text>
<polyline fill="none" stroke="#000000" points="550.7695,-335.5 629.749,-335.5 "/>
<text text-anchor="middle" x="590.2593" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">cacheN</text>
</g>
<!-- Cache -->
<g id="node4" class="node">
<title>Cache</title>
<polygon fill="none" stroke="#000000" points="766.6338,-312.9001 766.6338,-426.0999 914.0547,-426.0999 914.0547,-312.9001 766.6338,-312.9001"/>
<text text-anchor="middle" x="840.3442" y="-410.8999" font-family="Times,serif" font-size="14.00" fill="#000000">cache</text>
<polyline fill="none" stroke="#000000" points="766.6338,-404.0999 914.0547,-404.0999 "/>
<text text-anchor="start" x="774.6338" y="-388.8999" font-family="Times,serif" font-size="14.00" fill="#000000">将sstable的BlockIndex</text>
<text text-anchor="middle" x="840.3442" y="-369.3" font-family="Times,serif" font-size="14.00" fill="#000000">和filter加载到内存中</text>
<polyline fill="none" stroke="#000000" points="766.6338,-356.9001 914.0547,-356.9001 "/>
<text text-anchor="middle" x="840.3442" y="-341.7001" font-family="Times,serif" font-size="14.00" fill="#000000">BlockIndex</text>
<polyline fill="none" stroke="#000000" points="766.6338,-334.9001 914.0547,-334.9001 "/>
<text text-anchor="middle" x="840.3442" y="-319.7001" font-family="Times,serif" font-size="14.00" fill="#000000">BloomFilterBlock</text>
</g>
<!-- LRUCache&#45;&gt;Cache -->
<g id="edge7" class="edge">
<title>LRUCache:cache&#45;&gt;Cache</title>
<path fill="none" stroke="#000000" d="M629.2593,-368.5C671.1422,-368.5 717.6991,-368.6993 756.4094,-368.92"/>
<polygon fill="#000000" stroke="#000000" points="756.5698,-372.4209 766.5901,-368.9795 756.6108,-365.421 756.5698,-372.4209"/>
</g>
<!-- files_ -->
<g id="node5" class="node">
<title>files_</title>
<polygon fill="#95e1d3" stroke="#000000" points="218.25,-475.5 218.25,-533.5 396.3984,-533.5 396.3984,-475.5 218.25,-475.5"/>
<text text-anchor="middle" x="307.3242" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">files_</text>
<polyline fill="none" stroke="#000000" points="218.25,-511.5 396.3984,-511.5 "/>
<text text-anchor="start" x="226.25" y="-496.3" font-family="Times,serif" font-size="14.00" fill="#000000">std::Vector&lt;FileMetaData*&gt;</text>
<text text-anchor="middle" x="307.3242" y="-482.3" font-family="Times,serif" font-size="14.00" fill="#000000"> files_[config::kNumLevels];</text>
</g>
<!-- levels -->
<g id="node6" class="node">
<title>levels</title>
<polygon fill="none" stroke="#000000" points="472.8262,-467.5 472.8262,-555.5 707.6924,-555.5 707.6924,-467.5 472.8262,-467.5"/>
<text text-anchor="middle" x="590.2593" y="-540.3" font-family="Times,serif" font-size="14.00" fill="#000000">levels</text>
<polyline fill="none" stroke="#000000" points="472.8262,-533.5 707.6924,-533.5 "/>
<text text-anchor="start" x="480.8262" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#000000">level0: [FileMetaData .. FileMetaData]</text>
<polyline fill="none" stroke="#000000" points="472.8262,-511.5 707.6924,-511.5 "/>
<text text-anchor="start" x="480.8262" y="-496.3" font-family="Times,serif" font-size="14.00" fill="#000000">level1: [FileMetaData .. FileMetaData]</text>
<polyline fill="none" stroke="#000000" points="472.8262,-489.5 707.6924,-489.5 "/>
<text text-anchor="start" x="480.8262" y="-474.3" font-family="Times,serif" font-size="14.00" fill="#000000">... levelN</text>
</g>
<!-- files_&#45;&gt;levels -->
<g id="edge1" class="edge">
<title>files_&#45;&gt;levels</title>
<path fill="none" stroke="#000000" d="M396.4583,-506.7052C417.4581,-507.2248 440.2489,-507.7886 462.5773,-508.3411"/>
<polygon fill="#000000" stroke="#000000" points="462.7121,-511.8454 472.7957,-508.5939 462.8853,-504.8475 462.7121,-511.8454"/>
</g>
<!-- FileMetaData -->
<g id="node7" class="node">
<title>FileMetaData</title>
<polygon fill="none" stroke="#000000" points="886.8169,-529.5 793.8716,-529.5 793.8716,-493.5 886.8169,-493.5 886.8169,-529.5"/>
<text text-anchor="middle" x="840.3442" y="-507.3" font-family="Times,serif" font-size="14.00" fill="#000000">FileMetaData</text>
</g>
<!-- levels&#45;&gt;FileMetaData -->
<g id="edge2" class="edge">
<title>levels&#45;&gt;FileMetaData</title>
<path fill="none" stroke="#000000" d="M707.9788,-511.5C734.3458,-511.5 761.1484,-511.5 783.6758,-511.5"/>
<polygon fill="#000000" stroke="#000000" points="783.7084,-515.0001 793.7084,-511.5 783.7084,-508.0001 783.7084,-515.0001"/>
</g>
<!-- Level0SSTable -->
<g id="node8" class="node">
<title>Level0SSTable</title>
<polygon fill="none" stroke="#000000" points="503.5093,-171.1001 503.5093,-259.8999 677.0093,-259.8999 677.0093,-171.1001 503.5093,-171.1001"/>
<text text-anchor="middle" x="590.2593" y="-244.6999" font-family="Times,serif" font-size="14.00" fill="#000000">Level0SSTable</text>
<polyline fill="none" stroke="#000000" points="503.5093,-237.8999 677.0093,-237.8999 "/>
<text text-anchor="start" x="511.5093" y="-222.6999" font-family="Times,serif" font-size="14.00" fill="#000000">第0层的sstable文件之间</text>
<text text-anchor="start" x="511.5093" y="-203.1" font-family="Times,serif" font-size="14.00" fill="#000000"> key range有重叠部分</text>
<text text-anchor="start" x="511.5093" y="-183.5" font-family="Times,serif" font-size="14.00" fill="#000000"> 所以每个文件要查找一下</text>
</g>
<!-- Level1SSTable -->
<g id="node9" class="node">
<title>Level1SSTable</title>
<polygon fill="none" stroke="#000000" points="743.6924,-170.7 743.6924,-220.3 936.9961,-220.3 936.9961,-170.7 743.6924,-170.7"/>
<text text-anchor="middle" x="840.3442" y="-205.1" font-family="Times,serif" font-size="14.00" fill="#000000">Level1SSTable</text>
<polyline fill="none" stroke="#000000" points="743.6924,-198.3 936.9961,-198.3 "/>
<text text-anchor="start" x="751.6924" y="-183.1" font-family="Times,serif" font-size="14.00" fill="#000000">每个文件之间keyrange无重叠</text>
</g>
<!-- Level0SSTable&#45;&gt;Level1SSTable -->
<g id="edge12" class="edge">
<title>Level0SSTable&#45;&gt;Level1SSTable</title>
<path fill="none" stroke="#000000" d="M677.025,-208.5611C695.2017,-207.1075 714.5726,-205.5583 733.3856,-204.0538"/>
<polygon fill="#000000" stroke="#000000" points="733.7756,-207.5339 743.4647,-203.2477 733.2175,-200.5561 733.7756,-207.5339"/>
</g>
<!-- LevelNSSTable -->
<g id="node10" class="node">
<title>LevelNSSTable</title>
<polygon fill="none" stroke="#000000" points="972.9961,-172.5 972.9961,-216.5 1077.4395,-216.5 1077.4395,-172.5 972.9961,-172.5"/>
<text text-anchor="middle" x="1025.2178" y="-201.3" font-family="Times,serif" font-size="14.00" fill="#000000">LevelNSSTable</text>
<polyline fill="none" stroke="#000000" points="972.9961,-194.5 1077.4395,-194.5 "/>
<text text-anchor="middle" x="1025.2178" y="-179.3" font-family="Times,serif" font-size="14.00" fill="#000000">...</text>
</g>
<!-- Level1SSTable&#45;&gt;LevelNSSTable -->
<g id="edge13" class="edge">
<title>Level1SSTable&#45;&gt;LevelNSSTable</title>
<path fill="none" stroke="#000000" d="M937.1126,-194.9766C945.7125,-194.9301 954.2622,-194.8838 962.4633,-194.8394"/>
<polygon fill="#000000" stroke="#000000" points="962.6614,-198.3385 972.6423,-194.7844 962.6235,-191.3386 962.6614,-198.3385"/>
</g>
<!-- FindInFile -->
<g id="node11" class="node">
<title>FindInFile</title>
<polygon fill="none" stroke="#000000" points="177.8223,-129.7003 177.8223,-293.2997 436.8262,-293.2997 436.8262,-129.7003 177.8223,-129.7003"/>
<text text-anchor="middle" x="307.3242" y="-278.0997" font-family="Times,serif" font-size="14.00" fill="#000000">FindInFile</text>
<polyline fill="none" stroke="#000000" points="177.8223,-271.2997 436.8262,-271.2997 "/>
<text text-anchor="start" x="185.8223" y="-256.0997" font-family="Times,serif" font-size="14.00" fill="#000000">查找过程中会使用LRU cache将</text>
<text text-anchor="start" x="185.8223" y="-236.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> sstable文件的index和filter加载到cache中</text>
<polyline fill="none" stroke="#000000" points="177.8223,-224.0999 436.8262,-224.0999 "/>
<text text-anchor="start" x="185.8223" y="-208.8999" font-family="Times,serif" font-size="14.00" fill="#000000">每个文件先通过bloom filter</text>
<text text-anchor="start" x="185.8223" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 判断key是否不存在</text>
<text text-anchor="start" x="185.8223" y="-169.7001" font-family="Times,serif" font-size="14.00" fill="#000000"> 然后通过blockindex找到对应block</text>
<polyline fill="none" stroke="#000000" points="177.8223,-157.3002 436.8262,-157.3002 "/>
<text text-anchor="start" x="185.8223" y="-142.1002" font-family="Times,serif" font-size="14.00" fill="#000000">一层层查找，level越高，数据越旧</text>
</g>
<!-- FindInFile&#45;&gt;LRUCache -->
<g id="edge3" class="edge">
<title>FindInFile&#45;&gt;LRUCache</title>
<path fill="none" stroke="#000000" d="M437.152,-281.9727C449.1786,-288.3022 461.2072,-294.5593 472.8262,-300.5 495.2367,-311.9583 520.3053,-324.203 541.5074,-334.395"/>
<polygon fill="#000000" stroke="#000000" points="540.1145,-337.6086 550.6449,-338.7757 543.1407,-331.2965 540.1145,-337.6086"/>
</g>
<!-- FindInFile&#45;&gt;Level0SSTable -->
<g id="edge4" class="edge">
<title>FindInFile&#45;&gt;Level0SSTable</title>
<path fill="none" stroke="#000000" d="M437.1986,-213.3361C455.9874,-213.6017 475.0507,-213.8712 493.051,-214.1257"/>
<polygon fill="#000000" stroke="#000000" points="493.1751,-217.6277 503.2236,-214.2695 493.2741,-210.6284 493.1751,-217.6277"/>
</g>
<!-- FindInFile&#45;&gt;Level1SSTable -->
<g id="edge5" class="edge">
<title>FindInFile&#45;&gt;Level1SSTable</title>
<path fill="none" stroke="#000000" d="M437.0557,-168.4222C449.0478,-165.6216 461.0974,-163.233 472.8262,-161.5 576.09,-146.242 604.1278,-148.4388 707.6924,-161.5 720.4738,-163.112 733.7877,-165.5648 746.836,-168.4304"/>
<polygon fill="#000000" stroke="#000000" points="746.2208,-171.88 756.7491,-170.6951 747.7798,-165.0558 746.2208,-171.88"/>
</g>
<!-- FindInFile&#45;&gt;LevelNSSTable -->
<g id="edge6" class="edge">
<title>FindInFile&#45;&gt;LevelNSSTable</title>
<path fill="none" stroke="#000000" d="M436.9752,-155.3937C448.9313,-151.8054 460.9972,-148.7396 472.8262,-146.5 675.6287,-108.1028 735.1957,-118.1431 936.9961,-161.5 945.9193,-163.4172 955.145,-166.0669 964.1172,-169.0387"/>
<polygon fill="#000000" stroke="#000000" points="963.1323,-172.4016 973.7271,-172.3704 965.4253,-165.7878 963.1323,-172.4016"/>
</g>
<!-- KV -->
<g id="node12" class="node">
<title>KV</title>
<polygon fill="none" stroke="#000000" points="0,-315.5 0,-359.5 141.8223,-359.5 141.8223,-315.5 0,-315.5"/>
<text text-anchor="middle" x="70.9111" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#000000">Get(key, snapshot)</text>
<polyline fill="none" stroke="#000000" points="0,-337.5 141.8223,-337.5 "/>
<text text-anchor="start" x="8" y="-322.3" font-family="Times,serif" font-size="14.00" fill="#000000">key, SequenceNumber</text>
</g>
<!-- KV&#45;&gt;MemTable -->
<g id="edge8" class="edge">
<title>KV&#45;&gt;MemTable</title>
<path fill="none" stroke="#000000" d="M137.7097,-359.5389C159.6712,-366.7847 184.573,-375.0006 208.4005,-382.862"/>
<polygon fill="#000000" stroke="#000000" points="207.5844,-386.2783 218.1775,-386.0877 209.7777,-379.6307 207.5844,-386.2783"/>
</g>
<!-- KV&#45;&gt;ImmTable -->
<g id="edge9" class="edge">
<title>KV&#45;&gt;ImmTable</title>
<path fill="none" stroke="#000000" d="M141.8429,-337.5C166.4574,-337.5 194.3464,-337.5 220.1195,-337.5"/>
<polygon fill="#000000" stroke="#000000" points="220.2588,-341.0001 230.2587,-337.5 220.2587,-334.0001 220.2588,-341.0001"/>
</g>
<!-- KV&#45;&gt;files_ -->
<g id="edge11" class="edge">
<title>KV&#45;&gt;files_</title>
<path fill="none" stroke="#000000" d="M82.5289,-359.742C99.4032,-389.8039 133.5716,-442.9213 177.8223,-471.5 187.2438,-477.5847 197.7247,-482.5482 208.529,-486.5968"/>
<polygon fill="#000000" stroke="#000000" points="207.4936,-489.9424 218.0884,-489.9245 209.7949,-483.3314 207.4936,-489.9424"/>
</g>
<!-- KV&#45;&gt;FindInFile -->
<g id="edge14" class="edge">
<title>KV&#45;&gt;FindInFile</title>
<path fill="none" stroke="#000000" d="M112.3617,-315.4083C128.6418,-306.7315 148.3442,-296.2308 168.8868,-285.2824"/>
<polygon fill="#000000" stroke="#000000" points="170.5559,-288.3589 177.7346,-280.5668 167.2635,-282.1815 170.5559,-288.3589"/>
</g>
<!-- keybytes -->
<g id="node13" class="node">
<title>keybytes</title>
<polygon fill="none" stroke="#000000" points="248.7896,-.5 248.7896,-110.5 365.8589,-110.5 365.8589,-.5 248.7896,-.5"/>
<text text-anchor="middle" x="307.3242" y="-95.3" font-family="Times,serif" font-size="14.00" fill="#000000">LookupKey</text>
<polyline fill="none" stroke="#000000" points="248.7896,-88.5 365.8589,-88.5 "/>
<text text-anchor="middle" x="307.3242" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#000000">key_data</text>
<polyline fill="none" stroke="#000000" points="248.7896,-66.5 365.8589,-66.5 "/>
<text text-anchor="start" x="256.7896" y="-51.3" font-family="Times,serif" font-size="14.00" fill="#000000">sequence_number</text>
<polyline fill="none" stroke="#000000" points="248.7896,-44.5 365.8589,-44.5 "/>
<text text-anchor="start" x="256.7896" y="-29.3" font-family="Times,serif" font-size="14.00" fill="#000000">type</text>
<polyline fill="none" stroke="#000000" points="248.7896,-22.5 365.8589,-22.5 "/>
<text text-anchor="middle" x="307.3242" y="-7.3" font-family="Times,serif" font-size="14.00" fill="#000000"> </text>
</g>
<!-- KV&#45;&gt;keybytes -->
<g id="edge10" class="edge">
<title>KV&#45;&gt;keybytes</title>
<path fill="none" stroke="#000000" d="M76.6797,-315.3262C88.7873,-272.6393 120.5721,-178.176 177.8223,-120.5 195.0348,-103.1595 217.8271,-89.6206 239.4879,-79.4948"/>
<polygon fill="#000000" stroke="#000000" points="240.9956,-82.6545 248.6822,-75.363 238.1262,-76.2696 240.9956,-82.6545"/>
</g>
</g>
</svg>
