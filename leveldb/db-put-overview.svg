<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: db_put_overview Pages: 1 -->
<svg width="1369pt" height="347pt"
 viewBox="0.00 0.00 1369.42 346.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 342.7997)">
<title>db_put_overview</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-342.7997 1365.416,-342.7997 1365.416,4 -4,4"/>
<!-- WAL -->
<g id="node1" class="node">
<title>WAL</title>
<polygon fill="none" stroke="#000000" points="167.3188,-229.9001 167.3188,-338.2997 298.8188,-338.2997 298.8188,-229.9001 167.3188,-229.9001"/>
<text text-anchor="middle" x="233.0688" y="-323.0997" font-family="Times,serif" font-size="14.00" fill="#000000">Write AHead log</text>
<polyline fill="none" stroke="#000000" points="167.3188,-316.2997 298.8188,-316.2997 "/>
<text text-anchor="start" x="175.3188" y="-301.0997" font-family="Times,serif" font-size="14.00" fill="#000000">写入内存之前</text>
<text text-anchor="start" x="175.3188" y="-281.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 先append到日志中</text>
<text text-anchor="start" x="175.3188" y="-261.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> 由于采用了顺序写</text>
<text text-anchor="start" x="175.3188" y="-242.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 速度很快</text>
</g>
<!-- MemTable -->
<g id="node2" class="node">
<title>MemTable</title>
<polygon fill="none" stroke="#000000" points="138.9395,-63.3002 138.9395,-210.8997 327.1982,-210.8997 327.1982,-63.3002 138.9395,-63.3002"/>
<text text-anchor="middle" x="233.0688" y="-195.6997" font-family="Times,serif" font-size="14.00" fill="#000000">MemTable</text>
<polyline fill="none" stroke="#000000" points="138.9395,-188.8997 327.1982,-188.8997 "/>
<text text-anchor="start" x="146.9395" y="-173.6997" font-family="Times,serif" font-size="14.00" fill="#000000">将KV插入到Memtable中</text>
<text text-anchor="start" x="146.9395" y="-154.0997" font-family="Times,serif" font-size="14.00" fill="#000000"> Memtable为SkipList</text>
<text text-anchor="start" x="146.9395" y="-134.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 若Memtable大小超过了限制</text>
<text text-anchor="start" x="146.9395" y="-114.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> 就新建一个memtable</text>
<text text-anchor="start" x="146.9395" y="-95.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 并将之前的memtable</text>
<text text-anchor="start" x="146.9395" y="-75.7001" font-family="Times,serif" font-size="14.00" fill="#000000"> 转换为Immtable</text>
</g>
<!-- ImmTable -->
<g id="node10" class="node">
<title>ImmTable</title>
<polygon fill="none" stroke="#000000" points="515.657,-155.0999 441.9895,-155.0999 441.9895,-119.0999 515.657,-119.0999 515.657,-155.0999"/>
<text text-anchor="middle" x="478.8232" y="-132.8999" font-family="Times,serif" font-size="14.00" fill="#000000">ImmTable</text>
</g>
<!-- MemTable&#45;&gt;ImmTable -->
<g id="edge5" class="edge">
<title>MemTable&#45;&gt;ImmTable</title>
<path fill="none" stroke="#000000" d="M327.3811,-137.0999C363.2217,-137.0999 402.4948,-137.0999 432.0647,-137.0999"/>
<polygon fill="#000000" stroke="#000000" points="432.0978,-140.6 442.0977,-137.0999 432.0977,-133.6 432.0978,-140.6"/>
</g>
<!-- Level0SSTable -->
<g id="node3" class="node">
<title>Level0SSTable</title>
<polygon fill="none" stroke="#000000" points="811.5654,-180.5 811.5654,-249.6998 970.6689,-249.6998 970.6689,-180.5 811.5654,-180.5"/>
<text text-anchor="middle" x="891.1172" y="-234.4998" font-family="Times,serif" font-size="14.00" fill="#000000">Level0SSTable</text>
<polyline fill="none" stroke="#000000" points="811.5654,-227.6998 970.6689,-227.6998 "/>
<text text-anchor="start" x="819.5654" y="-212.4998" font-family="Times,serif" font-size="14.00" fill="#000000">第0层的sstable文件之间</text>
<text text-anchor="start" x="819.5654" y="-192.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> key range有重叠部分</text>
</g>
<!-- Level1SSTable -->
<g id="node4" class="node">
<title>Level1SSTable</title>
<polygon fill="none" stroke="#000000" points="1006.6689,-170.7 1006.6689,-259.4998 1220.9727,-259.4998 1220.9727,-170.7 1006.6689,-170.7"/>
<text text-anchor="middle" x="1113.8208" y="-244.2998" font-family="Times,serif" font-size="14.00" fill="#000000">Level1SSTable</text>
<polyline fill="none" stroke="#000000" points="1006.6689,-237.4998 1220.9727,-237.4998 "/>
<text text-anchor="start" x="1014.6689" y="-222.2998" font-family="Times,serif" font-size="14.00" fill="#000000">第1层sstable 文件</text>
<text text-anchor="start" x="1014.6689" y="-202.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> 由后台线程compact而来</text>
<text text-anchor="start" x="1014.6689" y="-183.1" font-family="Times,serif" font-size="14.00" fill="#000000"> 文件之间的key range无重叠部分</text>
</g>
<!-- Level0SSTable&#45;&gt;Level1SSTable -->
<g id="edge8" class="edge">
<title>Level0SSTable&#45;&gt;Level1SSTable</title>
<path fill="none" stroke="#000000" d="M970.8893,-215.0999C979.232,-215.0999 987.8326,-215.0999 996.4814,-215.0999"/>
<polygon fill="#000000" stroke="#000000" points="996.6441,-218.6 1006.6441,-215.0999 996.644,-211.6 996.6441,-218.6"/>
</g>
<!-- LevelNSSTable -->
<g id="node5" class="node">
<title>LevelNSSTable</title>
<polygon fill="none" stroke="#000000" points="1256.9727,-193.0999 1256.9727,-237.0999 1361.416,-237.0999 1361.416,-193.0999 1256.9727,-193.0999"/>
<text text-anchor="middle" x="1309.1943" y="-221.8999" font-family="Times,serif" font-size="14.00" fill="#000000">LevelNSSTable</text>
<polyline fill="none" stroke="#000000" points="1256.9727,-215.0999 1361.416,-215.0999 "/>
<text text-anchor="middle" x="1309.1943" y="-199.8999" font-family="Times,serif" font-size="14.00" fill="#000000">...</text>
</g>
<!-- Level1SSTable&#45;&gt;LevelNSSTable -->
<g id="edge9" class="edge">
<title>Level1SSTable&#45;&gt;LevelNSSTable</title>
<path fill="none" stroke="#000000" d="M1221.2238,-215.0999C1229.8275,-215.0999 1238.3297,-215.0999 1246.4598,-215.0999"/>
<polygon fill="#000000" stroke="#000000" points="1246.5386,-218.6 1256.5386,-215.0999 1246.5386,-211.6 1246.5386,-218.6"/>
</g>
<!-- KV -->
<g id="node6" class="node">
<title>KV</title>
<polygon fill="none" stroke="#000000" points="0,-115.0999 0,-159.0999 102.9395,-159.0999 102.9395,-115.0999 0,-115.0999"/>
<text text-anchor="middle" x="51.4697" y="-143.8999" font-family="Times,serif" font-size="14.00" fill="#000000">KV</text>
<polyline fill="none" stroke="#000000" points="0,-137.0999 102.9395,-137.0999 "/>
<text text-anchor="start" x="8" y="-121.8999" font-family="Times,serif" font-size="14.00" fill="#000000">key,value batch</text>
</g>
<!-- KV&#45;&gt;WAL -->
<g id="edge10" class="edge">
<title>KV&#45;&gt;WAL</title>
<path fill="none" stroke="#000000" d="M72.8567,-159.2831C90.0351,-176.6255 115.1381,-200.9254 138.9395,-220.0999 145.3547,-225.2681 152.1767,-230.4502 159.1028,-235.5046"/>
<polygon fill="#000000" stroke="#000000" points="157.1005,-238.3758 167.2632,-241.371 161.1865,-232.692 157.1005,-238.3758"/>
</g>
<!-- KV&#45;&gt;MemTable -->
<g id="edge4" class="edge">
<title>KV&#45;&gt;MemTable</title>
<path fill="none" stroke="#000000" d="M103.023,-137.0999C111.1751,-137.0999 119.8498,-137.0999 128.7005,-137.0999"/>
<polygon fill="#000000" stroke="#000000" points="128.7496,-140.6 138.7495,-137.0999 128.7495,-133.6 128.7496,-140.6"/>
</g>
<!-- VersionSet -->
<g id="node9" class="node">
<title>VersionSet</title>
<polygon fill="none" stroke="#000000" points="363.1982,-.5 363.1982,-69.6998 594.4482,-69.6998 594.4482,-.5 363.1982,-.5"/>
<text text-anchor="middle" x="478.8232" y="-54.4998" font-family="Times,serif" font-size="14.00" fill="#000000">VersionSet</text>
<polyline fill="none" stroke="#000000" points="363.1982,-47.6998 594.4482,-47.6998 "/>
<text text-anchor="start" x="371.1982" y="-32.4998" font-family="Times,serif" font-size="14.00" fill="#000000">获取当前sequnce_number</text>
<text text-anchor="start" x="371.1982" y="-12.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> 并更新sequnce_number += kv_count</text>
</g>
<!-- KV&#45;&gt;VersionSet -->
<g id="edge11" class="edge">
<title>KV&#45;&gt;VersionSet</title>
<path fill="none" stroke="#000000" d="M67.3578,-114.9248C83.0343,-95.0328 108.9563,-67.043 138.9395,-54.0999 205.6461,-25.3041 286.6681,-19.7837 352.872,-21.8246"/>
<polygon fill="#000000" stroke="#000000" points="352.8243,-25.3251 362.9466,-22.1965 353.0826,-18.3299 352.8243,-25.3251"/>
</g>
<!-- KeyValue -->
<g id="node7" class="node">
<title>KeyValue</title>
<polygon fill="none" stroke="#000000" points="630.4482,-63.3 630.4482,-178.8999 775.5654,-178.8999 775.5654,-63.3 630.4482,-63.3"/>
<text text-anchor="middle" x="703.0068" y="-163.6999" font-family="Times,serif" font-size="14.00" fill="#000000">插入skiplist的buf编码</text>
<polyline fill="none" stroke="#000000" points="630.4482,-151.3 775.5654,-151.3 "/>
<text text-anchor="start" x="638.4482" y="-136.1" font-family="Times,serif" font-size="14.00" fill="#000000">keySize: varint32</text>
<polyline fill="none" stroke="#000000" points="630.4482,-129.3 775.5654,-129.3 "/>
<text text-anchor="start" x="638.4482" y="-114.1" font-family="Times,serif" font-size="14.00" fill="#000000">keyBytes</text>
<polyline fill="none" stroke="#000000" points="630.4482,-107.3 775.5654,-107.3 "/>
<text text-anchor="start" x="638.4482" y="-92.1" font-family="Times,serif" font-size="14.00" fill="#000000">valueSize: varint32</text>
<polyline fill="none" stroke="#000000" points="630.4482,-85.3 775.5654,-85.3 "/>
<text text-anchor="start" x="638.4482" y="-70.1" font-family="Times,serif" font-size="14.00" fill="#000000">value bytes</text>
</g>
<!-- KeyBytes -->
<g id="node8" class="node">
<title>KeyBytes</title>
<polygon fill="none" stroke="#000000" points="832.5825,-55.0999 832.5825,-121.0999 949.6519,-121.0999 949.6519,-55.0999 832.5825,-55.0999"/>
<text text-anchor="middle" x="891.1172" y="-105.8999" font-family="Times,serif" font-size="14.00" fill="#000000">KeyBytes</text>
<polyline fill="none" stroke="#000000" points="832.5825,-99.0999 949.6519,-99.0999 "/>
<text text-anchor="middle" x="891.1172" y="-83.8999" font-family="Times,serif" font-size="14.00" fill="#000000">key_data</text>
<polyline fill="none" stroke="#000000" points="832.5825,-77.0999 949.6519,-77.0999 "/>
<text text-anchor="middle" x="891.1172" y="-61.8999" font-family="Times,serif" font-size="14.00" fill="#000000">sequence_number</text>
</g>
<!-- KeyValue&#45;&gt;KeyBytes -->
<g id="edge2" class="edge">
<title>KeyValue:KeyBytes&#45;&gt;KeyBytes</title>
<path fill="none" stroke="#000000" d="M775.5654,-118.0999C791.0372,-118.0999 807.3111,-115.5491 822.6038,-111.935"/>
<polygon fill="#000000" stroke="#000000" points="823.6629,-115.2772 832.4933,-109.4227 821.9393,-108.4927 823.6629,-115.2772"/>
</g>
<!-- VersionSet&#45;&gt;KeyBytes -->
<g id="edge1" class="edge">
<title>VersionSet&#45;&gt;KeyBytes:sequence</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M594.7698,-38.6199C649.7501,-41.2851 716.2396,-45.9502 775.5654,-54.0999 797.2417,-57.0776 804.3775,-63.6858 821.8847,-65.582"/>
<polygon fill="#000000" stroke="#000000" points="821.953,-69.0899 832.1172,-66.0999 822.3069,-62.0988 821.953,-69.0899"/>
</g>
<!-- ImmTable&#45;&gt;KeyValue -->
<g id="edge3" class="edge">
<title>ImmTable&#45;&gt;KeyValue</title>
<path fill="none" stroke="#000000" d="M515.8426,-134.4578C544.1481,-132.4377 584.2737,-129.5739 620.1171,-127.0158"/>
<polygon fill="#000000" stroke="#000000" points="620.3744,-130.5064 630.0998,-126.3033 619.876,-123.5242 620.3744,-130.5064"/>
</g>
<!-- SSTableFile -->
<g id="node11" class="node">
<title>SSTableFile</title>
<polygon fill="none" stroke="#000000" points="745.2504,-233.0999 660.7633,-233.0999 660.7633,-197.0999 745.2504,-197.0999 745.2504,-233.0999"/>
<text text-anchor="middle" x="703.0068" y="-210.8999" font-family="Times,serif" font-size="14.00" fill="#000000">SSTableFile</text>
</g>
<!-- ImmTable&#45;&gt;SSTableFile -->
<g id="edge6" class="edge">
<title>ImmTable&#45;&gt;SSTableFile</title>
<path fill="none" stroke="#000000" d="M515.8426,-149.98C552.6855,-162.7987 609.5541,-182.585 650.9395,-196.9842"/>
<polygon fill="#000000" stroke="#000000" points="649.9812,-200.3565 660.5761,-200.337 652.2815,-193.7452 649.9812,-200.3565"/>
</g>
<!-- SSTableFile&#45;&gt;Level0SSTable -->
<g id="edge7" class="edge">
<title>SSTableFile&#45;&gt;Level0SSTable</title>
<path fill="none" stroke="#000000" d="M745.2225,-215.0999C761.8263,-215.0999 781.5646,-215.0999 801.0724,-215.0999"/>
<polygon fill="#000000" stroke="#000000" points="801.235,-218.6 811.2349,-215.0999 801.2349,-211.6 801.235,-218.6"/>
</g>
</g>
</svg>
