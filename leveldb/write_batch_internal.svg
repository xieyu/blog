<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: write_batch Pages: 1 -->
<svg width="902pt" height="330pt"
 viewBox="0.00 0.00 902.00 330.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 326)">
<title>write_batch</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-326 898,-326 898,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RecordFormat</title>
<polygon fill="none" stroke="#000000" points="356,-86.5 356,-248.5 886,-248.5 886,-86.5 356,-86.5"/>
<text text-anchor="middle" x="621" y="-228.5" font-family="Times,serif" font-size="20.00" fill="#000000">RecordFormat</text>
</g>
<!-- rep_ -->
<g id="node1" class="node">
<title>rep_</title>
<polygon fill="none" stroke="#000000" points="364,-95 364,-210 519,-210 519,-95 364,-95"/>
<text text-anchor="middle" x="441.5" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#000000">rep_</text>
<polyline fill="none" stroke="#000000" points="364,-187 519,-187 "/>
<text text-anchor="start" x="372" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#000000">最后写入日志中的slice</text>
<polyline fill="none" stroke="#000000" points="364,-164 519,-164 "/>
<text text-anchor="start" x="372" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#000000">sequence: fixed64</text>
<polyline fill="none" stroke="#000000" points="364,-141 519,-141 "/>
<text text-anchor="start" x="372" y="-125.8" font-family="Times,serif" font-size="14.00" fill="#000000">count: fixed32</text>
<polyline fill="none" stroke="#000000" points="364,-118 519,-118 "/>
<text text-anchor="start" x="372" y="-102.8" font-family="Times,serif" font-size="14.00" fill="#000000">data: record[count]</text>
</g>
<!-- record -->
<g id="node2" class="node">
<title>record</title>
<polygon fill="none" stroke="#000000" points="555,-124 555,-193 742,-193 742,-124 555,-124"/>
<text text-anchor="middle" x="648.5" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#000000">record</text>
<polyline fill="none" stroke="#000000" points="555,-170 742,-170 "/>
<text text-anchor="start" x="563" y="-154.8" font-family="Times,serif" font-size="14.00" fill="#000000">kTypeValue varstring varstring</text>
<polyline fill="none" stroke="#000000" points="555,-147 742,-147 "/>
<text text-anchor="start" x="563" y="-131.8" font-family="Times,serif" font-size="14.00" fill="#000000">或者kTypeDeletion varstring</text>
</g>
<!-- rep_&#45;&gt;record -->
<g id="edge3" class="edge">
<title>rep_&#45;&gt;record</title>
<path fill="none" stroke="#000000" d="M519.1681,-154.7512C527.4961,-154.9926 536.0625,-155.2409 544.6323,-155.4893"/>
<polygon fill="#000000" stroke="#000000" points="544.5826,-158.9893 554.6799,-155.7806 544.7855,-151.9922 544.5826,-158.9893"/>
</g>
<!-- AddRecord -->
<g id="node12" class="node">
<title>AddRecord</title>
<polygon fill="none" stroke="#000000" points="587.5,-32.5 587.5,-78.5 709.5,-78.5 709.5,-32.5 587.5,-32.5"/>
<text text-anchor="middle" x="648.5" y="-63.3" font-family="Times,serif" font-size="14.00" fill="#000000">Writer::AddRecord</text>
<polyline fill="none" stroke="#000000" points="587.5,-55.5 709.5,-55.5 "/>
<text text-anchor="start" x="595.5" y="-40.3" font-family="Times,serif" font-size="14.00" fill="#000000">将日志写入文件</text>
</g>
<!-- rep_&#45;&gt;AddRecord -->
<g id="edge6" class="edge">
<title>rep_&#45;&gt;AddRecord</title>
<path fill="none" stroke="#c0c0c0" stroke-dasharray="5,2" d="M519.0644,-100.8735C530.8305,-94.1646 543.0399,-87.7964 555,-82.5 562.2489,-79.2899 569.9816,-76.3495 577.7773,-73.6878"/>
<polygon fill="#c0c0c0" stroke="#c0c0c0" points="578.8708,-77.0127 587.2892,-70.5799 576.6967,-70.3589 578.8708,-77.0127"/>
</g>
<!-- varstring -->
<g id="node3" class="node">
<title>varstring</title>
<polygon fill="none" stroke="#000000" points="778,-135 778,-204 878,-204 878,-135 778,-135"/>
<text text-anchor="middle" x="828" y="-188.8" font-family="Times,serif" font-size="14.00" fill="#000000">varstring</text>
<polyline fill="none" stroke="#000000" points="778,-181 878,-181 "/>
<text text-anchor="start" x="786" y="-165.8" font-family="Times,serif" font-size="14.00" fill="#000000">len: varint32</text>
<polyline fill="none" stroke="#000000" points="778,-158 878,-158 "/>
<text text-anchor="start" x="786" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#000000">data: uint8[len]</text>
</g>
<!-- record&#45;&gt;varstring -->
<g id="edge4" class="edge">
<title>record&#45;&gt;varstring</title>
<path fill="none" stroke="#000000" d="M742.193,-164.2416C750.7998,-164.7691 759.3582,-165.2935 767.5507,-165.7956"/>
<polygon fill="#000000" stroke="#000000" points="767.5129,-169.2997 777.7083,-166.4181 767.9411,-162.3129 767.5129,-169.2997"/>
</g>
<!-- rep__push_back -->
<g id="node4" class="node">
<title>rep__push_back</title>
<polygon fill="none" stroke="#000000" points="192,-117.5 192,-163.5 328,-163.5 328,-117.5 192,-117.5"/>
<text text-anchor="middle" x="260" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#000000">rep__push_back</text>
<polyline fill="none" stroke="#000000" points="192,-140.5 328,-140.5 "/>
<text text-anchor="start" x="200" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#000000">在后面增加key类型</text>
</g>
<!-- rep__push_back&#45;&gt;rep_ -->
<g id="edge14" class="edge">
<title>rep__push_back&#45;&gt;rep_:data</title>
<path fill="none" stroke="#000000" d="M308.9509,-117.445C322.6824,-112.5183 337.9999,-108.3721 353.1016,-106.9904"/>
<polygon fill="#000000" stroke="#000000" points="353.676,-110.4673 363.5,-106.5 353.3462,-103.4751 353.676,-110.4673"/>
</g>
<!-- PutLengthPrefixedSlice -->
<g id="node5" class="node">
<title>PutLengthPrefixedSlice</title>
<polygon fill="none" stroke="#000000" points="364,-256.5 364,-302.5 519,-302.5 519,-256.5 364,-256.5"/>
<text text-anchor="middle" x="441.5" y="-287.3" font-family="Times,serif" font-size="14.00" fill="#000000">PutLengthPrefixedSlice</text>
<polyline fill="none" stroke="#000000" points="364,-279.5 519,-279.5 "/>
<text text-anchor="start" x="372" y="-264.3" font-family="Times,serif" font-size="14.00" fill="#000000">将key/value追加在后面</text>
</g>
<!-- PutLengthPrefixedSlice&#45;&gt;varstring -->
<g id="edge5" class="edge">
<title>PutLengthPrefixedSlice&#45;&gt;varstring</title>
<path fill="none" stroke="#000000" d="M519.0851,-262.2231C580.1796,-247.995 667.214,-226.3422 742,-202.5 750.6157,-199.7533 759.6213,-196.6099 768.4241,-193.379"/>
<polygon fill="#000000" stroke="#000000" points="769.7239,-196.6298 777.8684,-189.8536 767.2758,-190.0718 769.7239,-196.6298"/>
</g>
<!-- WriteBatch_Put -->
<g id="node6" class="node">
<title>WriteBatch_Put</title>
<polygon fill="none" stroke="#000000" points="25.5,-206.5 25.5,-252.5 130.5,-252.5 130.5,-206.5 25.5,-206.5"/>
<text text-anchor="middle" x="78" y="-237.3" font-family="Times,serif" font-size="14.00" fill="#000000">WriteBatch::Put</text>
<polyline fill="none" stroke="#000000" points="25.5,-229.5 130.5,-229.5 "/>
<text text-anchor="middle" x="78" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#000000">增加key/value</text>
</g>
<!-- WriteBatch_Put&#45;&gt;rep__push_back -->
<g id="edge7" class="edge">
<title>WriteBatch_Put&#45;&gt;rep__push_back</title>
<path fill="none" stroke="#75daad" d="M124.8429,-206.4267C145.4325,-196.3012 169.9064,-184.2874 192,-173.5 195.7144,-171.6864 199.5443,-169.8195 203.405,-167.9398"/>
<polygon fill="#75daad" stroke="#75daad" points="204.9679,-171.0718 212.4293,-163.5499 201.9058,-164.777 204.9679,-171.0718"/>
</g>
<!-- WriteBatch_Put&#45;&gt;PutLengthPrefixedSlice -->
<g id="edge8" class="edge">
<title>WriteBatch_Put&#45;&gt;PutLengthPrefixedSlice</title>
<path fill="none" stroke="#75daad" d="M130.856,-236.7704C189.2233,-244.7989 284.1294,-257.8534 353.7025,-267.4233"/>
<polygon fill="#75daad" stroke="#75daad" points="353.3926,-270.9136 363.7763,-268.809 354.3465,-263.9789 353.3926,-270.9136"/>
</g>
<!-- kTypeValue -->
<g id="node10" class="node">
<title>kTypeValue</title>
<polygon fill="none" stroke="#000000" points="218.5,-275.5 218.5,-321.5 301.5,-321.5 301.5,-275.5 218.5,-275.5"/>
<text text-anchor="middle" x="260" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#000000">kTypeValue</text>
<polyline fill="none" stroke="#000000" points="218.5,-298.5 301.5,-298.5 "/>
<text text-anchor="middle" x="260" y="-283.3" font-family="Times,serif" font-size="14.00" fill="#000000">0x1</text>
</g>
<!-- WriteBatch_Put&#45;&gt;kTypeValue -->
<g id="edge9" class="edge">
<title>WriteBatch_Put&#45;&gt;kTypeValue</title>
<path fill="none" stroke="#75daad" d="M130.6419,-249.4577C155.295,-258.8042 184.5455,-269.8936 208.9901,-279.1611"/>
<polygon fill="#75daad" stroke="#75daad" points="207.8574,-282.4747 218.4487,-282.747 210.3389,-275.9293 207.8574,-282.4747"/>
</g>
<!-- SetCount -->
<g id="node11" class="node">
<title>SetCount</title>
<polygon fill="none" stroke="#000000" points="293.5,-218.5 226.5,-218.5 226.5,-182.5 293.5,-182.5 293.5,-218.5"/>
<text text-anchor="middle" x="260" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#000000">SetCount</text>
</g>
<!-- WriteBatch_Put&#45;&gt;SetCount -->
<g id="edge10" class="edge">
<title>WriteBatch_Put&#45;&gt;SetCount</title>
<path fill="none" stroke="#75daad" d="M130.6419,-221.112C157.7695,-216.7895 190.4637,-211.58 216.1961,-207.4797"/>
<polygon fill="#75daad" stroke="#75daad" points="217.0783,-210.8834 226.403,-205.8534 215.9768,-203.9706 217.0783,-210.8834"/>
</g>
<!-- SetSequence -->
<g id="node7" class="node">
<title>SetSequence</title>
<polygon fill="none" stroke="#000000" points="0,-.5 0,-46.5 156,-46.5 156,-.5 0,-.5"/>
<text text-anchor="middle" x="78" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#000000">WriteBatch::SetSequence</text>
<polyline fill="none" stroke="#000000" points="0,-23.5 156,-23.5 "/>
<text text-anchor="start" x="8" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#000000">这次batch的sequnce</text>
</g>
<!-- SetSequence&#45;&gt;rep_ -->
<g id="edge1" class="edge">
<title>SetSequence&#45;&gt;rep_:sequence</title>
<path fill="none" stroke="#000000" d="M156.0431,-24.6921C288.7544,-27.97 542.5345,-40.2467 525.2899,-86.1846"/>
<polygon fill="#000000" stroke="#000000" points="522.3419,-84.2934 519.5,-94.5 528.0865,-88.2934 522.3419,-84.2934"/>
</g>
<!-- WriteBatch_Delete -->
<g id="node8" class="node">
<title>WriteBatch_Delete</title>
<polygon fill="none" stroke="#000000" points="15.5,-110 15.5,-171 140.5,-171 140.5,-110 15.5,-110"/>
<text text-anchor="middle" x="78" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#000000">WriteBatch::Delete</text>
<polyline fill="none" stroke="#000000" points="15.5,-148 140.5,-148 "/>
<text text-anchor="start" x="23.5" y="-132.8" font-family="Times,serif" font-size="14.00" fill="#000000">删除key 在日志中</text>
<text text-anchor="start" x="23.5" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入特殊标记key</text>
</g>
<!-- WriteBatch_Delete&#45;&gt;rep__push_back -->
<g id="edge11" class="edge">
<title>WriteBatch_Delete&#45;&gt;rep__push_back</title>
<path fill="none" stroke="#ff7272" d="M140.6341,-140.5C153.8261,-140.5 167.9019,-140.5 181.5901,-140.5"/>
<polygon fill="#ff7272" stroke="#ff7272" points="181.961,-144.0001 191.961,-140.5 181.961,-137.0001 181.961,-144.0001"/>
</g>
<!-- kTypeDeletion -->
<g id="node9" class="node">
<title>kTypeDeletion</title>
<polygon fill="none" stroke="#000000" points="211,-52.5 211,-98.5 309,-98.5 309,-52.5 211,-52.5"/>
<text text-anchor="middle" x="260" y="-83.3" font-family="Times,serif" font-size="14.00" fill="#000000">kTypeDeletion</text>
<polyline fill="none" stroke="#000000" points="211,-75.5 309,-75.5 "/>
<text text-anchor="middle" x="260" y="-60.3" font-family="Times,serif" font-size="14.00" fill="#000000">0x0</text>
</g>
<!-- WriteBatch_Delete&#45;&gt;kTypeDeletion -->
<g id="edge12" class="edge">
<title>WriteBatch_Delete&#45;&gt;kTypeDeletion</title>
<path fill="none" stroke="#ff7272" d="M140.6341,-118.1307C160.2498,-111.1251 181.8194,-103.4216 201.1637,-96.513"/>
<polygon fill="#ff7272" stroke="#ff7272" points="202.5173,-99.7461 210.7576,-93.0866 200.1629,-93.1539 202.5173,-99.7461"/>
</g>
<!-- WriteBatch_Delete&#45;&gt;SetCount -->
<g id="edge13" class="edge">
<title>WriteBatch_Delete&#45;&gt;SetCount</title>
<path fill="none" stroke="#ff7272" d="M140.6341,-161.1486C165.7136,-169.4166 193.987,-178.7375 216.7197,-186.2318"/>
<polygon fill="#ff7272" stroke="#ff7272" points="215.8265,-189.6225 226.4196,-189.4295 218.0182,-182.9745 215.8265,-189.6225"/>
</g>
<!-- SetCount&#45;&gt;rep_ -->
<g id="edge2" class="edge">
<title>SetCount&#45;&gt;rep_:count</title>
<path fill="none" stroke="#000000" d="M293.5858,-191.0339C305.1604,-186.8019 317.7734,-181.034 328,-173.5 344.9108,-161.0416 340.7975,-138.6653 353.6704,-131.6584"/>
<polygon fill="#000000" stroke="#000000" points="354.4834,-135.0633 363.5,-129.5 352.982,-128.2262 354.4834,-135.0633"/>
</g>
</g>
</svg>
