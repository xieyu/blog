<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: snapshotcow Pages: 1 -->
<svg width="790pt" height="216pt"
 viewBox="0.00 0.00 789.69 216.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 212)">
<title>snapshotcow</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-212 785.6904,-212 785.6904,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_copy_on_write</title>
<polygon fill="none" stroke="#000000" points="8,-8 8,-200 773.6904,-200 773.6904,-8 8,-8"/>
<text text-anchor="middle" x="390.8452" y="-180" font-family="Times,serif" font-size="20.00" fill="#000000">copy on write</text>
</g>
<!-- Client -->
<g id="node1" class="node">
<title>Client</title>
<polygon fill="none" stroke="#000000" points="70,-108 16,-108 16,-72 70,-72 70,-108"/>
<text text-anchor="middle" x="43" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#000000">Client</text>
</g>
<!-- req1 -->
<g id="node2" class="node">
<title>req1</title>
<polygon fill="none" stroke="#000000" points="106,-45.6001 106,-134.3999 330.7969,-134.3999 330.7969,-45.6001 106,-45.6001"/>
<text text-anchor="middle" x="218.3984" y="-119.1999" font-family="Times,serif" font-size="14.00" fill="#000000">write</text>
<polyline fill="none" stroke="#000000" points="106,-112.3999 330.7969,-112.3999 "/>
<text text-anchor="start" x="114" y="-97.1999" font-family="Times,serif" font-size="14.00" fill="#000000">client 发送写请求</text>
<text text-anchor="start" x="114" y="-77.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 由于lease过期，所以需要向master</text>
<text text-anchor="start" x="114" y="-58" font-family="Times,serif" font-size="14.00" fill="#000000"> 查询新的拥有lease的primary</text>
</g>
<!-- Client&#45;&gt;req1 -->
<g id="edge1" class="edge">
<title>Client&#45;&gt;req1</title>
<path fill="none" stroke="#666666" d="M70.0216,-90C77.502,-90 86.1376,-90 95.4043,-90"/>
<polygon fill="#666666" stroke="#666666" points="95.6825,-93.5001 105.6824,-90 95.6824,-86.5001 95.6825,-93.5001"/>
</g>
<!-- Master -->
<g id="node3" class="node">
<title>Master</title>
<polygon fill="none" stroke="#000000" points="366.7969,-16.2003 366.7969,-163.7997 599.7627,-163.7997 599.7627,-16.2003 366.7969,-16.2003"/>
<text text-anchor="middle" x="483.2798" y="-148.5997" font-family="Times,serif" font-size="14.00" fill="#000000">Master</text>
<polyline fill="none" stroke="#000000" points="366.7969,-141.7997 599.7627,-141.7997 "/>
<text text-anchor="start" x="374.7969" y="-126.5997" font-family="Times,serif" font-size="14.00" fill="#000000">1.master发现chunk引用计数&gt;1</text>
<text text-anchor="start" x="374.7969" y="-106.9998" font-family="Times,serif" font-size="14.00" fill="#000000"> 2.master block client的请求</text>
<text text-anchor="start" x="374.7969" y="-87.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.master新建一个chunk c&#39;</text>
<text text-anchor="start" x="374.7969" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4.让所有拥有该chunk的chunkServer</text>
<text text-anchor="start" x="374.7969" y="-48.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 复制出一份新的chunk c&#39;</text>
<text text-anchor="start" x="374.7969" y="-28.6002" font-family="Times,serif" font-size="14.00" fill="#000000"> 5.master reply client请求 chunk c&#39;</text>
</g>
<!-- req1&#45;&gt;Master -->
<g id="edge2" class="edge">
<title>req1&#45;&gt;Master</title>
<path fill="none" stroke="#666666" d="M331.1161,-90C339.4249,-90 347.8396,-90 356.2255,-90"/>
<polygon fill="#666666" stroke="#666666" points="356.4311,-93.5001 366.4311,-90 356.4311,-86.5001 356.4311,-93.5001"/>
</g>
<!-- ChunkServer -->
<g id="node4" class="node">
<title>ChunkServer</title>
<polygon fill="none" stroke="#000000" points="635.7627,-55.4001 635.7627,-124.5999 765.6904,-124.5999 765.6904,-55.4001 635.7627,-55.4001"/>
<text text-anchor="middle" x="700.7266" y="-109.3999" font-family="Times,serif" font-size="14.00" fill="#000000">ChunkServer</text>
<polyline fill="none" stroke="#000000" points="635.7627,-102.5999 765.6904,-102.5999 "/>
<text text-anchor="start" x="643.7627" y="-87.3999" font-family="Times,serif" font-size="14.00" fill="#000000">本地将chunk c复制</text>
<text text-anchor="start" x="643.7627" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 一份新的chunk c&#39;</text>
</g>
<!-- Master&#45;&gt;ChunkServer -->
<g id="edge3" class="edge">
<title>Master&#45;&gt;ChunkServer</title>
<path fill="none" stroke="#666666" d="M599.96,-90C608.5316,-90 617.0369,-90 625.2613,-90"/>
<polygon fill="#666666" stroke="#666666" points="625.5124,-93.5001 635.5124,-90 625.5124,-86.5001 625.5124,-93.5001"/>
</g>
</g>
</svg>
