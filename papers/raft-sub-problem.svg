<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: raft_sub_problem Pages: 1 -->
<svg width="2352pt" height="999pt"
 viewBox="0.00 0.00 2351.68 998.70" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 994.6998)">
<title>raft_sub_problem</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-994.6998 2347.6816,-994.6998 2347.6816,4 -4,4"/>
<!-- Raft -->
<g id="node1" class="node">
<title>Raft</title>
<polygon fill="none" stroke="#000000" points="54,-324.6998 0,-324.6998 0,-288.6998 54,-288.6998 54,-324.6998"/>
<text text-anchor="middle" x="27" y="-302.4998" font-family="Times,serif" font-size="14.00" fill="#000000">Raft</text>
</g>
<!-- LeaderElection -->
<g id="node2" class="node">
<title>LeaderElection</title>
<polygon fill="none" stroke="#000000" points="514.6369,-702.6998 413.6267,-702.6998 413.6267,-666.6998 514.6369,-666.6998 514.6369,-702.6998"/>
<text text-anchor="middle" x="464.1318" y="-680.4998" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderElection</text>
</g>
<!-- Raft&#45;&gt;LeaderElection -->
<g id="edge1" class="edge">
<title>Raft&#45;&gt;LeaderElection</title>
<path fill="none" stroke="#666666" d="M48.0838,-324.9316C119.6425,-386.8103 353.3323,-588.8884 435.3579,-659.8182"/>
<polygon fill="#666666" stroke="#666666" points="433.4061,-662.7575 443.2596,-666.651 437.9848,-657.4626 433.4061,-662.7575"/>
</g>
<!-- LogReplication -->
<g id="node3" class="node">
<title>LogReplication</title>
<polygon fill="none" stroke="#000000" points="90,-173.3 90,-262.0997 303.1211,-262.0997 303.1211,-173.3 90,-173.3"/>
<text text-anchor="middle" x="196.5605" y="-246.8997" font-family="Times,serif" font-size="14.00" fill="#000000">LogReplication</text>
<polyline fill="none" stroke="#000000" points="90,-240.0997 303.1211,-240.0997 "/>
<text text-anchor="start" x="98" y="-224.8997" font-family="Times,serif" font-size="14.00" fill="#000000">leader从client接收logEntry</text>
<text text-anchor="start" x="98" y="-205.2998" font-family="Times,serif" font-size="14.00" fill="#000000"> 然后复制到各个follower上</text>
<text text-anchor="start" x="98" y="-185.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> follower和leader的日志保持一致</text>
</g>
<!-- Raft&#45;&gt;LogReplication -->
<g id="edge2" class="edge">
<title>Raft&#45;&gt;LogReplication</title>
<path fill="none" stroke="#666666" d="M54.2428,-292.4004C67.7153,-285.3289 84.8582,-276.3309 102.5437,-267.048"/>
<polygon fill="#666666" stroke="#666666" points="104.5972,-269.923 111.8249,-262.1764 101.3438,-263.725 104.5972,-269.923"/>
</g>
<!-- Safty -->
<g id="node4" class="node">
<title>Safty</title>
<polygon fill="none" stroke="#000000" points="223.5605,-324.6998 169.5605,-324.6998 169.5605,-288.6998 223.5605,-288.6998 223.5605,-324.6998"/>
<text text-anchor="middle" x="196.5605" y="-302.4998" font-family="Times,serif" font-size="14.00" fill="#000000">Safty</text>
</g>
<!-- Raft&#45;&gt;Safty -->
<g id="edge3" class="edge">
<title>Raft&#45;&gt;Safty</title>
<path fill="none" stroke="#666666" d="M54.2428,-306.6998C82.6711,-306.6998 127.4415,-306.6998 159.1683,-306.6998"/>
<polygon fill="#666666" stroke="#666666" points="159.3854,-310.1999 169.3853,-306.6998 159.3853,-303.1999 159.3854,-310.1999"/>
</g>
<!-- ElectionTimer -->
<g id="node5" class="node">
<title>ElectionTimer</title>
<polygon fill="none" stroke="#000000" points="1099.0105,-694.6998 1002.2688,-694.6998 1002.2688,-658.6998 1099.0105,-658.6998 1099.0105,-694.6998"/>
<text text-anchor="middle" x="1050.6396" y="-672.4998" font-family="Times,serif" font-size="14.00" fill="#000000">ElectionTimer</text>
</g>
<!-- LeaderElection&#45;&gt;ElectionTimer -->
<g id="edge4" class="edge">
<title>LeaderElection&#45;&gt;ElectionTimer</title>
<path fill="none" stroke="#b83b5e" d="M514.6448,-684.0108C622.9381,-682.5337 876.9381,-679.0691 992.0705,-677.4987"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="992.1563,-680.998 1002.1076,-677.3618 992.0608,-673.9986 992.1563,-680.998"/>
</g>
<!-- Term -->
<g id="node6" class="node">
<title>Term</title>
<polygon fill="none" stroke="#000000" points="1437.6079,-833.0999 1437.6079,-902.2997 1591.2427,-902.2997 1591.2427,-833.0999 1437.6079,-833.0999"/>
<text text-anchor="middle" x="1514.4253" y="-887.0997" font-family="Times,serif" font-size="14.00" fill="#000000">Term</text>
<polyline fill="none" stroke="#000000" points="1437.6079,-880.2997 1591.2427,-880.2997 "/>
<text text-anchor="start" x="1445.6079" y="-865.0997" font-family="Times,serif" font-size="14.00" fill="#000000">candidate发起投票时，</text>
<text text-anchor="start" x="1445.6079" y="-845.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 将自己的term += 1</text>
</g>
<!-- LeaderElection&#45;&gt;Term -->
<g id="edge5" class="edge">
<title>LeaderElection&#45;&gt;Term</title>
<path fill="none" stroke="#b83b5e" d="M502.7826,-702.8731C610.1665,-752.234 922.4364,-888.1347 1198.8398,-933.6998 1277.8678,-946.7276 1301.0096,-951.7112 1379.0527,-933.6998 1402.9055,-928.1949 1427.4178,-917.8888 1448.9168,-907.0297"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1450.6684,-910.064 1457.9354,-902.3543 1447.4466,-903.8495 1450.6684,-910.064"/>
</g>
<!-- AppendEntities -->
<g id="node7" class="node">
<title>AppendEntities</title>
<polygon fill="#95e1d3" stroke="#000000" points="625.1426,-500.9001 625.1426,-656.4996 902.4395,-656.4996 902.4395,-500.9001 625.1426,-500.9001"/>
<text text-anchor="middle" x="763.791" y="-641.2996" font-family="Times,serif" font-size="14.00" fill="#000000">AppendEntities</text>
<polyline fill="none" stroke="#000000" points="625.1426,-634.4996 902.4395,-634.4996 "/>
<text text-anchor="start" x="633.1426" y="-619.2996" font-family="Times,serif" font-size="14.00" fill="#000000">Leader周期性的发送心跳信息给follower</text>
<polyline fill="none" stroke="#000000" points="625.1426,-606.8997 902.4395,-606.8997 "/>
<text text-anchor="start" x="633.1426" y="-591.6997" font-family="Times,serif" font-size="14.00" fill="#000000">follower 收到Leader发送的AE请求时</text>
<text text-anchor="start" x="633.1426" y="-572.0997" font-family="Times,serif" font-size="14.00" fill="#000000"> 如果term比follower的current_term小</text>
<text text-anchor="start" x="633.1426" y="-552.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> ，则返回自己的current_term,返回相应错误</text>
<text text-anchor="start" x="633.1426" y="-532.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> leader收到错误反馈后，转变为follower</text>
<text text-anchor="start" x="633.1426" y="-513.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 否则就重置ElectionTimer</text>
</g>
<!-- LeaderElection&#45;&gt;AppendEntities -->
<g id="edge6" class="edge">
<title>LeaderElection&#45;&gt;AppendEntities</title>
<path fill="none" stroke="#b83b5e" d="M514.9649,-666.7184C542.9391,-656.8229 579.2468,-643.9796 615.4396,-631.177"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="616.8732,-634.3824 625.1335,-627.7479 614.5387,-627.7831 616.8732,-634.3824"/>
</g>
<!-- RequestForVote -->
<g id="node8" class="node">
<title>RequestForVote</title>
<polygon fill="#95e1d3" stroke="#000000" points="1654.5215,-770.0999 1654.5215,-839.2997 1897.8232,-839.2997 1897.8232,-770.0999 1654.5215,-770.0999"/>
<text text-anchor="middle" x="1776.1724" y="-824.0997" font-family="Times,serif" font-size="14.00" fill="#000000">RequestForVote</text>
<polyline fill="none" stroke="#000000" points="1654.5215,-817.2997 1897.8232,-817.2997 "/>
<text text-anchor="start" x="1662.5215" y="-802.0997" font-family="Times,serif" font-size="14.00" fill="#000000">如果candidate收到了大多数投票</text>
<text text-anchor="start" x="1662.5215" y="-782.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 就成为了leader,开始发送AE心跳信息</text>
</g>
<!-- LeaderElection&#45;&gt;RequestForVote -->
<g id="edge7" class="edge">
<title>LeaderElection&#45;&gt;RequestForVote</title>
<path fill="none" stroke="#b83b5e" d="M514.8146,-687.6026C700.6161,-698.2626 1335.884,-734.8822 1379.0527,-739.6998 1467.9262,-749.6182 1567.2086,-765.8687 1644.2714,-779.6394"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1644.0528,-783.156 1654.5139,-781.4784 1645.2899,-776.2662 1644.0528,-783.156"/>
</g>
<!-- SplitVote -->
<g id="node9" class="node">
<title>SplitVote</title>
<polygon fill="none" stroke="#000000" points="1938.5469,-760.3 1938.5469,-849.0997 2098.0469,-849.0997 2098.0469,-760.3 1938.5469,-760.3"/>
<text text-anchor="middle" x="2018.2969" y="-833.8997" font-family="Times,serif" font-size="14.00" fill="#000000">SplitVote</text>
<polyline fill="none" stroke="#000000" points="1938.5469,-827.0997 2098.0469,-827.0997 "/>
<text text-anchor="start" x="1946.5469" y="-811.8997" font-family="Times,serif" font-size="14.00" fill="#000000">所有的candidate都</text>
<text text-anchor="start" x="1946.5469" y="-792.2998" font-family="Times,serif" font-size="14.00" fill="#000000"> 没收到marjority的投票</text>
<text text-anchor="start" x="1946.5469" y="-772.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> 需要开始新一轮的选举</text>
</g>
<!-- LeaderElection&#45;&gt;SplitVote -->
<g id="edge8" class="edge">
<title>LeaderElection&#45;&gt;SplitVote</title>
<path fill="none" stroke="#b83b5e" d="M481.4077,-703.0108C509.3275,-731.7424 567.1217,-787.7373 625.1426,-822.6998 799.2862,-927.6362 847.3231,-990.6998 1050.6396,-990.6998 1050.6396,-990.6998 1050.6396,-990.6998 1514.4253,-990.6998 1672.2162,-990.6998 1841.5614,-909.4313 1938.2427,-854.332"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1940.1565,-857.2691 1947.0825,-849.2515 1936.6684,-851.2 1940.1565,-857.2691"/>
</g>
<!-- ElectionSafty -->
<g id="node12" class="node">
<title>ElectionSafty</title>
<polygon fill="none" stroke="#000000" points="676.8667,-431.8999 676.8667,-481.4998 850.7153,-481.4998 850.7153,-431.8999 676.8667,-431.8999"/>
<text text-anchor="middle" x="763.791" y="-466.2998" font-family="Times,serif" font-size="14.00" fill="#000000">ElectionSafty</text>
<polyline fill="none" stroke="#000000" points="676.8667,-459.4998 850.7153,-459.4998 "/>
<text text-anchor="middle" x="763.791" y="-444.2998" font-family="Times,serif" font-size="14.00" fill="#000000">每个term最多有一个leader</text>
</g>
<!-- LeaderElection&#45;&gt;ElectionSafty -->
<g id="edge36" class="edge">
<title>LeaderElection&#45;&gt;ElectionSafty</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M473.9185,-666.5515C495.6843,-627.9955 552.0044,-537.6959 625.1426,-491.6998 637.8997,-483.677 652.4026,-477.491 667.106,-472.7218"/>
<polygon fill="#666666" stroke="#666666" points="668.2273,-476.0392 676.7809,-469.7873 666.1955,-469.3406 668.2273,-476.0392"/>
</g>
<!-- LeaderAppendOnly -->
<g id="node13" class="node">
<title>LeaderAppendOnly</title>
<polygon fill="none" stroke="#000000" points="367.4902,-272.0999 367.4902,-341.2997 560.7734,-341.2997 560.7734,-272.0999 367.4902,-272.0999"/>
<text text-anchor="middle" x="464.1318" y="-326.0997" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAppendOnly</text>
<polyline fill="none" stroke="#000000" points="367.4902,-319.2997 560.7734,-319.2997 "/>
<text text-anchor="start" x="375.4902" y="-304.0997" font-family="Times,serif" font-size="14.00" fill="#000000">Leader自己的日志只能append</text>
<text text-anchor="start" x="375.4902" y="-284.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 不能删除或者覆盖</text>
</g>
<!-- LogReplication&#45;&gt;LeaderAppendOnly -->
<g id="edge32" class="edge">
<title>LogReplication&#45;&gt;LeaderAppendOnly</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M303.4654,-253.2587C321.2743,-259.1823 339.746,-265.3264 357.5469,-271.2474"/>
<polygon fill="#666666" stroke="#666666" points="356.7653,-274.6759 367.3589,-274.511 358.9747,-268.0337 356.7653,-274.6759"/>
</g>
<!-- LogMatching -->
<g id="node14" class="node">
<title>LogMatching</title>
<polygon fill="none" stroke="#000000" points="342.6006,-360.6998 342.6006,-446.6998 585.6631,-446.6998 585.6631,-360.6998 342.6006,-360.6998"/>
<text text-anchor="middle" x="464.1318" y="-431.4998" font-family="Times,serif" font-size="14.00" fill="#000000">LogMatching</text>
<polyline fill="none" stroke="#000000" points="342.6006,-424.6998 585.6631,-424.6998 "/>
<text text-anchor="start" x="350.6006" y="-409.4998" font-family="Times,serif" font-size="14.00" fill="#000000">if two log contain an entry</text>
<text text-anchor="start" x="350.6006" y="-395.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> with the same index and term</text>
<text text-anchor="start" x="350.6006" y="-381.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> then the logs are identical</text>
<text text-anchor="start" x="350.6006" y="-367.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> in all entries up through the given index</text>
</g>
<!-- LogReplication&#45;&gt;LogMatching -->
<g id="edge33" class="edge">
<title>LogReplication&#45;&gt;LogMatching</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M283.3145,-262.1346C290.4363,-267.5351 297.1709,-273.3961 303.1211,-279.6998 327.4067,-305.4284 313.2643,-326.5507 339.1211,-350.6998 340.424,-351.9166 341.7589,-353.1078 343.123,-354.2738"/>
<polygon fill="#666666" stroke="#666666" points="341.2156,-357.2274 351.2323,-360.6795 345.5547,-351.7344 341.2156,-357.2274"/>
</g>
<!-- LeaderCompleteness -->
<g id="node15" class="node">
<title>LeaderCompleteness</title>
<polygon fill="none" stroke="#000000" points="389.0542,-.5 389.0542,-108.8997 539.2095,-108.8997 539.2095,-.5 389.0542,-.5"/>
<text text-anchor="middle" x="464.1318" y="-93.6997" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderCompleteness</text>
<polyline fill="none" stroke="#000000" points="389.0542,-86.8997 539.2095,-86.8997 "/>
<text text-anchor="start" x="397.0542" y="-71.6997" font-family="Times,serif" font-size="14.00" fill="#000000">如果一个log entry在某</text>
<text text-anchor="start" x="397.0542" y="-52.0997" font-family="Times,serif" font-size="14.00" fill="#000000"> 个任期内被commit了</text>
<text text-anchor="start" x="397.0542" y="-32.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 那么它会在后面的</text>
<text text-anchor="start" x="397.0542" y="-12.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> 任期中一直存在</text>
</g>
<!-- LogReplication&#45;&gt;LeaderCompleteness -->
<g id="edge34" class="edge">
<title>LogReplication&#45;&gt;LeaderCompleteness</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M261.8771,-173.0825C285.8996,-157.0862 313.4953,-139.1877 339.1211,-123.6998 352.1738,-115.811 366.1729,-107.7287 379.9097,-100.0016"/>
<polygon fill="#666666" stroke="#666666" points="381.8672,-102.917 388.8862,-94.9807 378.45,-96.8077 381.8672,-102.917"/>
</g>
<!-- StateMachineSafty -->
<g id="node16" class="node">
<title>StateMachineSafty</title>
<polygon fill="none" stroke="#000000" points="339.1211,-166.6998 339.1211,-252.6998 589.1426,-252.6998 589.1426,-166.6998 339.1211,-166.6998"/>
<text text-anchor="middle" x="464.1318" y="-237.4998" font-family="Times,serif" font-size="14.00" fill="#000000">StateMachineSafty</text>
<polyline fill="none" stroke="#000000" points="339.1211,-230.6998 589.1426,-230.6998 "/>
<text text-anchor="start" x="347.1211" y="-215.4998" font-family="Times,serif" font-size="14.00" fill="#000000">if a server has applied a log entry</text>
<text text-anchor="start" x="347.1211" y="-201.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> at a given index to its state machine</text>
<text text-anchor="start" x="347.1211" y="-187.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> no other sever will evver apply a diferent</text>
<text text-anchor="start" x="347.1211" y="-173.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> log entry for the same index</text>
</g>
<!-- LogReplication&#45;&gt;StateMachineSafty -->
<g id="edge35" class="edge">
<title>LogReplication&#45;&gt;StateMachineSafty</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M303.4654,-214.5035C311.8353,-214.2533 320.3517,-213.9987 328.876,-213.7438"/>
<polygon fill="#666666" stroke="#666666" points="328.9873,-217.2421 338.8782,-213.4447 328.778,-210.2452 328.9873,-217.2421"/>
</g>
<!-- ConsistentCheck -->
<g id="node22" class="node">
<title>ConsistentCheck</title>
<polygon fill="none" stroke="#000000" points="938.4395,-307.9001 938.4395,-463.4996 1162.8398,-463.4996 1162.8398,-307.9001 938.4395,-307.9001"/>
<text text-anchor="middle" x="1050.6396" y="-448.2996" font-family="Times,serif" font-size="14.00" fill="#000000">ConsistentCheck</text>
<polyline fill="none" stroke="#000000" points="938.4395,-441.4996 1162.8398,-441.4996 "/>
<text text-anchor="start" x="946.4395" y="-426.2996" font-family="Times,serif" font-size="14.00" fill="#000000">从新选举leader之后</text>
<text text-anchor="start" x="946.4395" y="-406.6997" font-family="Times,serif" font-size="14.00" fill="#000000"> follower上日志可能有</text>
<text text-anchor="start" x="946.4395" y="-387.0997" font-family="Times,serif" font-size="14.00" fill="#000000"> 缺失或者多余uncommited</text>
<polyline fill="none" stroke="#000000" points="938.4395,-374.6998 1162.8398,-374.6998 "/>
<text text-anchor="start" x="946.4395" y="-359.4998" font-family="Times,serif" font-size="14.00" fill="#000000">找到followerlog 和leader log共同点</text>
<text text-anchor="start" x="946.4395" y="-339.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> 从哪个点开始，删掉follower日志</text>
<text text-anchor="start" x="946.4395" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000"> leader发送之后所有日志</text>
</g>
<!-- LogReplication&#45;&gt;ConsistentCheck -->
<g id="edge17" class="edge">
<title>LogReplication&#45;&gt;ConsistentCheck</title>
<path fill="none" stroke="#666666" d="M285.2744,-173.272C302.723,-166.4022 321.1878,-160.3754 339.1211,-156.6998 447.9789,-134.3887 479.1071,-141.2083 589.1426,-156.6998 732.6023,-176.8971 776.4673,-175.1481 902.4395,-246.6998 927.8193,-261.1155 952.2753,-280.7338 973.7531,-300.6854"/>
<polygon fill="#666666" stroke="#666666" points="971.5517,-303.4209 981.2224,-307.7485 976.3612,-298.3347 971.5517,-303.4209"/>
</g>
<!-- Safty&#45;&gt;ElectionSafty -->
<g id="edge9" class="edge">
<title>Safty&#45;&gt;ElectionSafty</title>
<path fill="none" stroke="#17b978" d="M206.7925,-324.7739C226.9843,-358.3533 275.568,-429.4237 339.1211,-456.6998 444.1525,-501.7778 577.7084,-492.2602 666.7254,-477.7391"/>
<polygon fill="#17b978" stroke="#17b978" points="667.5345,-481.1522 676.8148,-476.0407 666.3725,-474.2493 667.5345,-481.1522"/>
</g>
<!-- Safty&#45;&gt;LeaderAppendOnly -->
<g id="edge10" class="edge">
<title>Safty&#45;&gt;LeaderAppendOnly</title>
<path fill="none" stroke="#17b978" d="M223.6892,-306.6998C255.0086,-306.6998 308.4577,-306.6998 357.0196,-306.6998"/>
<polygon fill="#17b978" stroke="#17b978" points="357.2983,-310.1999 367.2983,-306.6998 357.2982,-303.1999 357.2983,-310.1999"/>
</g>
<!-- Safty&#45;&gt;LogMatching -->
<g id="edge11" class="edge">
<title>Safty&#45;&gt;LogMatching</title>
<path fill="none" stroke="#17b978" d="M223.6892,-316.5345C250.4927,-326.2513 293.5042,-341.8438 335.7893,-357.1731"/>
<polygon fill="#17b978" stroke="#17b978" points="334.7695,-360.5262 345.3637,-360.644 337.1553,-353.9453 334.7695,-360.5262"/>
</g>
<!-- Safty&#45;&gt;LeaderCompleteness -->
<g id="edge12" class="edge">
<title>Safty&#45;&gt;LeaderCompleteness</title>
<path fill="none" stroke="#17b978" d="M223.8023,-304.6276C247.7804,-301.3804 282.0653,-293.0518 303.1211,-271.6998 340.7261,-233.5657 309.1065,-201.056 339.1211,-156.6998 350.5206,-139.8535 365.5117,-124.3571 381.1396,-110.8005"/>
<polygon fill="#17b978" stroke="#17b978" points="383.4578,-113.424 388.8497,-104.3037 378.9472,-108.071 383.4578,-113.424"/>
</g>
<!-- Safty&#45;&gt;StateMachineSafty -->
<g id="edge13" class="edge">
<title>Safty&#45;&gt;StateMachineSafty</title>
<path fill="none" stroke="#17b978" d="M223.8434,-298.1548C245.4485,-291.2881 276.3422,-281.2467 303.1211,-271.6998 316.6465,-266.8779 330.7523,-261.6879 344.7468,-256.4366"/>
<polygon fill="#17b978" stroke="#17b978" points="346.2859,-259.597 354.4091,-252.7951 343.8172,-253.0467 346.2859,-259.597"/>
</g>
<!-- ElectionTimeOut -->
<g id="node11" class="node">
<title>ElectionTimeOut</title>
<polygon fill="none" stroke="#000000" points="1198.8398,-749.1001 1198.8398,-924.2995 1379.0527,-924.2995 1379.0527,-749.1001 1198.8398,-749.1001"/>
<text text-anchor="middle" x="1288.9463" y="-909.0995" font-family="Times,serif" font-size="14.00" fill="#000000">ElectionTimeOut</text>
<polyline fill="none" stroke="#000000" points="1198.8398,-902.2995 1379.0527,-902.2995 "/>
<text text-anchor="start" x="1206.8398" y="-887.0995" font-family="Times,serif" font-size="14.00" fill="#000000">有一段时间没收到Leader</text>
<text text-anchor="start" x="1206.8398" y="-867.4996" font-family="Times,serif" font-size="14.00" fill="#000000"> 的AE心跳请求了</text>
<text text-anchor="start" x="1206.8398" y="-847.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> follower转变为candidate</text>
<polyline fill="none" stroke="#000000" points="1198.8398,-835.4998 1379.0527,-835.4998 "/>
<text text-anchor="start" x="1206.8398" y="-820.2998" font-family="Times,serif" font-size="14.00" fill="#000000">1.投票给自己</text>
<text text-anchor="start" x="1206.8398" y="-800.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> 2.将自己term++</text>
<text text-anchor="start" x="1206.8398" y="-781.1" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.开始向所有的</text>
<text text-anchor="start" x="1206.8398" y="-761.5" font-family="Times,serif" font-size="14.00" fill="#000000"> server发送RequestVote请求</text>
</g>
<!-- ElectionTimer&#45;&gt;ElectionTimeOut -->
<g id="edge22" class="edge">
<title>ElectionTimer&#45;&gt;ElectionTimeOut</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1077.5132,-694.7428C1104.9582,-713.1695 1149.2329,-742.8957 1190.1928,-770.3963"/>
<polygon fill="#666666" stroke="#666666" points="1188.3513,-773.3756 1198.6046,-776.0441 1192.2532,-767.564 1188.3513,-773.3756"/>
</g>
<!-- Term&#45;&gt;RequestForVote -->
<g id="edge25" class="edge">
<title>Term&#45;&gt;RequestForVote</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1591.5423,-849.1385C1608.2875,-845.1081 1626.4537,-840.7357 1644.637,-836.3591"/>
<polygon fill="#666666" stroke="#666666" points="1645.5311,-839.744 1654.4344,-834.001 1643.893,-832.9383 1645.5311,-839.744"/>
</g>
<!-- AppendEntities&#45;&gt;ElectionTimer -->
<g id="edge19" class="edge">
<title>AppendEntities&#45;&gt;ElectionTimer</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M902.594,-626.121C934.4223,-636.9949 966.5544,-647.9726 992.7117,-656.9091"/>
<polygon fill="#666666" stroke="#666666" points="991.8366,-660.3087 1002.4312,-660.2297 994.0998,-653.6846 991.8366,-660.3087"/>
</g>
<!-- MatchIndex -->
<g id="node18" class="node">
<title>MatchIndex</title>
<polygon fill="none" stroke="#000000" points="1415.0527,-388.3 1415.0527,-485.0997 1613.7979,-485.0997 1613.7979,-388.3 1415.0527,-388.3"/>
<text text-anchor="middle" x="1514.4253" y="-469.8997" font-family="Times,serif" font-size="14.00" fill="#000000">MatchIndex[]</text>
<polyline fill="none" stroke="#000000" points="1415.0527,-463.0997 1613.7979,-463.0997 "/>
<text text-anchor="start" x="1423.0527" y="-447.8997" font-family="Times,serif" font-size="14.00" fill="#000000">MatchIndex[i]表示第i个服务器</text>
<text text-anchor="start" x="1423.0527" y="-428.2998" font-family="Times,serif" font-size="14.00" fill="#000000"> 已经复制的log index</text>
<polyline fill="none" stroke="#000000" points="1415.0527,-415.8999 1613.7979,-415.8999 "/>
<text text-anchor="start" x="1423.0527" y="-400.6999" font-family="Times,serif" font-size="14.00" fill="#000000">每次leader当选时候会重置</text>
</g>
<!-- AppendEntities&#45;&gt;MatchIndex -->
<g id="edge28" class="edge">
<title>AppendEntities&#45;&gt;MatchIndex</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M902.4726,-570.4535C1028.5965,-560.451 1218.9252,-539.0574 1379.0527,-494.6998 1387.7385,-492.2937 1396.599,-489.4506 1405.4213,-486.3364"/>
<polygon fill="#666666" stroke="#666666" points="1406.7713,-489.5697 1414.9695,-482.8585 1404.3755,-482.9924 1406.7713,-489.5697"/>
</g>
<!-- NextIndex -->
<g id="node19" class="node">
<title>NextIndex</title>
<polygon fill="none" stroke="#000000" points="1200.8496,-388.3 1200.8496,-485.0997 1377.043,-485.0997 1377.043,-388.3 1200.8496,-388.3"/>
<text text-anchor="middle" x="1288.9463" y="-469.8997" font-family="Times,serif" font-size="14.00" fill="#000000">NextIndex[]</text>
<polyline fill="none" stroke="#000000" points="1200.8496,-463.0997 1377.043,-463.0997 "/>
<text text-anchor="start" x="1208.8496" y="-447.8997" font-family="Times,serif" font-size="14.00" fill="#000000">NextIndex[i]表示下一次要</text>
<text text-anchor="start" x="1208.8496" y="-428.2998" font-family="Times,serif" font-size="14.00" fill="#000000"> 发送个server i的日志index</text>
<polyline fill="none" stroke="#000000" points="1200.8496,-415.8999 1377.043,-415.8999 "/>
<text text-anchor="start" x="1208.8496" y="-400.6999" font-family="Times,serif" font-size="14.00" fill="#000000">每次leader当选时候会重置</text>
</g>
<!-- AppendEntities&#45;&gt;NextIndex -->
<g id="edge29" class="edge">
<title>AppendEntities&#45;&gt;NextIndex</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M902.4687,-542.5342C979.2912,-522.331 1076.4565,-496.5008 1162.8398,-472.6998 1171.9629,-470.1862 1181.4476,-467.5398 1190.9361,-464.8701"/>
<polygon fill="#666666" stroke="#666666" points="1192.1366,-468.1681 1200.8105,-462.0841 1190.2358,-461.4311 1192.1366,-468.1681"/>
</g>
<!-- AppendEntities&#45;&gt;ConsistentCheck -->
<g id="edge20" class="edge">
<title>AppendEntities&#45;&gt;ConsistentCheck</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M887.2252,-500.8122C892.3788,-497.4164 897.4678,-494.0357 902.4395,-490.6998 912.5634,-483.9069 923.0098,-476.7708 933.4504,-469.5501"/>
<polygon fill="#666666" stroke="#666666" points="935.5949,-472.3222 941.8159,-463.7461 931.6046,-466.5709 935.5949,-472.3222"/>
</g>
<!-- RequestForVote&#45;&gt;SplitVote -->
<g id="edge38" class="edge">
<title>RequestForVote&#45;&gt;SplitVote</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1897.944,-804.6998C1908.1699,-804.6998 1918.389,-804.6998 1928.3096,-804.6998"/>
<polygon fill="#666666" stroke="#666666" points="1928.5276,-808.1999 1938.5275,-804.6998 1928.5275,-801.1999 1928.5276,-808.1999"/>
</g>
<!-- RandomElectionTimer -->
<g id="node10" class="node">
<title>RandomElectionTimer</title>
<polygon fill="none" stroke="#000000" points="2134.0469,-661.7 2134.0469,-789.6996 2343.6816,-789.6996 2343.6816,-661.7 2134.0469,-661.7"/>
<text text-anchor="middle" x="2238.8643" y="-774.4996" font-family="Times,serif" font-size="14.00" fill="#000000">RandomElectionTimer</text>
<polyline fill="none" stroke="#000000" points="2134.0469,-767.6996 2343.6816,-767.6996 "/>
<text text-anchor="start" x="2142.0469" y="-752.4996" font-family="Times,serif" font-size="14.00" fill="#000000">为了避免几个candidate同时选举</text>
<text text-anchor="start" x="2142.0469" y="-732.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> 从而导致可能的split vote</text>
<text text-anchor="start" x="2142.0469" y="-713.2998" font-family="Times,serif" font-size="14.00" fill="#000000"> 每个candidate的electionTimer</text>
<text text-anchor="start" x="2142.0469" y="-693.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> electionTime有个随机值</text>
<text text-anchor="start" x="2142.0469" y="-674.1" font-family="Times,serif" font-size="14.00" fill="#000000"> 避免几个candidate同时选举</text>
</g>
<!-- SplitVote&#45;&gt;RandomElectionTimer -->
<g id="edge26" class="edge">
<title>SplitVote&#45;&gt;RandomElectionTimer</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M2098.2386,-776.0673C2106.7492,-773.0191 2115.5212,-769.8772 2124.3295,-766.7224"/>
<polygon fill="#666666" stroke="#666666" points="2125.6567,-769.9648 2133.8909,-763.2978 2123.2963,-763.3748 2125.6567,-769.9648"/>
</g>
<!-- RandomElectionTimer&#45;&gt;ElectionTimer -->
<g id="edge21" class="edge">
<title>RandomElectionTimer&#45;&gt;ElectionTimer</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M2133.9682,-708.9308C2040.3885,-695.4331 1899.5055,-678.6998 1776.1724,-678.6998 1514.4253,-678.6998 1514.4253,-678.6998 1514.4253,-678.6998 1368.6211,-678.6998 1197.0355,-677.6992 1109.0925,-677.1135"/>
<polygon fill="#666666" stroke="#666666" points="1109.07,-673.6133 1099.0466,-677.0459 1109.0228,-680.6132 1109.07,-673.6133"/>
</g>
<!-- ElectionTimeOut&#45;&gt;Term -->
<g id="edge24" class="edge">
<title>ElectionTimeOut&#45;&gt;Term</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1379.358,-849.1301C1395.1372,-851.2995 1411.5243,-853.5525 1427.215,-855.7097"/>
<polygon fill="#666666" stroke="#666666" points="1427.0285,-859.2169 1437.4121,-857.1117 1427.982,-852.2822 1427.0285,-859.2169"/>
</g>
<!-- ElectionTimeOut&#45;&gt;RequestForVote -->
<g id="edge23" class="edge">
<title>ElectionTimeOut&#45;&gt;RequestForVote</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1379.1367,-826.8476C1391.2033,-825.692 1403.4228,-824.6047 1415.0527,-823.6998 1490.8119,-817.8056 1575.6577,-813.2377 1644.0627,-810.0596"/>
<polygon fill="#666666" stroke="#666666" points="1644.6353,-813.537 1654.4639,-809.5811 1644.3136,-806.5444 1644.6353,-813.537"/>
</g>
<!-- SameTermIndexSameCommand -->
<g id="node20" class="node">
<title>SameTermIndexSameCommand</title>
<polygon fill="none" stroke="#000000" points="660.334,-344.0999 660.334,-413.2997 867.248,-413.2997 867.248,-344.0999 660.334,-344.0999"/>
<text text-anchor="start" x="668.334" y="-398.0997" font-family="Times,serif" font-size="14.00" fill="#000000">SameTermIndexSameCommand</text>
<polyline fill="none" stroke="#000000" points="660.334,-391.2997 867.248,-391.2997 "/>
<text text-anchor="start" x="668.334" y="-376.0997" font-family="Times,serif" font-size="14.00" fill="#000000">如果log entry的index和term一样</text>
<text text-anchor="start" x="668.334" y="-356.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 那么他的command也一样</text>
</g>
<!-- LogMatching&#45;&gt;SameTermIndexSameCommand -->
<g id="edge15" class="edge">
<title>LogMatching&#45;&gt;SameTermIndexSameCommand</title>
<path fill="none" stroke="#666666" d="M586.0147,-393.5314C607.1806,-391.7655 629.118,-389.9353 650.0554,-388.1886"/>
<polygon fill="#666666" stroke="#666666" points="650.5714,-391.6578 660.2457,-387.3384 649.9893,-384.682 650.5714,-391.6578"/>
</g>
<!-- SamePrecedingEntries -->
<g id="node21" class="node">
<title>SamePrecedingEntries</title>
<polygon fill="none" stroke="#000000" points="626.8857,-256.0999 626.8857,-325.2997 900.6963,-325.2997 900.6963,-256.0999 626.8857,-256.0999"/>
<text text-anchor="middle" x="763.791" y="-310.0997" font-family="Times,serif" font-size="14.00" fill="#000000">SamePrecedingEntries</text>
<polyline fill="none" stroke="#000000" points="626.8857,-303.2997 900.6963,-303.2997 "/>
<text text-anchor="start" x="634.8857" y="-288.0997" font-family="Times,serif" font-size="14.00" fill="#000000">如果log entry的index和term一样</text>
<text text-anchor="start" x="634.8857" y="-268.4998" font-family="Times,serif" font-size="14.00" fill="#000000"> 那么该log entry之前的所有log entry也一样</text>
</g>
<!-- LogMatching&#45;&gt;SamePrecedingEntries -->
<g id="edge16" class="edge">
<title>LogMatching&#45;&gt;SamePrecedingEntries</title>
<path fill="none" stroke="#666666" d="M566.1889,-360.6023C573.9629,-357.2672 581.6826,-353.9387 589.1426,-350.6998 605.2033,-343.7268 608.773,-340.913 625.1426,-334.6998 630.5121,-332.6618 636.0218,-330.6386 641.6044,-328.6437"/>
<polygon fill="#666666" stroke="#666666" points="642.7866,-331.9382 651.0565,-325.3156 640.4617,-325.3355 642.7866,-331.9382"/>
</g>
<!-- LeaderCommitIndex -->
<g id="node17" class="node">
<title>LeaderCommitIndex</title>
<polygon fill="none" stroke="#000000" points="1649.7979,-120.7 1649.7979,-298.6996 1902.5469,-298.6996 1902.5469,-120.7 1649.7979,-120.7"/>
<text text-anchor="middle" x="1776.1724" y="-283.4996" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderCommitIndex</text>
<polyline fill="none" stroke="#000000" points="1649.7979,-276.6996 1902.5469,-276.6996 "/>
<text text-anchor="start" x="1657.7979" y="-261.4996" font-family="Times,serif" font-size="14.00" fill="#000000">Commited定义:</text>
<text text-anchor="start" x="1657.7979" y="-241.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> the leader decides when it is safe to apply</text>
<text text-anchor="start" x="1657.7979" y="-227.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> a log entry to the state machines</text>
<text text-anchor="start" x="1657.7979" y="-213.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> such an entry is called committed</text>
<text text-anchor="start" x="1657.7979" y="-199.8997" font-family="Times,serif" font-size="14.00" fill="#000000"> 日志entry被put到major follower上了</text>
<polyline fill="none" stroke="#000000" points="1649.7979,-187.4998 1902.5469,-187.4998 "/>
<text text-anchor="start" x="1657.7979" y="-172.2998" font-family="Times,serif" font-size="14.00" fill="#000000">每次AE请求中带了LeaderCommitIndex</text>
<text text-anchor="start" x="1657.7979" y="-152.6999" font-family="Times,serif" font-size="14.00" fill="#000000"> follower发现log entry被commit了</text>
<text text-anchor="start" x="1657.7979" y="-133.1" font-family="Times,serif" font-size="14.00" fill="#000000"> 才会apply到state machine上</text>
</g>
<!-- LeaderCompleteness&#45;&gt;LeaderCommitIndex -->
<g id="edge27" class="edge">
<title>LeaderCompleteness&#45;&gt;LeaderCommitIndex</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M539.5518,-59.5494C651.1723,-66.2974 866.9603,-77.6998 1050.6396,-77.6998 1050.6396,-77.6998 1050.6396,-77.6998 1288.9463,-77.6998 1410.7589,-77.6998 1543.9283,-116.6134 1640.2116,-152.184"/>
<polygon fill="#666666" stroke="#666666" points="1639.1131,-155.5097 1649.7057,-155.7248 1641.5592,-148.951 1639.1131,-155.5097"/>
</g>
<!-- StateMachineSafty&#45;&gt;LeaderCommitIndex -->
<g id="edge14" class="edge">
<title>StateMachineSafty&#45;&gt;LeaderCommitIndex</title>
<path fill="none" stroke="#666666" d="M589.4123,-209.6998C708.162,-209.6998 891.5392,-209.6998 1050.6396,-209.6998 1050.6396,-209.6998 1050.6396,-209.6998 1288.9463,-209.6998 1407.3043,-209.6998 1541.8353,-209.6998 1639.5009,-209.6998"/>
<polygon fill="#666666" stroke="#666666" points="1639.7291,-213.1999 1649.729,-209.6998 1639.729,-206.1999 1639.7291,-213.1999"/>
</g>
<!-- MatchIndex&#45;&gt;LeaderCommitIndex -->
<g id="edge31" class="edge">
<title>MatchIndex&#45;&gt;LeaderCommitIndex</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1570.2556,-388.2811C1598.0551,-364.1719 1632.6777,-334.1455 1665.5529,-305.6345"/>
<polygon fill="#666666" stroke="#666666" points="1668.1599,-308.0065 1673.4214,-298.8105 1663.5736,-302.7182 1668.1599,-308.0065"/>
</g>
<!-- NextIndex&#45;&gt;MatchIndex -->
<g id="edge30" class="edge">
<title>NextIndex&#45;&gt;MatchIndex</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1377.0911,-436.6998C1386.1618,-436.6998 1395.4558,-436.6998 1404.7225,-436.6998"/>
<polygon fill="#666666" stroke="#666666" points="1404.7552,-440.1999 1414.7552,-436.6998 1404.7551,-433.1999 1404.7552,-440.1999"/>
</g>
<!-- SameTermIndexSameCommand&#45;&gt;ConsistentCheck -->
<g id="edge37" class="edge">
<title>SameTermIndexSameCommand&#45;&gt;ConsistentCheck</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M867.35,-381.227C886.9815,-381.7061 907.6954,-382.2115 927.8538,-382.7035"/>
<polygon fill="#666666" stroke="#666666" points="927.9332,-386.2064 938.0156,-382.9515 928.104,-379.2084 927.9332,-386.2064"/>
</g>
<!-- ConsistentCheck&#45;&gt;NextIndex -->
<g id="edge18" class="edge">
<title>ConsistentCheck&#45;&gt;NextIndex</title>
<path fill="none" stroke="#666666" d="M1163.1635,-409.781C1172.3676,-411.7508 1181.6247,-413.7319 1190.714,-415.6771"/>
<polygon fill="#666666" stroke="#666666" points="1189.9897,-419.1013 1200.5007,-417.7716 1191.4546,-412.2563 1189.9897,-419.1013"/>
</g>
</g>
</svg>
