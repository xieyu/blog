<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: atomic_flush Pages: 1 -->
<svg width="1896pt" height="238pt"
 viewBox="0.00 0.00 1896.25 238.04" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 234.0381)">
<title>atomic_flush</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-234.0381 1892.248,-234.0381 1892.248,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_CompactionPicker</title>
<polygon fill="none" stroke="#000000" points="859.9111,-34.0381 859.9111,-222.0381 1644.334,-222.0381 1644.334,-34.0381 859.9111,-34.0381"/>
<text text-anchor="middle" x="1252.1226" y="-202.0381" font-family="Times,serif" font-size="20.00" fill="#000000">CompactionPicker</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_ColumnFamilyData</title>
<polygon fill="none" stroke="#000000" points="665.5869,-56.0381 665.5869,-136.0381 839.9111,-136.0381 839.9111,-56.0381 665.5869,-56.0381"/>
<text text-anchor="middle" x="752.749" y="-116.0381" font-family="Times,serif" font-size="20.00" fill="#000000">ColumnFamilyData</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_CompactionJob</title>
<polygon fill="none" stroke="#000000" points="1664.334,-34.0381 1664.334,-212.0381 1880.248,-212.0381 1880.248,-34.0381 1664.334,-34.0381"/>
<text text-anchor="middle" x="1772.291" y="-192.0381" font-family="Times,serif" font-size="20.00" fill="#000000">CompactionJob</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_DBImpl</title>
<polygon fill="none" stroke="#000000" points="8,-34.0381 8,-222.0381 645.5869,-222.0381 645.5869,-34.0381 8,-34.0381"/>
<text text-anchor="middle" x="326.7935" y="-202.0381" font-family="Times,serif" font-size="20.00" fill="#000000">DBImpl</text>
</g>
<!-- CompactionPicker_PickCompaction -->
<g id="node1" class="node">
<title>CompactionPicker_PickCompaction</title>
<polygon fill="none" stroke="#000000" points="1088.1983,-116.0381 868.1484,-116.0381 868.1484,-80.0381 1088.1983,-80.0381 1088.1983,-116.0381"/>
<text text-anchor="middle" x="978.1733" y="-93.8381" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionPicker_PickCompaction</text>
</g>
<!-- FIFOCompactionPicker -->
<g id="node2" class="node">
<title>FIFOCompactionPicker</title>
<polygon fill="none" stroke="#000000" points="1286.7951,-186.0381 1136.7039,-186.0381 1136.7039,-150.0381 1286.7951,-150.0381 1286.7951,-186.0381"/>
<text text-anchor="middle" x="1211.7495" y="-163.8381" font-family="Times,serif" font-size="14.00" fill="#000000">FIFOCompactionPicker</text>
</g>
<!-- CompactionPicker_PickCompaction&#45;&gt;FIFOCompactionPicker -->
<g id="edge1" class="edge">
<title>CompactionPicker_PickCompaction&#45;&gt;FIFOCompactionPicker</title>
<path fill="none" stroke="#666666" d="M1038.325,-116.0649C1069.8069,-125.4996 1108.5335,-137.1055 1141.3992,-146.955"/>
<polygon fill="#666666" stroke="#666666" points="1140.8123,-150.4328 1151.3962,-149.951 1142.8219,-143.7275 1140.8123,-150.4328"/>
</g>
<!-- LevelCompactionPicker -->
<g id="node3" class="node">
<title>LevelCompactionPicker</title>
<polygon fill="none" stroke="#000000" points="1287.8189,-78.0381 1135.6802,-78.0381 1135.6802,-42.0381 1287.8189,-42.0381 1287.8189,-78.0381"/>
<text text-anchor="middle" x="1211.7495" y="-55.8381" font-family="Times,serif" font-size="14.00" fill="#000000">LevelCompactionPicker</text>
</g>
<!-- CompactionPicker_PickCompaction&#45;&gt;LevelCompactionPicker -->
<g id="edge2" class="edge">
<title>CompactionPicker_PickCompaction&#45;&gt;LevelCompactionPicker</title>
<path fill="none" stroke="#666666" d="M1088.4635,-80.0953C1100.9215,-78.0685 1113.4784,-76.0257 1125.5648,-74.0593"/>
<polygon fill="#666666" stroke="#666666" points="1126.2861,-77.4881 1135.5943,-72.4277 1125.162,-70.5789 1126.2861,-77.4881"/>
</g>
<!-- UniversalCompactionPicker -->
<g id="node4" class="node">
<title>UniversalCompactionPicker</title>
<polygon fill="none" stroke="#000000" points="1298.8778,-132.0381 1124.6212,-132.0381 1124.6212,-96.0381 1298.8778,-96.0381 1298.8778,-132.0381"/>
<text text-anchor="middle" x="1211.7495" y="-109.8381" font-family="Times,serif" font-size="14.00" fill="#000000">UniversalCompactionPicker</text>
</g>
<!-- CompactionPicker_PickCompaction&#45;&gt;UniversalCompactionPicker -->
<g id="edge3" class="edge">
<title>CompactionPicker_PickCompaction&#45;&gt;UniversalCompactionPicker</title>
<path fill="none" stroke="#666666" d="M1088.4635,-105.593C1097.0291,-106.1798 1105.6414,-106.7697 1114.1154,-107.3502"/>
<polygon fill="#666666" stroke="#666666" points="1114.155,-110.861 1124.3708,-108.0527 1114.6334,-103.8774 1114.155,-110.861"/>
</g>
<!-- Compaction -->
<g id="node5" class="node">
<title>Compaction</title>
<polygon fill="#95e1d3" stroke="#000000" points="1335.0635,-54.2382 1335.0635,-167.8381 1636.334,-167.8381 1636.334,-54.2382 1335.0635,-54.2382"/>
<text text-anchor="middle" x="1485.6987" y="-152.6381" font-family="Times,serif" font-size="14.00" fill="#000000">Compaction</text>
<polyline fill="none" stroke="#000000" points="1335.0635,-145.8381 1636.334,-145.8381 "/>
<text text-anchor="start" x="1343.0635" y="-130.6381" font-family="Times,serif" font-size="14.00" fill="#000000">包含了要compaction的一些metadata</text>
<polyline fill="none" stroke="#000000" points="1335.0635,-118.2382 1636.334,-118.2382 "/>
<text text-anchor="start" x="1343.0635" y="-103.0382" font-family="Times,serif" font-size="14.00" fill="#000000">const int start_level_;</text>
<text text-anchor="start" x="1343.0635" y="-89.0382" font-family="Times,serif" font-size="14.00" fill="#000000"> const int output_level_;</text>
<text text-anchor="start" x="1343.0635" y="-75.0382" font-family="Times,serif" font-size="14.00" fill="#000000"> VersionStorageInfo* input_vstorage_;</text>
<text text-anchor="middle" x="1485.6987" y="-61.0382" font-family="Times,serif" font-size="14.00" fill="#000000"> const std::vector&lt;CompactionInputFiles&gt; inputs_;</text>
</g>
<!-- FIFOCompactionPicker&#45;&gt;Compaction -->
<g id="edge4" class="edge">
<title>FIFOCompactionPicker&#45;&gt;Compaction</title>
<path fill="none" stroke="#666666" d="M1286.9697,-152.3873C1298.9609,-149.8923 1311.7508,-147.2311 1324.8409,-144.5075"/>
<polygon fill="#666666" stroke="#666666" points="1325.8239,-147.878 1334.9013,-142.4142 1324.3979,-141.0248 1325.8239,-147.878"/>
</g>
<!-- LevelCompactionPicker&#45;&gt;Compaction -->
<g id="edge5" class="edge">
<title>LevelCompactionPicker&#45;&gt;Compaction</title>
<path fill="none" stroke="#666666" d="M1288.0596,-74.2445C1299.6775,-76.4073 1312.0251,-78.706 1324.6545,-81.0572"/>
<polygon fill="#666666" stroke="#666666" points="1324.3632,-84.563 1334.8349,-82.9525 1325.6444,-77.6813 1324.3632,-84.563"/>
</g>
<!-- UniversalCompactionPicker&#45;&gt;Compaction -->
<g id="edge6" class="edge">
<title>UniversalCompactionPicker&#45;&gt;Compaction</title>
<path fill="none" stroke="#666666" d="M1299.182,-113.0807C1307.3979,-112.9907 1315.8888,-112.8977 1324.5118,-112.8033"/>
<polygon fill="#666666" stroke="#666666" points="1324.7257,-116.3013 1334.6867,-112.6919 1324.6489,-109.3017 1324.7257,-116.3013"/>
</g>
<!-- CompactionJob -->
<g id="node7" class="node">
<title>CompactionJob</title>
<polygon fill="#95e1d3" stroke="#000000" points="1672.334,-43.0381 1672.334,-175.0381 1872.248,-175.0381 1872.248,-43.0381 1672.334,-43.0381"/>
<text text-anchor="start" x="1680.334" y="-159.8381" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionJob</text>
<polyline fill="none" stroke="#000000" points="1672.334,-153.0381 1872.248,-153.0381 "/>
<text text-anchor="start" x="1680.334" y="-137.8381" font-family="Times,serif" font-size="14.00" fill="#000000">const std::string&amp; dbname_;</text>
<polyline fill="none" stroke="#000000" points="1672.334,-131.0381 1872.248,-131.0381 "/>
<text text-anchor="start" x="1680.334" y="-115.8381" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionState* compact_;</text>
<polyline fill="none" stroke="#000000" points="1672.334,-109.0381 1872.248,-109.0381 "/>
<text text-anchor="start" x="1680.334" y="-93.8381" font-family="Times,serif" font-size="14.00" fill="#000000">FSDirectory* output_directory_;</text>
<polyline fill="none" stroke="#000000" points="1672.334,-87.0381 1872.248,-87.0381 "/>
<text text-anchor="start" x="1680.334" y="-71.8381" font-family="Times,serif" font-size="14.00" fill="#000000">VersionSet* versions_;</text>
<polyline fill="none" stroke="#000000" points="1672.334,-65.0381 1872.248,-65.0381 "/>
<text text-anchor="middle" x="1772.291" y="-49.8381" font-family="Times,serif" font-size="14.00" fill="#000000">...</text>
</g>
<!-- Compaction&#45;&gt;CompactionJob -->
<g id="edge16" class="edge">
<title>Compaction&#45;&gt;CompactionJob</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1636.5484,-109.9854C1645.0809,-109.9259 1653.5776,-109.8666 1661.917,-109.8084"/>
<polygon fill="#666666" stroke="#666666" points="1662.0278,-113.3078 1672.0031,-109.738 1661.9788,-106.308 1662.0278,-113.3078"/>
</g>
<!-- PickCompaction -->
<g id="node6" class="node">
<title>PickCompaction</title>
<polygon fill="none" stroke="#000000" points="807.0737,-100.0381 697.4243,-100.0381 697.4243,-64.0381 807.0737,-64.0381 807.0737,-100.0381"/>
<text text-anchor="middle" x="752.249" y="-77.8381" font-family="Times,serif" font-size="14.00" fill="#000000">PickCompaction</text>
</g>
<!-- PickCompaction&#45;&gt;CompactionPicker_PickCompaction -->
<g id="edge7" class="edge">
<title>PickCompaction&#45;&gt;CompactionPicker_PickCompaction</title>
<path fill="none" stroke="#666666" d="M806.939,-85.9113C822.3315,-87.0014 839.7118,-88.2323 857.3489,-89.4813"/>
<polygon fill="#666666" stroke="#666666" points="857.5277,-93.0027 867.75,-90.2179 858.0222,-86.0202 857.5277,-93.0027"/>
</g>
<!-- MaybeScheduleFlushOrCompaction -->
<g id="node8" class="node">
<title>MaybeScheduleFlushOrCompaction</title>
<polygon fill="none" stroke="#000000" points="16,-120.2382 16,-169.8381 236.5244,-169.8381 236.5244,-120.2382 16,-120.2382"/>
<text text-anchor="middle" x="126.2622" y="-154.6381" font-family="Times,serif" font-size="14.00" fill="#000000">MaybeScheduleFlushOrCompaction</text>
<polyline fill="none" stroke="#000000" points="16,-147.8381 236.5244,-147.8381 "/>
<text text-anchor="start" x="24" y="-132.6381" font-family="Times,serif" font-size="14.00" fill="#000000">触发后台线程compact</text>
</g>
<!-- BackgroundCompaction -->
<g id="node9" class="node">
<title>BackgroundCompaction</title>
<polygon fill="none" stroke="#000000" points="425.3179,-127.0381 272.5932,-127.0381 272.5932,-91.0381 425.3179,-91.0381 425.3179,-127.0381"/>
<text text-anchor="middle" x="348.9556" y="-104.8381" font-family="Times,serif" font-size="14.00" fill="#000000">BackgroundCompaction</text>
</g>
<!-- MaybeScheduleFlushOrCompaction&#45;&gt;BackgroundCompaction -->
<g id="edge8" class="edge">
<title>MaybeScheduleFlushOrCompaction&#45;&gt;BackgroundCompaction</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M236.6303,-127.1963C245.356,-125.7858 254.0897,-124.3739 262.6171,-122.9954"/>
<polygon fill="#666666" stroke="#666666" points="263.2065,-126.4456 272.5198,-121.3945 262.0894,-119.5353 263.2065,-126.4456"/>
</g>
<!-- BackgroundCompaction&#45;&gt;CompactionJob -->
<g id="edge9" class="edge">
<title>BackgroundCompaction&#45;&gt;CompactionJob</title>
<path fill="none" stroke="#b83b5e" d="M368.6935,-90.8227C389.8447,-72.5506 425.276,-45.3998 461.3867,-33.0381 583.9517,8.9191 622.7014,-14.0381 752.249,-14.0381 752.249,-14.0381 752.249,-14.0381 1211.7495,-14.0381 1404.1407,-14.0381 1460.2559,25.9052 1644.334,-30.0381 1652.0591,-32.3859 1659.7851,-35.3193 1667.399,-38.6626"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1666.078,-41.9078 1676.6232,-42.9321 1669.0184,-35.5553 1666.078,-41.9078"/>
</g>
<!-- PickCompactionFromQueue -->
<g id="node10" class="node">
<title>PickCompactionFromQueue</title>
<polygon fill="none" stroke="#000000" points="637.6871,-78.0381 461.2865,-78.0381 461.2865,-42.0381 637.6871,-42.0381 637.6871,-78.0381"/>
<text text-anchor="middle" x="549.4868" y="-55.8381" font-family="Times,serif" font-size="14.00" fill="#000000">PickCompactionFromQueue</text>
</g>
<!-- BackgroundCompaction&#45;&gt;PickCompactionFromQueue -->
<g id="edge10" class="edge">
<title>BackgroundCompaction&#45;&gt;PickCompactionFromQueue</title>
<path fill="none" stroke="#b83b5e" d="M422.7717,-91.0011C436.7451,-87.5867 451.4567,-83.9919 465.7111,-80.5088"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="466.6084,-83.8926 475.4917,-78.1189 464.9467,-77.0927 466.6084,-83.8926"/>
</g>
<!-- CompactionJob_Prepare -->
<g id="node11" class="node">
<title>CompactionJob_Prepare</title>
<polygon fill="none" stroke="#000000" points="626.122,-186.0381 472.8516,-186.0381 472.8516,-150.0381 626.122,-150.0381 626.122,-186.0381"/>
<text text-anchor="middle" x="549.4868" y="-163.8381" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionJob_Prepare</text>
</g>
<!-- BackgroundCompaction&#45;&gt;CompactionJob_Prepare -->
<g id="edge11" class="edge">
<title>BackgroundCompaction&#45;&gt;CompactionJob_Prepare</title>
<path fill="none" stroke="#b83b5e" d="M410.2112,-127.0607C431.7828,-133.4075 456.2086,-140.594 478.514,-147.1566"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="477.6798,-150.5595 488.2611,-150.0244 479.6556,-143.8441 477.6798,-150.5595"/>
</g>
<!-- CompactionJob_Run -->
<g id="node12" class="node">
<title>CompactionJob_Run</title>
<polygon fill="none" stroke="#000000" points="616.7077,-132.0381 482.2659,-132.0381 482.2659,-96.0381 616.7077,-96.0381 616.7077,-132.0381"/>
<text text-anchor="middle" x="549.4868" y="-109.8381" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionJob_Run</text>
</g>
<!-- BackgroundCompaction&#45;&gt;CompactionJob_Run -->
<g id="edge12" class="edge">
<title>BackgroundCompaction&#45;&gt;CompactionJob_Run</title>
<path fill="none" stroke="#b83b5e" d="M425.3399,-110.9427C440.5381,-111.3216 456.5137,-111.72 471.7564,-112.1"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="472.0893,-115.6093 482.1735,-112.3598 472.2639,-108.6115 472.0893,-115.6093"/>
</g>
<!-- PickCompactionFromQueue&#45;&gt;PickCompaction -->
<g id="edge15" class="edge">
<title>PickCompactionFromQueue&#45;&gt;PickCompaction</title>
<path fill="none" stroke="#666666" d="M637.8314,-69.6237C654.4646,-71.4284 671.5739,-73.2848 687.328,-74.9941"/>
<polygon fill="#666666" stroke="#666666" points="687.1471,-78.495 697.4663,-76.0941 687.9022,-71.5358 687.1471,-78.495"/>
</g>
<!-- compaction_queue_ -->
<g id="node13" class="node">
<title>compaction_queue_</title>
<polygon fill="none" stroke="#000000" points="22.4873,-43.0381 22.4873,-101.0381 230.0371,-101.0381 230.0371,-43.0381 22.4873,-43.0381"/>
<text text-anchor="middle" x="126.2622" y="-85.8381" font-family="Times,serif" font-size="14.00" fill="#000000">compaction_queue_</text>
<polyline fill="none" stroke="#000000" points="22.4873,-79.0381 230.0371,-79.0381 "/>
<text text-anchor="start" x="30.4873" y="-63.8381" font-family="Times,serif" font-size="14.00" fill="#000000">std::deque&lt;ColumnFamilyData*&gt;</text>
<text text-anchor="start" x="30.4873" y="-49.8381" font-family="Times,serif" font-size="14.00" fill="#000000"> compaction_queue_;</text>
</g>
<!-- compaction_queue_&#45;&gt;BackgroundCompaction -->
<g id="edge13" class="edge">
<title>compaction_queue_&#45;&gt;BackgroundCompaction</title>
<path fill="none" stroke="#666666" d="M230.1111,-89.2924C240.9383,-91.0913 251.8605,-92.906 262.4656,-94.668"/>
<polygon fill="#666666" stroke="#666666" points="262.0844,-98.1526 272.5229,-96.339 263.2318,-91.2473 262.0844,-98.1526"/>
</g>
<!-- compaction_queue_&#45;&gt;PickCompactionFromQueue -->
<g id="edge14" class="edge">
<title>compaction_queue_&#45;&gt;PickCompactionFromQueue</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M230.0655,-69.0949C297.4567,-67.1841 384.7521,-64.709 451.049,-62.8292"/>
<polygon fill="#666666" stroke="#666666" points="451.1907,-66.3267 461.0874,-62.5446 450.9922,-59.3295 451.1907,-66.3267"/>
</g>
</g>
</svg>
