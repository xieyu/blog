<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: leveled_compaction_overview Pages: 1 -->
<svg width="2723pt" height="711pt"
 viewBox="0.00 0.00 2723.00 711.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 707)">
<title>leveled_compaction_overview</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-707 2719,-707 2719,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_VersionStorageInfo</title>
<polygon fill="none" stroke="#000000" points="590.5,-72 590.5,-208 763.5,-208 763.5,-72 590.5,-72"/>
<text text-anchor="middle" x="677" y="-188" font-family="Times,serif" font-size="20.00" fill="#000000">VersionStorageInfo</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Compaction</title>
<polygon fill="none" stroke="#000000" points="2400,-8 2400,-208 2707,-208 2707,-8 2400,-8"/>
<text text-anchor="middle" x="2553.5" y="-188" font-family="Times,serif" font-size="20.00" fill="#000000">Compaction</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_LevelCompactionBuilder</title>
<polygon fill="none" stroke="#000000" points="229,-216 229,-695 2643.5,-695 2643.5,-216 229,-216"/>
<text text-anchor="middle" x="1436.25" y="-675" font-family="Times,serif" font-size="20.00" fill="#000000">LevelCompactionBuilder</text>
</g>
<g id="clust13" class="cluster">
<title>cluster_LevelCompactionPicker</title>
<polygon fill="none" stroke="#000000" points="0,-600 0,-682 209,-682 209,-600 0,-600"/>
<text text-anchor="middle" x="104.5" y="-662" font-family="Times,serif" font-size="20.00" fill="#000000">LevelCompactionPicker</text>
</g>
<!-- CompactionScoreLevel -->
<g id="node1" class="node">
<title>CompactionScoreLevel</title>
<polygon fill="none" stroke="#000000" points="749.5,-170 604.5,-170 604.5,-134 749.5,-134 749.5,-170"/>
<text text-anchor="middle" x="677" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionScoreLevel</text>
</g>
<!-- start_level_ -->
<g id="node21" class="node">
<title>start_level_</title>
<polygon fill="none" stroke="#000000" points="869.5,-224 869.5,-270 1015.5,-270 1015.5,-224 869.5,-224"/>
<text text-anchor="middle" x="942.5" y="-254.8" font-family="Times,serif" font-size="14.00" fill="#000000">start_level_</text>
<polyline fill="none" stroke="#000000" points="869.5,-247 1015.5,-247 "/>
<text text-anchor="middle" x="942.5" y="-231.8" font-family="Times,serif" font-size="14.00" fill="#000000">确定要compact的level</text>
</g>
<!-- CompactionScoreLevel&#45;&gt;start_level_ -->
<g id="edge25" class="edge">
<title>CompactionScoreLevel&#45;&gt;start_level_</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M727.5635,-170.0924C767.3714,-184.3363 823.4353,-204.3968 868.3231,-220.4584"/>
<polygon fill="#666666" stroke="#666666" points="867.4182,-223.8518 878.0128,-223.9255 869.7765,-217.261 867.4182,-223.8518"/>
</g>
<!-- CompactionScore -->
<g id="node2" class="node">
<title>CompactionScore</title>
<polygon fill="none" stroke="#000000" points="734,-116 620,-116 620,-80 734,-80 734,-116"/>
<text text-anchor="middle" x="677" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#000000">CompactionScore</text>
</g>
<!-- CompactionScore&#45;&gt;start_level_ -->
<g id="edge26" class="edge">
<title>CompactionScore&#45;&gt;start_level_</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M734.1401,-105.1279C754.6884,-109.1518 777.5741,-115.3865 797,-125 843.1806,-147.8539 887.2096,-188.2805 914.4987,-216.3016"/>
<polygon fill="#666666" stroke="#666666" points="912.2916,-219.0568 921.7396,-223.8512 917.3435,-214.2114 912.2916,-219.0568"/>
</g>
<!-- Compaction -->
<g id="node3" class="node">
<title>Compaction</title>
<polygon fill="#95e1d3" stroke="#000000" points="2408,-16.5 2408,-169.5 2699,-169.5 2699,-16.5 2408,-16.5"/>
<text text-anchor="middle" x="2553.5" y="-154.3" font-family="Times,serif" font-size="14.00" fill="#000000">Compaction</text>
<polyline fill="none" stroke="#000000" points="2408,-146.5 2699,-146.5 "/>
<text text-anchor="start" x="2416" y="-131.3" font-family="Times,serif" font-size="14.00" fill="#000000">VersionStorageInfo* input_vstorage_;</text>
<polyline fill="none" stroke="#000000" points="2408,-123.5 2699,-123.5 "/>
<text text-anchor="start" x="2416" y="-108.3" font-family="Times,serif" font-size="14.00" fill="#000000">const int start_level_;</text>
<polyline fill="none" stroke="#000000" points="2408,-100.5 2699,-100.5 "/>
<text text-anchor="start" x="2416" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#000000">const int output_level_;</text>
<polyline fill="none" stroke="#000000" points="2408,-77.5 2699,-77.5 "/>
<text text-anchor="start" x="2416" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#000000">ColumnFamilyData* cfd_;</text>
<polyline fill="none" stroke="#000000" points="2408,-54.5 2699,-54.5 "/>
<text text-anchor="start" x="2416" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#000000">const std::vector&lt;CompactionInputFiles&gt; inputs_;</text>
<text text-anchor="start" x="2416" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#000000"> std::vector&lt;FileMetaData*&gt; grandparents_;</text>
</g>
<!-- LevelCompactionBuilder_PickCompaction -->
<g id="node4" class="node">
<title>LevelCompactionBuilder_PickCompaction</title>
<polygon fill="none" stroke="#000000" points="237,-608 237,-644 344,-644 344,-608 237,-608"/>
<text text-anchor="middle" x="290.5" y="-622.3" font-family="Times,serif" font-size="14.00" fill="#000000">PickCompaction</text>
</g>
<!-- SetupOtherL0FilesIfNeeded -->
<g id="node5" class="node">
<title>SetupOtherL0FilesIfNeeded</title>
<polygon fill="none" stroke="#000000" points="1088,-525.5 1088,-616.5 1330,-616.5 1330,-525.5 1088,-525.5"/>
<text text-anchor="middle" x="1209" y="-601.3" font-family="Times,serif" font-size="14.00" fill="#000000">SetupOtherL0FilesIfNeeded</text>
<polyline fill="none" stroke="#000000" points="1088,-593.5 1330,-593.5 "/>
<text text-anchor="start" x="1096" y="-578.3" font-family="Times,serif" font-size="14.00" fill="#000000">如果start_level_为0 </text>
<text text-anchor="start" x="1096" y="-563.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 且output level不为0</text>
<text text-anchor="start" x="1096" y="-548.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 选择level0中其他和start_level_inputs_</text>
<text text-anchor="start" x="1096" y="-533.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 重叠的file</text>
</g>
<!-- LevelCompactionBuilder_PickCompaction&#45;&gt;SetupOtherL0FilesIfNeeded -->
<g id="edge1" class="edge">
<title>LevelCompactionBuilder_PickCompaction&#45;&gt;SetupOtherL0FilesIfNeeded</title>
<path fill="none" stroke="#b83b5e" d="M344.1395,-624.6347C436.6317,-622.112 632.0807,-616.0423 797,-606 910.5068,-599.0884 938.6989,-594.7169 1052,-585 1060.3286,-584.2857 1068.905,-583.5426 1077.5515,-582.7876"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1078.0667,-586.256 1087.7232,-581.897 1077.456,-579.2827 1078.0667,-586.256"/>
</g>
<!-- SetupOtherInputsIfNeeded -->
<g id="node6" class="node">
<title>SetupOtherInputsIfNeeded</title>
<polygon fill="none" stroke="#000000" points="1677,-446 1677,-492 1874,-492 1874,-446 1677,-446"/>
<text text-anchor="middle" x="1775.5" y="-476.8" font-family="Times,serif" font-size="14.00" fill="#000000">SetupOtherInputsIfNeeded</text>
<polyline fill="none" stroke="#000000" points="1677,-469 1874,-469 "/>
<text text-anchor="start" x="1685" y="-453.8" font-family="Times,serif" font-size="14.00" fill="#000000">选择其他和input overlap的files</text>
</g>
<!-- LevelCompactionBuilder_PickCompaction&#45;&gt;SetupOtherInputsIfNeeded -->
<g id="edge2" class="edge">
<title>LevelCompactionBuilder_PickCompaction&#45;&gt;SetupOtherInputsIfNeeded</title>
<path fill="none" stroke="#b83b5e" d="M344.2605,-628.2692C418.9097,-631.2196 558.192,-636 677,-636 677,-636 677,-636 1209,-636 1262.9611,-636 1277.2316,-637.2825 1330,-626 1471.6943,-595.7041 1630.0183,-532.4381 1714.5173,-496.1458"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="1716.1585,-499.2496 1723.9528,-492.0734 1713.3845,-492.8227 1716.1585,-499.2496"/>
</g>
<!-- GetCompaction -->
<g id="node7" class="node">
<title>GetCompaction</title>
<polygon fill="none" stroke="#000000" points="2158,-394 2158,-500 2372,-500 2372,-394 2158,-394"/>
<text text-anchor="middle" x="2265" y="-484.8" font-family="Times,serif" font-size="14.00" fill="#000000">GetCompaction</text>
<polyline fill="none" stroke="#000000" points="2158,-477 2372,-477 "/>
<text text-anchor="start" x="2166" y="-461.8" font-family="Times,serif" font-size="14.00" fill="#000000">根据compaction_inputs_生</text>
<text text-anchor="start" x="2166" y="-446.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 成最终的Compaction</text>
<text text-anchor="start" x="2166" y="-431.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 并重新计算分数</text>
<text text-anchor="start" x="2166" y="-416.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 将compaction注册到picker中</text>
<text text-anchor="start" x="2166" y="-401.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 防止并行的执行level0的compact</text>
</g>
<!-- LevelCompactionBuilder_PickCompaction&#45;&gt;GetCompaction -->
<g id="edge3" class="edge">
<title>LevelCompactionBuilder_PickCompaction&#45;&gt;GetCompaction</title>
<path fill="none" stroke="#b83b5e" d="M344.1698,-632.8075C418.7138,-641.6587 557.8745,-656 677,-656 677,-656 677,-656 1775.5,-656 1929.4005,-656 2090.2375,-567.5377 2183.8447,-505.7181"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="2186.0311,-508.467 2192.4127,-500.0097 2182.1499,-502.6415 2186.0311,-508.467"/>
</g>
<!-- SetupInitialFiles -->
<g id="node8" class="node">
<title>SetupInitialFiles</title>
<polygon fill="none" stroke="#000000" points="380,-297.5 380,-358.5 521,-358.5 521,-297.5 380,-297.5"/>
<text text-anchor="middle" x="450.5" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#000000">SetupInitialFiles</text>
<polyline fill="none" stroke="#000000" points="380,-335.5 521,-335.5 "/>
<text text-anchor="start" x="388" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">根据compaction score</text>
<text text-anchor="start" x="388" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 选择start_level_</text>
</g>
<!-- LevelCompactionBuilder_PickCompaction&#45;&gt;SetupInitialFiles -->
<g id="edge4" class="edge">
<title>LevelCompactionBuilder_PickCompaction&#45;&gt;SetupInitialFiles</title>
<path fill="none" stroke="#b83b5e" d="M300.2679,-607.8074C325.6177,-560.5933 393.971,-433.2852 429.0663,-367.9204"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="432.347,-369.2088 433.9938,-358.7427 426.1797,-365.8975 432.347,-369.2088"/>
</g>
<!-- start_level_inputs_ -->
<g id="node10" class="node">
<title>start_level_inputs_</title>
<polygon fill="#95e1d3" stroke="#000000" points="1366,-361 1366,-491 1641,-491 1641,-361 1366,-361"/>
<text text-anchor="start" x="1374" y="-475.8" font-family="Times,serif" font-size="14.00" fill="#000000">start_level_inputs_</text>
<polyline fill="none" stroke="#000000" points="1366,-468 1641,-468 "/>
<text text-anchor="start" x="1374" y="-452.8" font-family="Times,serif" font-size="14.00" fill="#000000">类型: CompactionInputFiles</text>
<polyline fill="none" stroke="#000000" points="1366,-445 1641,-445 "/>
<text text-anchor="start" x="1374" y="-429.8" font-family="Times,serif" font-size="14.00" fill="#000000">int level;</text>
<polyline fill="none" stroke="#000000" points="1366,-422 1641,-422 "/>
<text text-anchor="start" x="1374" y="-406.8" font-family="Times,serif" font-size="14.00" fill="#000000">std::vector&lt;FileMetaData*&gt; files;</text>
<polyline fill="none" stroke="#000000" points="1366,-399 1641,-399 "/>
<text text-anchor="start" x="1374" y="-383.8" font-family="Times,serif" font-size="14.00" fill="#000000">std::vector&lt;AtomicCompactionUnitBoundary&gt;</text>
<text text-anchor="start" x="1374" y="-368.8" font-family="Times,serif" font-size="14.00" fill="#000000"> atomic_compaction_unit_boundaries;</text>
</g>
<!-- SetupOtherL0FilesIfNeeded&#45;&gt;start_level_inputs_ -->
<g id="edge5" class="edge">
<title>SetupOtherL0FilesIfNeeded&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" d="M1291.2793,-525.41C1304.2872,-519.2918 1317.5487,-513.0542 1330,-507 1338.6973,-502.7711 1347.6084,-498.3683 1356.578,-493.8952"/>
<polygon fill="#666666" stroke="#666666" points="1358.1829,-497.0059 1365.5613,-489.4025 1355.0518,-490.7452 1358.1829,-497.0059"/>
</g>
<!-- compaction_inputs_ -->
<g id="node9" class="node">
<title>compaction_inputs_</title>
<polygon fill="#95e1d3" stroke="#000000" points="1910,-416.5 1910,-477.5 2122,-477.5 2122,-416.5 1910,-416.5"/>
<text text-anchor="middle" x="2016" y="-462.3" font-family="Times,serif" font-size="14.00" fill="#000000">compaction_inputs_</text>
<polyline fill="none" stroke="#000000" points="1910,-454.5 2122,-454.5 "/>
<text text-anchor="start" x="1918" y="-439.3" font-family="Times,serif" font-size="14.00" fill="#000000">std::vector&lt;CompactionInputFiles&gt;</text>
<text text-anchor="start" x="1918" y="-424.3" font-family="Times,serif" font-size="14.00" fill="#000000"> compaction_inputs_;</text>
</g>
<!-- SetupOtherInputsIfNeeded&#45;&gt;compaction_inputs_ -->
<g id="edge6" class="edge">
<title>SetupOtherInputsIfNeeded&#45;&gt;compaction_inputs_</title>
<path fill="none" stroke="#666666" d="M1874.0145,-459.9883C1882.4991,-459.2121 1891.133,-458.4223 1899.7396,-457.635"/>
<polygon fill="#666666" stroke="#666666" points="1900.1804,-461.1094 1909.82,-456.7129 1899.5427,-454.1385 1900.1804,-461.1094"/>
</g>
<!-- GetCompaction&#45;&gt;Compaction -->
<g id="edge8" class="edge">
<title>GetCompaction&#45;&gt;Compaction</title>
<path fill="none" stroke="#f08a5d" d="M2288.1897,-393.744C2311.7066,-343.4767 2351.4918,-267.7123 2400,-212 2410.8281,-199.5637 2423.1207,-187.5364 2435.923,-176.2155"/>
<polygon fill="#f08a5d" stroke="#f08a5d" points="2438.2507,-178.8297 2443.5125,-169.6338 2433.6645,-173.5413 2438.2507,-178.8297"/>
</g>
<!-- RegisterCompaction -->
<g id="node11" class="node">
<title>RegisterCompaction</title>
<polygon fill="none" stroke="#000000" points="2617.5,-411 2489.5,-411 2489.5,-375 2617.5,-375 2617.5,-411"/>
<text text-anchor="middle" x="2553.5" y="-389.3" font-family="Times,serif" font-size="14.00" fill="#000000">RegisterCompaction</text>
</g>
<!-- GetCompaction&#45;&gt;RegisterCompaction -->
<g id="edge9" class="edge">
<title>GetCompaction&#45;&gt;RegisterCompaction</title>
<path fill="none" stroke="#f08a5d" d="M2372.1739,-425.3287C2381.5792,-423.4985 2390.9562,-421.6995 2400,-420 2425.8242,-415.1471 2454.1442,-410.0908 2479.3505,-405.6837"/>
<polygon fill="#f08a5d" stroke="#f08a5d" points="2479.9603,-409.1303 2489.2107,-403.965 2478.7582,-402.2342 2479.9603,-409.1303"/>
</g>
<!-- ComputeCompactionScore -->
<g id="node12" class="node">
<title>ComputeCompactionScore</title>
<polygon fill="none" stroke="#000000" points="2635.5,-465 2471.5,-465 2471.5,-429 2635.5,-429 2635.5,-465"/>
<text text-anchor="middle" x="2553.5" y="-443.3" font-family="Times,serif" font-size="14.00" fill="#000000">ComputeCompactionScore</text>
</g>
<!-- GetCompaction&#45;&gt;ComputeCompactionScore -->
<g id="edge10" class="edge">
<title>GetCompaction&#45;&gt;ComputeCompactionScore</title>
<path fill="none" stroke="#f08a5d" d="M2372.0168,-447C2401.2949,-447 2432.7698,-447 2461.1517,-447"/>
<polygon fill="#f08a5d" stroke="#f08a5d" points="2461.4584,-450.5001 2471.4584,-447 2461.4584,-443.5001 2461.4584,-450.5001"/>
</g>
<!-- MaxFileSizeForLevel -->
<g id="node13" class="node">
<title>MaxFileSizeForLevel</title>
<polygon fill="none" stroke="#000000" points="2621.5,-519 2485.5,-519 2485.5,-483 2621.5,-483 2621.5,-519"/>
<text text-anchor="middle" x="2553.5" y="-497.3" font-family="Times,serif" font-size="14.00" fill="#000000">MaxFileSizeForLevel</text>
</g>
<!-- GetCompaction&#45;&gt;MaxFileSizeForLevel -->
<g id="edge11" class="edge">
<title>GetCompaction&#45;&gt;MaxFileSizeForLevel</title>
<path fill="none" stroke="#f08a5d" d="M2372.1739,-468.6713C2381.5792,-470.5015 2390.9562,-472.3005 2400,-474 2424.5413,-478.6118 2451.3366,-483.4074 2475.5715,-487.6548"/>
<polygon fill="#f08a5d" stroke="#f08a5d" points="2474.977,-491.1039 2485.4302,-489.3773 2476.1819,-484.2083 2474.977,-491.1039"/>
</g>
<!-- SetupInitialFiles&#45;&gt;CompactionScoreLevel -->
<g id="edge12" class="edge">
<title>SetupInitialFiles&#45;&gt;CompactionScoreLevel</title>
<path fill="none" stroke="#3f72af" d="M473.5128,-297.2485C493.522,-272.0287 524.36,-236.6004 557,-212 576.7678,-197.1012 600.8032,-184.2323 622.1563,-174.2755"/>
<polygon fill="#3f72af" stroke="#3f72af" points="623.7868,-177.3789 631.4372,-170.0494 620.8858,-171.0083 623.7868,-177.3789"/>
</g>
<!-- SetupInitialFiles&#45;&gt;CompactionScore -->
<g id="edge13" class="edge">
<title>SetupInitialFiles&#45;&gt;CompactionScore</title>
<path fill="none" stroke="#3f72af" d="M457.851,-297.2296C470.2746,-252.1724 499.8493,-168.8513 557,-125 572.1506,-113.3751 591.3597,-106.5772 609.9429,-102.6524"/>
<polygon fill="#3f72af" stroke="#3f72af" points="610.6842,-106.0747 619.8747,-100.8034 609.403,-99.1929 610.6842,-106.0747"/>
</g>
<!-- SetupInitialFiles&#45;&gt;start_level_inputs_ -->
<g id="edge14" class="edge">
<title>SetupInitialFiles&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#3f72af" d="M521.132,-341.9765C533.0793,-344.1361 545.3756,-346.2326 557,-348 663.17,-364.1423 694.0908,-345.3024 797,-376 814.1421,-381.1135 815.7456,-389.2793 833,-394 927.7568,-419.925 1188.5144,-425.582 1355.5269,-426.4227"/>
<polygon fill="#3f72af" stroke="#3f72af" points="1355.8759,-429.9242 1365.8916,-426.4693 1355.9075,-422.9243 1355.8759,-429.9242"/>
</g>
<!-- PickIntraL0Compaction -->
<g id="node14" class="node">
<title>PickIntraL0Compaction</title>
<polygon fill="none" stroke="#000000" points="584,-520 584,-596 770,-596 770,-520 584,-520"/>
<text text-anchor="middle" x="677" y="-580.8" font-family="Times,serif" font-size="14.00" fill="#000000">PickIntraL0Compaction</text>
<polyline fill="none" stroke="#000000" points="584,-573 770,-573 "/>
<text text-anchor="start" x="592" y="-557.8" font-family="Times,serif" font-size="14.00" fill="#000000">level 0 file之间compaction</text>
<text text-anchor="start" x="592" y="-542.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 输出还是level 0</text>
<text text-anchor="start" x="592" y="-527.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 增加read效率，降低写放大</text>
</g>
<!-- SetupInitialFiles&#45;&gt;PickIntraL0Compaction -->
<g id="edge15" class="edge">
<title>SetupInitialFiles&#45;&gt;PickIntraL0Compaction</title>
<path fill="none" stroke="#3f72af" d="M465.349,-358.6251C488.1021,-404.5315 531.617,-488.1415 557,-510 562.5524,-514.7815 568.641,-519.1241 575.0385,-523.0621"/>
<polygon fill="#3f72af" stroke="#3f72af" points="573.5202,-526.2267 583.9326,-528.1845 577.0138,-520.1607 573.5202,-526.2267"/>
</g>
<!-- PickFileToCompact -->
<g id="node15" class="node">
<title>PickFileToCompact</title>
<polygon fill="none" stroke="#000000" points="1096.5,-245 1096.5,-321 1321.5,-321 1321.5,-245 1096.5,-245"/>
<text text-anchor="middle" x="1209" y="-305.8" font-family="Times,serif" font-size="14.00" fill="#000000">PickFileToCompact</text>
<polyline fill="none" stroke="#000000" points="1096.5,-298 1321.5,-298 "/>
<text text-anchor="start" x="1104.5" y="-282.8" font-family="Times,serif" font-size="14.00" fill="#000000">选择start_level_中</text>
<text text-anchor="start" x="1104.5" y="-267.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 需要compact的file</text>
<text text-anchor="start" x="1104.5" y="-252.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 以及下一层和该file overlap的文件</text>
</g>
<!-- SetupInitialFiles&#45;&gt;PickFileToCompact -->
<g id="edge16" class="edge">
<title>SetupInitialFiles&#45;&gt;PickFileToCompact</title>
<path fill="none" stroke="#3f72af" d="M488.4568,-297.2684C507.7577,-283.6009 532.3136,-269.0291 557,-262 659.589,-232.7891 693.1868,-237.493 797,-262 814.41,-266.1099 815.6065,-275.8206 833,-280 879.3437,-291.1356 995.157,-290.5435 1086.1081,-287.9798"/>
<polygon fill="#3f72af" stroke="#3f72af" points="1086.3336,-291.4748 1096.2269,-287.6837 1086.1288,-284.4778 1086.3336,-291.4748"/>
</g>
<!-- PickExpiredTtlFiles -->
<g id="node16" class="node">
<title>PickExpiredTtlFiles</title>
<polygon fill="none" stroke="#000000" points="1146.5,-340 1146.5,-386 1271.5,-386 1271.5,-340 1146.5,-340"/>
<text text-anchor="middle" x="1209" y="-370.8" font-family="Times,serif" font-size="14.00" fill="#000000">PickExpiredTtlFiles</text>
<polyline fill="none" stroke="#000000" points="1146.5,-363 1271.5,-363 "/>
<text text-anchor="start" x="1154.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#000000">选择过期的文件</text>
</g>
<!-- SetupInitialFiles&#45;&gt;PickExpiredTtlFiles -->
<g id="edge17" class="edge">
<title>SetupInitialFiles&#45;&gt;PickExpiredTtlFiles</title>
<path fill="none" stroke="#3f72af" d="M509.6445,-297.4129C524.6998,-291.049 541.1226,-285.2824 557,-282 661.4578,-260.4052 691.9305,-263.6103 797,-282 813.7565,-284.9328 816.5188,-290.7867 833,-295 928.4304,-319.3959 955.1569,-311.0126 1052,-329 1079.596,-334.1256 1109.7593,-340.476 1136.2061,-346.2959"/>
<polygon fill="#3f72af" stroke="#3f72af" points="1135.6269,-349.7524 1146.1471,-348.4968 1137.1401,-342.9179 1135.6269,-349.7524"/>
</g>
<!-- ExpandInputsToCleanCut -->
<g id="node17" class="node">
<title>ExpandInputsToCleanCut</title>
<polygon fill="none" stroke="#000000" points="756,-327 598,-327 598,-291 756,-291 756,-327"/>
<text text-anchor="middle" x="677" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#000000">ExpandInputsToCleanCut</text>
</g>
<!-- SetupInitialFiles&#45;&gt;ExpandInputsToCleanCut -->
<g id="edge18" class="edge">
<title>SetupInitialFiles&#45;&gt;ExpandInputsToCleanCut</title>
<path fill="none" stroke="#3f72af" d="M521.2343,-322.0664C542.2833,-320.3007 565.6244,-318.3428 587.6943,-316.4914"/>
<polygon fill="#3f72af" stroke="#3f72af" points="588.0598,-319.9732 597.7322,-315.6494 587.4746,-312.9977 588.0598,-319.9732"/>
</g>
<!-- PickFilesMarkedForCompaction -->
<g id="node18" class="node">
<title>PickFilesMarkedForCompaction</title>
<polygon fill="none" stroke="#000000" points="845,-338 845,-384 1040,-384 1040,-338 845,-338"/>
<text text-anchor="middle" x="942.5" y="-368.8" font-family="Times,serif" font-size="14.00" fill="#000000">PickFilesMarkedForCompaction</text>
<polyline fill="none" stroke="#000000" points="845,-361 1040,-361 "/>
<text text-anchor="start" x="853" y="-345.8" font-family="Times,serif" font-size="14.00" fill="#000000">选择被标记为compaction的</text>
</g>
<!-- SetupInitialFiles&#45;&gt;PickFilesMarkedForCompaction -->
<g id="edge19" class="edge">
<title>SetupInitialFiles&#45;&gt;PickFilesMarkedForCompaction</title>
<path fill="none" stroke="#3f72af" d="M521.2419,-333.4157C533.1762,-334.3002 545.4397,-335.191 557,-336 650.6428,-342.5533 757.1249,-349.4139 834.4144,-354.2867"/>
<polygon fill="#3f72af" stroke="#3f72af" points="834.4443,-357.7954 844.6445,-354.9308 834.8842,-350.8093 834.4443,-357.7954"/>
</g>
<!-- PickFilesMarkedForPeriodicCompaction -->
<g id="node19" class="node">
<title>PickFilesMarkedForPeriodicCompaction</title>
<polygon fill="none" stroke="#000000" points="557,-385.5 557,-446.5 797,-446.5 797,-385.5 557,-385.5"/>
<text text-anchor="middle" x="677" y="-431.3" font-family="Times,serif" font-size="14.00" fill="#000000">PickFilesMarkedForPeriodicCompaction</text>
<polyline fill="none" stroke="#000000" points="557,-423.5 797,-423.5 "/>
<text text-anchor="start" x="565" y="-408.3" font-family="Times,serif" font-size="14.00" fill="#000000">选择标记为需要</text>
<text text-anchor="start" x="565" y="-393.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 周期性compact的文件</text>
</g>
<!-- SetupInitialFiles&#45;&gt;PickFilesMarkedForPeriodicCompaction -->
<g id="edge20" class="edge">
<title>SetupInitialFiles&#45;&gt;PickFilesMarkedForPeriodicCompaction</title>
<path fill="none" stroke="#3f72af" d="M521.151,-356.8133C533.096,-361.6023 545.3867,-366.4788 557,-371 566.0971,-374.5416 575.6008,-378.191 585.1045,-381.8073"/>
<polygon fill="#3f72af" stroke="#3f72af" points="584.0018,-385.1323 594.5931,-385.4073 586.4849,-378.5875 584.0018,-385.1323"/>
</g>
<!-- BottommostFilesMarkedForCompaction -->
<g id="node20" class="node">
<title>BottommostFilesMarkedForCompaction</title>
<polygon fill="none" stroke="#000000" points="796.5,-501 557.5,-501 557.5,-465 796.5,-465 796.5,-501"/>
<text text-anchor="middle" x="677" y="-479.3" font-family="Times,serif" font-size="14.00" fill="#000000">BottommostFilesMarkedForCompaction</text>
</g>
<!-- SetupInitialFiles&#45;&gt;BottommostFilesMarkedForCompaction -->
<g id="edge21" class="edge">
<title>SetupInitialFiles&#45;&gt;BottommostFilesMarkedForCompaction</title>
<path fill="none" stroke="#3f72af" d="M467.7239,-358.5939C486.006,-388.1701 517.6687,-431.9361 557,-456 559.691,-457.6464 562.4711,-459.1928 565.321,-460.6451"/>
<polygon fill="#3f72af" stroke="#3f72af" points="564.0923,-463.9335 574.6363,-464.9707 567.0405,-457.5845 564.0923,-463.9335"/>
</g>
<!-- SetupInitialFiles&#45;&gt;start_level_ -->
<g id="edge22" class="edge">
<title>SetupInitialFiles&#45;&gt;start_level_</title>
<path fill="none" stroke="#3f72af" d="M479.9112,-297.1199C499.7059,-278.6696 527.5029,-256.9427 557,-247 656.7445,-213.3787 779.4304,-221.0678 859.2236,-231.9989"/>
<polygon fill="#3f72af" stroke="#3f72af" points="858.829,-235.4778 869.2213,-233.4162 859.8116,-228.5471 858.829,-235.4778"/>
</g>
<!-- compaction_inputs_&#45;&gt;GetCompaction -->
<g id="edge7" class="edge">
<title>compaction_inputs_&#45;&gt;GetCompaction</title>
<path fill="none" stroke="#666666" d="M2122.3207,-447C2130.6843,-447 2139.1598,-447 2147.5918,-447"/>
<polygon fill="#666666" stroke="#666666" points="2147.845,-450.5001 2157.8449,-447 2147.8449,-443.5001 2147.845,-450.5001"/>
</g>
<!-- start_level_inputs_&#45;&gt;SetupOtherL0FilesIfNeeded -->
<g id="edge28" class="edge">
<title>start_level_inputs_&#45;&gt;SetupOtherL0FilesIfNeeded</title>
<path fill="none" stroke="#c0c0c0" stroke-dasharray="5,2" d="M1397.0424,-491.1318C1377.9144,-501.1523 1357.9533,-511.2845 1338.1492,-521.0142"/>
<polygon fill="#c0c0c0" stroke="#c0c0c0" points="1336.512,-517.9186 1329.0647,-525.4544 1339.5859,-524.2076 1336.512,-517.9186"/>
</g>
<!-- start_level_inputs_&#45;&gt;SetupOtherInputsIfNeeded -->
<g id="edge29" class="edge">
<title>start_level_inputs_&#45;&gt;SetupOtherInputsIfNeeded</title>
<path fill="none" stroke="#c0c0c0" stroke-dasharray="5,2" d="M1641.0937,-447.7519C1649.6184,-449.0996 1658.1348,-450.4459 1666.5088,-451.7698"/>
<polygon fill="#c0c0c0" stroke="#c0c0c0" points="1666.2197,-455.2675 1676.6436,-453.372 1667.3128,-448.3533 1666.2197,-455.2675"/>
</g>
<!-- start_level_inputs_&#45;&gt;compaction_inputs_ -->
<g id="edge30" class="edge">
<title>start_level_inputs_&#45;&gt;compaction_inputs_</title>
<path fill="none" stroke="#c0c0c0" stroke-dasharray="5,2" d="M1641.2312,-428.7585C1711.0052,-430.4939 1797.0356,-433.1491 1874,-437 1882.3382,-437.4172 1890.9485,-437.8984 1899.6138,-438.4195"/>
<polygon fill="#c0c0c0" stroke="#c0c0c0" points="1899.6018,-441.9253 1909.7984,-439.0481 1900.033,-434.9386 1899.6018,-441.9253"/>
</g>
<!-- FindIntraL0Compaction -->
<g id="node22" class="node">
<title>FindIntraL0Compaction</title>
<polygon fill="none" stroke="#000000" points="1114.5,-445.5 1114.5,-506.5 1303.5,-506.5 1303.5,-445.5 1114.5,-445.5"/>
<text text-anchor="middle" x="1209" y="-491.3" font-family="Times,serif" font-size="14.00" fill="#000000">FindIntraL0Compaction</text>
<polyline fill="none" stroke="#000000" points="1114.5,-483.5 1303.5,-483.5 "/>
<text text-anchor="start" x="1122.5" y="-468.3" font-family="Times,serif" font-size="14.00" fill="#000000">将Level0中需要compaction的</text>
<text text-anchor="start" x="1122.5" y="-453.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 放到start_level_inputs中</text>
</g>
<!-- PickIntraL0Compaction&#45;&gt;FindIntraL0Compaction -->
<g id="edge31" class="edge">
<title>PickIntraL0Compaction&#45;&gt;FindIntraL0Compaction</title>
<path fill="none" stroke="#666666" d="M770.1482,-541.4683C790.8248,-537.913 812.6433,-534.2499 833,-531 924.4959,-516.3928 1028.7666,-501.2594 1104.2575,-490.5735"/>
<polygon fill="#666666" stroke="#666666" points="1104.8361,-494.0266 1114.2479,-489.1615 1103.8565,-487.0955 1104.8361,-494.0266"/>
</g>
<!-- level0_file_num_compaction_trigger -->
<g id="node23" class="node">
<title>level0_file_num_compaction_trigger</title>
<polygon fill="none" stroke="#000000" points="1052,-576 833,-576 833,-540 1052,-540 1052,-576"/>
<text text-anchor="middle" x="942.5" y="-554.3" font-family="Times,serif" font-size="14.00" fill="#000000">level0_file_num_compaction_trigger</text>
</g>
<!-- PickIntraL0Compaction&#45;&gt;level0_file_num_compaction_trigger -->
<g id="edge32" class="edge">
<title>PickIntraL0Compaction&#45;&gt;level0_file_num_compaction_trigger</title>
<path fill="none" stroke="#666666" d="M770.232,-558C787.0939,-558 804.8917,-558 822.3938,-558"/>
<polygon fill="#666666" stroke="#666666" points="822.6552,-561.5001 832.6552,-558 822.6552,-554.5001 822.6552,-561.5001"/>
</g>
<!-- PickFileToCompact&#45;&gt;start_level_inputs_ -->
<g id="edge27" class="edge">
<title>PickFileToCompact&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" d="M1307.828,-321.0323C1315.3782,-324.2944 1322.8412,-327.6359 1330,-331 1346.3901,-338.7023 1363.3899,-347.2625 1380.0527,-356.0003"/>
<polygon fill="#666666" stroke="#666666" points="1378.7921,-359.2927 1389.2691,-360.8686 1382.0616,-353.1032 1378.7921,-359.2927"/>
</g>
<!-- PickExpiredTtlFiles&#45;&gt;start_level_inputs_ -->
<g id="edge34" class="edge">
<title>PickExpiredTtlFiles&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" d="M1271.8164,-376.4378C1296.6311,-381.7462 1326.2776,-388.0883 1355.9409,-394.4339"/>
<polygon fill="#666666" stroke="#666666" points="1355.4834,-397.9151 1365.9943,-396.5845 1356.9478,-391.07 1355.4834,-397.9151"/>
</g>
<!-- PickFilesMarkedForCompaction&#45;&gt;start_level_inputs_ -->
<g id="edge35" class="edge">
<title>PickFilesMarkedForCompaction&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" d="M1028.2044,-384.0832C1047.7381,-388.6541 1068.4884,-392.9698 1088,-396 1176.2391,-409.7037 1276.014,-417.1672 1355.6715,-421.2222"/>
<polygon fill="#666666" stroke="#666666" points="1355.6181,-424.7237 1365.7794,-421.724 1355.9653,-417.7323 1355.6181,-424.7237"/>
</g>
<!-- start_level_&#45;&gt;start_level_inputs_ -->
<g id="edge23" class="edge">
<title>start_level_&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1015.6989,-226.9137C1096.3914,-208.7645 1228.2418,-191.1204 1330,-236 1384.0266,-259.828 1428.5186,-309.7072 1458.9176,-352.381"/>
<polygon fill="#666666" stroke="#666666" points="1456.211,-354.6181 1464.8082,-360.8099 1461.9487,-350.6082 1456.211,-354.6181"/>
</g>
<!-- start_level_&#45;&gt;PickFileToCompact -->
<g id="edge24" class="edge">
<title>start_level_&#45;&gt;PickFileToCompact</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1015.6748,-256.8848C1037.6147,-259.8485 1062.3028,-263.1835 1086.5138,-266.454"/>
<polygon fill="#666666" stroke="#666666" points="1086.1069,-269.9308 1096.4855,-267.801 1087.044,-262.9938 1086.1069,-269.9308"/>
</g>
<!-- FindIntraL0Compaction&#45;&gt;start_level_inputs_ -->
<g id="edge33" class="edge">
<title>FindIntraL0Compaction&#45;&gt;start_level_inputs_</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1303.8027,-459.9045C1320.5439,-457.0621 1338.3256,-454.0432 1356.1099,-451.0238"/>
<polygon fill="#666666" stroke="#666666" points="1356.7108,-454.4719 1365.9838,-449.3474 1355.539,-447.5707 1356.7108,-454.4719"/>
</g>
<!-- PickCompaction -->
<g id="node24" class="node">
<title>PickCompaction</title>
<polygon fill="none" stroke="#000000" points="158,-644 51,-644 51,-608 158,-608 158,-644"/>
<text text-anchor="middle" x="104.5" y="-622.3" font-family="Times,serif" font-size="14.00" fill="#000000">PickCompaction</text>
</g>
<!-- PickCompaction&#45;&gt;LevelCompactionBuilder_PickCompaction -->
<g id="edge36" class="edge">
<title>PickCompaction&#45;&gt;LevelCompactionBuilder_PickCompaction</title>
<path fill="none" stroke="#666666" d="M158.2989,-626C179.6984,-626 204.4874,-626 226.7775,-626"/>
<polygon fill="#666666" stroke="#666666" points="226.822,-629.5001 236.822,-626 226.822,-622.5001 226.822,-629.5001"/>
</g>
</g>
</svg>
