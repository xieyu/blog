<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: track_key Pages: 1 -->
<svg width="1826pt" height="621pt"
 viewBox="0.00 0.00 1825.90 621.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 617)">
<title>track_key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-617 1821.9033,-617 1821.9033,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_TransactionBaseImpl</title>
<polygon fill="none" stroke="#000000" points="8,-257 8,-605 1776.9268,-605 1776.9268,-257 8,-257"/>
<text text-anchor="middle" x="892.4634" y="-585" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionBaseImpl</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KvOperation</title>
<polygon fill="none" stroke="#000000" points="16,-265 16,-569 159.207,-569 159.207,-265 16,-265"/>
<text text-anchor="middle" x="87.6035" y="-549" font-family="Times,serif" font-size="20.00" fill="#000000">KV Write 操作</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_OptimisticTransaction</title>
<polygon fill="none" stroke="#000000" points="424.0532,-167 424.0532,-249 622.5474,-249 622.5474,-167 424.0532,-167"/>
<text text-anchor="middle" x="523.3003" y="-229" font-family="Times,serif" font-size="20.00" fill="#000000"> OptimisticTransaction</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_TransactionLockMgr</title>
<polygon fill="none" stroke="#000000" points="1000.6626,-8 1000.6626,-228 1809.9033,-228 1809.9033,-8 1000.6626,-8"/>
<text text-anchor="middle" x="1405.283" y="-208" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionLockMgr</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_PessimisticTransactionDB</title>
<polygon fill="none" stroke="#000000" points="668.5903,-77 668.5903,-159 896.0845,-159 896.0845,-77 668.5903,-77"/>
<text text-anchor="middle" x="782.3374" y="-139" font-family="Times,serif" font-size="20.00" fill="#000000">PessimisticTransactionDB</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_PessimisticTransaction</title>
<polygon fill="none" stroke="#000000" points="424.0532,-77 424.0532,-159 623.5474,-159 623.5474,-77 424.0532,-77"/>
<text text-anchor="middle" x="523.8003" y="-139" font-family="Times,serif" font-size="20.00" fill="#000000">PessimisticTransaction</text>
</g>
<!-- GetTrackedKeys -->
<g id="node1" class="node">
<title>GetTrackedKeys</title>
<polygon fill="none" stroke="#000000" points="837.1944,-301 726.4804,-301 726.4804,-265 837.1944,-265 837.1944,-301"/>
<text text-anchor="middle" x="781.8374" y="-278.8" font-family="Times,serif" font-size="14.00" fill="#000000">GetTrackedKeys</text>
</g>
<!-- tracked_keys_ -->
<g id="node2" class="node">
<title>tracked_keys_</title>
<polygon fill="#95e1d3" stroke="#000000" points="931.4951,-326 931.4951,-370 1150.3242,-370 1150.3242,-326 931.4951,-326"/>
<text text-anchor="middle" x="1040.9097" y="-354.8" font-family="Times,serif" font-size="14.00" fill="#000000">tracked_keys_</text>
<polyline fill="none" stroke="#000000" points="931.4951,-348 1150.3242,-348 "/>
<text text-anchor="middle" x="1040.9097" y="-332.8" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionKeyMap tracked_keys_;</text>
</g>
<!-- GetTrackedKeys&#45;&gt;tracked_keys_ -->
<g id="edge1" class="edge">
<title>GetTrackedKeys&#45;&gt;tracked_keys_</title>
<path fill="none" stroke="#666666" d="M837.108,-295.7738C855.854,-300.1829 876.9022,-305.2175 896.0845,-310 912.9519,-314.2053 930.8898,-318.8067 948.1879,-323.3103"/>
<polygon fill="#666666" stroke="#666666" points="947.726,-326.8069 958.2858,-325.9468 949.4944,-320.034 947.726,-326.8069"/>
</g>
<!-- TransactionKeyMap -->
<g id="node4" class="node">
<title>TransactionKeyMap</title>
<polygon fill="#95e1d3" stroke="#000000" points="1186.3242,-270.6001 1186.3242,-425.3999 1546.042,-425.3999 1546.042,-270.6001 1186.3242,-270.6001"/>
<text text-anchor="middle" x="1366.1831" y="-410.1999" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionKeyMap</text>
<polyline fill="none" stroke="#000000" points="1186.3242,-403.3999 1546.042,-403.3999 "/>
<text text-anchor="start" x="1194.3242" y="-388.1999" font-family="Times,serif" font-size="14.00" fill="#000000">从column family id到key的映射</text>
<polyline fill="none" stroke="#000000" points="1186.3242,-375.8 1546.042,-375.8 "/>
<text text-anchor="start" x="1194.3242" y="-360.6" font-family="Times,serif" font-size="14.00" fill="#000000">乐观事务表示提交时需要check conflict的key</text>
<polyline fill="none" stroke="#000000" points="1186.3242,-348.2 1546.042,-348.2 "/>
<text text-anchor="start" x="1194.3242" y="-333" font-family="Times,serif" font-size="14.00" fill="#000000">悲观事务表示list of locked key</text>
<polyline fill="none" stroke="#000000" points="1186.3242,-320.6001 1546.042,-320.6001 "/>
<text text-anchor="start" x="1194.3242" y="-305.4001" font-family="Times,serif" font-size="14.00" fill="#000000">using TransactionKeyMap =</text>
<text text-anchor="start" x="1194.3242" y="-291.4001" font-family="Times,serif" font-size="14.00" fill="#000000"> std::unordered_map&lt;uint32_t,</text>
<text text-anchor="middle" x="1366.1831" y="-277.4001" font-family="Times,serif" font-size="14.00" fill="#000000"> std::unordered_map&lt;std::string, TransactionKeyMapInfo&gt;&gt;;</text>
</g>
<!-- tracked_keys_&#45;&gt;TransactionKeyMap -->
<g id="edge3" class="edge">
<title>tracked_keys_&#45;&gt;TransactionKeyMap</title>
<path fill="none" stroke="#666666" d="M1150.5789,-348C1158.8641,-348 1167.3551,-348 1175.9521,-348"/>
<polygon fill="#666666" stroke="#666666" points="1176.0869,-351.5001 1186.0868,-348 1176.0868,-344.5001 1176.0869,-351.5001"/>
</g>
<!-- TrackKey -->
<g id="node3" class="node">
<title>TrackKey</title>
<polygon fill="none" stroke="#000000" points="681.1797,-319.4001 681.1797,-388.5999 882.4951,-388.5999 882.4951,-319.4001 681.1797,-319.4001"/>
<text text-anchor="middle" x="781.8374" y="-373.3999" font-family="Times,serif" font-size="14.00" fill="#000000">TrackKey</text>
<polyline fill="none" stroke="#000000" points="681.1797,-366.5999 882.4951,-366.5999 "/>
<text text-anchor="start" x="689.1797" y="-351.3999" font-family="Times,serif" font-size="14.00" fill="#000000">向tracked_keys_中插入key,</text>
<text text-anchor="start" x="689.1797" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#000000"> seq, readonly, excluesive等信息</text>
</g>
<!-- TrackKey&#45;&gt;tracked_keys_ -->
<g id="edge2" class="edge">
<title>TrackKey&#45;&gt;tracked_keys_</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M882.7433,-351.6631C895.2993,-351.3723 908.2331,-351.0727 921.0402,-350.7761"/>
<polygon fill="#ff0000" stroke="#ff0000" points="921.3582,-354.2698 931.2744,-350.5391 921.196,-347.2717 921.3582,-354.2698"/>
</g>
<!-- TransactionKeyMapInfo -->
<g id="node5" class="node">
<title>TransactionKeyMapInfo</title>
<polygon fill="#95e1d3" stroke="#000000" points="1615.0186,-293 1615.0186,-403 1768.9268,-403 1768.9268,-293 1615.0186,-293"/>
<text text-anchor="middle" x="1691.9727" y="-387.8" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionKeyMapInfo</text>
<polyline fill="none" stroke="#000000" points="1615.0186,-381 1768.9268,-381 "/>
<text text-anchor="start" x="1623.0186" y="-365.8" font-family="Times,serif" font-size="14.00" fill="#000000">SequenceNumber seq;</text>
<polyline fill="none" stroke="#000000" points="1615.0186,-359 1768.9268,-359 "/>
<text text-anchor="start" x="1623.0186" y="-343.8" font-family="Times,serif" font-size="14.00" fill="#000000">uint32_t num_writes;</text>
<polyline fill="none" stroke="#000000" points="1615.0186,-337 1768.9268,-337 "/>
<text text-anchor="start" x="1623.0186" y="-321.8" font-family="Times,serif" font-size="14.00" fill="#000000">uint32_t num_reads;</text>
<polyline fill="none" stroke="#000000" points="1615.0186,-315 1768.9268,-315 "/>
<text text-anchor="start" x="1623.0186" y="-299.8" font-family="Times,serif" font-size="14.00" fill="#000000">bool exclusive;</text>
</g>
<!-- TransactionKeyMap&#45;&gt;TransactionKeyMapInfo -->
<g id="edge4" class="edge">
<title>TransactionKeyMap&#45;&gt;TransactionKeyMapInfo</title>
<path fill="none" stroke="#666666" d="M1546.2299,-348C1566.5932,-348 1586.5951,-348 1604.9434,-348"/>
<polygon fill="#666666" stroke="#666666" points="1604.9586,-351.5001 1614.9585,-348 1604.9585,-344.5001 1604.9586,-351.5001"/>
</g>
<!-- TransactionBaseImpl_TryLock -->
<g id="node6" class="node">
<title>TransactionBaseImpl_TryLock</title>
<polygon fill="none" stroke="#000000" points="187.207,-278.6001 187.207,-383.3999 377.4209,-383.3999 377.4209,-278.6001 187.207,-278.6001"/>
<text text-anchor="middle" x="282.314" y="-368.1999" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock</text>
<polyline fill="none" stroke="#000000" points="187.207,-361.3999 377.4209,-361.3999 "/>
<text text-anchor="start" x="195.207" y="-346.1999" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock虚函数</text>
<polyline fill="none" stroke="#000000" points="187.207,-333.8 377.4209,-333.8 "/>
<text text-anchor="start" x="195.207" y="-318.6" font-family="Times,serif" font-size="14.00" fill="#000000">乐观事务记录事务涉及的key</text>
<polyline fill="none" stroke="#000000" points="187.207,-306.2 377.4209,-306.2 "/>
<text text-anchor="start" x="195.207" y="-291" font-family="Times,serif" font-size="14.00" fill="#000000">悲观事务还会去获取key lock</text>
</g>
<!-- PessimisticTransaction_TryLock -->
<g id="node14" class="node">
<title>PessimisticTransaction_TryLock</title>
<polygon fill="none" stroke="#000000" points="491.0532,-86 491.0532,-122 555.5474,-122 555.5474,-86 491.0532,-86"/>
<text text-anchor="middle" x="523.3003" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock</text>
</g>
<!-- TransactionBaseImpl_TryLock&#45;&gt;PessimisticTransaction_TryLock -->
<g id="edge16" class="edge">
<title>TransactionBaseImpl_TryLock&#45;&gt;PessimisticTransaction_TryLock</title>
<path fill="none" stroke="#666666" d="M314.8001,-278.5725C338.8295,-242.8274 374.1029,-196.1471 413.4209,-163 433.7537,-145.8584 459.8691,-131.584 481.5379,-121.3714"/>
<polygon fill="#666666" stroke="#666666" points="483.2022,-124.4587 490.8324,-117.1082 480.2837,-118.0961 483.2022,-124.4587"/>
</g>
<!-- OptimisticTransaction_TryLock -->
<g id="node15" class="node">
<title>OptimisticTransaction_TryLock</title>
<polygon fill="none" stroke="#000000" points="491.0532,-176 491.0532,-212 555.5474,-212 555.5474,-176 491.0532,-176"/>
<text text-anchor="middle" x="523.3003" y="-189.8" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock</text>
</g>
<!-- TransactionBaseImpl_TryLock&#45;&gt;OptimisticTransaction_TryLock -->
<g id="edge17" class="edge">
<title>TransactionBaseImpl_TryLock&#45;&gt;OptimisticTransaction_TryLock</title>
<path fill="none" stroke="#666666" d="M369.4508,-278.4365C384.0678,-269.8273 399.1278,-261.084 413.4209,-253 435.9126,-240.2791 461.3129,-226.5968 482.0221,-215.6139"/>
<polygon fill="#666666" stroke="#666666" points="483.6797,-218.6966 490.8831,-210.9273 480.4069,-212.5088 483.6797,-218.6966"/>
</g>
<!-- GetForUpdate -->
<g id="node7" class="node">
<title>GetForUpdate</title>
<polygon fill="none" stroke="#000000" points="135.6934,-309 39.5136,-309 39.5136,-273 135.6934,-273 135.6934,-309"/>
<text text-anchor="middle" x="87.6035" y="-286.8" font-family="Times,serif" font-size="14.00" fill="#000000">GetForUpdate</text>
</g>
<!-- GetForUpdate&#45;&gt;TransactionBaseImpl_TryLock -->
<g id="edge5" class="edge">
<title>GetForUpdate&#45;&gt;TransactionBaseImpl_TryLock</title>
<path fill="none" stroke="#666666" d="M135.7342,-300.8876C148.4528,-303.5005 162.6924,-306.4257 177.1631,-309.3985"/>
<polygon fill="#666666" stroke="#666666" points="176.7027,-312.8769 187.2024,-311.4609 178.1113,-306.0201 176.7027,-312.8769"/>
</g>
<!-- GetBatchForWrite -->
<g id="node12" class="node">
<title>GetBatchForWrite</title>
<polygon fill="none" stroke="#000000" points="187.6035,-402.2 187.6035,-451.8 377.0244,-451.8 377.0244,-402.2 187.6035,-402.2"/>
<text text-anchor="middle" x="282.314" y="-436.6" font-family="Times,serif" font-size="14.00" fill="#000000">GetBatchForWrite</text>
<polyline fill="none" stroke="#000000" points="187.6035,-429.8 377.0244,-429.8 "/>
<text text-anchor="middle" x="282.314" y="-414.6" font-family="Times,serif" font-size="14.00" fill="#000000">写操作会先写到writeBatch中</text>
</g>
<!-- GetForUpdate&#45;&gt;GetBatchForWrite -->
<g id="edge6" class="edge">
<title>GetForUpdate&#45;&gt;GetBatchForWrite</title>
<path fill="none" stroke="#666666" d="M135.6766,-302.6164C144.3133,-306.4098 152.6418,-311.4132 159.207,-318 184.325,-343.2005 161.8726,-368.0172 187.207,-393 188.1551,-393.935 189.1307,-394.8444 190.1312,-395.7289"/>
<polygon fill="#666666" stroke="#666666" points="188.2056,-398.6649 198.2501,-402.035 192.4995,-393.1366 188.2056,-398.6649"/>
</g>
<!-- MultiGetForUpdate -->
<g id="node8" class="node">
<title>MultiGetForUpdate</title>
<polygon fill="none" stroke="#000000" points="151.3107,-525 23.8963,-525 23.8963,-489 151.3107,-489 151.3107,-525"/>
<text text-anchor="middle" x="87.6035" y="-502.8" font-family="Times,serif" font-size="14.00" fill="#000000">MultiGetForUpdate</text>
</g>
<!-- MultiGetForUpdate&#45;&gt;TransactionBaseImpl_TryLock -->
<g id="edge7" class="edge">
<title>MultiGetForUpdate&#45;&gt;TransactionBaseImpl_TryLock</title>
<path fill="none" stroke="#666666" d="M148.3897,-488.9059C152.3331,-486.3196 156.0009,-483.3679 159.207,-480 187.2141,-450.5793 162.5524,-425.282 187.207,-393 187.6781,-392.3832 188.1572,-391.7707 188.6439,-391.1626"/>
<polygon fill="#666666" stroke="#666666" points="191.4037,-393.3241 195.3731,-383.5009 186.1443,-388.7047 191.4037,-393.3241"/>
</g>
<!-- MultiGetForUpdate&#45;&gt;GetBatchForWrite -->
<g id="edge8" class="edge">
<title>MultiGetForUpdate&#45;&gt;GetBatchForWrite</title>
<path fill="none" stroke="#666666" d="M136.6368,-488.8526C144.2164,-485.9488 151.9381,-482.9334 159.207,-480 178.0359,-472.4016 198.3316,-463.8255 216.9066,-455.8211"/>
<polygon fill="#666666" stroke="#666666" points="218.3691,-459.0019 226.1587,-451.8204 215.5909,-452.5769 218.3691,-459.0019"/>
</g>
<!-- Put -->
<g id="node9" class="node">
<title>Put</title>
<polygon fill="none" stroke="#000000" points="114.6035,-471 60.6035,-471 60.6035,-435 114.6035,-435 114.6035,-471"/>
<text text-anchor="middle" x="87.6035" y="-448.8" font-family="Times,serif" font-size="14.00" fill="#000000">Put</text>
</g>
<!-- Put&#45;&gt;TransactionBaseImpl_TryLock -->
<g id="edge9" class="edge">
<title>Put&#45;&gt;TransactionBaseImpl_TryLock</title>
<path fill="none" stroke="#666666" d="M114.6858,-446.3317C128.798,-442.014 145.8494,-435.4134 159.207,-426 174.9298,-414.9199 172.7773,-405.7184 187.207,-393 188.2051,-392.1203 189.2167,-391.2439 190.2403,-390.3711"/>
<polygon fill="#666666" stroke="#666666" points="192.7884,-392.8081 198.3017,-383.7607 188.3497,-387.3952 192.7884,-392.8081"/>
</g>
<!-- Put&#45;&gt;GetBatchForWrite -->
<g id="edge10" class="edge">
<title>Put&#45;&gt;GetBatchForWrite</title>
<path fill="none" stroke="#666666" d="M114.6772,-449.3848C131.4093,-447.1505 154.0721,-444.1243 177.3194,-441.0201"/>
<polygon fill="#666666" stroke="#666666" points="177.854,-444.4799 187.3027,-439.687 176.9274,-437.5415 177.854,-444.4799"/>
</g>
<!-- Merge -->
<g id="node10" class="node">
<title>Merge</title>
<polygon fill="none" stroke="#000000" points="114.6035,-417 60.6035,-417 60.6035,-381 114.6035,-381 114.6035,-417"/>
<text text-anchor="middle" x="87.6035" y="-394.8" font-family="Times,serif" font-size="14.00" fill="#000000">Merge</text>
</g>
<!-- Merge&#45;&gt;TransactionBaseImpl_TryLock -->
<g id="edge11" class="edge">
<title>Merge&#45;&gt;TransactionBaseImpl_TryLock</title>
<path fill="none" stroke="#666666" d="M114.6772,-389.5449C131.3922,-383.7074 154.0257,-375.803 177.2479,-367.6929"/>
<polygon fill="#666666" stroke="#666666" points="178.5792,-370.9353 186.866,-364.3339 176.2712,-364.3268 178.5792,-370.9353"/>
</g>
<!-- Merge&#45;&gt;GetBatchForWrite -->
<g id="edge12" class="edge">
<title>Merge&#45;&gt;GetBatchForWrite</title>
<path fill="none" stroke="#666666" d="M114.6772,-402.8933C131.4093,-405.2994 154.0721,-408.5584 177.3194,-411.9014"/>
<polygon fill="#666666" stroke="#666666" points="176.9063,-415.378 187.3027,-413.3371 177.9027,-408.4492 176.9063,-415.378"/>
</g>
<!-- Delete -->
<g id="node11" class="node">
<title>Delete</title>
<polygon fill="none" stroke="#000000" points="114.6035,-363 60.6035,-363 60.6035,-327 114.6035,-327 114.6035,-363"/>
<text text-anchor="middle" x="87.6035" y="-340.8" font-family="Times,serif" font-size="14.00" fill="#000000">Delete</text>
</g>
<!-- Delete&#45;&gt;TransactionBaseImpl_TryLock -->
<g id="edge13" class="edge">
<title>Delete&#45;&gt;TransactionBaseImpl_TryLock</title>
<path fill="none" stroke="#666666" d="M114.6772,-343.0534C131.2436,-341.8622 153.6237,-340.253 176.6288,-338.5989"/>
<polygon fill="#666666" stroke="#666666" points="177.1428,-342.0711 186.866,-337.8629 176.6408,-335.0891 177.1428,-342.0711"/>
</g>
<!-- Delete&#45;&gt;GetBatchForWrite -->
<g id="edge14" class="edge">
<title>Delete&#45;&gt;GetBatchForWrite</title>
<path fill="none" stroke="#666666" d="M114.9247,-353.2683C128.625,-357.916 145.2317,-364.3281 159.207,-372 172.843,-379.4856 173.507,-385.6323 187.207,-393 190.3126,-394.6701 193.5171,-396.2877 196.7859,-397.8506"/>
<polygon fill="#666666" stroke="#666666" points="195.5878,-401.1507 206.1392,-402.1088 198.4882,-394.7799 195.5878,-401.1507"/>
</g>
<!-- write_batch_ -->
<g id="node13" class="node">
<title>write_batch_</title>
<polygon fill="#95e1d3" stroke="#000000" points="413.4209,-394 413.4209,-460 633.1797,-460 633.1797,-394 413.4209,-394"/>
<text text-anchor="middle" x="523.3003" y="-444.8" font-family="Times,serif" font-size="14.00" fill="#000000">write_batch_</text>
<polyline fill="none" stroke="#000000" points="413.4209,-438 633.1797,-438 "/>
<text text-anchor="start" x="421.4209" y="-422.8" font-family="Times,serif" font-size="14.00" fill="#000000">WriteBatchWithIndex write_batch_;</text>
<polyline fill="none" stroke="#000000" points="413.4209,-416 633.1797,-416 "/>
<text text-anchor="start" x="421.4209" y="-400.8" font-family="Times,serif" font-size="14.00" fill="#000000">struct Rep</text>
<polyline fill="none" stroke="#000000" points="413.4209,-394 633.1797,-394 "/>
</g>
<!-- GetBatchForWrite&#45;&gt;write_batch_ -->
<g id="edge15" class="edge">
<title>GetBatchForWrite&#45;&gt;write_batch_</title>
<path fill="none" stroke="#666666" d="M377.2122,-427C385.7324,-427 394.4316,-427 403.1285,-427"/>
<polygon fill="#666666" stroke="#666666" points="403.3262,-430.5001 413.3261,-427 403.3261,-423.5001 403.3262,-430.5001"/>
</g>
<!-- PessimisticTransaction_TryLock&#45;&gt;GetTrackedKeys -->
<g id="edge22" class="edge">
<title>PessimisticTransaction_TryLock&#45;&gt;GetTrackedKeys</title>
<path fill="none" stroke="#3f72af" d="M555.9465,-119.5181C578.2992,-130.6227 608.2838,-146.4765 633.1797,-163 677.6377,-192.507 724.9255,-232.3177 753.9298,-257.8294"/>
<polygon fill="#3f72af" stroke="#3f72af" points="751.8001,-260.6185 761.608,-264.6254 756.4395,-255.3767 751.8001,-260.6185"/>
</g>
<!-- PessimisticTransaction_TryLock&#45;&gt;TrackKey -->
<g id="edge23" class="edge">
<title>PessimisticTransaction_TryLock&#45;&gt;TrackKey</title>
<path fill="none" stroke="#3f72af" d="M555.7759,-113.365C580.6179,-122.1945 613.8013,-137.8866 633.1797,-163 674.2339,-216.2041 624.3642,-259.4018 668.5903,-310 670.1129,-311.742 671.713,-313.4155 673.381,-315.0231"/>
<polygon fill="#3f72af" stroke="#3f72af" points="671.2358,-317.7945 681.1009,-321.6586 675.7987,-312.4859 671.2358,-317.7945"/>
</g>
<!-- PessimisticTransactionDB_TryLock -->
<g id="node19" class="node">
<title>PessimisticTransactionDB_TryLock</title>
<polygon fill="none" stroke="#000000" points="749.5903,-86 749.5903,-122 814.0845,-122 814.0845,-86 749.5903,-86"/>
<text text-anchor="middle" x="781.8374" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock</text>
</g>
<!-- PessimisticTransaction_TryLock&#45;&gt;PessimisticTransactionDB_TryLock -->
<g id="edge24" class="edge">
<title>PessimisticTransaction_TryLock&#45;&gt;PessimisticTransactionDB_TryLock</title>
<path fill="none" stroke="#3f72af" d="M555.7824,-104C602.2203,-104 687.6494,-104 739.148,-104"/>
<polygon fill="#3f72af" stroke="#3f72af" points="739.2848,-107.5001 749.2848,-104 739.2848,-100.5001 739.2848,-107.5001"/>
</g>
<!-- OptimisticTransaction_TryLock&#45;&gt;TrackKey -->
<g id="edge18" class="edge">
<title>OptimisticTransaction_TryLock&#45;&gt;TrackKey</title>
<path fill="none" stroke="#666666" d="M555.9268,-206.1601C579.4078,-216.1046 610.7635,-231.9559 633.1797,-253 654.9233,-273.4127 645.6409,-290.953 668.5903,-310 669.9573,-311.1345 671.3568,-312.242 672.7854,-313.323"/>
<polygon fill="#666666" stroke="#666666" points="671.0537,-316.3822 681.259,-319.2285 675.0561,-310.6393 671.0537,-316.3822"/>
</g>
<!-- TransactionLockMgr_TryLock -->
<g id="node16" class="node">
<title>TransactionLockMgr_TryLock</title>
<polygon fill="none" stroke="#000000" points="1008.6626,-86 1008.6626,-122 1073.1567,-122 1073.1567,-86 1008.6626,-86"/>
<text text-anchor="middle" x="1040.9097" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#000000">TryLock</text>
</g>
<!-- lock_maps_cache_ -->
<g id="node17" class="node">
<title>lock_maps_cache_</title>
<polygon fill="none" stroke="#000000" points="1259.25,-18.0002 1259.25,-189.9998 1473.1162,-189.9998 1473.1162,-18.0002 1259.25,-18.0002"/>
<text text-anchor="middle" x="1366.1831" y="-174.7998" font-family="Times,serif" font-size="14.00" fill="#000000">lock_maps_cache_</text>
<polyline fill="none" stroke="#000000" points="1259.25,-167.9998 1473.1162,-167.9998 "/>
<text text-anchor="start" x="1267.25" y="-152.7998" font-family="Times,serif" font-size="14.00" fill="#000000">对LockMaps的ThreadLocal Cache</text>
<polyline fill="none" stroke="#000000" points="1259.25,-140.3999 1473.1162,-140.3999 "/>
<text text-anchor="start" x="1267.25" y="-125.1999" font-family="Times,serif" font-size="14.00" fill="#000000">在cache中找不到的</text>
<text text-anchor="start" x="1267.25" y="-105.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 使用mutex访问</text>
<text text-anchor="start" x="1267.25" y="-86" font-family="Times,serif" font-size="14.00" fill="#000000"> 全局LockMaps并</text>
<text text-anchor="start" x="1267.25" y="-66.4001" font-family="Times,serif" font-size="14.00" fill="#000000"> 更新线程局部cache</text>
<polyline fill="none" stroke="#000000" points="1259.25,-54.0002 1473.1162,-54.0002 "/>
<text text-anchor="start" x="1267.25" y="-38.8002" font-family="Times,serif" font-size="14.00" fill="#000000">std::unique_ptr&lt;ThreadLocalPtr&gt;</text>
<text text-anchor="start" x="1267.25" y="-24.8002" font-family="Times,serif" font-size="14.00" fill="#000000"> lock_maps_cache_;</text>
</g>
<!-- TransactionLockMgr_TryLock&#45;&gt;lock_maps_cache_ -->
<g id="edge19" class="edge">
<title>TransactionLockMgr_TryLock&#45;&gt;lock_maps_cache_</title>
<path fill="none" stroke="#666666" d="M1073.2873,-104C1114.0055,-104 1186.1606,-104 1248.6624,-104"/>
<polygon fill="#666666" stroke="#666666" points="1249.004,-107.5001 1259.004,-104 1249.004,-100.5001 1249.004,-107.5001"/>
</g>
<!-- LockInfo -->
<g id="node18" class="node">
<title>LockInfo</title>
<polygon fill="#95e1d3" stroke="#000000" points="1582.042,-16.8002 1582.042,-191.1998 1801.9033,-191.1998 1801.9033,-16.8002 1582.042,-16.8002"/>
<text text-anchor="start" x="1590.042" y="-175.9998" font-family="Times,serif" font-size="14.00" fill="#000000">LockInfo</text>
<polyline fill="none" stroke="#000000" points="1582.042,-169.1998 1801.9033,-169.1998 "/>
<text text-anchor="start" x="1590.042" y="-153.9998" font-family="Times,serif" font-size="14.00" fill="#000000">保存了key对应的lock信息</text>
<text text-anchor="start" x="1590.042" y="-134.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> 是否是排他锁</text>
<text text-anchor="start" x="1590.042" y="-114.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 持有该key 的事务id</text>
<text text-anchor="start" x="1590.042" y="-95.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 过期时间</text>
<polyline fill="none" stroke="#000000" points="1582.042,-82.8002 1801.9033,-82.8002 "/>
<text text-anchor="start" x="1590.042" y="-67.6002" font-family="Times,serif" font-size="14.00" fill="#000000">bool exclusive;</text>
<polyline fill="none" stroke="#000000" points="1582.042,-60.8002 1801.9033,-60.8002 "/>
<text text-anchor="start" x="1590.042" y="-45.6002" font-family="Times,serif" font-size="14.00" fill="#000000">autovector&lt;TransactionID&gt; txn_ids;</text>
<polyline fill="none" stroke="#000000" points="1582.042,-38.8002 1801.9033,-38.8002 "/>
<text text-anchor="start" x="1590.042" y="-23.6002" font-family="Times,serif" font-size="14.00" fill="#000000">uint64_t expiration_time;</text>
</g>
<!-- lock_maps_cache_&#45;&gt;LockInfo -->
<g id="edge20" class="edge">
<title>lock_maps_cache_&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" stroke-dasharray="5,2" d="M1473.31,-104C1504.7715,-104 1539.3893,-104 1571.6181,-104"/>
<polygon fill="#666666" stroke="#666666" points="1571.9911,-107.5001 1581.991,-104 1571.991,-100.5001 1571.9911,-107.5001"/>
</g>
<!-- PessimisticTransactionDB_TryLock&#45;&gt;TransactionLockMgr_TryLock -->
<g id="edge21" class="edge">
<title>PessimisticTransactionDB_TryLock&#45;&gt;TransactionLockMgr_TryLock</title>
<path fill="none" stroke="#666666" d="M814.1253,-104C860.6975,-104 946.7924,-104 998.4588,-104"/>
<polygon fill="#666666" stroke="#666666" points="998.6229,-107.5001 1008.6228,-104 998.6228,-100.5001 998.6229,-107.5001"/>
</g>
</g>
</svg>
