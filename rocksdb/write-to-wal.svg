<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: write_to_wal Pages: 1 -->
<svg width="1024pt" height="655pt"
 viewBox="0.00 0.00 1024.00 655.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 651)">
<title>write_to_wal</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-651 1020,-651 1020,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_log_writer</title>
<polygon fill="none" stroke="#000000" points="139,-8 139,-495 1008,-495 1008,-8 139,-8"/>
<text text-anchor="middle" x="573.5" y="-475" font-family="Times,serif" font-size="20.00" fill="#000000">log_writer</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_WritableFileWriter</title>
<polygon fill="none" stroke="#000000" points="653.5,-62 653.5,-144 821.5,-144 821.5,-62 653.5,-62"/>
<text text-anchor="middle" x="737.5" y="-124" font-family="Times,serif" font-size="20.00" fill="#000000">WritableFileWriter</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_LogFileFormat</title>
<polygon fill="none" stroke="#000000" points="390,-271 390,-457 1000,-457 1000,-271 390,-271"/>
<text text-anchor="middle" x="695" y="-437" font-family="Times,serif" font-size="20.00" fill="#000000">LogFileFormat</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_DBImpl</title>
<polygon fill="none" stroke="#000000" points="8,-503 8,-639 305,-639 305,-503 8,-503"/>
<text text-anchor="middle" x="156.5" y="-619" font-family="Times,serif" font-size="20.00" fill="#000000">DBImpl</text>
</g>
<!-- AddRecord -->
<g id="node1" class="node">
<title>AddRecord</title>
<polygon fill="none" stroke="#000000" points="147,-211.5 147,-272.5 340,-272.5 340,-211.5 147,-211.5"/>
<text text-anchor="middle" x="243.5" y="-257.3" font-family="Times,serif" font-size="14.00" fill="#000000">AddRecord</text>
<polyline fill="none" stroke="#000000" points="147,-249.5 340,-249.5 "/>
<text text-anchor="start" x="155" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#000000">将logentry按照kblockSize分片</text>
<text text-anchor="start" x="155" y="-219.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 写入日志中</text>
</g>
<!-- EmitPhysicalRecord -->
<g id="node2" class="node">
<title>EmitPhysicalRecord</title>
<polygon fill="none" stroke="#000000" points="376,-144.5 376,-205.5 573,-205.5 573,-144.5 376,-144.5"/>
<text text-anchor="middle" x="474.5" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#000000">EmitPhysicalRecord</text>
<polyline fill="none" stroke="#000000" points="376,-182.5 573,-182.5 "/>
<text text-anchor="start" x="384" y="-167.3" font-family="Times,serif" font-size="14.00" fill="#000000">构造crc和size header</text>
<text text-anchor="start" x="384" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 然后将整条record写入文件中</text>
</g>
<!-- AddRecord&#45;&gt;EmitPhysicalRecord -->
<g id="edge1" class="edge">
<title>AddRecord&#45;&gt;EmitPhysicalRecord</title>
<path fill="none" stroke="#666666" d="M340.1263,-213.9742C348.6599,-211.4991 357.3347,-208.983 365.9577,-206.482"/>
<polygon fill="#666666" stroke="#666666" points="367.0317,-209.8148 375.6609,-203.6676 365.0817,-203.0919 367.0317,-209.8148"/>
</g>
<!-- Flush -->
<g id="node3" class="node">
<title>Flush</title>
<polygon fill="none" stroke="#000000" points="501.5,-260 447.5,-260 447.5,-224 501.5,-224 501.5,-260"/>
<text text-anchor="middle" x="474.5" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#000000">Flush</text>
</g>
<!-- AddRecord&#45;&gt;Flush -->
<g id="edge2" class="edge">
<title>AddRecord&#45;&gt;Flush</title>
<path fill="none" stroke="#666666" d="M340.1263,-242C374.3548,-242 410.8561,-242 437.1642,-242"/>
<polygon fill="#666666" stroke="#666666" points="437.4252,-245.5001 447.4251,-242 437.4251,-238.5001 437.4252,-245.5001"/>
</g>
<!-- EncodeFixed32 -->
<g id="node4" class="node">
<title>EncodeFixed32</title>
<polygon fill="none" stroke="#000000" points="787.5,-52 686.5,-52 686.5,-16 787.5,-16 787.5,-52"/>
<text text-anchor="middle" x="737" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#000000">EncodeFixed32</text>
</g>
<!-- EmitPhysicalRecord&#45;&gt;EncodeFixed32 -->
<g id="edge3" class="edge">
<title>EmitPhysicalRecord&#45;&gt;EncodeFixed32</title>
<path fill="none" stroke="#666666" d="M500.6227,-144.4917C525.6198,-117.3775 565.8177,-78.8934 609,-58 629.8262,-47.9234 654.4544,-42.0678 676.5176,-38.6688"/>
<polygon fill="#666666" stroke="#666666" points="677.0354,-42.1305 686.4514,-37.2736 676.0618,-35.1986 677.0354,-42.1305"/>
</g>
<!-- Append -->
<g id="node5" class="node">
<title>Append</title>
<polygon fill="none" stroke="#000000" points="766.5,-106 707.5,-106 707.5,-70 766.5,-70 766.5,-106"/>
<text text-anchor="middle" x="737" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#000000">Append</text>
</g>
<!-- EmitPhysicalRecord&#45;&gt;Append -->
<g id="edge4" class="edge">
<title>EmitPhysicalRecord&#45;&gt;Append</title>
<path fill="none" stroke="#666666" d="M529.009,-144.3537C552.9198,-132.0539 581.71,-118.7476 609,-110 637.8739,-100.7447 671.732,-95.1424 697.371,-91.9092"/>
<polygon fill="#666666" stroke="#666666" points="697.9512,-95.3649 707.4659,-90.7043 697.1216,-88.4142 697.9512,-95.3649"/>
</g>
<!-- crc32c_Extend -->
<g id="node6" class="node">
<title>crc32c_Extend</title>
<polygon fill="none" stroke="#000000" points="688,-152 688,-198 786,-198 786,-152 688,-152"/>
<text text-anchor="middle" x="737" y="-182.8" font-family="Times,serif" font-size="14.00" fill="#000000">crc32c_Extend</text>
<polyline fill="none" stroke="#000000" points="688,-175 786,-175 "/>
<text text-anchor="middle" x="737" y="-159.8" font-family="Times,serif" font-size="14.00" fill="#000000">计算crc32c</text>
</g>
<!-- EmitPhysicalRecord&#45;&gt;crc32c_Extend -->
<g id="edge5" class="edge">
<title>EmitPhysicalRecord&#45;&gt;crc32c_Extend</title>
<path fill="none" stroke="#666666" d="M573.3659,-175C608.4901,-175 646.9147,-175 677.6978,-175"/>
<polygon fill="#666666" stroke="#666666" points="677.8286,-178.5001 687.8285,-175 677.8285,-171.5001 677.8286,-178.5001"/>
</g>
<!-- dest_ -->
<g id="node7" class="node">
<title>dest_</title>
<polygon fill="#95e1d3" stroke="#000000" points="609,-217 609,-263 865,-263 865,-217 609,-217"/>
<text text-anchor="middle" x="737" y="-247.8" font-family="Times,serif" font-size="14.00" fill="#000000">dest_</text>
<polyline fill="none" stroke="#000000" points="609,-240 865,-240 "/>
<text text-anchor="middle" x="737" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#000000">std::unique_ptr&lt;WritableFileWriter&gt; dest_;</text>
</g>
<!-- EmitPhysicalRecord&#45;&gt;dest_ -->
<g id="edge6" class="edge">
<title>EmitPhysicalRecord&#45;&gt;dest_</title>
<path fill="none" stroke="#666666" d="M573.3659,-199.4811C593.2244,-204.3984 614.1379,-209.577 634.1288,-214.5271"/>
<polygon fill="#666666" stroke="#666666" points="633.3117,-217.9304 643.8598,-216.9367 634.9943,-211.1356 633.3117,-217.9304"/>
</g>
<!-- Record -->
<g id="node8" class="node">
<title>Record</title>
<polygon fill="#95e1d3" stroke="#000000" points="700.5,-303.5 700.5,-418.5 773.5,-418.5 773.5,-303.5 700.5,-303.5"/>
<text text-anchor="middle" x="737" y="-403.3" font-family="Times,serif" font-size="14.00" fill="#000000">Record</text>
<polyline fill="none" stroke="#000000" points="700.5,-395.5 773.5,-395.5 "/>
<text text-anchor="start" x="708.5" y="-380.3" font-family="Times,serif" font-size="14.00" fill="#000000">CRC (4B)</text>
<polyline fill="none" stroke="#000000" points="700.5,-372.5 773.5,-372.5 "/>
<text text-anchor="start" x="708.5" y="-357.3" font-family="Times,serif" font-size="14.00" fill="#000000">Size (2B) </text>
<polyline fill="none" stroke="#000000" points="700.5,-349.5 773.5,-349.5 "/>
<text text-anchor="start" x="708.5" y="-334.3" font-family="Times,serif" font-size="14.00" fill="#000000">Type (1B)</text>
<polyline fill="none" stroke="#000000" points="700.5,-326.5 773.5,-326.5 "/>
<text text-anchor="start" x="708.5" y="-311.3" font-family="Times,serif" font-size="14.00" fill="#000000">Payload</text>
</g>
<!-- EmitPhysicalRecord&#45;&gt;Record -->
<g id="edge7" class="edge">
<title>EmitPhysicalRecord&#45;&gt;Record</title>
<path fill="none" stroke="#666666" d="M561.863,-205.708C565.8286,-208.5488 569.5744,-211.6394 573,-215 601.9945,-243.4446 580.9499,-269.6237 609,-299 631.2489,-322.3008 664.0687,-337.9556 690.9044,-347.7055"/>
<polygon fill="#666666" stroke="#666666" points="689.895,-351.0599 700.4898,-351.0336 692.1911,-344.4472 689.895,-351.0599"/>
</g>
<!-- Type -->
<g id="node10" class="node">
<title>Type</title>
<polygon fill="none" stroke="#000000" points="901,-280 901,-418 992,-418 992,-280 901,-280"/>
<text text-anchor="middle" x="946.5" y="-402.8" font-family="Times,serif" font-size="14.00" fill="#000000">Type</text>
<polyline fill="none" stroke="#000000" points="901,-395 992,-395 "/>
<text text-anchor="start" x="909" y="-379.8" font-family="Times,serif" font-size="14.00" fill="#000000">kZeroType</text>
<polyline fill="none" stroke="#000000" points="901,-372 992,-372 "/>
<text text-anchor="start" x="909" y="-356.8" font-family="Times,serif" font-size="14.00" fill="#000000">kFullType</text>
<polyline fill="none" stroke="#000000" points="901,-349 992,-349 "/>
<text text-anchor="start" x="909" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#000000">kFirstType</text>
<polyline fill="none" stroke="#000000" points="901,-326 992,-326 "/>
<text text-anchor="start" x="909" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#000000">kLastType</text>
<polyline fill="none" stroke="#000000" points="901,-303 992,-303 "/>
<text text-anchor="start" x="909" y="-287.8" font-family="Times,serif" font-size="14.00" fill="#000000">kMiddleType</text>
</g>
<!-- Record&#45;&gt;Type -->
<g id="edge9" class="edge">
<title>Record:Type&#45;&gt;Type</title>
<path fill="none" stroke="#666666" d="M774,-338C813.0254,-338 856.9166,-340.8387 890.6592,-343.6319"/>
<polygon fill="#666666" stroke="#666666" points="890.5277,-347.1333 900.7885,-344.4941 891.1214,-340.1585 890.5277,-347.1333"/>
</g>
<!-- LogFile -->
<g id="node9" class="node">
<title>LogFile</title>
<polygon fill="#95e1d3" stroke="#000000" points="398,-280 398,-418 551,-418 551,-280 398,-280"/>
<text text-anchor="middle" x="474.5" y="-402.8" font-family="Times,serif" font-size="14.00" fill="#000000">LogFile</text>
<polyline fill="none" stroke="#000000" points="398,-395 551,-395 "/>
<text text-anchor="middle" x="419" y="-379.8" font-family="Times,serif" font-size="14.00" fill="#000000">r0</text>
<polyline fill="none" stroke="#000000" points="440,-372 440,-395 "/>
<text text-anchor="middle" x="461.5" y="-379.8" font-family="Times,serif" font-size="14.00" fill="#000000">r1</text>
<polyline fill="none" stroke="#000000" points="483,-372 483,-395 "/>
<text text-anchor="middle" x="517" y="-379.8" font-family="Times,serif" font-size="14.00" fill="#000000">pading</text>
<polyline fill="none" stroke="#000000" points="398,-372 551,-372 "/>
<text text-anchor="middle" x="423" y="-356.8" font-family="Times,serif" font-size="14.00" fill="#000000">r2:full</text>
<polyline fill="none" stroke="#000000" points="448,-349 448,-372 "/>
<text text-anchor="middle" x="473" y="-356.8" font-family="Times,serif" font-size="14.00" fill="#000000">r3:full</text>
<polyline fill="none" stroke="#000000" points="498,-349 498,-372 "/>
<text text-anchor="middle" x="524.5" y="-356.8" font-family="Times,serif" font-size="14.00" fill="#000000">r4:first</text>
<polyline fill="none" stroke="#000000" points="398,-349 551,-349 "/>
<text text-anchor="middle" x="474.5" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#000000">r4:mid</text>
<polyline fill="none" stroke="#000000" points="398,-326 551,-326 "/>
<text text-anchor="middle" x="441.5" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#000000">r4:last</text>
<polyline fill="none" stroke="#000000" points="485,-303 485,-326 "/>
<text text-anchor="middle" x="518" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#000000">r5</text>
<polyline fill="none" stroke="#000000" points="398,-303 551,-303 "/>
<text text-anchor="middle" x="474.5" y="-287.8" font-family="Times,serif" font-size="14.00" fill="#000000">kBlockSize..</text>
</g>
<!-- LogFile&#45;&gt;Record -->
<g id="edge8" class="edge">
<title>LogFile:r4&#45;&gt;Record</title>
<path fill="none" stroke="#666666" d="M551.5,-361C598.7468,-361 652.7626,-361 690.2726,-361"/>
<polygon fill="#666666" stroke="#666666" points="690.3953,-364.5001 700.3953,-361 690.3952,-357.5001 690.3953,-364.5001"/>
</g>
<!-- WriteToWAL -->
<g id="node11" class="node">
<title>WriteToWAL</title>
<polygon fill="none" stroke="#000000" points="111,-547 16,-547 16,-511 111,-511 111,-547"/>
<text text-anchor="middle" x="63.5" y="-525.3" font-family="Times,serif" font-size="14.00" fill="#000000">WriteToWAL</text>
</g>
<!-- WriteToWAL&#45;&gt;AddRecord -->
<g id="edge10" class="edge">
<title>WriteToWAL&#45;&gt;AddRecord</title>
<path fill="none" stroke="#666666" d="M75.0336,-510.6103C103.8026,-464.7397 179.2484,-344.4456 218.6825,-281.5701"/>
<polygon fill="#666666" stroke="#666666" points="221.8813,-283.0571 224.2295,-272.7257 215.9511,-279.3378 221.8813,-283.0571"/>
</g>
<!-- alive_log_files_ -->
<g id="node12" class="node">
<title>alive_log_files_</title>
<polygon fill="none" stroke="#000000" points="295.5,-547 191.5,-547 191.5,-511 295.5,-511 295.5,-547"/>
<text text-anchor="middle" x="243.5" y="-525.3" font-family="Times,serif" font-size="14.00" fill="#000000">alive_log_files_</text>
</g>
<!-- WriteToWAL&#45;&gt;alive_log_files_ -->
<g id="edge11" class="edge">
<title>WriteToWAL&#45;&gt;alive_log_files_</title>
<path fill="none" stroke="#666666" d="M111.2641,-529C132.6698,-529 158.198,-529 181.0898,-529"/>
<polygon fill="#666666" stroke="#666666" points="181.3979,-532.5001 191.3978,-529 181.3978,-525.5001 181.3979,-532.5001"/>
</g>
<!-- logfile_number_ -->
<g id="node13" class="node">
<title>logfile_number_</title>
<polygon fill="none" stroke="#000000" points="297,-601 190,-601 190,-565 297,-565 297,-601"/>
<text text-anchor="middle" x="243.5" y="-579.3" font-family="Times,serif" font-size="14.00" fill="#000000">logfile_number_</text>
</g>
<!-- WriteToWAL&#45;&gt;logfile_number_ -->
<g id="edge12" class="edge">
<title>WriteToWAL&#45;&gt;logfile_number_</title>
<path fill="none" stroke="#666666" d="M111.2093,-546.7982C120.3831,-550.011 129.9516,-553.2194 139,-556 152.188,-560.0527 166.4343,-564.0077 180.0392,-567.5859"/>
<polygon fill="#666666" stroke="#666666" points="179.2495,-570.9968 189.808,-570.1208 181.0077,-564.2212 179.2495,-570.9968"/>
</g>
</g>
</svg>
