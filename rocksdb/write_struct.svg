<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: write_struct Pages: 1 -->
<svg width="1408pt" height="486pt"
 viewBox="0.00 0.00 1408.16 485.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 481.5999)">
<title>write_struct</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-481.5999 1404.1553,-481.5999 1404.1553,4 -4,4"/>
<!-- DBImpl -->
<g id="node1" class="node">
<title>DBImpl</title>
<polygon fill="none" stroke="#000000" points="288.3413,-346.3 288.3413,-390.3 460.4331,-390.3 460.4331,-346.3 288.3413,-346.3"/>
<text text-anchor="middle" x="374.3872" y="-375.1" font-family="Times,serif" font-size="14.00" fill="#000000">DBImpl</text>
<polyline fill="none" stroke="#000000" points="288.3413,-368.3 460.4331,-368.3 "/>
<text text-anchor="start" x="296.3413" y="-353.1" font-family="Times,serif" font-size="14.00" fill="#000000">WriteThread write_thread_;</text>
</g>
<!-- WriteThread -->
<g id="node2" class="node">
<title>WriteThread</title>
<polygon fill="none" stroke="#000000" points="531.252,-259.5 531.252,-477.0999 836.5283,-477.0999 836.5283,-259.5 531.252,-259.5"/>
<text text-anchor="middle" x="683.8901" y="-461.8999" font-family="Times,serif" font-size="14.00" fill="#000000">WriteThread</text>
<polyline fill="none" stroke="#000000" points="531.252,-455.0999 836.5283,-455.0999 "/>
<text text-anchor="start" x="539.252" y="-439.8999" font-family="Times,serif" font-size="14.00" fill="#000000">当前writer链表队列</text>
<text text-anchor="start" x="539.252" y="-420.3" font-family="Times,serif" font-size="14.00" fill="#000000"> std::atomic&lt;Writer*&gt; newest_writer_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-413.5 836.5283,-413.5 "/>
<text text-anchor="start" x="539.252" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#000000">std::atomic&lt;Writer*&gt; newest_memtable_writer_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-391.5 836.5283,-391.5 "/>
<text text-anchor="start" x="539.252" y="-376.3" font-family="Times,serif" font-size="14.00" fill="#000000">Writer write_stall_dummy_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-369.5 836.5283,-369.5 "/>
<text text-anchor="start" x="539.252" y="-354.3" font-family="Times,serif" font-size="14.00" fill="#000000">SequenceNumber last_sequence_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-347.5 836.5283,-347.5 "/>
<text text-anchor="start" x="539.252" y="-332.3" font-family="Times,serif" font-size="14.00" fill="#000000">const bool enable_pipelined_write_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-325.5 836.5283,-325.5 "/>
<text text-anchor="start" x="539.252" y="-310.3" font-family="Times,serif" font-size="14.00" fill="#000000">const uint64_t max_write_batch_group_size_bytes;</text>
<polyline fill="none" stroke="#000000" points="531.252,-303.5 836.5283,-303.5 "/>
<text text-anchor="start" x="539.252" y="-288.3" font-family="Times,serif" font-size="14.00" fill="#000000">port::Mutex stall_mu_;</text>
<polyline fill="none" stroke="#000000" points="531.252,-281.5 836.5283,-281.5 "/>
<text text-anchor="start" x="539.252" y="-266.3" font-family="Times,serif" font-size="14.00" fill="#000000">port::CondVar stall_cv_;</text>
</g>
<!-- DBImpl&#45;&gt;WriteThread -->
<g id="edge1" class="edge">
<title>DBImpl:WriteThread&#45;&gt;WriteThread</title>
<path fill="none" stroke="#666666" d="M460.3872,-357.3C480.0851,-357.3 500.7478,-357.7315 521.2204,-358.4235"/>
<polygon fill="#666666" stroke="#666666" points="521.1311,-361.9225 531.2502,-358.7835 521.3822,-354.927 521.1311,-361.9225"/>
</g>
<!-- Writer -->
<g id="node4" class="node">
<title>Writer</title>
<polygon fill="none" stroke="#000000" points="872.5283,-.5 872.5283,-414.0999 1151.8623,-414.0999 1151.8623,-.5 872.5283,-.5"/>
<text text-anchor="middle" x="1012.1953" y="-398.8999" font-family="Times,serif" font-size="14.00" fill="#000000">Writer</text>
<polyline fill="none" stroke="#000000" points="872.5283,-392.0999 1151.8623,-392.0999 "/>
<text text-anchor="start" x="880.5283" y="-376.8999" font-family="Times,serif" font-size="14.00" fill="#000000">WriteBatch* batch;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-370.0999 1151.8623,-370.0999 "/>
<text text-anchor="start" x="880.5283" y="-354.8999" font-family="Times,serif" font-size="14.00" fill="#000000">bool sync;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-348.0999 1151.8623,-348.0999 "/>
<text text-anchor="start" x="880.5283" y="-332.8999" font-family="Times,serif" font-size="14.00" fill="#000000">bool no_slowdown;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-326.0999 1151.8623,-326.0999 "/>
<text text-anchor="start" x="880.5283" y="-310.8999" font-family="Times,serif" font-size="14.00" fill="#000000">bool disable_wal;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-304.0999 1151.8623,-304.0999 "/>
<text text-anchor="start" x="880.5283" y="-288.8999" font-family="Times,serif" font-size="14.00" fill="#000000">bool disable_memtable;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-282.0999 1151.8623,-282.0999 "/>
<text text-anchor="start" x="880.5283" y="-266.8999" font-family="Times,serif" font-size="14.00" fill="#000000">size_t batch_cnt;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-260.0999 1151.8623,-260.0999 "/>
<text text-anchor="start" x="880.5283" y="-244.8999" font-family="Times,serif" font-size="14.00" fill="#000000">PreReleaseCallback* pre_release_callback;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-238.0999 1151.8623,-238.0999 "/>
<text text-anchor="start" x="880.5283" y="-222.8999" font-family="Times,serif" font-size="14.00" fill="#000000">uint64_t log_used;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-216.0999 1151.8623,-216.0999 "/>
<text text-anchor="start" x="880.5283" y="-200.8999" font-family="Times,serif" font-size="14.00" fill="#000000">uint64_t log_ref;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-194.0999 1151.8623,-194.0999 "/>
<text text-anchor="start" x="880.5283" y="-178.8999" font-family="Times,serif" font-size="14.00" fill="#000000">WriteCallback* callback;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-172.0999 1151.8623,-172.0999 "/>
<text text-anchor="start" x="880.5283" y="-156.8999" font-family="Times,serif" font-size="14.00" fill="#000000">std::atomic&lt;uint8_t&gt; state;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-150.0999 1151.8623,-150.0999 "/>
<text text-anchor="start" x="880.5283" y="-134.8999" font-family="Times,serif" font-size="14.00" fill="#000000">WriteGroup* write_group;</text>
<text text-anchor="start" x="880.5283" y="-120.8999" font-family="Times,serif" font-size="14.00" fill="#000000"> std::aligned_storage&lt;sizeof(std::mutex)&gt;</text>
<text text-anchor="start" x="880.5283" y="-106.8999" font-family="Times,serif" font-size="14.00" fill="#000000">::type state_mutex_bytes;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-100.0999 1151.8623,-100.0999 "/>
<text text-anchor="start" x="880.5283" y="-84.8999" font-family="Times,serif" font-size="14.00" fill="#000000">std::aligned_storage&lt;sizeof(</text>
<text text-anchor="start" x="880.5283" y="-70.8999" font-family="Times,serif" font-size="14.00" fill="#000000">std::condition_variable)&gt;::type state_cv_bytes;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-64.0999 1151.8623,-64.0999 "/>
<text text-anchor="start" x="880.5283" y="-48.8999" font-family="Times,serif" font-size="14.00" fill="#000000">双向链表</text>
<text text-anchor="start" x="880.5283" y="-29.3" font-family="Times,serif" font-size="14.00" fill="#000000">Writer* link_older;</text>
<polyline fill="none" stroke="#000000" points="872.5283,-22.5 1151.8623,-22.5 "/>
<text text-anchor="start" x="880.5283" y="-7.3" font-family="Times,serif" font-size="14.00" fill="#000000">Writer* link_newer;</text>
</g>
<!-- WriteThread&#45;&gt;Writer -->
<g id="edge6" class="edge">
<title>WriteThread:Writer&#45;&gt;Writer</title>
<path fill="none" stroke="#666666" d="M836.5283,-434.3C856.2899,-434.3 874.1443,-428.8528 890.2084,-419.6461"/>
<polygon fill="#666666" stroke="#666666" points="892.3433,-422.4383 898.9494,-414.1552 888.6197,-416.5108 892.3433,-422.4383"/>
</g>
<!-- WriteGroup -->
<g id="node3" class="node">
<title>WriteGroup</title>
<polygon fill="none" stroke="#000000" points="583.564,-130.3 583.564,-240.3 784.2163,-240.3 784.2163,-130.3 583.564,-130.3"/>
<text text-anchor="middle" x="683.8901" y="-225.1" font-family="Times,serif" font-size="14.00" fill="#000000">WriteGroup</text>
<polyline fill="none" stroke="#000000" points="583.564,-218.3 784.2163,-218.3 "/>
<text text-anchor="start" x="591.564" y="-203.1" font-family="Times,serif" font-size="14.00" fill="#000000">Writer* leader = nullptr;</text>
<polyline fill="none" stroke="#000000" points="583.564,-196.3 784.2163,-196.3 "/>
<text text-anchor="start" x="591.564" y="-181.1" font-family="Times,serif" font-size="14.00" fill="#000000">Writer* last_writer = nullptr;</text>
<polyline fill="none" stroke="#000000" points="583.564,-174.3 784.2163,-174.3 "/>
<text text-anchor="start" x="591.564" y="-159.1" font-family="Times,serif" font-size="14.00" fill="#000000">SequenceNumber last_sequence;</text>
<polyline fill="none" stroke="#000000" points="583.564,-152.3 784.2163,-152.3 "/>
<text text-anchor="start" x="591.564" y="-137.1" font-family="Times,serif" font-size="14.00" fill="#000000">Status status;</text>
<polyline fill="none" stroke="#000000" points="583.564,-130.3 784.2163,-130.3 "/>
</g>
<!-- WriteGroup&#45;&gt;Writer -->
<g id="edge2" class="edge">
<title>WriteGroup:Writer&#45;&gt;Writer</title>
<path fill="none" stroke="#666666" d="M783.8901,-207.3C809.1714,-207.3 836.0275,-207.3 862.1042,-207.3"/>
<polygon fill="#666666" stroke="#666666" points="862.442,-210.8001 872.442,-207.3 862.4419,-203.8001 862.442,-210.8001"/>
</g>
<!-- Writer2 -->
<g id="node5" class="node">
<title>Writer2</title>
<polygon fill="none" stroke="#000000" points="1187.8623,-8.7 1187.8623,-77.8999 1309.8398,-77.8999 1309.8398,-8.7 1187.8623,-8.7"/>
<text text-anchor="middle" x="1248.8511" y="-62.6999" font-family="Times,serif" font-size="14.00" fill="#000000">Writer2</text>
<polyline fill="none" stroke="#000000" points="1187.8623,-55.8999 1309.8398,-55.8999 "/>
<text text-anchor="start" x="1195.8623" y="-40.6999" font-family="Times,serif" font-size="14.00" fill="#000000">Writer双向链表上</text>
<text text-anchor="middle" x="1248.8511" y="-21.1" font-family="Times,serif" font-size="14.00" fill="#000000"> 其他Writer..</text>
</g>
<!-- Writer&#45;&gt;Writer2 -->
<g id="edge3" class="edge">
<title>Writer:Older&#45;&gt;Writer2</title>
<path fill="none" stroke="#666666" d="M1151.8623,-43.3C1160.2131,-43.3 1168.9683,-43.3 1177.6578,-43.3"/>
<polygon fill="#666666" stroke="#666666" points="1177.8003,-46.8001 1187.8002,-43.3 1177.8002,-39.8001 1177.8003,-46.8001"/>
</g>
<!-- Write3 -->
<g id="node6" class="node">
<title>Write3</title>
<polygon fill="none" stroke="#000000" points="1400.3139,-61.3 1345.6812,-61.3 1345.6812,-25.3 1400.3139,-25.3 1400.3139,-61.3"/>
<text text-anchor="middle" x="1372.9976" y="-39.1" font-family="Times,serif" font-size="14.00" fill="#000000">Write3</text>
</g>
<!-- Writer2&#45;&gt;Write3 -->
<g id="edge4" class="edge">
<title>Writer2&#45;&gt;Write3</title>
<path fill="none" stroke="#666666" d="M1310.1969,-43.3C1318.8619,-43.3 1327.5458,-43.3 1335.5731,-43.3"/>
<polygon fill="#666666" stroke="#666666" points="1335.6907,-46.8001 1345.6907,-43.3 1335.6906,-39.8001 1335.6907,-46.8001"/>
</g>
<!-- EnterAsBatchGroupLeader -->
<g id="node7" class="node">
<title>EnterAsBatchGroupLeader</title>
<polygon fill="none" stroke="#000000" points="289.8076,-150.7 289.8076,-219.8999 458.9668,-219.8999 458.9668,-150.7 289.8076,-150.7"/>
<text text-anchor="middle" x="374.3872" y="-204.6999" font-family="Times,serif" font-size="14.00" fill="#000000">EnterAsBatchGroupLeader</text>
<polyline fill="none" stroke="#000000" points="289.8076,-197.8999 458.9668,-197.8999 "/>
<text text-anchor="start" x="297.8076" y="-182.6999" font-family="Times,serif" font-size="14.00" fill="#000000">将WriteGroup</text>
<text text-anchor="start" x="297.8076" y="-163.1" font-family="Times,serif" font-size="14.00" fill="#000000"> Writer关联起来</text>
</g>
<!-- EnterAsBatchGroupLeader&#45;&gt;WriteGroup -->
<g id="edge10" class="edge">
<title>EnterAsBatchGroupLeader&#45;&gt;WriteGroup</title>
<path fill="none" stroke="#666666" d="M459.3696,-185.3C494.4567,-185.3 535.5959,-185.3 573.0067,-185.3"/>
<polygon fill="#666666" stroke="#666666" points="573.4515,-188.8001 583.4514,-185.3 573.4514,-181.8001 573.4515,-188.8001"/>
</g>
<!-- EnterAsBatchGroupLeader&#45;&gt;Writer -->
<g id="edge11" class="edge">
<title>EnterAsBatchGroupLeader&#45;&gt;Writer</title>
<path fill="none" stroke="#666666" d="M441.6608,-150.6119C468.747,-138.4755 500.7497,-126.3693 531.252,-120.3 664.3216,-93.8215 704.4204,-89.3786 836.5283,-120.3 845.289,-122.3505 854.1138,-124.9054 862.8959,-127.8385"/>
<polygon fill="#666666" stroke="#666666" points="861.8088,-131.1662 872.4036,-131.1639 864.1198,-124.5586 861.8088,-131.1662"/>
</g>
<!-- LinkOne -->
<g id="node8" class="node">
<title>LinkOne</title>
<polygon fill="none" stroke="#000000" points="253.5225,-409.5 253.5225,-459.0999 495.252,-459.0999 495.252,-409.5 253.5225,-409.5"/>
<text text-anchor="middle" x="374.3872" y="-443.8999" font-family="Times,serif" font-size="14.00" fill="#000000">LinkOne</text>
<polyline fill="none" stroke="#000000" points="253.5225,-437.0999 495.252,-437.0999 "/>
<text text-anchor="middle" x="374.3872" y="-421.8999" font-family="Times,serif" font-size="14.00" fill="#000000">将Writer加入newsest_writer_队列开头</text>
</g>
<!-- LinkOne&#45;&gt;WriteThread -->
<g id="edge7" class="edge">
<title>LinkOne&#45;&gt;WriteThread:Writer</title>
<path fill="none" stroke="#666666" d="M495.5667,-434.3C504.1381,-434.3 512.7085,-434.3 521.1061,-434.3"/>
<polygon fill="#666666" stroke="#666666" points="521.252,-437.8001 531.252,-434.3 521.2519,-430.8001 521.252,-437.8001"/>
</g>
<!-- JoinBatchGroup -->
<g id="node9" class="node">
<title>JoinBatchGroup</title>
<polygon fill="none" stroke="#000000" points="217.4055,-401.3 109.8738,-401.3 109.8738,-365.3 217.4055,-365.3 217.4055,-401.3"/>
<text text-anchor="middle" x="163.6396" y="-379.1" font-family="Times,serif" font-size="14.00" fill="#000000">JoinBatchGroup</text>
</g>
<!-- JoinBatchGroup&#45;&gt;LinkOne -->
<g id="edge5" class="edge">
<title>JoinBatchGroup&#45;&gt;LinkOne</title>
<path fill="none" stroke="#666666" d="M217.6387,-396.3675C231.2444,-399.66 246.3631,-403.3187 261.6894,-407.0276"/>
<polygon fill="#666666" stroke="#666666" points="261.2344,-410.5184 271.7771,-409.4688 262.8809,-403.7148 261.2344,-410.5184"/>
</g>
<!-- WriteImpl -->
<g id="node10" class="node">
<title>WriteImpl</title>
<polygon fill="none" stroke="#000000" points="73.6357,-327.3 .1212,-327.3 .1212,-291.3 73.6357,-291.3 73.6357,-327.3"/>
<text text-anchor="middle" x="36.8784" y="-305.1" font-family="Times,serif" font-size="14.00" fill="#000000">WriteImpl</text>
</g>
<!-- WriteImpl&#45;&gt;EnterAsBatchGroupLeader -->
<g id="edge9" class="edge">
<title>WriteImpl&#45;&gt;EnterAsBatchGroupLeader</title>
<path fill="none" stroke="#666666" d="M73.6403,-295.7937C122.8374,-277.7188 211.8254,-245.0248 280.2848,-219.873"/>
<polygon fill="#666666" stroke="#666666" points="281.6227,-223.1103 289.8022,-216.3763 279.2086,-216.5397 281.6227,-223.1103"/>
</g>
<!-- WriteImpl&#45;&gt;JoinBatchGroup -->
<g id="edge8" class="edge">
<title>WriteImpl&#45;&gt;JoinBatchGroup</title>
<path fill="none" stroke="#666666" d="M67.8877,-327.4024C84.6152,-337.1675 105.4548,-349.3331 123.4173,-359.8191"/>
<polygon fill="#666666" stroke="#666666" points="122.1105,-363.109 132.5112,-365.1279 125.6396,-357.0637 122.1105,-363.109"/>
</g>
</g>
</svg>
