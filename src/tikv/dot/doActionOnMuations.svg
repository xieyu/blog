<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: doActionOnMutations Pages: 1 -->
<svg width="1252pt" height="306pt"
 viewBox="0.00 0.00 1252.00 305.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 301.5)">
<title>doActionOnMutations</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-301.5 1248,-301.5 1248,4 -4,4"/>
<g id="clust5" class="cluster">
<title>cluster_batchExecutor</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M656.5,-141.5C656.5,-141.5 898,-141.5 898,-141.5 904,-141.5 910,-147.5 910,-153.5 910,-153.5 910,-277.5 910,-277.5 910,-283.5 904,-289.5 898,-289.5 898,-289.5 656.5,-289.5 656.5,-289.5 650.5,-289.5 644.5,-283.5 644.5,-277.5 644.5,-277.5 644.5,-153.5 644.5,-153.5 644.5,-147.5 650.5,-141.5 656.5,-141.5"/>
<text text-anchor="middle" x="777.25" y="-269.5" font-family="Times,serif" font-size="20.00">batchExecutor</text>
</g>
<!-- doActionOnMutations -->
<g id="node1" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M127,-234.5C127,-234.5 12,-234.5 12,-234.5 6,-234.5 0,-228.5 0,-222.5 0,-222.5 0,-210.5 0,-210.5 0,-204.5 6,-198.5 12,-198.5 12,-198.5 127,-198.5 127,-198.5 133,-198.5 139,-204.5 139,-210.5 139,-210.5 139,-222.5 139,-222.5 139,-228.5 133,-234.5 127,-234.5"/>
<text text-anchor="middle" x="69.5" y="-212.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
</g>
<!-- checkOnePCFallBack -->
<g id="node2" class="node">
<title>checkOnePCFallBack</title>
<path fill="none" stroke="#1c2123" d="M549.5,-268.5C549.5,-268.5 437.5,-268.5 437.5,-268.5 431.5,-268.5 425.5,-262.5 425.5,-256.5 425.5,-256.5 425.5,-244.5 425.5,-244.5 425.5,-238.5 431.5,-232.5 437.5,-232.5 437.5,-232.5 549.5,-232.5 549.5,-232.5 555.5,-232.5 561.5,-238.5 561.5,-244.5 561.5,-244.5 561.5,-256.5 561.5,-256.5 561.5,-262.5 555.5,-268.5 549.5,-268.5"/>
<text text-anchor="middle" x="493.5" y="-246.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">checkOnePCFallBack</text>
</g>
<!-- doActionOnMutations&#45;&gt;checkOnePCFallBack -->
<g id="edge1" class="edge">
<title>doActionOnMutations&#45;&gt;checkOnePCFallBack</title>
<path fill="none" stroke="#666666" d="M92.47,-234.67C112.55,-250.01 143.77,-270.82 175,-279.5 258.06,-302.6 357.58,-286.86 422.78,-270.98"/>
<polygon fill="#666666" stroke="#666666" points="423.69,-274.36 432.55,-268.54 422,-267.57 423.69,-274.36"/>
</g>
<!-- groupMutations -->
<g id="node3" class="node">
<title>groupMutations</title>
<path fill="none" stroke="#1c2123" d="M194.5,-163.5C194.5,-163.5 328.5,-163.5 328.5,-163.5 334.5,-163.5 340.5,-169.5 340.5,-175.5 340.5,-175.5 340.5,-257.5 340.5,-257.5 340.5,-263.5 334.5,-269.5 328.5,-269.5 328.5,-269.5 194.5,-269.5 194.5,-269.5 188.5,-269.5 182.5,-263.5 182.5,-257.5 182.5,-257.5 182.5,-175.5 182.5,-175.5 182.5,-169.5 188.5,-163.5 194.5,-163.5"/>
<text text-anchor="middle" x="261.5" y="-254.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">groupMutations</text>
<polyline fill="none" stroke="#1c2123" points="182.5,-246.5 340.5,-246.5 "/>
<text text-anchor="start" x="190.5" y="-231.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">groupMutations groups </text>
<text text-anchor="start" x="190.5" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mutations by region, </text>
<text text-anchor="start" x="190.5" y="-201.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> then checks for any large</text>
<text text-anchor="start" x="190.5" y="-186.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> groups and in that case</text>
<text text-anchor="start" x="190.5" y="-171.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pre&#45;splits the region.</text>
</g>
<!-- doActionOnMutations&#45;&gt;groupMutations -->
<g id="edge2" class="edge">
<title>doActionOnMutations&#45;&gt;groupMutations</title>
<path fill="none" stroke="#666666" d="M139.09,-216.5C149.84,-216.5 161.07,-216.5 172.18,-216.5"/>
<polygon fill="#666666" stroke="#666666" points="172.33,-220 182.33,-216.5 172.33,-213 172.33,-220"/>
</g>
<!-- doActionOnGroupMutations -->
<g id="node4" class="node">
<title>doActionOnGroupMutations</title>
<path fill="none" stroke="#1c2123" d="M187,-68.5C187,-68.5 336,-68.5 336,-68.5 342,-68.5 348,-74.5 348,-80.5 348,-80.5 348,-132.5 348,-132.5 348,-138.5 342,-144.5 336,-144.5 336,-144.5 187,-144.5 187,-144.5 181,-144.5 175,-138.5 175,-132.5 175,-132.5 175,-80.5 175,-80.5 175,-74.5 181,-68.5 187,-68.5"/>
<text text-anchor="middle" x="261.5" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnGroupMutations</text>
<polyline fill="none" stroke="#1c2123" points="175,-121.5 348,-121.5 "/>
<text text-anchor="start" x="183" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">split groups into batches</text>
<text text-anchor="start" x="183" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> one group per region</text>
<text text-anchor="start" x="183" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> many baches per group</text>
</g>
<!-- doActionOnMutations&#45;&gt;doActionOnGroupMutations -->
<g id="edge3" class="edge">
<title>doActionOnMutations&#45;&gt;doActionOnGroupMutations</title>
<path fill="none" stroke="#666666" d="M100.57,-198.4C121.39,-185.93 149.79,-169.05 175,-154.5 177.8,-152.88 180.66,-151.24 183.55,-149.59"/>
<polygon fill="#666666" stroke="#666666" points="185.33,-152.6 192.28,-144.61 181.86,-146.52 185.33,-152.6"/>
</g>
<!-- doActionOnGroupMutations&#45;&gt;checkOnePCFallBack -->
<g id="edge4" class="edge">
<title>doActionOnGroupMutations&#45;&gt;checkOnePCFallBack</title>
<path fill="none" stroke="#666666" d="M331.36,-144.57C337.02,-147.87 342.63,-151.21 348,-154.5 386.3,-177.93 429,-206.63 457.98,-226.51"/>
<polygon fill="#666666" stroke="#666666" points="456.29,-229.6 466.51,-232.38 460.26,-223.83 456.29,-229.6"/>
</g>
<!-- doActionOnBatches -->
<g id="node5" class="node">
<title>doActionOnBatches</title>
<path fill="none" stroke="#1c2123" d="M410,-120.5C410,-120.5 577,-120.5 577,-120.5 583,-120.5 589,-126.5 589,-132.5 589,-132.5 589,-154.5 589,-154.5 589,-160.5 583,-166.5 577,-166.5 577,-166.5 410,-166.5 410,-166.5 404,-166.5 398,-160.5 398,-154.5 398,-154.5 398,-132.5 398,-132.5 398,-126.5 404,-120.5 410,-120.5"/>
<text text-anchor="middle" x="493.5" y="-151.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnBatches</text>
<polyline fill="none" stroke="#1c2123" points="398,-143.5 589,-143.5 "/>
<text text-anchor="start" x="406" y="-128.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">does action to baches in parallel</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;doActionOnBatches -->
<g id="edge5" class="edge">
<title>doActionOnGroupMutations&#45;&gt;doActionOnBatches</title>
<path fill="none" stroke="#666666" d="M348.14,-120.28C361.07,-122.36 374.52,-124.52 387.8,-126.66"/>
<polygon fill="#666666" stroke="#666666" points="387.47,-130.15 397.9,-128.28 388.58,-123.24 387.47,-130.15"/>
</g>
<!-- batchBuilder_setPrimary -->
<g id="node6" class="node">
<title>batchBuilder_setPrimary</title>
<path fill="none" stroke="#1c2123" d="M396,-40C396,-40 591,-40 591,-40 597,-40 603,-46 603,-52 603,-52 603,-89 603,-89 603,-95 597,-101 591,-101 591,-101 396,-101 396,-101 390,-101 384,-95 384,-89 384,-89 384,-52 384,-52 384,-46 390,-40 396,-40"/>
<text text-anchor="middle" x="493.5" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">batchBuilder_setPrimary</text>
<polyline fill="none" stroke="#1c2123" points="384,-78 603,-78 "/>
<text text-anchor="start" x="392" y="-62.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">if the batches include the primay key</text>
<text text-anchor="start" x="392" y="-47.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> put it to the first</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;batchBuilder_setPrimary -->
<g id="edge6" class="edge">
<title>doActionOnGroupMutations&#45;&gt;batchBuilder_setPrimary</title>
<path fill="none" stroke="#666666" d="M348.14,-93.09C356.5,-91.79 365.07,-90.45 373.68,-89.1"/>
<polygon fill="#666666" stroke="#666666" points="374.44,-92.52 383.78,-87.52 373.36,-85.61 374.44,-92.52"/>
</g>
<!-- newBatchExecutor -->
<g id="node7" class="node">
<title>newBatchExecutor</title>
<path fill="none" stroke="#1c2123" d="M759.5,-251.5C759.5,-251.5 664.5,-251.5 664.5,-251.5 658.5,-251.5 652.5,-245.5 652.5,-239.5 652.5,-239.5 652.5,-227.5 652.5,-227.5 652.5,-221.5 658.5,-215.5 664.5,-215.5 664.5,-215.5 759.5,-215.5 759.5,-215.5 765.5,-215.5 771.5,-221.5 771.5,-227.5 771.5,-227.5 771.5,-239.5 771.5,-239.5 771.5,-245.5 765.5,-251.5 759.5,-251.5"/>
<text text-anchor="middle" x="712" y="-229.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">newBatchExecutor</text>
</g>
<!-- doActionOnBatches&#45;&gt;newBatchExecutor -->
<g id="edge7" class="edge">
<title>doActionOnBatches&#45;&gt;newBatchExecutor</title>
<path fill="none" stroke="#666666" d="M545.72,-166.61C573.23,-178.82 607.8,-193.86 639,-206.5 643.22,-208.21 647.59,-209.94 652.01,-211.66"/>
<polygon fill="#666666" stroke="#666666" points="651.09,-215.06 661.68,-215.4 653.61,-208.53 651.09,-215.06"/>
</g>
<!-- batchExecutor_process -->
<g id="node8" class="node">
<title>batchExecutor_process</title>
<path fill="none" stroke="#1c2123" d="M676.5,-150.5C676.5,-150.5 747.5,-150.5 747.5,-150.5 753.5,-150.5 759.5,-156.5 759.5,-162.5 759.5,-162.5 759.5,-184.5 759.5,-184.5 759.5,-190.5 753.5,-196.5 747.5,-196.5 747.5,-196.5 676.5,-196.5 676.5,-196.5 670.5,-196.5 664.5,-190.5 664.5,-184.5 664.5,-184.5 664.5,-162.5 664.5,-162.5 664.5,-156.5 670.5,-150.5 676.5,-150.5"/>
<text text-anchor="middle" x="712" y="-181.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">batchExecutor</text>
<polyline fill="none" stroke="#1c2123" points="664.5,-173.5 759.5,-173.5 "/>
<text text-anchor="start" x="672.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process</text>
</g>
<!-- doActionOnBatches&#45;&gt;batchExecutor_process -->
<g id="edge8" class="edge">
<title>doActionOnBatches&#45;&gt;batchExecutor_process</title>
<path fill="none" stroke="#666666" d="M589.15,-156.61C611.33,-159.69 634.3,-162.87 654.23,-165.63"/>
<polygon fill="#666666" stroke="#666666" points="653.97,-169.13 664.35,-167.04 654.93,-162.2 653.97,-169.13"/>
</g>
<!-- noNeedFork -->
<g id="node9" class="node">
<title>noNeedFork</title>
<path fill="none" stroke="#1c2123" d="M742,-131.5C742,-131.5 682,-131.5 682,-131.5 676,-131.5 670,-125.5 670,-119.5 670,-119.5 670,-107.5 670,-107.5 670,-101.5 676,-95.5 682,-95.5 682,-95.5 742,-95.5 742,-95.5 748,-95.5 754,-101.5 754,-107.5 754,-107.5 754,-119.5 754,-119.5 754,-125.5 748,-131.5 742,-131.5"/>
<text text-anchor="middle" x="712" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">noNeedFork</text>
</g>
<!-- doActionOnBatches&#45;&gt;noNeedFork -->
<g id="edge9" class="edge">
<title>doActionOnBatches&#45;&gt;noNeedFork</title>
<path fill="none" stroke="#666666" d="M589.15,-130.39C613.4,-127.02 638.57,-123.54 659.7,-120.61"/>
<polygon fill="#666666" stroke="#666666" points="660.3,-124.06 669.72,-119.22 659.34,-117.13 660.3,-124.06"/>
</g>
<!-- handleSingleBatch -->
<g id="node10" class="node">
<title>handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M651,-0.5C651,-0.5 773,-0.5 773,-0.5 779,-0.5 785,-6.5 785,-12.5 785,-12.5 785,-64.5 785,-64.5 785,-70.5 779,-76.5 773,-76.5 773,-76.5 651,-76.5 651,-76.5 645,-76.5 639,-70.5 639,-64.5 639,-64.5 639,-12.5 639,-12.5 639,-6.5 645,-0.5 651,-0.5"/>
<text text-anchor="middle" x="712" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
<polyline fill="none" stroke="#1c2123" points="639,-53.5 785,-53.5 "/>
<text text-anchor="start" x="647" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果batch大小为1</text>
<text text-anchor="start" x="647" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者是commit的retry</text>
<text text-anchor="start" x="647" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 同步执行</text>
</g>
<!-- doActionOnBatches&#45;&gt;handleSingleBatch -->
<g id="edge10" class="edge">
<title>doActionOnBatches&#45;&gt;handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M578.95,-120.5C587.2,-117.45 595.35,-114.12 603,-110.5 603.09,-110.46 622.88,-97.27 645.49,-82.19"/>
<polygon fill="#666666" stroke="#666666" points="647.54,-85.03 653.92,-76.57 643.66,-79.21 647.54,-85.03"/>
</g>
<!-- startWorker -->
<g id="node11" class="node">
<title>startWorker</title>
<path fill="none" stroke="#1c2123" d="M890,-191.5C890,-191.5 833,-191.5 833,-191.5 827,-191.5 821,-185.5 821,-179.5 821,-179.5 821,-167.5 821,-167.5 821,-161.5 827,-155.5 833,-155.5 833,-155.5 890,-155.5 890,-155.5 896,-155.5 902,-161.5 902,-167.5 902,-167.5 902,-179.5 902,-179.5 902,-185.5 896,-191.5 890,-191.5"/>
<text text-anchor="middle" x="861.5" y="-169.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">startWorker</text>
</g>
<!-- batchExecutor_process&#45;&gt;startWorker -->
<g id="edge11" class="edge">
<title>batchExecutor_process&#45;&gt;startWorker</title>
<path fill="none" stroke="#666666" d="M759.67,-173.5C775.73,-173.5 793.78,-173.5 810.13,-173.5"/>
<polygon fill="#666666" stroke="#666666" points="810.58,-177 820.58,-173.5 810.58,-170 810.58,-177"/>
</g>
<!-- twoPhaseCommitAction_handleSingleBatch -->
<g id="node12" class="node">
<title>twoPhaseCommitAction_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M950,-150.5C950,-150.5 1077,-150.5 1077,-150.5 1083,-150.5 1089,-156.5 1089,-162.5 1089,-162.5 1089,-184.5 1089,-184.5 1089,-190.5 1083,-196.5 1077,-196.5 1077,-196.5 950,-196.5 950,-196.5 944,-196.5 938,-190.5 938,-184.5 938,-184.5 938,-162.5 938,-162.5 938,-156.5 944,-150.5 950,-150.5"/>
<text text-anchor="middle" x="1013.5" y="-181.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">twoPhaseCommitAction</text>
<polyline fill="none" stroke="#1c2123" points="938,-173.5 1089,-173.5 "/>
<text text-anchor="start" x="946" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
</g>
<!-- startWorker&#45;&gt;twoPhaseCommitAction_handleSingleBatch -->
<g id="edge12" class="edge">
<title>startWorker&#45;&gt;twoPhaseCommitAction_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M902.3,-173.5C910.31,-173.5 919.01,-173.5 927.9,-173.5"/>
<polygon fill="#666666" stroke="#666666" points="927.98,-177 937.98,-173.5 927.98,-170 927.98,-177"/>
</g>
<!-- actionPrewrite_handleSingleBatch -->
<g id="node13" class="node">
<title>actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1137,-183.5C1137,-183.5 1232,-183.5 1232,-183.5 1238,-183.5 1244,-189.5 1244,-195.5 1244,-195.5 1244,-217.5 1244,-217.5 1244,-223.5 1238,-229.5 1232,-229.5 1232,-229.5 1137,-229.5 1137,-229.5 1131,-229.5 1125,-223.5 1125,-217.5 1125,-217.5 1125,-195.5 1125,-195.5 1125,-189.5 1131,-183.5 1137,-183.5"/>
<text text-anchor="middle" x="1184.5" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionPrewrite</text>
<polyline fill="none" stroke="#1c2123" points="1125,-206.5 1244,-206.5 "/>
<text text-anchor="start" x="1133" y="-191.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
</g>
<!-- twoPhaseCommitAction_handleSingleBatch&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge13" class="edge">
<title>twoPhaseCommitAction_handleSingleBatch&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1089.12,-188.07C1097.7,-189.75 1106.42,-191.45 1114.91,-193.11"/>
<polygon fill="#666666" stroke="#666666" points="1114.27,-196.55 1124.76,-195.03 1115.62,-189.68 1114.27,-196.55"/>
</g>
<!-- actionCommit_handleSingleBatch -->
<g id="node14" class="node">
<title>actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1137,-118.5C1137,-118.5 1232,-118.5 1232,-118.5 1238,-118.5 1244,-124.5 1244,-130.5 1244,-130.5 1244,-152.5 1244,-152.5 1244,-158.5 1238,-164.5 1232,-164.5 1232,-164.5 1137,-164.5 1137,-164.5 1131,-164.5 1125,-158.5 1125,-152.5 1125,-152.5 1125,-130.5 1125,-130.5 1125,-124.5 1131,-118.5 1137,-118.5"/>
<text text-anchor="middle" x="1184.5" y="-149.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit</text>
<polyline fill="none" stroke="#1c2123" points="1125,-141.5 1244,-141.5 "/>
<text text-anchor="start" x="1133" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
</g>
<!-- twoPhaseCommitAction_handleSingleBatch&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge14" class="edge">
<title>twoPhaseCommitAction_handleSingleBatch&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1089.12,-159.37C1097.7,-157.75 1106.42,-156.1 1114.91,-154.49"/>
<polygon fill="#666666" stroke="#666666" points="1115.58,-157.92 1124.76,-152.62 1114.28,-151.04 1115.58,-157.92"/>
</g>
</g>
</svg>
