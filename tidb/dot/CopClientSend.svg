<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: CopClientSend Pages: 1 -->
<svg width="2016pt" height="291pt"
 viewBox="0.00 0.00 2016.00 290.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 286.51)">
<title>CopClientSend</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-286.51 2012,-286.51 2012,4 -4,4"/>
<!-- Send -->
<g id="node1" class="node">
<title>Send</title>
<path fill="none" stroke="#1c2123" d="M12,-174.5C12,-174.5 167,-174.5 167,-174.5 173,-174.5 179,-180.5 179,-186.5 179,-186.5 179,-223.5 179,-223.5 179,-229.5 173,-235.5 167,-235.5 167,-235.5 12,-235.5 12,-235.5 6,-235.5 0,-229.5 0,-223.5 0,-223.5 0,-186.5 0,-186.5 0,-180.5 6,-174.5 12,-174.5"/>
<text text-anchor="middle" x="89.5" y="-220.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Send</text>
<polyline fill="none" stroke="#1c2123" points="0,-212.5 179,-212.5 "/>
<text text-anchor="start" x="8" y="-197.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">bulds the request and gets the</text>
<text text-anchor="start" x="8" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> coprocessor iterator response</text>
</g>
<!-- buildCopTasks -->
<g id="node2" class="node">
<title>buildCopTasks</title>
<path fill="none" stroke="#1c2123" d="M1589,-253C1589,-253 1515,-253 1515,-253 1509,-253 1503,-247 1503,-241 1503,-241 1503,-229 1503,-229 1503,-223 1509,-217 1515,-217 1515,-217 1589,-217 1589,-217 1595,-217 1601,-223 1601,-229 1601,-229 1601,-241 1601,-241 1601,-247 1595,-253 1589,-253"/>
<text text-anchor="middle" x="1552" y="-231.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">buildCopTasks</text>
</g>
<!-- Send&#45;&gt;buildCopTasks -->
<g id="edge1" class="edge">
<title>Send&#45;&gt;buildCopTasks</title>
<path fill="none" stroke="#666666" d="M179.23,-231.79C259.58,-253.68 381.63,-281 490,-281 490,-281 490,-281 1164.5,-281 1299.21,-281 1334.64,-287.03 1467,-262 1475.53,-260.39 1484.4,-258.17 1493.04,-255.68"/>
<polygon fill="#666666" stroke="#666666" points="1494.1,-259.02 1502.67,-252.79 1492.09,-252.32 1494.1,-259.02"/>
</g>
<!-- open -->
<g id="node3" class="node">
<title>open</title>
<path fill="none" stroke="#1c2123" d="M227,-80.5C227,-80.5 352,-80.5 352,-80.5 358,-80.5 364,-86.5 364,-92.5 364,-92.5 364,-129.5 364,-129.5 364,-135.5 358,-141.5 352,-141.5 352,-141.5 227,-141.5 227,-141.5 221,-141.5 215,-135.5 215,-129.5 215,-129.5 215,-92.5 215,-92.5 215,-86.5 221,-80.5 227,-80.5"/>
<text text-anchor="middle" x="289.5" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">open</text>
<polyline fill="none" stroke="#1c2123" points="215,-118.5 364,-118.5 "/>
<text text-anchor="start" x="223" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">starts worker and sender</text>
<text text-anchor="start" x="223" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> go routine</text>
</g>
<!-- Send&#45;&gt;open -->
<g id="edge2" class="edge">
<title>Send&#45;&gt;open</title>
<path fill="none" stroke="#666666" d="M154.78,-174.48C173.99,-165.36 195.19,-155.3 214.94,-145.92"/>
<polygon fill="#666666" stroke="#666666" points="216.67,-148.98 224.2,-141.53 213.66,-142.65 216.67,-148.98"/>
</g>
<!-- splitRange -->
<g id="node12" class="node">
<title>splitRange</title>
<path fill="none" stroke="#1c2123" d="M1649,-212C1649,-212 1811,-212 1811,-212 1817,-212 1823,-218 1823,-224 1823,-224 1823,-246 1823,-246 1823,-252 1817,-258 1811,-258 1811,-258 1649,-258 1649,-258 1643,-258 1637,-252 1637,-246 1637,-246 1637,-224 1637,-224 1637,-218 1643,-212 1649,-212"/>
<text text-anchor="middle" x="1730" y="-242.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">splitRange</text>
<polyline fill="none" stroke="#1c2123" points="1637,-235 1823,-235 "/>
<text text-anchor="middle" x="1730" y="-219.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将copRanges按照Region分割</text>
</g>
<!-- buildCopTasks&#45;&gt;splitRange -->
<g id="edge19" class="edge">
<title>buildCopTasks&#45;&gt;splitRange</title>
<path fill="none" stroke="#666666" d="M1601.09,-235C1609.23,-235 1617.94,-235 1626.85,-235"/>
<polygon fill="#666666" stroke="#666666" points="1626.97,-238.5 1636.97,-235 1626.97,-231.5 1626.97,-238.5"/>
</g>
<!-- taskSender_run -->
<g id="node4" class="node">
<title>taskSender_run</title>
<path fill="none" stroke="#1c2123" d="M422.5,-0.5C422.5,-0.5 559.5,-0.5 559.5,-0.5 565.5,-0.5 571.5,-6.5 571.5,-12.5 571.5,-12.5 571.5,-49.5 571.5,-49.5 571.5,-55.5 565.5,-61.5 559.5,-61.5 559.5,-61.5 422.5,-61.5 422.5,-61.5 416.5,-61.5 410.5,-55.5 410.5,-49.5 410.5,-49.5 410.5,-12.5 410.5,-12.5 410.5,-6.5 416.5,-0.5 422.5,-0.5"/>
<text text-anchor="middle" x="491" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">copIteratorTaskSender.run</text>
<polyline fill="none" stroke="#1c2123" points="410.5,-38.5 571.5,-38.5 "/>
<text text-anchor="start" x="418.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Send tasks to feed the</text>
<text text-anchor="start" x="418.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> worker goroutines</text>
</g>
<!-- open&#45;&gt;taskSender_run -->
<g id="edge3" class="edge">
<title>open&#45;&gt;taskSender_run</title>
<path fill="none" stroke="#666666" d="M364.22,-81.44C377.26,-76.21 390.94,-70.72 404.28,-65.38"/>
<polygon fill="#666666" stroke="#666666" points="405.93,-68.48 413.91,-61.51 403.33,-61.98 405.93,-68.48"/>
</g>
<!-- copIteratorWorker_run -->
<g id="node5" class="node">
<title>copIteratorWorker_run</title>
<path fill="none" stroke="#1c2123" d="M412,-80.5C412,-80.5 570,-80.5 570,-80.5 576,-80.5 582,-86.5 582,-92.5 582,-92.5 582,-129.5 582,-129.5 582,-135.5 576,-141.5 570,-141.5 570,-141.5 412,-141.5 412,-141.5 406,-141.5 400,-135.5 400,-129.5 400,-129.5 400,-92.5 400,-92.5 400,-86.5 406,-80.5 412,-80.5"/>
<text text-anchor="middle" x="491" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">copIteratorWorker.run</text>
<polyline fill="none" stroke="#1c2123" points="400,-118.5 582,-118.5 "/>
<text text-anchor="start" x="408" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get a copTask from channel</text>
<text text-anchor="start" x="408" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle it and send result back</text>
</g>
<!-- open&#45;&gt;copIteratorWorker_run -->
<g id="edge4" class="edge">
<title>open&#45;&gt;copIteratorWorker_run</title>
<path fill="none" stroke="#666666" d="M364.22,-111C372.52,-111 381.07,-111 389.63,-111"/>
<polygon fill="#666666" stroke="#666666" points="389.67,-114.5 399.67,-111 389.67,-107.5 389.67,-114.5"/>
</g>
<!-- handleTask -->
<g id="node6" class="node">
<title>handleTask</title>
<path fill="none" stroke="#1c2123" d="M685,-129C685,-129 630,-129 630,-129 624,-129 618,-123 618,-117 618,-117 618,-105 618,-105 618,-99 624,-93 630,-93 630,-93 685,-93 685,-93 691,-93 697,-99 697,-105 697,-105 697,-117 697,-117 697,-123 691,-129 685,-129"/>
<text text-anchor="middle" x="657.5" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleTask</text>
</g>
<!-- copIteratorWorker_run&#45;&gt;handleTask -->
<g id="edge5" class="edge">
<title>copIteratorWorker_run&#45;&gt;handleTask</title>
<path fill="none" stroke="#666666" d="M582.43,-111C591.05,-111 599.54,-111 607.54,-111"/>
<polygon fill="#666666" stroke="#666666" points="607.72,-114.5 617.72,-111 607.72,-107.5 607.72,-114.5"/>
</g>
<!-- sendToRespCh -->
<g id="node7" class="node">
<title>sendToRespCh</title>
<path fill="none" stroke="#1c2123" d="M1419,-99C1419,-99 1344,-99 1344,-99 1338,-99 1332,-93 1332,-87 1332,-87 1332,-75 1332,-75 1332,-69 1338,-63 1344,-63 1344,-63 1419,-63 1419,-63 1425,-63 1431,-69 1431,-75 1431,-75 1431,-87 1431,-87 1431,-93 1425,-99 1419,-99"/>
<text text-anchor="middle" x="1381.5" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">sendToRespCh</text>
</g>
<!-- copIteratorWorker_run&#45;&gt;sendToRespCh -->
<g id="edge6" class="edge">
<title>copIteratorWorker_run&#45;&gt;sendToRespCh</title>
<path fill="none" stroke="#666666" d="M577.16,-80.48C635.11,-62.4 713.97,-43 785.5,-43 785.5,-43 785.5,-43 954.5,-43 1086.05,-43 1239.56,-61.2 1321.62,-72.41"/>
<polygon fill="#666666" stroke="#666666" points="1321.37,-75.91 1331.75,-73.81 1322.32,-68.97 1321.37,-75.91"/>
</g>
<!-- handleTask&#45;&gt;sendToRespCh -->
<g id="edge7" class="edge">
<title>handleTask&#45;&gt;sendToRespCh</title>
<path fill="none" stroke="#666666" d="M697.39,-108.88C740.9,-106.55 813.49,-102.76 876,-100 1037.2,-92.89 1227.46,-86.18 1321.61,-82.97"/>
<polygon fill="#666666" stroke="#666666" points="1321.91,-86.46 1331.79,-82.63 1321.68,-79.47 1321.91,-86.46"/>
</g>
<!-- handleTaskOnce -->
<g id="node8" class="node">
<title>handleTaskOnce</title>
<path fill="none" stroke="#1c2123" d="M828,-177C828,-177 745,-177 745,-177 739,-177 733,-171 733,-165 733,-165 733,-153 733,-153 733,-147 739,-141 745,-141 745,-141 828,-141 828,-141 834,-141 840,-147 840,-153 840,-153 840,-165 840,-165 840,-171 834,-177 828,-177"/>
<text text-anchor="middle" x="786.5" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleTaskOnce</text>
</g>
<!-- handleTask&#45;&gt;handleTaskOnce -->
<g id="edge8" class="edge">
<title>handleTask&#45;&gt;handleTaskOnce</title>
<path fill="none" stroke="#666666" d="M697.29,-125.66C707.01,-129.34 717.64,-133.35 728.06,-137.29"/>
<polygon fill="#666666" stroke="#666666" points="726.93,-140.61 737.53,-140.87 729.41,-134.06 726.93,-140.61"/>
</g>
<!-- SendReqCtx -->
<g id="node9" class="node">
<title>SendReqCtx</title>
<path fill="none" stroke="#1c2123" d="M888,-110C888,-110 1019,-110 1019,-110 1025,-110 1031,-116 1031,-122 1031,-122 1031,-144 1031,-144 1031,-150 1025,-156 1019,-156 1019,-156 888,-156 888,-156 882,-156 876,-150 876,-144 876,-144 876,-122 876,-122 876,-116 882,-110 888,-110"/>
<text text-anchor="middle" x="953.5" y="-140.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SendReqCtx</text>
<polyline fill="none" stroke="#1c2123" points="876,-133 1031,-133 "/>
<text text-anchor="start" x="884" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">向TikV 发送GRPC请求</text>
</g>
<!-- handleTaskOnce&#45;&gt;SendReqCtx -->
<g id="edge9" class="edge">
<title>handleTaskOnce&#45;&gt;SendReqCtx</title>
<path fill="none" stroke="#666666" d="M840.16,-150.7C848.45,-149.4 857.21,-148.02 866.03,-146.63"/>
<polygon fill="#666666" stroke="#666666" points="866.65,-150.07 875.98,-145.06 865.56,-143.16 866.65,-150.07"/>
</g>
<!-- handleCopStreamResult -->
<g id="node10" class="node">
<title>handleCopStreamResult</title>
<path fill="none" stroke="#1c2123" d="M1016,-249C1016,-249 891,-249 891,-249 885,-249 879,-243 879,-237 879,-237 879,-225 879,-225 879,-219 885,-213 891,-213 891,-213 1016,-213 1016,-213 1022,-213 1028,-219 1028,-225 1028,-225 1028,-237 1028,-237 1028,-243 1022,-249 1016,-249"/>
<text text-anchor="middle" x="953.5" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleCopStreamResult</text>
</g>
<!-- handleTaskOnce&#45;&gt;handleCopStreamResult -->
<g id="edge10" class="edge">
<title>handleTaskOnce&#45;&gt;handleCopStreamResult</title>
<path fill="none" stroke="#666666" d="M827.04,-177.16C842.3,-184.09 859.92,-192 876,-199 883.51,-202.27 891.46,-205.66 899.28,-208.97"/>
<polygon fill="#666666" stroke="#666666" points="898.14,-212.28 908.72,-212.94 900.86,-205.83 898.14,-212.28"/>
</g>
<!-- handleCopResponse -->
<g id="node11" class="node">
<title>handleCopResponse</title>
<path fill="none" stroke="#1c2123" d="M1215,-211C1215,-211 1112,-211 1112,-211 1106,-211 1100,-205 1100,-199 1100,-199 1100,-187 1100,-187 1100,-181 1106,-175 1112,-175 1112,-175 1215,-175 1215,-175 1221,-175 1227,-181 1227,-187 1227,-187 1227,-199 1227,-199 1227,-205 1221,-211 1215,-211"/>
<text text-anchor="middle" x="1163.5" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleCopResponse</text>
</g>
<!-- handleTaskOnce&#45;&gt;handleCopResponse -->
<g id="edge11" class="edge">
<title>handleTaskOnce&#45;&gt;handleCopResponse</title>
<path fill="none" stroke="#666666" d="M840.04,-163.76C905.11,-169.66 1016.31,-179.75 1089.61,-186.39"/>
<polygon fill="#666666" stroke="#666666" points="1089.42,-189.89 1099.69,-187.31 1090.05,-182.92 1089.42,-189.89"/>
</g>
<!-- onRegionError -->
<g id="node13" class="node">
<title>onRegionError</title>
<path fill="none" stroke="#1c2123" d="M1079,-110C1079,-110 1248,-110 1248,-110 1254,-110 1260,-116 1260,-122 1260,-122 1260,-144 1260,-144 1260,-150 1254,-156 1248,-156 1248,-156 1079,-156 1079,-156 1073,-156 1067,-150 1067,-144 1067,-144 1067,-122 1067,-122 1067,-116 1073,-110 1079,-110"/>
<text text-anchor="middle" x="1163.5" y="-140.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">onRegionError</text>
<polyline fill="none" stroke="#1c2123" points="1067,-133 1260,-133 "/>
<text text-anchor="start" x="1075" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理Region Cache过期等问题</text>
</g>
<!-- SendReqCtx&#45;&gt;onRegionError -->
<g id="edge12" class="edge">
<title>SendReqCtx&#45;&gt;onRegionError</title>
<path fill="none" stroke="#666666" d="M1031.07,-133C1039.39,-133 1047.97,-133 1056.57,-133"/>
<polygon fill="#666666" stroke="#666666" points="1056.65,-136.5 1066.65,-133 1056.65,-129.5 1056.65,-136.5"/>
</g>
<!-- handleCopStreamResult&#45;&gt;handleCopResponse -->
<g id="edge13" class="edge">
<title>handleCopStreamResult&#45;&gt;handleCopResponse</title>
<path fill="none" stroke="#666666" d="M1028.13,-217.55C1048.22,-213.88 1069.97,-209.9 1090.01,-206.24"/>
<polygon fill="#666666" stroke="#666666" points="1090.79,-209.66 1099.99,-204.42 1089.53,-202.77 1090.79,-209.66"/>
</g>
<!-- buildCopTasksFromRemain -->
<g id="node15" class="node">
<title>buildCopTasksFromRemain</title>
<path fill="none" stroke="#1c2123" d="M1455,-253C1455,-253 1308,-253 1308,-253 1302,-253 1296,-247 1296,-241 1296,-241 1296,-229 1296,-229 1296,-223 1302,-217 1308,-217 1308,-217 1455,-217 1455,-217 1461,-217 1467,-223 1467,-229 1467,-229 1467,-241 1467,-241 1467,-247 1461,-253 1455,-253"/>
<text text-anchor="middle" x="1381.5" y="-231.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">buildCopTasksFromRemain</text>
</g>
<!-- handleCopStreamResult&#45;&gt;buildCopTasksFromRemain -->
<g id="edge14" class="edge">
<title>handleCopStreamResult&#45;&gt;buildCopTasksFromRemain</title>
<path fill="none" stroke="#666666" d="M1028.22,-231.69C1099.55,-232.36 1208,-233.38 1285.72,-234.11"/>
<polygon fill="#666666" stroke="#666666" points="1285.96,-237.61 1296,-234.21 1286.03,-230.61 1285.96,-237.61"/>
</g>
<!-- handleCopResponse&#45;&gt;buildCopTasks -->
<g id="edge15" class="edge">
<title>handleCopResponse&#45;&gt;buildCopTasks</title>
<path fill="none" stroke="#666666" d="M1227.03,-191.37C1288.59,-190.87 1385.01,-193.06 1467,-208 1475.54,-209.56 1484.42,-211.75 1493.06,-214.21"/>
<polygon fill="#666666" stroke="#666666" points="1492.11,-217.58 1502.69,-217.1 1494.12,-210.88 1492.11,-217.58"/>
</g>
<!-- handleCopResponse&#45;&gt;sendToRespCh -->
<g id="edge16" class="edge">
<title>handleCopResponse&#45;&gt;sendToRespCh</title>
<path fill="none" stroke="#666666" d="M1227.24,-177.77C1238.39,-174.18 1249.72,-169.93 1260,-165 1293.53,-148.93 1327.96,-123.91 1351.38,-105.36"/>
<polygon fill="#666666" stroke="#666666" points="1353.58,-108.08 1359.19,-99.09 1349.2,-102.62 1353.58,-108.08"/>
</g>
<!-- handleCopResponse&#45;&gt;buildCopTasksFromRemain -->
<g id="edge17" class="edge">
<title>handleCopResponse&#45;&gt;buildCopTasksFromRemain</title>
<path fill="none" stroke="#666666" d="M1227.27,-205.2C1245.59,-208.77 1266.04,-212.74 1285.88,-216.6"/>
<polygon fill="#666666" stroke="#666666" points="1285.39,-220.07 1295.87,-218.54 1286.72,-213.2 1285.39,-220.07"/>
</g>
<!-- LocateKey -->
<g id="node14" class="node">
<title>LocateKey</title>
<path fill="none" stroke="#1c2123" d="M1871,-212C1871,-212 1996,-212 1996,-212 2002,-212 2008,-218 2008,-224 2008,-224 2008,-246 2008,-246 2008,-252 2002,-258 1996,-258 1996,-258 1871,-258 1871,-258 1865,-258 1859,-252 1859,-246 1859,-246 1859,-224 1859,-224 1859,-218 1865,-212 1871,-212"/>
<text text-anchor="middle" x="1933.5" y="-242.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocateKey</text>
<polyline fill="none" stroke="#1c2123" points="1859,-235 2008,-235 "/>
<text text-anchor="middle" x="1933.5" y="-219.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取Key所在的Region</text>
</g>
<!-- splitRange&#45;&gt;LocateKey -->
<g id="edge20" class="edge">
<title>splitRange&#45;&gt;LocateKey</title>
<path fill="none" stroke="#666666" d="M1823.2,-235C1831.67,-235 1840.23,-235 1848.62,-235"/>
<polygon fill="#666666" stroke="#666666" points="1848.76,-238.5 1858.76,-235 1848.76,-231.5 1848.76,-238.5"/>
</g>
<!-- buildCopTasksFromRemain&#45;&gt;buildCopTasks -->
<g id="edge18" class="edge">
<title>buildCopTasksFromRemain&#45;&gt;buildCopTasks</title>
<path fill="none" stroke="#666666" d="M1467.24,-235C1475.77,-235 1484.29,-235 1492.46,-235"/>
<polygon fill="#666666" stroke="#666666" points="1492.58,-238.5 1502.58,-235 1492.58,-231.5 1492.58,-238.5"/>
</g>
</g>
</svg>
