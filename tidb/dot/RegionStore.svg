<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: RegionStore Pages: 1 -->
<svg width="1096pt" height="412pt"
 viewBox="0.00 0.00 1096.00 411.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 407.5)">
<title>RegionStore</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-407.5 1092,-407.5 1092,4 -4,4"/>
<!-- Region -->
<g id="node1" class="node">
<title>Region</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M322,-247C322,-247 435,-247 435,-247 441,-247 447,-253 447,-259 447,-259 447,-350 447,-350 447,-356 441,-362 435,-362 435,-362 322,-362 322,-362 316,-362 310,-356 310,-350 310,-350 310,-259 310,-259 310,-253 316,-247 322,-247"/>
<text text-anchor="middle" x="378.5" y="-346.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Region</text>
<polyline fill="none" stroke="#60b5ac" points="310,-339 447,-339 "/>
<text text-anchor="start" x="318" y="-323.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">meta *metapb.Region</text>
<polyline fill="none" stroke="#60b5ac" points="310,-316 447,-316 "/>
<text text-anchor="start" x="318" y="-300.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">store unsafe.Pointer</text>
<polyline fill="none" stroke="#60b5ac" points="310,-293 447,-293 "/>
<text text-anchor="start" x="318" y="-277.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">syncFlag int32</text>
<polyline fill="none" stroke="#60b5ac" points="310,-270 447,-270 "/>
<text text-anchor="start" x="318" y="-254.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">lastAccess int64</text>
</g>
<!-- RegionStore -->
<g id="node2" class="node">
<title>RegionStore</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M495,-236.5C495,-236.5 687,-236.5 687,-236.5 693,-236.5 699,-242.5 699,-248.5 699,-248.5 699,-362.5 699,-362.5 699,-368.5 693,-374.5 687,-374.5 687,-374.5 495,-374.5 495,-374.5 489,-374.5 483,-368.5 483,-362.5 483,-362.5 483,-248.5 483,-248.5 483,-242.5 489,-236.5 495,-236.5"/>
<text text-anchor="middle" x="591" y="-359.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RegionStore</text>
<polyline fill="none" stroke="#60b5ac" points="483,-351.5 699,-351.5 "/>
<text text-anchor="start" x="491" y="-336.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">workTiKVIdx AccessIndex</text>
<polyline fill="none" stroke="#60b5ac" points="483,-328.5 699,-328.5 "/>
<text text-anchor="start" x="491" y="-313.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">workTiFlashIdx int32</text>
<polyline fill="none" stroke="#60b5ac" points="483,-305.5 699,-305.5 "/>
<text text-anchor="start" x="491" y="-290.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">stores []*Store</text>
<polyline fill="none" stroke="#60b5ac" points="483,-282.5 699,-282.5 "/>
<text text-anchor="start" x="491" y="-267.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">storeEpochs []uint32</text>
<polyline fill="none" stroke="#60b5ac" points="483,-259.5 699,-259.5 "/>
<text text-anchor="start" x="491" y="-244.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">accessIndex [NumAccessMode][]int</text>
</g>
<!-- Region&#45;&gt;RegionStore -->
<g id="edge1" class="edge">
<title>Region:store&#45;&gt;RegionStore</title>
<path fill="none" stroke="#666666" d="M447,-304.5C455.3,-304.5 463.87,-304.52 472.49,-304.55"/>
<polygon fill="#666666" stroke="#666666" points="472.62,-308.05 482.63,-304.59 472.65,-301.05 472.62,-308.05"/>
</g>
<!-- AccessMode -->
<g id="node3" class="node">
<title>AccessMode</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M747,-334C747,-334 869,-334 869,-334 875,-334 881,-340 881,-346 881,-346 881,-391 881,-391 881,-397 875,-403 869,-403 869,-403 747,-403 747,-403 741,-403 735,-397 735,-391 735,-391 735,-346 735,-346 735,-340 741,-334 747,-334"/>
<text text-anchor="middle" x="808" y="-387.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">AccessMode</text>
<polyline fill="none" stroke="#60b5ac" points="735,-380 881,-380 "/>
<text text-anchor="start" x="743" y="-364.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">TiKvOnly AccessMode</text>
<polyline fill="none" stroke="#60b5ac" points="735,-357 881,-357 "/>
<text text-anchor="start" x="743" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">TiFlashOnly </text>
</g>
<!-- RegionStore&#45;&gt;AccessMode -->
<g id="edge2" class="edge">
<title>RegionStore&#45;&gt;AccessMode</title>
<path fill="none" stroke="#666666" d="M699.19,-336.91C707.88,-339.46 716.58,-342 725.05,-344.49"/>
<polygon fill="#666666" stroke="#666666" points="724.3,-347.91 734.88,-347.37 726.26,-341.2 724.3,-347.91"/>
</g>
<!-- Store -->
<g id="node4" class="node">
<title>Store</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M929,-106.5C929,-106.5 1076,-106.5 1076,-106.5 1082,-106.5 1088,-112.5 1088,-118.5 1088,-118.5 1088,-324.5 1088,-324.5 1088,-330.5 1082,-336.5 1076,-336.5 1076,-336.5 929,-336.5 929,-336.5 923,-336.5 917,-330.5 917,-324.5 917,-324.5 917,-118.5 917,-118.5 917,-112.5 923,-106.5 929,-106.5"/>
<text text-anchor="middle" x="1002.5" y="-321.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Store</text>
<polyline fill="none" stroke="#60b5ac" points="917,-313.5 1088,-313.5 "/>
<text text-anchor="start" x="925" y="-298.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">addr string</text>
<polyline fill="none" stroke="#60b5ac" points="917,-290.5 1088,-290.5 "/>
<text text-anchor="start" x="925" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">saddr string</text>
<polyline fill="none" stroke="#60b5ac" points="917,-267.5 1088,-267.5 "/>
<text text-anchor="start" x="925" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">storeID uint64</text>
<polyline fill="none" stroke="#60b5ac" points="917,-244.5 1088,-244.5 "/>
<text text-anchor="start" x="925" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">state uint64</text>
<polyline fill="none" stroke="#60b5ac" points="917,-221.5 1088,-221.5 "/>
<text text-anchor="start" x="925" y="-206.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">labels []*metapb.StoreLabel</text>
<polyline fill="none" stroke="#60b5ac" points="917,-198.5 1088,-198.5 "/>
<text text-anchor="start" x="925" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">resolveMutex sync.Mutex</text>
<polyline fill="none" stroke="#60b5ac" points="917,-175.5 1088,-175.5 "/>
<text text-anchor="start" x="925" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">epoch uint32</text>
<polyline fill="none" stroke="#60b5ac" points="917,-152.5 1088,-152.5 "/>
<text text-anchor="start" x="925" y="-137.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">storeType kv.StoreType</text>
<polyline fill="none" stroke="#60b5ac" points="917,-129.5 1088,-129.5 "/>
<text text-anchor="start" x="925" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">tokenCount atomic2.Int64</text>
</g>
<!-- RegionStore&#45;&gt;Store -->
<g id="edge3" class="edge">
<title>RegionStore:Store&#45;&gt;Store</title>
<path fill="none" stroke="#666666" d="M699.28,-309.29C754.61,-308.52 822.45,-303.34 881,-286.5 889.81,-283.97 898.69,-280.72 907.44,-277.04"/>
<polygon fill="#666666" stroke="#666666" points="909.12,-280.12 916.86,-272.88 906.3,-273.72 909.12,-280.12"/>
</g>
<!-- loadRegion -->
<g id="node5" class="node">
<title>loadRegion</title>
<path fill="none" stroke="#1c2123" d="M67,-199.5C67,-199.5 12,-199.5 12,-199.5 6,-199.5 0,-193.5 0,-187.5 0,-187.5 0,-175.5 0,-175.5 0,-169.5 6,-163.5 12,-163.5 12,-163.5 67,-163.5 67,-163.5 73,-163.5 79,-169.5 79,-175.5 79,-175.5 79,-187.5 79,-187.5 79,-193.5 73,-199.5 67,-199.5"/>
<text text-anchor="middle" x="39.5" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">loadRegion</text>
</g>
<!-- init -->
<g id="node6" class="node">
<title>init</title>
<path fill="none" stroke="#1c2123" d="M209.5,-226.5C209.5,-226.5 179.5,-226.5 179.5,-226.5 173.5,-226.5 167.5,-220.5 167.5,-214.5 167.5,-214.5 167.5,-202.5 167.5,-202.5 167.5,-196.5 173.5,-190.5 179.5,-190.5 179.5,-190.5 209.5,-190.5 209.5,-190.5 215.5,-190.5 221.5,-196.5 221.5,-202.5 221.5,-202.5 221.5,-214.5 221.5,-214.5 221.5,-220.5 215.5,-226.5 209.5,-226.5"/>
<text text-anchor="middle" x="194.5" y="-204.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">init</text>
</g>
<!-- loadRegion&#45;&gt;init -->
<g id="edge4" class="edge">
<title>loadRegion&#45;&gt;init</title>
<path fill="none" stroke="#666666" d="M79.11,-188.31C103.17,-192.56 133.92,-197.99 157.47,-202.14"/>
<polygon fill="#666666" stroke="#666666" points="156.96,-205.61 167.42,-203.9 158.18,-198.71 156.96,-205.61"/>
</g>
<!-- switchWorkLeaderToPeer -->
<g id="node7" class="node">
<title>switchWorkLeaderToPeer</title>
<path fill="none" stroke="#1c2123" d="M262,-172.5C262,-172.5 127,-172.5 127,-172.5 121,-172.5 115,-166.5 115,-160.5 115,-160.5 115,-148.5 115,-148.5 115,-142.5 121,-136.5 127,-136.5 127,-136.5 262,-136.5 262,-136.5 268,-136.5 274,-142.5 274,-148.5 274,-148.5 274,-160.5 274,-160.5 274,-166.5 268,-172.5 262,-172.5"/>
<text text-anchor="middle" x="194.5" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">switchWorkLeaderToPeer</text>
</g>
<!-- loadRegion&#45;&gt;switchWorkLeaderToPeer -->
<g id="edge5" class="edge">
<title>loadRegion&#45;&gt;switchWorkLeaderToPeer</title>
<path fill="none" stroke="#666666" d="M79.11,-174.69C87.17,-173.26 95.98,-171.71 105.02,-170.11"/>
<polygon fill="#666666" stroke="#666666" points="105.66,-173.56 114.9,-168.37 104.44,-166.66 105.66,-173.56"/>
</g>
<!-- init&#45;&gt;Region -->
<g id="edge6" class="edge">
<title>init&#45;&gt;Region</title>
<path fill="none" stroke="#666666" d="M221.58,-222.25C242.33,-233.2 272.48,-249.11 300.76,-264.02"/>
<polygon fill="#666666" stroke="#666666" points="299.38,-267.25 309.86,-268.82 302.64,-261.06 299.38,-267.25"/>
</g>
<!-- getStoreByStoreID -->
<g id="node8" class="node">
<title>getStoreByStoreID</title>
<path fill="none" stroke="#1c2123" d="M426.5,-226.5C426.5,-226.5 330.5,-226.5 330.5,-226.5 324.5,-226.5 318.5,-220.5 318.5,-214.5 318.5,-214.5 318.5,-202.5 318.5,-202.5 318.5,-196.5 324.5,-190.5 330.5,-190.5 330.5,-190.5 426.5,-190.5 426.5,-190.5 432.5,-190.5 438.5,-196.5 438.5,-202.5 438.5,-202.5 438.5,-214.5 438.5,-214.5 438.5,-220.5 432.5,-226.5 426.5,-226.5"/>
<text text-anchor="middle" x="378.5" y="-204.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">getStoreByStoreID</text>
</g>
<!-- init&#45;&gt;getStoreByStoreID -->
<g id="edge7" class="edge">
<title>init&#45;&gt;getStoreByStoreID</title>
<path fill="none" stroke="#666666" d="M221.58,-208.5C244.18,-208.5 277.94,-208.5 308.28,-208.5"/>
<polygon fill="#666666" stroke="#666666" points="308.41,-212 318.41,-208.5 308.41,-205 308.41,-212"/>
</g>
<!-- initResolve -->
<g id="node9" class="node">
<title>initResolve</title>
<path fill="none" stroke="#1c2123" d="M405.5,-167.5C405.5,-167.5 351.5,-167.5 351.5,-167.5 345.5,-167.5 339.5,-161.5 339.5,-155.5 339.5,-155.5 339.5,-143.5 339.5,-143.5 339.5,-137.5 345.5,-131.5 351.5,-131.5 351.5,-131.5 405.5,-131.5 405.5,-131.5 411.5,-131.5 417.5,-137.5 417.5,-143.5 417.5,-143.5 417.5,-155.5 417.5,-155.5 417.5,-161.5 411.5,-167.5 405.5,-167.5"/>
<text text-anchor="middle" x="378.5" y="-145.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">initResolve</text>
</g>
<!-- init&#45;&gt;initResolve -->
<g id="edge8" class="edge">
<title>init&#45;&gt;initResolve</title>
<path fill="none" stroke="#666666" d="M221.58,-200.05C249.67,-190.94 294.98,-176.25 329.53,-165.05"/>
<polygon fill="#666666" stroke="#666666" points="330.99,-168.26 339.43,-161.84 328.83,-161.6 330.99,-168.26"/>
</g>
<!-- pdClient_GetStore -->
<g id="node10" class="node">
<title>pdClient_GetStore</title>
<path fill="none" stroke="#1c2123" d="M506,-102C506,-102 676,-102 676,-102 682,-102 688,-108 688,-114 688,-114 688,-181 688,-181 688,-187 682,-193 676,-193 676,-193 506,-193 506,-193 500,-193 494,-187 494,-181 494,-181 494,-114 494,-114 494,-108 500,-102 506,-102"/>
<text text-anchor="middle" x="591" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pdClient.GetStore</text>
<polyline fill="none" stroke="#1c2123" points="494,-170 688,-170 "/>
<text text-anchor="start" x="502" y="-154.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">gets a store from PD by store id</text>
<text text-anchor="start" x="502" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> the store may expire later</text>
<text text-anchor="start" x="502" y="-124.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> caller is responsible for caching</text>
<text text-anchor="start" x="502" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> and take care of store change</text>
</g>
<!-- initResolve&#45;&gt;pdClient_GetStore -->
<g id="edge9" class="edge">
<title>initResolve&#45;&gt;pdClient_GetStore</title>
<path fill="none" stroke="#666666" d="M417.62,-149.14C436.38,-148.96 460.03,-148.73 483.75,-148.51"/>
<polygon fill="#666666" stroke="#666666" points="483.94,-152.01 493.9,-148.41 483.87,-145.01 483.94,-152.01"/>
</g>
<!-- pd_Store -->
<g id="node11" class="node">
<title>pd_Store</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M750,-0.5C750,-0.5 866,-0.5 866,-0.5 872,-0.5 878,-6.5 878,-12.5 878,-12.5 878,-264.5 878,-264.5 878,-270.5 872,-276.5 866,-276.5 866,-276.5 750,-276.5 750,-276.5 744,-276.5 738,-270.5 738,-264.5 738,-264.5 738,-12.5 738,-12.5 738,-6.5 744,-0.5 750,-0.5"/>
<text text-anchor="middle" x="808" y="-261.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pd.Store</text>
<polyline fill="none" stroke="#60b5ac" points="738,-253.5 878,-253.5 "/>
<text text-anchor="start" x="746" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Id uint64</text>
<polyline fill="none" stroke="#60b5ac" points="738,-230.5 878,-230.5 "/>
<text text-anchor="start" x="746" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Address string </text>
<polyline fill="none" stroke="#60b5ac" points="738,-207.5 878,-207.5 "/>
<text text-anchor="start" x="746" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">State StoreState </text>
<polyline fill="none" stroke="#60b5ac" points="738,-184.5 878,-184.5 "/>
<text text-anchor="start" x="746" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Labels []*StoreLabel</text>
<polyline fill="none" stroke="#60b5ac" points="738,-161.5 878,-161.5 "/>
<text text-anchor="start" x="746" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Version string </text>
<polyline fill="none" stroke="#60b5ac" points="738,-138.5 878,-138.5 "/>
<text text-anchor="start" x="746" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerAddress string</text>
<polyline fill="none" stroke="#60b5ac" points="738,-115.5 878,-115.5 "/>
<text text-anchor="start" x="746" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">StatusAddress string</text>
<polyline fill="none" stroke="#60b5ac" points="738,-92.5 878,-92.5 "/>
<text text-anchor="start" x="746" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">GitHash string</text>
<polyline fill="none" stroke="#60b5ac" points="738,-69.5 878,-69.5 "/>
<text text-anchor="start" x="746" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">StartTimestamp int64 </text>
<polyline fill="none" stroke="#60b5ac" points="738,-46.5 878,-46.5 "/>
<text text-anchor="start" x="746" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">DeployPath string</text>
<polyline fill="none" stroke="#60b5ac" points="738,-23.5 878,-23.5 "/>
<text text-anchor="start" x="746" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LastHeartbeat int64 </text>
</g>
<!-- pdClient_GetStore&#45;&gt;pd_Store -->
<g id="edge10" class="edge">
<title>pdClient_GetStore&#45;&gt;pd_Store</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M688.18,-143.47C701.41,-142.92 714.88,-142.36 727.76,-141.82"/>
<polygon fill="green" stroke="green" points="728.11,-145.31 737.95,-141.39 727.81,-138.31 728.11,-145.31"/>
</g>
<!-- pd_Store&#45;&gt;Store -->
<g id="edge11" class="edge">
<title>pd_Store&#45;&gt;Store</title>
<path fill="none" stroke="#666666" d="M878.22,-168.35C887.7,-172.43 897.56,-176.68 907.38,-180.92"/>
<polygon fill="#666666" stroke="#666666" points="906.21,-184.23 916.78,-184.97 908.98,-177.8 906.21,-184.23"/>
</g>
</g>
</svg>
