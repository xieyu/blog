<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: consumeIntermData Pages: 1 -->
<svg width="1894pt" height="476pt"
 viewBox="0.00 0.00 1894.00 475.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 471.5)">
<title>consumeIntermData</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-471.5 1890,-471.5 1890,4 -4,4"/>
<!-- partialResultMap -->
<g id="node1" class="node">
<title>partialResultMap</title>
<polygon fill="#f6d887" stroke="black" points="1162.5,-172 1162.5,-233 1345.5,-233 1345.5,-172 1162.5,-172"/>
<text text-anchor="middle" x="1254" y="-217.8" font-family="Times,serif" font-size="14.00">partialResultMap</text>
<polyline fill="none" stroke="black" points="1162.5,-210 1345.5,-210 "/>
<text text-anchor="start" x="1170.5" y="-194.8" font-family="Times,serif" font-size="14.00">finalWorker自己的map</text>
<text text-anchor="start" x="1170.5" y="-179.8" font-family="Times,serif" font-size="14.00"> 用来存放merge之后的结果</text>
</g>
<!-- AppendFinalResult2Chunk -->
<g id="node11" class="node">
<title>AppendFinalResult2Chunk</title>
<polygon fill="none" stroke="black" points="1563,-175.5 1399,-175.5 1399,-139.5 1563,-139.5 1563,-175.5"/>
<text text-anchor="middle" x="1481" y="-153.8" font-family="Times,serif" font-size="14.00">AppendFinalResult2Chunk</text>
</g>
<!-- partialResultMap&#45;&gt;AppendFinalResult2Chunk -->
<g id="edge16" class="edge">
<title>partialResultMap&#45;&gt;AppendFinalResult2Chunk</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1345.54,-184.39C1359.83,-181.53 1374.61,-178.58 1388.91,-175.72"/>
<polygon fill="blue" stroke="blue" points="1389.6,-179.15 1398.72,-173.76 1388.23,-172.29 1389.6,-179.15"/>
</g>
<!-- HashAggFinalWorker_run -->
<g id="node2" class="node">
<title>HashAggFinalWorker_run</title>
<polygon fill="none" stroke="black" points="161,-182.5 0,-182.5 0,-146.5 161,-146.5 161,-182.5"/>
<text text-anchor="middle" x="80.5" y="-160.8" font-family="Times,serif" font-size="14.00">HashAggFinalWorker_run</text>
</g>
<!-- consumeIntermData -->
<g id="node3" class="node">
<title>consumeIntermData</title>
<polygon fill="none" stroke="black" points="325,-260.5 197,-260.5 197,-224.5 325,-224.5 325,-260.5"/>
<text text-anchor="middle" x="261" y="-238.8" font-family="Times,serif" font-size="14.00">consumeIntermData</text>
</g>
<!-- HashAggFinalWorker_run&#45;&gt;consumeIntermData -->
<g id="edge1" class="edge">
<title>HashAggFinalWorker_run&#45;&gt;consumeIntermData</title>
<path fill="none" stroke="#666666" d="M122.9,-182.59C148.6,-193.82 181.82,-208.34 209.13,-220.27"/>
<polygon fill="#666666" stroke="#666666" points="207.95,-223.58 218.52,-224.37 210.75,-217.16 207.95,-223.58"/>
</g>
<!-- getFinalResult -->
<g id="node4" class="node">
<title>getFinalResult</title>
<polygon fill="none" stroke="black" points="600,-31.5 600,-191.5 826,-191.5 826,-31.5 600,-31.5"/>
<text text-anchor="middle" x="713" y="-176.3" font-family="Times,serif" font-size="14.00">getFinalResult</text>
<polyline fill="none" stroke="black" points="600,-168.5 826,-168.5 "/>
<text text-anchor="start" x="608" y="-153.3" font-family="Times,serif" font-size="14.00">遍历groupSet</text>
<text text-anchor="start" x="608" y="-138.3" font-family="Times,serif" font-size="14.00"> 获取所有分组结果</text>
<polyline fill="none" stroke="black" points="600,-130.5 826,-130.5 "/>
<text text-anchor="start" x="608" y="-115.3" font-family="Times,serif" font-size="14.00">从fianlResultHolderCh中获取一个</text>
<text text-anchor="start" x="608" y="-100.3" font-family="Times,serif" font-size="14.00"> 可写的result chunk</text>
<polyline fill="none" stroke="black" points="600,-92.5 826,-92.5 "/>
<text text-anchor="start" x="608" y="-77.3" font-family="Times,serif" font-size="14.00">调用AppendFinalResult2Chunk</text>
<text text-anchor="start" x="608" y="-62.3" font-family="Times,serif" font-size="14.00"> 将结果写入result chunk</text>
<polyline fill="none" stroke="black" points="600,-54.5 826,-54.5 "/>
<text text-anchor="start" x="608" y="-39.3" font-family="Times,serif" font-size="14.00">然后写入finalOutputCh 传给主线程</text>
</g>
<!-- HashAggFinalWorker_run&#45;&gt;getFinalResult -->
<g id="edge2" class="edge">
<title>HashAggFinalWorker_run&#45;&gt;getFinalResult</title>
<path fill="none" stroke="#666666" d="M161.06,-150.84C216.84,-141.82 293.26,-130.58 361,-124.5 436.82,-117.69 522.17,-114.43 589.71,-112.88"/>
<polygon fill="#666666" stroke="#666666" points="590.05,-116.37 599.97,-112.65 589.9,-109.37 590.05,-116.37"/>
</g>
<!-- getPartialInput -->
<g id="node5" class="node">
<title>getPartialInput</title>
<polygon fill="none" stroke="black" points="389.5,-328.5 389.5,-404.5 535.5,-404.5 535.5,-328.5 389.5,-328.5"/>
<text text-anchor="middle" x="462.5" y="-389.3" font-family="Times,serif" font-size="14.00">getPartialInput</text>
<polyline fill="none" stroke="black" points="389.5,-381.5 535.5,-381.5 "/>
<text text-anchor="start" x="397.5" y="-366.3" font-family="Times,serif" font-size="14.00">从inputCh中获取数据</text>
<text text-anchor="start" x="397.5" y="-351.3" font-family="Times,serif" font-size="14.00"> 获取从PartialWorker</text>
<text text-anchor="start" x="397.5" y="-336.3" font-family="Times,serif" font-size="14.00"> 传过来的数据</text>
</g>
<!-- consumeIntermData&#45;&gt;getPartialInput -->
<g id="edge3" class="edge">
<title>consumeIntermData&#45;&gt;getPartialInput</title>
<path fill="none" stroke="#b83b5e" d="M285.38,-260.66C305.06,-275.59 334.19,-296.93 361,-313.5 367.23,-317.35 373.76,-321.2 380.39,-324.97"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="379.02,-328.21 389.45,-330.04 382.44,-322.1 379.02,-328.21"/>
</g>
<!-- getPartialResultBatch -->
<g id="node6" class="node">
<title>getPartialResultBatch</title>
<polygon fill="none" stroke="black" points="646,-316.5 646,-362.5 780,-362.5 780,-316.5 646,-316.5"/>
<text text-anchor="middle" x="713" y="-347.3" font-family="Times,serif" font-size="14.00">getPartialResultBatch</text>
<polyline fill="none" stroke="black" points="646,-339.5 780,-339.5 "/>
<text text-anchor="start" x="654" y="-324.3" font-family="Times,serif" font-size="14.00">获取一批groupKey</text>
</g>
<!-- consumeIntermData&#45;&gt;getPartialResultBatch -->
<g id="edge4" class="edge">
<title>consumeIntermData&#45;&gt;getPartialResultBatch</title>
<path fill="none" stroke="#b83b5e" d="M311.45,-260.51C327.15,-265.81 344.68,-271.31 361,-275.5 454.36,-299.44 563.9,-317.92 635.46,-328.74"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="635.33,-332.26 645.74,-330.28 636.37,-325.33 635.33,-332.26"/>
</g>
<!-- MergePartialResult -->
<g id="node7" class="node">
<title>MergePartialResult</title>
<polygon fill="none" stroke="black" points="878,-226.5 878,-302.5 1093,-302.5 1093,-226.5 878,-226.5"/>
<text text-anchor="middle" x="985.5" y="-287.3" font-family="Times,serif" font-size="14.00">MergePartialResult</text>
<polyline fill="none" stroke="black" points="878,-279.5 1093,-279.5 "/>
<text text-anchor="start" x="886" y="-264.3" font-family="Times,serif" font-size="14.00">调用af MergePartialResult接口</text>
<text text-anchor="start" x="886" y="-249.3" font-family="Times,serif" font-size="14.00"> 将partialWorker的partialResutMap</text>
<text text-anchor="start" x="886" y="-234.3" font-family="Times,serif" font-size="14.00"> 和finalWorker的合并</text>
</g>
<!-- consumeIntermData&#45;&gt;MergePartialResult -->
<g id="edge5" class="edge">
<title>consumeIntermData&#45;&gt;MergePartialResult</title>
<path fill="none" stroke="#b83b5e" d="M325.17,-244.42C446.37,-248.11 713.22,-256.24 867.71,-260.94"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="867.62,-264.44 877.72,-261.25 867.83,-257.45 867.62,-264.44"/>
</g>
<!-- groupSet -->
<g id="node8" class="node">
<title>groupSet</title>
<polygon fill="#f6d887" stroke="black" points="361,-134 361,-195 564,-195 564,-134 361,-134"/>
<text text-anchor="middle" x="462.5" y="-179.8" font-family="Times,serif" font-size="14.00">groupSet</text>
<polyline fill="none" stroke="black" points="361,-172 564,-172 "/>
<text text-anchor="start" x="369" y="-156.8" font-family="Times,serif" font-size="14.00">set.StringSet</text>
<text text-anchor="start" x="369" y="-141.8" font-family="Times,serif" font-size="14.00"> 用来最后遍历所有的groupKey</text>
</g>
<!-- consumeIntermData&#45;&gt;groupSet -->
<g id="edge6" class="edge">
<title>consumeIntermData&#45;&gt;groupSet</title>
<path fill="none" stroke="#b83b5e" d="M308.27,-224.41C327.81,-216.77 351.24,-207.61 373.82,-198.78"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="375.4,-201.92 383.44,-195.02 372.85,-195.4 375.4,-201.92"/>
</g>
<!-- getPartialResult -->
<g id="node9" class="node">
<title>getPartialResult</title>
<polygon fill="none" stroke="black" points="1037,-207.5 934,-207.5 934,-171.5 1037,-171.5 1037,-207.5"/>
<text text-anchor="middle" x="985.5" y="-185.8" font-family="Times,serif" font-size="14.00">getPartialResult</text>
</g>
<!-- consumeIntermData&#45;&gt;getPartialResult -->
<g id="edge7" class="edge">
<title>consumeIntermData&#45;&gt;getPartialResult</title>
<path fill="none" stroke="#b83b5e" d="M325.02,-237.98C429.26,-230.49 644.14,-214.99 826,-201.5 858.25,-199.11 894.19,-196.39 923.68,-194.15"/>
<polygon fill="#b83b5e" stroke="#b83b5e" points="924.12,-197.62 933.82,-193.38 923.59,-190.64 924.12,-197.62"/>
</g>
<!-- getFinalResult&#45;&gt;getPartialResult -->
<g id="edge9" class="edge">
<title>getFinalResult&#45;&gt;getPartialResult</title>
<path fill="none" stroke="#3f72af" d="M826.16,-146.95C838.24,-150.59 850.36,-154.17 862,-157.5 882.16,-163.26 904.3,-169.17 924.15,-174.32"/>
<polygon fill="#3f72af" stroke="#3f72af" points="923.44,-177.75 934,-176.86 925.19,-170.97 923.44,-177.75"/>
</g>
<!-- getFinalResult&#45;&gt;AppendFinalResult2Chunk -->
<g id="edge10" class="edge">
<title>getFinalResult&#45;&gt;AppendFinalResult2Chunk</title>
<path fill="none" stroke="#3f72af" d="M826.2,-118.24C978.54,-127.39 1247.88,-143.56 1388.6,-152.01"/>
<polygon fill="#3f72af" stroke="#3f72af" points="1388.72,-155.52 1398.92,-152.63 1389.14,-148.54 1388.72,-155.52"/>
</g>
<!-- receiveFinalResultHolder -->
<g id="node12" class="node">
<title>receiveFinalResultHolder</title>
<polygon fill="none" stroke="black" points="1599,-68 1599,-129 1754,-129 1754,-68 1599,-68"/>
<text text-anchor="middle" x="1676.5" y="-113.8" font-family="Times,serif" font-size="14.00">receiveFinalResultHolder</text>
<polyline fill="none" stroke="black" points="1599,-106 1754,-106 "/>
<text text-anchor="start" x="1607" y="-90.8" font-family="Times,serif" font-size="14.00">从ch中获取</text>
<text text-anchor="start" x="1607" y="-75.8" font-family="Times,serif" font-size="14.00"> 输出result chunk指针</text>
</g>
<!-- getFinalResult&#45;&gt;receiveFinalResultHolder -->
<g id="edge11" class="edge">
<title>getFinalResult&#45;&gt;receiveFinalResultHolder</title>
<path fill="none" stroke="#3f72af" d="M826.18,-109.98C1020.09,-107.36 1413.96,-102.04 1588.67,-99.67"/>
<polygon fill="#3f72af" stroke="#3f72af" points="1588.9,-103.17 1598.85,-99.54 1588.8,-96.17 1588.9,-103.17"/>
</g>
<!-- finalOutputCh -->
<g id="node15" class="node">
<title>finalOutputCh</title>
<polygon fill="none" stroke="black" points="1032.5,-67.5 938.5,-67.5 938.5,-31.5 1032.5,-31.5 1032.5,-67.5"/>
<text text-anchor="middle" x="985.5" y="-45.8" font-family="Times,serif" font-size="14.00">finalOutputCh</text>
</g>
<!-- getFinalResult&#45;&gt;finalOutputCh -->
<g id="edge23" class="edge">
<title>getFinalResult&#45;&gt;finalOutputCh</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M826.37,-85.75C861.42,-77.71 898.6,-69.19 928.09,-62.43"/>
<polygon fill="blue" stroke="blue" points="929.21,-65.76 938.18,-60.12 927.65,-58.94 929.21,-65.76"/>
</g>
<!-- getPartialInput&#45;&gt;getPartialResultBatch -->
<g id="edge13" class="edge">
<title>getPartialInput&#45;&gt;getPartialResultBatch</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M535.71,-358.65C567.13,-355.24 603.97,-351.24 635.83,-347.78"/>
<polygon fill="blue" stroke="blue" points="636.42,-351.23 645.98,-346.67 635.66,-344.27 636.42,-351.23"/>
</g>
<!-- getPartialResultBatch&#45;&gt;MergePartialResult -->
<g id="edge14" class="edge">
<title>getPartialResultBatch&#45;&gt;MergePartialResult</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M780.17,-321.15C806.7,-313.8 838.09,-305.1 868.19,-296.75"/>
<polygon fill="blue" stroke="blue" points="869.21,-300.1 877.91,-294.05 867.34,-293.35 869.21,-300.1"/>
</g>
<!-- HashAggIntermData -->
<g id="node10" class="node">
<title>HashAggIntermData</title>
<polygon fill="none" stroke="black" points="862,-322 862,-467 1109,-467 1109,-322 862,-322"/>
<text text-anchor="middle" x="985.5" y="-451.8" font-family="Times,serif" font-size="14.00">HashAggIntermData</text>
<polyline fill="none" stroke="black" points="862,-444 1109,-444 "/>
<text text-anchor="start" x="870" y="-428.8" font-family="Times,serif" font-size="14.00">groupKeys []string</text>
<polyline fill="none" stroke="black" points="862,-421 1109,-421 "/>
<text text-anchor="start" x="870" y="-405.8" font-family="Times,serif" font-size="14.00">cursor int</text>
<polyline fill="none" stroke="black" points="862,-398 1109,-398 "/>
<text text-anchor="start" x="870" y="-382.8" font-family="Times,serif" font-size="14.00">partialResultMap aggPartialResultMapper</text>
<polyline fill="none" stroke="black" points="862,-375 1109,-375 "/>
<text text-anchor="start" x="870" y="-359.8" font-family="Times,serif" font-size="14.00">PartialWorker输出的中间数据</text>
<text text-anchor="start" x="870" y="-344.8" font-family="Times,serif" font-size="14.00"> 这里面的partialResultMap</text>
<text text-anchor="start" x="870" y="-329.8" font-family="Times,serif" font-size="14.00"> 是PartialWorker的</text>
</g>
<!-- getPartialResultBatch&#45;&gt;HashAggIntermData -->
<g id="edge8" class="edge">
<title>getPartialResultBatch&#45;&gt;HashAggIntermData</title>
<path fill="none" stroke="#666666" d="M780.17,-352.95C801.99,-357.39 827.08,-362.49 852.05,-367.57"/>
<polygon fill="#666666" stroke="#666666" points="851.48,-371.03 861.98,-369.59 852.88,-364.17 851.48,-371.03"/>
</g>
<!-- MergePartialResult&#45;&gt;partialResultMap -->
<g id="edge15" class="edge">
<title>MergePartialResult&#45;&gt;partialResultMap</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1093.36,-239.64C1112.84,-235.11 1133.11,-230.39 1152.41,-225.9"/>
<polygon fill="blue" stroke="blue" points="1153.45,-229.25 1162.4,-223.58 1151.86,-222.44 1153.45,-229.25"/>
</g>
<!-- groupSet&#45;&gt;getFinalResult -->
<g id="edge17" class="edge">
<title>groupSet&#45;&gt;getFinalResult</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M564.22,-143.02C572.63,-141.22 581.19,-139.4 589.74,-137.58"/>
<polygon fill="blue" stroke="blue" points="590.71,-140.95 599.76,-135.44 589.25,-134.1 590.71,-140.95"/>
</g>
<!-- getPartialResult&#45;&gt;partialResultMap -->
<g id="edge12" class="edge">
<title>getPartialResult&#45;&gt;partialResultMap</title>
<path fill="none" stroke="#666666" d="M1037.25,-191.98C1069.62,-193.55 1112.7,-195.66 1151.85,-197.57"/>
<polygon fill="#666666" stroke="#666666" points="1152.08,-201.08 1162.24,-198.07 1152.43,-194.09 1152.08,-201.08"/>
</g>
<!-- result -->
<g id="node14" class="node">
<title>result</title>
<polygon fill="#f6d887" stroke="black" points="1790,-104.5 1790,-150.5 1886,-150.5 1886,-104.5 1790,-104.5"/>
<text text-anchor="middle" x="1838" y="-135.3" font-family="Times,serif" font-size="14.00">result</text>
<polyline fill="none" stroke="black" points="1790,-127.5 1886,-127.5 "/>
<text text-anchor="start" x="1798" y="-112.3" font-family="Times,serif" font-size="14.00">*chunk.Chunk</text>
</g>
<!-- AppendFinalResult2Chunk&#45;&gt;result -->
<g id="edge19" class="edge">
<title>AppendFinalResult2Chunk&#45;&gt;result</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1563.04,-153.16C1617.19,-149.93 1689.95,-144.98 1754,-138.5 1762.32,-137.66 1771.08,-136.64 1779.68,-135.57"/>
<polygon fill="blue" stroke="blue" points="1780.18,-139.03 1789.66,-134.29 1779.29,-132.09 1780.18,-139.03"/>
</g>
<!-- receiveFinalResultHolder&#45;&gt;result -->
<g id="edge18" class="edge">
<title>receiveFinalResultHolder&#45;&gt;result</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1754.45,-112.49C1763.06,-114.06 1771.71,-115.63 1780,-117.14"/>
<polygon fill="blue" stroke="blue" points="1779.45,-120.59 1789.91,-118.94 1780.7,-113.71 1779.45,-120.59"/>
</g>
<!-- parallelExec -->
<g id="node13" class="node">
<title>parallelExec</title>
<polygon fill="none" stroke="black" points="1145,-0.5 1145,-76.5 1363,-76.5 1363,-0.5 1145,-0.5"/>
<text text-anchor="middle" x="1254" y="-61.3" font-family="Times,serif" font-size="14.00">parallelExec</text>
<polyline fill="none" stroke="black" points="1145,-53.5 1363,-53.5 "/>
<text text-anchor="start" x="1153" y="-38.3" font-family="Times,serif" font-size="14.00">从finalOutputCh中获取result chunk</text>
<text text-anchor="start" x="1153" y="-23.3" font-family="Times,serif" font-size="14.00"> swap之后，再将result 放回到</text>
<text text-anchor="start" x="1153" y="-8.3" font-family="Times,serif" font-size="14.00"> finalResultHolderCh</text>
</g>
<!-- finalResultHolderCh -->
<g id="node16" class="node">
<title>finalResultHolderCh</title>
<polygon fill="none" stroke="black" points="1545,-67.5 1417,-67.5 1417,-31.5 1545,-31.5 1545,-67.5"/>
<text text-anchor="middle" x="1481" y="-45.8" font-family="Times,serif" font-size="14.00">finalResultHolderCh</text>
</g>
<!-- parallelExec&#45;&gt;finalResultHolderCh -->
<g id="edge21" class="edge">
<title>parallelExec&#45;&gt;finalResultHolderCh</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1363.22,-43.79C1377.84,-44.51 1392.56,-45.23 1406.39,-45.9"/>
<polygon fill="blue" stroke="blue" points="1406.61,-49.42 1416.77,-46.41 1406.95,-42.42 1406.61,-49.42"/>
</g>
<!-- finalOutputCh&#45;&gt;parallelExec -->
<g id="edge20" class="edge">
<title>finalOutputCh&#45;&gt;parallelExec</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1032.62,-47.6C1060.94,-46.43 1098.62,-44.87 1134.8,-43.38"/>
<polygon fill="blue" stroke="blue" points="1135.11,-46.87 1144.95,-42.96 1134.82,-39.88 1135.11,-46.87"/>
</g>
<!-- finalResultHolderCh&#45;&gt;receiveFinalResultHolder -->
<g id="edge22" class="edge">
<title>finalResultHolderCh&#45;&gt;receiveFinalResultHolder</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M1545.09,-65.48C1559.2,-69.05 1574.41,-72.9 1589.28,-76.67"/>
<polygon fill="blue" stroke="blue" points="1588.43,-80.06 1598.99,-79.12 1590.15,-73.28 1588.43,-80.06"/>
</g>
</g>
</svg>
