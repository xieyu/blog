<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: schema_meta Pages: 1 -->
<svg width="1172pt" height="269pt"
 viewBox="0.00 0.00 1172.00 269.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 265)">
<title>schema_meta</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-265 1168,-265 1168,4 -4,4"/>
<!-- ddl_worker -->
<g id="node1" class="node">
<title>ddl_worker</title>
<polygon fill="none" stroke="black" points="0,-123 0,-260 247,-260 247,-123 0,-123"/>
<text text-anchor="middle" x="123.5" y="-244.8" font-family="Times,serif" font-size="14.00">ddl_worker</text>
<polyline fill="none" stroke="black" points="0,-237 247,-237 "/>
<text text-anchor="start" x="8" y="-221.8" font-family="Times,serif" font-size="14.00">TiDB集群中的owner节点</text>
<polyline fill="none" stroke="black" points="0,-214 247,-214 "/>
<text text-anchor="start" x="8" y="-198.8" font-family="Times,serif" font-size="14.00">负责从job队列中 取ddljob</text>
<text text-anchor="start" x="8" y="-183.8" font-family="Times,serif" font-size="14.00"> 然后调用runDDLJob 修改schema</text>
<text text-anchor="start" x="8" y="-168.8" font-family="Times,serif" font-size="14.00"> 这样保证只有一个节点在修改schema</text>
<polyline fill="none" stroke="black" points="0,-161 247,-161 "/>
<text text-anchor="start" x="8" y="-145.8" font-family="Times,serif" font-size="14.00">每执行一次DDLJob会wait 2*lease time</text>
<text text-anchor="start" x="8" y="-130.8" font-family="Times,serif" font-size="14.00"> 等待TiDB服务都更新完了schema</text>
</g>
<!-- Meta -->
<g id="node2" class="node">
<title>Meta</title>
<polygon fill="none" stroke="black" points="311,-0.5 311,-260.5 505,-260.5 505,-0.5 311,-0.5"/>
<text text-anchor="middle" x="408" y="-245.3" font-family="Times,serif" font-size="14.00">Meta</text>
<polyline fill="none" stroke="black" points="311,-237.5 505,-237.5 "/>
<text text-anchor="start" x="319" y="-222.3" font-family="Times,serif" font-size="14.00">在TxSttructure基础上封装</text>
<text text-anchor="start" x="319" y="-207.3" font-family="Times,serif" font-size="14.00"> 一些创建数据库，表等方法</text>
<text text-anchor="start" x="319" y="-192.3" font-family="Times,serif" font-size="14.00"> 还有计算dbKey/tableKey方法</text>
<polyline fill="none" stroke="black" points="311,-184.5 505,-184.5 "/>
<text text-anchor="start" x="319" y="-169.3" font-family="Times,serif" font-size="14.00">+ txn * structure.TxStructure</text>
<polyline fill="none" stroke="black" points="311,-161.5 505,-161.5 "/>
<text text-anchor="start" x="319" y="-146.3" font-family="Times,serif" font-size="14.00">+ StartTS uint64</text>
<polyline fill="none" stroke="black" points="311,-138.5 505,-138.5 "/>
<text text-anchor="start" x="319" y="-123.3" font-family="Times,serif" font-size="14.00">+ jobListKey JobListKeyType</text>
<polyline fill="none" stroke="black" points="311,-115.5 505,-115.5 "/>
<text text-anchor="start" x="319" y="-100.3" font-family="Times,serif" font-size="14.00">&#45; CreateDatabase</text>
<polyline fill="none" stroke="black" points="311,-92.5 505,-92.5 "/>
<text text-anchor="start" x="319" y="-77.3" font-family="Times,serif" font-size="14.00">&#45; DropDatabase</text>
<polyline fill="none" stroke="black" points="311,-69.5 505,-69.5 "/>
<text text-anchor="start" x="319" y="-54.3" font-family="Times,serif" font-size="14.00">&#45; GenAutoRandomID</text>
<polyline fill="none" stroke="black" points="311,-46.5 505,-46.5 "/>
<text text-anchor="start" x="319" y="-31.3" font-family="Times,serif" font-size="14.00">&#45; GetAutoTableID</text>
<polyline fill="none" stroke="black" points="311,-23.5 505,-23.5 "/>
<text text-anchor="start" x="319" y="-8.3" font-family="Times,serif" font-size="14.00">&#45; CreateTableOrView</text>
</g>
<!-- ddl_worker&#45;&gt;Meta -->
<g id="edge1" class="edge">
<title>ddl_worker&#45;&gt;Meta</title>
<path fill="none" stroke="#666666" d="M247.18,-165.01C264.98,-161.17 283.18,-157.24 300.62,-153.47"/>
<polygon fill="#666666" stroke="#666666" points="301.76,-156.81 310.79,-151.27 300.28,-149.96 301.76,-156.81"/>
<text text-anchor="middle" x="279" y="-164.3" font-family="Times,serif" font-size="14.00">write</text>
</g>
<!-- TxStructure -->
<g id="node4" class="node">
<title>TxStructure</title>
<polygon fill="none" stroke="black" points="542,-31 542,-230 744,-230 744,-31 542,-31"/>
<text text-anchor="middle" x="643" y="-214.8" font-family="Times,serif" font-size="14.00">TxStructure</text>
<polyline fill="none" stroke="black" points="542,-207 744,-207 "/>
<text text-anchor="start" x="550" y="-191.8" font-family="Times,serif" font-size="14.00">支持事务的</text>
<text text-anchor="start" x="550" y="-176.8" font-family="Times,serif" font-size="14.00"> string/hash/list等数据结构</text>
<polyline fill="none" stroke="black" points="542,-169 744,-169 "/>
<text text-anchor="start" x="550" y="-153.8" font-family="Times,serif" font-size="14.00">+ reader kv.Retriever</text>
<polyline fill="none" stroke="black" points="542,-146 744,-146 "/>
<text text-anchor="start" x="550" y="-130.8" font-family="Times,serif" font-size="14.00">+ readWriter kv.RetrieverMutator</text>
<polyline fill="none" stroke="black" points="542,-123 744,-123 "/>
<text text-anchor="start" x="550" y="-107.8" font-family="Times,serif" font-size="14.00">+ prefix []byte</text>
<polyline fill="none" stroke="black" points="542,-100 744,-100 "/>
<text text-anchor="start" x="550" y="-84.8" font-family="Times,serif" font-size="14.00">&#45; HSet</text>
<polyline fill="none" stroke="black" points="542,-77 744,-77 "/>
<text text-anchor="start" x="550" y="-61.8" font-family="Times,serif" font-size="14.00">&#45; HGet</text>
<polyline fill="none" stroke="black" points="542,-54 744,-54 "/>
<text text-anchor="start" x="550" y="-38.8" font-family="Times,serif" font-size="14.00">&#45; HDel</text>
</g>
<!-- Meta&#45;&gt;TxStructure -->
<g id="edge5" class="edge">
<title>Meta&#45;&gt;TxStructure</title>
<path fill="none" stroke="#666666" d="M505.12,-130.5C513.95,-130.5 522.95,-130.5 531.89,-130.5"/>
<polygon fill="#666666" stroke="#666666" points="531.96,-134 541.96,-130.5 531.96,-127 531.96,-134"/>
</g>
<!-- loadInfoSchema -->
<g id="node3" class="node">
<title>loadInfoSchema</title>
<polygon fill="none" stroke="black" points="19,-35 19,-104 228,-104 228,-35 19,-35"/>
<text text-anchor="middle" x="123.5" y="-88.8" font-family="Times,serif" font-size="14.00">loadInfoSchema</text>
<polyline fill="none" stroke="black" points="19,-81 228,-81 "/>
<text text-anchor="start" x="27" y="-65.8" font-family="Times,serif" font-size="14.00">每个TiDB server有个go routine</text>
<polyline fill="none" stroke="black" points="19,-58 228,-58 "/>
<text text-anchor="start" x="27" y="-42.8" font-family="Times,serif" font-size="14.00">每隔lease/2时间加载一次schema</text>
</g>
<!-- loadInfoSchema&#45;&gt;Meta -->
<g id="edge2" class="edge">
<title>loadInfoSchema&#45;&gt;Meta</title>
<path fill="none" stroke="#666666" d="M228.09,-91.87C251.89,-97.01 277.24,-102.48 301.14,-107.64"/>
<polygon fill="#666666" stroke="#666666" points="300.41,-111.07 310.93,-109.76 301.89,-104.22 300.41,-111.07"/>
<text text-anchor="middle" x="279" y="-108.3" font-family="Times,serif" font-size="14.00">read</text>
</g>
<!-- Mutator -->
<g id="node5" class="node">
<title>Mutator</title>
<polygon fill="none" stroke="black" points="781,-96 781,-165 915,-165 915,-96 781,-96"/>
<text text-anchor="middle" x="848" y="-149.8" font-family="Times,serif" font-size="14.00">Mutator</text>
<polyline fill="none" stroke="black" points="781,-142 915,-142 "/>
<text text-anchor="start" x="789" y="-126.8" font-family="Times,serif" font-size="14.00">&#45; Set(k Key, v []byte)</text>
<polyline fill="none" stroke="black" points="781,-119 915,-119 "/>
<text text-anchor="start" x="789" y="-103.8" font-family="Times,serif" font-size="14.00">&#45; Delete(k Key) error</text>
</g>
<!-- TxStructure&#45;&gt;Mutator -->
<g id="edge3" class="edge">
<title>TxStructure&#45;&gt;Mutator</title>
<path fill="none" stroke="#666666" d="M744.01,-130.5C753,-130.5 762.01,-130.5 770.75,-130.5"/>
<polygon fill="#666666" stroke="#666666" points="770.87,-134 780.87,-130.5 770.87,-127 770.87,-134"/>
</g>
<!-- tikvTxn -->
<g id="node6" class="node">
<title>tikvTxn</title>
<polygon fill="none" stroke="black" points="952,-107.5 952,-153.5 1164,-153.5 1164,-107.5 952,-107.5"/>
<text text-anchor="middle" x="1058" y="-138.3" font-family="Times,serif" font-size="14.00">tikvTxn</text>
<polyline fill="none" stroke="black" points="952,-130.5 1164,-130.5 "/>
<text text-anchor="start" x="960" y="-115.3" font-family="Times,serif" font-size="14.00">tikvTxn implements kv.Transaction</text>
</g>
<!-- Mutator&#45;&gt;tikvTxn -->
<g id="edge4" class="edge">
<title>Mutator&#45;&gt;tikvTxn</title>
<path fill="none" stroke="#666666" d="M915.1,-130.5C923.65,-130.5 932.61,-130.5 941.68,-130.5"/>
<polygon fill="#666666" stroke="#666666" points="941.95,-134 951.95,-130.5 941.95,-127 941.95,-134"/>
</g>
</g>
</svg>
