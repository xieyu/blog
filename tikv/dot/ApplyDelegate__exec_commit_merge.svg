<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: ApplyDelegate__exec_commit_merge Pages: 1 -->
<svg width="1109pt" height="398pt"
 viewBox="0.00 0.00 1109.00 397.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 393.5)">
<title>ApplyDelegate__exec_commit_merge</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-393.5 1105,-393.5 1105,4 -4,4"/>
<!-- ApplyDelegate__exec_commit_merge -->
<g id="node1" class="node">
<title>ApplyDelegate__exec_commit_merge</title>
<path fill="none" stroke="#1c2123" d="M239,-223C239,-223 425,-223 425,-223 431,-223 437,-229 437,-235 437,-235 437,-272 437,-272 437,-278 431,-284 425,-284 425,-284 239,-284 239,-284 233,-284 227,-278 227,-272 227,-272 227,-235 227,-235 227,-229 233,-223 239,-223"/>
<text text-anchor="start" x="235" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="235" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> exec_commit_merge</text>
<polyline fill="none" stroke="#1c2123" points="227,-246 437,-246 "/>
<text text-anchor="start" x="235" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送CatchUpLogs给Source region</text>
</g>
<!-- SignificantMsg__CatchUpLogs -->
<g id="node2" class="node">
<title>SignificantMsg__CatchUpLogs</title>
<path fill="none" stroke="#1c2123" d="M649,-282C649,-282 867,-282 867,-282 873,-282 879,-288 879,-294 879,-294 879,-377 879,-377 879,-383 873,-389 867,-389 867,-389 649,-389 649,-389 643,-389 637,-383 637,-377 637,-377 637,-294 637,-294 637,-288 643,-282 649,-282"/>
<text text-anchor="start" x="645" y="-373.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SignificantMsg</text>
<text text-anchor="start" x="645" y="-358.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> CatchUpLogs</text>
<polyline fill="none" stroke="#1c2123" points="637,-351 879,-351 "/>
<text text-anchor="start" x="645" y="-335.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub target_region_id: u64,</text>
<polyline fill="none" stroke="#1c2123" points="637,-328 879,-328 "/>
<text text-anchor="start" x="645" y="-312.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub merge: CommitMergeRequest,</text>
<polyline fill="none" stroke="#1c2123" points="637,-305 879,-305 "/>
<text text-anchor="start" x="645" y="-289.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub logs_up_to_date: Arc&lt;AtomicU64&gt;,</text>
</g>
<!-- ApplyDelegate__exec_commit_merge&#45;&gt;SignificantMsg__CatchUpLogs -->
<g id="edge1" class="edge">
<title>ApplyDelegate__exec_commit_merge&#45;&gt;SignificantMsg__CatchUpLogs</title>
<path fill="none" stroke="#666666" d="M437.27,-273.66C494.52,-284.74 566.05,-298.57 626.93,-310.35"/>
<polygon fill="#666666" stroke="#666666" points="626.51,-313.83 637,-312.29 627.84,-306.96 626.51,-313.83"/>
</g>
<!-- ApplyContext__notifier__PeerMsg__SignificantMsg -->
<g id="node3" class="node">
<title>ApplyContext__notifier__PeerMsg__SignificantMsg</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M968,-275C968,-275 1048,-275 1048,-275 1054,-275 1060,-281 1060,-287 1060,-287 1060,-354 1060,-354 1060,-360 1054,-366 1048,-366 1048,-366 968,-366 968,-366 962,-366 956,-360 956,-354 956,-354 956,-287 956,-287 956,-281 962,-275 968,-275"/>
<text text-anchor="start" x="964" y="-350.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ApplyContext</text>
<text text-anchor="start" x="964" y="-335.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> notifier</text>
<text text-anchor="start" x="964" y="-320.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> PeerMsg</text>
<text text-anchor="start" x="964" y="-305.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> SignificantMsg</text>
<polyline fill="none" stroke="#8a8898" points="956,-298 1060,-298 "/>
<text text-anchor="start" x="964" y="-282.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">CatchUpLogs</text>
</g>
<!-- ApplyDelegate__exec_commit_merge&#45;&gt;ApplyContext__notifier__PeerMsg__SignificantMsg -->
<g id="edge2" class="edge">
<title>ApplyDelegate__exec_commit_merge&#45;&gt;ApplyContext__notifier__PeerMsg__SignificantMsg</title>
<path fill="none" stroke="#666666" d="M437.04,-247.22C547.76,-242.83 727.5,-242.3 879,-272.5 901.61,-277.01 925.48,-285 946.41,-293.19"/>
<polygon fill="#666666" stroke="#666666" points="945.22,-296.49 955.81,-296.96 947.83,-289.99 945.22,-296.49"/>
</g>
<!-- ApplyResult__WaitMergeSource -->
<g id="node4" class="node">
<title>ApplyResult__WaitMergeSource</title>
<path fill="none" stroke="#1c2123" d="M489,-164C489,-164 585,-164 585,-164 591,-164 597,-170 597,-176 597,-176 597,-213 597,-213 597,-219 591,-225 585,-225 585,-225 489,-225 489,-225 483,-225 477,-219 477,-213 477,-213 477,-176 477,-176 477,-170 483,-164 489,-164"/>
<text text-anchor="start" x="485" y="-209.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyResult</text>
<text text-anchor="start" x="485" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> WaitMergeSource</text>
<polyline fill="none" stroke="#1c2123" points="477,-187 597,-187 "/>
<text text-anchor="start" x="485" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Arc&lt;AtomicU64&gt;</text>
</g>
<!-- ApplyDelegate__exec_commit_merge&#45;&gt;ApplyResult__WaitMergeSource -->
<g id="edge3" class="edge">
<title>ApplyDelegate__exec_commit_merge&#45;&gt;ApplyResult__WaitMergeSource</title>
<path fill="none" stroke="#666666" d="M437.18,-223.22C447.29,-220.28 457.37,-217.35 467.01,-214.55"/>
<polygon fill="#666666" stroke="#666666" points="468.26,-217.83 476.89,-211.68 466.31,-211.11 468.26,-217.83"/>
</g>
<!-- AdminRequest__get_commit_merge -->
<g id="node5" class="node">
<title>AdminRequest__get_commit_merge</title>
<path fill="none" stroke="#1c2123" d="M485,-320.5C485,-320.5 589,-320.5 589,-320.5 595,-320.5 601,-326.5 601,-332.5 601,-332.5 601,-346.5 601,-346.5 601,-352.5 595,-358.5 589,-358.5 589,-358.5 485,-358.5 485,-358.5 479,-358.5 473,-352.5 473,-346.5 473,-346.5 473,-332.5 473,-332.5 473,-326.5 479,-320.5 485,-320.5"/>
<text text-anchor="start" x="481" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">AdminRequest</text>
<text text-anchor="start" x="481" y="-328.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_commit_merge</text>
</g>
<!-- ApplyDelegate__exec_commit_merge&#45;&gt;AdminRequest__get_commit_merge -->
<g id="edge4" class="edge">
<title>ApplyDelegate__exec_commit_merge&#45;&gt;AdminRequest__get_commit_merge</title>
<path fill="none" stroke="#666666" d="M405.14,-284.06C430.28,-294.71 458.05,-306.48 481.52,-316.42"/>
<polygon fill="#666666" stroke="#666666" points="480.38,-319.74 490.95,-320.42 483.11,-313.29 480.38,-319.74"/>
</g>
<!-- SignificantMsg__CatchUpLogs&#45;&gt;ApplyContext__notifier__PeerMsg__SignificantMsg -->
<g id="edge6" class="edge">
<title>SignificantMsg__CatchUpLogs&#45;&gt;ApplyContext__notifier__PeerMsg__SignificantMsg</title>
<path fill="none" stroke="#666666" d="M879,-328.24C902.17,-326.84 925.52,-325.43 945.82,-324.2"/>
<polygon fill="#666666" stroke="#666666" points="946.06,-327.69 955.83,-323.6 945.63,-320.71 946.06,-327.69"/>
</g>
<!-- ApplyDelegate__wait_merge_state -->
<g id="node6" class="node">
<title>ApplyDelegate__wait_merge_state</title>
<path fill="#feed9b" stroke="#f7e495" d="M661,-105C661,-105 855,-105 855,-105 861,-105 867,-111 867,-117 867,-117 867,-154 867,-154 867,-160 861,-166 855,-166 855,-166 661,-166 661,-166 655,-166 649,-160 649,-154 649,-154 649,-117 649,-117 649,-111 655,-105 661,-105"/>
<text text-anchor="start" x="657" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyDelegate</text>
<text text-anchor="start" x="657" y="-135.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> wait_merge_state</text>
<polyline fill="none" stroke="#f7e495" points="649,-128 867,-128 "/>
<text text-anchor="start" x="657" y="-112.8" font-family="Times,serif" font-size="14.00" fill="#40575d">logs_up_to_date: Arc&lt;AtomicU64&gt;,</text>
</g>
<!-- ApplyResult__WaitMergeSource&#45;&gt;ApplyDelegate__wait_merge_state -->
<g id="edge7" class="edge">
<title>ApplyResult__WaitMergeSource&#45;&gt;ApplyDelegate__wait_merge_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M597.26,-178.53C610.23,-175.04 624.4,-171.22 638.77,-167.35"/>
<polygon fill="green" stroke="green" points="640,-170.65 648.74,-164.67 638.17,-163.89 640,-170.65"/>
</g>
<!-- logs_up_to_date -->
<g id="node8" class="node">
<title>logs_up_to_date</title>
<path fill="#feed9b" stroke="#f7e495" d="M927,-149C927,-149 1089,-149 1089,-149 1095,-149 1101,-155 1101,-161 1101,-161 1101,-228 1101,-228 1101,-234 1095,-240 1089,-240 1089,-240 927,-240 927,-240 921,-240 915,-234 915,-228 915,-228 915,-161 915,-161 915,-155 921,-149 927,-149"/>
<text text-anchor="middle" x="1008" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#40575d">logs_up_to_date</text>
<polyline fill="none" stroke="#f7e495" points="915,-217 1101,-217 "/>
<text text-anchor="start" x="923" y="-201.8" font-family="Times,serif" font-size="14.00" fill="#40575d">Arc::new(AtomicU64::new(0))</text>
<text text-anchor="start" x="923" y="-186.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 用于source regoin</text>
<text text-anchor="start" x="923" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 和target region</text>
<text text-anchor="start" x="923" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 同步状态</text>
</g>
<!-- ApplyResult__WaitMergeSource&#45;&gt;logs_up_to_date -->
<g id="edge9" class="edge">
<title>ApplyResult__WaitMergeSource&#45;&gt;logs_up_to_date</title>
<path fill="none" stroke="#666666" d="M597.4,-194.5C674.57,-194.5 810.53,-194.5 904.52,-194.5"/>
<polygon fill="#666666" stroke="#666666" points="904.62,-198 914.62,-194.5 904.62,-191 904.62,-198"/>
</g>
<!-- AdminRequest__get_commit_merge&#45;&gt;SignificantMsg__CatchUpLogs -->
<g id="edge10" class="edge">
<title>AdminRequest__get_commit_merge&#45;&gt;SignificantMsg__CatchUpLogs</title>
<path fill="none" stroke="#666666" d="M601.05,-338.35C609.31,-338.2 618.01,-338.04 626.89,-337.88"/>
<polygon fill="#666666" stroke="#666666" points="627.06,-341.37 636.99,-337.69 626.93,-334.38 627.06,-341.37"/>
</g>
<!-- ApplyDelegate__ready_source_region_id -->
<g id="node7" class="node">
<title>ApplyDelegate__ready_source_region_id</title>
<path fill="none" stroke="#1c2123" d="M944.5,-91.5C944.5,-91.5 1071.5,-91.5 1071.5,-91.5 1077.5,-91.5 1083.5,-97.5 1083.5,-103.5 1083.5,-103.5 1083.5,-117.5 1083.5,-117.5 1083.5,-123.5 1077.5,-129.5 1071.5,-129.5 1071.5,-129.5 944.5,-129.5 944.5,-129.5 938.5,-129.5 932.5,-123.5 932.5,-117.5 932.5,-117.5 932.5,-103.5 932.5,-103.5 932.5,-97.5 938.5,-91.5 944.5,-91.5"/>
<text text-anchor="start" x="940.5" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="940.5" y="-99.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ready_source_region_id</text>
</g>
<!-- ApplyDelegate__wait_merge_state&#45;&gt;ApplyDelegate__ready_source_region_id -->
<g id="edge5" class="edge">
<title>ApplyDelegate__wait_merge_state&#45;&gt;ApplyDelegate__ready_source_region_id</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M867.05,-124.61C885.5,-122.75 904.41,-120.84 922.14,-119.05"/>
<polygon fill="green" stroke="green" points="922.83,-122.5 932.43,-118.02 922.13,-115.54 922.83,-122.5"/>
</g>
<!-- ApplyDelegate__wait_merge_state&#45;&gt;logs_up_to_date -->
<g id="edge8" class="edge">
<title>ApplyDelegate__wait_merge_state&#45;&gt;logs_up_to_date</title>
<path fill="none" stroke="#666666" d="M867.05,-161.21C879.62,-164.2 892.41,-167.24 904.89,-170.21"/>
<polygon fill="#666666" stroke="#666666" points="904.29,-173.66 914.82,-172.57 905.91,-166.85 904.29,-173.66"/>
</g>
<!-- ApplyDelegate__handle_raft_committed_entries -->
<g id="node9" class="node">
<title>ApplyDelegate__handle_raft_committed_entries</title>
<path fill="none" stroke="#1c2123" d="M12,-134C12,-134 179,-134 179,-134 185,-134 191,-140 191,-146 191,-146 191,-183 191,-183 191,-189 185,-195 179,-195 179,-195 12,-195 12,-195 6,-195 0,-189 0,-183 0,-183 0,-146 0,-146 0,-140 6,-134 12,-134"/>
<text text-anchor="start" x="8" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="8" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_committed_entries</text>
<polyline fill="none" stroke="#1c2123" points="0,-157 191,-157 "/>
<text text-anchor="start" x="8" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理comitted log entries</text>
</g>
<!-- ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__exec_commit_merge -->
<g id="edge13" class="edge">
<title>ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__exec_commit_merge</title>
<path fill="none" stroke="#666666" d="M176.87,-195C197.45,-202.82 219.72,-211.27 240.76,-219.25"/>
<polygon fill="#666666" stroke="#666666" points="239.74,-222.61 250.33,-222.88 242.23,-216.06 239.74,-222.61"/>
</g>
<!-- ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyResult__WaitMergeSource -->
<g id="edge11" class="edge">
<title>ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyResult__WaitMergeSource</title>
<path fill="none" stroke="#666666" d="M191.05,-170.95C273.94,-176.61 392.49,-184.7 466.8,-189.78"/>
<polygon fill="#666666" stroke="#666666" points="466.77,-193.28 476.99,-190.47 467.25,-186.3 466.77,-193.28"/>
</g>
<!-- ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__wait_merge_state -->
<g id="edge12" class="edge">
<title>ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__wait_merge_state</title>
<path fill="none" stroke="#666666" d="M191.13,-160.35C309.04,-155.17 510.56,-146.32 638.59,-140.7"/>
<polygon fill="#666666" stroke="#666666" points="638.99,-144.18 648.82,-140.25 638.68,-137.19 638.99,-144.18"/>
</g>
<!-- ApplyDelegate__yield_state -->
<g id="node10" class="node">
<title>ApplyDelegate__yield_state</title>
<path fill="#feed9b" stroke="#f7e495" d="M256,-0.5C256,-0.5 408,-0.5 408,-0.5 414,-0.5 420,-6.5 420,-12.5 420,-12.5 420,-94.5 420,-94.5 420,-100.5 414,-106.5 408,-106.5 408,-106.5 256,-106.5 256,-106.5 250,-106.5 244,-100.5 244,-94.5 244,-94.5 244,-12.5 244,-12.5 244,-6.5 250,-0.5 256,-0.5"/>
<text text-anchor="start" x="252" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyDelegate</text>
<text text-anchor="start" x="252" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> yield_state</text>
<text text-anchor="start" x="252" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_entries,</text>
<polyline fill="none" stroke="#f7e495" points="244,-53.5 420,-53.5 "/>
<text text-anchor="start" x="252" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#40575d">将本次CommitMergeEntry</text>
<text text-anchor="start" x="252" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 放入yield state等待下次再</text>
<text text-anchor="start" x="252" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 执行</text>
</g>
<!-- ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__yield_state -->
<g id="edge14" class="edge">
<title>ApplyDelegate__handle_raft_committed_entries&#45;&gt;ApplyDelegate__yield_state</title>
<path fill="none" stroke="#666666" d="M161.2,-133.87C183.9,-123.13 209.91,-110.82 234.64,-99.11"/>
<polygon fill="#666666" stroke="#666666" points="236.14,-102.27 243.69,-94.83 233.15,-95.94 236.14,-102.27"/>
</g>
</g>
</svg>
