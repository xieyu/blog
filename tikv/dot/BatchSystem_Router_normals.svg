<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: BatchSystem_router_normals Pages: 1 -->
<svg width="1643pt" height="314pt"
 viewBox="0.00 0.00 1643.00 313.90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 309.9)">
<title>BatchSystem_router_normals</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-309.9 1639,-309.9 1639,4 -4,4"/>
<!-- RaftBatchSystem_spawn -->
<g id="node1" class="node">
<title>RaftBatchSystem_spawn</title>
<path fill="none" stroke="#1c2123" d="M12,-89.5C12,-89.5 100,-89.5 100,-89.5 106,-89.5 112,-95.5 112,-101.5 112,-101.5 112,-115.5 112,-115.5 112,-121.5 106,-127.5 100,-127.5 100,-127.5 12,-127.5 12,-127.5 6,-127.5 0,-121.5 0,-115.5 0,-115.5 0,-101.5 0,-101.5 0,-95.5 6,-89.5 12,-89.5"/>
<text text-anchor="start" x="8" y="-112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftBatchSystem</text>
<text text-anchor="middle" x="56" y="-97.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">spawn</text>
</g>
<!-- RaftPollerBuilder_init -->
<g id="node2" class="node">
<title>RaftPollerBuilder_init</title>
<path fill="none" stroke="#1c2123" d="M160,-141.5C160,-141.5 249,-141.5 249,-141.5 255,-141.5 261,-147.5 261,-153.5 261,-153.5 261,-167.5 261,-167.5 261,-173.5 255,-179.5 249,-179.5 249,-179.5 160,-179.5 160,-179.5 154,-179.5 148,-173.5 148,-167.5 148,-167.5 148,-153.5 148,-153.5 148,-147.5 154,-141.5 160,-141.5"/>
<text text-anchor="start" x="156" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftPollerBuilder</text>
<text text-anchor="start" x="156" y="-149.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">init</text>
</g>
<!-- RaftBatchSystem_spawn&#45;&gt;RaftPollerBuilder_init -->
<g id="edge1" class="edge">
<title>RaftBatchSystem_spawn&#45;&gt;RaftPollerBuilder_init</title>
<path fill="none" stroke="#666666" d="M110.72,-127.57C120.27,-130.96 130.31,-134.52 140.1,-138"/>
<polygon fill="#666666" stroke="#666666" points="139.19,-141.39 149.79,-141.43 141.53,-134.79 139.19,-141.39"/>
</g>
<!-- RaftBatchSystem_start_system -->
<g id="node3" class="node">
<title>RaftBatchSystem_start_system</title>
<path fill="none" stroke="#1c2123" d="M944.5,-65.5C944.5,-65.5 1032.5,-65.5 1032.5,-65.5 1038.5,-65.5 1044.5,-71.5 1044.5,-77.5 1044.5,-77.5 1044.5,-91.5 1044.5,-91.5 1044.5,-97.5 1038.5,-103.5 1032.5,-103.5 1032.5,-103.5 944.5,-103.5 944.5,-103.5 938.5,-103.5 932.5,-97.5 932.5,-91.5 932.5,-91.5 932.5,-77.5 932.5,-77.5 932.5,-71.5 938.5,-65.5 944.5,-65.5"/>
<text text-anchor="start" x="940.5" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftBatchSystem</text>
<text text-anchor="middle" x="988.5" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_system</text>
</g>
<!-- RaftBatchSystem_spawn&#45;&gt;RaftBatchSystem_start_system -->
<g id="edge2" class="edge">
<title>RaftBatchSystem_spawn&#45;&gt;RaftBatchSystem_start_system</title>
<path fill="none" stroke="#666666" d="M112.03,-102.19C178.94,-95.08 295.34,-84.5 395.5,-84.5 395.5,-84.5 395.5,-84.5 634.5,-84.5 734.97,-84.5 851.52,-84.5 922.36,-84.5"/>
<polygon fill="#666666" stroke="#666666" points="922.47,-88 932.47,-84.5 922.47,-81 922.47,-88"/>
</g>
<!-- Vec_SenderFsmPair -->
<g id="node4" class="node">
<title>Vec_SenderFsmPair</title>
<path fill="none" stroke="#1c2123" d="M932,-122.5C932,-122.5 1045,-122.5 1045,-122.5 1051,-122.5 1057,-128.5 1057,-134.5 1057,-134.5 1057,-156.5 1057,-156.5 1057,-162.5 1051,-168.5 1045,-168.5 1045,-168.5 932,-168.5 932,-168.5 926,-168.5 920,-162.5 920,-156.5 920,-156.5 920,-134.5 920,-134.5 920,-128.5 926,-122.5 932,-122.5"/>
<text text-anchor="middle" x="988.5" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Vec&lt;SenderFsmPair&gt;</text>
<polyline fill="none" stroke="#1c2123" points="920,-145.5 1057,-145.5 "/>
<text text-anchor="middle" x="988.5" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">tx, PeerFsm</text>
</g>
<!-- RaftPollerBuilder_init&#45;&gt;Vec_SenderFsmPair -->
<g id="edge7" class="edge">
<title>RaftPollerBuilder_init&#45;&gt;Vec_SenderFsmPair</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M220.98,-179.71C237.5,-198.54 265.6,-226.05 297,-237.5 542.09,-326.9 640.14,-330.21 884,-237.5 916.02,-225.33 944.46,-198.2 963.39,-176.54"/>
<polygon fill="green" stroke="green" points="966.12,-178.73 969.92,-168.84 960.78,-174.2 966.12,-178.73"/>
</g>
<!-- kv_engine_scan_cf -->
<g id="node8" class="node">
<title>kv_engine_scan_cf</title>
<path fill="none" stroke="#1c2123" d="M309,-151.5C309,-151.5 484,-151.5 484,-151.5 490,-151.5 496,-157.5 496,-163.5 496,-163.5 496,-215.5 496,-215.5 496,-221.5 490,-227.5 484,-227.5 484,-227.5 309,-227.5 309,-227.5 303,-227.5 297,-221.5 297,-215.5 297,-215.5 297,-163.5 297,-163.5 297,-157.5 303,-151.5 309,-151.5"/>
<text text-anchor="middle" x="396.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv_engine.scan_cf(CF_RAFT,...)</text>
<polyline fill="none" stroke="#1c2123" points="297,-204.5 496,-204.5 "/>
<text text-anchor="start" x="305" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">扫描CF_RAFT，</text>
<text text-anchor="start" x="305" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 加载所有的region</text>
<text text-anchor="start" x="305" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对于每个Region创建PeerFsm</text>
</g>
<!-- RaftPollerBuilder_init&#45;&gt;kv_engine_scan_cf -->
<g id="edge8" class="edge">
<title>RaftPollerBuilder_init&#45;&gt;kv_engine_scan_cf</title>
<path fill="none" stroke="#666666" d="M261.22,-169.01C269.42,-170.26 278.08,-171.58 286.91,-172.93"/>
<polygon fill="#666666" stroke="#666666" points="286.52,-176.41 296.93,-174.46 287.57,-169.49 286.52,-176.41"/>
</g>
<!-- PeerFsm_create -->
<g id="node9" class="node">
<title>PeerFsm_create</title>
<path fill="none" stroke="#1c2123" d="M544,-137C544,-137 723,-137 723,-137 729,-137 735,-143 735,-149 735,-149 735,-186 735,-186 735,-192 729,-198 723,-198 723,-198 544,-198 544,-198 538,-198 532,-192 532,-186 532,-186 532,-149 532,-149 532,-143 538,-137 544,-137"/>
<text text-anchor="middle" x="633.5" y="-182.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm::create</text>
<polyline fill="none" stroke="#1c2123" points="532,-175 735,-175 "/>
<text text-anchor="start" x="540" y="-159.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建PeerFsm, rx保存在PeerFsm</text>
<text text-anchor="start" x="540" y="-144.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> tx返回给调用者</text>
</g>
<!-- RaftPollerBuilder_init&#45;&gt;PeerFsm_create -->
<g id="edge9" class="edge">
<title>RaftPollerBuilder_init&#45;&gt;PeerFsm_create</title>
<path fill="none" stroke="#666666" d="M261.35,-147.01C273.06,-144.72 285.38,-142.69 297,-141.5 384.98,-132.46 407.95,-133.19 496,-141.5 504.37,-142.29 513,-143.35 521.65,-144.58"/>
<polygon fill="#666666" stroke="#666666" points="521.39,-148.08 531.8,-146.11 522.43,-141.16 521.39,-148.08"/>
</g>
<!-- RaftRouter_register_all -->
<g id="node5" class="node">
<title>RaftRouter_register_all</title>
<path fill="none" stroke="#1c2123" d="M1263,-69.5C1263,-69.5 1347,-69.5 1347,-69.5 1353,-69.5 1359,-75.5 1359,-81.5 1359,-81.5 1359,-133.5 1359,-133.5 1359,-139.5 1353,-145.5 1347,-145.5 1347,-145.5 1263,-145.5 1263,-145.5 1257,-145.5 1251,-139.5 1251,-133.5 1251,-133.5 1251,-81.5 1251,-81.5 1251,-75.5 1257,-69.5 1263,-69.5"/>
<text text-anchor="start" x="1259" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftRouter</text>
<polyline fill="none" stroke="#1c2123" points="1251,-122.5 1359,-122.5 "/>
<text text-anchor="start" x="1259" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">register_all</text>
<text text-anchor="start" x="1259" y="-92.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 注册mailbox到</text>
<text text-anchor="start" x="1259" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> normals map</text>
</g>
<!-- RaftBatchSystem_start_system&#45;&gt;RaftRouter_register_all -->
<g id="edge3" class="edge">
<title>RaftBatchSystem_start_system&#45;&gt;RaftRouter_register_all</title>
<path fill="none" stroke="#666666" d="M1044.64,-88.53C1099.4,-92.54 1183.26,-98.67 1240.71,-102.87"/>
<polygon fill="#666666" stroke="#666666" points="1240.53,-106.37 1250.76,-103.61 1241.04,-99.39 1240.53,-106.37"/>
</g>
<!-- BasicMailbox_new -->
<g id="node6" class="node">
<title>BasicMailbox_new</title>
<path fill="none" stroke="#1c2123" d="M1203,-148.5C1203,-148.5 1105,-148.5 1105,-148.5 1099,-148.5 1093,-142.5 1093,-136.5 1093,-136.5 1093,-124.5 1093,-124.5 1093,-118.5 1099,-112.5 1105,-112.5 1105,-112.5 1203,-112.5 1203,-112.5 1209,-112.5 1215,-118.5 1215,-124.5 1215,-124.5 1215,-136.5 1215,-136.5 1215,-142.5 1209,-148.5 1203,-148.5"/>
<text text-anchor="middle" x="1154" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">BasicMailbox_new</text>
</g>
<!-- RaftBatchSystem_start_system&#45;&gt;BasicMailbox_new -->
<g id="edge4" class="edge">
<title>RaftBatchSystem_start_system&#45;&gt;BasicMailbox_new</title>
<path fill="none" stroke="#666666" d="M1044.85,-100.07C1057.18,-103.54 1070.41,-107.26 1083.23,-110.87"/>
<polygon fill="#666666" stroke="#666666" points="1082.36,-114.26 1092.94,-113.6 1084.26,-107.52 1082.36,-114.26"/>
</g>
<!-- Vec_SenderFsmPair&#45;&gt;BasicMailbox_new -->
<g id="edge13" class="edge">
<title>Vec_SenderFsmPair&#45;&gt;BasicMailbox_new</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1057.42,-139.27C1065.78,-138.5 1074.33,-137.72 1082.73,-136.95"/>
<polygon fill="green" stroke="green" points="1083.22,-140.42 1092.86,-136.02 1082.58,-133.45 1083.22,-140.42"/>
</g>
<!-- normals -->
<g id="node7" class="node">
<title>normals</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1407,-0.5C1407,-0.5 1623,-0.5 1623,-0.5 1629,-0.5 1635,-6.5 1635,-12.5 1635,-12.5 1635,-202.5 1635,-202.5 1635,-208.5 1629,-214.5 1623,-214.5 1623,-214.5 1407,-214.5 1407,-214.5 1401,-214.5 1395,-208.5 1395,-202.5 1395,-202.5 1395,-12.5 1395,-12.5 1395,-6.5 1401,-0.5 1407,-0.5"/>
<text text-anchor="middle" x="1515" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftRouter::normals</text>
<polyline fill="none" stroke="#8a8898" points="1395,-191.5 1635,-191.5 "/>
<text text-anchor="middle" x="1424" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">region1</text>
<polyline fill="none" stroke="#8a8898" points="1453,-115.5 1453,-191.5 "/>
<text text-anchor="middle" x="1544" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">BasicMailbox</text>
<polyline fill="none" stroke="#8a8898" points="1453,-168.5 1635,-168.5 "/>
<text text-anchor="start" x="1461" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">FsmState</text>
<text text-anchor="start" x="1461" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">标记Fsm是否已发送到</text>
<text text-anchor="start" x="1461" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> NormalChannel</text>
<polyline fill="none" stroke="#8a8898" points="1608,-115.5 1608,-168.5 "/>
<text text-anchor="middle" x="1621.5" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">tx</text>
<polyline fill="none" stroke="#8a8898" points="1395,-115.5 1635,-115.5 "/>
<text text-anchor="middle" x="1445.5" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">region2</text>
<polyline fill="none" stroke="#8a8898" points="1496,-69.5 1496,-115.5 "/>
<text text-anchor="middle" x="1565.5" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">BasicMailbox</text>
<polyline fill="none" stroke="#8a8898" points="1496,-92.5 1635,-92.5 "/>
<text text-anchor="middle" x="1541" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">FsmState</text>
<polyline fill="none" stroke="#8a8898" points="1586,-69.5 1586,-92.5 "/>
<text text-anchor="middle" x="1610.5" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">tx</text>
<polyline fill="none" stroke="#8a8898" points="1395,-69.5 1635,-69.5 "/>
<text text-anchor="middle" x="1445.5" y="-42.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">region3</text>
<polyline fill="none" stroke="#8a8898" points="1496,-23.5 1496,-69.5 "/>
<text text-anchor="middle" x="1565.5" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">BasicMailbox</text>
<polyline fill="none" stroke="#8a8898" points="1496,-46.5 1635,-46.5 "/>
<text text-anchor="middle" x="1541" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">FsmState</text>
<polyline fill="none" stroke="#8a8898" points="1586,-23.5 1586,-46.5 "/>
<text text-anchor="middle" x="1610.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">tx</text>
<polyline fill="none" stroke="#8a8898" points="1395,-23.5 1635,-23.5 "/>
<text text-anchor="middle" x="1515" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">...</text>
</g>
<!-- RaftRouter_register_all&#45;&gt;normals -->
<g id="edge6" class="edge">
<title>RaftRouter_register_all&#45;&gt;normals</title>
<path fill="none" stroke="#666666" d="M1359.03,-107.5C1367.16,-107.5 1375.84,-107.5 1384.79,-107.5"/>
<polygon fill="#666666" stroke="#666666" points="1385,-111 1395,-107.5 1385,-104 1385,-111"/>
</g>
<!-- BasicMailbox_new&#45;&gt;RaftRouter_register_all -->
<g id="edge5" class="edge">
<title>BasicMailbox_new&#45;&gt;RaftRouter_register_all</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1215.17,-121.21C1223.65,-119.9 1232.38,-118.56 1240.91,-117.24"/>
<polygon fill="green" stroke="green" points="1241.45,-120.7 1250.8,-115.71 1240.38,-113.78 1241.45,-120.7"/>
</g>
<!-- kv_engine_scan_cf&#45;&gt;PeerFsm_create -->
<g id="edge14" class="edge">
<title>kv_engine_scan_cf&#45;&gt;PeerFsm_create</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M496.14,-180.27C504.63,-179.47 513.25,-178.66 521.82,-177.86"/>
<polygon fill="green" stroke="green" points="522.22,-181.34 531.85,-176.92 521.57,-174.37 522.22,-181.34"/>
</g>
<!-- loose_bounded -->
<g id="node10" class="node">
<title>loose_bounded</title>
<path fill="none" stroke="#1c2123" d="M783,-181.5C783,-181.5 872,-181.5 872,-181.5 878,-181.5 884,-187.5 884,-193.5 884,-193.5 884,-215.5 884,-215.5 884,-221.5 878,-227.5 872,-227.5 872,-227.5 783,-227.5 783,-227.5 777,-227.5 771,-221.5 771,-215.5 771,-215.5 771,-193.5 771,-193.5 771,-187.5 777,-181.5 783,-181.5"/>
<text text-anchor="middle" x="827.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">loose_bounded</text>
<polyline fill="none" stroke="#1c2123" points="771,-204.5 884,-204.5 "/>
<text text-anchor="middle" x="827.5" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建通信的tx,rx</text>
</g>
<!-- PeerFsm_create&#45;&gt;loose_bounded -->
<g id="edge10" class="edge">
<title>PeerFsm_create&#45;&gt;loose_bounded</title>
<path fill="none" stroke="#666666" d="M735.28,-186.92C743.9,-188.58 752.48,-190.24 760.72,-191.82"/>
<polygon fill="#666666" stroke="#666666" points="760.11,-195.27 770.59,-193.73 761.43,-188.4 760.11,-195.27"/>
</g>
<!-- tx -->
<g id="node11" class="node">
<title>tx</title>
<path fill="none" stroke="#1c2123" d="M842.5,-162.5C842.5,-162.5 812.5,-162.5 812.5,-162.5 806.5,-162.5 800.5,-156.5 800.5,-150.5 800.5,-150.5 800.5,-138.5 800.5,-138.5 800.5,-132.5 806.5,-126.5 812.5,-126.5 812.5,-126.5 842.5,-126.5 842.5,-126.5 848.5,-126.5 854.5,-132.5 854.5,-138.5 854.5,-138.5 854.5,-150.5 854.5,-150.5 854.5,-156.5 848.5,-162.5 842.5,-162.5"/>
<text text-anchor="middle" x="827.5" y="-140.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">tx</text>
</g>
<!-- PeerFsm_create&#45;&gt;tx -->
<g id="edge11" class="edge">
<title>PeerFsm_create&#45;&gt;tx</title>
<path fill="none" stroke="#666666" d="M735.28,-155.43C754.85,-153.08 774.15,-150.77 789.92,-148.88"/>
<polygon fill="#666666" stroke="#666666" points="790.73,-152.31 800.24,-147.65 789.89,-145.36 790.73,-152.31"/>
</g>
<!-- tx&#45;&gt;Vec_SenderFsmPair -->
<g id="edge12" class="edge">
<title>tx&#45;&gt;Vec_SenderFsmPair</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M854.76,-144.67C869.92,-144.76 889.87,-144.89 909.69,-145.01"/>
<polygon fill="green" stroke="green" points="909.67,-148.51 919.69,-145.07 909.71,-141.51 909.67,-148.51"/>
</g>
</g>
</svg>
