<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: CheckSecondaryLocks Pages: 1 -->
<svg width="641pt" height="888pt"
 viewBox="0.00 0.00 641.00 888.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 884)">
<title>CheckSecondaryLocks</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-884 637,-884 637,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ConcurrencyManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M173,-704C173,-704 340,-704 340,-704 346,-704 352,-710 352,-716 352,-716 352,-860 352,-860 352,-866 346,-872 340,-872 340,-872 173,-872 173,-872 167,-872 161,-866 161,-860 161,-860 161,-716 161,-716 161,-710 167,-704 173,-704"/>
<text text-anchor="middle" x="256.5" y="-852" font-family="Times,serif" font-size="20.00">ConcurrencyManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_MvccReader</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M186,-98C186,-98 544,-98 544,-98 550,-98 556,-104 556,-110 556,-110 556,-222 556,-222 556,-228 550,-234 544,-234 544,-234 186,-234 186,-234 180,-234 174,-228 174,-222 174,-222 174,-110 174,-110 174,-104 180,-98 186,-98"/>
<text text-anchor="middle" x="365" y="-214" font-family="Times,serif" font-size="20.00">MvccReader</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_MvccTxn</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M148,-242C148,-242 613,-242 613,-242 619,-242 625,-248 625,-254 625,-254 625,-486 625,-486 625,-492 619,-498 613,-498 613,-498 148,-498 148,-498 142,-498 136,-492 136,-486 136,-486 136,-254 136,-254 136,-248 142,-242 148,-242"/>
<text text-anchor="middle" x="380.5" y="-478" font-family="Times,serif" font-size="20.00">MvccTxn</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_ReleasedLock</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M203.5,-8C203.5,-8 308.5,-8 308.5,-8 314.5,-8 320.5,-14 320.5,-20 320.5,-20 320.5,-78 320.5,-78 320.5,-84 314.5,-90 308.5,-90 308.5,-90 203.5,-90 203.5,-90 197.5,-90 191.5,-84 191.5,-78 191.5,-78 191.5,-20 191.5,-20 191.5,-14 197.5,-8 203.5,-8"/>
<text text-anchor="middle" x="256" y="-70" font-family="Times,serif" font-size="20.00">ReleasedLock</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_CheckSecondaryLocks</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-506C20,-506 353.5,-506 353.5,-506 359.5,-506 365.5,-512 365.5,-518 365.5,-518 365.5,-684 365.5,-684 365.5,-690 359.5,-696 353.5,-696 353.5,-696 20,-696 20,-696 14,-696 8,-690 8,-684 8,-684 8,-518 8,-518 8,-512 14,-506 20,-506"/>
<text text-anchor="middle" x="186.75" y="-676" font-family="Times,serif" font-size="20.00">CheckSecondaryLocks</text>
</g>
<!-- update_max_ts -->
<g id="node1" class="node">
<title>update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M195,-712.5C195,-712.5 317,-712.5 317,-712.5 323,-712.5 329,-718.5 329,-724.5 329,-724.5 329,-821.5 329,-821.5 329,-827.5 323,-833.5 317,-833.5 317,-833.5 195,-833.5 195,-833.5 189,-833.5 183,-827.5 183,-821.5 183,-821.5 183,-724.5 183,-724.5 183,-718.5 189,-712.5 195,-712.5"/>
<text text-anchor="middle" x="256" y="-818.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_max_ts</text>
<polyline fill="none" stroke="#1c2123" points="183,-810.5 329,-810.5 "/>
<text text-anchor="start" x="191" y="-795.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">It is not allowed for </text>
<text text-anchor="start" x="191" y="-780.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit to overwrite a </text>
<text text-anchor="start" x="191" y="-765.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> protected rollback. So</text>
<text text-anchor="start" x="191" y="-750.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> we update max_ts</text>
<text text-anchor="start" x="191" y="-735.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> to prevent this case</text>
<text text-anchor="middle" x="256" y="-720.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> from happening.</text>
</g>
<!-- load_lock -->
<g id="node2" class="node">
<title>load_lock</title>
<path fill="none" stroke="#1c2123" d="M279,-196C279,-196 233,-196 233,-196 227,-196 221,-190 221,-184 221,-184 221,-172 221,-172 221,-166 227,-160 233,-160 233,-160 279,-160 279,-160 285,-160 291,-166 291,-172 291,-172 291,-184 291,-184 291,-190 285,-196 279,-196"/>
<text text-anchor="middle" x="256" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">load_lock</text>
</g>
<!-- seek_write -->
<g id="node3" class="node">
<title>seek_write</title>
<path fill="none" stroke="#1c2123" d="M536,-196C536,-196 485,-196 485,-196 479,-196 473,-190 473,-184 473,-184 473,-172 473,-172 473,-166 479,-160 485,-160 485,-160 536,-160 536,-160 542,-160 548,-166 548,-172 548,-172 548,-184 548,-184 548,-190 542,-196 536,-196"/>
<text text-anchor="middle" x="510.5" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">seek_write</text>
</g>
<!-- get_txn_commit_record -->
<g id="node4" class="node">
<title>get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M318,-142C318,-142 194,-142 194,-142 188,-142 182,-136 182,-130 182,-130 182,-118 182,-118 182,-112 188,-106 194,-106 194,-106 318,-106 318,-106 324,-106 330,-112 330,-118 330,-118 330,-130 330,-130 330,-136 324,-142 318,-142"/>
<text text-anchor="middle" x="256" y="-120.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_txn_commit_record</text>
</g>
<!-- unlock_key -->
<g id="node5" class="node">
<title>unlock_key</title>
<path fill="none" stroke="#1c2123" d="M284,-458C284,-458 228,-458 228,-458 222,-458 216,-452 216,-446 216,-446 216,-434 216,-434 216,-428 222,-422 228,-422 228,-422 284,-422 284,-422 290,-422 296,-428 296,-434 296,-434 296,-446 296,-446 296,-452 290,-458 284,-458"/>
<text text-anchor="middle" x="256" y="-436.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">unlock_key</text>
</g>
<!-- collapse_prev_rollback -->
<g id="node6" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M315.5,-286C315.5,-286 196.5,-286 196.5,-286 190.5,-286 184.5,-280 184.5,-274 184.5,-274 184.5,-262 184.5,-262 184.5,-256 190.5,-250 196.5,-250 196.5,-250 315.5,-250 315.5,-250 321.5,-250 327.5,-256 327.5,-262 327.5,-262 327.5,-274 327.5,-274 327.5,-280 321.5,-286 315.5,-286"/>
<text text-anchor="middle" x="256" y="-264.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;seek_write -->
<g id="edge1" class="edge">
<title>collapse_prev_rollback&#45;&gt;seek_write</title>
<path fill="none" stroke="#666666" d="M327.61,-250.48C341.12,-246.69 355.07,-242.46 368,-238 400.49,-226.78 436.11,-211.66 463.48,-199.41"/>
<polygon fill="#666666" stroke="#666666" points="465.13,-202.5 472.8,-195.2 462.25,-196.12 465.13,-202.5"/>
</g>
<!-- delete_write -->
<g id="node8" class="node">
<title>delete_write</title>
<path fill="none" stroke="#1c2123" d="M540,-286C540,-286 481,-286 481,-286 475,-286 469,-280 469,-274 469,-274 469,-262 469,-262 469,-256 475,-250 481,-250 481,-250 540,-250 540,-250 546,-250 552,-256 552,-262 552,-262 552,-274 552,-274 552,-280 546,-286 540,-286"/>
<text text-anchor="middle" x="510.5" y="-264.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">delete_write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;delete_write -->
<g id="edge2" class="edge">
<title>collapse_prev_rollback&#45;&gt;delete_write</title>
<path fill="none" stroke="#666666" d="M327.67,-268C369.28,-268 420.95,-268 458.56,-268"/>
<polygon fill="#666666" stroke="#666666" points="458.78,-271.5 468.78,-268 458.78,-264.5 458.78,-271.5"/>
</g>
<!-- put_write -->
<g id="node7" class="node">
<title>put_write</title>
<path fill="none" stroke="#1c2123" d="M532.5,-460C532.5,-460 488.5,-460 488.5,-460 482.5,-460 476.5,-454 476.5,-448 476.5,-448 476.5,-436 476.5,-436 476.5,-430 482.5,-424 488.5,-424 488.5,-424 532.5,-424 532.5,-424 538.5,-424 544.5,-430 544.5,-436 544.5,-436 544.5,-448 544.5,-448 544.5,-454 538.5,-460 532.5,-460"/>
<text text-anchor="middle" x="510.5" y="-438.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">put_write</text>
</g>
<!-- mark_rollback_on_mismatching_lock -->
<g id="node9" class="node">
<title>mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#1c2123" d="M356,-400C356,-400 156,-400 156,-400 150,-400 144,-394 144,-388 144,-388 144,-376 144,-376 144,-370 150,-364 156,-364 156,-364 356,-364 356,-364 362,-364 368,-370 368,-376 368,-376 368,-388 368,-388 368,-394 362,-400 356,-400"/>
<text text-anchor="middle" x="256" y="-378.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">mark_rollback_on_mismatching_lock</text>
</g>
<!-- put_lock -->
<g id="node10" class="node">
<title>put_lock</title>
<path fill="none" stroke="#1c2123" d="M530.5,-340C530.5,-340 490.5,-340 490.5,-340 484.5,-340 478.5,-334 478.5,-328 478.5,-328 478.5,-316 478.5,-316 478.5,-310 484.5,-304 490.5,-304 490.5,-304 530.5,-304 530.5,-304 536.5,-304 542.5,-310 542.5,-316 542.5,-316 542.5,-328 542.5,-328 542.5,-334 536.5,-340 530.5,-340"/>
<text text-anchor="middle" x="510.5" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">put_lock</text>
</g>
<!-- mark_rollback_on_mismatching_lock&#45;&gt;put_lock -->
<g id="edge3" class="edge">
<title>mark_rollback_on_mismatching_lock&#45;&gt;put_lock</title>
<path fill="none" stroke="#666666" d="M332.76,-364C377.24,-353.43 431.73,-340.48 468.35,-331.78"/>
<polygon fill="#666666" stroke="#666666" points="469.26,-335.16 478.18,-329.44 467.65,-328.35 469.26,-335.16"/>
</g>
<!-- Lock -->
<g id="node11" class="node">
<title>Lock</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M416,-359C416,-359 605,-359 605,-359 611,-359 617,-365 617,-371 617,-371 617,-393 617,-393 617,-399 611,-405 605,-405 605,-405 416,-405 416,-405 410,-405 404,-399 404,-393 404,-393 404,-371 404,-371 404,-365 410,-359 416,-359"/>
<text text-anchor="middle" x="510.5" y="-389.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Lock</text>
<polyline fill="none" stroke="#60b5ac" points="404,-382 617,-382 "/>
<text text-anchor="start" x="412" y="-366.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub rollback_ts: Vec&lt;TimeStamp&gt;,</text>
</g>
<!-- mark_rollback_on_mismatching_lock&#45;&gt;Lock -->
<g id="edge4" class="edge">
<title>mark_rollback_on_mismatching_lock&#45;&gt;Lock</title>
<path fill="none" stroke="#666666" d="M368.12,-382C376.68,-382 385.33,-382 393.92,-382"/>
<polygon fill="#666666" stroke="#666666" points="393.96,-385.5 403.96,-382 393.96,-378.5 393.96,-385.5"/>
</g>
<!-- wake_up -->
<g id="node12" class="node">
<title>wake_up</title>
<path fill="none" stroke="#1c2123" d="M276.5,-52C276.5,-52 235.5,-52 235.5,-52 229.5,-52 223.5,-46 223.5,-40 223.5,-40 223.5,-28 223.5,-28 223.5,-22 229.5,-16 235.5,-16 235.5,-16 276.5,-16 276.5,-16 282.5,-16 288.5,-22 288.5,-28 288.5,-28 288.5,-40 288.5,-40 288.5,-46 282.5,-52 276.5,-52"/>
<text text-anchor="middle" x="256" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wake_up</text>
</g>
<!-- process_write -->
<g id="node13" class="node">
<title>process_write</title>
<path fill="none" stroke="#1c2123" d="M96,-550C96,-550 28,-550 28,-550 22,-550 16,-544 16,-538 16,-538 16,-526 16,-526 16,-520 22,-514 28,-514 28,-514 96,-514 96,-514 102,-514 108,-520 108,-526 108,-526 108,-538 108,-538 108,-544 102,-550 96,-550"/>
<text text-anchor="middle" x="62" y="-528.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- process_write&#45;&gt;update_max_ts -->
<g id="edge5" class="edge">
<title>process_write&#45;&gt;update_max_ts</title>
<path fill="none" stroke="#666666" d="M67.02,-550.12C75.14,-583.2 96.17,-654.14 136,-700 146.79,-712.43 160.23,-723.4 174.16,-732.81"/>
<polygon fill="#666666" stroke="#666666" points="172.58,-735.95 182.87,-738.47 176.39,-730.08 172.58,-735.95"/>
</g>
<!-- process_write&#45;&gt;load_lock -->
<g id="edge6" class="edge">
<title>process_write&#45;&gt;load_lock</title>
<path fill="none" stroke="#666666" d="M62.54,-513.89C62.22,-464.15 67.76,-323.5 136,-238 154.94,-214.27 185.73,-199.1 211.25,-189.95"/>
<polygon fill="#666666" stroke="#666666" points="212.39,-193.26 220.74,-186.74 210.14,-186.63 212.39,-193.26"/>
</g>
<!-- process_write&#45;&gt;get_txn_commit_record -->
<g id="edge7" class="edge">
<title>process_write&#45;&gt;get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M63.92,-513.75C67.76,-445.15 84.74,-204.02 136,-151 145.78,-140.89 158.48,-134.21 171.95,-129.85"/>
<polygon fill="#666666" stroke="#666666" points="173.16,-133.15 181.85,-127.08 171.28,-126.41 173.16,-133.15"/>
</g>
<!-- process_write&#45;&gt;unlock_key -->
<g id="edge8" class="edge">
<title>process_write&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M80.63,-513.8C94.52,-500.44 115,-482.81 136,-472 157.77,-460.79 183.87,-453.21 206.07,-448.25"/>
<polygon fill="#666666" stroke="#666666" points="206.9,-451.65 215.96,-446.15 205.45,-444.8 206.9,-451.65"/>
</g>
<!-- process_write&#45;&gt;collapse_prev_rollback -->
<g id="edge9" class="edge">
<title>process_write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M67.02,-513.76C75.24,-479.67 96.6,-405.21 136,-355 156.63,-328.71 187.19,-306.6 212.17,-291.25"/>
<polygon fill="#666666" stroke="#666666" points="213.97,-294.25 220.74,-286.1 210.37,-288.24 213.97,-294.25"/>
</g>
<!-- process_write&#45;&gt;put_write -->
<g id="edge10" class="edge">
<title>process_write&#45;&gt;put_write</title>
<path fill="none" stroke="#666666" d="M107.74,-513.92C116.98,-510.62 126.72,-507.45 136,-505 237.02,-478.31 265,-484.53 368,-467 401.07,-461.37 438.45,-454.76 466.48,-449.75"/>
<polygon fill="#666666" stroke="#666666" points="467.13,-453.18 476.36,-447.98 465.9,-446.29 467.13,-453.18"/>
</g>
<!-- process_write&#45;&gt;mark_rollback_on_mismatching_lock -->
<g id="edge11" class="edge">
<title>process_write&#45;&gt;mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M69.21,-513.63C79.1,-487.25 100.95,-438.97 136,-413 140.18,-409.9 144.64,-407.11 149.3,-404.6"/>
<polygon fill="#666666" stroke="#666666" points="151.03,-407.65 158.46,-400.11 147.94,-401.37 151.03,-407.65"/>
</g>
<!-- process_write&#45;&gt;wake_up -->
<g id="edge12" class="edge">
<title>process_write&#45;&gt;wake_up</title>
<path fill="none" stroke="#666666" d="M63.88,-513.78C67.75,-439.81 85.45,-162.68 136,-94 154.73,-68.55 187.34,-53.18 213.69,-44.38"/>
<polygon fill="#666666" stroke="#666666" points="214.95,-47.65 223.44,-41.32 212.85,-40.97 214.95,-47.65"/>
</g>
<!-- SecondaryLockStatus_Locked -->
<g id="node14" class="node">
<title>SecondaryLockStatus_Locked</title>
<path fill="none" stroke="#1c2123" d="M335,-550C335,-550 177,-550 177,-550 171,-550 165,-544 165,-538 165,-538 165,-526 165,-526 165,-520 171,-514 177,-514 177,-514 335,-514 335,-514 341,-514 347,-520 347,-526 347,-526 347,-538 347,-538 347,-544 341,-550 335,-550"/>
<text text-anchor="middle" x="256" y="-528.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SecondaryLockStatus_Locked</text>
</g>
<!-- process_write&#45;&gt;SecondaryLockStatus_Locked -->
<g id="edge13" class="edge">
<title>process_write&#45;&gt;SecondaryLockStatus_Locked</title>
<path fill="none" stroke="#666666" d="M108.02,-532C122.15,-532 138.36,-532 154.74,-532"/>
<polygon fill="#666666" stroke="#666666" points="154.94,-535.5 164.94,-532 154.94,-528.5 154.94,-535.5"/>
</g>
<!-- SecondaryLockStatus_Committed -->
<g id="node15" class="node">
<title>SecondaryLockStatus_Committed</title>
<path fill="none" stroke="#1c2123" d="M345.5,-604C345.5,-604 166.5,-604 166.5,-604 160.5,-604 154.5,-598 154.5,-592 154.5,-592 154.5,-580 154.5,-580 154.5,-574 160.5,-568 166.5,-568 166.5,-568 345.5,-568 345.5,-568 351.5,-568 357.5,-574 357.5,-580 357.5,-580 357.5,-592 357.5,-592 357.5,-598 351.5,-604 345.5,-604"/>
<text text-anchor="middle" x="256" y="-582.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SecondaryLockStatus_Committed</text>
</g>
<!-- process_write&#45;&gt;SecondaryLockStatus_Committed -->
<g id="edge14" class="edge">
<title>process_write&#45;&gt;SecondaryLockStatus_Committed</title>
<path fill="none" stroke="#666666" d="M108.25,-549.78C117.37,-553.07 126.93,-556.31 136,-559 143.58,-561.25 151.48,-563.42 159.44,-565.48"/>
<polygon fill="#666666" stroke="#666666" points="158.62,-568.88 169.17,-567.94 160.34,-562.1 158.62,-568.88"/>
</g>
<!-- make_rollback -->
<g id="node16" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M293,-658C293,-658 219,-658 219,-658 213,-658 207,-652 207,-646 207,-646 207,-634 207,-634 207,-628 213,-622 219,-622 219,-622 293,-622 293,-622 299,-622 305,-628 305,-634 305,-634 305,-646 305,-646 305,-652 299,-658 293,-658"/>
<text text-anchor="middle" x="256" y="-636.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
</g>
<!-- process_write&#45;&gt;make_rollback -->
<g id="edge15" class="edge">
<title>process_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M74.36,-550.12C87.06,-568.82 109.38,-597.4 136,-613 154.29,-623.72 176.47,-630.19 196.7,-634.09"/>
<polygon fill="#666666" stroke="#666666" points="196.31,-637.57 206.76,-635.85 197.52,-630.68 196.31,-637.57"/>
</g>
<!-- make_rollback&#45;&gt;put_write -->
<g id="edge16" class="edge">
<title>make_rollback&#45;&gt;put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M305.25,-635.11C325.78,-631.36 349.25,-624.73 368,-613 426.42,-576.45 472.28,-507.51 494.61,-469.28"/>
<polygon fill="green" stroke="green" points="497.84,-470.67 499.77,-460.25 491.77,-467.19 497.84,-470.67"/>
</g>
</g>
</svg>
