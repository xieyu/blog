<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1334pt" height="352pt"
 viewBox="0.00 0.00 1334.00 351.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 347.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-347.5 1330,-347.5 1330,4 -4,4"/>
<!-- DML -->
<g id="node1" class="node">
<title>DML</title>
<path fill="none" stroke="#1c2123" d="M13.5,-267C13.5,-267 111.5,-267 111.5,-267 117.5,-267 123.5,-273 123.5,-279 123.5,-279 123.5,-331 123.5,-331 123.5,-337 117.5,-343 111.5,-343 111.5,-343 13.5,-343 13.5,-343 7.5,-343 1.5,-337 1.5,-331 1.5,-331 1.5,-279 1.5,-279 1.5,-273 7.5,-267 13.5,-267"/>
<text text-anchor="start" x="9.5" y="-327.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">DML</text>
<polyline fill="none" stroke="#1c2123" points="1.5,-320 123.5,-320 "/>
<text text-anchor="start" x="9.5" y="-304.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">txn的DML阶段的</text>
<text text-anchor="start" x="9.5" y="-289.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 修改会先写入</text>
<text text-anchor="start" x="9.5" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MemDB中</text>
</g>
<!-- txn__GetMemBuffer -->
<g id="node2" class="node">
<title>txn__GetMemBuffer</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M381.5,-278C381.5,-278 462.5,-278 462.5,-278 468.5,-278 474.5,-284 474.5,-290 474.5,-290 474.5,-304 474.5,-304 474.5,-310 468.5,-316 462.5,-316 462.5,-316 381.5,-316 381.5,-316 375.5,-316 369.5,-310 369.5,-304 369.5,-304 369.5,-290 369.5,-290 369.5,-284 375.5,-278 381.5,-278"/>
<text text-anchor="start" x="377.5" y="-300.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">txn</text>
<text text-anchor="start" x="377.5" y="-285.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> GetMemBuffer</text>
</g>
<!-- DML&#45;&gt;txn__GetMemBuffer -->
<g id="edge1" class="edge">
<title>DML&#45;&gt;txn__GetMemBuffer</title>
<path fill="none" stroke="#666666" d="M123.74,-303.65C189.1,-302.19 292.92,-299.87 358.97,-298.39"/>
<polygon fill="#666666" stroke="#666666" points="359.31,-301.88 369.23,-298.16 359.16,-294.88 359.31,-301.88"/>
</g>
<!-- memBufferMutations -->
<g id="node8" class="node">
<title>memBufferMutations</title>
<path fill="none" stroke="#1c2123" d="M550,-158.5C550,-158.5 749,-158.5 749,-158.5 755,-158.5 761,-164.5 761,-170.5 761,-170.5 761,-215.5 761,-215.5 761,-221.5 755,-227.5 749,-227.5 749,-227.5 550,-227.5 550,-227.5 544,-227.5 538,-221.5 538,-215.5 538,-215.5 538,-170.5 538,-170.5 538,-164.5 544,-158.5 550,-158.5"/>
<text text-anchor="start" x="546" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">memBufferMutations</text>
<polyline fill="none" stroke="#1c2123" points="538,-204.5 761,-204.5 "/>
<text text-anchor="start" x="546" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">storage *unionstore.MemDB</text>
<polyline fill="none" stroke="#1c2123" points="538,-181.5 761,-181.5 "/>
<text text-anchor="start" x="546" y="-166.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handles []unionstore.MemKeyHandle</text>
</g>
<!-- txn__GetMemBuffer&#45;&gt;memBufferMutations -->
<g id="edge8" class="edge">
<title>txn__GetMemBuffer&#45;&gt;memBufferMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M474.82,-279.79C483.96,-276.43 493.32,-272.77 502,-269 527.05,-258.12 553.76,-244.81 577.42,-232.38"/>
<polygon fill="green" stroke="green" points="579.12,-235.44 586.32,-227.67 575.85,-229.25 579.12,-235.44"/>
</g>
<!-- KVTxn__Commit -->
<g id="node3" class="node">
<title>KVTxn__Commit</title>
<path fill="none" stroke="#1c2123" d="M12,-136.5C12,-136.5 113,-136.5 113,-136.5 119,-136.5 125,-142.5 125,-148.5 125,-148.5 125,-185.5 125,-185.5 125,-191.5 119,-197.5 113,-197.5 113,-197.5 12,-197.5 12,-197.5 6,-197.5 0,-191.5 0,-185.5 0,-185.5 0,-148.5 0,-148.5 0,-142.5 6,-136.5 12,-136.5"/>
<text text-anchor="start" x="8" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">KVTxn</text>
<text text-anchor="start" x="8" y="-167.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Commit</text>
<polyline fill="none" stroke="#1c2123" points="0,-159.5 125,-159.5 "/>
<text text-anchor="start" x="8" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">提交txn的MemDB</text>
</g>
<!-- twoPhaseCommitter__initKeysAndMutations -->
<g id="node4" class="node">
<title>twoPhaseCommitter__initKeysAndMutations</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M173,-185.5C173,-185.5 294,-185.5 294,-185.5 300,-185.5 306,-191.5 306,-197.5 306,-197.5 306,-264.5 306,-264.5 306,-270.5 300,-276.5 294,-276.5 294,-276.5 173,-276.5 173,-276.5 167,-276.5 161,-270.5 161,-264.5 161,-264.5 161,-197.5 161,-197.5 161,-191.5 167,-185.5 173,-185.5"/>
<text text-anchor="start" x="169" y="-261.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">twoPhaseCommitter</text>
<text text-anchor="start" x="169" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> initKeysAndMutations</text>
<polyline fill="none" stroke="#8a8898" points="161,-238.5 306,-238.5 "/>
<text text-anchor="start" x="169" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">使用txn的MemDB</text>
<text text-anchor="start" x="169" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 初始化要2pc提交的</text>
<text text-anchor="start" x="169" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> mutations</text>
</g>
<!-- KVTxn__Commit&#45;&gt;twoPhaseCommitter__initKeysAndMutations -->
<g id="edge2" class="edge">
<title>KVTxn__Commit&#45;&gt;twoPhaseCommitter__initKeysAndMutations</title>
<path fill="none" stroke="#666666" d="M125.47,-190.47C133.91,-193.66 142.67,-196.98 151.39,-200.28"/>
<polygon fill="#666666" stroke="#666666" points="150.22,-203.58 160.81,-203.85 152.7,-197.04 150.22,-203.58"/>
</g>
<!-- twoPhaseCommitter__execute -->
<g id="node5" class="node">
<title>twoPhaseCommitter__execute</title>
<path fill="none" stroke="#1c2123" d="M173,-67.5C173,-67.5 294,-67.5 294,-67.5 300,-67.5 306,-73.5 306,-79.5 306,-79.5 306,-154.5 306,-154.5 306,-160.5 300,-166.5 294,-166.5 294,-166.5 173,-166.5 173,-166.5 167,-166.5 161,-160.5 161,-154.5 161,-154.5 161,-79.5 161,-79.5 161,-73.5 167,-67.5 173,-67.5"/>
<text text-anchor="start" x="169" y="-151.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">twoPhaseCommitter</text>
<text text-anchor="start" x="169" y="-136.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> execute</text>
<polyline fill="none" stroke="#1c2123" points="161,-128.5 306,-128.5 "/>
<text text-anchor="start" x="169" y="-113.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">开始执行两阶段提交</text>
<polyline fill="none" stroke="#1c2123" points="161,-105.5 306,-105.5 "/>
<text text-anchor="start" x="169" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">先Prewrite</text>
<text text-anchor="start" x="169" y="-75.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后Commit</text>
</g>
<!-- KVTxn__Commit&#45;&gt;twoPhaseCommitter__execute -->
<g id="edge3" class="edge">
<title>KVTxn__Commit&#45;&gt;twoPhaseCommitter__execute</title>
<path fill="none" stroke="#666666" d="M125.47,-148.67C133.82,-146.2 142.49,-143.63 151.11,-141.08"/>
<polygon fill="#666666" stroke="#666666" points="152.21,-144.4 160.81,-138.21 150.23,-137.69 152.21,-144.4"/>
</g>
<!-- twoPhaseCommitter__initKeysAndMutations&#45;&gt;txn__GetMemBuffer -->
<g id="edge4" class="edge">
<title>twoPhaseCommitter__initKeysAndMutations&#45;&gt;txn__GetMemBuffer</title>
<path fill="none" stroke="#666666" d="M306.07,-256.33C323.68,-262.56 342.37,-269.17 359.45,-275.22"/>
<polygon fill="#666666" stroke="#666666" points="358.71,-278.67 369.3,-278.71 361.05,-272.07 358.71,-278.67"/>
</g>
<!-- newMemBufferMutations -->
<g id="node6" class="node">
<title>newMemBufferMutations</title>
<path fill="none" stroke="#1c2123" d="M490,-202C490,-202 354,-202 354,-202 348,-202 342,-196 342,-190 342,-190 342,-178 342,-178 342,-172 348,-166 354,-166 354,-166 490,-166 490,-166 496,-166 502,-172 502,-178 502,-178 502,-190 502,-190 502,-196 496,-202 490,-202"/>
<text text-anchor="middle" x="422" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">newMemBufferMutations</text>
</g>
<!-- twoPhaseCommitter__initKeysAndMutations&#45;&gt;newMemBufferMutations -->
<g id="edge5" class="edge">
<title>twoPhaseCommitter__initKeysAndMutations&#45;&gt;newMemBufferMutations</title>
<path fill="none" stroke="#666666" d="M306.07,-212.96C317.04,-210.2 328.42,-207.33 339.58,-204.52"/>
<polygon fill="#666666" stroke="#666666" points="340.47,-207.9 349.31,-202.07 338.76,-201.12 340.47,-207.9"/>
</g>
<!-- txn__IsPessimistic -->
<g id="node7" class="node">
<title>txn__IsPessimistic</title>
<path fill="none" stroke="#1c2123" d="M388,-221C388,-221 456,-221 456,-221 462,-221 468,-227 468,-233 468,-233 468,-247 468,-247 468,-253 462,-259 456,-259 456,-259 388,-259 388,-259 382,-259 376,-253 376,-247 376,-247 376,-233 376,-233 376,-227 382,-221 388,-221"/>
<text text-anchor="start" x="384" y="-243.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">txn</text>
<text text-anchor="start" x="384" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> IsPessimistic</text>
</g>
<!-- twoPhaseCommitter__initKeysAndMutations&#45;&gt;txn__IsPessimistic -->
<g id="edge6" class="edge">
<title>twoPhaseCommitter__initKeysAndMutations&#45;&gt;txn__IsPessimistic</title>
<path fill="none" stroke="#666666" d="M306.07,-234.45C325.83,-235.41 346.97,-236.43 365.66,-237.33"/>
<polygon fill="#666666" stroke="#666666" points="365.61,-240.83 375.76,-237.82 365.94,-233.84 365.61,-240.83"/>
</g>
<!-- twoPhaseCommitter__prewriteMutations -->
<g id="node10" class="node">
<title>twoPhaseCommitter__prewriteMutations</title>
<path fill="#feed9b" stroke="#f7e495" d="M987,-80.5C987,-80.5 1091,-80.5 1091,-80.5 1097,-80.5 1103,-86.5 1103,-92.5 1103,-92.5 1103,-129.5 1103,-129.5 1103,-135.5 1097,-141.5 1091,-141.5 1091,-141.5 987,-141.5 987,-141.5 981,-141.5 975,-135.5 975,-129.5 975,-129.5 975,-92.5 975,-92.5 975,-86.5 981,-80.5 987,-80.5"/>
<text text-anchor="start" x="983" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#40575d">twoPhaseCommitter</text>
<text text-anchor="start" x="983" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> prewriteMutations</text>
<polyline fill="none" stroke="#f7e495" points="975,-103.5 1103,-103.5 "/>
<text text-anchor="start" x="983" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#40575d">prewrite阶段</text>
</g>
<!-- twoPhaseCommitter__execute&#45;&gt;twoPhaseCommitter__prewriteMutations -->
<g id="edge10" class="edge">
<title>twoPhaseCommitter__execute&#45;&gt;twoPhaseCommitter__prewriteMutations</title>
<path fill="none" stroke="#666666" d="M306.16,-116.46C458.06,-115.33 811.05,-112.69 964.53,-111.55"/>
<polygon fill="#666666" stroke="#666666" points="964.82,-115.05 974.79,-111.47 964.77,-108.05 964.82,-115.05"/>
</g>
<!-- twoPhaseCommitter__commitTxn -->
<g id="node11" class="node">
<title>twoPhaseCommitter__commitTxn</title>
<path fill="none" stroke="#1c2123" d="M597.5,-28C597.5,-28 701.5,-28 701.5,-28 707.5,-28 713.5,-34 713.5,-40 713.5,-40 713.5,-54 713.5,-54 713.5,-60 707.5,-66 701.5,-66 701.5,-66 597.5,-66 597.5,-66 591.5,-66 585.5,-60 585.5,-54 585.5,-54 585.5,-40 585.5,-40 585.5,-34 591.5,-28 597.5,-28"/>
<text text-anchor="start" x="593.5" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">twoPhaseCommitter</text>
<text text-anchor="start" x="593.5" y="-35.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commitTxn</text>
</g>
<!-- twoPhaseCommitter__execute&#45;&gt;twoPhaseCommitter__commitTxn -->
<g id="edge11" class="edge">
<title>twoPhaseCommitter__execute&#45;&gt;twoPhaseCommitter__commitTxn</title>
<path fill="none" stroke="#666666" d="M306.14,-104.89C381.45,-92.15 499.31,-72.23 575.23,-59.39"/>
<polygon fill="#666666" stroke="#666666" points="575.91,-62.82 585.19,-57.7 574.75,-55.92 575.91,-62.82"/>
</g>
<!-- newMemBufferMutations&#45;&gt;memBufferMutations -->
<g id="edge7" class="edge">
<title>newMemBufferMutations&#45;&gt;memBufferMutations</title>
<path fill="none" stroke="#666666" d="M502.19,-187.16C510.49,-187.49 519.05,-187.83 527.68,-188.18"/>
<polygon fill="#666666" stroke="#666666" points="527.7,-191.68 537.83,-188.58 527.98,-184.69 527.7,-191.68"/>
</g>
<!-- twoPhaseCommitter__mutations -->
<g id="node9" class="node">
<title>twoPhaseCommitter__mutations</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M809,-40.5C809,-40.5 927,-40.5 927,-40.5 933,-40.5 939,-46.5 939,-52.5 939,-52.5 939,-89.5 939,-89.5 939,-95.5 933,-101.5 927,-101.5 927,-101.5 809,-101.5 809,-101.5 803,-101.5 797,-95.5 797,-89.5 797,-89.5 797,-52.5 797,-52.5 797,-46.5 803,-40.5 809,-40.5"/>
<text text-anchor="start" x="805" y="-86.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">twoPhaseCommitter</text>
<text text-anchor="start" x="805" y="-71.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> mutations</text>
<polyline fill="none" stroke="#8a8898" points="797,-63.5 939,-63.5 "/>
<text text-anchor="start" x="805" y="-48.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">需要提交的mutations</text>
</g>
<!-- memBufferMutations&#45;&gt;twoPhaseCommitter__mutations -->
<g id="edge9" class="edge">
<title>memBufferMutations&#45;&gt;twoPhaseCommitter__mutations</title>
<path fill="none" stroke="#666666" d="M711.96,-158.37C740.74,-142.15 774.98,-122.86 803.95,-106.53"/>
<polygon fill="#666666" stroke="#666666" points="805.77,-109.52 812.76,-101.56 802.33,-103.42 805.77,-109.52"/>
</g>
<!-- twoPhaseCommitter__mutations&#45;&gt;twoPhaseCommitter__prewriteMutations -->
<g id="edge13" class="edge">
<title>twoPhaseCommitter__mutations&#45;&gt;twoPhaseCommitter__prewriteMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M939.2,-87.62C947.68,-89.62 956.35,-91.67 964.86,-93.69"/>
<polygon fill="green" stroke="green" points="964.23,-97.14 974.76,-96.03 965.84,-90.32 964.23,-97.14"/>
</g>
<!-- twoPhaseCommitter__commitMutations -->
<g id="node12" class="node">
<title>twoPhaseCommitter__commitMutations</title>
<path fill="#bcffb9" stroke="#8a8898" d="M987,-0.5C987,-0.5 1091,-0.5 1091,-0.5 1097,-0.5 1103,-6.5 1103,-12.5 1103,-12.5 1103,-49.5 1103,-49.5 1103,-55.5 1097,-61.5 1091,-61.5 1091,-61.5 987,-61.5 987,-61.5 981,-61.5 975,-55.5 975,-49.5 975,-49.5 975,-12.5 975,-12.5 975,-6.5 981,-0.5 987,-0.5"/>
<text text-anchor="start" x="983" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">twoPhaseCommitter</text>
<text text-anchor="start" x="983" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> commitMutations</text>
<polyline fill="none" stroke="#8a8898" points="975,-23.5 1103,-23.5 "/>
<text text-anchor="start" x="983" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit阶段</text>
</g>
<!-- twoPhaseCommitter__mutations&#45;&gt;twoPhaseCommitter__commitMutations -->
<g id="edge14" class="edge">
<title>twoPhaseCommitter__mutations&#45;&gt;twoPhaseCommitter__commitMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M939.2,-54.38C947.68,-52.38 956.35,-50.33 964.86,-48.31"/>
<polygon fill="green" stroke="green" points="965.84,-51.68 974.76,-45.97 964.23,-44.86 965.84,-51.68"/>
</g>
<!-- doActionOnMutations -->
<g id="node13" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M1151,-40.5C1151,-40.5 1314,-40.5 1314,-40.5 1320,-40.5 1326,-46.5 1326,-52.5 1326,-52.5 1326,-89.5 1326,-89.5 1326,-95.5 1320,-101.5 1314,-101.5 1314,-101.5 1151,-101.5 1151,-101.5 1145,-101.5 1139,-95.5 1139,-89.5 1139,-89.5 1139,-52.5 1139,-52.5 1139,-46.5 1145,-40.5 1151,-40.5"/>
<text text-anchor="start" x="1147" y="-86.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="1139,-78.5 1326,-78.5 "/>
<text text-anchor="start" x="1147" y="-63.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">groups keys into primary batch</text>
<text text-anchor="start" x="1147" y="-48.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> and secondary batch</text>
</g>
<!-- twoPhaseCommitter__prewriteMutations&#45;&gt;doActionOnMutations -->
<g id="edge15" class="edge">
<title>twoPhaseCommitter__prewriteMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M1103.23,-97.79C1111.55,-96.06 1120.23,-94.24 1128.99,-92.41"/>
<polygon fill="#666666" stroke="#666666" points="1129.82,-95.81 1138.89,-90.34 1128.39,-88.96 1129.82,-95.81"/>
</g>
<!-- twoPhaseCommitter__commitTxn&#45;&gt;twoPhaseCommitter__commitMutations -->
<g id="edge12" class="edge">
<title>twoPhaseCommitter__commitTxn&#45;&gt;twoPhaseCommitter__commitMutations</title>
<path fill="none" stroke="#666666" d="M713.83,-38.56C739.59,-35.53 769.66,-32.49 797,-31 853.15,-27.94 916.76,-28.1 964.53,-28.93"/>
<polygon fill="#666666" stroke="#666666" points="964.71,-32.43 974.77,-29.12 964.84,-25.44 964.71,-32.43"/>
</g>
<!-- twoPhaseCommitter__commitMutations&#45;&gt;doActionOnMutations -->
<g id="edge16" class="edge">
<title>twoPhaseCommitter__commitMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M1103.23,-44.21C1111.55,-45.94 1120.23,-47.76 1128.99,-49.59"/>
<polygon fill="#666666" stroke="#666666" points="1128.39,-53.04 1138.89,-51.66 1129.82,-46.19 1128.39,-53.04"/>
</g>
</g>
</svg>
