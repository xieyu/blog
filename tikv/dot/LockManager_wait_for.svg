<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: wait_for Pages: 1 -->
<svg width="1857pt" height="1188pt"
 viewBox="0.00 0.00 1857.00 1188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1184)">
<title>wait_for</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1184 1853,-1184 1853,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_WaitTable</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1040,-602C1040,-602 1256,-602 1256,-602 1262,-602 1268,-608 1268,-614 1268,-614 1268,-837 1268,-837 1268,-843 1262,-849 1256,-849 1256,-849 1040,-849 1040,-849 1034,-849 1028,-843 1028,-837 1028,-837 1028,-614 1028,-614 1028,-608 1034,-602 1040,-602"/>
<text text-anchor="middle" x="1148" y="-829" font-family="Times,serif" font-size="20.00">WaitTable</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Waiter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M591,-876C591,-876 1543,-876 1543,-876 1549,-876 1555,-882 1555,-888 1555,-888 1555,-1160 1555,-1160 1555,-1166 1549,-1172 1543,-1172 1543,-1172 591,-1172 591,-1172 585,-1172 579,-1166 579,-1160 579,-1160 579,-888 579,-888 579,-882 585,-876 591,-876"/>
<text text-anchor="middle" x="1067" y="-1152" font-family="Times,serif" font-size="20.00">Waiter</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_WaiterManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M469.5,-614C469.5,-614 964,-614 964,-614 970,-614 976,-620 976,-626 976,-626 976,-856 976,-856 976,-862 970,-868 964,-868 964,-868 469.5,-868 469.5,-868 463.5,-868 457.5,-862 457.5,-856 457.5,-856 457.5,-626 457.5,-626 457.5,-620 463.5,-614 469.5,-614"/>
<text text-anchor="middle" x="716.75" y="-848" font-family="Times,serif" font-size="20.00">WaiterManager</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_FutureSchduler</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1587,-475C1587,-475 1829,-475 1829,-475 1835,-475 1841,-481 1841,-487 1841,-487 1841,-545 1841,-545 1841,-551 1835,-557 1829,-557 1829,-557 1587,-557 1587,-557 1581,-557 1575,-551 1575,-545 1575,-545 1575,-487 1575,-487 1575,-481 1581,-475 1587,-475"/>
<text text-anchor="middle" x="1708" y="-537" font-family="Times,serif" font-size="20.00">FutureSchduler</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_Scheduler</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M299.5,-418C299.5,-418 1487,-418 1487,-418 1493,-418 1499,-424 1499,-430 1499,-430 1499,-564 1499,-564 1499,-570 1493,-576 1487,-576 1487,-576 299.5,-576 299.5,-576 293.5,-576 287.5,-570 287.5,-564 287.5,-564 287.5,-430 287.5,-430 287.5,-424 293.5,-418 299.5,-418"/>
<text text-anchor="middle" x="893.25" y="-556" font-family="Times,serif" font-size="20.00">Scheduler</text>
</g>
<g id="clust15" class="cluster">
<title>cluster_LockManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M85,-140C85,-140 405,-140 405,-140 411,-140 417,-146 417,-152 417,-152 417,-398 417,-398 417,-404 411,-410 405,-410 405,-410 85,-410 85,-410 79,-410 73,-404 73,-398 73,-398 73,-152 73,-152 73,-146 79,-140 85,-140"/>
<text text-anchor="middle" x="245" y="-390" font-family="Times,serif" font-size="20.00">LockManager</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_ReleasedLock</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-8C20,-8 204,-8 204,-8 210,-8 216,-14 216,-20 216,-20 216,-120 216,-120 216,-126 210,-132 204,-132 204,-132 20,-132 20,-132 14,-132 8,-126 8,-120 8,-120 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="112" y="-112" font-family="Times,serif" font-size="20.00">ReleasedLock</text>
</g>
<!-- wait_table -->
<g id="node1" class="node">
<title>wait_table</title>
<path fill="#feed9b" stroke="#f7e495" d="M1048,-610.5C1048,-610.5 1248,-610.5 1248,-610.5 1254,-610.5 1260,-616.5 1260,-622.5 1260,-622.5 1260,-667.5 1260,-667.5 1260,-673.5 1254,-679.5 1248,-679.5 1248,-679.5 1048,-679.5 1048,-679.5 1042,-679.5 1036,-673.5 1036,-667.5 1036,-667.5 1036,-622.5 1036,-622.5 1036,-616.5 1042,-610.5 1048,-610.5"/>
<text text-anchor="middle" x="1148" y="-664.3" font-family="Times,serif" font-size="14.00" fill="#40575d">wait_table</text>
<polyline fill="none" stroke="#f7e495" points="1036,-656.5 1260,-656.5 "/>
<text text-anchor="start" x="1044" y="-641.3" font-family="Times,serif" font-size="14.00" fill="#40575d">wait_table: HashMap&lt;u64, Waiters&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="1036,-633.5 1260,-633.5 "/>
<text text-anchor="start" x="1044" y="-618.3" font-family="Times,serif" font-size="14.00" fill="#40575d">waiter_count: Arc&lt;AtomicUsize&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="1036,-610.5 1260,-610.5 "/>
</g>
<!-- remove_oldest_waiter -->
<g id="node2" class="node">
<title>remove_oldest_waiter</title>
<path fill="none" stroke="#1c2123" d="M1091.5,-699C1091.5,-699 1204.5,-699 1204.5,-699 1210.5,-699 1216.5,-705 1216.5,-711 1216.5,-711 1216.5,-733 1216.5,-733 1216.5,-739 1210.5,-745 1204.5,-745 1204.5,-745 1091.5,-745 1091.5,-745 1085.5,-745 1079.5,-739 1079.5,-733 1079.5,-733 1079.5,-711 1079.5,-711 1079.5,-705 1085.5,-699 1091.5,-699"/>
<text text-anchor="middle" x="1148" y="-729.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">remove_oldest_waiter</text>
<polyline fill="none" stroke="#1c2123" points="1079.5,-722 1216.5,-722 "/>
<text text-anchor="start" x="1087.5" y="-706.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">取出队首的waiter</text>
</g>
<!-- remove_waiter -->
<g id="node3" class="node">
<title>remove_waiter</title>
<path fill="none" stroke="#1c2123" d="M1085,-764C1085,-764 1211,-764 1211,-764 1217,-764 1223,-770 1223,-776 1223,-776 1223,-798 1223,-798 1223,-804 1217,-810 1211,-810 1211,-810 1085,-810 1085,-810 1079,-810 1073,-804 1073,-798 1073,-798 1073,-776 1073,-776 1073,-770 1079,-764 1085,-764"/>
<text text-anchor="middle" x="1148" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">remove_waiter</text>
<polyline fill="none" stroke="#1c2123" points="1073,-787 1223,-787 "/>
<text text-anchor="middle" x="1148" y="-771.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">删掉等待超时的waiter</text>
</g>
<!-- on_timeout -->
<g id="node4" class="node">
<title>on_timeout</title>
<path fill="none" stroke="#1c2123" d="M793.5,-962C793.5,-962 891.5,-962 891.5,-962 897.5,-962 903.5,-968 903.5,-974 903.5,-974 903.5,-996 903.5,-996 903.5,-1002 897.5,-1008 891.5,-1008 891.5,-1008 793.5,-1008 793.5,-1008 787.5,-1008 781.5,-1002 781.5,-996 781.5,-996 781.5,-974 781.5,-974 781.5,-968 787.5,-962 793.5,-962"/>
<text text-anchor="middle" x="842.5" y="-992.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_timeout</text>
<polyline fill="none" stroke="#1c2123" points="781.5,-985 903.5,-985 "/>
<text text-anchor="start" x="789.5" y="-969.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">waiter等待超时了</text>
</g>
<!-- on_timeout&#45;&gt;remove_waiter -->
<g id="edge3" class="edge">
<title>on_timeout&#45;&gt;remove_waiter</title>
<path fill="none" stroke="#666666" d="M874.68,-961.97C906.66,-938.6 958.1,-901.74 1004,-872 1034.51,-852.23 1069.59,-831.35 1097.37,-815.24"/>
<polygon fill="#666666" stroke="#666666" points="1099.21,-818.21 1106.12,-810.18 1095.71,-812.15 1099.21,-818.21"/>
</g>
<!-- notify -->
<g id="node8" class="node">
<title>notify</title>
<path fill="none" stroke="#1c2123" d="M1163,-1134C1163,-1134 1133,-1134 1133,-1134 1127,-1134 1121,-1128 1121,-1122 1121,-1122 1121,-1110 1121,-1110 1121,-1104 1127,-1098 1133,-1098 1133,-1098 1163,-1098 1163,-1098 1169,-1098 1175,-1104 1175,-1110 1175,-1110 1175,-1122 1175,-1122 1175,-1128 1169,-1134 1163,-1134"/>
<text text-anchor="middle" x="1148" y="-1112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify</text>
</g>
<!-- on_timeout&#45;&gt;notify -->
<g id="edge4" class="edge">
<title>on_timeout&#45;&gt;notify</title>
<path fill="none" stroke="#666666" d="M871.48,-1008.02C902.11,-1032 953.6,-1068.82 1004,-1089 1038.68,-1102.88 1081,-1109.74 1110.56,-1113.05"/>
<polygon fill="#666666" stroke="#666666" points="1110.53,-1116.56 1120.84,-1114.11 1111.26,-1109.6 1110.53,-1116.56"/>
</g>
<!-- clean_up_wait_for -->
<g id="node11" class="node">
<title>clean_up_wait_for</title>
<path fill="none" stroke="#1c2123" d="M1195,-1080C1195,-1080 1101,-1080 1101,-1080 1095,-1080 1089,-1074 1089,-1068 1089,-1068 1089,-1056 1089,-1056 1089,-1050 1095,-1044 1101,-1044 1101,-1044 1195,-1044 1195,-1044 1201,-1044 1207,-1050 1207,-1056 1207,-1056 1207,-1068 1207,-1068 1207,-1074 1201,-1080 1195,-1080"/>
<text text-anchor="middle" x="1148" y="-1058.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">clean_up_wait_for</text>
</g>
<!-- on_timeout&#45;&gt;clean_up_wait_for -->
<g id="edge5" class="edge">
<title>on_timeout&#45;&gt;clean_up_wait_for</title>
<path fill="none" stroke="#666666" d="M903.62,-1005.54C933.56,-1015.3 970.44,-1026.63 1004,-1035 1028.24,-1041.04 1055.09,-1046.45 1078.91,-1050.8"/>
<polygon fill="#666666" stroke="#666666" points="1078.46,-1054.28 1088.92,-1052.6 1079.7,-1047.39 1078.46,-1054.28"/>
</g>
<!-- reset_timeout -->
<g id="node5" class="node">
<title>reset_timeout</title>
<path fill="none" stroke="#1c2123" d="M1016,-884.5C1016,-884.5 1280,-884.5 1280,-884.5 1286,-884.5 1292,-890.5 1292,-896.5 1292,-896.5 1292,-933.5 1292,-933.5 1292,-939.5 1286,-945.5 1280,-945.5 1280,-945.5 1016,-945.5 1016,-945.5 1010,-945.5 1004,-939.5 1004,-933.5 1004,-933.5 1004,-896.5 1004,-896.5 1004,-890.5 1010,-884.5 1016,-884.5"/>
<text text-anchor="middle" x="1148" y="-930.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset_timeout</text>
<polyline fill="none" stroke="#1c2123" points="1004,-922.5 1292,-922.5 "/>
<text text-anchor="start" x="1012" y="-907.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">重置队列中的其他waiter timeout时间</text>
<text text-anchor="middle" x="1148" y="-892.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 过了timeout再通知这些waiter WriteConflict了</text>
</g>
<!-- Waiter_new -->
<g id="node6" class="node">
<title>Waiter_new</title>
<path fill="none" stroke="#1c2123" d="M658,-920C658,-920 599,-920 599,-920 593,-920 587,-914 587,-908 587,-908 587,-896 587,-896 587,-890 593,-884 599,-884 599,-884 658,-884 658,-884 664,-884 670,-890 670,-896 670,-896 670,-908 670,-908 670,-914 664,-920 658,-920"/>
<text text-anchor="middle" x="628.5" y="-898.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Waiter_new</text>
</g>
<!-- conflict_with -->
<g id="node7" class="node">
<title>conflict_with</title>
<path fill="none" stroke="#1c2123" d="M1081,-964.5C1081,-964.5 1215,-964.5 1215,-964.5 1221,-964.5 1227,-970.5 1227,-976.5 1227,-976.5 1227,-1013.5 1227,-1013.5 1227,-1019.5 1221,-1025.5 1215,-1025.5 1215,-1025.5 1081,-1025.5 1081,-1025.5 1075,-1025.5 1069,-1019.5 1069,-1013.5 1069,-1013.5 1069,-976.5 1069,-976.5 1069,-970.5 1075,-964.5 1081,-964.5"/>
<text text-anchor="middle" x="1148" y="-1010.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">conflict_with</text>
<polyline fill="none" stroke="#1c2123" points="1069,-1002.5 1227,-1002.5 "/>
<text text-anchor="start" x="1077" y="-987.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Change the ProcessResult</text>
<text text-anchor="start" x="1077" y="-972.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> to WriteConflict</text>
</g>
<!-- tctx_cb_execute -->
<g id="node9" class="node">
<title>tctx_cb_execute</title>
<path fill="none" stroke="#1c2123" d="M1340,-974C1340,-974 1535,-974 1535,-974 1541,-974 1547,-980 1547,-986 1547,-986 1547,-1038 1547,-1038 1547,-1044 1541,-1050 1535,-1050 1535,-1050 1340,-1050 1340,-1050 1334,-1050 1328,-1044 1328,-1038 1328,-1038 1328,-986 1328,-986 1328,-980 1334,-974 1340,-974"/>
<text text-anchor="middle" x="1437.5" y="-1034.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">tctx_cb_execute</text>
<polyline fill="none" stroke="#1c2123" points="1328,-1027 1547,-1027 "/>
<text text-anchor="start" x="1336" y="-1011.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">向客户端返回WriteConflict错误？</text>
<text text-anchor="start" x="1336" y="-996.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 这时候Lock已经释放了</text>
<text text-anchor="start" x="1336" y="-981.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 客户端可以重试了么</text>
</g>
<!-- conflict_with&#45;&gt;tctx_cb_execute -->
<g id="edge6" class="edge">
<title>conflict_with&#45;&gt;tctx_cb_execute</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1227.18,-999.62C1255.04,-1001.27 1287.09,-1003.17 1317.59,-1004.97"/>
<polygon fill="green" stroke="green" points="1317.68,-1008.48 1327.87,-1005.58 1318.09,-1001.49 1317.68,-1008.48"/>
</g>
<!-- notify&#45;&gt;tctx_cb_execute -->
<g id="edge1" class="edge">
<title>notify&#45;&gt;tctx_cb_execute</title>
<path fill="none" stroke="#666666" d="M1175.19,-1113.46C1204.34,-1110.09 1252.55,-1102.87 1292,-1089 1317.09,-1080.18 1343.15,-1067.51 1366.11,-1055"/>
<polygon fill="#666666" stroke="#666666" points="1368.03,-1057.94 1375.08,-1050.03 1364.64,-1051.82 1368.03,-1057.94"/>
</g>
<!-- delay_cancel -->
<g id="node10" class="node">
<title>delay_cancel</title>
<path fill="none" stroke="#1c2123" d="M1384.5,-1087C1384.5,-1087 1490.5,-1087 1490.5,-1087 1496.5,-1087 1502.5,-1093 1502.5,-1099 1502.5,-1099 1502.5,-1121 1502.5,-1121 1502.5,-1127 1496.5,-1133 1490.5,-1133 1490.5,-1133 1384.5,-1133 1384.5,-1133 1378.5,-1133 1372.5,-1127 1372.5,-1121 1372.5,-1121 1372.5,-1099 1372.5,-1099 1372.5,-1093 1378.5,-1087 1384.5,-1087"/>
<text text-anchor="middle" x="1437.5" y="-1117.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">delay_cancel</text>
<polyline fill="none" stroke="#1c2123" points="1372.5,-1110 1502.5,-1110 "/>
<text text-anchor="middle" x="1437.5" y="-1094.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">取消timeout定时器</text>
</g>
<!-- notify&#45;&gt;delay_cancel -->
<g id="edge2" class="edge">
<title>notify&#45;&gt;delay_cancel</title>
<path fill="none" stroke="#666666" d="M1175.02,-1115.46C1216.92,-1114.58 1300.86,-1112.83 1362.37,-1111.55"/>
<polygon fill="#666666" stroke="#666666" points="1362.5,-1115.05 1372.43,-1111.34 1362.36,-1108.05 1362.5,-1115.05"/>
</g>
<!-- notify_scheduler -->
<g id="node20" class="node">
<title>notify_scheduler</title>
<path fill="none" stroke="#1c2123" d="M1479,-519C1479,-519 1396,-519 1396,-519 1390,-519 1384,-513 1384,-507 1384,-507 1384,-495 1384,-495 1384,-489 1390,-483 1396,-483 1396,-483 1479,-483 1479,-483 1485,-483 1491,-489 1491,-495 1491,-495 1491,-507 1491,-507 1491,-513 1485,-519 1479,-519"/>
<text text-anchor="middle" x="1437.5" y="-497.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify_scheduler</text>
</g>
<!-- clean_up_wait_for&#45;&gt;notify_scheduler -->
<g id="edge21" class="edge">
<title>clean_up_wait_for&#45;&gt;notify_scheduler</title>
<path fill="none" stroke="#666666" d="M1207.34,-1065.19C1236.36,-1063.6 1269.87,-1056.46 1292,-1035 1345.26,-983.35 1309.58,-943.87 1328,-872 1361.16,-742.65 1408.32,-590.23 1427.69,-528.76"/>
<polygon fill="#666666" stroke="#666666" points="1431.09,-529.62 1430.76,-519.03 1424.41,-527.51 1431.09,-529.62"/>
</g>
<!-- run -->
<g id="node12" class="node">
<title>run</title>
<path fill="none" stroke="#1c2123" d="M507.5,-773C507.5,-773 477.5,-773 477.5,-773 471.5,-773 465.5,-767 465.5,-761 465.5,-761 465.5,-749 465.5,-749 465.5,-743 471.5,-737 477.5,-737 477.5,-737 507.5,-737 507.5,-737 513.5,-737 519.5,-743 519.5,-749 519.5,-749 519.5,-761 519.5,-761 519.5,-767 513.5,-773 507.5,-773"/>
<text text-anchor="middle" x="492.5" y="-751.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">run</text>
</g>
<!-- run&#45;&gt;Waiter_new -->
<g id="edge7" class="edge">
<title>run&#45;&gt;Waiter_new</title>
<path fill="none" stroke="#666666" d="M502.96,-773.06C516.55,-797.72 543.57,-842.27 576,-872 578.22,-874.03 580.59,-875.99 583.07,-877.86"/>
<polygon fill="#666666" stroke="#666666" points="581.54,-881.06 591.75,-883.9 585.53,-875.31 581.54,-881.06"/>
</g>
<!-- handle_wait_for -->
<g id="node13" class="node">
<title>handle_wait_for</title>
<path fill="none" stroke="#1c2123" d="M669,-736C669,-736 588,-736 588,-736 582,-736 576,-730 576,-724 576,-724 576,-712 576,-712 576,-706 582,-700 588,-700 588,-700 669,-700 669,-700 675,-700 681,-706 681,-712 681,-712 681,-724 681,-724 681,-730 675,-736 669,-736"/>
<text text-anchor="middle" x="628.5" y="-714.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_wait_for</text>
</g>
<!-- run&#45;&gt;handle_wait_for -->
<g id="edge8" class="edge">
<title>run&#45;&gt;handle_wait_for</title>
<path fill="none" stroke="#666666" d="M519.65,-747.78C532.9,-744.12 549.59,-739.51 565.86,-735.02"/>
<polygon fill="#666666" stroke="#666666" points="567.19,-738.28 575.89,-732.25 565.32,-731.54 567.19,-738.28"/>
</g>
<!-- handle_wake_up -->
<g id="node14" class="node">
<title>handle_wake_up</title>
<path fill="none" stroke="#1c2123" d="M729,-623C729,-623 956,-623 956,-623 962,-623 968,-629 968,-635 968,-635 968,-763 968,-763 968,-769 962,-775 956,-775 956,-775 729,-775 729,-775 723,-775 717,-769 717,-763 717,-763 717,-635 717,-635 717,-629 723,-623 729,-623"/>
<text text-anchor="middle" x="842.5" y="-759.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_wake_up</text>
<polyline fill="none" stroke="#1c2123" points="717,-752 968,-752 "/>
<text text-anchor="start" x="725" y="-736.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">取出等待lock队首的waiter</text>
<text text-anchor="start" x="725" y="-721.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 返回WriteConflict错误</text>
<polyline fill="none" stroke="#1c2123" points="717,-714 968,-714 "/>
<text text-anchor="start" x="725" y="-698.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">其他的waiter 重置timeout时间</text>
<polyline fill="none" stroke="#1c2123" points="717,-691 968,-691 "/>
<text text-anchor="start" x="725" y="-675.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">这样队首的waiter先处理WriteConflict</text>
<text text-anchor="start" x="725" y="-660.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会重新尝试获取lock</text>
<text text-anchor="start" x="725" y="-645.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 而其他的waiter则在timeout</text>
<text text-anchor="start" x="725" y="-630.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 之后才收到通知, 去尝试重新获取lock</text>
</g>
<!-- run&#45;&gt;handle_wake_up -->
<g id="edge9" class="edge">
<title>run&#45;&gt;handle_wake_up</title>
<path fill="none" stroke="#666666" d="M519.79,-755.46C556.25,-755.67 624.1,-754.55 681,-745 689.52,-743.57 698.22,-741.85 706.96,-739.93"/>
<polygon fill="#666666" stroke="#666666" points="707.86,-743.31 716.83,-737.68 706.3,-736.49 707.86,-743.31"/>
</g>
<!-- handle_wait_for&#45;&gt;wait_table -->
<g id="edge10" class="edge">
<title>handle_wait_for&#45;&gt;wait_table</title>
<path fill="none" stroke="#666666" d="M638.31,-699.86C651.49,-675.08 678.92,-631.73 717,-614 817,-567.45 944.38,-584.77 1034.47,-607.85"/>
<polygon fill="#666666" stroke="#666666" points="1033.6,-611.24 1044.16,-610.39 1035.38,-604.47 1033.6,-611.24"/>
</g>
<!-- handle_wait_for&#45;&gt;on_timeout -->
<g id="edge11" class="edge">
<title>handle_wait_for&#45;&gt;on_timeout</title>
<path fill="none" stroke="#666666" d="M637.53,-736.23C651.26,-766.29 681.25,-827.36 717,-872 742.38,-903.7 776.94,-934.31 803.21,-955.66"/>
<polygon fill="#666666" stroke="#666666" points="801.09,-958.45 811.08,-961.98 805.47,-952.99 801.09,-958.45"/>
</g>
<!-- spawn_local -->
<g id="node15" class="node">
<title>spawn_local</title>
<path fill="none" stroke="#1c2123" d="M872.5,-830C872.5,-830 812.5,-830 812.5,-830 806.5,-830 800.5,-824 800.5,-818 800.5,-818 800.5,-806 800.5,-806 800.5,-800 806.5,-794 812.5,-794 812.5,-794 872.5,-794 872.5,-794 878.5,-794 884.5,-800 884.5,-806 884.5,-806 884.5,-818 884.5,-818 884.5,-824 878.5,-830 872.5,-830"/>
<text text-anchor="middle" x="842.5" y="-808.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">spawn_local</text>
</g>
<!-- handle_wait_for&#45;&gt;spawn_local -->
<g id="edge12" class="edge">
<title>handle_wait_for&#45;&gt;spawn_local</title>
<path fill="none" stroke="#666666" d="M648.02,-736.14C664.71,-751.45 690.61,-772.78 717,-785 739.9,-795.6 767.13,-802.12 790.27,-806.08"/>
<polygon fill="#666666" stroke="#666666" points="789.82,-809.55 800.24,-807.68 790.92,-802.64 789.82,-809.55"/>
</g>
<!-- handle_wake_up&#45;&gt;wait_table -->
<g id="edge13" class="edge">
<title>handle_wake_up&#45;&gt;wait_table</title>
<path fill="none" stroke="#666666" d="M968.26,-676.8C987.33,-673.41 1006.99,-669.91 1025.99,-666.53"/>
<polygon fill="#666666" stroke="#666666" points="1026.62,-669.97 1035.85,-664.78 1025.39,-663.08 1026.62,-669.97"/>
</g>
<!-- handle_wake_up&#45;&gt;remove_oldest_waiter -->
<g id="edge14" class="edge">
<title>handle_wake_up&#45;&gt;remove_oldest_waiter</title>
<path fill="none" stroke="#666666" d="M968.26,-708.45C1002.34,-711.04 1038.29,-713.76 1068.95,-716.09"/>
<polygon fill="#666666" stroke="#666666" points="1068.89,-719.59 1079.13,-716.86 1069.42,-712.61 1068.89,-719.59"/>
</g>
<!-- handle_wake_up&#45;&gt;reset_timeout -->
<g id="edge15" class="edge">
<title>handle_wake_up&#45;&gt;reset_timeout</title>
<path fill="none" stroke="#666666" d="M967.12,-775.13C970.23,-778.33 973.2,-781.62 976,-785 996.88,-810.15 981.1,-829.68 1004,-853 1014.24,-863.43 1026.53,-872.22 1039.55,-879.6"/>
<polygon fill="#666666" stroke="#666666" points="1038.19,-882.85 1048.66,-884.49 1041.5,-876.68 1038.19,-882.85"/>
</g>
<!-- handle_wake_up&#45;&gt;conflict_with -->
<g id="edge16" class="edge">
<title>handle_wake_up&#45;&gt;conflict_with</title>
<path fill="none" stroke="#666666" d="M968.18,-774.35C970.98,-777.78 973.6,-781.33 976,-785 1017.91,-849.09 952.9,-897.97 1004,-955 1018.33,-970.99 1038.48,-980.81 1059.14,-986.79"/>
<polygon fill="#666666" stroke="#666666" points="1058.41,-990.21 1068.97,-989.34 1060.18,-983.44 1058.41,-990.21"/>
</g>
<!-- handle_wake_up&#45;&gt;notify -->
<g id="edge17" class="edge">
<title>handle_wake_up&#45;&gt;notify</title>
<path fill="none" stroke="#666666" d="M968.02,-773.48C970.91,-777.17 973.59,-781.01 976,-785 1011.08,-843.07 958.35,-1038.81 1004,-1089 1030.54,-1118.18 1077.88,-1121.81 1110.79,-1120.2"/>
<polygon fill="#666666" stroke="#666666" points="1111.18,-1123.69 1120.93,-1119.52 1110.71,-1116.7 1111.18,-1123.69"/>
</g>
<!-- schedule -->
<g id="node16" class="node">
<title>schedule</title>
<path fill="none" stroke="#1c2123" d="M1635,-519C1635,-519 1595,-519 1595,-519 1589,-519 1583,-513 1583,-507 1583,-507 1583,-495 1583,-495 1583,-489 1589,-483 1595,-483 1595,-483 1635,-483 1635,-483 1641,-483 1647,-489 1647,-495 1647,-495 1647,-507 1647,-507 1647,-513 1641,-519 1635,-519"/>
<text text-anchor="middle" x="1615" y="-497.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">schedule</text>
</g>
<!-- sender_unbounded_send -->
<g id="node17" class="node">
<title>sender_unbounded_send</title>
<path fill="none" stroke="#1c2123" d="M1821,-519C1821,-519 1695,-519 1695,-519 1689,-519 1683,-513 1683,-507 1683,-507 1683,-495 1683,-495 1683,-489 1689,-483 1695,-483 1695,-483 1821,-483 1821,-483 1827,-483 1833,-489 1833,-495 1833,-495 1833,-507 1833,-507 1833,-513 1827,-519 1821,-519"/>
<text text-anchor="middle" x="1758" y="-497.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">sender_unbounded_send</text>
</g>
<!-- schedule&#45;&gt;sender_unbounded_send -->
<g id="edge18" class="edge">
<title>schedule&#45;&gt;sender_unbounded_send</title>
<path fill="none" stroke="#666666" d="M1647.29,-501C1655.01,-501 1663.66,-501 1672.61,-501"/>
<polygon fill="#666666" stroke="#666666" points="1672.82,-504.5 1682.82,-501 1672.82,-497.5 1672.82,-504.5"/>
</g>
<!-- waiter_mgr_scheduler_wait_for -->
<g id="node18" class="node">
<title>waiter_mgr_scheduler_wait_for</title>
<path fill="none" stroke="#1c2123" d="M307.5,-465C307.5,-465 345.5,-465 345.5,-465 351.5,-465 357.5,-471 357.5,-477 357.5,-477 357.5,-489 357.5,-489 357.5,-495 351.5,-501 345.5,-501 345.5,-501 307.5,-501 307.5,-501 301.5,-501 295.5,-495 295.5,-489 295.5,-489 295.5,-477 295.5,-477 295.5,-471 301.5,-465 307.5,-465"/>
<text text-anchor="middle" x="326.5" y="-479.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wait_for</text>
</g>
<!-- waiter_mgr_scheduler_wait_for&#45;&gt;notify_scheduler -->
<g id="edge19" class="edge">
<title>waiter_mgr_scheduler_wait_for&#45;&gt;notify_scheduler</title>
<path fill="none" stroke="#666666" d="M357.71,-484.17C404.49,-485.94 497.24,-489.27 576,-491 874.36,-497.54 1231.01,-499.96 1373.34,-500.71"/>
<polygon fill="#666666" stroke="#666666" points="1373.6,-504.21 1383.62,-500.76 1373.64,-497.21 1373.6,-504.21"/>
</g>
<!-- Task_WaitFor -->
<g id="node21" class="node">
<title>Task_WaitFor</title>
<path fill="none" stroke="#1c2123" d="M528,-538C528,-538 457,-538 457,-538 451,-538 445,-532 445,-526 445,-526 445,-514 445,-514 445,-508 451,-502 457,-502 457,-502 528,-502 528,-502 534,-502 540,-508 540,-514 540,-514 540,-526 540,-526 540,-532 534,-538 528,-538"/>
<text text-anchor="middle" x="492.5" y="-516.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Task_WaitFor</text>
</g>
<!-- waiter_mgr_scheduler_wait_for&#45;&gt;Task_WaitFor -->
<g id="edge20" class="edge">
<title>waiter_mgr_scheduler_wait_for&#45;&gt;Task_WaitFor</title>
<path fill="none" stroke="#666666" d="M357.58,-489.79C379.23,-494.67 409.07,-501.4 435.1,-507.28"/>
<polygon fill="#666666" stroke="#666666" points="434.34,-510.69 444.86,-509.48 435.88,-503.86 434.34,-510.69"/>
</g>
<!-- waiter_mgr_scheduler_wake_up -->
<g id="node19" class="node">
<title>waiter_mgr_scheduler_wake_up</title>
<path fill="none" stroke="#1c2123" d="M472,-427C472,-427 513,-427 513,-427 519,-427 525,-433 525,-439 525,-439 525,-451 525,-451 525,-457 519,-463 513,-463 513,-463 472,-463 472,-463 466,-463 460,-457 460,-451 460,-451 460,-439 460,-439 460,-433 466,-427 472,-427"/>
<text text-anchor="middle" x="492.5" y="-441.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wake_up</text>
</g>
<!-- waiter_mgr_scheduler_wake_up&#45;&gt;notify_scheduler -->
<g id="edge23" class="edge">
<title>waiter_mgr_scheduler_wake_up&#45;&gt;notify_scheduler</title>
<path fill="none" stroke="#666666" d="M525.18,-441.21C540.51,-439.55 559.18,-437.81 576,-437 622.61,-434.75 634.37,-435.03 681,-437 938.7,-447.9 1244.51,-479.61 1373.82,-493.88"/>
<polygon fill="#666666" stroke="#666666" points="1373.61,-497.38 1383.93,-495.01 1374.38,-490.43 1373.61,-497.38"/>
</g>
<!-- Task_Wakeup -->
<g id="node22" class="node">
<title>Task_Wakeup</title>
<path fill="none" stroke="#1c2123" d="M664,-482C664,-482 593,-482 593,-482 587,-482 581,-476 581,-470 581,-470 581,-458 581,-458 581,-452 587,-446 593,-446 593,-446 664,-446 664,-446 670,-446 676,-452 676,-458 676,-458 676,-470 676,-470 676,-476 670,-482 664,-482"/>
<text text-anchor="middle" x="628.5" y="-460.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Task_Wakeup</text>
</g>
<!-- waiter_mgr_scheduler_wake_up&#45;&gt;Task_Wakeup -->
<g id="edge24" class="edge">
<title>waiter_mgr_scheduler_wake_up&#45;&gt;Task_Wakeup</title>
<path fill="none" stroke="#666666" d="M525.26,-449.5C538.91,-451.44 555.28,-453.76 570.89,-455.97"/>
<polygon fill="#666666" stroke="#666666" points="570.61,-459.47 581,-457.41 571.59,-452.54 570.61,-459.47"/>
</g>
<!-- notify_scheduler&#45;&gt;schedule -->
<g id="edge22" class="edge">
<title>notify_scheduler&#45;&gt;schedule</title>
<path fill="none" stroke="#666666" d="M1491.16,-501C1517.31,-501 1548.43,-501 1572.81,-501"/>
<polygon fill="#666666" stroke="#666666" points="1572.81,-504.5 1582.81,-501 1572.81,-497.5 1572.81,-504.5"/>
</g>
<!-- Task_WaitFor&#45;&gt;handle_wait_for -->
<g id="edge25" class="edge">
<title>Task_WaitFor&#45;&gt;handle_wait_for</title>
<path fill="none" stroke="#666666" d="M505.87,-538.27C529.65,-573.41 581.85,-650.54 609.5,-691.4"/>
<polygon fill="#666666" stroke="#666666" points="606.66,-693.45 615.16,-699.77 612.46,-689.53 606.66,-693.45"/>
</g>
<!-- Task_Wakeup&#45;&gt;handle_wake_up -->
<g id="edge26" class="edge">
<title>Task_Wakeup&#45;&gt;handle_wake_up</title>
<path fill="none" stroke="#666666" d="M641.98,-482.39C658.23,-505.88 687.99,-547.4 717,-580 727.53,-591.84 739.04,-603.88 750.67,-615.52"/>
<polygon fill="#666666" stroke="#666666" points="748.36,-618.16 757.92,-622.72 753.29,-613.19 748.36,-618.16"/>
</g>
<!-- cb_execute_pr -->
<g id="node23" class="node">
<title>cb_execute_pr</title>
<path fill="none" stroke="#1c2123" d="M256,-202.5C256,-202.5 397,-202.5 397,-202.5 403,-202.5 409,-208.5 409,-214.5 409,-214.5 409,-251.5 409,-251.5 409,-257.5 403,-263.5 397,-263.5 397,-263.5 256,-263.5 256,-263.5 250,-263.5 244,-257.5 244,-251.5 244,-251.5 244,-214.5 244,-214.5 244,-208.5 250,-202.5 256,-202.5"/>
<text text-anchor="middle" x="326.5" y="-248.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">tctx_cb_execute</text>
<polyline fill="none" stroke="#1c2123" points="244,-240.5 409,-240.5 "/>
<text text-anchor="start" x="252" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果timeout是None</text>
<text text-anchor="middle" x="326.5" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 立即执行tctx_cb_execute</text>
</g>
<!-- wait_for -->
<g id="node24" class="node">
<title>wait_for</title>
<path fill="none" stroke="#1c2123" d="M131,-345C131,-345 93,-345 93,-345 87,-345 81,-339 81,-333 81,-333 81,-321 81,-321 81,-315 87,-309 93,-309 93,-309 131,-309 131,-309 137,-309 143,-315 143,-321 143,-321 143,-333 143,-333 143,-339 137,-345 131,-345"/>
<text text-anchor="middle" x="112" y="-323.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wait_for</text>
</g>
<!-- wait_for&#45;&gt;waiter_mgr_scheduler_wait_for -->
<g id="edge27" class="edge">
<title>wait_for&#45;&gt;waiter_mgr_scheduler_wait_for</title>
<path fill="none" stroke="#666666" d="M137.79,-345.2C176.18,-373.38 250.02,-427.59 292.75,-458.96"/>
<polygon fill="#666666" stroke="#666666" points="290.73,-461.82 300.87,-464.92 294.88,-456.18 290.73,-461.82"/>
</g>
<!-- wait_for&#45;&gt;cb_execute_pr -->
<g id="edge28" class="edge">
<title>wait_for&#45;&gt;cb_execute_pr</title>
<path fill="none" stroke="#666666" d="M143.45,-313.53C170.42,-301.6 210.98,-283.66 246.98,-267.73"/>
<polygon fill="#666666" stroke="#666666" points="248.78,-270.77 256.51,-263.52 245.95,-264.36 248.78,-270.77"/>
</g>
<!-- add_to_detected -->
<g id="node25" class="node">
<title>add_to_detected</title>
<path fill="none" stroke="#1c2123" d="M367,-318C367,-318 286,-318 286,-318 280,-318 274,-312 274,-306 274,-306 274,-294 274,-294 274,-288 280,-282 286,-282 286,-282 367,-282 367,-282 373,-282 379,-288 379,-294 379,-294 379,-306 379,-306 379,-312 373,-318 367,-318"/>
<text text-anchor="middle" x="326.5" y="-296.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">add_to_detected</text>
</g>
<!-- wait_for&#45;&gt;add_to_detected -->
<g id="edge29" class="edge">
<title>wait_for&#45;&gt;add_to_detected</title>
<path fill="none" stroke="#666666" d="M143.45,-323.13C174.7,-319.16 224.2,-312.87 263.7,-307.85"/>
<polygon fill="#666666" stroke="#666666" points="264.29,-311.31 273.77,-306.57 263.41,-304.36 264.29,-311.31"/>
</g>
<!-- detector_scheduler_detect -->
<g id="node26" class="node">
<title>detector_scheduler_detect</title>
<path fill="none" stroke="#1c2123" d="M393.5,-372C393.5,-372 259.5,-372 259.5,-372 253.5,-372 247.5,-366 247.5,-360 247.5,-360 247.5,-348 247.5,-348 247.5,-342 253.5,-336 259.5,-336 259.5,-336 393.5,-336 393.5,-336 399.5,-336 405.5,-342 405.5,-348 405.5,-348 405.5,-360 405.5,-360 405.5,-366 399.5,-372 393.5,-372"/>
<text text-anchor="middle" x="326.5" y="-350.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">detector_scheduler_detect</text>
</g>
<!-- wait_for&#45;&gt;detector_scheduler_detect -->
<g id="edge30" class="edge">
<title>wait_for&#45;&gt;detector_scheduler_detect</title>
<path fill="none" stroke="#666666" d="M143.45,-330.87C167.99,-333.99 203.8,-338.54 237.17,-342.78"/>
<polygon fill="#666666" stroke="#666666" points="237.08,-346.29 247.44,-344.08 237.96,-339.35 237.08,-346.29"/>
</g>
<!-- wake_up -->
<g id="node27" class="node">
<title>wake_up</title>
<path fill="none" stroke="#1c2123" d="M347,-184C347,-184 306,-184 306,-184 300,-184 294,-178 294,-172 294,-172 294,-160 294,-160 294,-154 300,-148 306,-148 306,-148 347,-148 347,-148 353,-148 359,-154 359,-160 359,-160 359,-172 359,-172 359,-178 353,-184 347,-184"/>
<text text-anchor="middle" x="326.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wake_up</text>
</g>
<!-- wake_up&#45;&gt;waiter_mgr_scheduler_wake_up -->
<g id="edge31" class="edge">
<title>wake_up&#45;&gt;waiter_mgr_scheduler_wake_up</title>
<path fill="none" stroke="#666666" d="M359.09,-168.11C378.22,-171 401.78,-177.69 417,-193 478.57,-254.91 489.72,-365.1 491.42,-416.78"/>
<polygon fill="#666666" stroke="#666666" points="487.93,-416.96 491.66,-426.88 494.93,-416.8 487.93,-416.96"/>
</g>
<!-- ReleasedLock_wake_up -->
<g id="node28" class="node">
<title>ReleasedLock_wake_up</title>
<path fill="none" stroke="#1c2123" d="M28,-17C28,-17 196,-17 196,-17 202,-17 208,-23 208,-29 208,-29 208,-81 208,-81 208,-87 202,-93 196,-93 196,-93 28,-93 28,-93 22,-93 16,-87 16,-81 16,-81 16,-29 16,-29 16,-23 22,-17 28,-17"/>
<text text-anchor="middle" x="112" y="-77.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLock_wake_up</text>
<polyline fill="none" stroke="#1c2123" points="16,-70 208,-70 "/>
<text text-anchor="start" x="24" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">在Commit和RollBack cmd,</text>
<text text-anchor="start" x="24" y="-39.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 清理掉事务的Lock之后</text>
<text text-anchor="start" x="24" y="-24.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会调用ReleasedLock.wake_up</text>
</g>
<!-- ReleasedLock_wake_up&#45;&gt;wake_up -->
<g id="edge32" class="edge">
<title>ReleasedLock_wake_up&#45;&gt;wake_up</title>
<path fill="none" stroke="#666666" d="M185.83,-93.04C218.97,-110.35 256.94,-130.19 284.91,-144.8"/>
<polygon fill="#666666" stroke="#666666" points="283.51,-148.02 294,-149.54 286.75,-141.81 283.51,-148.02"/>
</g>
</g>
</svg>
