<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="815pt" height="373pt"
 viewBox="0.00 0.00 815.00 373.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 369)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-369 811,-369 811,4 -4,4"/>
<!-- KvStore__SendReq -->
<g id="node1" class="node">
<title>KvStore__SendReq</title>
<path fill="none" stroke="#1c2123" d="M455,-222.5C455,-222.5 550,-222.5 550,-222.5 556,-222.5 562,-228.5 562,-234.5 562,-234.5 562,-271.5 562,-271.5 562,-277.5 556,-283.5 550,-283.5 550,-283.5 455,-283.5 455,-283.5 449,-283.5 443,-277.5 443,-271.5 443,-271.5 443,-234.5 443,-234.5 443,-228.5 449,-222.5 455,-222.5"/>
<text text-anchor="start" x="451" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">KvStore</text>
<text text-anchor="start" x="451" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> SendReq</text>
<polyline fill="none" stroke="#1c2123" points="443,-245.5 562,-245.5 "/>
<text text-anchor="start" x="451" y="-230.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送请求给TiKV</text>
</g>
<!-- ReadTimeoutShort -->
<g id="node2" class="node">
<title>ReadTimeoutShort</title>
<path fill="none" stroke="#1c2123" d="M750.5,-365C750.5,-365 654.5,-365 654.5,-365 648.5,-365 642.5,-359 642.5,-353 642.5,-353 642.5,-341 642.5,-341 642.5,-335 648.5,-329 654.5,-329 654.5,-329 750.5,-329 750.5,-329 756.5,-329 762.5,-335 762.5,-341 762.5,-341 762.5,-353 762.5,-353 762.5,-359 756.5,-365 750.5,-365"/>
<text text-anchor="middle" x="702.5" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadTimeoutShort</text>
</g>
<!-- KvStore__SendReq&#45;&gt;ReadTimeoutShort -->
<g id="edge1" class="edge">
<title>KvStore__SendReq&#45;&gt;ReadTimeoutShort</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M544.82,-283.74C560.85,-294.67 579.72,-306.39 598,-315 608.9,-320.13 620.83,-324.7 632.58,-328.67"/>
<polygon fill="green" stroke="green" points="631.8,-332.09 642.39,-331.86 633.96,-325.44 631.8,-332.09"/>
</g>
<!-- ResolveLockRequest -->
<g id="node6" class="node">
<title>ResolveLockRequest</title>
<path fill="none" stroke="#1c2123" d="M610,-206.5C610,-206.5 795,-206.5 795,-206.5 801,-206.5 807,-212.5 807,-218.5 807,-218.5 807,-293.5 807,-293.5 807,-299.5 801,-305.5 795,-305.5 795,-305.5 610,-305.5 610,-305.5 604,-305.5 598,-299.5 598,-293.5 598,-293.5 598,-218.5 598,-218.5 598,-212.5 604,-206.5 610,-206.5"/>
<text text-anchor="start" x="606" y="-290.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLockRequest</text>
<polyline fill="none" stroke="#1c2123" points="598,-282.5 807,-282.5 "/>
<text text-anchor="start" x="606" y="-267.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">StartVersion: l.TxnID</text>
<text text-anchor="start" x="606" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> CommitVersion: status.CommitTs</text>
<polyline fill="none" stroke="#1c2123" points="598,-244.5 807,-244.5 "/>
<text text-anchor="start" x="606" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit_ts为0表示rollback</text>
<text text-anchor="start" x="606" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit_ts &gt; 0 表示commit</text>
</g>
<!-- KvStore__SendReq&#45;&gt;ResolveLockRequest -->
<g id="edge11" class="edge">
<title>KvStore__SendReq&#45;&gt;ResolveLockRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M562.1,-253.89C570.22,-254.01 578.77,-254.14 587.48,-254.27"/>
<polygon fill="green" stroke="green" points="587.71,-257.78 597.76,-254.43 587.81,-250.78 587.71,-257.78"/>
</g>
<!-- CmdResolveLock -->
<g id="node7" class="node">
<title>CmdResolveLock</title>
<path fill="none" stroke="#1c2123" d="M748,-177C748,-177 657,-177 657,-177 651,-177 645,-171 645,-165 645,-165 645,-153 645,-153 645,-147 651,-141 657,-141 657,-141 748,-141 748,-141 754,-141 760,-147 760,-153 760,-153 760,-165 760,-165 760,-171 754,-177 748,-177"/>
<text text-anchor="middle" x="702.5" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdResolveLock</text>
</g>
<!-- KvStore__SendReq&#45;&gt;CmdResolveLock -->
<g id="edge12" class="edge">
<title>KvStore__SendReq&#45;&gt;CmdResolveLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M551.13,-222.48C565.85,-213.67 582.32,-204.45 598,-197 610.38,-191.12 623.94,-185.55 637.04,-180.59"/>
<polygon fill="green" stroke="green" points="638.32,-183.85 646.48,-177.08 635.88,-177.28 638.32,-183.85"/>
</g>
<!-- RegionCache__LocateKey -->
<g id="node3" class="node">
<title>RegionCache__LocateKey</title>
<path fill="none" stroke="#1c2123" d="M185,-184.5C185,-184.5 303,-184.5 303,-184.5 309,-184.5 315,-190.5 315,-196.5 315,-196.5 315,-233.5 315,-233.5 315,-239.5 309,-245.5 303,-245.5 303,-245.5 185,-245.5 185,-245.5 179,-245.5 173,-239.5 173,-233.5 173,-233.5 173,-196.5 173,-196.5 173,-190.5 179,-184.5 185,-184.5"/>
<text text-anchor="start" x="181" y="-230.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RegionCache</text>
<text text-anchor="start" x="181" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> LocateKey</text>
<polyline fill="none" stroke="#1c2123" points="173,-207.5 315,-207.5 "/>
<text text-anchor="start" x="181" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">定位key所在的region</text>
</g>
<!-- Region -->
<g id="node4" class="node">
<title>Region</title>
<path fill="none" stroke="#1c2123" d="M395,-239C395,-239 363,-239 363,-239 357,-239 351,-233 351,-227 351,-227 351,-215 351,-215 351,-209 357,-203 363,-203 363,-203 395,-203 395,-203 401,-203 407,-209 407,-215 407,-215 407,-227 407,-227 407,-233 401,-239 395,-239"/>
<text text-anchor="middle" x="379" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Region</text>
</g>
<!-- RegionCache__LocateKey&#45;&gt;Region -->
<g id="edge2" class="edge">
<title>RegionCache__LocateKey&#45;&gt;Region</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M315.01,-218.16C323.88,-218.56 332.68,-218.96 340.75,-219.32"/>
<polygon fill="green" stroke="green" points="340.75,-222.82 350.9,-219.78 341.07,-215.83 340.75,-222.82"/>
</g>
<!-- Region&#45;&gt;KvStore__SendReq -->
<g id="edge3" class="edge">
<title>Region&#45;&gt;KvStore__SendReq</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M407.27,-228.18C414.97,-230.21 423.73,-232.52 432.72,-234.88"/>
<polygon fill="green" stroke="green" points="431.97,-238.31 442.53,-237.47 433.75,-231.54 431.97,-238.31"/>
</g>
<!-- LockResolver__resolveLock -->
<g id="node5" class="node">
<title>LockResolver__resolveLock</title>
<path fill="none" stroke="#1c2123" d="M12,-177C12,-177 125,-177 125,-177 131,-177 137,-183 137,-189 137,-189 137,-241 137,-241 137,-247 131,-253 125,-253 125,-253 12,-253 12,-253 6,-253 0,-247 0,-241 0,-241 0,-189 0,-189 0,-183 6,-177 12,-177"/>
<text text-anchor="start" x="8" y="-237.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="8" y="-222.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> resolveLock</text>
<polyline fill="none" stroke="#1c2123" points="0,-215 137,-215 "/>
<text text-anchor="start" x="8" y="-199.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">清理掉secondary key</text>
<text text-anchor="start" x="8" y="-184.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的lock</text>
</g>
<!-- LockResolver__resolveLock&#45;&gt;KvStore__SendReq -->
<g id="edge4" class="edge">
<title>LockResolver__resolveLock&#45;&gt;KvStore__SendReq</title>
<path fill="none" stroke="#666666" d="M137.22,-245.23C148.94,-249.28 161.16,-252.79 173,-255 261.52,-271.51 365.81,-266.89 432.75,-260.93"/>
<polygon fill="#666666" stroke="#666666" points="433.12,-264.41 442.75,-260 432.47,-257.44 433.12,-264.41"/>
</g>
<!-- LockResolver__resolveLock&#45;&gt;ReadTimeoutShort -->
<g id="edge5" class="edge">
<title>LockResolver__resolveLock&#45;&gt;ReadTimeoutShort</title>
<path fill="none" stroke="#666666" d="M103.1,-253.13C121.75,-271.69 146.5,-292.45 173,-304 326.13,-370.75 527.71,-364.47 632.12,-355.16"/>
<polygon fill="#666666" stroke="#666666" points="632.58,-358.64 642.22,-354.23 631.94,-351.67 632.58,-358.64"/>
</g>
<!-- LockResolver__resolveLock&#45;&gt;RegionCache__LocateKey -->
<g id="edge6" class="edge">
<title>LockResolver__resolveLock&#45;&gt;RegionCache__LocateKey</title>
<path fill="none" stroke="#666666" d="M137.08,-215C145.49,-215 154.15,-215 162.73,-215"/>
<polygon fill="#666666" stroke="#666666" points="162.75,-218.5 172.75,-215 162.75,-211.5 162.75,-218.5"/>
</g>
<!-- LockResolver__resolveLock&#45;&gt;ResolveLockRequest -->
<g id="edge7" class="edge">
<title>LockResolver__resolveLock&#45;&gt;ResolveLockRequest</title>
<path fill="none" stroke="#666666" d="M125.72,-253.06C140.52,-261.36 156.87,-269.11 173,-274 338.66,-324.19 390.36,-315.38 562,-293 570.48,-291.89 579.19,-290.42 587.9,-288.71"/>
<polygon fill="#666666" stroke="#666666" points="588.65,-292.13 597.73,-286.67 587.23,-285.27 588.65,-292.13"/>
</g>
<!-- LockResolver__resolveLock&#45;&gt;CmdResolveLock -->
<g id="edge8" class="edge">
<title>LockResolver__resolveLock&#45;&gt;CmdResolveLock</title>
<path fill="none" stroke="#666666" d="M137.28,-185.08C148.99,-180.99 161.2,-177.39 173,-175 336.32,-141.97 533.74,-147.74 634.79,-153.89"/>
<polygon fill="#666666" stroke="#666666" points="634.66,-157.39 644.86,-154.52 635.1,-150.4 634.66,-157.39"/>
</g>
<!-- GetRegionError -->
<g id="node8" class="node">
<title>GetRegionError</title>
<path fill="none" stroke="#1c2123" d="M187,-81C187,-81 301,-81 301,-81 307,-81 313,-87 313,-93 313,-93 313,-115 313,-115 313,-121 307,-127 301,-127 301,-127 187,-127 187,-127 181,-127 175,-121 175,-115 175,-115 175,-93 175,-93 175,-87 181,-81 187,-81"/>
<text text-anchor="start" x="183" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetRegionError</text>
<polyline fill="none" stroke="#1c2123" points="175,-104 313,-104 "/>
<text text-anchor="start" x="183" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理region error问题</text>
</g>
<!-- LockResolver__resolveLock&#45;&gt;GetRegionError -->
<g id="edge9" class="edge">
<title>LockResolver__resolveLock&#45;&gt;GetRegionError</title>
<path fill="none" stroke="#666666" d="M121.08,-176.84C137.42,-165.24 155.72,-152.73 173,-142 178.32,-138.7 183.95,-135.37 189.61,-132.14"/>
<polygon fill="#666666" stroke="#666666" points="191.49,-135.1 198.49,-127.15 188.06,-129 191.49,-135.1"/>
</g>
<!-- Backoffer__Backoff -->
<g id="node9" class="node">
<title>Backoffer__Backoff</title>
<path fill="none" stroke="#1c2123" d="M187.5,-0.5C187.5,-0.5 300.5,-0.5 300.5,-0.5 306.5,-0.5 312.5,-6.5 312.5,-12.5 312.5,-12.5 312.5,-49.5 312.5,-49.5 312.5,-55.5 306.5,-61.5 300.5,-61.5 300.5,-61.5 187.5,-61.5 187.5,-61.5 181.5,-61.5 175.5,-55.5 175.5,-49.5 175.5,-49.5 175.5,-12.5 175.5,-12.5 175.5,-6.5 181.5,-0.5 187.5,-0.5"/>
<text text-anchor="start" x="183.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Backoffer__Backoff</text>
<polyline fill="none" stroke="#1c2123" points="175.5,-38.5 312.5,-38.5 "/>
<text text-anchor="start" x="183.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对于regionError重试</text>
<text text-anchor="start" x="183.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重新LocKey</text>
</g>
<!-- LockResolver__resolveLock&#45;&gt;Backoffer__Backoff -->
<g id="edge10" class="edge">
<title>LockResolver__resolveLock&#45;&gt;Backoffer__Backoff</title>
<path fill="none" stroke="#666666" d="M90.58,-176.97C109.25,-145.74 138.81,-101.81 173,-71 174.14,-69.98 175.31,-68.97 176.5,-67.97"/>
<polygon fill="#666666" stroke="#666666" points="178.93,-70.51 184.7,-61.63 174.65,-64.97 178.93,-70.51"/>
</g>
</g>
</svg>
