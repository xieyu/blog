<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="621pt" height="726pt"
 viewBox="0.00 0.00 621.00 725.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 721.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-721.5 617,-721.5 617,4 -4,4"/>
<!-- check_txn_status_lock_exists -->
<g id="node1" class="node">
<title>check_txn_status_lock_exists</title>
<path fill="none" stroke="#1c2123" d="M414,-123.5C414,-123.5 261,-123.5 261,-123.5 255,-123.5 249,-117.5 249,-111.5 249,-111.5 249,-99.5 249,-99.5 249,-93.5 255,-87.5 261,-87.5 261,-87.5 414,-87.5 414,-87.5 420,-87.5 426,-93.5 426,-99.5 426,-99.5 426,-111.5 426,-111.5 426,-117.5 420,-123.5 414,-123.5"/>
<text text-anchor="middle" x="337.5" y="-101.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_txn_status_lock_exists</text>
</g>
<!-- Lock__for_update_ts -->
<g id="node14" class="node">
<title>Lock__for_update_ts</title>
<path fill="none" stroke="#1c2123" d="M601,-393.5C601,-393.5 493,-393.5 493,-393.5 487,-393.5 481,-387.5 481,-381.5 481,-381.5 481,-369.5 481,-369.5 481,-363.5 487,-357.5 493,-357.5 493,-357.5 601,-357.5 601,-357.5 607,-357.5 613,-363.5 613,-369.5 613,-369.5 613,-381.5 613,-381.5 613,-387.5 607,-393.5 601,-393.5"/>
<text text-anchor="middle" x="547" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__for_update_ts</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;Lock__for_update_ts -->
<g id="edge1" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M426.2,-120.33C432.99,-123.63 439.37,-127.64 445,-132.5 511,-189.53 534.73,-296.65 542.53,-347.43"/>
<polygon fill="#666666" stroke="#666666" points="539.08,-347.97 543.97,-357.37 546,-346.97 539.08,-347.97"/>
</g>
<!-- Lock__fmt -->
<g id="node2" class="node">
<title>Lock__fmt</title>
<path fill="none" stroke="#1c2123" d="M364,-717.5C364,-717.5 311,-717.5 311,-717.5 305,-717.5 299,-711.5 299,-705.5 299,-705.5 299,-693.5 299,-693.5 299,-687.5 305,-681.5 311,-681.5 311,-681.5 364,-681.5 364,-681.5 370,-681.5 376,-687.5 376,-693.5 376,-693.5 376,-705.5 376,-705.5 376,-711.5 370,-717.5 364,-717.5"/>
<text text-anchor="middle" x="337.5" y="-695.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__fmt</text>
</g>
<!-- Lock__fmt&#45;&gt;Lock__for_update_ts -->
<g id="edge2" class="edge">
<title>Lock__fmt&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M376.24,-698.66C398.77,-696.23 426.5,-689.58 445,-672.5 523.91,-599.63 541.18,-462.76 544.95,-403.75"/>
<polygon fill="#666666" stroke="#666666" points="548.45,-403.85 545.51,-393.68 541.46,-403.47 548.45,-403.85"/>
</g>
<!-- Lock__new -->
<g id="node3" class="node">
<title>Lock__new</title>
<path fill="none" stroke="#1c2123" d="M365.5,-663.5C365.5,-663.5 309.5,-663.5 309.5,-663.5 303.5,-663.5 297.5,-657.5 297.5,-651.5 297.5,-651.5 297.5,-639.5 297.5,-639.5 297.5,-633.5 303.5,-627.5 309.5,-627.5 309.5,-627.5 365.5,-627.5 365.5,-627.5 371.5,-627.5 377.5,-633.5 377.5,-639.5 377.5,-639.5 377.5,-651.5 377.5,-651.5 377.5,-657.5 371.5,-663.5 365.5,-663.5"/>
<text text-anchor="middle" x="337.5" y="-641.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__new</text>
</g>
<!-- Lock__new&#45;&gt;Lock__for_update_ts -->
<g id="edge3" class="edge">
<title>Lock__new&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M377.64,-644C399.69,-641.27 426.45,-634.52 445,-618.5 511,-561.47 534.73,-454.35 542.53,-403.57"/>
<polygon fill="#666666" stroke="#666666" points="546,-404.03 543.97,-393.63 539.08,-403.03 546,-404.03"/>
</g>
<!-- Lock__to_bytes -->
<g id="node4" class="node">
<title>Lock__to_bytes</title>
<path fill="none" stroke="#1c2123" d="M377.5,-609.5C377.5,-609.5 297.5,-609.5 297.5,-609.5 291.5,-609.5 285.5,-603.5 285.5,-597.5 285.5,-597.5 285.5,-585.5 285.5,-585.5 285.5,-579.5 291.5,-573.5 297.5,-573.5 297.5,-573.5 377.5,-573.5 377.5,-573.5 383.5,-573.5 389.5,-579.5 389.5,-585.5 389.5,-585.5 389.5,-597.5 389.5,-597.5 389.5,-603.5 383.5,-609.5 377.5,-609.5"/>
<text text-anchor="middle" x="337.5" y="-587.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__to_bytes</text>
</g>
<!-- Lock__to_bytes&#45;&gt;Lock__for_update_ts -->
<g id="edge4" class="edge">
<title>Lock__to_bytes&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M389.76,-587.23C408.68,-583.54 429.3,-576.79 445,-564.5 498.34,-522.75 526.9,-444.78 538.94,-403.24"/>
<polygon fill="#666666" stroke="#666666" points="542.34,-404.08 541.65,-393.5 535.6,-402.2 542.34,-404.08"/>
</g>
<!-- Lock__pre_allocate_size -->
<g id="node5" class="node">
<title>Lock__pre_allocate_size</title>
<path fill="none" stroke="#1c2123" d="M401.5,-555.5C401.5,-555.5 273.5,-555.5 273.5,-555.5 267.5,-555.5 261.5,-549.5 261.5,-543.5 261.5,-543.5 261.5,-531.5 261.5,-531.5 261.5,-525.5 267.5,-519.5 273.5,-519.5 273.5,-519.5 401.5,-519.5 401.5,-519.5 407.5,-519.5 413.5,-525.5 413.5,-531.5 413.5,-531.5 413.5,-543.5 413.5,-543.5 413.5,-549.5 407.5,-555.5 401.5,-555.5"/>
<text text-anchor="middle" x="337.5" y="-533.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__pre_allocate_size</text>
</g>
<!-- Lock__pre_allocate_size&#45;&gt;Lock__for_update_ts -->
<g id="edge5" class="edge">
<title>Lock__pre_allocate_size&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M413.73,-525.33C424.75,-521.63 435.56,-516.8 445,-510.5 485.82,-483.26 516.49,-433.8 532.8,-402.9"/>
<polygon fill="#666666" stroke="#666666" points="535.94,-404.45 537.4,-393.96 529.72,-401.25 535.94,-404.45"/>
</g>
<!-- Lock__into_lock_info -->
<g id="node6" class="node">
<title>Lock__into_lock_info</title>
<path fill="none" stroke="#1c2123" d="M394,-501.5C394,-501.5 281,-501.5 281,-501.5 275,-501.5 269,-495.5 269,-489.5 269,-489.5 269,-477.5 269,-477.5 269,-471.5 275,-465.5 281,-465.5 281,-465.5 394,-465.5 394,-465.5 400,-465.5 406,-471.5 406,-477.5 406,-477.5 406,-489.5 406,-489.5 406,-495.5 400,-501.5 394,-501.5"/>
<text text-anchor="middle" x="337.5" y="-479.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__into_lock_info</text>
</g>
<!-- Lock__into_lock_info&#45;&gt;Lock__for_update_ts -->
<g id="edge6" class="edge">
<title>Lock__into_lock_info&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M406.26,-470.96C419.48,-467.24 432.96,-462.5 445,-456.5 473.65,-442.23 501.67,-418.78 520.9,-400.77"/>
<polygon fill="#666666" stroke="#666666" points="523.52,-403.11 528.33,-393.68 518.68,-398.05 523.52,-403.11"/>
</g>
<!-- Lock__is_pessimistic_txn -->
<g id="node7" class="node">
<title>Lock__is_pessimistic_txn</title>
<path fill="none" stroke="#1c2123" d="M404.5,-447.5C404.5,-447.5 270.5,-447.5 270.5,-447.5 264.5,-447.5 258.5,-441.5 258.5,-435.5 258.5,-435.5 258.5,-423.5 258.5,-423.5 258.5,-417.5 264.5,-411.5 270.5,-411.5 270.5,-411.5 404.5,-411.5 404.5,-411.5 410.5,-411.5 416.5,-417.5 416.5,-423.5 416.5,-423.5 416.5,-435.5 416.5,-435.5 416.5,-441.5 410.5,-447.5 404.5,-447.5"/>
<text text-anchor="middle" x="337.5" y="-425.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__is_pessimistic_txn</text>
</g>
<!-- Lock__is_pessimistic_txn&#45;&gt;Lock__for_update_ts -->
<g id="edge7" class="edge">
<title>Lock__is_pessimistic_txn&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M410.14,-411.47C421.8,-408.5 433.74,-405.43 445,-402.5 453.42,-400.31 462.23,-397.99 470.99,-395.67"/>
<polygon fill="#666666" stroke="#666666" points="472.07,-399 480.84,-393.05 470.27,-392.24 472.07,-399"/>
</g>
<!-- Delegate__sink_put -->
<g id="node8" class="node">
<title>Delegate__sink_put</title>
<path fill="none" stroke="#1c2123" d="M388,-393.5C388,-393.5 287,-393.5 287,-393.5 281,-393.5 275,-387.5 275,-381.5 275,-381.5 275,-369.5 275,-369.5 275,-363.5 281,-357.5 287,-357.5 287,-357.5 388,-357.5 388,-357.5 394,-357.5 400,-363.5 400,-369.5 400,-369.5 400,-381.5 400,-381.5 400,-387.5 394,-393.5 388,-393.5"/>
<text text-anchor="middle" x="337.5" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Delegate__sink_put</text>
</g>
<!-- Delegate__sink_put&#45;&gt;Lock__for_update_ts -->
<g id="edge8" class="edge">
<title>Delegate__sink_put&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M400.2,-375.5C422.36,-375.5 447.61,-375.5 470.79,-375.5"/>
<polygon fill="#666666" stroke="#666666" points="470.94,-379 480.94,-375.5 470.94,-372 470.94,-379"/>
</g>
<!-- decode_lock -->
<g id="node9" class="node">
<title>decode_lock</title>
<path fill="none" stroke="#1c2123" d="M368,-339.5C368,-339.5 307,-339.5 307,-339.5 301,-339.5 295,-333.5 295,-327.5 295,-327.5 295,-315.5 295,-315.5 295,-309.5 301,-303.5 307,-303.5 307,-303.5 368,-303.5 368,-303.5 374,-303.5 380,-309.5 380,-315.5 380,-315.5 380,-327.5 380,-327.5 380,-333.5 374,-339.5 368,-339.5"/>
<text text-anchor="middle" x="337.5" y="-317.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">decode_lock</text>
</g>
<!-- decode_lock&#45;&gt;Lock__for_update_ts -->
<g id="edge9" class="edge">
<title>decode_lock&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M380,-331.89C399.71,-336.86 423.59,-342.92 445,-348.5 453.42,-350.69 462.23,-353.01 470.99,-355.33"/>
<polygon fill="#666666" stroke="#666666" points="470.27,-358.76 480.84,-357.95 472.07,-352 470.27,-358.76"/>
</g>
<!-- cleanup -->
<g id="node10" class="node">
<title>cleanup</title>
<path fill="none" stroke="#1c2123" d="M269,-0.5C269,-0.5 406,-0.5 406,-0.5 412,-0.5 418,-6.5 418,-12.5 418,-12.5 418,-56.5 418,-56.5 418,-62.5 412,-68.5 406,-68.5 406,-68.5 269,-68.5 269,-68.5 263,-68.5 257,-62.5 257,-56.5 257,-56.5 257,-12.5 257,-12.5 257,-6.5 263,-0.5 269,-0.5"/>
<text text-anchor="start" x="265" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleanup</text>
<text text-anchor="start" x="265" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果lock的for_update_ts</text>
<text text-anchor="start" x="265" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 不为zero</text>
<text text-anchor="start" x="265" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则是悲观事务</text>
</g>
<!-- cleanup&#45;&gt;Lock__for_update_ts -->
<g id="edge10" class="edge">
<title>cleanup&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M418.18,-58.29C428.1,-63.75 437.4,-70.4 445,-78.5 517.98,-156.31 538.41,-288.92 543.98,-346.92"/>
<polygon fill="#666666" stroke="#666666" points="540.52,-347.52 544.88,-357.17 547.49,-346.91 540.52,-347.52"/>
</g>
<!-- rollback_lock -->
<g id="node17" class="node">
<title>rollback_lock</title>
<path fill="none" stroke="#1c2123" d="M580.5,-52.5C580.5,-52.5 513.5,-52.5 513.5,-52.5 507.5,-52.5 501.5,-46.5 501.5,-40.5 501.5,-40.5 501.5,-28.5 501.5,-28.5 501.5,-22.5 507.5,-16.5 513.5,-16.5 513.5,-16.5 580.5,-16.5 580.5,-16.5 586.5,-16.5 592.5,-22.5 592.5,-28.5 592.5,-28.5 592.5,-40.5 592.5,-40.5 592.5,-46.5 586.5,-52.5 580.5,-52.5"/>
<text text-anchor="middle" x="547" y="-30.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_lock</text>
</g>
<!-- cleanup&#45;&gt;rollback_lock -->
<g id="edge16" class="edge">
<title>cleanup&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M418.13,-34.5C442.5,-34.5 468.75,-34.5 491.09,-34.5"/>
<polygon fill="#666666" stroke="#666666" points="491.38,-38 501.38,-34.5 491.38,-31 491.38,-38"/>
</g>
<!-- MvccChecker__check_mvcc_key -->
<g id="node11" class="node">
<title>MvccChecker__check_mvcc_key</title>
<path fill="none" stroke="#1c2123" d="M426,-285.5C426,-285.5 249,-285.5 249,-285.5 243,-285.5 237,-279.5 237,-273.5 237,-273.5 237,-261.5 237,-261.5 237,-255.5 243,-249.5 249,-249.5 249,-249.5 426,-249.5 426,-249.5 432,-249.5 438,-255.5 438,-261.5 438,-261.5 438,-273.5 438,-273.5 438,-279.5 432,-285.5 426,-285.5"/>
<text text-anchor="middle" x="337.5" y="-263.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccChecker__check_mvcc_key</text>
</g>
<!-- MvccChecker__check_mvcc_key&#45;&gt;Lock__for_update_ts -->
<g id="edge11" class="edge">
<title>MvccChecker__check_mvcc_key&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M423.71,-285.56C431.06,-288.18 438.26,-291.14 445,-294.5 473.65,-308.77 501.67,-332.22 520.9,-350.23"/>
<polygon fill="#666666" stroke="#666666" points="518.68,-352.95 528.33,-357.32 523.52,-347.89 518.68,-352.95"/>
</g>
<!-- DeltaEntryPolicy__handle_lock -->
<g id="node12" class="node">
<title>DeltaEntryPolicy__handle_lock</title>
<path fill="none" stroke="#1c2123" d="M420.5,-231.5C420.5,-231.5 254.5,-231.5 254.5,-231.5 248.5,-231.5 242.5,-225.5 242.5,-219.5 242.5,-219.5 242.5,-207.5 242.5,-207.5 242.5,-201.5 248.5,-195.5 254.5,-195.5 254.5,-195.5 420.5,-195.5 420.5,-195.5 426.5,-195.5 432.5,-201.5 432.5,-207.5 432.5,-207.5 432.5,-219.5 432.5,-219.5 432.5,-225.5 426.5,-231.5 420.5,-231.5"/>
<text text-anchor="middle" x="337.5" y="-209.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">DeltaEntryPolicy__handle_lock</text>
</g>
<!-- DeltaEntryPolicy__handle_lock&#45;&gt;Lock__for_update_ts -->
<g id="edge12" class="edge">
<title>DeltaEntryPolicy__handle_lock&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M428.76,-231.56C434.45,-234.15 439.92,-237.11 445,-240.5 485.82,-267.74 516.49,-317.2 532.8,-348.1"/>
<polygon fill="#666666" stroke="#666666" points="529.72,-349.75 537.4,-357.04 535.94,-346.55 529.72,-349.75"/>
</g>
<!-- PessimisticRollback__process_write -->
<g id="node13" class="node">
<title>PessimisticRollback__process_write</title>
<path fill="none" stroke="#1c2123" d="M433,-177.5C433,-177.5 242,-177.5 242,-177.5 236,-177.5 230,-171.5 230,-165.5 230,-165.5 230,-153.5 230,-153.5 230,-147.5 236,-141.5 242,-141.5 242,-141.5 433,-141.5 433,-141.5 439,-141.5 445,-147.5 445,-153.5 445,-153.5 445,-165.5 445,-165.5 445,-171.5 439,-177.5 433,-177.5"/>
<text text-anchor="middle" x="337.5" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PessimisticRollback__process_write</text>
</g>
<!-- PessimisticRollback__process_write&#45;&gt;Lock__for_update_ts -->
<g id="edge13" class="edge">
<title>PessimisticRollback__process_write&#45;&gt;Lock__for_update_ts</title>
<path fill="none" stroke="#666666" d="M431.19,-177.63C436.07,-180.21 440.72,-183.15 445,-186.5 498.34,-228.25 526.9,-306.22 538.94,-347.76"/>
<polygon fill="#666666" stroke="#666666" points="535.6,-348.8 541.65,-357.5 542.34,-346.92 535.6,-348.8"/>
</g>
<!-- CheckTxnStatus__process_write -->
<g id="node15" class="node">
<title>CheckTxnStatus__process_write</title>
<path fill="none" stroke="#1c2123" d="M182,-123.5C182,-123.5 12,-123.5 12,-123.5 6,-123.5 0,-117.5 0,-111.5 0,-111.5 0,-99.5 0,-99.5 0,-93.5 6,-87.5 12,-87.5 12,-87.5 182,-87.5 182,-87.5 188,-87.5 194,-93.5 194,-99.5 194,-99.5 194,-111.5 194,-111.5 194,-117.5 188,-123.5 182,-123.5"/>
<text text-anchor="middle" x="97" y="-101.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus__process_write</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists -->
<g id="edge14" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="#666666" d="M194.32,-105.5C208.92,-105.5 224,-105.5 238.63,-105.5"/>
<polygon fill="#666666" stroke="#666666" points="238.68,-109 248.68,-105.5 238.68,-102 238.68,-109"/>
</g>
<!-- acquire_pessimistic_lock -->
<g id="node16" class="node">
<title>acquire_pessimistic_lock</title>
<path fill="none" stroke="#1c2123" d="M162,-663.5C162,-663.5 32,-663.5 32,-663.5 26,-663.5 20,-657.5 20,-651.5 20,-651.5 20,-639.5 20,-639.5 20,-633.5 26,-627.5 32,-627.5 32,-627.5 162,-627.5 162,-627.5 168,-627.5 174,-633.5 174,-639.5 174,-639.5 174,-651.5 174,-651.5 174,-657.5 168,-663.5 162,-663.5"/>
<text text-anchor="middle" x="97" y="-641.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">acquire_pessimistic_lock</text>
</g>
<!-- acquire_pessimistic_lock&#45;&gt;Lock__new -->
<g id="edge15" class="edge">
<title>acquire_pessimistic_lock&#45;&gt;Lock__new</title>
<path fill="none" stroke="#666666" d="M174.12,-645.5C211.15,-645.5 254.58,-645.5 287.21,-645.5"/>
<polygon fill="#666666" stroke="#666666" points="287.4,-649 297.4,-645.5 287.4,-642 287.4,-649"/>
</g>
</g>
</svg>
