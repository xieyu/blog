<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: ReadIndex Pages: 1 -->
<svg width="2016pt" height="594pt"
 viewBox="0.00 0.00 2016.00 594.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 590)">
<title>ReadIndex</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-590 2012,-590 2012,4 -4,4"/>
<!-- RawNode_read_index -->
<g id="node1" class="node">
<title>RawNode_read_index</title>
<path fill="none" stroke="#1c2123" d="M12,-374.5C12,-374.5 259,-374.5 259,-374.5 265,-374.5 271,-380.5 271,-386.5 271,-386.5 271,-461.5 271,-461.5 271,-467.5 265,-473.5 259,-473.5 259,-473.5 12,-473.5 12,-473.5 6,-473.5 0,-467.5 0,-461.5 0,-461.5 0,-386.5 0,-386.5 0,-380.5 6,-374.5 12,-374.5"/>
<text text-anchor="middle" x="135.5" y="-458.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode.read_index</text>
<polyline fill="none" stroke="#1c2123" points="0,-450.5 271,-450.5 "/>
<text text-anchor="start" x="8" y="-435.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub fn read_index(&amp;mut self, rctx: Vec&lt;u8&gt;) </text>
<text text-anchor="start" x="8" y="-420.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> app通过该接口发起read_index请求</text>
<polyline fill="none" stroke="#1c2123" points="0,-412.5 271,-412.5 "/>
<text text-anchor="start" x="8" y="-397.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">请求包含一个rctx</text>
<text text-anchor="start" x="8" y="-382.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> raft&#45;rs中会用它作为一个唯一的Id</text>
</g>
<!-- MsgReadIndex -->
<g id="node2" class="node">
<title>MsgReadIndex</title>
<path fill="#feed9b" stroke="#f7e495" d="M547,-378C547,-378 697,-378 697,-378 703,-378 709,-384 709,-390 709,-390 709,-458 709,-458 709,-464 703,-470 697,-470 697,-470 547,-470 547,-470 541,-470 535,-464 535,-458 535,-458 535,-390 535,-390 535,-384 541,-378 547,-378"/>
<text text-anchor="middle" x="622" y="-454.8" font-family="Times,serif" font-size="14.00" fill="#40575d">MsgReadIndex</text>
<polyline fill="none" stroke="#f7e495" points="535,-447 709,-447 "/>
<text text-anchor="start" x="543" y="-431.8" font-family="Times,serif" font-size="14.00" fill="#40575d">let mut e = Entry::default();</text>
<polyline fill="none" stroke="#f7e495" points="535,-424 709,-424 "/>
<text text-anchor="start" x="543" y="-408.8" font-family="Times,serif" font-size="14.00" fill="#40575d">e.data = rctx;</text>
<polyline fill="none" stroke="#f7e495" points="535,-401 709,-401 "/>
<text text-anchor="start" x="543" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.set_entries(vec![e].into());</text>
</g>
<!-- RawNode_read_index&#45;&gt;MsgReadIndex -->
<g id="edge1" class="edge">
<title>RawNode_read_index&#45;&gt;MsgReadIndex</title>
<path fill="none" stroke="#666666" d="M271.14,-424C351.64,-424 452.04,-424 524.61,-424"/>
<polygon fill="#666666" stroke="#666666" points="524.66,-427.5 534.66,-424 524.66,-420.5 524.66,-427.5"/>
</g>
<!-- rctx -->
<g id="node3" class="node">
<title>rctx</title>
<path fill="#feed9b" stroke="#f7e495" d="M319,-216.5C319,-216.5 487,-216.5 487,-216.5 493,-216.5 499,-222.5 499,-228.5 499,-228.5 499,-265.5 499,-265.5 499,-271.5 493,-277.5 487,-277.5 487,-277.5 319,-277.5 319,-277.5 313,-277.5 307,-271.5 307,-265.5 307,-265.5 307,-228.5 307,-228.5 307,-222.5 313,-216.5 319,-216.5"/>
<text text-anchor="middle" x="403" y="-262.3" font-family="Times,serif" font-size="14.00" fill="#40575d">rctx</text>
<polyline fill="none" stroke="#f7e495" points="307,-254.5 499,-254.5 "/>
<text text-anchor="start" x="315" y="-239.3" font-family="Times,serif" font-size="14.00" fill="#40575d">rctx: Vec&lt;u8&gt; app传过来的ctx</text>
<text text-anchor="start" x="315" y="-224.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 会被用作唯一id</text>
</g>
<!-- RawNode_read_index&#45;&gt;rctx -->
<g id="edge2" class="edge">
<title>RawNode_read_index&#45;&gt;rctx</title>
<path fill="none" stroke="#666666" d="M210.81,-374.46C254.17,-345.56 307.91,-309.72 347.37,-283.42"/>
<polygon fill="#666666" stroke="#666666" points="349.69,-286.08 356.07,-277.62 345.8,-280.26 349.69,-286.08"/>
</g>
<!-- step -->
<g id="node5" class="node">
<title>step</title>
<path fill="none" stroke="#1c2123" d="M637,-525C637,-525 607,-525 607,-525 601,-525 595,-519 595,-513 595,-513 595,-501 595,-501 595,-495 601,-489 607,-489 607,-489 637,-489 637,-489 643,-489 649,-495 649,-501 649,-501 649,-513 649,-513 649,-519 643,-525 637,-525"/>
<text text-anchor="middle" x="622" y="-503.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step</text>
</g>
<!-- RawNode_read_index&#45;&gt;step -->
<g id="edge3" class="edge">
<title>RawNode_read_index&#45;&gt;step</title>
<path fill="none" stroke="#666666" d="M271.14,-447.06C377.51,-465.29 518.62,-489.46 584.37,-500.72"/>
<polygon fill="#666666" stroke="#666666" points="584.18,-504.24 594.63,-502.48 585.37,-497.34 584.18,-504.24"/>
</g>
<!-- step_follower -->
<g id="node4" class="node">
<title>step_follower</title>
<path fill="none" stroke="#1c2123" d="M757,-495C757,-495 928,-495 928,-495 934,-495 940,-501 940,-507 940,-507 940,-529 940,-529 940,-535 934,-541 928,-541 928,-541 757,-541 757,-541 751,-541 745,-535 745,-529 745,-529 745,-507 745,-507 745,-501 751,-495 757,-495"/>
<text text-anchor="middle" x="842.5" y="-525.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_follower</text>
<polyline fill="none" stroke="#1c2123" points="745,-518 940,-518 "/>
<text text-anchor="start" x="753" y="-502.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">follower将该消息发送给leader</text>
</g>
<!-- MsgReadIndex&#45;&gt;step_follower -->
<g id="edge6" class="edge">
<title>MsgReadIndex&#45;&gt;step_follower</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M709.31,-468.94C721.18,-474.59 733.31,-480.11 745,-485 750.1,-487.14 755.4,-489.24 760.76,-491.3"/>
<polygon fill="green" stroke="green" points="759.88,-494.7 770.47,-494.93 762.33,-488.15 759.88,-494.7"/>
</g>
<!-- step_leader -->
<g id="node6" class="node">
<title>step_leader</title>
<path fill="none" stroke="#1c2123" d="M869.5,-476C869.5,-476 815.5,-476 815.5,-476 809.5,-476 803.5,-470 803.5,-464 803.5,-464 803.5,-452 803.5,-452 803.5,-446 809.5,-440 815.5,-440 815.5,-440 869.5,-440 869.5,-440 875.5,-440 881.5,-446 881.5,-452 881.5,-452 881.5,-464 881.5,-464 881.5,-470 875.5,-476 869.5,-476"/>
<text text-anchor="middle" x="842.5" y="-454.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_leader</text>
</g>
<!-- MsgReadIndex&#45;&gt;step_leader -->
<g id="edge7" class="edge">
<title>MsgReadIndex&#45;&gt;step_leader</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M709.04,-437.39C737.67,-441.84 768.54,-446.65 793.26,-450.49"/>
<polygon fill="green" stroke="green" points="793.04,-454 803.46,-452.08 794.11,-447.08 793.04,-454"/>
</g>
<!-- rctx&#45;&gt;MsgReadIndex -->
<g id="edge19" class="edge">
<title>rctx&#45;&gt;MsgReadIndex</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M441.8,-277.83C473.43,-303.63 519.25,-341.01 556.65,-371.51"/>
<polygon fill="green" stroke="green" points="554.53,-374.3 564.49,-377.91 558.95,-368.87 554.53,-374.3"/>
</g>
<!-- MsgReadIndexResp -->
<g id="node10" class="node">
<title>MsgReadIndexResp</title>
<path fill="#feed9b" stroke="#f7e495" d="M1720.5,-408C1720.5,-408 1858.5,-408 1858.5,-408 1864.5,-408 1870.5,-414 1870.5,-420 1870.5,-420 1870.5,-442 1870.5,-442 1870.5,-448 1864.5,-454 1858.5,-454 1858.5,-454 1720.5,-454 1720.5,-454 1714.5,-454 1708.5,-448 1708.5,-442 1708.5,-442 1708.5,-420 1708.5,-420 1708.5,-414 1714.5,-408 1720.5,-408"/>
<text text-anchor="middle" x="1789.5" y="-438.8" font-family="Times,serif" font-size="14.00" fill="#40575d">MsgReadIndexResp</text>
<polyline fill="none" stroke="#f7e495" points="1708.5,-431 1870.5,-431 "/>
<text text-anchor="start" x="1716.5" y="-415.8" font-family="Times,serif" font-size="14.00" fill="#40575d">否则发送消息给follower</text>
</g>
<!-- rctx&#45;&gt;MsgReadIndexResp -->
<g id="edge11" class="edge">
<title>rctx&#45;&gt;MsgReadIndexResp</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M499.12,-274.3C587.15,-297.13 722.06,-326 841.5,-326 841.5,-326 841.5,-326 1070,-326 1231.55,-326 1275.05,-311.07 1433,-345 1449.78,-348.61 1452.58,-353.99 1469,-359 1545.14,-382.24 1633.56,-401.6 1698.06,-414.37"/>
<polygon fill="green" stroke="green" points="1697.71,-417.86 1708.2,-416.36 1699.06,-411 1697.71,-417.86"/>
</g>
<!-- bcast_heartbeat_with_ctx -->
<g id="node16" class="node">
<title>bcast_heartbeat_with_ctx</title>
<path fill="none" stroke="#1c2123" d="M1481.5,-93.5C1481.5,-93.5 1612.5,-93.5 1612.5,-93.5 1618.5,-93.5 1624.5,-99.5 1624.5,-105.5 1624.5,-105.5 1624.5,-172.5 1624.5,-172.5 1624.5,-178.5 1618.5,-184.5 1612.5,-184.5 1612.5,-184.5 1481.5,-184.5 1481.5,-184.5 1475.5,-184.5 1469.5,-178.5 1469.5,-172.5 1469.5,-172.5 1469.5,-105.5 1469.5,-105.5 1469.5,-99.5 1475.5,-93.5 1481.5,-93.5"/>
<text text-anchor="middle" x="1547" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">bcast_heartbeat_with_ctx</text>
<polyline fill="none" stroke="#1c2123" points="1469.5,-161.5 1624.5,-161.5 "/>
<text text-anchor="start" x="1477.5" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送心跳信息</text>
<text text-anchor="start" x="1477.5" y="-131.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会将rctx带上</text>
<text text-anchor="start" x="1477.5" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower heartbeat resp</text>
<text text-anchor="start" x="1477.5" y="-101.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会将该信息带上</text>
</g>
<!-- rctx&#45;&gt;bcast_heartbeat_with_ctx -->
<g id="edge20" class="edge">
<title>rctx&#45;&gt;bcast_heartbeat_with_ctx</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M499.03,-218.32C587,-194.33 721.86,-164 841.5,-164 841.5,-164 841.5,-164 1070,-164 1206.13,-164 1363.87,-153.68 1459.22,-146.3"/>
<polygon fill="green" stroke="green" points="1459.7,-149.77 1469.39,-145.5 1459.15,-142.79 1459.7,-149.77"/>
</g>
<!-- pending_read_index -->
<g id="node19" class="node">
<title>pending_read_index</title>
<path fill="#feed9b" stroke="#f7e495" d="M1683.5,-186.5C1683.5,-186.5 1895.5,-186.5 1895.5,-186.5 1901.5,-186.5 1907.5,-192.5 1907.5,-198.5 1907.5,-198.5 1907.5,-243.5 1907.5,-243.5 1907.5,-249.5 1901.5,-255.5 1895.5,-255.5 1895.5,-255.5 1683.5,-255.5 1683.5,-255.5 1677.5,-255.5 1671.5,-249.5 1671.5,-243.5 1671.5,-243.5 1671.5,-198.5 1671.5,-198.5 1671.5,-192.5 1677.5,-186.5 1683.5,-186.5"/>
<text text-anchor="middle" x="1789.5" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#40575d">pending_read_index</text>
<polyline fill="none" stroke="#f7e495" points="1671.5,-232.5 1907.5,-232.5 "/>
<text text-anchor="middle" x="1789.5" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#40575d">HashMap&lt;Vec&lt;u8&gt;, ReadIndexStatus&gt;</text>
<polyline fill="none" stroke="#f7e495" points="1671.5,-209.5 1907.5,-209.5 "/>
<text text-anchor="start" x="1679.5" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#40575d">其中key为rctx</text>
</g>
<!-- rctx&#45;&gt;pending_read_index -->
<g id="edge31" class="edge">
<title>rctx&#45;&gt;pending_read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M445.97,-216.33C521.22,-164.46 685.81,-65 841.5,-65 841.5,-65 841.5,-65 1316.5,-65 1453.87,-65 1506.22,-14.98 1625,-84 1650.26,-98.68 1640.26,-118.42 1661,-139 1676.8,-154.67 1696.07,-168.94 1714.79,-181.01"/>
<polygon fill="green" stroke="green" points="1713.02,-184.03 1723.35,-186.41 1716.75,-178.11 1713.02,-184.03"/>
</g>
<!-- read_index_queue -->
<g id="node20" class="node">
<title>read_index_queue</title>
<path fill="#feed9b" stroke="#f7e495" d="M1673,-0.5C1673,-0.5 1906,-0.5 1906,-0.5 1912,-0.5 1918,-6.5 1918,-12.5 1918,-12.5 1918,-117.5 1918,-117.5 1918,-123.5 1912,-129.5 1906,-129.5 1906,-129.5 1673,-129.5 1673,-129.5 1667,-129.5 1661,-123.5 1661,-117.5 1661,-117.5 1661,-12.5 1661,-12.5 1661,-6.5 1667,-0.5 1673,-0.5"/>
<text text-anchor="middle" x="1789.5" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#40575d">read_index_queue</text>
<polyline fill="none" stroke="#f7e495" points="1661,-106.5 1918,-106.5 "/>
<text text-anchor="start" x="1669" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#40575d">VecDeque&lt;Vec&lt;u8&gt;&gt;</text>
<text text-anchor="start" x="1669" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 里面元素为rctx</text>
<polyline fill="none" stroke="#f7e495" points="1661,-68.5 1918,-68.5 "/>
<text text-anchor="start" x="1669" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#40575d">将只读请求维护为一个只读队列</text>
<text text-anchor="start" x="1669" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 该队列中commit index是有序递增的</text>
<text text-anchor="start" x="1669" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 如果队列中某个元素i对应commit index</text>
<text text-anchor="start" x="1669" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 得到确认，那么之前的也会被确认</text>
</g>
<!-- rctx&#45;&gt;read_index_queue -->
<g id="edge33" class="edge">
<title>rctx&#45;&gt;read_index_queue</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M419.75,-216.22C440.69,-178.61 481.4,-116.04 535,-84 653.92,-12.9 702.94,-27 841.5,-27 841.5,-27 841.5,-27 1316.5,-27 1453.82,-27 1488.25,-31.47 1625,-44 1633.49,-44.78 1642.22,-45.66 1651.01,-46.61"/>
<polygon fill="green" stroke="green" points="1650.64,-50.09 1660.96,-47.71 1651.41,-43.13 1650.64,-50.09"/>
</g>
<!-- step&#45;&gt;step_follower -->
<g id="edge4" class="edge">
<title>step&#45;&gt;step_follower</title>
<path fill="none" stroke="#666666" d="M649.36,-508.33C670.86,-509.41 702.77,-511.02 734.43,-512.61"/>
<polygon fill="#666666" stroke="#666666" points="734.53,-516.12 744.69,-513.13 734.88,-509.13 734.53,-516.12"/>
</g>
<!-- step&#45;&gt;step_leader -->
<g id="edge5" class="edge">
<title>step&#45;&gt;step_leader</title>
<path fill="none" stroke="#666666" d="M649.36,-501.09C684.95,-493.11 749.02,-478.74 793.33,-468.8"/>
<polygon fill="#666666" stroke="#666666" points="794.31,-472.17 803.3,-466.57 792.78,-465.34 794.31,-472.17"/>
</g>
<!-- prs_is_singleton -->
<g id="node7" class="node">
<title>prs_is_singleton</title>
<path fill="none" stroke="#1c2123" d="M988,-447C988,-447 1150,-447 1150,-447 1156,-447 1162,-453 1162,-459 1162,-459 1162,-481 1162,-481 1162,-487 1156,-493 1150,-493 1150,-493 988,-493 988,-493 982,-493 976,-487 976,-481 976,-481 976,-459 976,-459 976,-453 982,-447 988,-447"/>
<text text-anchor="middle" x="1069" y="-477.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">prs_is_singleton</text>
<polyline fill="none" stroke="#1c2123" points="976,-470 1162,-470 "/>
<text text-anchor="start" x="984" y="-454.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">当只有一个voting member时</text>
</g>
<!-- step_leader&#45;&gt;prs_is_singleton -->
<g id="edge13" class="edge">
<title>step_leader&#45;&gt;prs_is_singleton</title>
<path fill="none" stroke="#666666" d="M881.58,-460.04C904.85,-461.28 935.81,-462.93 965.8,-464.54"/>
<polygon fill="#666666" stroke="#666666" points="965.75,-468.04 975.93,-465.08 966.13,-461.05 965.75,-468.04"/>
</g>
<!-- handle_ready_read_index -->
<g id="node9" class="node">
<title>handle_ready_read_index</title>
<path fill="none" stroke="#1c2123" d="M1613,-488C1613,-488 1481,-488 1481,-488 1475,-488 1469,-482 1469,-476 1469,-476 1469,-464 1469,-464 1469,-458 1475,-452 1481,-452 1481,-452 1613,-452 1613,-452 1619,-452 1625,-458 1625,-464 1625,-464 1625,-476 1625,-476 1625,-482 1619,-488 1613,-488"/>
<text text-anchor="middle" x="1547" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_ready_read_index</text>
</g>
<!-- step_leader&#45;&gt;handle_ready_read_index -->
<g id="edge14" class="edge">
<title>step_leader&#45;&gt;handle_ready_read_index</title>
<path fill="none" stroke="#666666" d="M881.55,-467.07C899.51,-471.74 921.09,-477.95 940,-485 956.58,-491.18 958.73,-498.13 976,-502 1143.81,-539.63 1346,-511.55 1458.87,-489.55"/>
<polygon fill="#666666" stroke="#666666" points="1459.71,-492.95 1468.84,-487.57 1458.35,-486.08 1459.71,-492.95"/>
</g>
<!-- commit_to_current_term -->
<g id="node12" class="node">
<title>commit_to_current_term</title>
<path fill="none" stroke="#1c2123" d="M1134,-586C1134,-586 1004,-586 1004,-586 998,-586 992,-580 992,-574 992,-574 992,-562 992,-562 992,-556 998,-550 1004,-550 1004,-550 1134,-550 1134,-550 1140,-550 1146,-556 1146,-562 1146,-562 1146,-574 1146,-574 1146,-580 1140,-586 1134,-586"/>
<text text-anchor="middle" x="1069" y="-564.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit_to_current_term</text>
</g>
<!-- step_leader&#45;&gt;commit_to_current_term -->
<g id="edge15" class="edge">
<title>step_leader&#45;&gt;commit_to_current_term</title>
<path fill="none" stroke="#666666" d="M881.83,-462.57C900.67,-466.28 922.94,-472.96 940,-485 962.67,-501 953.84,-519.31 976,-536 980.67,-539.52 985.76,-542.67 991.07,-545.49"/>
<polygon fill="#666666" stroke="#666666" points="989.66,-548.7 1000.18,-549.93 992.72,-542.4 989.66,-548.7"/>
</g>
<!-- read_only_option -->
<g id="node13" class="node">
<title>read_only_option</title>
<path fill="#feed9b" stroke="#f7e495" d="M1025,-392C1025,-392 1113,-392 1113,-392 1119,-392 1125,-398 1125,-404 1125,-404 1125,-416 1125,-416 1125,-422 1119,-428 1113,-428 1113,-428 1025,-428 1025,-428 1019,-428 1013,-422 1013,-416 1013,-416 1013,-404 1013,-404 1013,-398 1019,-392 1025,-392"/>
<text text-anchor="middle" x="1069" y="-406.3" font-family="Times,serif" font-size="14.00" fill="#40575d">read_only_option</text>
</g>
<!-- step_leader&#45;&gt;read_only_option -->
<g id="edge16" class="edge">
<title>step_leader&#45;&gt;read_only_option</title>
<path fill="none" stroke="#666666" d="M881.58,-449.86C914.8,-442.76 963.69,-432.3 1003.07,-423.88"/>
<polygon fill="#666666" stroke="#666666" points="1003.82,-427.3 1012.87,-421.79 1002.35,-420.46 1003.82,-427.3"/>
</g>
<!-- prs_is_singleton&#45;&gt;handle_ready_read_index -->
<g id="edge12" class="edge">
<title>prs_is_singleton&#45;&gt;handle_ready_read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1162.06,-470C1247.76,-470 1374.58,-470 1458.71,-470"/>
<polygon fill="green" stroke="green" points="1458.76,-473.5 1468.76,-470 1458.76,-466.5 1458.76,-473.5"/>
</g>
<!-- raft_log_committed -->
<g id="node8" class="node">
<title>raft_log_committed</title>
<path fill="#feed9b" stroke="#f7e495" d="M1211,-355C1211,-355 1420,-355 1420,-355 1426,-355 1432,-361 1432,-367 1432,-367 1432,-389 1432,-389 1432,-395 1426,-401 1420,-401 1420,-401 1211,-401 1211,-401 1205,-401 1199,-395 1199,-389 1199,-389 1199,-367 1199,-367 1199,-361 1205,-355 1211,-355"/>
<text text-anchor="middle" x="1315.5" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#40575d">raft_log_committed</text>
<polyline fill="none" stroke="#f7e495" points="1199,-378 1432,-378 "/>
<text text-anchor="middle" x="1315.5" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#40575d">raft_log.committed 已committed index</text>
</g>
<!-- raft_log_committed&#45;&gt;handle_ready_read_index -->
<g id="edge8" class="edge">
<title>raft_log_committed&#45;&gt;handle_ready_read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1405.96,-401.04C1415.19,-404.1 1424.35,-407.43 1433,-411 1449.92,-417.99 1452.83,-422.42 1469,-431 1479.13,-436.38 1490.1,-442.03 1500.48,-447.31"/>
<polygon fill="green" stroke="green" points="1498.92,-450.44 1509.43,-451.83 1502.08,-444.2 1498.92,-450.44"/>
</g>
<!-- ReadIndexStatus -->
<g id="node23" class="node">
<title>ReadIndexStatus</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M1482,-258C1482,-258 1612,-258 1612,-258 1618,-258 1624,-264 1624,-270 1624,-270 1624,-338 1624,-338 1624,-344 1618,-350 1612,-350 1612,-350 1482,-350 1482,-350 1476,-350 1470,-344 1470,-338 1470,-338 1470,-270 1470,-270 1470,-264 1476,-258 1482,-258"/>
<text text-anchor="middle" x="1547" y="-334.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReadIndexStatus</text>
<polyline fill="none" stroke="#60b5ac" points="1470,-327 1624,-327 "/>
<text text-anchor="start" x="1478" y="-311.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub req: Message</text>
<polyline fill="none" stroke="#60b5ac" points="1470,-304 1624,-304 "/>
<text text-anchor="start" x="1478" y="-288.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub index: u64</text>
<polyline fill="none" stroke="#60b5ac" points="1470,-281 1624,-281 "/>
<text text-anchor="start" x="1478" y="-265.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub acks: HashSet&lt;u64&gt;</text>
</g>
<!-- raft_log_committed&#45;&gt;ReadIndexStatus -->
<g id="edge29" class="edge">
<title>raft_log_committed&#45;&gt;ReadIndexStatus</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1387.86,-354.99C1410.76,-347.61 1436.36,-339.35 1460.18,-331.67"/>
<polygon fill="green" stroke="green" points="1461.47,-334.93 1469.91,-328.53 1459.32,-328.27 1461.47,-334.93"/>
</g>
<!-- handle_ready_read_index&#45;&gt;MsgReadIndexResp -->
<g id="edge9" class="edge">
<title>handle_ready_read_index&#45;&gt;MsgReadIndexResp</title>
<path fill="none" stroke="#666666" d="M1625.09,-457.5C1648.29,-453.74 1673.96,-449.57 1697.96,-445.68"/>
<polygon fill="#666666" stroke="#666666" points="1698.81,-449.09 1708.12,-444.03 1697.69,-442.18 1698.81,-449.09"/>
</g>
<!-- read_states -->
<g id="node11" class="node">
<title>read_states</title>
<path fill="#feed9b" stroke="#f7e495" d="M1687,-473C1687,-473 1892,-473 1892,-473 1898,-473 1904,-479 1904,-485 1904,-485 1904,-537 1904,-537 1904,-543 1898,-549 1892,-549 1892,-549 1687,-549 1687,-549 1681,-549 1675,-543 1675,-537 1675,-537 1675,-485 1675,-485 1675,-479 1681,-473 1687,-473"/>
<text text-anchor="middle" x="1789.5" y="-533.8" font-family="Times,serif" font-size="14.00" fill="#40575d">read_states</text>
<polyline fill="none" stroke="#f7e495" points="1675,-526 1904,-526 "/>
<text text-anchor="start" x="1683" y="-510.8" font-family="Times,serif" font-size="14.00" fill="#40575d">self.read_states.push(rs)</text>
<text text-anchor="start" x="1683" y="-495.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 如果是leader节点发送的ReadIndex</text>
<text text-anchor="middle" x="1789.5" y="-480.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 则push到Leader自己的read_states中</text>
</g>
<!-- handle_ready_read_index&#45;&gt;read_states -->
<g id="edge10" class="edge">
<title>handle_ready_read_index&#45;&gt;read_states</title>
<path fill="none" stroke="#666666" d="M1625.09,-483.14C1637.68,-485.29 1651,-487.56 1664.38,-489.84"/>
<polygon fill="#666666" stroke="#666666" points="1664.17,-493.35 1674.62,-491.59 1665.35,-486.45 1664.17,-493.35"/>
</g>
<!-- send -->
<g id="node18" class="node">
<title>send</title>
<path fill="none" stroke="#1c2123" d="M1996,-423C1996,-423 1966,-423 1966,-423 1960,-423 1954,-417 1954,-411 1954,-411 1954,-399 1954,-399 1954,-393 1960,-387 1966,-387 1966,-387 1996,-387 1996,-387 2002,-387 2008,-393 2008,-399 2008,-399 2008,-411 2008,-411 2008,-417 2002,-423 1996,-423"/>
<text text-anchor="middle" x="1981" y="-401.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">send</text>
</g>
<!-- MsgReadIndexResp&#45;&gt;send -->
<g id="edge25" class="edge">
<title>MsgReadIndexResp&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1870.59,-420.01C1896.17,-416.5 1923.21,-412.79 1944.01,-409.94"/>
<polygon fill="green" stroke="green" points="1944.55,-413.4 1953.98,-408.57 1943.59,-406.46 1944.55,-413.4"/>
</g>
<!-- ReadOnlyOption_Safe -->
<g id="node14" class="node">
<title>ReadOnlyOption_Safe</title>
<path fill="none" stroke="#1c2123" d="M1373.5,-232C1373.5,-232 1257.5,-232 1257.5,-232 1251.5,-232 1245.5,-226 1245.5,-220 1245.5,-220 1245.5,-208 1245.5,-208 1245.5,-202 1251.5,-196 1257.5,-196 1257.5,-196 1373.5,-196 1373.5,-196 1379.5,-196 1385.5,-202 1385.5,-208 1385.5,-208 1385.5,-220 1385.5,-220 1385.5,-226 1379.5,-232 1373.5,-232"/>
<text text-anchor="middle" x="1315.5" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadOnlyOption_Safe</text>
</g>
<!-- read_only_option&#45;&gt;ReadOnlyOption_Safe -->
<g id="edge17" class="edge">
<title>read_only_option&#45;&gt;ReadOnlyOption_Safe</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1088.27,-391.87C1107.85,-371.89 1139.19,-338.29 1162,-306 1181.05,-279.03 1171.64,-260.89 1198,-241 1209,-232.7 1222.13,-226.89 1235.55,-222.83"/>
<polygon fill="green" stroke="green" points="1236.6,-226.17 1245.34,-220.18 1234.77,-219.42 1236.6,-226.17"/>
</g>
<!-- ReadOnlyOption_LeaseBased -->
<g id="node15" class="node">
<title>ReadOnlyOption_LeaseBased</title>
<path fill="none" stroke="#1c2123" d="M1393.5,-456C1393.5,-456 1237.5,-456 1237.5,-456 1231.5,-456 1225.5,-450 1225.5,-444 1225.5,-444 1225.5,-432 1225.5,-432 1225.5,-426 1231.5,-420 1237.5,-420 1237.5,-420 1393.5,-420 1393.5,-420 1399.5,-420 1405.5,-426 1405.5,-432 1405.5,-432 1405.5,-444 1405.5,-444 1405.5,-450 1399.5,-456 1393.5,-456"/>
<text text-anchor="middle" x="1315.5" y="-434.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadOnlyOption_LeaseBased</text>
</g>
<!-- read_only_option&#45;&gt;ReadOnlyOption_LeaseBased -->
<g id="edge18" class="edge">
<title>read_only_option&#45;&gt;ReadOnlyOption_LeaseBased</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1125.18,-416.32C1151.75,-419.36 1184.45,-423.11 1215.15,-426.62"/>
<polygon fill="green" stroke="green" points="1215.14,-430.14 1225.47,-427.8 1215.93,-423.19 1215.14,-430.14"/>
</g>
<!-- ReadOnlyOption_Safe&#45;&gt;bcast_heartbeat_with_ctx -->
<g id="edge21" class="edge">
<title>ReadOnlyOption_Safe&#45;&gt;bcast_heartbeat_with_ctx</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1376.18,-195.97C1394.46,-190.34 1414.59,-184.02 1433,-178 1441.62,-175.18 1450.59,-172.19 1459.54,-169.16"/>
<polygon fill="green" stroke="green" points="1460.88,-172.41 1469.22,-165.88 1458.63,-165.78 1460.88,-172.41"/>
</g>
<!-- add_request -->
<g id="node17" class="node">
<title>add_request</title>
<path fill="none" stroke="#1c2123" d="M1576,-239C1576,-239 1518,-239 1518,-239 1512,-239 1506,-233 1506,-227 1506,-227 1506,-215 1506,-215 1506,-209 1512,-203 1518,-203 1518,-203 1576,-203 1576,-203 1582,-203 1588,-209 1588,-215 1588,-215 1588,-227 1588,-227 1588,-233 1582,-239 1576,-239"/>
<text text-anchor="middle" x="1547" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">add_request</text>
</g>
<!-- ReadOnlyOption_Safe&#45;&gt;add_request -->
<g id="edge22" class="edge">
<title>ReadOnlyOption_Safe&#45;&gt;add_request</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1385.67,-216.11C1421.16,-217.19 1463.59,-218.49 1495.89,-219.47"/>
<polygon fill="green" stroke="green" points="1495.9,-222.97 1506,-219.78 1496.11,-215.98 1495.9,-222.97"/>
</g>
<!-- ReadOnlyOption_LeaseBased&#45;&gt;handle_ready_read_index -->
<g id="edge23" class="edge">
<title>ReadOnlyOption_LeaseBased&#45;&gt;handle_ready_read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1405.56,-450.42C1423.04,-452.86 1441.37,-455.41 1458.79,-457.84"/>
<polygon fill="green" stroke="green" points="1458.54,-461.34 1468.93,-459.25 1459.51,-454.41 1458.54,-461.34"/>
</g>
<!-- ReadOnlyOption_LeaseBased&#45;&gt;send -->
<g id="edge24" class="edge">
<title>ReadOnlyOption_LeaseBased&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1405.84,-424.76C1475.24,-415.16 1573.99,-403.03 1661,-398 1775.03,-391.4 1803.96,-391.58 1918,-398 1926.38,-398.47 1935.37,-399.3 1943.83,-400.22"/>
<polygon fill="green" stroke="green" points="1943.47,-403.71 1953.81,-401.38 1944.28,-396.75 1943.47,-403.71"/>
</g>
<!-- add_request&#45;&gt;pending_read_index -->
<g id="edge26" class="edge">
<title>add_request&#45;&gt;pending_read_index</title>
<path fill="none" stroke="#666666" d="M1588.25,-221C1608.65,-221 1634.66,-221 1661.14,-221"/>
<polygon fill="#666666" stroke="#666666" points="1661.29,-224.5 1671.29,-221 1661.29,-217.5 1661.29,-224.5"/>
</g>
<!-- add_request&#45;&gt;read_index_queue -->
<g id="edge27" class="edge">
<title>add_request&#45;&gt;read_index_queue</title>
<path fill="none" stroke="#666666" d="M1588.25,-209.68C1600.42,-205.53 1613.58,-200.28 1625,-194 1654.29,-177.9 1683.74,-156.61 1709.43,-135.97"/>
<polygon fill="#666666" stroke="#666666" points="1711.72,-138.62 1717.27,-129.59 1707.3,-133.19 1711.72,-138.62"/>
</g>
<!-- self_id -->
<g id="node21" class="node">
<title>self_id</title>
<path fill="#feed9b" stroke="#f7e495" d="M1001.5,-251C1001.5,-251 1136.5,-251 1136.5,-251 1142.5,-251 1148.5,-257 1148.5,-263 1148.5,-263 1148.5,-285 1148.5,-285 1148.5,-291 1142.5,-297 1136.5,-297 1136.5,-297 1001.5,-297 1001.5,-297 995.5,-297 989.5,-291 989.5,-285 989.5,-285 989.5,-263 989.5,-263 989.5,-257 995.5,-251 1001.5,-251"/>
<text text-anchor="middle" x="1069" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#40575d">self_id</text>
<polyline fill="none" stroke="#f7e495" points="989.5,-274 1148.5,-274 "/>
<text text-anchor="start" x="997.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#40575d">leader自己先加入acks中</text>
</g>
<!-- acks -->
<g id="node22" class="node">
<title>acks</title>
<path fill="#feed9b" stroke="#f7e495" d="M1210,-251C1210,-251 1421,-251 1421,-251 1427,-251 1433,-257 1433,-263 1433,-263 1433,-285 1433,-285 1433,-291 1427,-297 1421,-297 1421,-297 1210,-297 1210,-297 1204,-297 1198,-291 1198,-285 1198,-285 1198,-263 1198,-263 1198,-257 1204,-251 1210,-251"/>
<text text-anchor="middle" x="1315.5" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#40575d">acks</text>
<polyline fill="none" stroke="#f7e495" points="1198,-274 1433,-274 "/>
<text text-anchor="middle" x="1315.5" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#40575d">HasSet&lt;u64&gt; 记录Followers心跳响应</text>
</g>
<!-- self_id&#45;&gt;acks -->
<g id="edge28" class="edge">
<title>self_id&#45;&gt;acks</title>
<path fill="none" stroke="#666666" d="M1148.71,-274C1161.17,-274 1174.32,-274 1187.55,-274"/>
<polygon fill="#666666" stroke="#666666" points="1187.67,-277.5 1197.67,-274 1187.67,-270.5 1187.67,-277.5"/>
</g>
<!-- acks&#45;&gt;ReadIndexStatus -->
<g id="edge30" class="edge">
<title>acks&#45;&gt;ReadIndexStatus</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1433.27,-289.26C1442.18,-290.43 1451.08,-291.59 1459.74,-292.72"/>
<polygon fill="green" stroke="green" points="1459.43,-296.21 1469.8,-294.04 1460.34,-289.27 1459.43,-296.21"/>
</g>
<!-- ReadIndexStatus&#45;&gt;pending_read_index -->
<g id="edge32" class="edge">
<title>ReadIndexStatus&#45;&gt;pending_read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1624.1,-277.74C1641.44,-271.75 1660.21,-265.28 1678.64,-258.91"/>
<polygon fill="green" stroke="green" points="1679.94,-262.17 1688.25,-255.6 1677.65,-255.55 1679.94,-262.17"/>
</g>
</g>
</svg>
