<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: peer__on_ready_prepare_merge Pages: 1 -->
<svg width="1660pt" height="736pt"
 viewBox="0.00 0.00 1660.00 735.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 731.5)">
<title>peer__on_ready_prepare_merge</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-731.5 1656,-731.5 1656,4 -4,4"/>
<!-- PeerFsmDelegate__on_ready_prepare_merge -->
<g id="node1" class="node">
<title>PeerFsmDelegate__on_ready_prepare_merge</title>
<path fill="none" stroke="#1c2123" d="M217,-214C217,-214 362,-214 362,-214 368,-214 374,-220 374,-226 374,-226 374,-278 374,-278 374,-284 368,-290 362,-290 362,-290 217,-290 217,-290 211,-290 205,-284 205,-278 205,-278 205,-226 205,-226 205,-220 211,-214 217,-214"/>
<text text-anchor="start" x="213" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="213" y="-259.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_ready_prepare_merge</text>
<polyline fill="none" stroke="#1c2123" points="205,-252 374,-252 "/>
<text text-anchor="start" x="213" y="-236.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">比CatchUpLogs消息</text>
<text text-anchor="start" x="213" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先执行PrepareMerge消息</text>
</g>
<!-- StoreMeta__set_region -->
<g id="node2" class="node">
<title>StoreMeta__set_region</title>
<path fill="none" stroke="#1c2123" d="M422,-214C422,-214 560,-214 560,-214 566,-214 572,-220 572,-226 572,-226 572,-278 572,-278 572,-284 566,-290 560,-290 560,-290 422,-290 422,-290 416,-290 410,-284 410,-278 410,-278 410,-226 410,-226 410,-220 416,-214 422,-214"/>
<text text-anchor="start" x="418" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">StoreMeta</text>
<text text-anchor="start" x="418" y="-259.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_region</text>
<polyline fill="none" stroke="#1c2123" points="410,-252 572,-252 "/>
<text text-anchor="start" x="418" y="-236.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">不知道这个地方</text>
<text text-anchor="start" x="418" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_region的作用是什么</text>
</g>
<!-- PeerFsmDelegate__on_ready_prepare_merge&#45;&gt;StoreMeta__set_region -->
<g id="edge1" class="edge">
<title>PeerFsmDelegate__on_ready_prepare_merge&#45;&gt;StoreMeta__set_region</title>
<path fill="none" stroke="#666666" d="M374.24,-252C382.75,-252 391.41,-252 399.98,-252"/>
<polygon fill="#666666" stroke="#666666" points="399.98,-255.5 409.98,-252 399.98,-248.5 399.98,-255.5"/>
</g>
<!-- PeerFsmDelegate__on_check_merge -->
<g id="node3" class="node">
<title>PeerFsmDelegate__on_check_merge</title>
<path fill="none" stroke="#1c2123" d="M441.5,-338C441.5,-338 540.5,-338 540.5,-338 546.5,-338 552.5,-344 552.5,-350 552.5,-350 552.5,-402 552.5,-402 552.5,-408 546.5,-414 540.5,-414 540.5,-414 441.5,-414 441.5,-414 435.5,-414 429.5,-408 429.5,-402 429.5,-402 429.5,-350 429.5,-350 429.5,-344 435.5,-338 441.5,-338"/>
<text text-anchor="start" x="437.5" y="-398.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="437.5" y="-383.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_check_merge</text>
<polyline fill="none" stroke="#1c2123" points="429.5,-376 552.5,-376 "/>
<text text-anchor="start" x="437.5" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">schedule_merge</text>
<text text-anchor="start" x="437.5" y="-345.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后不断的check</text>
</g>
<!-- PeerFsmDelegate__on_ready_prepare_merge&#45;&gt;PeerFsmDelegate__on_check_merge -->
<g id="edge2" class="edge">
<title>PeerFsmDelegate__on_ready_prepare_merge&#45;&gt;PeerFsmDelegate__on_check_merge</title>
<path fill="none" stroke="#666666" d="M351.71,-290.05C373.45,-303.56 398.08,-318.87 420.46,-332.78"/>
<polygon fill="#666666" stroke="#666666" points="418.91,-335.93 429.25,-338.24 422.6,-329.99 418.91,-335.93"/>
</g>
<!-- PeerFsmDelegate__register_merge_check_tick -->
<g id="node4" class="node">
<title>PeerFsmDelegate__register_merge_check_tick</title>
<path fill="none" stroke="#1c2123" d="M620,-511.5C620,-511.5 763,-511.5 763,-511.5 769,-511.5 775,-517.5 775,-523.5 775,-523.5 775,-560.5 775,-560.5 775,-566.5 769,-572.5 763,-572.5 763,-572.5 620,-572.5 620,-572.5 614,-572.5 608,-566.5 608,-560.5 608,-560.5 608,-523.5 608,-523.5 608,-517.5 614,-511.5 620,-511.5"/>
<text text-anchor="start" x="616" y="-557.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="middle" x="691.5" y="-542.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> register_merge_check_tick</text>
<polyline fill="none" stroke="#1c2123" points="608,-534.5 775,-534.5 "/>
<text text-anchor="start" x="616" y="-519.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">注册merge tick</text>
</g>
<!-- PeerFsmDelegate__on_check_merge&#45;&gt;PeerFsmDelegate__register_merge_check_tick -->
<g id="edge4" class="edge">
<title>PeerFsmDelegate__on_check_merge&#45;&gt;PeerFsmDelegate__register_merge_check_tick</title>
<path fill="none" stroke="#666666" d="M537.54,-414.08C570.04,-441.26 613.53,-477.64 645.83,-504.65"/>
<polygon fill="#666666" stroke="#666666" points="643.88,-507.57 653.79,-511.3 648.37,-502.2 643.88,-507.57"/>
</g>
<!-- PeerFsmDelegate__schedule_merge -->
<g id="node6" class="node">
<title>PeerFsmDelegate__schedule_merge</title>
<path fill="none" stroke="#1c2123" d="M647,-224C647,-224 736,-224 736,-224 742,-224 748,-230 748,-236 748,-236 748,-250 748,-250 748,-256 742,-262 736,-262 736,-262 647,-262 647,-262 641,-262 635,-256 635,-250 635,-250 635,-236 635,-236 635,-230 641,-224 647,-224"/>
<text text-anchor="start" x="643" y="-246.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="643" y="-231.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> schedule_merge</text>
</g>
<!-- PeerFsmDelegate__on_check_merge&#45;&gt;PeerFsmDelegate__schedule_merge -->
<g id="edge5" class="edge">
<title>PeerFsmDelegate__on_check_merge&#45;&gt;PeerFsmDelegate__schedule_merge</title>
<path fill="none" stroke="#666666" d="M548.88,-337.89C582.56,-315.32 624.25,-287.39 653.65,-267.69"/>
<polygon fill="#666666" stroke="#666666" points="655.62,-270.58 661.98,-262.11 651.73,-264.77 655.62,-270.58"/>
</g>
<!-- schedule_return_error -->
<g id="node7" class="node">
<title>schedule_return_error</title>
<path fill="none" stroke="#1c2123" d="M1020,-300C1020,-300 1199,-300 1199,-300 1205,-300 1211,-306 1211,-312 1211,-312 1211,-402 1211,-402 1211,-408 1205,-414 1199,-414 1199,-414 1020,-414 1020,-414 1014,-414 1008,-408 1008,-402 1008,-402 1008,-312 1008,-312 1008,-306 1014,-300 1020,-300"/>
<text text-anchor="start" x="1016" y="-398.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">schedule_merge返回</text>
<polyline fill="none" stroke="#1c2123" points="1008,-391 1211,-391 "/>
<text text-anchor="start" x="1016" y="-375.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.RegionNotFound错误</text>
<text text-anchor="start" x="1016" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 本地没找到对应的target region</text>
<polyline fill="none" stroke="#1c2123" points="1008,-353 1211,-353 "/>
<text text-anchor="start" x="1016" y="-337.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">2.本地target region</text>
<text text-anchor="start" x="1016" y="-322.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 比mergeState中的target region</text>
<text text-anchor="start" x="1016" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> epoch新</text>
</g>
<!-- PeerFsmDelegate__on_check_merge&#45;&gt;schedule_return_error -->
<g id="edge6" class="edge">
<title>PeerFsmDelegate__on_check_merge&#45;&gt;schedule_return_error</title>
<path fill="none" stroke="#666666" d="M552.52,-374.13C655.78,-370.95 867.47,-364.43 997.78,-360.41"/>
<polygon fill="#666666" stroke="#666666" points="997.91,-363.91 1007.8,-360.1 997.7,-356.91 997.91,-363.91"/>
</g>
<!-- PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE -->
<g id="node5" class="node">
<title>PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE</title>
<path fill="none" stroke="#1c2123" d="M1030.5,-651C1030.5,-651 1188.5,-651 1188.5,-651 1194.5,-651 1200.5,-657 1200.5,-663 1200.5,-663 1200.5,-715 1200.5,-715 1200.5,-721 1194.5,-727 1188.5,-727 1188.5,-727 1030.5,-727 1030.5,-727 1024.5,-727 1018.5,-721 1018.5,-715 1018.5,-715 1018.5,-663 1018.5,-663 1018.5,-657 1024.5,-651 1030.5,-651"/>
<text text-anchor="start" x="1026.5" y="-711.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="1026.5" y="-696.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> schedule_tick</text>
<text text-anchor="start" x="1026.5" y="-681.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PeerTicks::CHECK_MERGE</text>
<polyline fill="none" stroke="#1c2123" points="1018.5,-674 1200.5,-674 "/>
<text text-anchor="start" x="1026.5" y="-658.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">会接着on_check_merge函数</text>
</g>
<!-- PeerFsmDelegate__register_merge_check_tick&#45;&gt;PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE -->
<g id="edge8" class="edge">
<title>PeerFsmDelegate__register_merge_check_tick&#45;&gt;PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE</title>
<path fill="none" stroke="#666666" d="M775.19,-571.22C842.42,-594.98 937.51,-628.58 1008.93,-653.81"/>
<polygon fill="#666666" stroke="#666666" points="1007.81,-657.13 1018.4,-657.16 1010.14,-650.53 1007.81,-657.13"/>
</g>
<!-- PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE&#45;&gt;PeerFsmDelegate__on_check_merge -->
<g id="edge3" class="edge">
<title>PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE&#45;&gt;PeerFsmDelegate__on_check_merge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1018.19,-691.19C910.46,-689.33 729.67,-671.51 608,-582 554.76,-542.83 522.6,-471.42 506.06,-423.83"/>
<polygon fill="green" stroke="green" points="509.28,-422.42 502.77,-414.06 502.65,-424.65 509.28,-422.42"/>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;schedule_return_error -->
<g id="edge7" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;schedule_return_error</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M717.82,-262.26C740.85,-278.75 776.43,-301.71 811,-314 870.72,-335.24 940.74,-346 997.84,-351.45"/>
<polygon fill="green" stroke="green" points="997.71,-354.95 1007.98,-352.38 998.34,-347.98 997.71,-354.95"/>
</g>
<!-- Peer__pending_merge_state -->
<g id="node8" class="node">
<title>Peer__pending_merge_state</title>
<path fill="#feed9b" stroke="#f7e495" d="M835,-0.5C835,-0.5 948,-0.5 948,-0.5 954,-0.5 960,-6.5 960,-12.5 960,-12.5 960,-49.5 960,-49.5 960,-55.5 954,-61.5 948,-61.5 948,-61.5 835,-61.5 835,-61.5 829,-61.5 823,-55.5 823,-49.5 823,-49.5 823,-12.5 823,-12.5 823,-6.5 829,-0.5 835,-0.5"/>
<text text-anchor="start" x="831" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Peer</text>
<text text-anchor="start" x="831" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_merge_state</text>
<polyline fill="none" stroke="#f7e495" points="823,-23.5 960,-23.5 "/>
<text text-anchor="start" x="831" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#40575d">MergeState</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;Peer__pending_merge_state -->
<g id="edge9" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;Peer__pending_merge_state</title>
<path fill="none" stroke="#666666" d="M710.07,-223.72C727.61,-204 754.78,-172.06 775,-142 793.65,-114.28 787.56,-99.81 811,-76 813.8,-73.16 816.82,-70.44 819.98,-67.85"/>
<polygon fill="#666666" stroke="#666666" points="822.27,-70.5 828.11,-61.67 818.03,-64.93 822.27,-70.5"/>
</g>
<!-- Peer__validate_merge_peer -->
<g id="node9" class="node">
<title>Peer__validate_merge_peer</title>
<path fill="none" stroke="#1c2123" d="M823,-449C823,-449 960,-449 960,-449 966,-449 972,-455 972,-461 972,-461 972,-543 972,-543 972,-549 966,-555 960,-555 960,-555 823,-555 823,-555 817,-555 811,-549 811,-543 811,-543 811,-461 811,-461 811,-455 817,-449 823,-449"/>
<text text-anchor="start" x="819" y="-539.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="819" y="-524.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> validate_merge_peer</text>
<polyline fill="none" stroke="#1c2123" points="811,-517 972,-517 "/>
<text text-anchor="start" x="819" y="-501.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查mergeState中的</text>
<text text-anchor="start" x="819" y="-486.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> target region</text>
<text text-anchor="start" x="819" y="-471.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和当前本地target region</text>
<text text-anchor="start" x="819" y="-456.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> epoch是否一致</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;Peer__validate_merge_peer -->
<g id="edge10" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;Peer__validate_merge_peer</title>
<path fill="none" stroke="#666666" d="M707.06,-262.04C735.46,-299.2 799.36,-382.78 843.7,-440.78"/>
<polygon fill="#666666" stroke="#666666" points="840.96,-442.97 849.82,-448.79 846.53,-438.71 840.96,-442.97"/>
</g>
<!-- Peer__get_min_progress -->
<g id="node10" class="node">
<title>Peer__get_min_progress</title>
<path fill="none" stroke="#1c2123" d="M830,-157C830,-157 953,-157 953,-157 959,-157 965,-163 965,-169 965,-169 965,-259 965,-259 965,-265 959,-271 953,-271 953,-271 830,-271 830,-271 824,-271 818,-265 818,-259 818,-259 818,-169 818,-169 818,-163 824,-157 830,-157"/>
<text text-anchor="start" x="826" y="-255.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="826" y="-240.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_min_progress</text>
<polyline fill="none" stroke="#1c2123" points="818,-233 965,-233 "/>
<text text-anchor="start" x="826" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">再get一次集群中最小</text>
<text text-anchor="start" x="826" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> matched index</text>
<polyline fill="none" stroke="#1c2123" points="818,-195 965,-195 "/>
<text text-anchor="start" x="826" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">这时候machted index</text>
<text text-anchor="start" x="826" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 可能会增大了一些</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;Peer__get_min_progress -->
<g id="edge11" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;Peer__get_min_progress</title>
<path fill="none" stroke="#666666" d="M748.18,-234.84C766.67,-232.14 787.68,-229.06 807.77,-226.12"/>
<polygon fill="#666666" stroke="#666666" points="808.47,-229.55 817.85,-224.64 807.45,-222.63 808.47,-229.55"/>
</g>
<!-- CommitMergeRequest -->
<g id="node11" class="node">
<title>CommitMergeRequest</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1259,-126C1259,-126 1434,-126 1434,-126 1440,-126 1446,-132 1446,-138 1446,-138 1446,-190 1446,-190 1446,-196 1440,-202 1434,-202 1434,-202 1259,-202 1259,-202 1253,-202 1247,-196 1247,-190 1247,-190 1247,-138 1247,-138 1247,-132 1253,-126 1259,-126"/>
<text text-anchor="middle" x="1346.5" y="-186.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">CommitMergeRequest</text>
<polyline fill="none" stroke="#8a8898" points="1247,-179 1446,-179 "/>
<text text-anchor="start" x="1255" y="-163.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">AdminCmdType::CommitMerge</text>
<text text-anchor="start" x="1255" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> entries</text>
<text text-anchor="start" x="1255" y="-133.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> commit</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;CommitMergeRequest -->
<g id="edge12" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;CommitMergeRequest</title>
<path fill="none" stroke="#666666" d="M741.87,-262.09C762.85,-269.23 787.78,-276.46 811,-280 966.59,-303.73 1144.76,-248.1 1251.06,-205.93"/>
<polygon fill="#666666" stroke="#666666" points="1252.5,-209.12 1260.48,-202.15 1249.9,-202.63 1252.5,-209.12"/>
</g>
<!-- RaftRouter__force_send__target_id -->
<g id="node12" class="node">
<title>RaftRouter__force_send__target_id</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1494,-62.5C1494,-62.5 1640,-62.5 1640,-62.5 1646,-62.5 1652,-68.5 1652,-74.5 1652,-74.5 1652,-179.5 1652,-179.5 1652,-185.5 1646,-191.5 1640,-191.5 1640,-191.5 1494,-191.5 1494,-191.5 1488,-191.5 1482,-185.5 1482,-179.5 1482,-179.5 1482,-74.5 1482,-74.5 1482,-68.5 1488,-62.5 1494,-62.5"/>
<text text-anchor="start" x="1490" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftRouter</text>
<text text-anchor="start" x="1490" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> force_send</text>
<text text-anchor="start" x="1490" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> target_id</text>
<polyline fill="none" stroke="#8a8898" points="1482,-138.5 1652,-138.5 "/>
<text text-anchor="start" x="1490" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">发送CommitMergeRequest</text>
<text text-anchor="start" x="1490" y="-108.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 到TargetRegion</text>
<polyline fill="none" stroke="#8a8898" points="1482,-100.5 1652,-100.5 "/>
<text text-anchor="start" x="1490" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">由targetRegion Leader</text>
<text text-anchor="start" x="1490" y="-70.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> propose该request</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;RaftRouter__force_send__target_id -->
<g id="edge13" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;RaftRouter__force_send__target_id</title>
<path fill="none" stroke="#666666" d="M705.52,-223.7C724.92,-196.72 764.22,-148.62 811,-127 1029.66,-25.94 1323.47,-69.98 1471.84,-102.87"/>
<polygon fill="#666666" stroke="#666666" points="1471.31,-106.34 1481.84,-105.12 1472.85,-99.51 1471.31,-106.34"/>
</g>
<!-- PeerStorage__entries -->
<g id="node13" class="node">
<title>PeerStorage__entries</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1034.5,-118.5C1034.5,-118.5 1184.5,-118.5 1184.5,-118.5 1190.5,-118.5 1196.5,-124.5 1196.5,-130.5 1196.5,-130.5 1196.5,-197.5 1196.5,-197.5 1196.5,-203.5 1190.5,-209.5 1184.5,-209.5 1184.5,-209.5 1034.5,-209.5 1034.5,-209.5 1028.5,-209.5 1022.5,-203.5 1022.5,-197.5 1022.5,-197.5 1022.5,-130.5 1022.5,-130.5 1022.5,-124.5 1028.5,-118.5 1034.5,-118.5"/>
<text text-anchor="start" x="1030.5" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerStorage</text>
<text text-anchor="start" x="1030.5" y="-179.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> entries</text>
<polyline fill="none" stroke="#8a8898" points="1022.5,-171.5 1196.5,-171.5 "/>
<text text-anchor="start" x="1030.5" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">取min, get_commit+1</text>
<text text-anchor="start" x="1030.5" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的log entries</text>
<text text-anchor="start" x="1030.5" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 放入CommitMergeRequest</text>
</g>
<!-- PeerFsmDelegate__schedule_merge&#45;&gt;PeerStorage__entries -->
<g id="edge14" class="edge">
<title>PeerFsmDelegate__schedule_merge&#45;&gt;PeerStorage__entries</title>
<path fill="none" stroke="#666666" d="M708.54,-223.69C729.34,-200.31 768.07,-162.21 811,-147 875.42,-124.18 952.58,-129.44 1012.17,-139.87"/>
<polygon fill="#666666" stroke="#666666" points="1011.87,-143.38 1022.33,-141.73 1013.13,-136.49 1011.87,-143.38"/>
</g>
<!-- Peer__pending_merge_state&#45;&gt;PeerStorage__entries -->
<g id="edge23" class="edge">
<title>Peer__pending_merge_state&#45;&gt;PeerStorage__entries</title>
<path fill="none" stroke="#666666" d="M942.05,-61.51C966.89,-76.8 997.62,-95.73 1025.89,-113.13"/>
<polygon fill="#666666" stroke="#666666" points="1024.23,-116.22 1034.58,-118.48 1027.9,-110.26 1024.23,-116.22"/>
</g>
<!-- Peer__validate_merge_peer&#45;&gt;PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE -->
<g id="edge20" class="edge">
<title>Peer__validate_merge_peer&#45;&gt;PeerFsmDelegate__schedule_tick__PeerTicks__CHECK_MERGE</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M927.97,-555.02C948.79,-583.2 977.05,-616.91 1008,-641 1009.83,-642.42 1011.71,-643.82 1013.62,-645.19"/>
<polygon fill="green" stroke="green" points="1012.01,-648.32 1022.27,-650.99 1015.92,-642.51 1012.01,-648.32"/>
</g>
<!-- Peer__validate_merge_peer&#45;&gt;schedule_return_error -->
<g id="edge19" class="edge">
<title>Peer__validate_merge_peer&#45;&gt;schedule_return_error</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M969.71,-448.89C982.48,-440.2 995.59,-431.32 1008,-423 1009.63,-421.91 1011.27,-420.81 1012.92,-419.71"/>
<polygon fill="green" stroke="green" points="1014.9,-422.6 1021.28,-414.14 1011.01,-416.77 1014.9,-422.6"/>
</g>
<!-- target_region__get_region_epoch -->
<g id="node14" class="node">
<title>target_region__get_region_epoch</title>
<path fill="none" stroke="#1c2123" d="M1197,-632C1197,-632 1022,-632 1022,-632 1016,-632 1010,-626 1010,-620 1010,-620 1010,-608 1010,-608 1010,-602 1016,-596 1022,-596 1022,-596 1197,-596 1197,-596 1203,-596 1209,-602 1209,-608 1209,-608 1209,-620 1209,-620 1209,-626 1203,-632 1197,-632"/>
<text text-anchor="middle" x="1109.5" y="-610.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">target_region__get_region_epoch</text>
</g>
<!-- Peer__validate_merge_peer&#45;&gt;target_region__get_region_epoch -->
<g id="edge15" class="edge">
<title>Peer__validate_merge_peer&#45;&gt;target_region__get_region_epoch</title>
<path fill="none" stroke="#666666" d="M962.24,-555.19C976.88,-564.94 992.57,-574.41 1008,-582 1015.76,-585.82 1024.08,-589.31 1032.48,-592.48"/>
<polygon fill="#666666" stroke="#666666" points="1031.39,-595.81 1041.98,-595.91 1033.77,-589.22 1031.39,-595.81"/>
</g>
<!-- is_epoch_stale -->
<g id="node15" class="node">
<title>is_epoch_stale</title>
<path fill="none" stroke="#1c2123" d="M1382.5,-545C1382.5,-545 1310.5,-545 1310.5,-545 1304.5,-545 1298.5,-539 1298.5,-533 1298.5,-533 1298.5,-521 1298.5,-521 1298.5,-515 1304.5,-509 1310.5,-509 1310.5,-509 1382.5,-509 1382.5,-509 1388.5,-509 1394.5,-515 1394.5,-521 1394.5,-521 1394.5,-533 1394.5,-533 1394.5,-539 1388.5,-545 1382.5,-545"/>
<text text-anchor="middle" x="1346.5" y="-523.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_epoch_stale</text>
</g>
<!-- Peer__validate_merge_peer&#45;&gt;is_epoch_stale -->
<g id="edge16" class="edge">
<title>Peer__validate_merge_peer&#45;&gt;is_epoch_stale</title>
<path fill="none" stroke="#666666" d="M972.05,-538.97C983.88,-543.11 996.1,-546.67 1008,-549 1105.15,-568.01 1220.72,-552.44 1288.31,-539.59"/>
<polygon fill="#666666" stroke="#666666" points="1289.19,-542.99 1298.33,-537.64 1287.85,-536.12 1289.19,-542.99"/>
</g>
<!-- Peer__is_merge_target_region_stale -->
<g id="node16" class="node">
<title>Peer__is_merge_target_region_stale</title>
<path fill="none" stroke="#1c2123" d="M1031,-433C1031,-433 1188,-433 1188,-433 1194,-433 1200,-439 1200,-445 1200,-445 1200,-527 1200,-527 1200,-533 1194,-539 1188,-539 1188,-539 1031,-539 1031,-539 1025,-539 1019,-533 1019,-527 1019,-527 1019,-445 1019,-445 1019,-439 1025,-433 1031,-433"/>
<text text-anchor="start" x="1027" y="-523.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="1027" y="-508.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is_merge_target_region_stale</text>
<polyline fill="none" stroke="#1c2123" points="1019,-501 1200,-501 "/>
<text text-anchor="start" x="1027" y="-485.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果StoreMeta中没有</text>
<text text-anchor="start" x="1027" y="-470.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> target region信息</text>
<text text-anchor="start" x="1027" y="-455.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 去kv engin中读取该信息</text>
<text text-anchor="start" x="1027" y="-440.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后check region epoch</text>
</g>
<!-- Peer__validate_merge_peer&#45;&gt;Peer__is_merge_target_region_stale -->
<g id="edge17" class="edge">
<title>Peer__validate_merge_peer&#45;&gt;Peer__is_merge_target_region_stale</title>
<path fill="none" stroke="#666666" d="M972.01,-496.11C983.95,-495.23 996.38,-494.31 1008.67,-493.39"/>
<polygon fill="#666666" stroke="#666666" points="1009.24,-496.86 1018.95,-492.63 1008.72,-489.88 1009.24,-496.86"/>
</g>
<!-- Peer__get_min_progress&#45;&gt;PeerStorage__entries -->
<g id="edge25" class="edge">
<title>Peer__get_min_progress&#45;&gt;PeerStorage__entries</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M965.03,-197.21C980.25,-193.69 996.53,-189.92 1012.46,-186.23"/>
<polygon fill="green" stroke="green" points="1013.37,-189.61 1022.32,-183.95 1011.79,-182.79 1013.37,-189.61"/>
</g>
<!-- CommitMergeRequest&#45;&gt;RaftRouter__force_send__target_id -->
<g id="edge26" class="edge">
<title>CommitMergeRequest&#45;&gt;RaftRouter__force_send__target_id</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1446.2,-147.29C1454.74,-145.84 1463.36,-144.38 1471.86,-142.94"/>
<polygon fill="green" stroke="green" points="1472.49,-146.39 1481.76,-141.26 1471.32,-139.48 1472.49,-146.39"/>
</g>
<!-- PeerStorage__entries&#45;&gt;CommitMergeRequest -->
<g id="edge24" class="edge">
<title>PeerStorage__entries&#45;&gt;CommitMergeRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1196.67,-164C1209.61,-164 1223.11,-164 1236.45,-164"/>
<polygon fill="green" stroke="green" points="1236.62,-167.5 1246.62,-164 1236.62,-160.5 1236.62,-167.5"/>
</g>
<!-- Peer__is_merge_target_region_stale&#45;&gt;is_epoch_stale -->
<g id="edge18" class="edge">
<title>Peer__is_merge_target_region_stale&#45;&gt;is_epoch_stale</title>
<path fill="none" stroke="#666666" d="M1200.01,-501.62C1229.69,-506.79 1261.89,-512.41 1288.44,-517.04"/>
<polygon fill="#666666" stroke="#666666" points="1287.86,-520.5 1298.32,-518.77 1289.07,-513.6 1287.86,-520.5"/>
</g>
<!-- ExecResult__PrepareMerge -->
<g id="node17" class="node">
<title>ExecResult__PrepareMerge</title>
<path fill="none" stroke="#1c2123" d="M12,-130.5C12,-130.5 157,-130.5 157,-130.5 163,-130.5 169,-136.5 169,-142.5 169,-142.5 169,-179.5 169,-179.5 169,-185.5 163,-191.5 157,-191.5 157,-191.5 12,-191.5 12,-191.5 6,-191.5 0,-185.5 0,-179.5 0,-179.5 0,-142.5 0,-142.5 0,-136.5 6,-130.5 12,-130.5"/>
<text text-anchor="middle" x="84.5" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecResult__PrepareMerge</text>
<polyline fill="none" stroke="#1c2123" points="0,-168.5 169,-168.5 "/>
<text text-anchor="start" x="8" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">region</text>
<text text-anchor="start" x="8" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MergeState</text>
</g>
<!-- ExecResult__PrepareMerge&#45;&gt;PeerFsmDelegate__on_ready_prepare_merge -->
<g id="edge21" class="edge">
<title>ExecResult__PrepareMerge&#45;&gt;PeerFsmDelegate__on_ready_prepare_merge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M153.66,-191.55C167.08,-197.57 181.37,-203.98 195.44,-210.28"/>
<polygon fill="green" stroke="green" points="194.09,-213.51 204.65,-214.41 196.95,-207.13 194.09,-213.51"/>
</g>
<!-- ExecResult__PrepareMerge&#45;&gt;Peer__pending_merge_state -->
<g id="edge22" class="edge">
<title>ExecResult__PrepareMerge&#45;&gt;Peer__pending_merge_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M169.37,-147.46C325.95,-122.17 660.59,-68.13 812.55,-43.59"/>
<polygon fill="green" stroke="green" points="813.42,-46.99 822.73,-41.94 812.3,-40.08 813.42,-46.99"/>
</g>
</g>
</svg>
