<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: collect_ready Pages: 1 -->
<svg width="1188pt" height="606pt"
 viewBox="0.00 0.00 1188.00 606.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 602)">
<title>collect_ready</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-602 1184,-602 1184,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RaftRs</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M368,-8C368,-8 680,-8 680,-8 686,-8 692,-14 692,-20 692,-20 692,-124 692,-124 692,-130 686,-136 680,-136 680,-136 368,-136 368,-136 362,-136 356,-130 356,-124 356,-124 356,-20 356,-20 356,-14 362,-8 368,-8"/>
<text text-anchor="middle" x="524" y="-116" font-family="Times,serif" font-size="20.00">RaftRs</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Ready</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M376,-16C376,-16 487,-16 487,-16 493,-16 499,-22 499,-28 499,-28 499,-86 499,-86 499,-92 493,-98 487,-98 487,-98 376,-98 376,-98 370,-98 364,-92 364,-86 364,-86 364,-28 364,-28 364,-22 370,-16 376,-16"/>
<text text-anchor="middle" x="431.5" y="-78" font-family="Times,serif" font-size="20.00">Ready</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Callback</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M761.5,-508C761.5,-508 872.5,-508 872.5,-508 878.5,-508 884.5,-514 884.5,-520 884.5,-520 884.5,-578 884.5,-578 884.5,-584 878.5,-590 872.5,-590 872.5,-590 761.5,-590 761.5,-590 755.5,-590 749.5,-584 749.5,-578 749.5,-578 749.5,-520 749.5,-520 749.5,-514 755.5,-508 761.5,-508"/>
<text text-anchor="middle" x="817" y="-570" font-family="Times,serif" font-size="20.00">Callback</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_PeerFsmDelegate</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-144C20,-144 1160,-144 1160,-144 1166,-144 1172,-150 1172,-156 1172,-156 1172,-488 1172,-488 1172,-494 1166,-500 1160,-500 1160,-500 20,-500 20,-500 14,-500 8,-494 8,-488 8,-488 8,-156 8,-156 8,-150 14,-144 20,-144"/>
<text text-anchor="middle" x="590" y="-480" font-family="Times,serif" font-size="20.00">PeerFsmDelegate</text>
</g>
<!-- committed_entries -->
<g id="node1" class="node">
<title>committed_entries</title>
<path fill="none" stroke="#1c2123" d="M479,-60C479,-60 384,-60 384,-60 378,-60 372,-54 372,-48 372,-48 372,-36 372,-36 372,-30 378,-24 384,-24 384,-24 479,-24 479,-24 485,-24 491,-30 491,-36 491,-36 491,-48 491,-48 491,-54 485,-60 479,-60"/>
<text text-anchor="middle" x="431.5" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">committed_entries</text>
</g>
<!-- find_proposal -->
<g id="node8" class="node">
<title>find_proposal</title>
<path fill="none" stroke="#1c2123" d="M656,-308C656,-308 589,-308 589,-308 583,-308 577,-302 577,-296 577,-296 577,-284 577,-284 577,-278 583,-272 589,-272 589,-272 656,-272 656,-272 662,-272 668,-278 668,-284 668,-284 668,-296 668,-296 668,-302 662,-308 656,-308"/>
<text text-anchor="middle" x="622.5" y="-286.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">find_proposal</text>
</g>
<!-- committed_entries&#45;&gt;find_proposal -->
<g id="edge16" class="edge">
<title>committed_entries&#45;&gt;find_proposal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M451.67,-60.22C471.18,-79.22 501.78,-110.34 525,-140 556.83,-180.66 588.13,-231.99 606.1,-262.84"/>
<polygon fill="green" stroke="green" points="603.19,-264.82 611.23,-271.73 609.26,-261.32 603.19,-264.82"/>
</g>
<!-- skip_bcast_commit -->
<g id="node2" class="node">
<title>skip_bcast_commit</title>
<path fill="none" stroke="#1c2123" d="M672,-98C672,-98 573,-98 573,-98 567,-98 561,-92 561,-86 561,-86 561,-74 561,-74 561,-68 567,-62 573,-62 573,-62 672,-62 672,-62 678,-62 684,-68 684,-74 684,-74 684,-86 684,-86 684,-92 678,-98 672,-98"/>
<text text-anchor="middle" x="622.5" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">skip_bcast_commit</text>
</g>
<!-- invoke_committed -->
<g id="node3" class="node">
<title>invoke_committed</title>
<path fill="none" stroke="#1c2123" d="M864.5,-552C864.5,-552 769.5,-552 769.5,-552 763.5,-552 757.5,-546 757.5,-540 757.5,-540 757.5,-528 757.5,-528 757.5,-522 763.5,-516 769.5,-516 769.5,-516 864.5,-516 864.5,-516 870.5,-516 876.5,-522 876.5,-528 876.5,-528 876.5,-540 876.5,-540 876.5,-546 870.5,-552 864.5,-552"/>
<text text-anchor="middle" x="817" y="-530.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">invoke_committed</text>
</g>
<!-- collect_ready -->
<g id="node4" class="node">
<title>collect_ready</title>
<path fill="none" stroke="#1c2123" d="M93,-341C93,-341 28,-341 28,-341 22,-341 16,-335 16,-329 16,-329 16,-317 16,-317 16,-311 22,-305 28,-305 28,-305 93,-305 93,-305 99,-305 105,-311 105,-317 105,-317 105,-329 105,-329 105,-335 99,-341 93,-341"/>
<text text-anchor="middle" x="60.5" y="-319.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">collect_ready</text>
</g>
<!-- handle_raft_ready_append -->
<g id="node5" class="node">
<title>handle_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M290,-341C290,-341 153,-341 153,-341 147,-341 141,-335 141,-329 141,-329 141,-317 141,-317 141,-311 147,-305 153,-305 153,-305 290,-305 290,-305 296,-305 302,-311 302,-317 302,-317 302,-329 302,-329 302,-335 296,-341 290,-341"/>
<text text-anchor="middle" x="221.5" y="-319.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_ready_append</text>
</g>
<!-- collect_ready&#45;&gt;handle_raft_ready_append -->
<g id="edge1" class="edge">
<title>collect_ready&#45;&gt;handle_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M105.37,-323C113.3,-323 121.82,-323 130.52,-323"/>
<polygon fill="#666666" stroke="#666666" points="130.77,-326.5 140.77,-323 130.77,-319.5 130.77,-326.5"/>
</g>
<!-- handle_raft_ready_append&#45;&gt;committed_entries -->
<g id="edge2" class="edge">
<title>handle_raft_ready_append&#45;&gt;committed_entries</title>
<path fill="none" stroke="#666666" d="M232.4,-304.83C251.15,-271.05 293.9,-196.85 338,-140 358.38,-113.73 384.65,-86.42 403.98,-67.32"/>
<polygon fill="#666666" stroke="#666666" points="406.58,-69.67 411.28,-60.17 401.68,-64.67 406.58,-69.67"/>
</g>
<!-- handle_raft_committed_entries -->
<g id="node6" class="node">
<title>handle_raft_committed_entries</title>
<path fill="none" stroke="#1c2123" d="M513,-341C513,-341 350,-341 350,-341 344,-341 338,-335 338,-329 338,-329 338,-317 338,-317 338,-311 344,-305 350,-305 350,-305 513,-305 513,-305 519,-305 525,-311 525,-317 525,-317 525,-329 525,-329 525,-335 519,-341 513,-341"/>
<text text-anchor="middle" x="431.5" y="-319.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_committed_entries</text>
</g>
<!-- handle_raft_ready_append&#45;&gt;handle_raft_committed_entries -->
<g id="edge3" class="edge">
<title>handle_raft_ready_append&#45;&gt;handle_raft_committed_entries</title>
<path fill="none" stroke="#666666" d="M302.03,-323C310.43,-323 319.07,-323 327.69,-323"/>
<polygon fill="#666666" stroke="#666666" points="327.8,-326.5 337.8,-323 327.8,-319.5 327.8,-326.5"/>
</g>
<!-- handle_raft_ready -->
<g id="node7" class="node">
<title>handle_raft_ready</title>
<path fill="none" stroke="#1c2123" d="M360,-360C360,-360 503,-360 503,-360 509,-360 515,-366 515,-372 515,-372 515,-394 515,-394 515,-400 509,-406 503,-406 503,-406 360,-406 360,-406 354,-406 348,-400 348,-394 348,-394 348,-372 348,-372 348,-366 354,-360 360,-360"/>
<text text-anchor="middle" x="431.5" y="-390.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_ready</text>
<polyline fill="none" stroke="#1c2123" points="348,-383 515,-383 "/>
<text text-anchor="start" x="356" y="-367.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Save memory states to disk</text>
</g>
<!-- handle_raft_ready_append&#45;&gt;handle_raft_ready -->
<g id="edge4" class="edge">
<title>handle_raft_ready_append&#45;&gt;handle_raft_ready</title>
<path fill="none" stroke="#666666" d="M284.91,-341C302.43,-346.06 321.85,-351.66 340.63,-357.08"/>
<polygon fill="#666666" stroke="#666666" points="339.81,-360.48 350.39,-359.89 341.75,-353.76 339.81,-360.48"/>
</g>
<!-- handle_raft_committed_entries&#45;&gt;skip_bcast_commit -->
<g id="edge5" class="edge">
<title>handle_raft_committed_entries&#45;&gt;skip_bcast_commit</title>
<path fill="none" stroke="#666666" d="M443.73,-304.82C464.94,-271.03 513.06,-196.82 561,-140 571.13,-127.99 583.27,-115.62 594.01,-105.25"/>
<polygon fill="#666666" stroke="#666666" points="596.7,-107.52 601.53,-98.09 591.87,-102.45 596.7,-107.52"/>
</g>
<!-- handle_raft_committed_entries&#45;&gt;invoke_committed -->
<g id="edge6" class="edge">
<title>handle_raft_committed_entries&#45;&gt;invoke_committed</title>
<path fill="none" stroke="#666666" d="M512.26,-341.12C516.88,-343.95 521.19,-347.22 525,-351 563.05,-388.69 522.33,-428.95 561,-466 610.86,-513.77 690.38,-528.86 747.37,-533.2"/>
<polygon fill="#666666" stroke="#666666" points="747.17,-536.69 757.38,-533.86 747.63,-529.71 747.17,-536.69"/>
</g>
<!-- handle_raft_committed_entries&#45;&gt;find_proposal -->
<g id="edge7" class="edge">
<title>handle_raft_committed_entries&#45;&gt;find_proposal</title>
<path fill="none" stroke="#666666" d="M525.06,-306.84C539.23,-304.36 553.46,-301.88 566.47,-299.61"/>
<polygon fill="#666666" stroke="#666666" points="567.37,-303 576.62,-297.84 566.17,-296.11 567.37,-303"/>
</g>
<!-- Apply -->
<g id="node9" class="node">
<title>Apply</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M751.5,-326.5C751.5,-326.5 882.5,-326.5 882.5,-326.5 888.5,-326.5 894.5,-332.5 894.5,-338.5 894.5,-338.5 894.5,-429.5 894.5,-429.5 894.5,-435.5 888.5,-441.5 882.5,-441.5 882.5,-441.5 751.5,-441.5 751.5,-441.5 745.5,-441.5 739.5,-435.5 739.5,-429.5 739.5,-429.5 739.5,-338.5 739.5,-338.5 739.5,-332.5 745.5,-326.5 751.5,-326.5"/>
<text text-anchor="middle" x="817" y="-426.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Apply</text>
<polyline fill="none" stroke="#60b5ac" points="739.5,-418.5 894.5,-418.5 "/>
<text text-anchor="start" x="747.5" y="-403.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub peer_id: u64,</text>
<polyline fill="none" stroke="#60b5ac" points="739.5,-395.5 894.5,-395.5 "/>
<text text-anchor="start" x="747.5" y="-380.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub region_id: u64,</text>
<polyline fill="none" stroke="#60b5ac" points="739.5,-372.5 894.5,-372.5 "/>
<text text-anchor="start" x="747.5" y="-357.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub term: u64,</text>
<polyline fill="none" stroke="#60b5ac" points="739.5,-349.5 894.5,-349.5 "/>
<text text-anchor="start" x="747.5" y="-334.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub entries: Vec&lt;Entry&gt;,</text>
</g>
<!-- handle_raft_committed_entries&#45;&gt;Apply -->
<g id="edge8" class="edge">
<title>handle_raft_committed_entries&#45;&gt;Apply</title>
<path fill="none" stroke="#666666" d="M525.33,-337.77C587.49,-347.65 668.74,-360.58 729.53,-370.25"/>
<polygon fill="#666666" stroke="#666666" points="729.06,-373.72 739.49,-371.83 730.16,-366.8 729.06,-373.72"/>
</g>
<!-- apply_router_schedule_task -->
<g id="node10" class="node">
<title>apply_router_schedule_task</title>
<path fill="none" stroke="#1c2123" d="M962,-337C962,-337 1152,-337 1152,-337 1158,-337 1164,-343 1164,-349 1164,-349 1164,-439 1164,-439 1164,-445 1158,-451 1152,-451 1152,-451 962,-451 962,-451 956,-451 950,-445 950,-439 950,-439 950,-349 950,-349 950,-343 956,-337 962,-337"/>
<text text-anchor="start" x="958" y="-435.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">向apply poller发送Apply task</text>
<polyline fill="none" stroke="#1c2123" points="950,-428 1164,-428 "/>
<text text-anchor="start" x="958" y="-412.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Apply中包含了cbs, 等msg applied</text>
<text text-anchor="start" x="958" y="-397.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 到store上时候，会回调cb</text>
<polyline fill="none" stroke="#1c2123" points="950,-390 1164,-390 "/>
<text text-anchor="start" x="958" y="-374.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ctx.apply_router</text>
<text text-anchor="start" x="958" y="-359.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .schedule_task(self.region_id,</text>
<text text-anchor="start" x="958" y="-344.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ApplyTask::apply(apply));</text>
</g>
<!-- handle_raft_committed_entries&#45;&gt;apply_router_schedule_task -->
<g id="edge9" class="edge">
<title>handle_raft_committed_entries&#45;&gt;apply_router_schedule_task</title>
<path fill="none" stroke="#666666" d="M497.71,-341.12C506.96,-344.16 516.29,-347.48 525,-351 615.31,-387.48 625.32,-428.14 720,-451 803.81,-471.24 829.34,-467.36 914,-451 922.62,-449.33 931.39,-447.15 940.11,-444.6"/>
<polygon fill="#666666" stroke="#666666" points="941.4,-447.87 949.93,-441.59 939.35,-441.18 941.4,-447.87"/>
</g>
<!-- find_proposal&#45;&gt;invoke_committed -->
<g id="edge14" class="edge">
<title>find_proposal&#45;&gt;invoke_committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M626.52,-308.17C634.29,-349.23 658.84,-449.81 720,-504 728.06,-511.14 737.8,-516.58 747.94,-520.72"/>
<polygon fill="green" stroke="green" points="746.75,-524.01 757.34,-524.18 749.16,-517.44 746.75,-524.01"/>
</g>
<!-- find_proposal&#45;&gt;Apply -->
<g id="edge11" class="edge">
<title>find_proposal&#45;&gt;Apply</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M660.62,-308.12C680.38,-317.77 705.57,-330.08 729.89,-341.95"/>
<polygon fill="green" stroke="green" points="728.64,-345.23 739.16,-346.48 731.71,-338.94 728.64,-345.23"/>
</g>
<!-- proposals -->
<g id="node11" class="node">
<title>proposals</title>
<path fill="#feed9b" stroke="#f7e495" d="M732,-207C732,-207 902,-207 902,-207 908,-207 914,-213 914,-219 914,-219 914,-241 914,-241 914,-247 908,-253 902,-253 902,-253 732,-253 732,-253 726,-253 720,-247 720,-241 720,-241 720,-219 720,-219 720,-213 726,-207 732,-207"/>
<text text-anchor="middle" x="817" y="-237.8" font-family="Times,serif" font-size="14.00" fill="#40575d">proposals</text>
<polyline fill="none" stroke="#f7e495" points="720,-230 914,-230 "/>
<text text-anchor="start" x="728" y="-214.8" font-family="Times,serif" font-size="14.00" fill="#40575d">ProposalQueue&lt;EK::Snapshot&gt;,</text>
</g>
<!-- find_proposal&#45;&gt;proposals -->
<g id="edge10" class="edge">
<title>find_proposal&#45;&gt;proposals</title>
<path fill="none" stroke="#666666" d="M668.15,-276.08C687.3,-270.11 710.33,-262.94 732.45,-256.04"/>
<polygon fill="#666666" stroke="#666666" points="733.69,-259.32 742.19,-253 731.61,-252.64 733.69,-259.32"/>
</g>
<!-- proposals_pop -->
<g id="node12" class="node">
<title>proposals_pop</title>
<path fill="none" stroke="#1c2123" d="M852.5,-308C852.5,-308 781.5,-308 781.5,-308 775.5,-308 769.5,-302 769.5,-296 769.5,-296 769.5,-284 769.5,-284 769.5,-278 775.5,-272 781.5,-272 781.5,-272 852.5,-272 852.5,-272 858.5,-272 864.5,-278 864.5,-284 864.5,-284 864.5,-296 864.5,-296 864.5,-302 858.5,-308 852.5,-308"/>
<text text-anchor="middle" x="817" y="-286.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">proposals_pop</text>
</g>
<!-- find_proposal&#45;&gt;proposals_pop -->
<g id="edge12" class="edge">
<title>find_proposal&#45;&gt;proposals_pop</title>
<path fill="none" stroke="#666666" d="M668.15,-290C695.27,-290 730.16,-290 759.23,-290"/>
<polygon fill="#666666" stroke="#666666" points="759.25,-293.5 769.25,-290 759.25,-286.5 759.25,-293.5"/>
</g>
<!-- notify_stale_req -->
<g id="node13" class="node">
<title>notify_stale_req</title>
<path fill="none" stroke="#1c2123" d="M857,-188C857,-188 777,-188 777,-188 771,-188 765,-182 765,-176 765,-176 765,-164 765,-164 765,-158 771,-152 777,-152 777,-152 857,-152 857,-152 863,-152 869,-158 869,-164 869,-164 869,-176 869,-176 869,-182 863,-188 857,-188"/>
<text text-anchor="middle" x="817" y="-166.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify_stale_req</text>
</g>
<!-- find_proposal&#45;&gt;notify_stale_req -->
<g id="edge13" class="edge">
<title>find_proposal&#45;&gt;notify_stale_req</title>
<path fill="none" stroke="#666666" d="M637.54,-271.85C654.76,-250.82 685.89,-216.56 720,-197 730.79,-190.82 743.07,-185.98 755.17,-182.22"/>
<polygon fill="#666666" stroke="#666666" points="756.17,-185.57 764.8,-179.42 754.22,-178.85 756.17,-185.57"/>
</g>
<!-- Apply&#45;&gt;apply_router_schedule_task -->
<g id="edge15" class="edge">
<title>Apply&#45;&gt;apply_router_schedule_task</title>
<path fill="none" stroke="#666666" d="M894.61,-387.22C908.99,-387.82 924.32,-388.47 939.6,-389.11"/>
<polygon fill="#666666" stroke="#666666" points="939.48,-392.61 949.61,-389.53 939.77,-385.61 939.48,-392.61"/>
</g>
</g>
</svg>
