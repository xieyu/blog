<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: ReadIndexContext Pages: 1 -->
<svg width="1120pt" height="345pt"
 viewBox="0.00 0.00 1120.00 345.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 341)">
<title>ReadIndexContext</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-341 1116,-341 1116,4 -4,4"/>
<!-- ReadIndexContext -->
<g id="node1" class="node">
<title>ReadIndexContext</title>
<path fill="none" stroke="#1c2123" d="M387.5,-138C387.5,-138 293.5,-138 293.5,-138 287.5,-138 281.5,-132 281.5,-126 281.5,-126 281.5,-114 281.5,-114 281.5,-108 287.5,-102 293.5,-102 293.5,-102 387.5,-102 387.5,-102 393.5,-102 399.5,-108 399.5,-114 399.5,-114 399.5,-126 399.5,-126 399.5,-132 393.5,-138 387.5,-138"/>
<text text-anchor="middle" x="340.5" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexContext</text>
</g>
<!-- Uuid -->
<g id="node2" class="node">
<title>Uuid</title>
<path fill="none" stroke="#1c2123" d="M535,-238C535,-238 505,-238 505,-238 499,-238 493,-232 493,-226 493,-226 493,-214 493,-214 493,-208 499,-202 505,-202 505,-202 535,-202 535,-202 541,-202 547,-208 547,-214 547,-214 547,-226 547,-226 547,-232 541,-238 535,-238"/>
<text text-anchor="middle" x="520" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Uuid</text>
</g>
<!-- ReadIndexContext&#45;&gt;Uuid -->
<g id="edge1" class="edge">
<title>ReadIndexContext&#45;&gt;Uuid</title>
<path fill="none" stroke="#666666" d="M362.38,-138.23C381.71,-154.37 411.78,-177.67 441,-193 454.15,-199.9 469.43,-205.63 482.96,-210.02"/>
<polygon fill="#666666" stroke="#666666" points="482.32,-213.48 492.9,-213.11 484.39,-206.8 482.32,-213.48"/>
</g>
<!-- ReadIndexRequest -->
<g id="node3" class="node">
<title>ReadIndexRequest</title>
<path fill="none" stroke="#1c2123" d="M567.5,-184C567.5,-184 472.5,-184 472.5,-184 466.5,-184 460.5,-178 460.5,-172 460.5,-172 460.5,-160 460.5,-160 460.5,-154 466.5,-148 472.5,-148 472.5,-148 567.5,-148 567.5,-148 573.5,-148 579.5,-154 579.5,-160 579.5,-160 579.5,-172 579.5,-172 579.5,-178 573.5,-184 567.5,-184"/>
<text text-anchor="middle" x="520" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexRequest</text>
</g>
<!-- ReadIndexContext&#45;&gt;ReadIndexRequest -->
<g id="edge2" class="edge">
<title>ReadIndexContext&#45;&gt;ReadIndexRequest</title>
<path fill="none" stroke="#666666" d="M399.62,-135.06C415.93,-139.29 433.82,-143.92 450.67,-148.29"/>
<polygon fill="#666666" stroke="#666666" points="449.89,-151.7 460.45,-150.83 451.64,-144.93 449.89,-151.7"/>
</g>
<!-- LockInfo -->
<g id="node4" class="node">
<title>LockInfo</title>
<path fill="#feed9b" stroke="#f7e495" d="M930,-44.5C930,-44.5 1100,-44.5 1100,-44.5 1106,-44.5 1112,-50.5 1112,-56.5 1112,-56.5 1112,-285.5 1112,-285.5 1112,-291.5 1106,-297.5 1100,-297.5 1100,-297.5 930,-297.5 930,-297.5 924,-297.5 918,-291.5 918,-285.5 918,-285.5 918,-56.5 918,-56.5 918,-50.5 924,-44.5 930,-44.5"/>
<text text-anchor="middle" x="1015" y="-282.3" font-family="Times,serif" font-size="14.00" fill="#40575d">LockInfo</text>
<polyline fill="none" stroke="#f7e495" points="918,-274.5 1112,-274.5 "/>
<text text-anchor="start" x="926" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#40575d">bytes primary_lock = 1;</text>
<polyline fill="none" stroke="#f7e495" points="918,-251.5 1112,-251.5 "/>
<text text-anchor="start" x="926" y="-236.3" font-family="Times,serif" font-size="14.00" fill="#40575d">uint64 lock_version = 2;</text>
<polyline fill="none" stroke="#f7e495" points="918,-228.5 1112,-228.5 "/>
<text text-anchor="start" x="926" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#40575d">bytes key = 3;</text>
<polyline fill="none" stroke="#f7e495" points="918,-205.5 1112,-205.5 "/>
<text text-anchor="start" x="926" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#40575d">uint64 lock_ttl = 4;</text>
<polyline fill="none" stroke="#f7e495" points="918,-182.5 1112,-182.5 "/>
<text text-anchor="start" x="926" y="-167.3" font-family="Times,serif" font-size="14.00" fill="#40575d">uint64 txn_size = 5;</text>
<polyline fill="none" stroke="#f7e495" points="918,-159.5 1112,-159.5 "/>
<text text-anchor="start" x="926" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Op lock_type = 6;</text>
<polyline fill="none" stroke="#f7e495" points="918,-136.5 1112,-136.5 "/>
<text text-anchor="start" x="926" y="-121.3" font-family="Times,serif" font-size="14.00" fill="#40575d">uint64 lock_for_update_ts = 7;</text>
<polyline fill="none" stroke="#f7e495" points="918,-113.5 1112,-113.5 "/>
<text text-anchor="start" x="926" y="-98.3" font-family="Times,serif" font-size="14.00" fill="#40575d">bool use_async_commit = 8;</text>
<polyline fill="none" stroke="#f7e495" points="918,-90.5 1112,-90.5 "/>
<text text-anchor="start" x="926" y="-75.3" font-family="Times,serif" font-size="14.00" fill="#40575d">uint64 min_commit_ts = 9;</text>
<polyline fill="none" stroke="#f7e495" points="918,-67.5 1112,-67.5 "/>
<text text-anchor="start" x="926" y="-52.3" font-family="Times,serif" font-size="14.00" fill="#40575d">repeated bytes secondaries = 10;</text>
</g>
<!-- ReadIndexContext&#45;&gt;LockInfo -->
<g id="edge3" class="edge">
<title>ReadIndexContext&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" d="M399.54,-124.23C451.73,-128.04 530.5,-133.83 599,-139 704.08,-146.93 824.1,-156.21 907.95,-162.73"/>
<polygon fill="#666666" stroke="#666666" points="907.75,-166.22 917.99,-163.51 908.29,-159.24 907.75,-166.22"/>
</g>
<!-- raft_group__read_index -->
<g id="node12" class="node">
<title>raft_group__read_index</title>
<path fill="none" stroke="#1c2123" d="M457.5,-0.5C457.5,-0.5 582.5,-0.5 582.5,-0.5 588.5,-0.5 594.5,-6.5 594.5,-12.5 594.5,-12.5 594.5,-79.5 594.5,-79.5 594.5,-85.5 588.5,-91.5 582.5,-91.5 582.5,-91.5 457.5,-91.5 457.5,-91.5 451.5,-91.5 445.5,-85.5 445.5,-79.5 445.5,-79.5 445.5,-12.5 445.5,-12.5 445.5,-6.5 451.5,-0.5 457.5,-0.5"/>
<text text-anchor="start" x="453.5" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">raft_group</text>
<text text-anchor="start" x="453.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read_index</text>
<polyline fill="none" stroke="#1c2123" points="445.5,-53.5 594.5,-53.5 "/>
<text text-anchor="start" x="453.5" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用raft的read_index</text>
<text text-anchor="start" x="453.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并附带上序列化后的</text>
<text text-anchor="start" x="453.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadIndexContext</text>
</g>
<!-- ReadIndexContext&#45;&gt;raft_group__read_index -->
<g id="edge12" class="edge">
<title>ReadIndexContext&#45;&gt;raft_group__read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M384.92,-101.9C400.25,-95.51 418.04,-88.09 435.56,-80.79"/>
<polygon fill="green" stroke="green" points="437.36,-83.83 445.25,-76.75 434.67,-77.37 437.36,-83.83"/>
</g>
<!-- ReplicaReadLockChecker__on_step -->
<g id="node5" class="node">
<title>ReplicaReadLockChecker__on_step</title>
<path fill="none" stroke="#1c2123" d="M453,-257C453,-257 587,-257 587,-257 593,-257 599,-263 599,-269 599,-269 599,-283 599,-283 599,-289 593,-295 587,-295 587,-295 453,-295 453,-295 447,-295 441,-289 441,-283 441,-283 441,-269 441,-269 441,-263 447,-257 453,-257"/>
<text text-anchor="start" x="449" y="-279.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReplicaReadLockChecker</text>
<text text-anchor="start" x="449" y="-264.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_step</text>
</g>
<!-- ReadIndexContext__parse -->
<g id="node6" class="node">
<title>ReadIndexContext__parse</title>
<path fill="none" stroke="#1c2123" d="M826.5,-321C826.5,-321 690.5,-321 690.5,-321 684.5,-321 678.5,-315 678.5,-309 678.5,-309 678.5,-297 678.5,-297 678.5,-291 684.5,-285 690.5,-285 690.5,-285 826.5,-285 826.5,-285 832.5,-285 838.5,-291 838.5,-297 838.5,-297 838.5,-309 838.5,-309 838.5,-315 832.5,-321 826.5,-321"/>
<text text-anchor="middle" x="758.5" y="-299.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexContext__parse</text>
</g>
<!-- ReplicaReadLockChecker__on_step&#45;&gt;ReadIndexContext__parse -->
<g id="edge4" class="edge">
<title>ReplicaReadLockChecker__on_step&#45;&gt;ReadIndexContext__parse</title>
<path fill="none" stroke="#666666" d="M599.09,-284.92C621.25,-287.44 645.53,-290.22 668.29,-292.81"/>
<polygon fill="#666666" stroke="#666666" points="667.94,-296.3 678.27,-293.96 668.74,-289.34 667.94,-296.3"/>
</g>
<!-- ConcurrencyManager__read_range_check -->
<g id="node7" class="node">
<title>ConcurrencyManager__read_range_check</title>
<path fill="none" stroke="#1c2123" d="M870,-267C870,-267 647,-267 647,-267 641,-267 635,-261 635,-255 635,-255 635,-243 635,-243 635,-237 641,-231 647,-231 647,-231 870,-231 870,-231 876,-231 882,-237 882,-243 882,-243 882,-255 882,-255 882,-261 876,-267 870,-267"/>
<text text-anchor="middle" x="758.5" y="-245.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager__read_range_check</text>
</g>
<!-- ReplicaReadLockChecker__on_step&#45;&gt;ConcurrencyManager__read_range_check -->
<g id="edge5" class="edge">
<title>ReplicaReadLockChecker__on_step&#45;&gt;ConcurrencyManager__read_range_check</title>
<path fill="none" stroke="#666666" d="M599.09,-267.08C607.31,-266.15 615.83,-265.17 624.45,-264.19"/>
<polygon fill="#666666" stroke="#666666" points="625.07,-267.64 634.61,-263.03 624.27,-260.69 625.07,-267.64"/>
</g>
<!-- check_ts_conflict -->
<g id="node8" class="node">
<title>check_ts_conflict</title>
<path fill="none" stroke="#1c2123" d="M802,-213C802,-213 715,-213 715,-213 709,-213 703,-207 703,-201 703,-201 703,-189 703,-189 703,-183 709,-177 715,-177 715,-177 802,-177 802,-177 808,-177 814,-183 814,-189 814,-189 814,-201 814,-201 814,-207 808,-213 802,-213"/>
<text text-anchor="middle" x="758.5" y="-191.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_ts_conflict</text>
</g>
<!-- ReplicaReadLockChecker__on_step&#45;&gt;check_ts_conflict -->
<g id="edge6" class="edge">
<title>ReplicaReadLockChecker__on_step&#45;&gt;check_ts_conflict</title>
<path fill="none" stroke="#666666" d="M577.55,-256.9C584.89,-253.87 592.21,-250.55 599,-247 616.27,-237.98 617.15,-229.8 635,-222 653.1,-214.09 673.75,-208.4 692.87,-204.34"/>
<polygon fill="#666666" stroke="#666666" points="693.59,-207.77 702.71,-202.37 692.21,-200.9 693.59,-207.77"/>
</g>
<!-- ConcurrencyManager__read_range_check&#45;&gt;LockInfo -->
<g id="edge11" class="edge">
<title>ConcurrencyManager__read_range_check&#45;&gt;LockInfo</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M848.89,-230.96C860.11,-228.21 871.37,-225.21 882,-222 890.64,-219.4 899.51,-216.49 908.38,-213.42"/>
<polygon fill="green" stroke="green" points="909.72,-216.66 917.99,-210.04 907.39,-210.06 909.72,-216.66"/>
</g>
<!-- CoprocessorHost__on_step_read_index -->
<g id="node9" class="node">
<title>CoprocessorHost__on_step_read_index</title>
<path fill="none" stroke="#1c2123" d="M288,-257C288,-257 393,-257 393,-257 399,-257 405,-263 405,-269 405,-269 405,-283 405,-283 405,-289 399,-295 393,-295 393,-295 288,-295 288,-295 282,-295 276,-289 276,-283 276,-283 276,-269 276,-269 276,-263 282,-257 288,-257"/>
<text text-anchor="start" x="284" y="-279.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CoprocessorHost</text>
<text text-anchor="start" x="284" y="-264.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_step_read_index</text>
</g>
<!-- CoprocessorHost__on_step_read_index&#45;&gt;ReplicaReadLockChecker__on_step -->
<g id="edge7" class="edge">
<title>CoprocessorHost__on_step_read_index&#45;&gt;ReplicaReadLockChecker__on_step</title>
<path fill="none" stroke="#666666" d="M405.08,-276C413.45,-276 422.14,-276 430.82,-276"/>
<polygon fill="#666666" stroke="#666666" points="430.99,-279.5 440.99,-276 430.99,-272.5 430.99,-279.5"/>
</g>
<!-- Peer__read_index -->
<g id="node10" class="node">
<title>Peer__read_index</title>
<path fill="none" stroke="#1c2123" d="M12,-44.5C12,-44.5 228,-44.5 228,-44.5 234,-44.5 240,-50.5 240,-56.5 240,-56.5 240,-123.5 240,-123.5 240,-129.5 234,-135.5 228,-135.5 228,-135.5 12,-135.5 12,-135.5 6,-135.5 0,-129.5 0,-123.5 0,-123.5 0,-56.5 0,-56.5 0,-50.5 6,-44.5 12,-44.5"/>
<text text-anchor="start" x="8" y="-120.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="8" y="-105.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read_index</text>
<polyline fill="none" stroke="#1c2123" points="0,-97.5 240,-97.5 "/>
<text text-anchor="start" x="8" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">follower节点发起read index请求</text>
<text text-anchor="start" x="8" y="-67.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用raft时，会带上ReadIndexContext</text>
<text text-anchor="start" x="8" y="-52.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 里面的lock为None</text>
</g>
<!-- Peer__read_index&#45;&gt;ReadIndexContext -->
<g id="edge8" class="edge">
<title>Peer__read_index&#45;&gt;ReadIndexContext</title>
<path fill="none" stroke="#666666" d="M240.16,-106.36C250.76,-107.82 261.23,-109.25 271.18,-110.62"/>
<polygon fill="#666666" stroke="#666666" points="270.95,-114.12 281.33,-112.01 271.9,-107.19 270.95,-114.12"/>
</g>
<!-- Peer__read_index&#45;&gt;raft_group__read_index -->
<g id="edge9" class="edge">
<title>Peer__read_index&#45;&gt;raft_group__read_index</title>
<path fill="none" stroke="#666666" d="M240.14,-76.83C303.01,-69.88 378.63,-61.52 435.25,-55.26"/>
<polygon fill="#666666" stroke="#666666" points="435.68,-58.73 445.24,-54.15 434.91,-51.77 435.68,-58.73"/>
</g>
<!-- Peer__step -->
<g id="node11" class="node">
<title>Peer__step</title>
<path fill="none" stroke="#1c2123" d="M18,-215.5C18,-215.5 222,-215.5 222,-215.5 228,-215.5 234,-221.5 234,-227.5 234,-227.5 234,-324.5 234,-324.5 234,-330.5 228,-336.5 222,-336.5 222,-336.5 18,-336.5 18,-336.5 12,-336.5 6,-330.5 6,-324.5 6,-324.5 6,-227.5 6,-227.5 6,-221.5 12,-215.5 18,-215.5"/>
<text text-anchor="start" x="14" y="-321.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="14" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> step</text>
<polyline fill="none" stroke="#1c2123" points="6,-298.5 234,-298.5 "/>
<text text-anchor="start" x="14" y="-283.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader节点收到</text>
<text text-anchor="start" x="14" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower的readIndex请求</text>
<text text-anchor="start" x="14" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查read_range_check</text>
<text text-anchor="start" x="14" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并将Lockinfo放到ReadIndexContext</text>
<text text-anchor="start" x="14" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 中返回给follower</text>
</g>
<!-- Peer__step&#45;&gt;CoprocessorHost__on_step_read_index -->
<g id="edge10" class="edge">
<title>Peer__step&#45;&gt;CoprocessorHost__on_step_read_index</title>
<path fill="none" stroke="#666666" d="M234.09,-276C244.87,-276 255.6,-276 265.85,-276"/>
<polygon fill="#666666" stroke="#666666" points="265.94,-279.5 275.94,-276 265.94,-272.5 265.94,-279.5"/>
</g>
</g>
</svg>
