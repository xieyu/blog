<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handleSingleBatch Pages: 1 -->
<svg width="782pt" height="387pt"
 viewBox="0.00 0.00 782.00 386.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 382.5)">
<title>handleSingleBatch</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-382.5 778,-382.5 778,4 -4,4"/>
<!-- handleSingleBatch -->
<g id="node1" class="node">
<title>handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M12,-205.5C12,-205.5 107,-205.5 107,-205.5 113,-205.5 119,-211.5 119,-217.5 119,-217.5 119,-239.5 119,-239.5 119,-245.5 113,-251.5 107,-251.5 107,-251.5 12,-251.5 12,-251.5 6,-251.5 0,-245.5 0,-239.5 0,-239.5 0,-217.5 0,-217.5 0,-211.5 6,-205.5 12,-205.5"/>
<text text-anchor="middle" x="59.5" y="-236.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit</text>
<polyline fill="none" stroke="#1c2123" points="0,-228.5 119,-228.5 "/>
<text text-anchor="middle" x="59.5" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
</g>
<!-- CommitRequest -->
<g id="node2" class="node">
<title>CommitRequest</title>
<path fill="none" stroke="#1c2123" d="M616,-263C616,-263 762,-263 762,-263 768,-263 774,-269 774,-275 774,-275 774,-366 774,-366 774,-372 768,-378 762,-378 762,-378 616,-378 616,-378 610,-378 604,-372 604,-366 604,-366 604,-275 604,-275 604,-269 610,-263 616,-263"/>
<text text-anchor="middle" x="689" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitRequest</text>
<polyline fill="none" stroke="#1c2123" points="604,-355 774,-355 "/>
<text text-anchor="start" x="612" y="-339.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Context context = 1;</text>
<polyline fill="none" stroke="#1c2123" points="604,-332 774,-332 "/>
<text text-anchor="start" x="612" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 start_version = 2;</text>
<polyline fill="none" stroke="#1c2123" points="604,-309 774,-309 "/>
<text text-anchor="start" x="612" y="-293.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">repeated bytes keys = 3;</text>
<polyline fill="none" stroke="#1c2123" points="604,-286 774,-286 "/>
<text text-anchor="start" x="612" y="-270.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 commit_version = 4;</text>
</g>
<!-- handleSingleBatch&#45;&gt;CommitRequest -->
<g id="edge1" class="edge">
<title>handleSingleBatch&#45;&gt;CommitRequest</title>
<path fill="none" stroke="#666666" d="M75.23,-251.9C91.49,-275.31 120.05,-309.86 155,-324.5 298.6,-384.65 483.67,-364.01 593.67,-342.79"/>
<polygon fill="#666666" stroke="#666666" points="594.62,-346.17 603.75,-340.8 593.26,-339.3 594.62,-346.17"/>
</g>
<!-- NewRegionRequestSender -->
<g id="node3" class="node">
<title>NewRegionRequestSender</title>
<path fill="none" stroke="#1c2123" d="M308.5,-315.5C308.5,-315.5 170.5,-315.5 170.5,-315.5 164.5,-315.5 158.5,-309.5 158.5,-303.5 158.5,-303.5 158.5,-291.5 158.5,-291.5 158.5,-285.5 164.5,-279.5 170.5,-279.5 170.5,-279.5 308.5,-279.5 308.5,-279.5 314.5,-279.5 320.5,-285.5 320.5,-291.5 320.5,-291.5 320.5,-303.5 320.5,-303.5 320.5,-309.5 314.5,-315.5 308.5,-315.5"/>
<text text-anchor="middle" x="239.5" y="-293.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">NewRegionRequestSender</text>
</g>
<!-- handleSingleBatch&#45;&gt;NewRegionRequestSender -->
<g id="edge2" class="edge">
<title>handleSingleBatch&#45;&gt;NewRegionRequestSender</title>
<path fill="none" stroke="#666666" d="M119.2,-251.56C131.05,-256.19 143.42,-261.01 155,-265.5 163.61,-268.84 172.73,-272.35 181.65,-275.78"/>
<polygon fill="#666666" stroke="#666666" points="180.64,-279.14 191.23,-279.45 183.14,-272.6 180.64,-279.14"/>
</g>
<!-- SendReq -->
<g id="node4" class="node">
<title>SendReq</title>
<path fill="none" stroke="#1c2123" d="M484.5,-315.5C484.5,-315.5 443.5,-315.5 443.5,-315.5 437.5,-315.5 431.5,-309.5 431.5,-303.5 431.5,-303.5 431.5,-291.5 431.5,-291.5 431.5,-285.5 437.5,-279.5 443.5,-279.5 443.5,-279.5 484.5,-279.5 484.5,-279.5 490.5,-279.5 496.5,-285.5 496.5,-291.5 496.5,-291.5 496.5,-303.5 496.5,-303.5 496.5,-309.5 490.5,-315.5 484.5,-315.5"/>
<text text-anchor="middle" x="464" y="-293.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SendReq</text>
</g>
<!-- handleSingleBatch&#45;&gt;SendReq -->
<g id="edge3" class="edge">
<title>handleSingleBatch&#45;&gt;SendReq</title>
<path fill="none" stroke="#666666" d="M119.2,-237.28C172.66,-245.41 253.75,-258.08 324,-270.5 356.73,-276.29 393.67,-283.49 421.24,-289.01"/>
<polygon fill="#666666" stroke="#666666" points="420.82,-292.49 431.31,-291.03 422.2,-285.63 420.82,-292.49"/>
</g>
<!-- GetRegionError -->
<g id="node5" class="node">
<title>GetRegionError</title>
<path fill="none" stroke="#1c2123" d="M279.5,-223.5C279.5,-223.5 199.5,-223.5 199.5,-223.5 193.5,-223.5 187.5,-217.5 187.5,-211.5 187.5,-211.5 187.5,-199.5 187.5,-199.5 187.5,-193.5 193.5,-187.5 199.5,-187.5 199.5,-187.5 279.5,-187.5 279.5,-187.5 285.5,-187.5 291.5,-193.5 291.5,-199.5 291.5,-199.5 291.5,-211.5 291.5,-211.5 291.5,-217.5 285.5,-223.5 279.5,-223.5"/>
<text text-anchor="middle" x="239.5" y="-201.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetRegionError</text>
</g>
<!-- handleSingleBatch&#45;&gt;GetRegionError -->
<g id="edge4" class="edge">
<title>handleSingleBatch&#45;&gt;GetRegionError</title>
<path fill="none" stroke="#666666" d="M119.28,-220.91C137.9,-218.5 158.53,-215.83 177.33,-213.4"/>
<polygon fill="#666666" stroke="#666666" points="177.79,-216.87 187.26,-212.12 176.89,-209.93 177.79,-216.87"/>
</g>
<!-- GetCommitTsExpired -->
<g id="node6" class="node">
<title>GetCommitTsExpired</title>
<path fill="none" stroke="#1c2123" d="M167,-0.5C167,-0.5 312,-0.5 312,-0.5 318,-0.5 324,-6.5 324,-12.5 324,-12.5 324,-64.5 324,-64.5 324,-70.5 318,-76.5 312,-76.5 312,-76.5 167,-76.5 167,-76.5 161,-76.5 155,-70.5 155,-64.5 155,-64.5 155,-12.5 155,-12.5 155,-6.5 161,-0.5 167,-0.5"/>
<text text-anchor="middle" x="239.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetCommitTsExpired</text>
<polyline fill="none" stroke="#1c2123" points="155,-53.5 324,-53.5 "/>
<text text-anchor="start" x="163" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitTs rejected by Tikv</text>
<text text-anchor="start" x="163" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重新获取一个commit ts</text>
<text text-anchor="start" x="163" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重新提交</text>
</g>
<!-- handleSingleBatch&#45;&gt;GetCommitTsExpired -->
<g id="edge5" class="edge">
<title>handleSingleBatch&#45;&gt;GetCommitTsExpired</title>
<path fill="none" stroke="#666666" d="M71.54,-205.49C86.9,-175.27 117.18,-121.93 155,-86.5 156.26,-85.32 157.55,-84.16 158.87,-83.02"/>
<polygon fill="#666666" stroke="#666666" points="161.16,-85.67 166.73,-76.66 156.76,-80.23 161.16,-85.67"/>
</g>
<!-- NewRegionRequestSender&#45;&gt;SendReq -->
<g id="edge6" class="edge">
<title>NewRegionRequestSender&#45;&gt;SendReq</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M320.51,-297.5C354.54,-297.5 392.81,-297.5 421.11,-297.5"/>
<polygon fill="green" stroke="green" points="421.44,-301 431.44,-297.5 421.44,-294 421.44,-301"/>
</g>
<!-- SendReq&#45;&gt;CommitRequest -->
<g id="edge7" class="edge">
<title>SendReq&#45;&gt;CommitRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M496.95,-300.8C522.27,-303.41 559.01,-307.2 593.52,-310.76"/>
<polygon fill="green" stroke="green" points="593.36,-314.26 603.67,-311.8 594.08,-307.29 593.36,-314.26"/>
</g>
<!-- doActionOnMutations -->
<g id="node7" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M382,-121.5C382,-121.5 546,-121.5 546,-121.5 552,-121.5 558,-127.5 558,-133.5 558,-133.5 558,-185.5 558,-185.5 558,-191.5 552,-197.5 546,-197.5 546,-197.5 382,-197.5 382,-197.5 376,-197.5 370,-191.5 370,-185.5 370,-185.5 370,-133.5 370,-133.5 370,-127.5 376,-121.5 382,-121.5"/>
<text text-anchor="middle" x="464" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="370,-174.5 558,-174.5 "/>
<text text-anchor="start" x="378" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">有regionErr，重新对key分组</text>
<text text-anchor="start" x="378" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后重新提交</text>
<text text-anchor="start" x="378" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> actionCommit{retry:true}</text>
</g>
<!-- GetRegionError&#45;&gt;doActionOnMutations -->
<g id="edge8" class="edge">
<title>GetRegionError&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M291.55,-194.95C311.87,-190.75 336.02,-185.75 359.69,-180.86"/>
<polygon fill="green" stroke="green" points="360.71,-184.22 369.79,-178.77 359.29,-177.37 360.71,-184.22"/>
</g>
<!-- KVStore__getTimestampWithRetry -->
<g id="node8" class="node">
<title>KVStore__getTimestampWithRetry</title>
<path fill="none" stroke="#1c2123" d="M372,-15.5C372,-15.5 556,-15.5 556,-15.5 562,-15.5 568,-21.5 568,-27.5 568,-27.5 568,-49.5 568,-49.5 568,-55.5 562,-61.5 556,-61.5 556,-61.5 372,-61.5 372,-61.5 366,-61.5 360,-55.5 360,-49.5 360,-49.5 360,-27.5 360,-27.5 360,-21.5 366,-15.5 372,-15.5"/>
<text text-anchor="middle" x="464" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">KVStore::getTimestampWithRetry</text>
<polyline fill="none" stroke="#1c2123" points="360,-38.5 568,-38.5 "/>
<text text-anchor="start" x="368" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取新的commit ts</text>
</g>
<!-- GetCommitTsExpired&#45;&gt;KVStore__getTimestampWithRetry -->
<g id="edge9" class="edge">
<title>GetCommitTsExpired&#45;&gt;KVStore__getTimestampWithRetry</title>
<path fill="none" stroke="#666666" d="M324.3,-38.5C332.62,-38.5 341.16,-38.5 349.72,-38.5"/>
<polygon fill="#666666" stroke="#666666" points="349.76,-42 359.76,-38.5 349.76,-35 349.76,-42"/>
</g>
<!-- doActionOnMutations&#45;&gt;handleSingleBatch -->
<g id="edge11" class="edge">
<title>doActionOnMutations&#45;&gt;handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M370,-155.11C307.99,-154.63 225.27,-158.74 155,-178.5 137.52,-183.41 119.61,-191.87 104.14,-200.45"/>
<polygon fill="green" stroke="green" points="102.28,-197.48 95.34,-205.48 105.75,-203.56 102.28,-197.48"/>
</g>
<!-- commitMutations -->
<g id="node9" class="node">
<title>commitMutations</title>
<path fill="none" stroke="#1c2123" d="M285,-131.5C285,-131.5 194,-131.5 194,-131.5 188,-131.5 182,-125.5 182,-119.5 182,-119.5 182,-107.5 182,-107.5 182,-101.5 188,-95.5 194,-95.5 194,-95.5 285,-95.5 285,-95.5 291,-95.5 297,-101.5 297,-107.5 297,-107.5 297,-119.5 297,-119.5 297,-125.5 291,-131.5 285,-131.5"/>
<text text-anchor="middle" x="239.5" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitMutations</text>
</g>
<!-- commitMutations&#45;&gt;doActionOnMutations -->
<g id="edge10" class="edge">
<title>commitMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M297.22,-125.23C316.31,-129.17 338.25,-133.71 359.79,-138.16"/>
<polygon fill="#666666" stroke="#666666" points="359.14,-141.6 369.64,-140.2 360.56,-134.75 359.14,-141.6"/>
</g>
</g>
</svg>
