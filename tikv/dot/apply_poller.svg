<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: apply_poller Pages: 1 -->
<svg width="1249pt" height="295pt"
 viewBox="0.00 0.00 1249.00 294.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 290.5)">
<title>apply_poller</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-290.5 1245,-290.5 1245,4 -4,4"/>
<!-- poll -->
<g id="node1" class="node">
<title>poll</title>
<path fill="none" stroke="#1c2123" d="M42,-171.5C42,-171.5 12,-171.5 12,-171.5 6,-171.5 0,-165.5 0,-159.5 0,-159.5 0,-147.5 0,-147.5 0,-141.5 6,-135.5 12,-135.5 12,-135.5 42,-135.5 42,-135.5 48,-135.5 54,-141.5 54,-147.5 54,-147.5 54,-159.5 54,-159.5 54,-165.5 48,-171.5 42,-171.5"/>
<text text-anchor="middle" x="27" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll</text>
</g>
<!-- begin -->
<g id="node2" class="node">
<title>begin</title>
<path fill="none" stroke="#1c2123" d="M188,-286.5C188,-286.5 158,-286.5 158,-286.5 152,-286.5 146,-280.5 146,-274.5 146,-274.5 146,-262.5 146,-262.5 146,-256.5 152,-250.5 158,-250.5 158,-250.5 188,-250.5 188,-250.5 194,-250.5 200,-256.5 200,-262.5 200,-262.5 200,-274.5 200,-274.5 200,-280.5 194,-286.5 188,-286.5"/>
<text text-anchor="middle" x="173" y="-264.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">begin</text>
</g>
<!-- poll&#45;&gt;begin -->
<g id="edge1" class="edge">
<title>poll&#45;&gt;begin</title>
<path fill="none" stroke="#666666" d="M36.36,-171.63C46.4,-191.51 65.07,-223.03 90,-241.5 103.31,-251.36 120.41,-257.74 135.54,-261.8"/>
<polygon fill="#666666" stroke="#666666" points="135.09,-265.29 145.64,-264.26 136.75,-258.49 135.09,-265.29"/>
</g>
<!-- handle_control -->
<g id="node3" class="node">
<title>handle_control</title>
<path fill="none" stroke="#1c2123" d="M113.5,-155.5C113.5,-155.5 232.5,-155.5 232.5,-155.5 238.5,-155.5 244.5,-161.5 244.5,-167.5 244.5,-167.5 244.5,-219.5 244.5,-219.5 244.5,-225.5 238.5,-231.5 232.5,-231.5 232.5,-231.5 113.5,-231.5 113.5,-231.5 107.5,-231.5 101.5,-225.5 101.5,-219.5 101.5,-219.5 101.5,-167.5 101.5,-167.5 101.5,-161.5 107.5,-155.5 113.5,-155.5"/>
<text text-anchor="middle" x="173" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_control</text>
<polyline fill="none" stroke="#1c2123" points="101.5,-208.5 244.5,-208.5 "/>
<text text-anchor="start" x="109.5" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">unimplemented!()</text>
<text text-anchor="start" x="109.5" y="-178.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ApplyPoller没有实现</text>
<text text-anchor="start" x="109.5" y="-163.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle control</text>
</g>
<!-- poll&#45;&gt;handle_control -->
<g id="edge2" class="edge">
<title>poll&#45;&gt;handle_control</title>
<path fill="none" stroke="#666666" d="M54.08,-160.74C64.84,-163.73 77.95,-167.37 91.47,-171.13"/>
<polygon fill="#666666" stroke="#666666" points="90.78,-174.57 101.35,-173.88 92.65,-167.83 90.78,-174.57"/>
</g>
<!-- handle_normal -->
<g id="node4" class="node">
<title>handle_normal</title>
<path fill="none" stroke="#1c2123" d="M110.5,-90.5C110.5,-90.5 235.5,-90.5 235.5,-90.5 241.5,-90.5 247.5,-96.5 247.5,-102.5 247.5,-102.5 247.5,-124.5 247.5,-124.5 247.5,-130.5 241.5,-136.5 235.5,-136.5 235.5,-136.5 110.5,-136.5 110.5,-136.5 104.5,-136.5 98.5,-130.5 98.5,-124.5 98.5,-124.5 98.5,-102.5 98.5,-102.5 98.5,-96.5 104.5,-90.5 110.5,-90.5"/>
<text text-anchor="middle" x="173" y="-121.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_normal</text>
<polyline fill="none" stroke="#1c2123" points="98.5,-113.5 247.5,-113.5 "/>
<text text-anchor="start" x="106.5" y="-98.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将更改写入write batch</text>
</g>
<!-- poll&#45;&gt;handle_normal -->
<g id="edge3" class="edge">
<title>poll&#45;&gt;handle_normal</title>
<path fill="none" stroke="#666666" d="M54.08,-146.26C63.99,-143.5 75.9,-140.2 88.28,-136.76"/>
<polygon fill="#666666" stroke="#666666" points="89.58,-140.03 98.28,-133.98 87.71,-133.28 89.58,-140.03"/>
</g>
<!-- end -->
<g id="node5" class="node">
<title>end</title>
<path fill="none" stroke="#1c2123" d="M102,-25.5C102,-25.5 244,-25.5 244,-25.5 250,-25.5 256,-31.5 256,-37.5 256,-37.5 256,-59.5 256,-59.5 256,-65.5 250,-71.5 244,-71.5 244,-71.5 102,-71.5 102,-71.5 96,-71.5 90,-65.5 90,-59.5 90,-59.5 90,-37.5 90,-37.5 90,-31.5 96,-25.5 102,-25.5"/>
<text text-anchor="middle" x="173" y="-56.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">end</text>
<polyline fill="none" stroke="#1c2123" points="90,-48.5 256,-48.5 "/>
<text text-anchor="start" x="98" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将kv write batch写入磁盘</text>
</g>
<!-- poll&#45;&gt;end -->
<g id="edge4" class="edge">
<title>poll&#45;&gt;end</title>
<path fill="none" stroke="#666666" d="M39.54,-135.36C50.71,-119.07 69.01,-95.46 90,-80.5 91.82,-79.2 93.7,-77.95 95.63,-76.74"/>
<polygon fill="#666666" stroke="#666666" points="97.43,-79.74 104.33,-71.7 93.92,-73.68 97.43,-79.74"/>
</g>
<!-- ApplyFsm_reciver_try_recv -->
<g id="node6" class="node">
<title>ApplyFsm_reciver_try_recv</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M304,-128C304,-128 437,-128 437,-128 443,-128 449,-134 449,-140 449,-140 449,-207 449,-207 449,-213 443,-219 437,-219 437,-219 304,-219 304,-219 298,-219 292,-213 292,-207 292,-207 292,-140 292,-140 292,-134 298,-128 304,-128"/>
<text text-anchor="start" x="300" y="-203.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ApplyFsm</text>
<text text-anchor="start" x="300" y="-188.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> reciver.try_recv()</text>
<polyline fill="none" stroke="#8a8898" points="292,-181 449,-181 "/>
<text text-anchor="start" x="300" y="-165.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">non block的从ApplyFsm</text>
<text text-anchor="start" x="300" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 读取消息最多读取</text>
<text text-anchor="start" x="300" y="-135.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> messages_per_tick</text>
</g>
<!-- handle_normal&#45;&gt;ApplyFsm_reciver_try_recv -->
<g id="edge6" class="edge">
<title>handle_normal&#45;&gt;ApplyFsm_reciver_try_recv</title>
<path fill="none" stroke="#666666" d="M247.63,-136.1C258.88,-139.55 270.58,-143.14 282.09,-146.67"/>
<polygon fill="#666666" stroke="#666666" points="281.11,-150.03 291.69,-149.62 283.16,-143.34 281.11,-150.03"/>
</g>
<!-- ApplyFsm_handle_tasks -->
<g id="node7" class="node">
<title>ApplyFsm_handle_tasks</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M497,-94C497,-94 641,-94 641,-94 647,-94 653,-100 653,-106 653,-106 653,-181 653,-181 653,-187 647,-193 641,-193 641,-193 497,-193 497,-193 491,-193 485,-187 485,-181 485,-181 485,-106 485,-106 485,-100 491,-94 497,-94"/>
<text text-anchor="start" x="493" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ApplyFsm</text>
<text text-anchor="start" x="493" y="-162.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> handle_tasks</text>
<polyline fill="none" stroke="#8a8898" points="485,-155 653,-155 "/>
<text text-anchor="start" x="493" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">处理kv(包括snapshot)</text>
<text text-anchor="start" x="493" y="-124.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的写入和 apply state更新</text>
<polyline fill="none" stroke="#8a8898" points="485,-117 653,-117 "/>
<text text-anchor="start" x="493" y="-101.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">更改会先写入kv_wb</text>
</g>
<!-- handle_normal&#45;&gt;ApplyFsm_handle_tasks -->
<g id="edge7" class="edge">
<title>handle_normal&#45;&gt;ApplyFsm_handle_tasks</title>
<path fill="none" stroke="#666666" d="M247.78,-111.08C303.29,-110.16 381.15,-110.83 449,-118.5 457.37,-119.45 466.02,-120.7 474.66,-122.16"/>
<polygon fill="#666666" stroke="#666666" points="474.32,-125.65 484.78,-123.94 475.54,-118.76 474.32,-125.65"/>
</g>
<!-- ApplyContext_flush -->
<g id="node8" class="node">
<title>ApplyContext_flush</title>
<path fill="#feed9b" stroke="#f7e495" d="M935,-10.5C935,-10.5 1020,-10.5 1020,-10.5 1026,-10.5 1032,-16.5 1032,-22.5 1032,-22.5 1032,-74.5 1032,-74.5 1032,-80.5 1026,-86.5 1020,-86.5 1020,-86.5 935,-86.5 935,-86.5 929,-86.5 923,-80.5 923,-74.5 923,-74.5 923,-22.5 923,-22.5 923,-16.5 929,-10.5 935,-10.5"/>
<text text-anchor="middle" x="977.5" y="-71.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyContext</text>
<text text-anchor="middle" x="977.5" y="-56.3" font-family="Times,serif" font-size="14.00" fill="#40575d">flush</text>
<polyline fill="none" stroke="#f7e495" points="923,-48.5 1032,-48.5 "/>
<text text-anchor="start" x="931" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#40575d">将kv write batch</text>
<text text-anchor="start" x="931" y="-18.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 写入磁盘</text>
</g>
<!-- end&#45;&gt;ApplyContext_flush -->
<g id="edge8" class="edge">
<title>end&#45;&gt;ApplyContext_flush</title>
<path fill="none" stroke="#666666" d="M256.11,-48.5C416.54,-48.5 768.53,-48.5 912.85,-48.5"/>
<polygon fill="#666666" stroke="#666666" points="912.88,-52 922.88,-48.5 912.88,-45 912.88,-52"/>
</g>
<!-- ApplyFsm_reciver_try_recv&#45;&gt;ApplyFsm_handle_tasks -->
<g id="edge5" class="edge">
<title>ApplyFsm_reciver_try_recv&#45;&gt;ApplyFsm_handle_tasks</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M449.16,-161.64C457.57,-160.36 466.18,-159.04 474.75,-157.74"/>
<polygon fill="green" stroke="green" points="475.4,-161.18 484.76,-156.21 474.35,-154.26 475.4,-161.18"/>
</g>
<!-- ApplyFsmDelegate_apply_raft_cmd -->
<g id="node9" class="node">
<title>ApplyFsmDelegate_apply_raft_cmd</title>
<path fill="none" stroke="#1c2123" d="M736.5,-177.5C736.5,-177.5 839.5,-177.5 839.5,-177.5 845.5,-177.5 851.5,-183.5 851.5,-189.5 851.5,-189.5 851.5,-241.5 851.5,-241.5 851.5,-247.5 845.5,-253.5 839.5,-253.5 839.5,-253.5 736.5,-253.5 736.5,-253.5 730.5,-253.5 724.5,-247.5 724.5,-241.5 724.5,-241.5 724.5,-189.5 724.5,-189.5 724.5,-183.5 730.5,-177.5 736.5,-177.5"/>
<text text-anchor="middle" x="788" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyFsmDelegate</text>
<text text-anchor="middle" x="788" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_raft_cmd</text>
<polyline fill="none" stroke="#1c2123" points="724.5,-215.5 851.5,-215.5 "/>
<text text-anchor="start" x="732.5" y="-200.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将raftcmd 更改</text>
<text text-anchor="start" x="732.5" y="-185.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 写入kv write batch</text>
</g>
<!-- ApplyFsm_handle_tasks&#45;&gt;ApplyFsmDelegate_apply_raft_cmd -->
<g id="edge9" class="edge">
<title>ApplyFsm_handle_tasks&#45;&gt;ApplyFsmDelegate_apply_raft_cmd</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M653.28,-171.13C673.51,-177.84 694.99,-184.97 714.67,-191.5"/>
<polygon fill="green" stroke="green" points="713.58,-194.83 724.17,-194.65 715.78,-188.18 713.58,-194.83"/>
</g>
<!-- ApplyFsmDelegate_write_apply_state -->
<g id="node10" class="node">
<title>ApplyFsmDelegate_write_apply_state</title>
<path fill="none" stroke="#1c2123" d="M701,-82.5C701,-82.5 875,-82.5 875,-82.5 881,-82.5 887,-88.5 887,-94.5 887,-94.5 887,-146.5 887,-146.5 887,-152.5 881,-158.5 875,-158.5 875,-158.5 701,-158.5 701,-158.5 695,-158.5 689,-152.5 689,-146.5 689,-146.5 689,-94.5 689,-94.5 689,-88.5 695,-82.5 701,-82.5"/>
<text text-anchor="middle" x="788" y="-143.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyFsmDelegate</text>
<text text-anchor="middle" x="788" y="-128.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write_apply_state</text>
<polyline fill="none" stroke="#1c2123" points="689,-120.5 887,-120.5 "/>
<text text-anchor="start" x="697" y="-105.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将applyState写入kv write batch</text>
<text text-anchor="start" x="697" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 写入的CF Family 为CF_RAFT</text>
</g>
<!-- ApplyFsm_handle_tasks&#45;&gt;ApplyFsmDelegate_write_apply_state -->
<g id="edge10" class="edge">
<title>ApplyFsm_handle_tasks&#45;&gt;ApplyFsmDelegate_write_apply_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M653.28,-134.67C661.61,-133.79 670.15,-132.88 678.69,-131.98"/>
<polygon fill="green" stroke="green" points="679.13,-135.45 688.71,-130.92 678.39,-128.49 679.13,-135.45"/>
</g>
<!-- ApplyContext_write_to_db -->
<g id="node12" class="node">
<title>ApplyContext_write_to_db</title>
<path fill="#feed9b" stroke="#f7e495" d="M1112,-95.5C1112,-95.5 1197,-95.5 1197,-95.5 1203,-95.5 1209,-101.5 1209,-107.5 1209,-107.5 1209,-159.5 1209,-159.5 1209,-165.5 1203,-171.5 1197,-171.5 1197,-171.5 1112,-171.5 1112,-171.5 1106,-171.5 1100,-165.5 1100,-159.5 1100,-159.5 1100,-107.5 1100,-107.5 1100,-101.5 1106,-95.5 1112,-95.5"/>
<text text-anchor="middle" x="1154.5" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyContext</text>
<text text-anchor="middle" x="1154.5" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#40575d">write_to_db</text>
<polyline fill="none" stroke="#f7e495" points="1100,-133.5 1209,-133.5 "/>
<text text-anchor="start" x="1108" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#40575d">将kv write batch</text>
<text text-anchor="start" x="1108" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 更改写入磁盘</text>
</g>
<!-- ApplyContext_flush&#45;&gt;ApplyContext_write_to_db -->
<g id="edge13" class="edge">
<title>ApplyContext_flush&#45;&gt;ApplyContext_write_to_db</title>
<path fill="none" stroke="#666666" d="M1032.43,-74.7C1050.82,-83.63 1071.53,-93.69 1090.56,-102.93"/>
<polygon fill="#666666" stroke="#666666" points="1089.22,-106.17 1099.74,-107.39 1092.28,-99.87 1089.22,-106.17"/>
</g>
<!-- ApplyContext_notifier_notify_apply_res -->
<g id="node13" class="node">
<title>ApplyContext_notifier_notify_apply_res</title>
<path fill="#de3737" stroke="#000000" d="M1080,-0.5C1080,-0.5 1229,-0.5 1229,-0.5 1235,-0.5 1241,-6.5 1241,-12.5 1241,-12.5 1241,-64.5 1241,-64.5 1241,-70.5 1235,-76.5 1229,-76.5 1229,-76.5 1080,-76.5 1080,-76.5 1074,-76.5 1068,-70.5 1068,-64.5 1068,-64.5 1068,-12.5 1068,-12.5 1068,-6.5 1074,-0.5 1080,-0.5"/>
<text text-anchor="middle" x="1154.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#ffffff">ApplyContext</text>
<text text-anchor="middle" x="1154.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#ffffff"> notifier.notify(apply_res)</text>
<polyline fill="none" stroke="#000000" points="1068,-38.5 1241,-38.5 "/>
<text text-anchor="start" x="1076" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#ffffff">遍历apply_res</text>
<text text-anchor="start" x="1076" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#ffffff"> 发送ApplyRes给RaftPoller</text>
</g>
<!-- ApplyContext_flush&#45;&gt;ApplyContext_notifier_notify_apply_res -->
<g id="edge14" class="edge">
<title>ApplyContext_flush&#45;&gt;ApplyContext_notifier_notify_apply_res</title>
<path fill="none" stroke="#666666" d="M1032.43,-45.42C1040.52,-44.96 1049.05,-44.47 1057.7,-43.97"/>
<polygon fill="#666666" stroke="#666666" points="1058.09,-47.46 1067.87,-43.39 1057.69,-40.47 1058.09,-47.46"/>
</g>
<!-- ApplyContext_kv_wb_mut -->
<g id="node11" class="node">
<title>ApplyContext_kv_wb_mut</title>
<path fill="#feed9b" stroke="#f7e495" d="M943,-114.5C943,-114.5 1012,-114.5 1012,-114.5 1018,-114.5 1024,-120.5 1024,-126.5 1024,-126.5 1024,-140.5 1024,-140.5 1024,-146.5 1018,-152.5 1012,-152.5 1012,-152.5 943,-152.5 943,-152.5 937,-152.5 931,-146.5 931,-140.5 931,-140.5 931,-126.5 931,-126.5 931,-120.5 937,-114.5 943,-114.5"/>
<text text-anchor="middle" x="977.5" y="-137.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyContext</text>
<text text-anchor="middle" x="977.5" y="-122.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> kv_wb_mut</text>
</g>
<!-- ApplyFsmDelegate_apply_raft_cmd&#45;&gt;ApplyContext_kv_wb_mut -->
<g id="edge11" class="edge">
<title>ApplyFsmDelegate_apply_raft_cmd&#45;&gt;ApplyContext_kv_wb_mut</title>
<path fill="none" stroke="#666666" d="M851.7,-188.08C874.98,-177.9 901.15,-166.45 923.49,-156.68"/>
<polygon fill="#666666" stroke="#666666" points="925.05,-159.82 932.81,-152.61 922.25,-153.41 925.05,-159.82"/>
</g>
<!-- ApplyFsmDelegate_write_apply_state&#45;&gt;ApplyContext_kv_wb_mut -->
<g id="edge12" class="edge">
<title>ApplyFsmDelegate_write_apply_state&#45;&gt;ApplyContext_kv_wb_mut</title>
<path fill="none" stroke="#666666" d="M887.14,-127.3C898.57,-128.1 909.92,-128.88 920.49,-129.62"/>
<polygon fill="#666666" stroke="#666666" points="920.56,-133.13 930.78,-130.33 921.05,-126.15 920.56,-133.13"/>
</g>
<!-- ApplyContext_kv_wb_mut&#45;&gt;ApplyContext_write_to_db -->
<g id="edge15" class="edge">
<title>ApplyContext_kv_wb_mut&#45;&gt;ApplyContext_write_to_db</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1024.02,-133.5C1044.04,-133.5 1067.91,-133.5 1089.66,-133.5"/>
<polygon fill="green" stroke="green" points="1089.81,-137 1099.81,-133.5 1089.81,-130 1089.81,-137"/>
</g>
</g>
</svg>
