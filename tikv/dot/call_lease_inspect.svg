<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: call_lease_inspect Pages: 1 -->
<svg width="2177pt" height="477pt"
 viewBox="0.00 0.00 2177.00 476.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 472.5)">
<title>call_lease_inspect</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-472.5 2173,-472.5 2173,4 -4,4"/>
<!-- Lease__inspect -->
<g id="node1" class="node">
<title>Lease__inspect</title>
<path fill="none" stroke="#1c2123" d="M1624,-358.5C1624,-358.5 1758,-358.5 1758,-358.5 1764,-358.5 1770,-364.5 1770,-370.5 1770,-370.5 1770,-422.5 1770,-422.5 1770,-428.5 1764,-434.5 1758,-434.5 1758,-434.5 1624,-434.5 1624,-434.5 1618,-434.5 1612,-428.5 1612,-422.5 1612,-422.5 1612,-370.5 1612,-370.5 1612,-364.5 1618,-358.5 1624,-358.5"/>
<text text-anchor="start" x="1620" y="-419.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease</text>
<text text-anchor="start" x="1620" y="-404.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect</text>
<polyline fill="none" stroke="#1c2123" points="1612,-396.5 1770,-396.5 "/>
<text text-anchor="start" x="1620" y="-381.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease为Peer的成员变量</text>
<text text-anchor="start" x="1620" y="-366.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> leader_lease</text>
</g>
<!-- LeaseState -->
<g id="node2" class="node">
<title>LeaseState</title>
<path fill="none" stroke="#1c2123" d="M1934,-339.5C1934,-339.5 1883,-339.5 1883,-339.5 1877,-339.5 1871,-333.5 1871,-327.5 1871,-327.5 1871,-315.5 1871,-315.5 1871,-309.5 1877,-303.5 1883,-303.5 1883,-303.5 1934,-303.5 1934,-303.5 1940,-303.5 1946,-309.5 1946,-315.5 1946,-315.5 1946,-327.5 1946,-327.5 1946,-333.5 1940,-339.5 1934,-339.5"/>
<text text-anchor="middle" x="1908.5" y="-317.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaseState</text>
</g>
<!-- Lease__inspect&#45;&gt;LeaseState -->
<g id="edge1" class="edge">
<title>Lease__inspect&#45;&gt;LeaseState</title>
<path fill="none" stroke="#666666" d="M1770.33,-365.68C1786.04,-359.77 1802.49,-353.79 1818,-348.5 1831.85,-343.78 1847.03,-339.04 1860.91,-334.87"/>
<polygon fill="#666666" stroke="#666666" points="1862.15,-338.16 1870.73,-331.95 1860.15,-331.45 1862.15,-338.16"/>
</g>
<!-- Lease__expire -->
<g id="node21" class="node">
<title>Lease__expire</title>
<path fill="none" stroke="#1c2123" d="M1830,-358.5C1830,-358.5 1987,-358.5 1987,-358.5 1993,-358.5 1999,-364.5 1999,-370.5 1999,-370.5 1999,-422.5 1999,-422.5 1999,-428.5 1993,-434.5 1987,-434.5 1987,-434.5 1830,-434.5 1830,-434.5 1824,-434.5 1818,-428.5 1818,-422.5 1818,-422.5 1818,-370.5 1818,-370.5 1818,-364.5 1824,-358.5 1830,-358.5"/>
<text text-anchor="start" x="1826" y="-419.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease</text>
<text text-anchor="start" x="1826" y="-404.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> expire</text>
<polyline fill="none" stroke="#1c2123" points="1818,-396.5 1999,-396.5 "/>
<text text-anchor="start" x="1826" y="-381.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果Peer的lease expire了</text>
<text text-anchor="start" x="1826" y="-366.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 把remoteLease的也expire了</text>
</g>
<!-- Lease__inspect&#45;&gt;Lease__expire -->
<g id="edge25" class="edge">
<title>Lease__inspect&#45;&gt;Lease__expire</title>
<path fill="none" stroke="#666666" d="M1770.11,-396.5C1782.37,-396.5 1795.18,-396.5 1807.85,-396.5"/>
<polygon fill="#666666" stroke="#666666" points="1807.96,-400 1817.96,-396.5 1807.96,-393 1807.96,-400"/>
</g>
<!-- Peer__apply_reads -->
<g id="node3" class="node">
<title>Peer__apply_reads</title>
<path fill="none" stroke="#1c2123" d="M1535.5,-414.5C1535.5,-414.5 1440.5,-414.5 1440.5,-414.5 1434.5,-414.5 1428.5,-408.5 1428.5,-402.5 1428.5,-402.5 1428.5,-390.5 1428.5,-390.5 1428.5,-384.5 1434.5,-378.5 1440.5,-378.5 1440.5,-378.5 1535.5,-378.5 1535.5,-378.5 1541.5,-378.5 1547.5,-384.5 1547.5,-390.5 1547.5,-390.5 1547.5,-402.5 1547.5,-402.5 1547.5,-408.5 1541.5,-414.5 1535.5,-414.5"/>
<text text-anchor="middle" x="1488" y="-392.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__apply_reads</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Lease__inspect -->
<g id="edge2" class="edge">
<title>Peer__apply_reads&#45;&gt;Lease__inspect</title>
<path fill="none" stroke="#666666" d="M1547.68,-396.5C1564.59,-396.5 1583.43,-396.5 1601.72,-396.5"/>
<polygon fill="#666666" stroke="#666666" points="1601.81,-400 1611.81,-396.5 1601.81,-393 1601.81,-400"/>
</g>
<!-- Peer__read_index -->
<g id="node4" class="node">
<title>Peer__read_index</title>
<path fill="none" stroke="#1c2123" d="M1533,-468.5C1533,-468.5 1443,-468.5 1443,-468.5 1437,-468.5 1431,-462.5 1431,-456.5 1431,-456.5 1431,-444.5 1431,-444.5 1431,-438.5 1437,-432.5 1443,-432.5 1443,-432.5 1533,-432.5 1533,-432.5 1539,-432.5 1545,-438.5 1545,-444.5 1545,-444.5 1545,-456.5 1545,-456.5 1545,-462.5 1539,-468.5 1533,-468.5"/>
<text text-anchor="middle" x="1488" y="-446.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__read_index</text>
</g>
<!-- Peer__read_index&#45;&gt;Lease__inspect -->
<g id="edge3" class="edge">
<title>Peer__read_index&#45;&gt;Lease__inspect</title>
<path fill="none" stroke="#666666" d="M1545.26,-435.39C1562.94,-430.64 1582.91,-425.27 1602.24,-420.08"/>
<polygon fill="#666666" stroke="#666666" points="1603.22,-423.44 1611.97,-417.46 1601.4,-416.68 1603.22,-423.44"/>
</g>
<!-- RequestInspector__inspect_lease -->
<g id="node5" class="node">
<title>RequestInspector__inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M1220.5,-310C1220.5,-310 1332.5,-310 1332.5,-310 1338.5,-310 1344.5,-316 1344.5,-322 1344.5,-322 1344.5,-359 1344.5,-359 1344.5,-365 1338.5,-371 1332.5,-371 1332.5,-371 1220.5,-371 1220.5,-371 1214.5,-371 1208.5,-365 1208.5,-359 1208.5,-359 1208.5,-322 1208.5,-322 1208.5,-316 1214.5,-310 1220.5,-310"/>
<text text-anchor="start" x="1216.5" y="-355.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">trait RequestInspector</text>
<text text-anchor="start" x="1216.5" y="-340.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect_lease</text>
<polyline fill="none" stroke="#1c2123" points="1208.5,-333 1344.5,-333 "/>
<text text-anchor="start" x="1216.5" y="-317.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">有两种实现</text>
</g>
<!-- Inspector__inspect_lease -->
<g id="node6" class="node">
<title>Inspector__inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M1424,-110C1424,-110 1552,-110 1552,-110 1558,-110 1564,-116 1564,-122 1564,-122 1564,-219 1564,-219 1564,-225 1558,-231 1552,-231 1552,-231 1424,-231 1424,-231 1418,-231 1412,-225 1412,-219 1412,-219 1412,-122 1412,-122 1412,-116 1418,-110 1424,-110"/>
<text text-anchor="start" x="1420" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Inspector</text>
<text text-anchor="start" x="1420" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect_lease</text>
<polyline fill="none" stroke="#1c2123" points="1412,-193 1564,-193 "/>
<text text-anchor="start" x="1420" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果ReadDelegate的</text>
<text text-anchor="start" x="1420" y="-162.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> RemoteLease不为None</text>
<text text-anchor="start" x="1420" y="-147.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就返回Valid</text>
<text text-anchor="start" x="1420" y="-132.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在后面还会检查</text>
<text text-anchor="start" x="1420" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> remoteLease的有效性</text>
</g>
<!-- RequestInspector__inspect_lease&#45;&gt;Inspector__inspect_lease -->
<g id="edge4" class="edge">
<title>RequestInspector__inspect_lease&#45;&gt;Inspector__inspect_lease</title>
<path fill="none" stroke="#666666" d="M1344.67,-317.53C1355.62,-312.41 1366.48,-306.4 1376,-299.5 1399.01,-282.82 1420.4,-260.46 1438.13,-239.05"/>
<polygon fill="#666666" stroke="#666666" points="1440.91,-241.18 1444.5,-231.21 1435.48,-236.77 1440.91,-241.18"/>
</g>
<!-- Peer__inspect_lease -->
<g id="node7" class="node">
<title>Peer__inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M1454,-321.5C1454,-321.5 1522,-321.5 1522,-321.5 1528,-321.5 1534,-327.5 1534,-333.5 1534,-333.5 1534,-347.5 1534,-347.5 1534,-353.5 1528,-359.5 1522,-359.5 1522,-359.5 1454,-359.5 1454,-359.5 1448,-359.5 1442,-353.5 1442,-347.5 1442,-347.5 1442,-333.5 1442,-333.5 1442,-327.5 1448,-321.5 1454,-321.5"/>
<text text-anchor="start" x="1450" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="1450" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect_lease</text>
</g>
<!-- RequestInspector__inspect_lease&#45;&gt;Peer__inspect_lease -->
<g id="edge5" class="edge">
<title>RequestInspector__inspect_lease&#45;&gt;Peer__inspect_lease</title>
<path fill="none" stroke="#666666" d="M1344.65,-340.5C1372.65,-340.5 1404.78,-340.5 1431.42,-340.5"/>
<polygon fill="#666666" stroke="#666666" points="1431.72,-344 1441.72,-340.5 1431.72,-337 1431.72,-344"/>
</g>
<!-- RemoteLease__inspect -->
<g id="node15" class="node">
<title>RemoteLease__inspect</title>
<path fill="none" stroke="#1c2123" d="M1612,-140C1612,-140 1770,-140 1770,-140 1776,-140 1782,-146 1782,-152 1782,-152 1782,-189 1782,-189 1782,-195 1776,-201 1770,-201 1770,-201 1612,-201 1612,-201 1606,-201 1600,-195 1600,-189 1600,-189 1600,-152 1600,-152 1600,-146 1606,-140 1612,-140"/>
<text text-anchor="start" x="1608" y="-185.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RemoteLease</text>
<text text-anchor="start" x="1608" y="-170.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect</text>
<polyline fill="none" stroke="#1c2123" points="1600,-163 1782,-163 "/>
<text text-anchor="start" x="1608" y="-147.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">时间戳和expire_time做比较</text>
</g>
<!-- Inspector__inspect_lease&#45;&gt;RemoteLease__inspect -->
<g id="edge24" class="edge">
<title>Inspector__inspect_lease&#45;&gt;RemoteLease__inspect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1564.13,-170.5C1572.47,-170.5 1581.05,-170.5 1589.63,-170.5"/>
<polygon fill="green" stroke="green" points="1589.69,-174 1599.69,-170.5 1589.69,-167 1589.69,-174"/>
</g>
<!-- Peer__inspect_lease&#45;&gt;Lease__inspect -->
<g id="edge13" class="edge">
<title>Peer__inspect_lease&#45;&gt;Lease__inspect</title>
<path fill="none" stroke="#666666" d="M1534.11,-353.07C1554.25,-358.68 1578.71,-365.49 1602.22,-372.05"/>
<polygon fill="#666666" stroke="#666666" points="1601.3,-375.42 1611.88,-374.73 1603.18,-368.68 1601.3,-375.42"/>
</g>
<!-- Raft__in_lease -->
<g id="node13" class="node">
<title>Raft__in_lease</title>
<path fill="none" stroke="#1c2123" d="M1612,-263.5C1612,-263.5 1770,-263.5 1770,-263.5 1776,-263.5 1782,-269.5 1782,-275.5 1782,-275.5 1782,-327.5 1782,-327.5 1782,-333.5 1776,-339.5 1770,-339.5 1770,-339.5 1612,-339.5 1612,-339.5 1606,-339.5 1600,-333.5 1600,-327.5 1600,-327.5 1600,-275.5 1600,-275.5 1600,-269.5 1606,-263.5 1612,-263.5"/>
<text text-anchor="start" x="1608" y="-324.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft</text>
<text text-anchor="start" x="1608" y="-309.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> in_lease</text>
<polyline fill="none" stroke="#1c2123" points="1600,-301.5 1782,-301.5 "/>
<text text-anchor="start" x="1608" y="-286.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.sate == StateRole::Leader</text>
<text text-anchor="start" x="1608" y="-271.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_quorum</text>
</g>
<!-- Peer__inspect_lease&#45;&gt;Raft__in_lease -->
<g id="edge14" class="edge">
<title>Peer__inspect_lease&#45;&gt;Raft__in_lease</title>
<path fill="none" stroke="#666666" d="M1534.11,-331.75C1550.74,-328.52 1570.32,-324.72 1589.88,-320.93"/>
<polygon fill="#666666" stroke="#666666" points="1590.63,-324.35 1599.78,-319.01 1589.3,-317.47 1590.63,-324.35"/>
</g>
<!-- RequestInspector__inspect -->
<g id="node8" class="node">
<title>RequestInspector__inspect</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M946,-153C946,-153 1129,-153 1129,-153 1135,-153 1141,-159 1141,-165 1141,-165 1141,-300 1141,-300 1141,-306 1135,-312 1129,-312 1129,-312 946,-312 946,-312 940,-312 934,-306 934,-300 934,-300 934,-165 934,-165 934,-159 940,-153 946,-153"/>
<text text-anchor="start" x="942" y="-296.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">RequestInspector</text>
<text text-anchor="start" x="942" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> inspect</text>
<polyline fill="none" stroke="#8a8898" points="934,-274 1141,-274 "/>
<text text-anchor="start" x="942" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Inspect a RaftCmdRequest</text>
<text text-anchor="start" x="942" y="-243.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> return RequestPolicy that</text>
<text text-anchor="start" x="942" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> tell us how to handle</text>
<text text-anchor="start" x="942" y="-213.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> the request</text>
<polyline fill="none" stroke="#8a8898" points="934,-206 1141,-206 "/>
<text text-anchor="start" x="942" y="-190.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">对于read request</text>
<text text-anchor="start" x="942" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 返回是RequestPolicy::ReadIndex</text>
<text text-anchor="start" x="942" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 还是RequestPolicy::ReadLocal</text>
</g>
<!-- RequestInspector__inspect&#45;&gt;RequestInspector__inspect_lease -->
<g id="edge6" class="edge">
<title>RequestInspector__inspect&#45;&gt;RequestInspector__inspect_lease</title>
<path fill="none" stroke="#666666" d="M1141.06,-282.91C1153.13,-288.6 1165.31,-294.24 1177,-299.5 1184.07,-302.68 1191.46,-305.91 1198.87,-309.1"/>
<polygon fill="#666666" stroke="#666666" points="1197.69,-312.4 1208.26,-313.1 1200.43,-305.96 1197.69,-312.4"/>
</g>
<!-- RaftCmdRequest__get_header__get_read_quorum -->
<g id="node9" class="node">
<title>RaftCmdRequest__get_header__get_read_quorum</title>
<path fill="none" stroke="#1c2123" d="M1189,-214.5C1189,-214.5 1364,-214.5 1364,-214.5 1370,-214.5 1376,-220.5 1376,-226.5 1376,-226.5 1376,-278.5 1376,-278.5 1376,-284.5 1370,-290.5 1364,-290.5 1364,-290.5 1189,-290.5 1189,-290.5 1183,-290.5 1177,-284.5 1177,-278.5 1177,-278.5 1177,-226.5 1177,-226.5 1177,-220.5 1183,-214.5 1189,-214.5"/>
<text text-anchor="start" x="1185" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCmdRequest</text>
<text text-anchor="start" x="1185" y="-260.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_header</text>
<text text-anchor="start" x="1185" y="-245.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_read_quorum</text>
<polyline fill="none" stroke="#1c2123" points="1177,-237.5 1376,-237.5 "/>
<text text-anchor="start" x="1185" y="-222.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Request明确要求要走readindex</text>
</g>
<!-- RequestInspector__inspect&#45;&gt;RaftCmdRequest__get_header__get_read_quorum -->
<g id="edge7" class="edge">
<title>RequestInspector__inspect&#45;&gt;RaftCmdRequest__get_header__get_read_quorum</title>
<path fill="none" stroke="#666666" d="M1141.07,-241.16C1149.62,-241.88 1158.27,-242.61 1166.85,-243.33"/>
<polygon fill="#666666" stroke="#666666" points="1166.63,-246.83 1176.89,-244.18 1167.22,-239.85 1166.63,-246.83"/>
</g>
<!-- RequestInspector__has_applied_to_current_term -->
<g id="node10" class="node">
<title>RequestInspector__has_applied_to_current_term</title>
<path fill="none" stroke="#1c2123" d="M1193,-134C1193,-134 1360,-134 1360,-134 1366,-134 1372,-140 1372,-146 1372,-146 1372,-183 1372,-183 1372,-189 1366,-195 1360,-195 1360,-195 1193,-195 1193,-195 1187,-195 1181,-189 1181,-183 1181,-183 1181,-146 1181,-146 1181,-140 1187,-134 1193,-134"/>
<text text-anchor="start" x="1189" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RequestInspector</text>
<text text-anchor="start" x="1189" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> has_applied_to_current_term</text>
<polyline fill="none" stroke="#1c2123" points="1181,-157 1372,-157 "/>
<text text-anchor="start" x="1189" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer和Inspector有不同的实现</text>
</g>
<!-- RequestInspector__inspect&#45;&gt;RequestInspector__has_applied_to_current_term -->
<g id="edge8" class="edge">
<title>RequestInspector__inspect&#45;&gt;RequestInspector__has_applied_to_current_term</title>
<path fill="none" stroke="#666666" d="M1141.07,-203.07C1151.02,-200.22 1161.12,-197.32 1171.08,-194.46"/>
<polygon fill="#666666" stroke="#666666" points="1172.34,-197.74 1180.99,-191.62 1170.41,-191.01 1172.34,-197.74"/>
</g>
<!-- LocalReader__pre_propose_raft_command -->
<g id="node11" class="node">
<title>LocalReader__pre_propose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M734,-67C734,-67 886,-67 886,-67 892,-67 898,-73 898,-79 898,-79 898,-146 898,-146 898,-152 892,-158 886,-158 886,-158 734,-158 734,-158 728,-158 722,-152 722,-146 722,-146 722,-79 722,-79 722,-73 728,-67 734,-67"/>
<text text-anchor="start" x="730" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="730" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pre_propose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="722,-120 898,-120 "/>
<text text-anchor="start" x="730" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">先获取regionId的</text>
<text text-anchor="start" x="730" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadDelegate</text>
<text text-anchor="start" x="730" y="-74.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后验证他是否在lease内</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;Inspector__inspect_lease -->
<g id="edge9" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;Inspector__inspect_lease</title>
<path fill="none" stroke="#666666" d="M898.28,-104.46C1010.26,-96.39 1209.89,-89.61 1376,-124.5 1384.6,-126.31 1393.38,-128.77 1402.04,-131.61"/>
<polygon fill="#666666" stroke="#666666" points="1401.17,-135.01 1411.76,-134.98 1403.46,-128.4 1401.17,-135.01"/>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;RequestInspector__inspect -->
<g id="edge10" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;RequestInspector__inspect</title>
<path fill="none" stroke="#666666" d="M896.57,-158.04C905.83,-162.96 915.34,-168.02 924.84,-173.08"/>
<polygon fill="#666666" stroke="#666666" points="923.47,-176.31 933.94,-177.92 926.76,-170.14 923.47,-176.31"/>
</g>
<!-- ReadDelegate__is_in_leader_lease -->
<g id="node14" class="node">
<title>ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="#1c2123" d="M964.5,-0.5C964.5,-0.5 1110.5,-0.5 1110.5,-0.5 1116.5,-0.5 1122.5,-6.5 1122.5,-12.5 1122.5,-12.5 1122.5,-64.5 1122.5,-64.5 1122.5,-70.5 1116.5,-76.5 1110.5,-76.5 1110.5,-76.5 964.5,-76.5 964.5,-76.5 958.5,-76.5 952.5,-70.5 952.5,-64.5 952.5,-64.5 952.5,-12.5 952.5,-12.5 952.5,-6.5 958.5,-0.5 964.5,-0.5"/>
<text text-anchor="start" x="960.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadDelegate</text>
<text text-anchor="start" x="960.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is_in_leader_lease</text>
<polyline fill="none" stroke="#1c2123" points="952.5,-38.5 1122.5,-38.5 "/>
<text text-anchor="start" x="960.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用RemoteLease</text>
<text text-anchor="start" x="960.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 看是否在在leader lease内</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease -->
<g id="edge23" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M898.18,-83.89C912.72,-79.12 927.86,-74.15 942.56,-69.33"/>
<polygon fill="green" stroke="green" points="943.73,-72.63 952.14,-66.18 941.55,-65.98 943.73,-72.63"/>
</g>
<!-- Peer__propose -->
<g id="node12" class="node">
<title>Peer__propose</title>
<path fill="none" stroke="#1c2123" d="M790.5,-213.5C790.5,-213.5 829.5,-213.5 829.5,-213.5 835.5,-213.5 841.5,-219.5 841.5,-225.5 841.5,-225.5 841.5,-239.5 841.5,-239.5 841.5,-245.5 835.5,-251.5 829.5,-251.5 829.5,-251.5 790.5,-251.5 790.5,-251.5 784.5,-251.5 778.5,-245.5 778.5,-239.5 778.5,-239.5 778.5,-225.5 778.5,-225.5 778.5,-219.5 784.5,-213.5 790.5,-213.5"/>
<text text-anchor="start" x="786.5" y="-236.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="786.5" y="-221.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose</text>
</g>
<!-- Peer__propose&#45;&gt;Peer__inspect_lease -->
<g id="edge11" class="edge">
<title>Peer__propose&#45;&gt;Peer__inspect_lease</title>
<path fill="none" stroke="#666666" d="M832.03,-251.7C855.31,-271.96 894.75,-303.39 934,-321.5 1034.91,-368.06 1066.65,-367.3 1177,-380.5 1264.82,-391.01 1288.87,-395.72 1376,-380.5 1382.13,-379.43 1407.44,-370.37 1432.34,-361.14"/>
<polygon fill="#666666" stroke="#666666" points="1433.67,-364.38 1441.82,-357.61 1431.23,-357.82 1433.67,-364.38"/>
</g>
<!-- Peer__propose&#45;&gt;RequestInspector__inspect -->
<g id="edge12" class="edge">
<title>Peer__propose&#45;&gt;RequestInspector__inspect</title>
<path fill="none" stroke="#666666" d="M841.88,-232.5C863.39,-232.5 893.53,-232.5 923.68,-232.5"/>
<polygon fill="#666666" stroke="#666666" points="923.89,-236 933.89,-232.5 923.89,-229 923.89,-236"/>
</g>
<!-- ReadDelegate__is_in_leader_lease&#45;&gt;RemoteLease__inspect -->
<g id="edge15" class="edge">
<title>ReadDelegate__is_in_leader_lease&#45;&gt;RemoteLease__inspect</title>
<path fill="none" stroke="#666666" d="M1122.54,-38.47C1228.1,-40.66 1413.63,-51.96 1564,-100.5 1589.01,-108.57 1614.71,-121.81 1636.32,-134.6"/>
<polygon fill="#666666" stroke="#666666" points="1634.64,-137.68 1645.01,-139.85 1638.26,-131.69 1634.64,-137.68"/>
</g>
<!-- RemoteLease__expired_time -->
<g id="node16" class="node">
<title>RemoteLease__expired_time</title>
<path fill="#feed9b" stroke="#f7e495" d="M2047,-219.5C2047,-219.5 2157,-219.5 2157,-219.5 2163,-219.5 2169,-225.5 2169,-231.5 2169,-231.5 2169,-321.5 2169,-321.5 2169,-327.5 2163,-333.5 2157,-333.5 2157,-333.5 2047,-333.5 2047,-333.5 2041,-333.5 2035,-327.5 2035,-321.5 2035,-321.5 2035,-231.5 2035,-231.5 2035,-225.5 2041,-219.5 2047,-219.5"/>
<text text-anchor="start" x="2043" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#40575d">RemoteLease</text>
<text text-anchor="start" x="2043" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> expired_time</text>
<polyline fill="none" stroke="#f7e495" points="2035,-295.5 2169,-295.5 "/>
<text text-anchor="start" x="2043" y="-280.3" font-family="Times,serif" font-size="14.00" fill="#40575d">expired_time: </text>
<text text-anchor="start" x="2043" y="-265.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> Arc&lt;AtomicU64&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="2035,-257.5 2169,-257.5 "/>
<text text-anchor="start" x="2043" y="-242.3" font-family="Times,serif" font-size="14.00" fill="#40575d">为Arc atomic 变量</text>
<text text-anchor="start" x="2043" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 在多个线程间共享</text>
</g>
<!-- RemoteLease__inspect&#45;&gt;RemoteLease__expired_time -->
<g id="edge16" class="edge">
<title>RemoteLease__inspect&#45;&gt;RemoteLease__expired_time</title>
<path fill="none" stroke="#666666" d="M1782.01,-193.83C1854.75,-212.68 1956.02,-238.92 2024.79,-256.75"/>
<polygon fill="#666666" stroke="#666666" points="2024.14,-260.2 2034.7,-259.32 2025.9,-253.42 2024.14,-260.2"/>
</g>
<!-- LocalReader__read -->
<g id="node17" class="node">
<title>LocalReader__read</title>
<path fill="none" stroke="#1c2123" d="M12,-93.5C12,-93.5 90,-93.5 90,-93.5 96,-93.5 102,-99.5 102,-105.5 102,-105.5 102,-119.5 102,-119.5 102,-125.5 96,-131.5 90,-131.5 90,-131.5 12,-131.5 12,-131.5 6,-131.5 0,-125.5 0,-119.5 0,-119.5 0,-105.5 0,-105.5 0,-99.5 6,-93.5 12,-93.5"/>
<text text-anchor="start" x="8" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="middle" x="51" y="-101.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read| read入口</text>
</g>
<!-- LocalReader__propose_raft_command -->
<g id="node18" class="node">
<title>LocalReader__propose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M150,-82C150,-82 276,-82 276,-82 282,-82 288,-88 288,-94 288,-94 288,-131 288,-131 288,-137 282,-143 276,-143 276,-143 150,-143 150,-143 144,-143 138,-137 138,-131 138,-131 138,-94 138,-94 138,-88 144,-82 150,-82"/>
<text text-anchor="start" x="146" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="146" y="-112.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="138,-105 288,-105 "/>
<text text-anchor="start" x="146" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理raft read command</text>
</g>
<!-- LocalReader__read&#45;&gt;LocalReader__propose_raft_command -->
<g id="edge17" class="edge">
<title>LocalReader__read&#45;&gt;LocalReader__propose_raft_command</title>
<path fill="none" stroke="#666666" d="M102.19,-112.5C110.35,-112.5 119.01,-112.5 127.73,-112.5"/>
<polygon fill="#666666" stroke="#666666" points="127.97,-116 137.97,-112.5 127.97,-109 127.97,-116"/>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;LocalReader__pre_propose_raft_command -->
<g id="edge18" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;LocalReader__pre_propose_raft_command</title>
<path fill="none" stroke="#666666" d="M288.15,-112.5C395.16,-112.5 593.01,-112.5 711.65,-112.5"/>
<polygon fill="#666666" stroke="#666666" points="711.82,-116 721.82,-112.5 711.82,-109 711.82,-116"/>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease -->
<g id="edge19" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="#666666" d="M288.35,-103.33C387.24,-91.39 567.53,-70.52 722,-57.5 795.83,-51.28 879.59,-46.32 942.09,-43.03"/>
<polygon fill="#666666" stroke="#666666" points="942.52,-46.51 952.33,-42.5 942.16,-39.52 942.52,-46.51"/>
</g>
<!-- LocalReader__redirect -->
<g id="node19" class="node">
<title>LocalReader__redirect</title>
<path fill="none" stroke="#1c2123" d="M336,-167.5C336,-167.5 523,-167.5 523,-167.5 529,-167.5 535,-173.5 535,-179.5 535,-179.5 535,-231.5 535,-231.5 535,-237.5 529,-243.5 523,-243.5 523,-243.5 336,-243.5 336,-243.5 330,-243.5 324,-237.5 324,-231.5 324,-231.5 324,-179.5 324,-179.5 324,-173.5 330,-167.5 336,-167.5"/>
<text text-anchor="start" x="332" y="-228.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="332" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> redirect</text>
<polyline fill="none" stroke="#1c2123" points="324,-205.5 535,-205.5 "/>
<text text-anchor="start" x="332" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将请求route 到对应的peer</text>
<text text-anchor="start" x="332" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后调用PeerFsm的propose方法</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;LocalReader__redirect -->
<g id="edge20" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="#666666" d="M284.53,-143.08C299.54,-149.59 315.63,-156.56 331.43,-163.41"/>
<polygon fill="#666666" stroke="#666666" points="330.12,-166.66 340.69,-167.43 332.9,-160.24 330.12,-166.66"/>
</g>
<!-- RaftRouter__send -->
<g id="node20" class="node">
<title>RaftRouter__send</title>
<path fill="none" stroke="#1c2123" d="M674,-236.5C674,-236.5 583,-236.5 583,-236.5 577,-236.5 571,-230.5 571,-224.5 571,-224.5 571,-212.5 571,-212.5 571,-206.5 577,-200.5 583,-200.5 583,-200.5 674,-200.5 674,-200.5 680,-200.5 686,-206.5 686,-212.5 686,-212.5 686,-224.5 686,-224.5 686,-230.5 680,-236.5 674,-236.5"/>
<text text-anchor="middle" x="628.5" y="-214.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftRouter__send</text>
</g>
<!-- LocalReader__redirect&#45;&gt;RaftRouter__send -->
<g id="edge21" class="edge">
<title>LocalReader__redirect&#45;&gt;RaftRouter__send</title>
<path fill="none" stroke="#666666" d="M535.06,-212.4C543.83,-212.98 552.54,-213.55 560.9,-214.11"/>
<polygon fill="#666666" stroke="#666666" points="560.71,-217.6 570.92,-214.77 561.17,-210.62 560.71,-217.6"/>
</g>
<!-- RaftRouter__send&#45;&gt;Peer__propose -->
<g id="edge22" class="edge">
<title>RaftRouter__send&#45;&gt;Peer__propose</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M686.29,-222.93C712.87,-225 743.92,-227.42 768.13,-229.31"/>
<polygon fill="green" stroke="green" points="768.16,-232.82 778.4,-230.11 768.7,-225.85 768.16,-232.82"/>
</g>
<!-- Lease__expire&#45;&gt;RemoteLease__expired_time -->
<g id="edge26" class="edge">
<title>Lease__expire&#45;&gt;RemoteLease__expired_time</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1982.22,-358.47C1987.95,-355.18 1993.6,-351.84 1999,-348.5 2008.04,-342.92 2017.35,-336.83 2026.5,-330.65"/>
<polygon fill="green" stroke="green" points="2028.57,-333.47 2034.85,-324.94 2024.62,-327.69 2028.57,-333.47"/>
</g>
</g>
</svg>
