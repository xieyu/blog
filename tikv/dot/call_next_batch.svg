<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: call_next_batch Pages: 1 -->
<svg width="1234pt" height="198pt"
 viewBox="0.00 0.00 1234.00 197.69" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 193.69)">
<title>call_next_batch</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-193.69 1230,-193.69 1230,4 -4,4"/>
<!-- BatchExecutorsRunner_internal_handle_request -->
<g id="node1" class="node">
<title>BatchExecutorsRunner_internal_handle_request</title>
<path fill="none" stroke="#1c2123" d="M959,-14.69C959,-14.69 1081,-14.69 1081,-14.69 1087,-14.69 1093,-20.69 1093,-26.69 1093,-26.69 1093,-48.69 1093,-48.69 1093,-54.69 1087,-60.69 1081,-60.69 1081,-60.69 959,-60.69 959,-60.69 953,-60.69 947,-54.69 947,-48.69 947,-48.69 947,-26.69 947,-26.69 947,-20.69 953,-14.69 959,-14.69"/>
<text text-anchor="start" x="955" y="-45.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">BatchExecutorsRunner</text>
<polyline fill="none" stroke="#1c2123" points="947,-37.69 1093,-37.69 "/>
<text text-anchor="start" x="955" y="-22.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">internal_handle_request</text>
</g>
<!-- BatchExecutor_next_batch -->
<g id="node2" class="node">
<title>BatchExecutor_next_batch</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1141,-14.69C1141,-14.69 1214,-14.69 1214,-14.69 1220,-14.69 1226,-20.69 1226,-26.69 1226,-26.69 1226,-48.69 1226,-48.69 1226,-54.69 1220,-60.69 1214,-60.69 1214,-60.69 1141,-60.69 1141,-60.69 1135,-60.69 1129,-54.69 1129,-48.69 1129,-48.69 1129,-26.69 1129,-26.69 1129,-20.69 1135,-14.69 1141,-14.69"/>
<text text-anchor="start" x="1137" y="-45.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">BatchExecutor</text>
<polyline fill="none" stroke="#8a8898" points="1129,-37.69 1226,-37.69 "/>
<text text-anchor="start" x="1137" y="-22.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">next_batch</text>
</g>
<!-- BatchExecutorsRunner_internal_handle_request&#45;&gt;BatchExecutor_next_batch -->
<g id="edge1" class="edge">
<title>BatchExecutorsRunner_internal_handle_request&#45;&gt;BatchExecutor_next_batch</title>
<path fill="none" stroke="#666666" d="M1093.29,-37.69C1101.76,-37.69 1110.33,-37.69 1118.57,-37.69"/>
<polygon fill="#666666" stroke="#666666" points="1118.81,-41.19 1128.81,-37.69 1118.81,-34.19 1118.81,-41.19"/>
</g>
<!-- BatchExecutorsRunner_handle_request -->
<g id="node3" class="node">
<title>BatchExecutorsRunner_handle_request</title>
<path fill="none" stroke="#1c2123" d="M768.5,-66.19C768.5,-66.19 894.5,-66.19 894.5,-66.19 900.5,-66.19 906.5,-72.19 906.5,-78.19 906.5,-78.19 906.5,-145.19 906.5,-145.19 906.5,-151.19 900.5,-157.19 894.5,-157.19 894.5,-157.19 768.5,-157.19 768.5,-157.19 762.5,-157.19 756.5,-151.19 756.5,-145.19 756.5,-145.19 756.5,-78.19 756.5,-78.19 756.5,-72.19 762.5,-66.19 768.5,-66.19"/>
<text text-anchor="start" x="764.5" y="-141.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">BatchExecutorsRunner</text>
<polyline fill="none" stroke="#1c2123" points="756.5,-134.19 906.5,-134.19 "/>
<text text-anchor="start" x="764.5" y="-118.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_request</text>
<text text-anchor="start" x="764.5" y="-103.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> loop 调用</text>
<text text-anchor="start" x="764.5" y="-88.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> internal_handle_request</text>
<text text-anchor="start" x="764.5" y="-73.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 直到drained</text>
</g>
<!-- BatchExecutorsRunner_handle_request&#45;&gt;BatchExecutorsRunner_internal_handle_request -->
<g id="edge2" class="edge">
<title>BatchExecutorsRunner_handle_request&#45;&gt;BatchExecutorsRunner_internal_handle_request</title>
<path fill="none" stroke="#666666" d="M906.75,-82.23C921.49,-76.37 936.91,-70.26 951.42,-64.5"/>
<polygon fill="#666666" stroke="#666666" points="952.8,-67.72 960.81,-60.78 950.22,-61.21 952.8,-67.72"/>
</g>
<!-- grow_batch_size -->
<g id="node4" class="node">
<title>grow_batch_size</title>
<path fill="none" stroke="#1c2123" d="M1062,-122.69C1062,-122.69 978,-122.69 978,-122.69 972,-122.69 966,-116.69 966,-110.69 966,-110.69 966,-98.69 966,-98.69 966,-92.69 972,-86.69 978,-86.69 978,-86.69 1062,-86.69 1062,-86.69 1068,-86.69 1074,-92.69 1074,-98.69 1074,-98.69 1074,-110.69 1074,-110.69 1074,-116.69 1068,-122.69 1062,-122.69"/>
<text text-anchor="middle" x="1020" y="-100.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">grow_batch_size</text>
</g>
<!-- BatchExecutorsRunner_handle_request&#45;&gt;grow_batch_size -->
<g id="edge3" class="edge">
<title>BatchExecutorsRunner_handle_request&#45;&gt;grow_batch_size</title>
<path fill="none" stroke="#666666" d="M906.75,-108.9C922.99,-108.29 940.05,-107.65 955.82,-107.06"/>
<polygon fill="#666666" stroke="#666666" points="956.11,-110.55 965.97,-106.68 955.85,-103.55 956.11,-110.55"/>
</g>
<!-- SelectResponse -->
<g id="node5" class="node">
<title>SelectResponse</title>
<path fill="none" stroke="#1c2123" d="M1058.5,-176.69C1058.5,-176.69 981.5,-176.69 981.5,-176.69 975.5,-176.69 969.5,-170.69 969.5,-164.69 969.5,-164.69 969.5,-152.69 969.5,-152.69 969.5,-146.69 975.5,-140.69 981.5,-140.69 981.5,-140.69 1058.5,-140.69 1058.5,-140.69 1064.5,-140.69 1070.5,-146.69 1070.5,-152.69 1070.5,-152.69 1070.5,-164.69 1070.5,-164.69 1070.5,-170.69 1064.5,-176.69 1058.5,-176.69"/>
<text text-anchor="middle" x="1020" y="-154.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">SelectResponse</text>
</g>
<!-- BatchExecutorsRunner_handle_request&#45;&gt;SelectResponse -->
<g id="edge4" class="edge">
<title>BatchExecutorsRunner_handle_request&#45;&gt;SelectResponse</title>
<path fill="none" stroke="#666666" d="M906.75,-130.4C924.16,-134.79 942.49,-139.41 959.18,-143.61"/>
<polygon fill="#666666" stroke="#666666" points="958.79,-147.12 969.34,-146.17 960.5,-140.33 958.79,-147.12"/>
</g>
<!-- BatchExecutorsRunner_handle_streaming_request -->
<g id="node6" class="node">
<title>BatchExecutorsRunner_handle_streaming_request</title>
<path fill="none" stroke="#1c2123" d="M764,-0.69C764,-0.69 899,-0.69 899,-0.69 905,-0.69 911,-6.69 911,-12.69 911,-12.69 911,-34.69 911,-34.69 911,-40.69 905,-46.69 899,-46.69 899,-46.69 764,-46.69 764,-46.69 758,-46.69 752,-40.69 752,-34.69 752,-34.69 752,-12.69 752,-12.69 752,-6.69 758,-0.69 764,-0.69"/>
<text text-anchor="start" x="760" y="-31.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">BatchExecutorsRunner</text>
<polyline fill="none" stroke="#1c2123" points="752,-23.69 911,-23.69 "/>
<text text-anchor="start" x="760" y="-8.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_streaming_request</text>
</g>
<!-- BatchExecutorsRunner_handle_streaming_request&#45;&gt;BatchExecutorsRunner_internal_handle_request -->
<g id="edge5" class="edge">
<title>BatchExecutorsRunner_handle_streaming_request&#45;&gt;BatchExecutorsRunner_internal_handle_request</title>
<path fill="none" stroke="#666666" d="M911.05,-29.58C919.47,-30.22 928.06,-30.86 936.53,-31.5"/>
<polygon fill="#666666" stroke="#666666" points="936.54,-35.01 946.77,-32.26 937.06,-28.03 936.54,-35.01"/>
</g>
<!-- BatchDAGHandler_handle_request -->
<g id="node7" class="node">
<title>BatchDAGHandler_handle_request</title>
<path fill="none" stroke="#1c2123" d="M588,-88.69C588,-88.69 685,-88.69 685,-88.69 691,-88.69 697,-94.69 697,-100.69 697,-100.69 697,-122.69 697,-122.69 697,-128.69 691,-134.69 685,-134.69 685,-134.69 588,-134.69 588,-134.69 582,-134.69 576,-128.69 576,-122.69 576,-122.69 576,-100.69 576,-100.69 576,-94.69 582,-88.69 588,-88.69"/>
<text text-anchor="start" x="584" y="-119.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">BatchDAGHandler</text>
<polyline fill="none" stroke="#1c2123" points="576,-111.69 697,-111.69 "/>
<text text-anchor="start" x="584" y="-96.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_request</text>
</g>
<!-- BatchDAGHandler_handle_request&#45;&gt;BatchExecutorsRunner_handle_request -->
<g id="edge6" class="edge">
<title>BatchDAGHandler_handle_request&#45;&gt;BatchExecutorsRunner_handle_request</title>
<path fill="none" stroke="#666666" d="M697.24,-111.69C712.74,-111.69 729.72,-111.69 746.21,-111.69"/>
<polygon fill="#666666" stroke="#666666" points="746.41,-115.19 756.41,-111.69 746.41,-108.19 746.41,-115.19"/>
</g>
<!-- BatchDAGHandler_handle_streaming_request -->
<g id="node8" class="node">
<title>BatchDAGHandler_handle_streaming_request</title>
<path fill="none" stroke="#1c2123" d="M569,-0.69C569,-0.69 704,-0.69 704,-0.69 710,-0.69 716,-6.69 716,-12.69 716,-12.69 716,-34.69 716,-34.69 716,-40.69 710,-46.69 704,-46.69 704,-46.69 569,-46.69 569,-46.69 563,-46.69 557,-40.69 557,-34.69 557,-34.69 557,-12.69 557,-12.69 557,-6.69 563,-0.69 569,-0.69"/>
<text text-anchor="start" x="565" y="-31.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">BatchDAGHandler</text>
<polyline fill="none" stroke="#1c2123" points="557,-23.69 716,-23.69 "/>
<text text-anchor="start" x="565" y="-8.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_streaming_request</text>
</g>
<!-- BatchDAGHandler_handle_streaming_request&#45;&gt;BatchExecutorsRunner_handle_streaming_request -->
<g id="edge7" class="edge">
<title>BatchDAGHandler_handle_streaming_request&#45;&gt;BatchExecutorsRunner_handle_streaming_request</title>
<path fill="none" stroke="#666666" d="M716,-23.69C724.48,-23.69 733.14,-23.69 741.73,-23.69"/>
<polygon fill="#666666" stroke="#666666" points="741.76,-27.19 751.76,-23.69 741.76,-20.19 741.76,-27.19"/>
</g>
<!-- EndPoint_handle_unary_request_impl -->
<g id="node9" class="node">
<title>EndPoint_handle_unary_request_impl</title>
<path fill="none" stroke="#1c2123" d="M362,-107.69C362,-107.69 506,-107.69 506,-107.69 512,-107.69 518,-113.69 518,-119.69 518,-119.69 518,-141.69 518,-141.69 518,-147.69 512,-153.69 506,-153.69 506,-153.69 362,-153.69 362,-153.69 356,-153.69 350,-147.69 350,-141.69 350,-141.69 350,-119.69 350,-119.69 350,-113.69 356,-107.69 362,-107.69"/>
<text text-anchor="start" x="358" y="-138.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">EndPoint</text>
<polyline fill="none" stroke="#1c2123" points="350,-130.69 518,-130.69 "/>
<text text-anchor="start" x="358" y="-115.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_unary_request_impl</text>
</g>
<!-- EndPoint_handle_unary_request_impl&#45;&gt;BatchDAGHandler_handle_request -->
<g id="edge8" class="edge">
<title>EndPoint_handle_unary_request_impl&#45;&gt;BatchDAGHandler_handle_request</title>
<path fill="none" stroke="#666666" d="M518.29,-122.79C534.02,-121.3 550.33,-119.76 565.6,-118.31"/>
<polygon fill="#666666" stroke="#666666" points="566.37,-121.75 575.99,-117.33 565.71,-114.78 566.37,-121.75"/>
</g>
<!-- limit_concurrency -->
<g id="node10" class="node">
<title>limit_concurrency</title>
<path fill="none" stroke="#1c2123" d="M682.5,-189.69C682.5,-189.69 590.5,-189.69 590.5,-189.69 584.5,-189.69 578.5,-183.69 578.5,-177.69 578.5,-177.69 578.5,-165.69 578.5,-165.69 578.5,-159.69 584.5,-153.69 590.5,-153.69 590.5,-153.69 682.5,-153.69 682.5,-153.69 688.5,-153.69 694.5,-159.69 694.5,-165.69 694.5,-165.69 694.5,-177.69 694.5,-177.69 694.5,-183.69 688.5,-189.69 682.5,-189.69"/>
<text text-anchor="middle" x="636.5" y="-167.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">limit_concurrency</text>
</g>
<!-- EndPoint_handle_unary_request_impl&#45;&gt;limit_concurrency -->
<g id="edge9" class="edge">
<title>EndPoint_handle_unary_request_impl&#45;&gt;limit_concurrency</title>
<path fill="none" stroke="#666666" d="M518.29,-147.72C535.04,-151.14 552.44,-154.7 568.55,-158"/>
<polygon fill="#666666" stroke="#666666" points="567.89,-161.43 578.39,-160.01 569.3,-154.58 567.89,-161.43"/>
</g>
<!-- EndPoint_handle_unary_request -->
<g id="node11" class="node">
<title>EndPoint_handle_unary_request</title>
<path fill="none" stroke="#1c2123" d="M15,-80.69C15,-80.69 127,-80.69 127,-80.69 133,-80.69 139,-86.69 139,-92.69 139,-92.69 139,-114.69 139,-114.69 139,-120.69 133,-126.69 127,-126.69 127,-126.69 15,-126.69 15,-126.69 9,-126.69 3,-120.69 3,-114.69 3,-114.69 3,-92.69 3,-92.69 3,-86.69 9,-80.69 15,-80.69"/>
<text text-anchor="start" x="11" y="-111.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">EndPoint</text>
<polyline fill="none" stroke="#1c2123" points="3,-103.69 139,-103.69 "/>
<text text-anchor="start" x="11" y="-88.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_unary_request</text>
</g>
<!-- EndPoint_handle_unary_request&#45;&gt;EndPoint_handle_unary_request_impl -->
<g id="edge10" class="edge">
<title>EndPoint_handle_unary_request&#45;&gt;EndPoint_handle_unary_request_impl</title>
<path fill="none" stroke="#666666" d="M139.09,-123.45C151.9,-126.46 165.28,-129.09 178,-130.69 231.31,-137.37 291.39,-137.72 339.83,-136.23"/>
<polygon fill="#666666" stroke="#666666" points="340.11,-139.72 349.99,-135.89 339.88,-132.73 340.11,-139.72"/>
</g>
<!-- read_pool_spawn_handle -->
<g id="node12" class="node">
<title>read_pool_spawn_handle</title>
<path fill="#feed9b" stroke="#f7e495" d="M190,-14.19C190,-14.19 299,-14.19 299,-14.19 305,-14.19 311,-20.19 311,-26.19 311,-26.19 311,-109.19 311,-109.19 311,-115.19 305,-121.19 299,-121.19 299,-121.19 190,-121.19 190,-121.19 184,-121.19 178,-115.19 178,-109.19 178,-109.19 178,-26.19 178,-26.19 178,-20.19 184,-14.19 190,-14.19"/>
<text text-anchor="start" x="186" y="-105.99" font-family="Times,serif" font-size="14.00" fill="#40575d">read_pool</text>
<polyline fill="none" stroke="#f7e495" points="178,-98.19 311,-98.19 "/>
<text text-anchor="start" x="186" y="-82.99" font-family="Times,serif" font-size="14.00" fill="#40575d">spawn_handle</text>
<polyline fill="none" stroke="#f7e495" points="178,-75.19 311,-75.19 "/>
<text text-anchor="start" x="186" y="-59.99" font-family="Times,serif" font-size="14.00" fill="#40575d">thread pool to run</text>
<text text-anchor="start" x="186" y="-44.99" font-family="Times,serif" font-size="14.00" fill="#40575d"> coprocessor requests</text>
<polyline fill="none" stroke="#f7e495" points="178,-37.19 311,-37.19 "/>
<text text-anchor="start" x="186" y="-21.99" font-family="Times,serif" font-size="14.00" fill="#40575d">跑future task</text>
</g>
<!-- EndPoint_handle_unary_request&#45;&gt;read_pool_spawn_handle -->
<g id="edge11" class="edge">
<title>EndPoint_handle_unary_request&#45;&gt;read_pool_spawn_handle</title>
<path fill="none" stroke="#666666" d="M139.29,-89.56C148.69,-87.59 158.4,-85.55 167.95,-83.55"/>
<polygon fill="#666666" stroke="#666666" points="168.74,-86.96 177.81,-81.48 167.3,-80.1 168.74,-86.96"/>
</g>
<!-- read_pool_spawn_handle&#45;&gt;EndPoint_handle_unary_request_impl -->
<g id="edge12" class="edge">
<title>read_pool_spawn_handle&#45;&gt;EndPoint_handle_unary_request_impl</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M311.08,-89.72C325.06,-94.42 339.97,-99.43 354.39,-104.27"/>
<polygon fill="green" stroke="green" points="353.68,-107.73 364.28,-107.6 355.91,-101.09 353.68,-107.73"/>
</g>
<!-- EndPoint_handle_stream_request_impl -->
<g id="node13" class="node">
<title>EndPoint_handle_stream_request_impl</title>
<path fill="none" stroke="#1c2123" d="M359,-0.69C359,-0.69 509,-0.69 509,-0.69 515,-0.69 521,-6.69 521,-12.69 521,-12.69 521,-34.69 521,-34.69 521,-40.69 515,-46.69 509,-46.69 509,-46.69 359,-46.69 359,-46.69 353,-46.69 347,-40.69 347,-34.69 347,-34.69 347,-12.69 347,-12.69 347,-6.69 353,-0.69 359,-0.69"/>
<text text-anchor="start" x="355" y="-31.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">EndPoint</text>
<polyline fill="none" stroke="#1c2123" points="347,-23.69 521,-23.69 "/>
<text text-anchor="start" x="355" y="-8.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_stream_request_impl</text>
</g>
<!-- read_pool_spawn_handle&#45;&gt;EndPoint_handle_stream_request_impl -->
<g id="edge13" class="edge">
<title>read_pool_spawn_handle&#45;&gt;EndPoint_handle_stream_request_impl</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M311.08,-52.3C319.44,-50.33 328.13,-48.29 336.86,-46.25"/>
<polygon fill="green" stroke="green" points="337.76,-49.63 346.7,-43.94 336.16,-42.82 337.76,-49.63"/>
</g>
<!-- EndPoint_handle_stream_request_impl&#45;&gt;BatchDAGHandler_handle_streaming_request -->
<g id="edge16" class="edge">
<title>EndPoint_handle_stream_request_impl&#45;&gt;BatchDAGHandler_handle_streaming_request</title>
<path fill="none" stroke="#666666" d="M521.19,-23.69C529.64,-23.69 538.23,-23.69 546.71,-23.69"/>
<polygon fill="#666666" stroke="#666666" points="546.98,-27.19 556.98,-23.69 546.98,-20.19 546.98,-27.19"/>
</g>
<!-- EndPoint_handle_stream_request -->
<g id="node14" class="node">
<title>EndPoint_handle_stream_request</title>
<path fill="none" stroke="#1c2123" d="M12,-7.69C12,-7.69 130,-7.69 130,-7.69 136,-7.69 142,-13.69 142,-19.69 142,-19.69 142,-41.69 142,-41.69 142,-47.69 136,-53.69 130,-53.69 130,-53.69 12,-53.69 12,-53.69 6,-53.69 0,-47.69 0,-41.69 0,-41.69 0,-19.69 0,-19.69 0,-13.69 6,-7.69 12,-7.69"/>
<text text-anchor="start" x="8" y="-38.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">EndPoint</text>
<polyline fill="none" stroke="#1c2123" points="0,-30.69 142,-30.69 "/>
<text text-anchor="start" x="8" y="-15.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_stream_request</text>
</g>
<!-- EndPoint_handle_stream_request&#45;&gt;read_pool_spawn_handle -->
<g id="edge14" class="edge">
<title>EndPoint_handle_stream_request&#45;&gt;read_pool_spawn_handle</title>
<path fill="none" stroke="#666666" d="M142.25,-45.84C150.69,-47.66 159.35,-49.53 167.86,-51.37"/>
<polygon fill="#666666" stroke="#666666" points="167.26,-54.82 177.78,-53.51 168.74,-47.98 167.26,-54.82"/>
</g>
<!-- EndPoint_handle_stream_request&#45;&gt;EndPoint_handle_stream_request_impl -->
<g id="edge15" class="edge">
<title>EndPoint_handle_stream_request&#45;&gt;EndPoint_handle_stream_request_impl</title>
<path fill="none" stroke="#666666" d="M142.27,-10.95C154.11,-8.35 166.34,-6.1 178,-4.69 236.68,2.41 252.07,-0.12 311,-4.69 319.37,-5.33 328.04,-6.23 336.71,-7.28"/>
<polygon fill="#666666" stroke="#666666" points="336.52,-10.78 346.88,-8.58 337.41,-3.84 336.52,-10.78"/>
</g>
</g>
</svg>
