<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: readers Pages: 1 -->
<svg width="925pt" height="413pt"
 viewBox="0.00 0.00 925.00 413.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 409)">
<title>readers</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-409 921,-409 921,4 -4,4"/>
<!-- Peer__apply_reads -->
<g id="node1" class="node">
<title>Peer__apply_reads</title>
<path fill="none" stroke="#1c2123" d="M416,-253.5C416,-253.5 624,-253.5 624,-253.5 630,-253.5 636,-259.5 636,-265.5 636,-265.5 636,-347.5 636,-347.5 636,-353.5 630,-359.5 624,-359.5 624,-359.5 416,-359.5 416,-359.5 410,-359.5 404,-353.5 404,-347.5 404,-347.5 404,-265.5 404,-265.5 404,-259.5 410,-253.5 416,-253.5"/>
<text text-anchor="start" x="412" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="412" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_reads</text>
<polyline fill="none" stroke="#1c2123" points="404,-321.5 636,-321.5 "/>
<text text-anchor="start" x="412" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.处理ready中的read_states</text>
<text text-anchor="start" x="412" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.如果是leader</text>
<text text-anchor="start" x="412" y="-276.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 使用pending_reads中的last_ready</text>
<text text-anchor="start" x="412" y="-261.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的renew_lease_time 更新leader_lease</text>
</g>
<!-- Peer__maybe_renew_leader_lease -->
<g id="node2" class="node">
<title>Peer__maybe_renew_leader_lease</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M684,-123C684,-123 905,-123 905,-123 911,-123 917,-129 917,-135 917,-135 917,-240 917,-240 917,-246 911,-252 905,-252 905,-252 684,-252 684,-252 678,-252 672,-246 672,-240 672,-240 672,-135 672,-135 672,-129 678,-123 684,-123"/>
<text text-anchor="start" x="680" y="-236.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Peer</text>
<text text-anchor="start" x="680" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> maybe_renew_leader_lease</text>
<polyline fill="none" stroke="#8a8898" points="672,-214 917,-214 "/>
<text text-anchor="start" x="680" y="-198.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">try to renew leader lease</text>
<polyline fill="none" stroke="#8a8898" points="672,-191 917,-191 "/>
<text text-anchor="start" x="680" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.如果正在spliting/merging则不会更新</text>
<text text-anchor="start" x="680" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.如果自己是leader且</text>
<text text-anchor="start" x="680" y="-145.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> read_progress不为None</text>
<text text-anchor="start" x="680" y="-130.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 则尝试更新read_progress</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge1" class="edge">
<title>Peer__apply_reads&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M636.17,-256.21C644.9,-252.39 653.75,-248.53 662.57,-244.68"/>
<polygon fill="#666666" stroke="#666666" points="663.99,-247.88 671.75,-240.67 661.18,-241.46 663.99,-247.88"/>
</g>
<!-- Peer__pending_reads -->
<g id="node8" class="node">
<title>Peer__pending_reads</title>
<path fill="#feed9b" stroke="#f7e495" d="M690.5,-271.5C690.5,-271.5 898.5,-271.5 898.5,-271.5 904.5,-271.5 910.5,-277.5 910.5,-283.5 910.5,-283.5 910.5,-335.5 910.5,-335.5 910.5,-341.5 904.5,-347.5 898.5,-347.5 898.5,-347.5 690.5,-347.5 690.5,-347.5 684.5,-347.5 678.5,-341.5 678.5,-335.5 678.5,-335.5 678.5,-283.5 678.5,-283.5 678.5,-277.5 684.5,-271.5 690.5,-271.5"/>
<text text-anchor="start" x="686.5" y="-332.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Peer</text>
<text text-anchor="start" x="686.5" y="-317.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_reads</text>
<polyline fill="none" stroke="#f7e495" points="678.5,-309.5 910.5,-309.5 "/>
<text text-anchor="start" x="686.5" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#40575d">使用pending_reads中的last_ready</text>
<text text-anchor="start" x="686.5" y="-279.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 的renew_lease_time 更新leader_lease</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Peer__pending_reads -->
<g id="edge9" class="edge">
<title>Peer__apply_reads&#45;&gt;Peer__pending_reads</title>
<path fill="none" stroke="#666666" d="M636.17,-307.77C646.74,-307.88 657.48,-308 668.13,-308.12"/>
<polygon fill="#666666" stroke="#666666" points="668.27,-311.62 678.31,-308.23 668.34,-304.62 668.27,-311.62"/>
</g>
<!-- Lease__inspect -->
<g id="node9" class="node">
<title>Lease__inspect</title>
<path fill="none" stroke="#1c2123" d="M777,-366.5C777,-366.5 812,-366.5 812,-366.5 818,-366.5 824,-372.5 824,-378.5 824,-378.5 824,-392.5 824,-392.5 824,-398.5 818,-404.5 812,-404.5 812,-404.5 777,-404.5 777,-404.5 771,-404.5 765,-398.5 765,-392.5 765,-392.5 765,-378.5 765,-378.5 765,-372.5 771,-366.5 777,-366.5"/>
<text text-anchor="start" x="773" y="-389.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease</text>
<text text-anchor="start" x="773" y="-374.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Lease__inspect -->
<g id="edge10" class="edge">
<title>Peer__apply_reads&#45;&gt;Lease__inspect</title>
<path fill="none" stroke="#666666" d="M636.05,-346.67C648.14,-350.5 660.29,-354.18 672,-357.5 699.52,-365.3 730.99,-372.5 755.01,-377.65"/>
<polygon fill="#666666" stroke="#666666" points="754.31,-381.08 764.82,-379.73 755.76,-374.23 754.31,-381.08"/>
</g>
<!-- Peer__handle_raft_comitted_entries -->
<g id="node3" class="node">
<title>Peer__handle_raft_comitted_entries</title>
<path fill="none" stroke="#1c2123" d="M442.5,-57.5C442.5,-57.5 597.5,-57.5 597.5,-57.5 603.5,-57.5 609.5,-63.5 609.5,-69.5 609.5,-69.5 609.5,-121.5 609.5,-121.5 609.5,-127.5 603.5,-133.5 597.5,-133.5 597.5,-133.5 442.5,-133.5 442.5,-133.5 436.5,-133.5 430.5,-127.5 430.5,-121.5 430.5,-121.5 430.5,-69.5 430.5,-69.5 430.5,-63.5 436.5,-57.5 442.5,-57.5"/>
<text text-anchor="start" x="438.5" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="438.5" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_comitted_entries</text>
<polyline fill="none" stroke="#1c2123" points="430.5,-95.5 609.5,-95.5 "/>
<text text-anchor="start" x="438.5" y="-80.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">跟据write propose时间</text>
<text text-anchor="start" x="438.5" y="-65.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新leader lease</text>
</g>
<!-- Peer__handle_raft_comitted_entries&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge2" class="edge">
<title>Peer__handle_raft_comitted_entries&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M609.85,-125.5C626.49,-131.12 644.21,-137.1 661.83,-143.05"/>
<polygon fill="#666666" stroke="#666666" points="661.01,-146.46 671.6,-146.35 663.25,-139.83 661.01,-146.46"/>
</g>
<!-- ProposalQueue__find_propose_time -->
<g id="node10" class="node">
<title>ProposalQueue__find_propose_time</title>
<path fill="none" stroke="#1c2123" d="M715,-13C715,-13 874,-13 874,-13 880,-13 886,-19 886,-25 886,-25 886,-92 886,-92 886,-98 880,-104 874,-104 874,-104 715,-104 715,-104 709,-104 703,-98 703,-92 703,-92 703,-25 703,-25 703,-19 709,-13 715,-13"/>
<text text-anchor="start" x="711" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ProposalQueue</text>
<text text-anchor="start" x="711" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> find_propose_time</text>
<polyline fill="none" stroke="#1c2123" points="703,-66 886,-66 "/>
<text text-anchor="start" x="711" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">找到log entry的proposal time</text>
<text text-anchor="start" x="711" y="-35.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 根据他来更新刷新</text>
<text text-anchor="middle" x="794.5" y="-20.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 自己的leader lease</text>
</g>
<!-- Peer__handle_raft_comitted_entries&#45;&gt;ProposalQueue__find_propose_time -->
<g id="edge11" class="edge">
<title>Peer__handle_raft_comitted_entries&#45;&gt;ProposalQueue__find_propose_time</title>
<path fill="none" stroke="#666666" d="M609.85,-83.44C636.41,-79.83 665.71,-75.85 692.96,-72.15"/>
<polygon fill="#666666" stroke="#666666" points="693.47,-75.61 702.9,-70.8 692.52,-68.68 693.47,-75.61"/>
</g>
<!-- Peer__on_role_changed -->
<g id="node4" class="node">
<title>Peer__on_role_changed</title>
<path fill="none" stroke="#1c2123" d="M450,-152.5C450,-152.5 590,-152.5 590,-152.5 596,-152.5 602,-158.5 602,-164.5 602,-164.5 602,-216.5 602,-216.5 602,-222.5 596,-228.5 590,-228.5 590,-228.5 450,-228.5 450,-228.5 444,-228.5 438,-222.5 438,-216.5 438,-216.5 438,-164.5 438,-164.5 438,-158.5 444,-152.5 450,-152.5"/>
<text text-anchor="start" x="446" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="446" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_role_changed</text>
<polyline fill="none" stroke="#1c2123" points="438,-190.5 602,-190.5 "/>
<text text-anchor="start" x="446" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果自己刚成为leader也</text>
<text text-anchor="start" x="446" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 刷新leader lease</text>
</g>
<!-- Peer__on_role_changed&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge3" class="edge">
<title>Peer__on_role_changed&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M602.02,-189.61C620.9,-189.4 641.47,-189.17 661.91,-188.95"/>
<polygon fill="#666666" stroke="#666666" points="661.96,-192.45 671.93,-188.84 661.89,-185.45 661.96,-192.45"/>
</g>
<!-- Peer__handle_raft_ready_append -->
<g id="node5" class="node">
<title>Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M216,-112C216,-112 356,-112 356,-112 362,-112 368,-118 368,-124 368,-124 368,-161 368,-161 368,-167 362,-173 356,-173 356,-173 216,-173 216,-173 210,-173 204,-167 204,-161 204,-161 204,-124 204,-124 204,-118 210,-112 216,-112"/>
<text text-anchor="start" x="212" y="-157.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="212" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_ready_append</text>
<polyline fill="none" stroke="#1c2123" points="204,-135 368,-135 "/>
<text text-anchor="start" x="212" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.调用raft_group.ready()</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__apply_reads -->
<g id="edge4" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__apply_reads</title>
<path fill="none" stroke="#666666" d="M322.08,-173.17C344.8,-192.48 375.39,-217.45 404,-237.5 408.89,-240.92 413.95,-244.35 419.1,-247.75"/>
<polygon fill="#666666" stroke="#666666" points="417.54,-250.92 427.84,-253.44 421.36,-245.05 417.54,-250.92"/>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__handle_raft_comitted_entries -->
<g id="edge5" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__handle_raft_comitted_entries</title>
<path fill="none" stroke="#666666" d="M368.14,-126.06C384.96,-122.65 402.86,-119.03 420.24,-115.51"/>
<polygon fill="#666666" stroke="#666666" points="421.28,-118.87 430.39,-113.45 419.9,-112.01 421.28,-118.87"/>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed -->
<g id="edge6" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed</title>
<path fill="none" stroke="#666666" d="M368.14,-159.29C387.48,-163.29 408.24,-167.58 427.99,-171.67"/>
<polygon fill="#666666" stroke="#666666" points="427.4,-175.12 437.9,-173.72 428.82,-168.27 427.4,-175.12"/>
</g>
<!-- RawNode__ready -->
<g id="node7" class="node">
<title>RawNode__ready</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M496.5,-0.5C496.5,-0.5 543.5,-0.5 543.5,-0.5 549.5,-0.5 555.5,-6.5 555.5,-12.5 555.5,-12.5 555.5,-26.5 555.5,-26.5 555.5,-32.5 549.5,-38.5 543.5,-38.5 543.5,-38.5 496.5,-38.5 496.5,-38.5 490.5,-38.5 484.5,-32.5 484.5,-26.5 484.5,-26.5 484.5,-12.5 484.5,-12.5 484.5,-6.5 490.5,-0.5 496.5,-0.5"/>
<text text-anchor="start" x="492.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RawNode</text>
<text text-anchor="start" x="492.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> ready</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;RawNode__ready -->
<g id="edge8" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;RawNode__ready</title>
<path fill="none" stroke="#666666" d="M317.08,-111.69C339.27,-90.66 371.18,-63.78 404,-47.5 425.93,-36.62 452.35,-29.81 474.34,-25.63"/>
<polygon fill="#666666" stroke="#666666" points="475.19,-29.03 484.42,-23.83 473.96,-22.14 475.19,-29.03"/>
</g>
<!-- PeerFsmDelegate__collect_ready -->
<g id="node6" class="node">
<title>PeerFsmDelegate__collect_ready</title>
<path fill="none" stroke="#1c2123" d="M12,-104.5C12,-104.5 156,-104.5 156,-104.5 162,-104.5 168,-110.5 168,-116.5 168,-116.5 168,-168.5 168,-168.5 168,-174.5 162,-180.5 156,-180.5 156,-180.5 12,-180.5 12,-180.5 6,-180.5 0,-174.5 0,-168.5 0,-168.5 0,-116.5 0,-116.5 0,-110.5 6,-104.5 12,-104.5"/>
<text text-anchor="start" x="8" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="8" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> collect_ready</text>
<polyline fill="none" stroke="#1c2123" points="0,-142.5 168,-142.5 "/>
<text text-anchor="start" x="8" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用raftgroup.ready</text>
<text text-anchor="start" x="8" y="-112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后处理 它返回的ready</text>
</g>
<!-- PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append -->
<g id="edge7" class="edge">
<title>PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M168.08,-142.5C176.57,-142.5 185.22,-142.5 193.78,-142.5"/>
<polygon fill="#666666" stroke="#666666" points="193.79,-146 203.79,-142.5 193.79,-139 193.79,-146"/>
</g>
</g>
</svg>
