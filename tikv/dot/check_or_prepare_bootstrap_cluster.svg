<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: check_or_prepare_bootstrap_cluster Pages: 1 -->
<svg width="1555pt" height="1002pt"
 viewBox="0.00 0.00 1555.00 1002.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 998)">
<title>check_or_prepare_bootstrap_cluster</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-998 1551,-998 1551,4 -4,4"/>
<!-- TiKVServer_init_servers -->
<g id="node1" class="node">
<title>TiKVServer_init_servers</title>
<path fill="none" stroke="#1c2123" d="M141,-363.5C141,-363.5 12,-363.5 12,-363.5 6,-363.5 0,-357.5 0,-351.5 0,-351.5 0,-339.5 0,-339.5 0,-333.5 6,-327.5 12,-327.5 12,-327.5 141,-327.5 141,-327.5 147,-327.5 153,-333.5 153,-339.5 153,-339.5 153,-351.5 153,-351.5 153,-357.5 147,-363.5 141,-363.5"/>
<text text-anchor="middle" x="76.5" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TiKVServer_init_servers</text>
</g>
<!-- Node_try_bootstrap_store -->
<g id="node2" class="node">
<title>Node_try_bootstrap_store</title>
<path fill="none" stroke="#1c2123" d="M789.5,-798C789.5,-798 918.5,-798 918.5,-798 924.5,-798 930.5,-804 930.5,-810 930.5,-810 930.5,-847 930.5,-847 930.5,-853 924.5,-859 918.5,-859 918.5,-859 789.5,-859 789.5,-859 783.5,-859 777.5,-853 777.5,-847 777.5,-847 777.5,-810 777.5,-810 777.5,-804 783.5,-798 789.5,-798"/>
<text text-anchor="start" x="785.5" y="-843.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="785.5" y="-828.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> try_bootstrap_store</text>
<polyline fill="none" stroke="#1c2123" points="777.5,-821 930.5,-821 "/>
<text text-anchor="start" x="785.5" y="-805.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置store id和cluster_id</text>
</g>
<!-- TiKVServer_init_servers&#45;&gt;Node_try_bootstrap_store -->
<g id="edge1" class="edge">
<title>TiKVServer_init_servers&#45;&gt;Node_try_bootstrap_store</title>
<path fill="none" stroke="#666666" d="M106.49,-363.55C220.59,-434.62 640.14,-695.93 795.04,-792.4"/>
<polygon fill="#666666" stroke="#666666" points="793.64,-795.65 803.98,-797.97 797.34,-789.71 793.64,-795.65"/>
</g>
<!-- Node_start -->
<g id="node3" class="node">
<title>Node_start</title>
<path fill="none" stroke="#1c2123" d="M261,-326.5C261,-326.5 291,-326.5 291,-326.5 297,-326.5 303,-332.5 303,-338.5 303,-338.5 303,-352.5 303,-352.5 303,-358.5 297,-364.5 291,-364.5 291,-364.5 261,-364.5 261,-364.5 255,-364.5 249,-358.5 249,-352.5 249,-352.5 249,-338.5 249,-338.5 249,-332.5 255,-326.5 261,-326.5"/>
<text text-anchor="start" x="257" y="-349.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="257" y="-334.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> start</text>
</g>
<!-- TiKVServer_init_servers&#45;&gt;Node_start -->
<g id="edge2" class="edge">
<title>TiKVServer_init_servers&#45;&gt;Node_start</title>
<path fill="none" stroke="#666666" d="M153.01,-345.5C182.42,-345.5 214.74,-345.5 238.72,-345.5"/>
<polygon fill="#666666" stroke="#666666" points="238.78,-349 248.78,-345.5 238.78,-342 238.78,-349"/>
</g>
<!-- Node_new -->
<g id="node4" class="node">
<title>Node_new</title>
<path fill="none" stroke="#1c2123" d="M201,-246C201,-246 351,-246 351,-246 357,-246 363,-252 363,-258 363,-258 363,-295 363,-295 363,-301 357,-307 351,-307 351,-307 201,-307 201,-307 195,-307 189,-301 189,-295 189,-295 189,-258 189,-258 189,-252 195,-246 201,-246"/>
<text text-anchor="middle" x="276" y="-291.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node::new</text>
<polyline fill="none" stroke="#1c2123" points="189,-284 363,-284 "/>
<text text-anchor="start" x="197" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据cfg中信息，设置store</text>
<text text-anchor="start" x="197" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的addr, labels等信息</text>
</g>
<!-- TiKVServer_init_servers&#45;&gt;Node_new -->
<g id="edge3" class="edge">
<title>TiKVServer_init_servers&#45;&gt;Node_new</title>
<path fill="none" stroke="#666666" d="M129.13,-327.46C144.56,-322.07 162,-315.98 179.3,-309.93"/>
<polygon fill="#666666" stroke="#666666" points="180.61,-313.18 188.89,-306.58 178.3,-306.58 180.61,-313.18"/>
</g>
<!-- alloc_id -->
<g id="node11" class="node">
<title>alloc_id</title>
<path fill="none" stroke="#1c2123" d="M1116.5,-749C1116.5,-749 1180.5,-749 1180.5,-749 1186.5,-749 1192.5,-755 1192.5,-761 1192.5,-761 1192.5,-798 1192.5,-798 1192.5,-804 1186.5,-810 1180.5,-810 1180.5,-810 1116.5,-810 1116.5,-810 1110.5,-810 1104.5,-804 1104.5,-798 1104.5,-798 1104.5,-761 1104.5,-761 1104.5,-755 1110.5,-749 1116.5,-749"/>
<text text-anchor="start" x="1112.5" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="1112.5" y="-779.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> alloc_id</text>
<polyline fill="none" stroke="#1c2123" points="1104.5,-772 1192.5,-772 "/>
<text text-anchor="start" x="1112.5" y="-756.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">分配唯一ID</text>
</g>
<!-- Node_try_bootstrap_store&#45;&gt;alloc_id -->
<g id="edge18" class="edge">
<title>Node_try_bootstrap_store&#45;&gt;alloc_id</title>
<path fill="none" stroke="#666666" d="M930.71,-815.82C982.01,-807.22 1048.54,-796.08 1094.29,-788.41"/>
<polygon fill="#666666" stroke="#666666" points="1095.02,-791.84 1104.3,-786.74 1093.86,-784.94 1095.02,-791.84"/>
</g>
<!-- check_store -->
<g id="node19" class="node">
<title>check_store</title>
<path fill="none" stroke="#1c2123" d="M1042,-947.5C1042,-947.5 1255,-947.5 1255,-947.5 1261,-947.5 1267,-953.5 1267,-959.5 1267,-959.5 1267,-981.5 1267,-981.5 1267,-987.5 1261,-993.5 1255,-993.5 1255,-993.5 1042,-993.5 1042,-993.5 1036,-993.5 1030,-987.5 1030,-981.5 1030,-981.5 1030,-959.5 1030,-959.5 1030,-953.5 1036,-947.5 1042,-947.5"/>
<text text-anchor="middle" x="1148.5" y="-978.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_store</text>
<polyline fill="none" stroke="#1c2123" points="1030,-970.5 1267,-970.5 "/>
<text text-anchor="middle" x="1148.5" y="-955.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查kv engine的STORE_IDENT_KEY</text>
</g>
<!-- Node_try_bootstrap_store&#45;&gt;check_store -->
<g id="edge19" class="edge">
<title>Node_try_bootstrap_store&#45;&gt;check_store</title>
<path fill="none" stroke="#666666" d="M884.8,-859.09C910.81,-883.98 950.76,-918.06 992,-937.5 1000.89,-941.69 1010.32,-945.36 1019.97,-948.56"/>
<polygon fill="#666666" stroke="#666666" points="1019.08,-951.95 1029.67,-951.61 1021.18,-945.27 1019.08,-951.95"/>
</g>
<!-- store_bootstrap_store -->
<g id="node20" class="node">
<title>store_bootstrap_store</title>
<path fill="none" stroke="#1c2123" d="M1004,-829C1004,-829 1293,-829 1293,-829 1299,-829 1305,-835 1305,-841 1305,-841 1305,-916 1305,-916 1305,-922 1299,-928 1293,-928 1293,-928 1004,-928 1004,-928 998,-928 992,-922 992,-916 992,-916 992,-841 992,-841 992,-835 998,-829 1004,-829"/>
<text text-anchor="start" x="1000" y="-912.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">store</text>
<text text-anchor="start" x="1000" y="-897.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> bootstrap_store</text>
<polyline fill="none" stroke="#1c2123" points="992,-890 1305,-890 "/>
<text text-anchor="start" x="1000" y="-874.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. 检查确保engine.kv的</text>
<text text-anchor="start" x="1000" y="-859.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> CF_DEFAULT是空的</text>
<polyline fill="none" stroke="#1c2123" points="992,-852 1305,-852 "/>
<text text-anchor="start" x="1000" y="-836.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">2.kv engine中写入 STORE_IDENT_KEY, StoreIdent</text>
</g>
<!-- Node_try_bootstrap_store&#45;&gt;store_bootstrap_store -->
<g id="edge20" class="edge">
<title>Node_try_bootstrap_store&#45;&gt;store_bootstrap_store</title>
<path fill="none" stroke="#666666" d="M930.71,-841.44C946.63,-844.16 964.02,-847.14 981.81,-850.18"/>
<polygon fill="#666666" stroke="#666666" points="981.27,-853.64 991.72,-851.87 982.45,-846.74 981.27,-853.64"/>
</g>
<!-- Node_check_or_prepare_bootstrap_cluster -->
<g id="node5" class="node">
<title>Node_check_or_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#1c2123" d="M411,-343.5C411,-343.5 704,-343.5 704,-343.5 710,-343.5 716,-349.5 716,-355.5 716,-355.5 716,-453.5 716,-453.5 716,-459.5 710,-465.5 704,-465.5 704,-465.5 411,-465.5 411,-465.5 405,-465.5 399,-459.5 399,-453.5 399,-453.5 399,-355.5 399,-355.5 399,-349.5 405,-343.5 411,-343.5"/>
<text text-anchor="start" x="407" y="-450.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="407" y="-435.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_or_prepare_bootstrap_cluster</text>
<polyline fill="none" stroke="#1c2123" points="399,-427.5 716,-427.5 "/>
<text text-anchor="start" x="407" y="-412.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.从engine kv中读取PREPARE_BOOTSTRAP_KEY</text>
<text text-anchor="start" x="407" y="-397.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果存在key，则返回first region</text>
<polyline fill="none" stroke="#1c2123" points="399,-389.5 716,-389.5 "/>
<text text-anchor="start" x="407" y="-374.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">2.然后询问pd server cluster是否已bootstrapped</text>
<polyline fill="none" stroke="#1c2123" points="399,-366.5 716,-366.5 "/>
<text text-anchor="start" x="407" y="-351.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">3.准备bootstrap cluster,创建第一个region</text>
</g>
<!-- Node_start&#45;&gt;Node_check_or_prepare_bootstrap_cluster -->
<g id="edge4" class="edge">
<title>Node_start&#45;&gt;Node_check_or_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M303.04,-351C323.95,-355.41 355.27,-362.02 388.83,-369.11"/>
<polygon fill="#666666" stroke="#666666" points="388.32,-372.57 398.82,-371.22 389.76,-365.73 388.32,-372.57"/>
</g>
<!-- bootstrap_cluster -->
<g id="node6" class="node">
<title>bootstrap_cluster</title>
<path fill="none" stroke="#1c2123" d="M809.5,-254.5C809.5,-254.5 898.5,-254.5 898.5,-254.5 904.5,-254.5 910.5,-260.5 910.5,-266.5 910.5,-266.5 910.5,-280.5 910.5,-280.5 910.5,-286.5 904.5,-292.5 898.5,-292.5 898.5,-292.5 809.5,-292.5 809.5,-292.5 803.5,-292.5 797.5,-286.5 797.5,-280.5 797.5,-280.5 797.5,-266.5 797.5,-266.5 797.5,-260.5 803.5,-254.5 809.5,-254.5"/>
<text text-anchor="start" x="805.5" y="-277.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="805.5" y="-262.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> bootstrap_cluster</text>
</g>
<!-- Node_start&#45;&gt;bootstrap_cluster -->
<g id="edge5" class="edge">
<title>Node_start&#45;&gt;bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M303.25,-342.22C388.74,-331.53 660.99,-297.5 787.38,-281.7"/>
<polygon fill="#666666" stroke="#666666" points="787.83,-285.17 797.32,-280.46 786.96,-278.23 787.83,-285.17"/>
</g>
<!-- PdClient_put_store -->
<g id="node7" class="node">
<title>PdClient_put_store</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1353,-0.5C1353,-0.5 1535,-0.5 1535,-0.5 1541,-0.5 1547,-6.5 1547,-12.5 1547,-12.5 1547,-64.5 1547,-64.5 1547,-70.5 1541,-76.5 1535,-76.5 1535,-76.5 1353,-76.5 1353,-76.5 1347,-76.5 1341,-70.5 1341,-64.5 1341,-64.5 1341,-12.5 1341,-12.5 1341,-6.5 1347,-0.5 1353,-0.5"/>
<text text-anchor="middle" x="1444" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PdClient_put_store</text>
<polyline fill="none" stroke="#8a8898" points="1341,-53.5 1547,-53.5 "/>
<text text-anchor="start" x="1349" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">在region bootstrap之后</text>
<text text-anchor="start" x="1349" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 将store信息(store_id, store_addr)</text>
<text text-anchor="start" x="1349" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 等同步给pd server</text>
</g>
<!-- Node_start&#45;&gt;PdClient_put_store -->
<g id="edge6" class="edge">
<title>Node_start&#45;&gt;PdClient_put_store</title>
<path fill="none" stroke="#666666" d="M303.26,-339.36C320.86,-334.6 344.16,-327.04 363,-316.5 381.18,-306.33 381.05,-297.06 399,-286.5 642.53,-143.28 715.41,-115.1 992,-57.5 1105.51,-33.86 1238.46,-31.2 1330.46,-33.16"/>
<polygon fill="#666666" stroke="#666666" points="1330.55,-36.67 1340.63,-33.4 1330.72,-29.67 1330.55,-36.67"/>
</g>
<!-- Node_prepare_bootstrap_cluster -->
<g id="node8" class="node">
<title>Node_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#1c2123" d="M785.5,-588.5C785.5,-588.5 922.5,-588.5 922.5,-588.5 928.5,-588.5 934.5,-594.5 934.5,-600.5 934.5,-600.5 934.5,-614.5 934.5,-614.5 934.5,-620.5 928.5,-626.5 922.5,-626.5 922.5,-626.5 785.5,-626.5 785.5,-626.5 779.5,-626.5 773.5,-620.5 773.5,-614.5 773.5,-614.5 773.5,-600.5 773.5,-600.5 773.5,-594.5 779.5,-588.5 785.5,-588.5"/>
<text text-anchor="start" x="781.5" y="-611.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="781.5" y="-596.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> prepare_bootstrap_cluster</text>
</g>
<!-- Node_check_or_prepare_bootstrap_cluster&#45;&gt;Node_prepare_bootstrap_cluster -->
<g id="edge8" class="edge">
<title>Node_check_or_prepare_bootstrap_cluster&#45;&gt;Node_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M647.26,-465.68C704.14,-504.89 774.93,-553.69 816.9,-582.62"/>
<polygon fill="#666666" stroke="#666666" points="814.93,-585.51 825.15,-588.3 818.9,-579.75 814.93,-585.51"/>
</g>
<!-- Node_check_cluster_bootstrapped -->
<g id="node9" class="node">
<title>Node_check_cluster_bootstrapped</title>
<path fill="none" stroke="#1c2123" d="M1041.5,-379.5C1041.5,-379.5 1255.5,-379.5 1255.5,-379.5 1261.5,-379.5 1267.5,-385.5 1267.5,-391.5 1267.5,-391.5 1267.5,-443.5 1267.5,-443.5 1267.5,-449.5 1261.5,-455.5 1255.5,-455.5 1255.5,-455.5 1041.5,-455.5 1041.5,-455.5 1035.5,-455.5 1029.5,-449.5 1029.5,-443.5 1029.5,-443.5 1029.5,-391.5 1029.5,-391.5 1029.5,-385.5 1035.5,-379.5 1041.5,-379.5"/>
<text text-anchor="start" x="1037.5" y="-440.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Node</text>
<text text-anchor="start" x="1037.5" y="-425.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_cluster_bootstrapped</text>
<polyline fill="none" stroke="#1c2123" points="1029.5,-417.5 1267.5,-417.5 "/>
<text text-anchor="start" x="1037.5" y="-402.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用pd_client的is_cluster_bootstrapped</text>
<text text-anchor="start" x="1037.5" y="-387.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rpc接口, 会尝试60次，每次sleep 3s</text>
</g>
<!-- Node_check_or_prepare_bootstrap_cluster&#45;&gt;Node_check_cluster_bootstrapped -->
<g id="edge9" class="edge">
<title>Node_check_or_prepare_bootstrap_cluster&#45;&gt;Node_check_cluster_bootstrapped</title>
<path fill="none" stroke="#666666" d="M716.34,-407.98C811.17,-410.08 930.28,-412.71 1019.27,-414.67"/>
<polygon fill="#666666" stroke="#666666" points="1019.34,-418.17 1029.42,-414.89 1019.5,-411.17 1019.34,-418.17"/>
</g>
<!-- Engines_kv_get_msg_PREPARE_BOOTSTRAP_KEY -->
<g id="node12" class="node">
<title>Engines_kv_get_msg_PREPARE_BOOTSTRAP_KEY</title>
<path fill="none" stroke="#1c2123" d="M764,-312.5C764,-312.5 944,-312.5 944,-312.5 950,-312.5 956,-318.5 956,-324.5 956,-324.5 956,-376.5 956,-376.5 956,-382.5 950,-388.5 944,-388.5 944,-388.5 764,-388.5 764,-388.5 758,-388.5 752,-382.5 752,-376.5 752,-376.5 752,-324.5 752,-324.5 752,-318.5 758,-312.5 764,-312.5"/>
<text text-anchor="start" x="760" y="-373.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Engines_kv.get_msg(</text>
<text text-anchor="start" x="760" y="-358.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PREPARE_BOOTSTRAP_KEY)</text>
<polyline fill="none" stroke="#1c2123" points="752,-350.5 956,-350.5 "/>
<text text-anchor="start" x="760" y="-335.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从kv engine中读取first region</text>
<text text-anchor="start" x="760" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 信息</text>
</g>
<!-- Node_check_or_prepare_bootstrap_cluster&#45;&gt;Engines_kv_get_msg_PREPARE_BOOTSTRAP_KEY -->
<g id="edge10" class="edge">
<title>Node_check_or_prepare_bootstrap_cluster&#45;&gt;Engines_kv_get_msg_PREPARE_BOOTSTRAP_KEY</title>
<path fill="none" stroke="#666666" d="M716.1,-375.6C724.84,-374 733.54,-372.4 742.07,-370.84"/>
<polygon fill="#666666" stroke="#666666" points="742.79,-374.27 751.99,-369.02 741.52,-367.38 742.79,-374.27"/>
</g>
<!-- PdClient_bootstrap_cluster -->
<g id="node16" class="node">
<title>PdClient_bootstrap_cluster</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1399.5,-331.5C1399.5,-331.5 1488.5,-331.5 1488.5,-331.5 1494.5,-331.5 1500.5,-337.5 1500.5,-343.5 1500.5,-343.5 1500.5,-357.5 1500.5,-357.5 1500.5,-363.5 1494.5,-369.5 1488.5,-369.5 1488.5,-369.5 1399.5,-369.5 1399.5,-369.5 1393.5,-369.5 1387.5,-363.5 1387.5,-357.5 1387.5,-357.5 1387.5,-343.5 1387.5,-343.5 1387.5,-337.5 1393.5,-331.5 1399.5,-331.5"/>
<text text-anchor="start" x="1395.5" y="-354.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PdClient</text>
<text text-anchor="start" x="1395.5" y="-339.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> bootstrap_cluster</text>
</g>
<!-- bootstrap_cluster&#45;&gt;PdClient_bootstrap_cluster -->
<g id="edge15" class="edge">
<title>bootstrap_cluster&#45;&gt;PdClient_bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M910.69,-286.02C925.83,-290.49 941.93,-296.27 956,-303.5 974.03,-312.77 972.97,-324.52 992,-331.5 1122,-379.19 1287.39,-370.1 1377.39,-359.89"/>
<polygon fill="#666666" stroke="#666666" points="1377.93,-363.35 1387.46,-358.71 1377.12,-356.4 1377.93,-363.35"/>
</g>
<!-- store_clear_prepare_bootstrap_key -->
<g id="node17" class="node">
<title>store_clear_prepare_bootstrap_key</title>
<path fill="none" stroke="#1c2123" d="M1046.5,-223C1046.5,-223 1250.5,-223 1250.5,-223 1256.5,-223 1262.5,-229 1262.5,-235 1262.5,-235 1262.5,-310 1262.5,-310 1262.5,-316 1256.5,-322 1250.5,-322 1250.5,-322 1046.5,-322 1046.5,-322 1040.5,-322 1034.5,-316 1034.5,-310 1034.5,-310 1034.5,-235 1034.5,-235 1034.5,-229 1040.5,-223 1046.5,-223"/>
<text text-anchor="start" x="1042.5" y="-306.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">store</text>
<text text-anchor="start" x="1042.5" y="-291.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> clear_prepare_bootstrap_key</text>
<polyline fill="none" stroke="#1c2123" points="1034.5,-284 1262.5,-284 "/>
<text text-anchor="start" x="1042.5" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PdSever返回 ok</text>
<polyline fill="none" stroke="#1c2123" points="1034.5,-261 1262.5,-261 "/>
<text text-anchor="start" x="1042.5" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从engine.kv中删除key</text>
<text text-anchor="start" x="1042.5" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 删除PREPARE_BOOTSTRAP_KEY</text>
</g>
<!-- bootstrap_cluster&#45;&gt;store_clear_prepare_bootstrap_key -->
<g id="edge16" class="edge">
<title>bootstrap_cluster&#45;&gt;store_clear_prepare_bootstrap_key</title>
<path fill="none" stroke="#666666" d="M910.71,-273.31C942.95,-273.2 984.87,-273.06 1024.46,-272.92"/>
<polygon fill="#666666" stroke="#666666" points="1024.48,-276.42 1034.47,-272.89 1024.46,-269.42 1024.48,-276.42"/>
</g>
<!-- store_clear_prepare_bootstrap_cluster -->
<g id="node18" class="node">
<title>store_clear_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#1c2123" d="M1033,-67C1033,-67 1264,-67 1264,-67 1270,-67 1276,-73 1276,-79 1276,-79 1276,-192 1276,-192 1276,-198 1270,-204 1264,-204 1264,-204 1033,-204 1033,-204 1027,-204 1021,-198 1021,-192 1021,-192 1021,-79 1021,-79 1021,-73 1027,-67 1033,-67"/>
<text text-anchor="start" x="1029" y="-188.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">store</text>
<text text-anchor="start" x="1029" y="-173.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> clear_prepare_bootstrap_cluster</text>
<polyline fill="none" stroke="#1c2123" points="1021,-166 1276,-166 "/>
<text text-anchor="start" x="1029" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PdSever返回 Error ClusterBootstrapped</text>
<polyline fill="none" stroke="#1c2123" points="1021,-143 1276,-143 "/>
<text text-anchor="start" x="1029" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.从raft engine 清除region_id对应的信息</text>
<text text-anchor="start" x="1029" y="-112.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.从kv engine中删除</text>
<text text-anchor="start" x="1029" y="-97.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PREPARE_BOOTSTRAP_KEY</text>
<polyline fill="none" stroke="#1c2123" points="1021,-90 1276,-90 "/>
<text text-anchor="start" x="1029" y="-74.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. 删除CF_RAFT family 的regoin state</text>
</g>
<!-- bootstrap_cluster&#45;&gt;store_clear_prepare_bootstrap_cluster -->
<g id="edge17" class="edge">
<title>bootstrap_cluster&#45;&gt;store_clear_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M895.36,-254.46C925.73,-240.13 969.23,-219.61 1011.57,-199.63"/>
<polygon fill="#666666" stroke="#666666" points="1013.32,-202.68 1020.87,-195.24 1010.33,-196.35 1013.32,-202.68"/>
</g>
<!-- Node_prepare_bootstrap_cluster&#45;&gt;alloc_id -->
<g id="edge12" class="edge">
<title>Node_prepare_bootstrap_cluster&#45;&gt;alloc_id</title>
<path fill="none" stroke="#666666" d="M869.57,-626.87C892.41,-655.84 939.52,-710.19 992,-739.5 1023.49,-757.08 1062.86,-767.11 1094.11,-772.73"/>
<polygon fill="#666666" stroke="#666666" points="1093.93,-776.25 1104.38,-774.47 1095.1,-769.35 1093.93,-776.25"/>
</g>
<!-- initial_region -->
<g id="node14" class="node">
<title>initial_region</title>
<path fill="none" stroke="#1c2123" d="M1027.5,-623.5C1027.5,-623.5 1269.5,-623.5 1269.5,-623.5 1275.5,-623.5 1281.5,-629.5 1281.5,-635.5 1281.5,-635.5 1281.5,-717.5 1281.5,-717.5 1281.5,-723.5 1275.5,-729.5 1269.5,-729.5 1269.5,-729.5 1027.5,-729.5 1027.5,-729.5 1021.5,-729.5 1015.5,-723.5 1015.5,-717.5 1015.5,-717.5 1015.5,-635.5 1015.5,-635.5 1015.5,-629.5 1021.5,-623.5 1027.5,-623.5"/>
<text text-anchor="middle" x="1148.5" y="-714.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">initial_region</text>
<polyline fill="none" stroke="#1c2123" points="1015.5,-706.5 1281.5,-706.5 "/>
<text text-anchor="start" x="1023.5" y="-691.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置region的初始值</text>
<text text-anchor="start" x="1023.5" y="-676.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> start_key,end_key为EMPTY_KEY</text>
<text text-anchor="start" x="1023.5" y="-661.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region_epoch为 INIT_EPOCH_CONF_VER</text>
<text text-anchor="start" x="1023.5" y="-646.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> INIT_EPOCH_VER</text>
<text text-anchor="start" x="1023.5" y="-631.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 初始化peers: store_id, peer_id</text>
</g>
<!-- Node_prepare_bootstrap_cluster&#45;&gt;initial_region -->
<g id="edge13" class="edge">
<title>Node_prepare_bootstrap_cluster&#45;&gt;initial_region</title>
<path fill="none" stroke="#666666" d="M934.54,-626.26C956.47,-631.44 980.95,-637.21 1005.28,-642.95"/>
<polygon fill="#666666" stroke="#666666" points="1004.78,-646.43 1015.32,-645.32 1006.39,-639.62 1004.78,-646.43"/>
</g>
<!-- store_prepare_bootstrap_cluster -->
<g id="node15" class="node">
<title>store_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#1c2123" d="M1060,-475C1060,-475 1237,-475 1237,-475 1243,-475 1249,-481 1249,-487 1249,-487 1249,-592 1249,-592 1249,-598 1243,-604 1237,-604 1237,-604 1060,-604 1060,-604 1054,-604 1048,-598 1048,-592 1048,-592 1048,-487 1048,-487 1048,-481 1054,-475 1060,-475"/>
<text text-anchor="start" x="1056" y="-588.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">store</text>
<text text-anchor="start" x="1056" y="-573.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> prepare_bootstrap_cluster</text>
<polyline fill="none" stroke="#1c2123" points="1048,-566 1249,-566 "/>
<text text-anchor="start" x="1056" y="-550.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">the first phase of bootstrap clsuter</text>
<text text-anchor="start" x="1056" y="-535.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write first region meta</text>
<text text-anchor="start" x="1056" y="-520.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> and prepase state</text>
<polyline fill="none" stroke="#1c2123" points="1048,-513 1249,-513 "/>
<text text-anchor="start" x="1056" y="-497.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将first region信息写入raft kv</text>
<text text-anchor="start" x="1056" y="-482.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和kv engine</text>
</g>
<!-- Node_prepare_bootstrap_cluster&#45;&gt;store_prepare_bootstrap_cluster -->
<g id="edge14" class="edge">
<title>Node_prepare_bootstrap_cluster&#45;&gt;store_prepare_bootstrap_cluster</title>
<path fill="none" stroke="#666666" d="M934.54,-589.01C966.34,-581.62 1003.48,-572.98 1037.77,-565.01"/>
<polygon fill="#666666" stroke="#666666" points="1038.89,-568.34 1047.83,-562.67 1037.3,-561.53 1038.89,-568.34"/>
</g>
<!-- PdClient_is_cluster_bootstrapped -->
<g id="node13" class="node">
<title>PdClient_is_cluster_bootstrapped</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1381.5,-398.5C1381.5,-398.5 1506.5,-398.5 1506.5,-398.5 1512.5,-398.5 1518.5,-404.5 1518.5,-410.5 1518.5,-410.5 1518.5,-424.5 1518.5,-424.5 1518.5,-430.5 1512.5,-436.5 1506.5,-436.5 1506.5,-436.5 1381.5,-436.5 1381.5,-436.5 1375.5,-436.5 1369.5,-430.5 1369.5,-424.5 1369.5,-424.5 1369.5,-410.5 1369.5,-410.5 1369.5,-404.5 1375.5,-398.5 1381.5,-398.5"/>
<text text-anchor="start" x="1377.5" y="-421.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PdClient</text>
<text text-anchor="start" x="1377.5" y="-406.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> is_cluster_bootstrapped</text>
</g>
<!-- Node_check_cluster_bootstrapped&#45;&gt;PdClient_is_cluster_bootstrapped -->
<g id="edge11" class="edge">
<title>Node_check_cluster_bootstrapped&#45;&gt;PdClient_is_cluster_bootstrapped</title>
<path fill="none" stroke="#666666" d="M1267.61,-417.5C1298.25,-417.5 1330.63,-417.5 1359.11,-417.5"/>
<polygon fill="#666666" stroke="#666666" points="1359.42,-421 1369.42,-417.5 1359.42,-414 1359.42,-421"/>
</g>
<!-- PdClient_alloc_id -->
<g id="node10" class="node">
<title>PdClient_alloc_id</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1412,-749C1412,-749 1476,-749 1476,-749 1482,-749 1488,-755 1488,-761 1488,-761 1488,-798 1488,-798 1488,-804 1482,-810 1476,-810 1476,-810 1412,-810 1412,-810 1406,-810 1400,-804 1400,-798 1400,-798 1400,-761 1400,-761 1400,-755 1406,-749 1412,-749"/>
<text text-anchor="start" x="1408" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">PdClient</text>
<text text-anchor="start" x="1408" y="-779.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> alloc_id</text>
<polyline fill="none" stroke="#8a8898" points="1400,-772 1488,-772 "/>
<text text-anchor="start" x="1408" y="-756.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">分配唯一ID</text>
</g>
<!-- alloc_id&#45;&gt;PdClient_alloc_id -->
<g id="edge7" class="edge">
<title>alloc_id&#45;&gt;PdClient_alloc_id</title>
<path fill="none" stroke="#666666" d="M1192.81,-779.5C1245.2,-779.5 1333.37,-779.5 1389.84,-779.5"/>
<polygon fill="#666666" stroke="#666666" points="1389.99,-783 1399.99,-779.5 1389.99,-776 1389.99,-783"/>
</g>
</g>
</svg>
