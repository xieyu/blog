<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1650pt" height="605pt"
 viewBox="0.00 0.00 1650.00 604.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 600.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-600.5 1646,-600.5 1646,4 -4,4"/>
<!-- CheckSecondaryLocks__process_write -->
<g id="node1" class="node">
<title>CheckSecondaryLocks__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-181C12,-181 179,-181 179,-181 185,-181 191,-187 191,-193 191,-193 191,-314 191,-314 191,-320 185,-326 179,-326 179,-326 12,-326 12,-326 6,-326 0,-320 0,-314 0,-314 0,-193 0,-193 0,-187 6,-181 12,-181"/>
<text text-anchor="start" x="8" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks</text>
<text text-anchor="start" x="8" y="-295.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-288 191,-288 "/>
<text text-anchor="start" x="8" y="-272.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Check locks of an async</text>
<text text-anchor="start" x="8" y="-257.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit transaction</text>
<polyline fill="none" stroke="#1c2123" points="0,-250 191,-250 "/>
<text text-anchor="start" x="8" y="-234.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">keys: Vec&lt;Key&gt;</text>
<polyline fill="none" stroke="#1c2123" points="0,-227 191,-227 "/>
<text text-anchor="start" x="8" y="-211.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: txn_types::TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-204 191,-204 "/>
<text text-anchor="start" x="8" y="-188.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历每个key</text>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node2" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M239,-194C239,-194 346,-194 346,-194 352,-194 358,-200 358,-206 358,-206 358,-243 358,-243 358,-249 352,-255 346,-255 346,-255 239,-255 239,-255 233,-255 227,-249 227,-243 227,-243 227,-206 227,-206 227,-200 233,-194 239,-194"/>
<text text-anchor="start" x="235" y="-239.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="235" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="227,-217 358,-217 "/>
<text text-anchor="start" x="235" y="-201.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取key对应的lock</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock -->
<g id="edge1" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M191.14,-239.42C199.77,-238.14 208.42,-236.86 216.83,-235.6"/>
<polygon fill="#666666" stroke="#666666" points="217.58,-239.03 226.96,-234.1 216.55,-232.11 217.58,-239.03"/>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node3" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M646.5,-473.5C646.5,-473.5 774.5,-473.5 774.5,-473.5 780.5,-473.5 786.5,-479.5 786.5,-485.5 786.5,-485.5 786.5,-499.5 786.5,-499.5 786.5,-505.5 780.5,-511.5 774.5,-511.5 774.5,-511.5 646.5,-511.5 646.5,-511.5 640.5,-511.5 634.5,-505.5 634.5,-499.5 634.5,-499.5 634.5,-485.5 634.5,-485.5 634.5,-479.5 640.5,-473.5 646.5,-473.5"/>
<text text-anchor="start" x="642.5" y="-496.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="642.5" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge2" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M155.05,-326.09C175.86,-348.25 200.7,-371.07 227,-387.5 350.36,-464.57 522.15,-485.6 623.99,-491.02"/>
<polygon fill="#666666" stroke="#666666" points="624.07,-494.53 634.23,-491.53 624.41,-487.54 624.07,-494.53"/>
</g>
<!-- SecondaryLockStatus__RolledBack -->
<g id="node4" class="node">
<title>SecondaryLockStatus__RolledBack</title>
<path fill="#bcffb9" stroke="#8a8898" d="M655.5,-416.5C655.5,-416.5 765.5,-416.5 765.5,-416.5 771.5,-416.5 777.5,-422.5 777.5,-428.5 777.5,-428.5 777.5,-442.5 777.5,-442.5 777.5,-448.5 771.5,-454.5 765.5,-454.5 765.5,-454.5 655.5,-454.5 655.5,-454.5 649.5,-454.5 643.5,-448.5 643.5,-442.5 643.5,-442.5 643.5,-428.5 643.5,-428.5 643.5,-422.5 649.5,-416.5 655.5,-416.5"/>
<text text-anchor="start" x="651.5" y="-439.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="651.5" y="-424.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Rollbacked</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge3" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M191.25,-319.55C247.48,-355.03 321.71,-395.66 394,-416.5 473.33,-439.37 568.38,-441.92 633.28,-440.14"/>
<polygon fill="#666666" stroke="#666666" points="633.55,-443.63 643.43,-439.82 633.33,-436.63 633.55,-443.63"/>
</g>
<!-- SecondaryLockStatus__Locked -->
<g id="node5" class="node">
<title>SecondaryLockStatus__Locked</title>
<path fill="#bcffb9" stroke="#8a8898" d="M655.5,-134C655.5,-134 765.5,-134 765.5,-134 771.5,-134 777.5,-140 777.5,-146 777.5,-146 777.5,-183 777.5,-183 777.5,-189 771.5,-195 765.5,-195 765.5,-195 655.5,-195 655.5,-195 649.5,-195 643.5,-189 643.5,-183 643.5,-183 643.5,-146 643.5,-146 643.5,-140 649.5,-134 655.5,-134"/>
<text text-anchor="start" x="651.5" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="651.5" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Locked(Lock)</text>
<polyline fill="none" stroke="#8a8898" points="643.5,-157 777.5,-157 "/>
<text text-anchor="start" x="651.5" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">返回lock信息</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge4" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M191.02,-198.6C202.87,-193.2 215.04,-188.32 227,-184.5 364.9,-140.53 536.24,-146.77 633.2,-155.49"/>
<polygon fill="#666666" stroke="#666666" points="632.93,-158.98 643.21,-156.43 633.58,-152.01 632.93,-158.98"/>
</g>
<!-- make_rollback -->
<g id="node6" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M1018,-483C1018,-483 1161,-483 1161,-483 1167,-483 1173,-489 1173,-495 1173,-495 1173,-532 1173,-532 1173,-538 1167,-544 1161,-544 1161,-544 1018,-544 1018,-544 1012,-544 1006,-538 1006,-532 1006,-532 1006,-495 1006,-495 1006,-489 1012,-483 1018,-483"/>
<text text-anchor="start" x="1014" y="-528.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1006,-521 1173,-521 "/>
<text text-anchor="start" x="1014" y="-505.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建WriteType为Rollback</text>
<text text-anchor="start" x="1014" y="-490.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型的Write</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;make_rollback -->
<g id="edge5" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M137.31,-326.39C159.98,-361.62 190.91,-402.27 227,-430.5 327.77,-509.32 365.07,-540.5 493,-540.5 493,-540.5 493,-540.5 711.5,-540.5 808.68,-540.5 919.6,-531.46 995.83,-523.85"/>
<polygon fill="#666666" stroke="#666666" points="996.29,-527.32 1005.88,-522.83 995.58,-520.35 996.29,-527.32"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node7" class="node">
<title>MvccTxn__put_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1224,-505C1224,-505 1359,-505 1359,-505 1365,-505 1371,-511 1371,-517 1371,-517 1371,-584 1371,-584 1371,-590 1365,-596 1359,-596 1359,-596 1224,-596 1224,-596 1218,-596 1212,-590 1212,-584 1212,-584 1212,-517 1212,-517 1212,-511 1218,-505 1224,-505"/>
<text text-anchor="start" x="1220" y="-580.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1220" y="-565.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_write</text>
<polyline fill="none" stroke="#8a8898" points="1212,-558 1371,-558 "/>
<text text-anchor="start" x="1220" y="-542.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">写入rollback write record</text>
<text text-anchor="start" x="1220" y="-527.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 注意这个地方用的是</text>
<text text-anchor="start" x="1220" y="-512.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> key, start_ts</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write -->
<g id="edge6" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M121.37,-326.08C142.31,-377.45 176.94,-444.58 227,-487.5 321.86,-568.83 368.05,-578.5 493,-578.5 493,-578.5 493,-578.5 899.5,-578.5 1003.38,-578.5 1122.4,-568.54 1201.57,-560.51"/>
<polygon fill="#666666" stroke="#666666" points="1202.39,-563.94 1211.98,-559.44 1201.68,-556.98 1202.39,-563.94"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node8" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M958,-168.5C958,-168.5 839,-168.5 839,-168.5 833,-168.5 827,-162.5 827,-156.5 827,-156.5 827,-144.5 827,-144.5 827,-138.5 833,-132.5 839,-132.5 839,-132.5 958,-132.5 958,-132.5 964,-132.5 970,-138.5 970,-144.5 970,-144.5 970,-156.5 970,-156.5 970,-162.5 964,-168.5 958,-168.5"/>
<text text-anchor="middle" x="898.5" y="-146.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback -->
<g id="edge7" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M175.53,-180.81C191.58,-169.51 209.06,-159.33 227,-152.5 461.53,-63.15 541.82,-94.52 791,-124.5 801.85,-125.81 813.19,-127.83 824.26,-130.19"/>
<polygon fill="#666666" stroke="#666666" points="823.8,-133.68 834.32,-132.44 825.33,-126.85 823.8,-133.68"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node9" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1422,-102.5C1422,-102.5 1496,-102.5 1496,-102.5 1502,-102.5 1508,-108.5 1508,-114.5 1508,-114.5 1508,-128.5 1508,-128.5 1508,-134.5 1502,-140.5 1496,-140.5 1496,-140.5 1422,-140.5 1422,-140.5 1416,-140.5 1410,-134.5 1410,-128.5 1410,-128.5 1410,-114.5 1410,-114.5 1410,-108.5 1416,-102.5 1422,-102.5"/>
<text text-anchor="start" x="1418" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1418" y="-110.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push -->
<g id="edge8" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="#666666" d="M144.83,-180.65C166.68,-153.4 194.85,-124.87 227,-107.5 332.18,-50.67 373.45,-67.5 493,-67.5 493,-67.5 493,-67.5 1090.5,-67.5 1216.91,-67.5 1250.56,-63.25 1374,-90.5 1383.79,-92.66 1393.98,-95.7 1403.75,-99.04"/>
<polygon fill="#666666" stroke="#666666" points="1402.75,-102.4 1413.34,-102.46 1405.09,-95.8 1402.75,-102.4"/>
</g>
<!-- ReleasedLocks__new -->
<g id="node10" class="node">
<title>ReleasedLocks__new</title>
<path fill="none" stroke="#1c2123" d="M457,-0.5C457,-0.5 531,-0.5 531,-0.5 537,-0.5 543,-6.5 543,-12.5 543,-12.5 543,-26.5 543,-26.5 543,-32.5 537,-38.5 531,-38.5 531,-38.5 457,-38.5 457,-38.5 451,-38.5 445,-32.5 445,-26.5 445,-26.5 445,-12.5 445,-12.5 445,-6.5 451,-0.5 457,-0.5"/>
<text text-anchor="start" x="453" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="453" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new -->
<g id="edge9" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new</title>
<path fill="none" stroke="#666666" d="M125.09,-180.63C146.38,-136.42 179.93,-83.01 227,-53.5 289.76,-14.16 377.25,-10.59 434.49,-13.52"/>
<polygon fill="#666666" stroke="#666666" points="434.62,-17.03 444.82,-14.13 435.04,-10.04 434.62,-17.03"/>
</g>
<!-- ReleasedLocks__wake_up -->
<g id="node11" class="node">
<title>ReleasedLocks__wake_up</title>
<path fill="none" stroke="#1c2123" d="M1556,-204.5C1556,-204.5 1630,-204.5 1630,-204.5 1636,-204.5 1642,-210.5 1642,-216.5 1642,-216.5 1642,-230.5 1642,-230.5 1642,-236.5 1636,-242.5 1630,-242.5 1630,-242.5 1556,-242.5 1556,-242.5 1550,-242.5 1544,-236.5 1544,-230.5 1544,-230.5 1544,-216.5 1544,-216.5 1544,-210.5 1550,-204.5 1556,-204.5"/>
<text text-anchor="start" x="1552" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1552" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> wake_up</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge10" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="#666666" d="M191.24,-262.43C203.27,-263.28 215.41,-264.01 227,-264.5 389.97,-271.36 436.54,-307.07 594,-264.5 611.88,-259.67 612.31,-249 630,-243.5 743.85,-208.11 778.28,-223.5 897.5,-223.5 897.5,-223.5 897.5,-223.5 1292.5,-223.5 1376.31,-223.5 1473.3,-223.5 1533.66,-223.5"/>
<polygon fill="#666666" stroke="#666666" points="1533.76,-227 1543.76,-223.5 1533.76,-220 1533.76,-227"/>
</g>
<!-- lock__exists__Pessimistic -->
<g id="node12" class="node">
<title>lock__exists__Pessimistic</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M426.5,-330.5C426.5,-330.5 561.5,-330.5 561.5,-330.5 567.5,-330.5 573.5,-336.5 573.5,-342.5 573.5,-342.5 573.5,-394.5 573.5,-394.5 573.5,-400.5 567.5,-406.5 561.5,-406.5 561.5,-406.5 426.5,-406.5 426.5,-406.5 420.5,-406.5 414.5,-400.5 414.5,-394.5 414.5,-394.5 414.5,-342.5 414.5,-342.5 414.5,-336.5 420.5,-330.5 426.5,-330.5"/>
<text text-anchor="start" x="422.5" y="-391.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock__exists__Pessimistic</text>
<polyline fill="none" stroke="#8a8898" points="414.5,-383.5 573.5,-383.5 "/>
<text text-anchor="start" x="422.5" y="-368.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.lock存在</text>
<text text-anchor="start" x="422.5" y="-353.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.lock.ts == self.start_ts</text>
<text text-anchor="start" x="422.5" y="-338.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 3.lock type为Pessimistic</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__exists__Pessimistic -->
<g id="edge11" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__exists__Pessimistic</title>
<path fill="none" stroke="#666666" d="M335.81,-255.04C363.74,-275.2 400.78,-301.93 431.89,-324.39"/>
<polygon fill="#666666" stroke="#666666" points="429.92,-327.29 440.08,-330.3 434.02,-321.61 429.92,-327.29"/>
</g>
<!-- lock__exists__NOT__Pessimistic -->
<g id="node13" class="node">
<title>lock__exists__NOT__Pessimistic</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M406,-172C406,-172 582,-172 582,-172 588,-172 594,-178 594,-184 594,-184 594,-243 594,-243 594,-249 588,-255 582,-255 582,-255 406,-255 406,-255 400,-255 394,-249 394,-243 394,-243 394,-184 394,-184 394,-178 400,-172 406,-172"/>
<text text-anchor="start" x="402" y="-239.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock__exists__NOT__Pessimistic</text>
<text text-anchor="start" x="402" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> case2: 不是悲观lock</text>
<text text-anchor="start" x="402" y="-209.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 1.lock存在</text>
<text text-anchor="start" x="402" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.lock.ts == self.start_ts</text>
<text text-anchor="start" x="402" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 3.lock type不是悲观锁</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__exists__NOT__Pessimistic -->
<g id="edge12" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__exists__NOT__Pessimistic</title>
<path fill="none" stroke="#666666" d="M358.27,-220.93C366.45,-220.48 374.99,-220.01 383.62,-219.53"/>
<polygon fill="#666666" stroke="#666666" points="383.99,-223.02 393.78,-218.97 383.61,-216.03 383.99,-223.02"/>
</g>
<!-- overlapped_write -->
<g id="node18" class="node">
<title>overlapped_write</title>
<path fill="none" stroke="#1c2123" d="M942,-512.5C942,-512.5 855,-512.5 855,-512.5 849,-512.5 843,-506.5 843,-500.5 843,-500.5 843,-488.5 843,-488.5 843,-482.5 849,-476.5 855,-476.5 855,-476.5 942,-476.5 942,-476.5 948,-476.5 954,-482.5 954,-488.5 954,-488.5 954,-500.5 954,-500.5 954,-506.5 948,-512.5 942,-512.5"/>
<text text-anchor="middle" x="898.5" y="-490.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">overlapped_write</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;overlapped_write -->
<g id="edge19" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;overlapped_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M786.62,-493.31C801.94,-493.47 817.93,-493.64 832.84,-493.8"/>
<polygon fill="green" stroke="green" points="832.94,-497.31 842.98,-493.91 833.02,-490.31 832.94,-497.31"/>
</g>
<!-- SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge28" class="edge">
<title>SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M777.54,-439.16C852.78,-443 979.46,-448.5 1088.5,-448.5 1088.5,-448.5 1088.5,-448.5 1292.5,-448.5 1422.67,-448.5 1532.38,-310.96 1574.05,-250.95"/>
<polygon fill="green" stroke="green" points="1576.94,-252.91 1579.69,-242.68 1571.16,-248.96 1576.94,-252.91"/>
</g>
<!-- make_rollback&#45;&gt;MvccTxn__put_write -->
<g id="edge23" class="edge">
<title>make_rollback&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1173,-528.76C1182.51,-530.52 1192.23,-532.32 1201.81,-534.09"/>
<polygon fill="green" stroke="green" points="1201.26,-537.55 1211.73,-535.93 1202.53,-530.67 1201.26,-537.55"/>
</g>
<!-- SnapshotReader__seek_write -->
<g id="node14" class="node">
<title>SnapshotReader__seek_write</title>
<path fill="none" stroke="#1c2123" d="M1049.5,-107.5C1049.5,-107.5 1129.5,-107.5 1129.5,-107.5 1135.5,-107.5 1141.5,-113.5 1141.5,-119.5 1141.5,-119.5 1141.5,-133.5 1141.5,-133.5 1141.5,-139.5 1135.5,-145.5 1129.5,-145.5 1129.5,-145.5 1049.5,-145.5 1049.5,-145.5 1043.5,-145.5 1037.5,-139.5 1037.5,-133.5 1037.5,-133.5 1037.5,-119.5 1037.5,-119.5 1037.5,-113.5 1043.5,-107.5 1049.5,-107.5"/>
<text text-anchor="start" x="1045.5" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1045.5" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write -->
<g id="edge24" class="edge">
<title>collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write</title>
<path fill="none" stroke="#666666" d="M970.15,-141.53C988.99,-139.14 1009.19,-136.57 1027.47,-134.25"/>
<polygon fill="#666666" stroke="#666666" points="1027.92,-137.72 1037.4,-132.99 1027.04,-130.78 1027.92,-137.72"/>
</g>
<!-- MvccTxn__delete_write -->
<g id="node15" class="node">
<title>MvccTxn__delete_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1221,-100C1221,-100 1362,-100 1362,-100 1368,-100 1374,-106 1374,-112 1374,-112 1374,-179 1374,-179 1374,-185 1368,-191 1362,-191 1362,-191 1221,-191 1221,-191 1215,-191 1209,-185 1209,-179 1209,-179 1209,-112 1209,-112 1209,-106 1215,-100 1221,-100"/>
<text text-anchor="start" x="1217" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1217" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> delete_write</text>
<polyline fill="none" stroke="#8a8898" points="1209,-153 1374,-153 "/>
<text text-anchor="start" x="1217" y="-137.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">删除之前的Rollback类型</text>
<text text-anchor="start" x="1217" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 并且没被protected</text>
<text text-anchor="start" x="1217" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的Write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;MvccTxn__delete_write -->
<g id="edge25" class="edge">
<title>collapse_prev_rollback&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="#666666" d="M970.23,-154.29C982.17,-154.79 994.43,-155.23 1006,-155.5 1080.2,-157.24 1098.84,-158.65 1173,-155.5 1181.31,-155.15 1189.93,-154.65 1198.57,-154.08"/>
<polygon fill="#666666" stroke="#666666" points="1198.97,-157.56 1208.7,-153.36 1198.48,-150.57 1198.97,-157.56"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge27" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1484.83,-140.69C1505.85,-156.93 1536.14,-180.34 1559.16,-198.12"/>
<polygon fill="green" stroke="green" points="1557.23,-201.06 1567.28,-204.4 1561.51,-195.52 1557.23,-201.06"/>
</g>
<!-- ReleasedLocks__new&#45;&gt;ReleasedLocks__push -->
<g id="edge26" class="edge">
<title>ReleasedLocks__new&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M543.01,-20.48C618.47,-21.94 769.44,-24.5 897.5,-24.5 897.5,-24.5 897.5,-24.5 1090.5,-24.5 1217.16,-24.5 1256.91,-5.2 1374,-53.5 1396.66,-62.85 1418.06,-80.36 1433.59,-95.27"/>
<polygon fill="green" stroke="green" points="1431.16,-97.78 1440.73,-102.33 1436.09,-92.81 1431.16,-97.78"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge14" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M541.64,-406.6C566.73,-425.79 598.85,-448.35 630,-464.5 633.31,-466.22 636.75,-467.87 640.27,-469.46"/>
<polygon fill="#666666" stroke="#666666" points="639.12,-472.77 649.69,-473.49 641.87,-466.34 639.12,-472.77"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge15" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M573.65,-393.07C595.02,-399.74 618.02,-406.93 638.91,-413.45"/>
<polygon fill="#666666" stroke="#666666" points="638.07,-416.86 648.66,-416.5 640.16,-410.17 638.07,-416.86"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node16" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1262,-303.5C1262,-303.5 1321,-303.5 1321,-303.5 1327,-303.5 1333,-309.5 1333,-315.5 1333,-315.5 1333,-329.5 1333,-329.5 1333,-335.5 1327,-341.5 1321,-341.5 1321,-341.5 1262,-341.5 1262,-341.5 1256,-341.5 1250,-335.5 1250,-329.5 1250,-329.5 1250,-315.5 1250,-315.5 1250,-309.5 1256,-303.5 1262,-303.5"/>
<text text-anchor="start" x="1258" y="-326.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1258" y="-311.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> unlock_key</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key -->
<g id="edge16" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M573.57,-370.46C633.25,-371.47 717.33,-371.88 791,-368.5 955.6,-360.94 1149.75,-339.43 1239.85,-328.72"/>
<polygon fill="#666666" stroke="#666666" points="1240.28,-332.19 1249.8,-327.53 1239.45,-325.24 1240.28,-332.19"/>
</g>
<!-- need_rollback -->
<g id="node17" class="node">
<title>need_rollback</title>
<path fill="#feed9b" stroke="#f7e495" d="M642,-252.5C642,-252.5 779,-252.5 779,-252.5 785,-252.5 791,-258.5 791,-264.5 791,-264.5 791,-346.5 791,-346.5 791,-352.5 785,-358.5 779,-358.5 779,-358.5 642,-358.5 642,-358.5 636,-358.5 630,-352.5 630,-346.5 630,-346.5 630,-264.5 630,-264.5 630,-258.5 636,-252.5 642,-252.5"/>
<text text-anchor="start" x="638" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#40575d">need_rollback</text>
<polyline fill="none" stroke="#f7e495" points="630,-335.5 791,-335.5 "/>
<text text-anchor="start" x="638" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#40575d">to prevent the status</text>
<text text-anchor="start" x="638" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> to being changed</text>
<text text-anchor="start" x="638" y="-290.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> a rollback may be written</text>
<text text-anchor="start" x="638" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> and this rollback need to</text>
<text text-anchor="start" x="638" y="-260.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> be protected</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;need_rollback -->
<g id="edge17" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;need_rollback</title>
<path fill="none" stroke="#666666" d="M573.65,-345.4C588.66,-340.99 604.47,-336.35 619.79,-331.85"/>
<polygon fill="#666666" stroke="#666666" points="621.17,-335.09 629.78,-328.91 619.2,-328.37 621.17,-335.09"/>
</g>
<!-- lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge18" class="edge">
<title>lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M594.09,-190.86C607.25,-187.86 620.58,-184.81 633.28,-181.91"/>
<polygon fill="#666666" stroke="#666666" points="634.34,-185.26 643.31,-179.62 632.78,-178.44 634.34,-185.26"/>
</g>
<!-- SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write -->
<g id="edge13" class="edge">
<title>SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1141.75,-131.37C1159.09,-133.02 1179.03,-134.91 1198.55,-136.77"/>
<polygon fill="green" stroke="green" points="1198.42,-140.27 1208.71,-137.73 1199.09,-133.3 1198.42,-140.27"/>
</g>
<!-- MvccTxn__unlock_key&#45;&gt;ReleasedLocks__push -->
<g id="edge29" class="edge">
<title>MvccTxn__unlock_key&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1308.37,-303.23C1338.03,-267.21 1401.91,-189.62 1435.82,-148.44"/>
<polygon fill="green" stroke="green" points="1438.52,-150.66 1442.18,-140.71 1433.12,-146.21 1438.52,-150.66"/>
</g>
<!-- need_rollback&#45;&gt;make_rollback -->
<g id="edge21" class="edge">
<title>need_rollback&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M791.45,-349.61C860.81,-387.88 959.92,-442.56 1024.24,-478.04"/>
<polygon fill="#666666" stroke="#666666" points="1022.63,-481.15 1033.07,-482.92 1026.01,-475.03 1022.63,-481.15"/>
</g>
<!-- need_rollback&#45;&gt;collapse_prev_rollback -->
<g id="edge22" class="edge">
<title>need_rollback&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M775.25,-252.37C806.62,-226.23 842.93,-195.98 867.78,-175.27"/>
<polygon fill="#666666" stroke="#666666" points="870.3,-177.72 875.74,-168.63 865.82,-172.35 870.3,-177.72"/>
</g>
<!-- overlapped_write&#45;&gt;make_rollback -->
<g id="edge20" class="edge">
<title>overlapped_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M954.17,-500C967.15,-501.3 981.36,-502.73 995.53,-504.15"/>
<polygon fill="green" stroke="green" points="995.52,-507.67 1005.82,-505.19 996.22,-500.71 995.52,-507.67"/>
</g>
</g>
</svg>
