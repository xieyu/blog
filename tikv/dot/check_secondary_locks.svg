<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="2984pt" height="915pt"
 viewBox="0.00 0.00 2984.00 915.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 911)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-911 2980,-911 2980,4 -4,4"/>
<!-- CheckSecondaryLocks__process_write -->
<g id="node1" class="node">
<title>CheckSecondaryLocks__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-258.5C12,-258.5 179,-258.5 179,-258.5 185,-258.5 191,-264.5 191,-270.5 191,-270.5 191,-391.5 191,-391.5 191,-397.5 185,-403.5 179,-403.5 179,-403.5 12,-403.5 12,-403.5 6,-403.5 0,-397.5 0,-391.5 0,-391.5 0,-270.5 0,-270.5 0,-264.5 6,-258.5 12,-258.5"/>
<text text-anchor="start" x="8" y="-388.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks</text>
<text text-anchor="start" x="8" y="-373.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-365.5 191,-365.5 "/>
<text text-anchor="start" x="8" y="-350.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Check locks of an async</text>
<text text-anchor="start" x="8" y="-335.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit transaction</text>
<polyline fill="none" stroke="#1c2123" points="0,-327.5 191,-327.5 "/>
<text text-anchor="start" x="8" y="-312.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">keys: Vec&lt;Key&gt;</text>
<polyline fill="none" stroke="#1c2123" points="0,-304.5 191,-304.5 "/>
<text text-anchor="start" x="8" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: txn_types::TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-281.5 191,-281.5 "/>
<text text-anchor="start" x="8" y="-266.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历每个key</text>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node2" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M312.5,-546.5C312.5,-546.5 419.5,-546.5 419.5,-546.5 425.5,-546.5 431.5,-552.5 431.5,-558.5 431.5,-558.5 431.5,-595.5 431.5,-595.5 431.5,-601.5 425.5,-607.5 419.5,-607.5 419.5,-607.5 312.5,-607.5 312.5,-607.5 306.5,-607.5 300.5,-601.5 300.5,-595.5 300.5,-595.5 300.5,-558.5 300.5,-558.5 300.5,-552.5 306.5,-546.5 312.5,-546.5"/>
<text text-anchor="start" x="308.5" y="-592.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="308.5" y="-577.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="300.5,-569.5 431.5,-569.5 "/>
<text text-anchor="start" x="308.5" y="-554.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取key对应的lock</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock -->
<g id="edge1" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M158.8,-403.86C179.65,-426.83 203.56,-451.74 227,-473 253.57,-497.1 285.42,-521.37 311.83,-540.4"/>
<polygon fill="#666666" stroke="#666666" points="310.02,-543.41 320.19,-546.39 314.1,-537.72 310.02,-543.41"/>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node3" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M1007,-521C1007,-521 1135,-521 1135,-521 1141,-521 1147,-527 1147,-533 1147,-533 1147,-547 1147,-547 1147,-553 1141,-559 1135,-559 1135,-559 1007,-559 1007,-559 1001,-559 995,-553 995,-547 995,-547 995,-533 995,-533 995,-527 1001,-521 1007,-521"/>
<text text-anchor="start" x="1003" y="-543.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1003" y="-528.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge2" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M191.33,-387.52C203.08,-393.04 215.13,-398.04 227,-402 538.92,-505.96 637.35,-440.86 959,-509 971.56,-511.66 984.79,-514.93 997.57,-518.35"/>
<polygon fill="#666666" stroke="#666666" points="996.67,-521.73 1007.24,-520.97 998.51,-514.97 996.67,-521.73"/>
</g>
<!-- SecondaryLockStatus__Committed -->
<g id="node4" class="node">
<title>SecondaryLockStatus__Committed</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1376.5,-415C1376.5,-415 1486.5,-415 1486.5,-415 1492.5,-415 1498.5,-421 1498.5,-427 1498.5,-427 1498.5,-441 1498.5,-441 1498.5,-447 1492.5,-453 1486.5,-453 1486.5,-453 1376.5,-453 1376.5,-453 1370.5,-453 1364.5,-447 1364.5,-441 1364.5,-441 1364.5,-427 1364.5,-427 1364.5,-421 1370.5,-415 1376.5,-415"/>
<text text-anchor="start" x="1372.5" y="-437.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1372.5" y="-422.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Committed</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Committed -->
<g id="edge3" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Committed</title>
<path fill="none" stroke="#666666" d="M191.08,-325.61C297.88,-319.99 476.86,-312 631,-312 631,-312 631,-312 860,-312 990.05,-312 1024.43,-325.53 1147,-369 1164.05,-375.05 1165.91,-382.06 1183,-388 1238.8,-407.41 1304.69,-419.15 1354.45,-425.9"/>
<polygon fill="#666666" stroke="#666666" points="1354.12,-429.39 1364.49,-427.23 1355.04,-422.45 1354.12,-429.39"/>
</g>
<!-- SecondaryLockStatus__RolledBack -->
<g id="node5" class="node">
<title>SecondaryLockStatus__RolledBack</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1376.5,-498C1376.5,-498 1486.5,-498 1486.5,-498 1492.5,-498 1498.5,-504 1498.5,-510 1498.5,-510 1498.5,-524 1498.5,-524 1498.5,-530 1492.5,-536 1486.5,-536 1486.5,-536 1376.5,-536 1376.5,-536 1370.5,-536 1364.5,-530 1364.5,-524 1364.5,-524 1364.5,-510 1364.5,-510 1364.5,-504 1370.5,-498 1376.5,-498"/>
<text text-anchor="start" x="1372.5" y="-520.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1372.5" y="-505.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Rollbacked</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge4" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M191.04,-340.73C273.85,-349.3 397.43,-362.23 505,-374 550.02,-378.93 1271.29,-454.16 1315,-466 1339.13,-472.53 1364.68,-483.37 1385.6,-493.37"/>
<polygon fill="#666666" stroke="#666666" points="1384.34,-496.65 1394.86,-497.89 1387.41,-490.36 1384.34,-496.65"/>
</g>
<!-- SecondaryLockStatus__Locked -->
<g id="node6" class="node">
<title>SecondaryLockStatus__Locked</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1376.5,-742C1376.5,-742 1486.5,-742 1486.5,-742 1492.5,-742 1498.5,-748 1498.5,-754 1498.5,-754 1498.5,-768 1498.5,-768 1498.5,-774 1492.5,-780 1486.5,-780 1486.5,-780 1376.5,-780 1376.5,-780 1370.5,-780 1364.5,-774 1364.5,-768 1364.5,-768 1364.5,-754 1364.5,-754 1364.5,-748 1370.5,-742 1376.5,-742"/>
<text text-anchor="start" x="1372.5" y="-764.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1372.5" y="-749.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Locked</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge5" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M111.02,-403.78C127.83,-469.05 161.98,-562.67 227,-617 562.62,-897.46 1146.58,-817.43 1354.4,-777.4"/>
<polygon fill="#666666" stroke="#666666" points="1355.16,-780.82 1364.3,-775.47 1353.82,-773.95 1355.16,-780.82"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node7" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="#f5b691" stroke="#d69043" d="M1560,-763.5C1560,-763.5 1764,-763.5 1764,-763.5 1770,-763.5 1776,-769.5 1776,-775.5 1776,-775.5 1776,-842.5 1776,-842.5 1776,-848.5 1770,-854.5 1764,-854.5 1764,-854.5 1560,-854.5 1560,-854.5 1554,-854.5 1548,-848.5 1548,-842.5 1548,-842.5 1548,-775.5 1548,-775.5 1548,-769.5 1554,-763.5 1560,-763.5"/>
<text text-anchor="start" x="1556" y="-839.3" font-family="Times,serif" font-size="14.00" fill="#6b6969">MvccTxn</text>
<text text-anchor="start" x="1556" y="-824.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> mark_rollback_on_mismatching_lock</text>
<polyline fill="none" stroke="#d69043" points="1548,-816.5 1776,-816.5 "/>
<text text-anchor="start" x="1556" y="-801.3" font-family="Times,serif" font-size="14.00" fill="#6b6969">将ts加入mismatch lock</text>
<text text-anchor="start" x="1556" y="-786.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 的rollback_t数组中</text>
<text text-anchor="start" x="1556" y="-771.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 然后更新locks</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge6" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M103.5,-403.53C115.21,-486.28 146.15,-620.63 227,-702 361.47,-837.32 440.23,-847 631,-847 631,-847 631,-847 1250,-847 1346.89,-847 1456.09,-836.4 1537.57,-826.39"/>
<polygon fill="#666666" stroke="#666666" points="1538.37,-829.82 1547.87,-825.12 1537.51,-822.88 1538.37,-829.82"/>
</g>
<!-- make_rollback -->
<g id="node8" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M1590.5,-468.5C1590.5,-468.5 1733.5,-468.5 1733.5,-468.5 1739.5,-468.5 1745.5,-474.5 1745.5,-480.5 1745.5,-480.5 1745.5,-517.5 1745.5,-517.5 1745.5,-523.5 1739.5,-529.5 1733.5,-529.5 1733.5,-529.5 1590.5,-529.5 1590.5,-529.5 1584.5,-529.5 1578.5,-523.5 1578.5,-517.5 1578.5,-517.5 1578.5,-480.5 1578.5,-480.5 1578.5,-474.5 1584.5,-468.5 1590.5,-468.5"/>
<text text-anchor="start" x="1586.5" y="-514.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1578.5,-506.5 1745.5,-506.5 "/>
<text text-anchor="start" x="1586.5" y="-491.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建WriteType为Rollback</text>
<text text-anchor="start" x="1586.5" y="-476.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型的Write</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;make_rollback -->
<g id="edge7" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M191.13,-366.05C203.07,-369.32 215.22,-372.11 227,-374 348.99,-393.58 381.51,-377.91 505,-374 865.33,-362.59 960.3,-266.58 1315,-331 1427.55,-351.44 1544.41,-419.75 1609.41,-462.72"/>
<polygon fill="#666666" stroke="#666666" points="1607.58,-465.71 1617.84,-468.34 1611.46,-459.88 1607.58,-465.71"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node9" class="node">
<title>MvccTxn__put_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2826,-815.5C2826,-815.5 2961,-815.5 2961,-815.5 2967,-815.5 2973,-821.5 2973,-827.5 2973,-827.5 2973,-894.5 2973,-894.5 2973,-900.5 2967,-906.5 2961,-906.5 2961,-906.5 2826,-906.5 2826,-906.5 2820,-906.5 2814,-900.5 2814,-894.5 2814,-894.5 2814,-827.5 2814,-827.5 2814,-821.5 2820,-815.5 2826,-815.5"/>
<text text-anchor="start" x="2822" y="-891.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2822" y="-876.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_write</text>
<polyline fill="none" stroke="#8a8898" points="2814,-868.5 2973,-868.5 "/>
<text text-anchor="start" x="2822" y="-853.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">写入rollback write record</text>
<text text-anchor="start" x="2822" y="-838.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 注意这个地方用的是</text>
<text text-anchor="start" x="2822" y="-823.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> key, start_ts</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write -->
<g id="edge8" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M108.32,-403.96C128.34,-518.58 172.14,-733.24 227,-786 360.25,-914.15 446.13,-885 631,-885 631,-885 631,-885 2564.5,-885 2645.52,-885 2737.51,-877.63 2803.4,-871.05"/>
<polygon fill="#666666" stroke="#666666" points="2804.15,-874.49 2813.75,-870 2803.45,-867.53 2804.15,-874.49"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node10" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M2623,-609C2623,-609 2504,-609 2504,-609 2498,-609 2492,-603 2492,-597 2492,-597 2492,-585 2492,-585 2492,-579 2498,-573 2504,-573 2504,-573 2623,-573 2623,-573 2629,-573 2635,-579 2635,-585 2635,-585 2635,-597 2635,-597 2635,-603 2629,-609 2623,-609"/>
<text text-anchor="middle" x="2563.5" y="-587.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback -->
<g id="edge9" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M139.61,-258.27C161.7,-227.79 191.47,-195.26 227,-177 387.24,-94.66 450.85,-144 631,-144 631,-144 631,-144 2123.5,-144 2359.87,-144 2511.28,-466.1 2551.65,-563.46"/>
<polygon fill="#666666" stroke="#666666" points="2548.49,-564.99 2555.51,-572.92 2554.97,-562.34 2548.49,-564.99"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node11" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1488,-246C1488,-246 1375,-246 1375,-246 1369,-246 1363,-240 1363,-234 1363,-234 1363,-222 1363,-222 1363,-216 1369,-210 1375,-210 1375,-210 1488,-210 1488,-210 1494,-210 1500,-216 1500,-222 1500,-222 1500,-234 1500,-234 1500,-240 1494,-246 1488,-246"/>
<text text-anchor="middle" x="1431.5" y="-224.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__push</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push -->
<g id="edge10" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="#666666" d="M191.02,-273.46C202.82,-268.13 214.97,-263.44 227,-260 399.93,-210.5 451.13,-236 631,-236 631,-236 631,-236 1072,-236 1168.57,-236 1279.74,-233.06 1352.35,-230.75"/>
<polygon fill="#666666" stroke="#666666" points="1352.9,-234.23 1362.78,-230.41 1352.67,-227.24 1352.9,-234.23"/>
</g>
<!-- WriteResult__set_allowed_on_disk_almost_full -->
<g id="node12" class="node">
<title>WriteResult__set_allowed_on_disk_almost_full</title>
<path fill="none" stroke="#1c2123" d="M493,-116C493,-116 239,-116 239,-116 233,-116 227,-110 227,-104 227,-104 227,-92 227,-92 227,-86 233,-80 239,-80 239,-80 493,-80 493,-80 499,-80 505,-86 505,-92 505,-92 505,-104 505,-104 505,-110 499,-116 493,-116"/>
<text text-anchor="middle" x="366" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteResult__set_allowed_on_disk_almost_full</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;WriteResult__set_allowed_on_disk_almost_full -->
<g id="edge11" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;WriteResult__set_allowed_on_disk_almost_full</title>
<path fill="none" stroke="#666666" d="M126.55,-258.38C148.24,-214.78 181.69,-161.76 227,-130 232.15,-126.39 237.66,-123.18 243.39,-120.32"/>
<polygon fill="#666666" stroke="#666666" points="244.92,-123.47 252.56,-116.13 242.01,-117.1 244.92,-123.47"/>
</g>
<!-- ConcurrencyManager__update_max_ts -->
<g id="node13" class="node">
<title>ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M310.5,-0.5C310.5,-0.5 421.5,-0.5 421.5,-0.5 427.5,-0.5 433.5,-6.5 433.5,-12.5 433.5,-12.5 433.5,-49.5 433.5,-49.5 433.5,-55.5 427.5,-61.5 421.5,-61.5 421.5,-61.5 310.5,-61.5 310.5,-61.5 304.5,-61.5 298.5,-55.5 298.5,-49.5 298.5,-49.5 298.5,-12.5 298.5,-12.5 298.5,-6.5 304.5,-0.5 310.5,-0.5"/>
<text text-anchor="start" x="306.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager</text>
<text text-anchor="start" x="306.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> update_max_ts</text>
<polyline fill="none" stroke="#1c2123" points="298.5,-23.5 433.5,-23.5 "/>
<text text-anchor="start" x="306.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新max_ts</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge12" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M115.42,-258.22C134.31,-199.58 169.05,-119.21 227,-71 244.38,-56.54 266.75,-47.31 288.39,-41.41"/>
<polygon fill="#666666" stroke="#666666" points="289.42,-44.76 298.27,-38.93 287.72,-37.97 289.42,-44.76"/>
</g>
<!-- ReleasedLocks__new -->
<g id="node14" class="node">
<title>ReleasedLocks__new</title>
<path fill="none" stroke="#1c2123" d="M687,-208C687,-208 577,-208 577,-208 571,-208 565,-202 565,-196 565,-196 565,-184 565,-184 565,-178 571,-172 577,-172 577,-172 687,-172 687,-172 693,-172 699,-178 699,-184 699,-184 699,-196 699,-196 699,-202 693,-208 687,-208"/>
<text text-anchor="middle" x="632" y="-186.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__new</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new -->
<g id="edge13" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new</title>
<path fill="none" stroke="#666666" d="M167.82,-258.25C185.76,-243.87 205.95,-230.59 227,-222 334.4,-178.17 471.04,-177.52 554.7,-182.62"/>
<polygon fill="#666666" stroke="#666666" points="554.68,-186.12 564.89,-183.28 555.13,-179.14 554.68,-186.12"/>
</g>
<!-- ReleasedLocks__wake_up -->
<g id="node15" class="node">
<title>ReleasedLocks__wake_up</title>
<path fill="none" stroke="#1c2123" d="M1730.5,-292C1730.5,-292 1593.5,-292 1593.5,-292 1587.5,-292 1581.5,-286 1581.5,-280 1581.5,-280 1581.5,-268 1581.5,-268 1581.5,-262 1587.5,-256 1593.5,-256 1593.5,-256 1730.5,-256 1730.5,-256 1736.5,-256 1742.5,-262 1742.5,-268 1742.5,-268 1742.5,-280 1742.5,-280 1742.5,-286 1736.5,-292 1730.5,-292"/>
<text text-anchor="middle" x="1662" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__wake_up</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge14" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="#666666" d="M191.28,-314.74C297.87,-297.89 476.32,-274 631,-274 631,-274 631,-274 1250,-274 1360.62,-274 1487.99,-274 1571.26,-274"/>
<polygon fill="#666666" stroke="#666666" points="1571.44,-277.5 1581.44,-274 1571.44,-270.5 1571.44,-277.5"/>
</g>
<!-- lock__mismatch -->
<g id="node16" class="node">
<title>lock__mismatch</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M562.5,-626.5C562.5,-626.5 701.5,-626.5 701.5,-626.5 707.5,-626.5 713.5,-632.5 713.5,-638.5 713.5,-638.5 713.5,-675.5 713.5,-675.5 713.5,-681.5 707.5,-687.5 701.5,-687.5 701.5,-687.5 562.5,-687.5 562.5,-687.5 556.5,-687.5 550.5,-681.5 550.5,-675.5 550.5,-675.5 550.5,-638.5 550.5,-638.5 550.5,-632.5 556.5,-626.5 562.5,-626.5"/>
<text text-anchor="start" x="558.5" y="-672.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock mismatch</text>
<polyline fill="none" stroke="#8a8898" points="550.5,-664.5 713.5,-664.5 "/>
<text text-anchor="start" x="558.5" y="-649.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1. lock为None</text>
<text text-anchor="start" x="558.5" y="-634.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2. 或者Lock.ts != start_ts</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__mismatch -->
<g id="edge15" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__mismatch</title>
<path fill="none" stroke="#666666" d="M431.58,-596.57C464.23,-606.46 504.41,-618.64 540.12,-629.46"/>
<polygon fill="#666666" stroke="#666666" points="539.48,-632.92 550.06,-632.47 541.51,-626.22 539.48,-632.92"/>
</g>
<!-- lock__exists -->
<g id="node17" class="node">
<title>lock__exists</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M553,-546.5C553,-546.5 711,-546.5 711,-546.5 717,-546.5 723,-552.5 723,-558.5 723,-558.5 723,-595.5 723,-595.5 723,-601.5 717,-607.5 711,-607.5 711,-607.5 553,-607.5 553,-607.5 547,-607.5 541,-601.5 541,-595.5 541,-595.5 541,-558.5 541,-558.5 541,-552.5 547,-546.5 553,-546.5"/>
<text text-anchor="start" x="549" y="-592.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock exists</text>
<polyline fill="none" stroke="#8a8898" points="541,-584.5 723,-584.5 "/>
<text text-anchor="start" x="549" y="-569.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.lock存在</text>
<text text-anchor="start" x="549" y="-554.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.并且lock.ts == self.start_ts</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__exists -->
<g id="edge16" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__exists</title>
<path fill="none" stroke="#666666" d="M431.58,-577C461.39,-577 497.48,-577 530.71,-577"/>
<polygon fill="#666666" stroke="#666666" points="530.92,-580.5 540.92,-577 530.92,-573.5 530.92,-580.5"/>
</g>
<!-- TxnCommitRecord__None -->
<g id="node24" class="node">
<title>TxnCommitRecord__None</title>
<path fill="none" stroke="#1c2123" d="M1199.5,-628C1199.5,-628 1298.5,-628 1298.5,-628 1304.5,-628 1310.5,-634 1310.5,-640 1310.5,-640 1310.5,-654 1310.5,-654 1310.5,-660 1304.5,-666 1298.5,-666 1298.5,-666 1199.5,-666 1199.5,-666 1193.5,-666 1187.5,-660 1187.5,-654 1187.5,-654 1187.5,-640 1187.5,-640 1187.5,-634 1193.5,-628 1199.5,-628"/>
<text text-anchor="start" x="1195.5" y="-650.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1195.5" y="-635.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> None</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None -->
<g id="edge28" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1103.47,-559.13C1132.66,-576.88 1176.24,-603.38 1207.92,-622.63"/>
<polygon fill="green" stroke="green" points="1206.15,-625.65 1216.51,-627.86 1209.78,-619.67 1206.15,-625.65"/>
</g>
<!-- TxnCommitRecord__SingleRecord -->
<g id="node25" class="node">
<title>TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="#1c2123" d="M1199.5,-475C1199.5,-475 1298.5,-475 1298.5,-475 1304.5,-475 1310.5,-481 1310.5,-487 1310.5,-487 1310.5,-501 1310.5,-501 1310.5,-507 1304.5,-513 1298.5,-513 1298.5,-513 1199.5,-513 1199.5,-513 1193.5,-513 1187.5,-507 1187.5,-501 1187.5,-501 1187.5,-487 1187.5,-487 1187.5,-481 1193.5,-475 1199.5,-475"/>
<text text-anchor="start" x="1195.5" y="-497.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1195.5" y="-482.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> SingleRecord</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord -->
<g id="edge29" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1144.86,-520.96C1155.64,-518.14 1166.75,-515.24 1177.48,-512.43"/>
<polygon fill="green" stroke="green" points="1178.44,-515.8 1187.23,-509.88 1176.67,-509.03 1178.44,-515.8"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback -->
<g id="node26" class="node">
<title>TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="#1c2123" d="M1195,-532C1195,-532 1303,-532 1303,-532 1309,-532 1315,-538 1315,-544 1315,-544 1315,-558 1315,-558 1315,-564 1309,-570 1303,-570 1303,-570 1195,-570 1195,-570 1189,-570 1183,-564 1183,-558 1183,-558 1183,-544 1183,-544 1183,-538 1189,-532 1195,-532"/>
<text text-anchor="start" x="1191" y="-554.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1191" y="-539.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> OverlappedRollback</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback -->
<g id="edge30" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1147.15,-544.7C1155.59,-545.22 1164.18,-545.76 1172.62,-546.29"/>
<polygon fill="green" stroke="green" points="1172.62,-549.8 1182.81,-546.93 1173.05,-542.81 1172.62,-549.8"/>
</g>
<!-- SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge50" class="edge">
<title>SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1465.51,-497.8C1480.49,-488.3 1497.96,-476.08 1512,-463 1566.91,-411.85 1618.11,-339.45 1643.78,-300.79"/>
<polygon fill="green" stroke="green" points="1646.88,-302.44 1649.45,-292.17 1641.03,-298.6 1646.88,-302.44"/>
</g>
<!-- Lock__rollback_ts__push -->
<g id="node31" class="node">
<title>Lock__rollback_ts__push</title>
<path fill="none" stroke="#1c2123" d="M2056,-776C2056,-776 2189,-776 2189,-776 2195,-776 2201,-782 2201,-788 2201,-788 2201,-840 2201,-840 2201,-846 2195,-852 2189,-852 2189,-852 2056,-852 2056,-852 2050,-852 2044,-846 2044,-840 2044,-840 2044,-788 2044,-788 2044,-782 2050,-776 2056,-776"/>
<text text-anchor="start" x="2052" y="-836.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock</text>
<text text-anchor="start" x="2052" y="-821.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rollback_ts::push</text>
<polyline fill="none" stroke="#1c2123" points="2044,-814 2201,-814 "/>
<text text-anchor="start" x="2052" y="-798.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将事务ts加入rollback_ts</text>
<text text-anchor="start" x="2052" y="-783.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 数组</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push -->
<g id="edge51" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push</title>
<path fill="none" stroke="#666666" d="M1776.04,-810.23C1855.57,-811.1 1960.45,-812.24 2033.7,-813.04"/>
<polygon fill="#666666" stroke="#666666" points="2033.79,-816.54 2043.82,-813.15 2033.86,-809.54 2033.79,-816.54"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node32" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2841.5,-723.5C2841.5,-723.5 2945.5,-723.5 2945.5,-723.5 2951.5,-723.5 2957.5,-729.5 2957.5,-735.5 2957.5,-735.5 2957.5,-772.5 2957.5,-772.5 2957.5,-778.5 2951.5,-784.5 2945.5,-784.5 2945.5,-784.5 2841.5,-784.5 2841.5,-784.5 2835.5,-784.5 2829.5,-778.5 2829.5,-772.5 2829.5,-772.5 2829.5,-735.5 2829.5,-735.5 2829.5,-729.5 2835.5,-723.5 2841.5,-723.5"/>
<text text-anchor="start" x="2837.5" y="-769.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2837.5" y="-754.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<polyline fill="none" stroke="#8a8898" points="2829.5,-746.5 2957.5,-746.5 "/>
<text text-anchor="start" x="2837.5" y="-731.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">更新mistached lock</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock -->
<g id="edge52" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1776.42,-785.03C1868.86,-767.58 2003.02,-747 2121.5,-747 2121.5,-747 2121.5,-747 2564.5,-747 2651.95,-747 2752.49,-749.52 2818.95,-751.53"/>
<polygon fill="green" stroke="green" points="2819.22,-755.04 2829.32,-751.85 2819.44,-748.05 2819.22,-755.04"/>
</g>
<!-- Write__set_ovelapped_rollback -->
<g id="node27" class="node">
<title>Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#1c2123" d="M1829.5,-548C1829.5,-548 1990.5,-548 1990.5,-548 1996.5,-548 2002.5,-554 2002.5,-560 2002.5,-560 2002.5,-612 2002.5,-612 2002.5,-618 1996.5,-624 1990.5,-624 1990.5,-624 1829.5,-624 1829.5,-624 1823.5,-624 1817.5,-618 1817.5,-612 1817.5,-612 1817.5,-560 1817.5,-560 1817.5,-554 1823.5,-548 1829.5,-548"/>
<text text-anchor="start" x="1825.5" y="-608.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="1825.5" y="-593.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_ovelapped_rollback</text>
<text text-anchor="start" x="1825.5" y="-578.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1817.5,-571 2002.5,-571 "/>
<text text-anchor="start" x="1825.5" y="-555.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">和gc_fenece</text>
</g>
<!-- make_rollback&#45;&gt;Write__set_ovelapped_rollback -->
<g id="edge38" class="edge">
<title>make_rollback&#45;&gt;Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M1745.6,-528.21C1765.57,-535.28 1787.14,-542.9 1807.86,-550.23"/>
<polygon fill="#666666" stroke="#666666" points="1806.71,-553.54 1817.31,-553.57 1809.05,-546.94 1806.71,-553.54"/>
</g>
<!-- Write__new_rollback -->
<g id="node28" class="node">
<title>Write__new_rollback</title>
<path fill="none" stroke="#1c2123" d="M1824,-453C1824,-453 1996,-453 1996,-453 2002,-453 2008,-459 2008,-465 2008,-465 2008,-517 2008,-517 2008,-523 2002,-529 1996,-529 1996,-529 1824,-529 1824,-529 1818,-529 1812,-523 1812,-517 1812,-517 1812,-465 1812,-465 1812,-459 1818,-453 1824,-453"/>
<text text-anchor="start" x="1820" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="1820" y="-498.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1812,-491 2008,-491 "/>
<text text-anchor="start" x="1820" y="-475.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">新建Write类型为Rollback</text>
<text text-anchor="start" x="1820" y="-460.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> has_overlapped_rollback为false</text>
</g>
<!-- make_rollback&#45;&gt;Write__new_rollback -->
<g id="edge39" class="edge">
<title>make_rollback&#45;&gt;Write__new_rollback</title>
<path fill="none" stroke="#666666" d="M1745.6,-496.31C1763.58,-495.73 1782.86,-495.1 1801.65,-494.49"/>
<polygon fill="#666666" stroke="#666666" points="1801.84,-497.99 1811.72,-494.16 1801.61,-490.99 1801.84,-497.99"/>
</g>
<!-- SnapshotReader__seek_write -->
<g id="node18" class="node">
<title>SnapshotReader__seek_write</title>
<path fill="none" stroke="#1c2123" d="M2683,-571C2683,-571 2763,-571 2763,-571 2769,-571 2775,-577 2775,-583 2775,-583 2775,-597 2775,-597 2775,-603 2769,-609 2763,-609 2763,-609 2683,-609 2683,-609 2677,-609 2671,-603 2671,-597 2671,-597 2671,-583 2671,-583 2671,-577 2677,-571 2683,-571"/>
<text text-anchor="start" x="2679" y="-593.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="2679" y="-578.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write -->
<g id="edge46" class="edge">
<title>collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write</title>
<path fill="none" stroke="#666666" d="M2635.42,-590.55C2643.8,-590.5 2652.3,-590.44 2660.54,-590.39"/>
<polygon fill="#666666" stroke="#666666" points="2660.82,-593.89 2670.8,-590.33 2660.78,-586.89 2660.82,-593.89"/>
</g>
<!-- MvccTxn__delete_write -->
<g id="node19" class="node">
<title>MvccTxn__delete_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2823,-590.5C2823,-590.5 2964,-590.5 2964,-590.5 2970,-590.5 2976,-596.5 2976,-602.5 2976,-602.5 2976,-669.5 2976,-669.5 2976,-675.5 2970,-681.5 2964,-681.5 2964,-681.5 2823,-681.5 2823,-681.5 2817,-681.5 2811,-675.5 2811,-669.5 2811,-669.5 2811,-602.5 2811,-602.5 2811,-596.5 2817,-590.5 2823,-590.5"/>
<text text-anchor="start" x="2819" y="-666.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2819" y="-651.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> delete_write</text>
<polyline fill="none" stroke="#8a8898" points="2811,-643.5 2976,-643.5 "/>
<text text-anchor="start" x="2819" y="-628.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">删除之前的Rollback类型</text>
<text text-anchor="start" x="2819" y="-613.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 并且没被protected</text>
<text text-anchor="start" x="2819" y="-598.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的Write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;MvccTxn__delete_write -->
<g id="edge47" class="edge">
<title>collapse_prev_rollback&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="#666666" d="M2625.47,-609.05C2640.26,-612.87 2656.11,-616.49 2671,-619 2713.34,-626.13 2760.73,-630.27 2800.79,-632.68"/>
<polygon fill="#666666" stroke="#666666" points="2800.62,-636.18 2810.81,-633.25 2801.02,-629.19 2800.62,-636.18"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge49" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1500.13,-241.61C1522.47,-246.11 1547.68,-251.19 1571.4,-255.96"/>
<polygon fill="green" stroke="green" points="1570.97,-259.45 1581.46,-257.99 1572.35,-252.58 1570.97,-259.45"/>
</g>
<!-- ReleasedLocks__new&#45;&gt;ReleasedLocks__push -->
<g id="edge48" class="edge">
<title>ReleasedLocks__new&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M699.32,-193C821.24,-198.54 1089.17,-210.84 1315,-222 1327.18,-222.6 1340.09,-223.26 1352.69,-223.9"/>
<polygon fill="green" stroke="green" points="1352.54,-227.4 1362.71,-224.42 1352.9,-220.41 1352.54,-227.4"/>
</g>
<!-- lock__mismatch&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge25" class="edge">
<title>lock__mismatch&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M711.27,-626.43C715.44,-623.53 719.39,-620.39 723,-617 748.21,-593.32 729.65,-566.31 759,-548 826.12,-506.12 918.25,-509.55 984.8,-520.15"/>
<polygon fill="green" stroke="green" points="984.39,-523.63 994.84,-521.83 985.55,-516.72 984.39,-523.63"/>
</g>
<!-- lock__mismatch&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge26" class="edge">
<title>lock__mismatch&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M680.2,-687.58C703.1,-700.96 731.54,-715.51 759,-724 1027.65,-807.07 1360.98,-815.57 1537.63,-813.14"/>
<polygon fill="green" stroke="green" points="1537.79,-816.64 1547.74,-812.98 1537.69,-809.64 1537.79,-816.64"/>
</g>
<!-- lock__mismatch&#45;&gt;TxnCommitRecord__None -->
<g id="edge27" class="edge">
<title>lock__mismatch&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M713.72,-655.69C834.87,-653.72 1061.79,-650.03 1176.99,-648.15"/>
<polygon fill="green" stroke="green" points="1177.17,-651.65 1187.11,-647.99 1177.06,-644.65 1177.17,-651.65"/>
</g>
<!-- lock__exists__Pessimistic -->
<g id="node20" class="node">
<title>lock__exists__Pessimistic</title>
<path fill="none" stroke="#1c2123" d="M791.5,-557.5C791.5,-557.5 926.5,-557.5 926.5,-557.5 932.5,-557.5 938.5,-563.5 938.5,-569.5 938.5,-569.5 938.5,-606.5 938.5,-606.5 938.5,-612.5 932.5,-618.5 926.5,-618.5 926.5,-618.5 791.5,-618.5 791.5,-618.5 785.5,-618.5 779.5,-612.5 779.5,-606.5 779.5,-606.5 779.5,-569.5 779.5,-569.5 779.5,-563.5 785.5,-557.5 791.5,-557.5"/>
<text text-anchor="start" x="787.5" y="-603.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock__exists__Pessimistic</text>
<polyline fill="none" stroke="#1c2123" points="779.5,-595.5 938.5,-595.5 "/>
<text text-anchor="start" x="787.5" y="-580.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">case1: 并且Lock type</text>
<text text-anchor="start" x="787.5" y="-565.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 为Pessimistic</text>
</g>
<!-- lock__exists&#45;&gt;lock__exists__Pessimistic -->
<g id="edge18" class="edge">
<title>lock__exists&#45;&gt;lock__exists__Pessimistic</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M723.22,-581.41C738.32,-582.15 753.98,-582.91 769.04,-583.65"/>
<polygon fill="green" stroke="green" points="769.21,-587.16 779.37,-584.16 769.55,-580.17 769.21,-587.16"/>
</g>
<!-- lock__exists__NOT__Pessimistic -->
<g id="node21" class="node">
<title>lock__exists__NOT__Pessimistic</title>
<path fill="none" stroke="#1c2123" d="M771,-676C771,-676 947,-676 947,-676 953,-676 959,-682 959,-688 959,-688 959,-702 959,-702 959,-708 953,-714 947,-714 947,-714 771,-714 771,-714 765,-714 759,-708 759,-702 759,-702 759,-688 759,-688 759,-682 765,-676 771,-676"/>
<text text-anchor="start" x="767" y="-698.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock__exists__NOT__Pessimistic</text>
<text text-anchor="start" x="767" y="-683.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> case2: 不是悲观lock</text>
</g>
<!-- lock__exists&#45;&gt;lock__exists__NOT__Pessimistic -->
<g id="edge19" class="edge">
<title>lock__exists&#45;&gt;lock__exists__NOT__Pessimistic</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M703.6,-607.52C710.2,-610.63 716.75,-613.82 723,-617 755.83,-633.72 791.91,-654.71 818.51,-670.7"/>
<polygon fill="green" stroke="green" points="816.78,-673.75 827.15,-675.92 820.4,-667.76 816.78,-673.75"/>
</g>
<!-- SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write -->
<g id="edge17" class="edge">
<title>SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2775.01,-603.93C2783.34,-606.2 2792.17,-608.61 2801.12,-611.05"/>
<polygon fill="green" stroke="green" points="2800.28,-614.45 2810.85,-613.71 2802.12,-607.7 2800.28,-614.45"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge20" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M938.79,-569.99C953.88,-566.54 969.73,-562.92 985,-559.43"/>
<polygon fill="#666666" stroke="#666666" points="985.97,-562.8 994.94,-557.16 984.41,-555.97 985.97,-562.8"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge21" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M938.84,-597.84C1030.83,-606.77 1186.68,-613.92 1315,-580 1343.92,-572.35 1373.47,-556.05 1395.45,-541.94"/>
<polygon fill="#666666" stroke="#666666" points="1397.65,-544.68 1404.08,-536.26 1393.8,-538.83 1397.65,-544.68"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node22" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1041.5,-379C1041.5,-379 1100.5,-379 1100.5,-379 1106.5,-379 1112.5,-385 1112.5,-391 1112.5,-391 1112.5,-405 1112.5,-405 1112.5,-411 1106.5,-417 1100.5,-417 1100.5,-417 1041.5,-417 1041.5,-417 1035.5,-417 1029.5,-411 1029.5,-405 1029.5,-405 1029.5,-391 1029.5,-391 1029.5,-385 1035.5,-379 1041.5,-379"/>
<text text-anchor="start" x="1037.5" y="-401.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1037.5" y="-386.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> unlock_key</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key -->
<g id="edge22" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M893.74,-557.47C934.55,-520.55 1002.54,-459.03 1041.06,-424.18"/>
<polygon fill="#666666" stroke="#666666" points="1043.75,-426.47 1048.82,-417.17 1039.05,-421.28 1043.75,-426.47"/>
</g>
<!-- need_rollback -->
<g id="node23" class="node">
<title>need_rollback</title>
<path fill="#feed9b" stroke="#f7e495" d="M1363,-617C1363,-617 1500,-617 1500,-617 1506,-617 1512,-623 1512,-629 1512,-629 1512,-711 1512,-711 1512,-717 1506,-723 1500,-723 1500,-723 1363,-723 1363,-723 1357,-723 1351,-717 1351,-711 1351,-711 1351,-629 1351,-629 1351,-623 1357,-617 1363,-617"/>
<text text-anchor="start" x="1359" y="-707.8" font-family="Times,serif" font-size="14.00" fill="#40575d">need_rollback</text>
<polyline fill="none" stroke="#f7e495" points="1351,-700 1512,-700 "/>
<text text-anchor="start" x="1359" y="-684.8" font-family="Times,serif" font-size="14.00" fill="#40575d">to prevent the status</text>
<text text-anchor="start" x="1359" y="-669.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> to being changed</text>
<text text-anchor="start" x="1359" y="-654.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> a rollback may be written</text>
<text text-anchor="start" x="1359" y="-639.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> and this rollback need to</text>
<text text-anchor="start" x="1359" y="-624.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> be protected</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;need_rollback -->
<g id="edge23" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;need_rollback</title>
<path fill="none" stroke="#666666" d="M938.76,-615.79C1003.43,-637.06 1097.89,-664.61 1183,-676 1241.15,-683.78 1256.35,-677.52 1315,-676 1323.37,-675.78 1332.07,-675.48 1340.78,-675.12"/>
<polygon fill="#666666" stroke="#666666" points="1341.15,-678.61 1350.99,-674.67 1340.85,-671.61 1341.15,-678.61"/>
</g>
<!-- lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge24" class="edge">
<title>lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M959.05,-706.46C1071.34,-719.45 1251.99,-740.35 1353.98,-752.15"/>
<polygon fill="#666666" stroke="#666666" points="1353.87,-755.66 1364.21,-753.33 1354.68,-748.7 1353.87,-755.66"/>
</g>
<!-- released_lock -->
<g id="node33" class="node">
<title>released_lock</title>
<path fill="#feed9b" stroke="#f7e495" d="M1210.5,-341C1210.5,-341 1287.5,-341 1287.5,-341 1293.5,-341 1299.5,-347 1299.5,-353 1299.5,-353 1299.5,-367 1299.5,-367 1299.5,-373 1293.5,-379 1287.5,-379 1287.5,-379 1210.5,-379 1210.5,-379 1204.5,-379 1198.5,-373 1198.5,-367 1198.5,-367 1198.5,-353 1198.5,-353 1198.5,-347 1204.5,-341 1210.5,-341"/>
<text text-anchor="start" x="1206.5" y="-363.8" font-family="Times,serif" font-size="14.00" fill="#40575d">released_lock</text>
<text text-anchor="start" x="1206.5" y="-348.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 被释放的lock</text>
</g>
<!-- MvccTxn__unlock_key&#45;&gt;released_lock -->
<g id="edge53" class="edge">
<title>MvccTxn__unlock_key&#45;&gt;released_lock</title>
<path fill="none" stroke="#666666" d="M1112.82,-389.19C1135.22,-384.35 1163.42,-378.26 1188.25,-372.9"/>
<polygon fill="#666666" stroke="#666666" points="1189.26,-376.26 1198.3,-370.73 1187.79,-369.42 1189.26,-376.26"/>
</g>
<!-- need_rollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge36" class="edge">
<title>need_rollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M1512.1,-718.42C1533.15,-731.23 1555.94,-745.09 1577.21,-758.03"/>
<polygon fill="#666666" stroke="#666666" points="1575.55,-761.11 1585.91,-763.32 1579.19,-755.13 1575.55,-761.11"/>
</g>
<!-- need_rollback&#45;&gt;make_rollback -->
<g id="edge37" class="edge">
<title>need_rollback&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M1471.88,-616.97C1492.39,-592.21 1519.18,-563.88 1548,-544 1554.6,-539.45 1561.73,-535.25 1569.08,-531.42"/>
<polygon fill="#666666" stroke="#666666" points="1571.09,-534.32 1578.49,-526.74 1567.98,-528.05 1571.09,-534.32"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge34" class="edge">
<title>TxnCommitRecord__None&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M1291.87,-627.82C1299.86,-623.42 1307.92,-618.42 1315,-613 1333.73,-598.66 1333.32,-589.62 1351,-574 1363.74,-562.75 1378.66,-551.58 1392.12,-542.15"/>
<polygon fill="#666666" stroke="#666666" points="1394.47,-544.78 1400.72,-536.23 1390.5,-539.02 1394.47,-544.78"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;need_rollback -->
<g id="edge35" class="edge">
<title>TxnCommitRecord__None&#45;&gt;need_rollback</title>
<path fill="none" stroke="#666666" d="M1310.61,-654.72C1320.28,-655.96 1330.47,-657.25 1340.66,-658.55"/>
<polygon fill="#666666" stroke="#666666" points="1340.46,-662.05 1350.82,-659.85 1341.34,-655.11 1340.46,-662.05"/>
</g>
<!-- overlapped_write -->
<g id="node34" class="node">
<title>overlapped_write</title>
<path fill="none" stroke="#1c2123" d="M1591.5,-553.5C1591.5,-553.5 1732.5,-553.5 1732.5,-553.5 1738.5,-553.5 1744.5,-559.5 1744.5,-565.5 1744.5,-565.5 1744.5,-610.5 1744.5,-610.5 1744.5,-616.5 1738.5,-622.5 1732.5,-622.5 1732.5,-622.5 1591.5,-622.5 1591.5,-622.5 1585.5,-622.5 1579.5,-616.5 1579.5,-610.5 1579.5,-610.5 1579.5,-565.5 1579.5,-565.5 1579.5,-559.5 1585.5,-553.5 1591.5,-553.5"/>
<text text-anchor="start" x="1587.5" y="-607.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">OverlappedWrite</text>
<polyline fill="none" stroke="#1c2123" points="1579.5,-599.5 1744.5,-599.5 "/>
<text text-anchor="start" x="1587.5" y="-584.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub write: Write,</text>
<polyline fill="none" stroke="#1c2123" points="1579.5,-576.5 1744.5,-576.5 "/>
<text text-anchor="start" x="1587.5" y="-561.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub gc_fence: TimeStamp,</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;overlapped_write -->
<g id="edge56" class="edge">
<title>TxnCommitRecord__None&#45;&gt;overlapped_write</title>
<path fill="none" stroke="#666666" d="M1290.89,-627.95C1308.93,-620.41 1330.62,-612.48 1351,-608 1423.22,-592.12 1507.01,-587.51 1569.26,-586.66"/>
<polygon fill="#666666" stroke="#666666" points="1569.49,-590.16 1579.45,-586.55 1569.41,-583.16 1569.49,-590.16"/>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__Committed -->
<g id="edge31" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__Committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1307.61,-474.85C1325.36,-468.95 1345.06,-462.4 1363.4,-456.31"/>
<polygon fill="green" stroke="green" points="1364.74,-459.55 1373.13,-453.07 1362.54,-452.9 1364.74,-459.55"/>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge32" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1310.61,-501.72C1324.67,-503.51 1339.81,-505.44 1354.45,-507.31"/>
<polygon fill="green" stroke="green" points="1354.11,-510.79 1364.47,-508.59 1355,-503.85 1354.11,-510.79"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge33" class="edge">
<title>TxnCommitRecord__OverlappedRollback&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1315.16,-538.73C1327.88,-536.33 1341.31,-533.8 1354.35,-531.34"/>
<polygon fill="green" stroke="green" points="1355.04,-534.78 1364.22,-529.49 1353.74,-527.9 1355.04,-534.78"/>
</g>
<!-- Write -->
<g id="node30" class="node">
<title>Write</title>
<path fill="none" stroke="#1c2123" d="M2249,-535C2249,-535 2444,-535 2444,-535 2450,-535 2456,-541 2456,-547 2456,-547 2456,-653 2456,-653 2456,-659 2450,-665 2444,-665 2444,-665 2249,-665 2249,-665 2243,-665 2237,-659 2237,-653 2237,-653 2237,-547 2237,-547 2237,-541 2243,-535 2249,-535"/>
<text text-anchor="start" x="2245" y="-649.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="2245" y="-634.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pub write_type: WriteType,</text>
<polyline fill="none" stroke="#1c2123" points="2237,-627 2456,-627 "/>
<text text-anchor="start" x="2245" y="-611.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub start_ts: TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="2237,-604 2456,-604 "/>
<text text-anchor="start" x="2245" y="-588.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub short_value: Option&lt;Value&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="2237,-581 2456,-581 "/>
<text text-anchor="start" x="2245" y="-565.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub has_overlapped_rollback: bool,</text>
<polyline fill="none" stroke="#1c2123" points="2237,-558 2456,-558 "/>
<text text-anchor="start" x="2245" y="-542.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub gc_fence: Option&lt;TimeStamp&gt;,</text>
</g>
<!-- Write__set_ovelapped_rollback&#45;&gt;Write -->
<g id="edge43" class="edge">
<title>Write__set_ovelapped_rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2002.62,-588.95C2067.76,-591.05 2155.86,-593.89 2226.44,-596.16"/>
<polygon fill="green" stroke="green" points="2226.62,-599.67 2236.73,-596.5 2226.85,-592.67 2226.62,-599.67"/>
</g>
<!-- WriteType__Rollback -->
<g id="node29" class="node">
<title>WriteType__Rollback</title>
<path fill="none" stroke="#1c2123" d="M2069,-516.5C2069,-516.5 2176,-516.5 2176,-516.5 2182,-516.5 2188,-522.5 2188,-528.5 2188,-528.5 2188,-565.5 2188,-565.5 2188,-571.5 2182,-577.5 2176,-577.5 2176,-577.5 2069,-577.5 2069,-577.5 2063,-577.5 2057,-571.5 2057,-565.5 2057,-565.5 2057,-528.5 2057,-528.5 2057,-522.5 2063,-516.5 2069,-516.5"/>
<text text-anchor="start" x="2065" y="-562.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType</text>
<text text-anchor="start" x="2065" y="-547.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Rollback</text>
<polyline fill="none" stroke="#1c2123" points="2057,-539.5 2188,-539.5 "/>
<text text-anchor="start" x="2065" y="-524.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write类型为rollback</text>
</g>
<!-- Write__new_rollback&#45;&gt;WriteType__Rollback -->
<g id="edge40" class="edge">
<title>Write__new_rollback&#45;&gt;WriteType__Rollback</title>
<path fill="none" stroke="#666666" d="M2008.24,-516.87C2021.24,-520.33 2034.41,-523.83 2046.95,-527.17"/>
<polygon fill="#666666" stroke="#666666" points="2046.28,-530.61 2056.85,-529.8 2048.08,-523.85 2046.28,-530.61"/>
</g>
<!-- Write__new_rollback&#45;&gt;Write -->
<g id="edge41" class="edge">
<title>Write__new_rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2008.28,-484.1C2065.69,-483.02 2139,-486.9 2201,-507 2218.12,-512.55 2235.2,-520.65 2251.3,-529.79"/>
<polygon fill="green" stroke="green" points="2249.74,-532.93 2260.14,-534.96 2253.28,-526.89 2249.74,-532.93"/>
</g>
<!-- WriteType__Rollback&#45;&gt;Write -->
<g id="edge42" class="edge">
<title>WriteType__Rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2188.01,-562.4C2200.37,-565.35 2213.67,-568.53 2227.12,-571.74"/>
<polygon fill="green" stroke="green" points="2226.38,-575.16 2236.92,-574.08 2228.01,-568.35 2226.38,-575.16"/>
</g>
<!-- Write&#45;&gt;MvccTxn__put_write -->
<g id="edge44" class="edge">
<title>Write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2456.15,-652.03C2558.33,-700.97 2709.39,-773.31 2804.31,-818.77"/>
<polygon fill="green" stroke="green" points="2803.07,-822.05 2813.6,-823.22 2806.09,-815.74 2803.07,-822.05"/>
</g>
<!-- Write&#45;&gt;collapse_prev_rollback -->
<g id="edge45" class="edge">
<title>Write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2456.26,-595.45C2464.85,-595.09 2473.43,-594.73 2481.78,-594.38"/>
<polygon fill="green" stroke="green" points="2481.99,-597.87 2491.83,-593.96 2481.69,-590.88 2481.99,-597.87"/>
</g>
<!-- Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock -->
<g id="edge55" class="edge">
<title>Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2201.11,-807.94C2349.99,-796.33 2673.78,-771.07 2819.2,-759.72"/>
<polygon fill="green" stroke="green" points="2819.66,-763.19 2829.36,-758.93 2819.12,-756.22 2819.66,-763.19"/>
</g>
<!-- released_lock&#45;&gt;ReleasedLocks__push -->
<g id="edge54" class="edge">
<title>released_lock&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1276.25,-340.81C1308.24,-317.41 1362.36,-277.83 1397.24,-252.32"/>
<polygon fill="green" stroke="green" points="1399.67,-254.88 1405.67,-246.16 1395.54,-249.23 1399.67,-254.88"/>
</g>
<!-- overlapped_write&#45;&gt;Write__set_ovelapped_rollback -->
<g id="edge57" class="edge">
<title>overlapped_write&#45;&gt;Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M1744.57,-587.34C1764.64,-587.17 1786.38,-587 1807.28,-586.83"/>
<polygon fill="#666666" stroke="#666666" points="1807.48,-590.33 1817.46,-586.74 1807.43,-583.33 1807.48,-590.33"/>
</g>
<!-- overlapped_write&#45;&gt;Write -->
<g id="edge58" class="edge">
<title>overlapped_write&#45;&gt;Write</title>
<path fill="none" stroke="#666666" d="M1744.73,-618.04C1766.31,-624.63 1789.78,-630.65 1812,-634 1953.61,-655.36 2118.34,-638.62 2226.87,-621.95"/>
<polygon fill="#666666" stroke="#666666" points="2227.52,-625.39 2236.86,-620.39 2226.44,-618.47 2227.52,-625.39"/>
</g>
</g>
</svg>
