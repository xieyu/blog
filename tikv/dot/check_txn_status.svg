<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1841pt" height="703pt"
 viewBox="0.00 0.00 1841.00 702.95" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 698.95)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-698.95 1837,-698.95 1837,4 -4,4"/>
<!-- CheckTxnStatus__process_write -->
<g id="node1" class="node">
<title>CheckTxnStatus__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-326.45C12,-326.45 188,-326.45 188,-326.45 194,-326.45 200,-332.45 200,-338.45 200,-338.45 200,-536.45 200,-536.45 200,-542.45 194,-548.45 188,-548.45 188,-548.45 12,-548.45 12,-548.45 6,-548.45 0,-542.45 0,-536.45 0,-536.45 0,-338.45 0,-338.45 0,-332.45 6,-326.45 12,-326.45"/>
<text text-anchor="start" x="8" y="-533.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus</text>
<text text-anchor="start" x="8" y="-518.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-510.45 200,-510.45 "/>
<text text-anchor="start" x="8" y="-495.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理CheckTxnStatu命令</text>
<polyline fill="none" stroke="#1c2123" points="0,-487.45 200,-487.45 "/>
<text text-anchor="start" x="8" y="-472.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">primary_key: Key,</text>
<polyline fill="none" stroke="#1c2123" points="0,-464.45 200,-464.45 "/>
<text text-anchor="start" x="8" y="-449.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock_ts: TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-441.45 200,-441.45 "/>
<text text-anchor="start" x="8" y="-426.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">caller_start_ts: TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-418.45 200,-418.45 "/>
<text text-anchor="start" x="8" y="-403.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">current_ts: TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-395.45 200,-395.45 "/>
<text text-anchor="start" x="8" y="-380.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_if_not_exist: bool,</text>
<polyline fill="none" stroke="#1c2123" points="0,-372.45 200,-372.45 "/>
<text text-anchor="start" x="8" y="-357.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">force_sync_commit: bool,</text>
<polyline fill="none" stroke="#1c2123" points="0,-349.45 200,-349.45 "/>
<text text-anchor="start" x="8" y="-334.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolving_pessimistic_lock: bool,</text>
</g>
<!-- ConcurrencyManager__update_max_ts -->
<g id="node2" class="node">
<title>ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M431,-35.45C431,-35.45 570,-35.45 570,-35.45 576,-35.45 582,-41.45 582,-47.45 582,-47.45 582,-99.45 582,-99.45 582,-105.45 576,-111.45 570,-111.45 570,-111.45 431,-111.45 431,-111.45 425,-111.45 419,-105.45 419,-99.45 419,-99.45 419,-47.45 419,-47.45 419,-41.45 425,-35.45 431,-35.45"/>
<text text-anchor="start" x="427" y="-96.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager</text>
<polyline fill="none" stroke="#1c2123" points="419,-88.45 582,-88.45 "/>
<text text-anchor="start" x="427" y="-73.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_max_ts</text>
<text text-anchor="start" x="427" y="-58.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果caller_ts比max_ts大</text>
<text text-anchor="start" x="427" y="-43.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新max_ts</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge1" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M114.27,-326.15C129.78,-248.48 163.37,-149.42 236,-95.45 284.82,-59.18 353.7,-54.56 408.79,-58.55"/>
<polygon fill="#666666" stroke="#666666" points="408.65,-62.05 418.9,-59.38 409.23,-55.07 408.65,-62.05"/>
</g>
<!-- SnapshotReader__new -->
<g id="node3" class="node">
<title>SnapshotReader__new</title>
<path fill="none" stroke="#1c2123" d="M269.5,-370.45C269.5,-370.45 349.5,-370.45 349.5,-370.45 355.5,-370.45 361.5,-376.45 361.5,-382.45 361.5,-382.45 361.5,-396.45 361.5,-396.45 361.5,-402.45 355.5,-408.45 349.5,-408.45 349.5,-408.45 269.5,-408.45 269.5,-408.45 263.5,-408.45 257.5,-402.45 257.5,-396.45 257.5,-396.45 257.5,-382.45 257.5,-382.45 257.5,-376.45 263.5,-370.45 269.5,-370.45"/>
<text text-anchor="start" x="265.5" y="-393.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="265.5" y="-378.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;SnapshotReader__new -->
<g id="edge2" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;SnapshotReader__new</title>
<path fill="none" stroke="#666666" d="M200.19,-414.51C216.28,-410.79 232.51,-407.03 247.34,-403.6"/>
<polygon fill="#666666" stroke="#666666" points="248.4,-406.95 257.36,-401.29 246.83,-400.13 248.4,-406.95"/>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node4" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M460.5,-404.95C460.5,-404.95 540.5,-404.95 540.5,-404.95 546.5,-404.95 552.5,-410.95 552.5,-416.95 552.5,-416.95 552.5,-453.95 552.5,-453.95 552.5,-459.95 546.5,-465.95 540.5,-465.95 540.5,-465.95 460.5,-465.95 460.5,-465.95 454.5,-465.95 448.5,-459.95 448.5,-453.95 448.5,-453.95 448.5,-416.95 448.5,-416.95 448.5,-410.95 454.5,-404.95 460.5,-404.95"/>
<text text-anchor="start" x="456.5" y="-450.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="456.5" y="-435.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="448.5,-427.95 552.5,-427.95 "/>
<text text-anchor="start" x="456.5" y="-412.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取lock</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;SnapshotReader__load_lock -->
<g id="edge3" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M200.02,-436.96C274.69,-436.58 374.77,-436.08 438.21,-435.76"/>
<polygon fill="#666666" stroke="#666666" points="438.47,-439.26 448.45,-435.71 438.43,-432.26 438.47,-439.26"/>
</g>
<!-- check_txn_status_lock_exists -->
<g id="node5" class="node">
<title>check_txn_status_lock_exists</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M636,-206.95C636,-206.95 789,-206.95 789,-206.95 795,-206.95 801,-212.95 801,-218.95 801,-218.95 801,-323.95 801,-323.95 801,-329.95 795,-335.95 789,-335.95 789,-335.95 636,-335.95 636,-335.95 630,-335.95 624,-329.95 624,-323.95 624,-323.95 624,-218.95 624,-218.95 624,-212.95 630,-206.95 636,-206.95"/>
<text text-anchor="start" x="632" y="-320.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_lock_exists</text>
<polyline fill="none" stroke="#8a8898" points="624,-312.95 801,-312.95 "/>
<text text-anchor="start" x="632" y="-297.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果Lock存在</text>
<text text-anchor="start" x="632" y="-282.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 且lock.ts是</text>
<text text-anchor="start" x="632" y="-267.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 传入的lock_ts</text>
<polyline fill="none" stroke="#8a8898" points="624,-259.95 801,-259.95 "/>
<text text-anchor="start" x="632" y="-244.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">check whether there&#39;s </text>
<text text-anchor="start" x="632" y="-229.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> an overlapped write record</text>
<text text-anchor="start" x="632" y="-214.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> and tehn perform rollback</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists -->
<g id="edge4" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="#666666" d="M169.82,-326.06C188.5,-304.81 210.68,-285.47 236,-273.45 356.23,-216.39 513.6,-230.4 613.66,-248.6"/>
<polygon fill="#666666" stroke="#666666" points="613.29,-252.1 623.76,-250.49 614.57,-245.21 613.29,-252.1"/>
</g>
<!-- check_txn_status_missing_lock -->
<g id="node6" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M630,-461.95C630,-461.95 795,-461.95 795,-461.95 801,-461.95 807,-467.95 807,-473.95 807,-473.95 807,-548.95 807,-548.95 807,-554.95 801,-560.95 795,-560.95 795,-560.95 630,-560.95 630,-560.95 624,-560.95 618,-554.95 618,-548.95 618,-548.95 618,-473.95 618,-473.95 618,-467.95 624,-461.95 630,-461.95"/>
<text text-anchor="start" x="626" y="-545.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_missing_lock</text>
<polyline fill="none" stroke="#8a8898" points="618,-537.95 807,-537.95 "/>
<text text-anchor="start" x="626" y="-522.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果Lock不存在</text>
<text text-anchor="start" x="626" y="-507.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 或者lock.ts和lock_ts不match</text>
<polyline fill="none" stroke="#8a8898" points="618,-499.95 807,-499.95 "/>
<text text-anchor="start" x="626" y="-484.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">1. lock可能被提交了</text>
<text text-anchor="start" x="626" y="-469.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2. lock被rollback了</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;check_txn_status_missing_lock -->
<g id="edge5" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="#666666" d="M200.16,-513.43C211.78,-519.52 223.84,-524.74 236,-528.45 359.54,-566.2 509.58,-551.49 607.65,-534.32"/>
<polygon fill="#666666" stroke="#666666" points="608.34,-537.76 617.56,-532.55 607.1,-530.87 608.34,-537.76"/>
</g>
<!-- ReleasedLocks__new -->
<g id="node7" class="node">
<title>ReleasedLocks__new</title>
<path fill="none" stroke="#1c2123" d="M463.5,-656.45C463.5,-656.45 537.5,-656.45 537.5,-656.45 543.5,-656.45 549.5,-662.45 549.5,-668.45 549.5,-668.45 549.5,-682.45 549.5,-682.45 549.5,-688.45 543.5,-694.45 537.5,-694.45 537.5,-694.45 463.5,-694.45 463.5,-694.45 457.5,-694.45 451.5,-688.45 451.5,-682.45 451.5,-682.45 451.5,-668.45 451.5,-668.45 451.5,-662.45 457.5,-656.45 463.5,-656.45"/>
<text text-anchor="start" x="459.5" y="-679.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="459.5" y="-664.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__new -->
<g id="edge6" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__new</title>
<path fill="none" stroke="#666666" d="M150.94,-548.7C172.19,-583.85 200.41,-619.28 236,-641.45 298.1,-680.15 384.41,-683.95 441.09,-681.23"/>
<polygon fill="#666666" stroke="#666666" points="441.52,-684.72 451.31,-680.66 441.13,-677.73 441.52,-684.72"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node8" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1360,-618.45C1360,-618.45 1434,-618.45 1434,-618.45 1440,-618.45 1446,-624.45 1446,-630.45 1446,-630.45 1446,-644.45 1446,-644.45 1446,-650.45 1440,-656.45 1434,-656.45 1434,-656.45 1360,-656.45 1360,-656.45 1354,-656.45 1348,-650.45 1348,-644.45 1348,-644.45 1348,-630.45 1348,-630.45 1348,-624.45 1354,-618.45 1360,-618.45"/>
<text text-anchor="start" x="1356" y="-641.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1356" y="-626.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__push -->
<g id="edge7" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="#666666" d="M170.41,-548.57C189.06,-570.16 211.08,-590.18 236,-603.45 339.79,-658.74 381.9,-627.45 499.5,-627.45 499.5,-627.45 499.5,-627.45 929,-627.45 1076.24,-627.45 1249.53,-632.48 1337.85,-635.41"/>
<polygon fill="#666666" stroke="#666666" points="1337.83,-638.91 1347.94,-635.75 1338.06,-631.91 1337.83,-638.91"/>
</g>
<!-- ReleasedLocks__wakeup -->
<g id="node9" class="node">
<title>ReleasedLocks__wakeup</title>
<path fill="none" stroke="#1c2123" d="M1747,-481.45C1747,-481.45 1821,-481.45 1821,-481.45 1827,-481.45 1833,-487.45 1833,-493.45 1833,-493.45 1833,-507.45 1833,-507.45 1833,-513.45 1827,-519.45 1821,-519.45 1821,-519.45 1747,-519.45 1747,-519.45 1741,-519.45 1735,-513.45 1735,-507.45 1735,-507.45 1735,-493.45 1735,-493.45 1735,-487.45 1741,-481.45 1747,-481.45"/>
<text text-anchor="start" x="1743" y="-504.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1743" y="-489.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> wakeup</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge8" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="#666666" d="M110.26,-326.26C123.65,-238.96 156.32,-121.2 236,-53.45 326.63,23.6 380.54,-6.45 499.5,-6.45 499.5,-6.45 499.5,-6.45 1398,-6.45 1545.73,-6.45 1605.75,-32.88 1699,-147.45 1739.93,-197.75 1769.36,-395.45 1779.31,-470.94"/>
<polygon fill="#666666" stroke="#666666" points="1775.88,-471.69 1780.63,-481.16 1782.82,-470.79 1775.88,-471.69"/>
</g>
<!-- TxnStatus__TtlExpire -->
<g id="node10" class="node">
<title>TxnStatus__TtlExpire</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1531,-443.45C1531,-443.45 1685,-443.45 1685,-443.45 1691,-443.45 1697,-449.45 1697,-455.45 1697,-455.45 1697,-545.45 1697,-545.45 1697,-551.45 1691,-557.45 1685,-557.45 1685,-557.45 1531,-557.45 1531,-557.45 1525,-557.45 1519,-551.45 1519,-545.45 1519,-545.45 1519,-455.45 1519,-455.45 1519,-449.45 1525,-443.45 1531,-443.45"/>
<text text-anchor="start" x="1527" y="-542.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1527" y="-527.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> TtlExpire</text>
<polyline fill="none" stroke="#8a8898" points="1519,-519.45 1697,-519.45 "/>
<text text-anchor="start" x="1527" y="-504.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">just rollback</text>
<text text-anchor="start" x="1527" y="-489.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> due to expiration</text>
<polyline fill="none" stroke="#8a8898" points="1519,-481.45 1697,-481.45 "/>
<text text-anchor="start" x="1527" y="-466.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">由于ttl过期</text>
<text text-anchor="start" x="1527" y="-451.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 在本次check时被rolback了</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;TxnStatus__TtlExpire -->
<g id="edge9" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;TxnStatus__TtlExpire</title>
<path fill="none" stroke="#666666" d="M200.29,-533.14C211.75,-540.95 223.74,-547.94 236,-553.45 343.79,-601.96 381.3,-589.45 499.5,-589.45 499.5,-589.45 499.5,-589.45 1164,-589.45 1305.14,-589.45 1345.49,-609.93 1481,-570.45 1490.55,-567.67 1500.17,-564.07 1509.61,-559.96"/>
<polygon fill="#666666" stroke="#666666" points="1511.33,-563.02 1518.99,-555.7 1508.43,-556.65 1511.33,-563.02"/>
</g>
<!-- SnapshotReader__new&#45;&gt;SnapshotReader__load_lock -->
<g id="edge11" class="edge">
<title>SnapshotReader__new&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M361.65,-401.9C385.28,-407.66 413.54,-414.53 438.3,-420.56"/>
<polygon fill="green" stroke="green" points="437.77,-424.03 448.31,-423 439.42,-417.23 437.77,-424.03"/>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;check_txn_status_lock_exists -->
<g id="edge12" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M541,-404.61C563.49,-387.04 592.66,-364.26 620.5,-342.53"/>
<polygon fill="green" stroke="green" points="622.96,-345.04 628.69,-336.12 618.66,-339.52 622.96,-345.04"/>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;check_txn_status_missing_lock -->
<g id="edge13" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M552.6,-453.95C569.51,-460.07 588.96,-467.11 608.34,-474.12"/>
<polygon fill="green" stroke="green" points="607.24,-477.44 617.83,-477.56 609.62,-470.86 607.24,-477.44"/>
</g>
<!-- mismatch_lock -->
<g id="node12" class="node">
<title>mismatch_lock</title>
<path fill="#f5b691" stroke="#d69043" d="M868.5,-492.45C868.5,-492.45 987.5,-492.45 987.5,-492.45 993.5,-492.45 999.5,-498.45 999.5,-504.45 999.5,-504.45 999.5,-548.45 999.5,-548.45 999.5,-554.45 993.5,-560.45 987.5,-560.45 987.5,-560.45 868.5,-560.45 868.5,-560.45 862.5,-560.45 856.5,-554.45 856.5,-548.45 856.5,-548.45 856.5,-504.45 856.5,-504.45 856.5,-498.45 862.5,-492.45 868.5,-492.45"/>
<text text-anchor="start" x="864.5" y="-545.25" font-family="Times,serif" font-size="14.00" fill="#6b6969">mismatch_lock</text>
<text text-anchor="start" x="864.5" y="-530.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> lock.ts != lock_ts</text>
<text text-anchor="start" x="864.5" y="-515.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> lock已经被其他事务</text>
<text text-anchor="start" x="864.5" y="-500.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 持有了</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;mismatch_lock -->
<g id="edge14" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;mismatch_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M552.77,-428.77C615.2,-422.75 722.73,-419.27 807,-452.45 826.38,-460.09 825.68,-470.89 843,-482.45 845.37,-484.04 847.81,-485.61 850.3,-487.17"/>
<polygon fill="green" stroke="green" points="848.51,-490.18 858.88,-492.37 852.14,-484.19 848.51,-490.18"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node13" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1325,-267.95C1325,-267.95 1469,-267.95 1469,-267.95 1475,-267.95 1481,-273.95 1481,-279.95 1481,-279.95 1481,-354.95 1481,-354.95 1481,-360.95 1475,-366.95 1469,-366.95 1469,-366.95 1325,-366.95 1325,-366.95 1319,-366.95 1313,-360.95 1313,-354.95 1313,-354.95 1313,-279.95 1313,-279.95 1313,-273.95 1319,-267.95 1325,-267.95"/>
<text text-anchor="start" x="1321" y="-351.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1321" y="-336.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> UnlockKey</text>
<polyline fill="none" stroke="#8a8898" points="1313,-328.95 1481,-328.95 "/>
<text text-anchor="start" x="1321" y="-313.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果是悲观事务</text>
<polyline fill="none" stroke="#8a8898" points="1313,-305.95 1481,-305.95 "/>
<text text-anchor="start" x="1321" y="-290.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">且请求要求</text>
<text text-anchor="start" x="1321" y="-275.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolving_pessimistic_lock</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;MvccTxn__unlock_key -->
<g id="edge18" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M801.04,-273.84C860.79,-275.75 941.73,-278.87 1013,-283.45 1111.98,-289.83 1225.08,-300.26 1302.57,-307.89"/>
<polygon fill="#666666" stroke="#666666" points="1302.49,-311.39 1312.78,-308.9 1303.18,-304.43 1302.49,-311.39"/>
</g>
<!-- rollback_lock -->
<g id="node14" class="node">
<title>rollback_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1100.5,-387.95C1100.5,-387.95 1225.5,-387.95 1225.5,-387.95 1231.5,-387.95 1237.5,-393.95 1237.5,-399.95 1237.5,-399.95 1237.5,-436.95 1237.5,-436.95 1237.5,-442.95 1231.5,-448.95 1225.5,-448.95 1225.5,-448.95 1100.5,-448.95 1100.5,-448.95 1094.5,-448.95 1088.5,-442.95 1088.5,-436.95 1088.5,-436.95 1088.5,-399.95 1088.5,-399.95 1088.5,-393.95 1094.5,-387.95 1100.5,-387.95"/>
<text text-anchor="start" x="1096.5" y="-433.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">rollback_lock</text>
<polyline fill="none" stroke="#8a8898" points="1088.5,-425.95 1237.5,-425.95 "/>
<text text-anchor="start" x="1096.5" y="-410.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">清理掉primary key</text>
<text text-anchor="start" x="1096.5" y="-395.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> lock primary ttl已超时</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;rollback_lock -->
<g id="edge19" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M801.02,-278.88C862.02,-286.11 944.42,-300.06 1013,-326.45 1048.74,-340.21 1085.39,-362.7 1113.39,-382.01"/>
<polygon fill="#666666" stroke="#666666" points="1111.59,-385.02 1121.79,-387.88 1115.6,-379.28 1111.59,-385.02"/>
</g>
<!-- Lock__min_commit_ts -->
<g id="node15" class="node">
<title>Lock__min_commit_ts</title>
<path fill="#f5b691" stroke="#d69043" d="M855,-58.45C855,-58.45 1001,-58.45 1001,-58.45 1007,-58.45 1013,-64.45 1013,-70.45 1013,-70.45 1013,-152.45 1013,-152.45 1013,-158.45 1007,-164.45 1001,-164.45 1001,-164.45 855,-164.45 855,-164.45 849,-164.45 843,-158.45 843,-152.45 843,-152.45 843,-70.45 843,-70.45 843,-64.45 849,-58.45 855,-58.45"/>
<text text-anchor="start" x="851" y="-149.25" font-family="Times,serif" font-size="14.00" fill="#6b6969">update lock.min_commit_ts</text>
<text text-anchor="start" x="851" y="-134.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> txn还持有该lock</text>
<text text-anchor="start" x="851" y="-119.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> lock没有过期</text>
<polyline fill="none" stroke="#d69043" points="843,-111.45 1013,-111.45 "/>
<text text-anchor="start" x="851" y="-96.25" font-family="Times,serif" font-size="14.00" fill="#6b6969">根据caller_start_ts</text>
<text text-anchor="start" x="851" y="-81.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> current_ts</text>
<text text-anchor="start" x="851" y="-66.25" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 更新lock.min_commit_ts</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;Lock__min_commit_ts -->
<g id="edge20" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="#666666" d="M799.72,-206.84C815.69,-194.87 832.29,-182.43 848.03,-170.64"/>
<polygon fill="#666666" stroke="#666666" points="850.27,-173.33 856.17,-164.54 846.07,-167.73 850.27,-173.33"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node16" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1356,-126.45C1356,-126.45 1438,-126.45 1438,-126.45 1444,-126.45 1450,-132.45 1450,-138.45 1450,-138.45 1450,-190.45 1450,-190.45 1450,-196.45 1444,-202.45 1438,-202.45 1438,-202.45 1356,-202.45 1356,-202.45 1350,-202.45 1344,-196.45 1344,-190.45 1344,-190.45 1344,-138.45 1344,-138.45 1344,-132.45 1350,-126.45 1356,-126.45"/>
<text text-anchor="start" x="1352" y="-187.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1352" y="-172.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<text text-anchor="start" x="1352" y="-157.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 写入更新后的</text>
<polyline fill="none" stroke="#8a8898" points="1344,-149.45 1450,-149.45 "/>
<text text-anchor="start" x="1352" y="-134.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">后的Lock</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;MvccTxn__put_lock -->
<g id="edge21" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="#666666" d="M801.12,-230.8C814.91,-225.61 829.18,-220.92 843,-217.45 1016.9,-173.92 1229.79,-165.66 1333.38,-164.41"/>
<polygon fill="#666666" stroke="#666666" points="1333.7,-167.9 1343.66,-164.3 1333.63,-160.9 1333.7,-167.9"/>
</g>
<!-- Lock__expired -->
<g id="node17" class="node">
<title>Lock__expired</title>
<path fill="#f5b691" stroke="#d69043" d="M856,-335.95C856,-335.95 1000,-335.95 1000,-335.95 1006,-335.95 1012,-341.95 1012,-347.95 1012,-347.95 1012,-460.95 1012,-460.95 1012,-466.95 1006,-472.95 1000,-472.95 1000,-472.95 856,-472.95 856,-472.95 850,-472.95 844,-466.95 844,-460.95 844,-460.95 844,-347.95 844,-347.95 844,-341.95 850,-335.95 856,-335.95"/>
<text text-anchor="middle" x="928" y="-457.75" font-family="Times,serif" font-size="14.00" fill="#6b6969">Lock__expired</text>
<polyline fill="none" stroke="#d69043" points="844,-449.95 1012,-449.95 "/>
<text text-anchor="start" x="852" y="-434.75" font-family="Times,serif" font-size="14.00" fill="#6b6969">txn还持有该lock</text>
<text text-anchor="start" x="852" y="-419.75" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 但lock已过期</text>
<polyline fill="none" stroke="#d69043" points="844,-411.95 1012,-411.95 "/>
<text text-anchor="start" x="852" y="-396.75" font-family="Times,serif" font-size="14.00" fill="#6b6969">lock.ts.physical() </text>
<text text-anchor="start" x="852" y="-381.75" font-family="Times,serif" font-size="14.00" fill="#6b6969"> + lock.ttl &lt; </text>
<text text-anchor="start" x="852" y="-366.75" font-family="Times,serif" font-size="14.00" fill="#6b6969"> current_ts.physical</text>
<polyline fill="none" stroke="#d69043" points="844,-358.95 1012,-358.95 "/>
<text text-anchor="start" x="852" y="-343.75" font-family="Times,serif" font-size="14.00" fill="#6b6969">lock过期了，需要清理掉</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;Lock__expired -->
<g id="edge22" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;Lock__expired</title>
<path fill="none" stroke="#666666" d="M801.26,-326.13C812.44,-333.09 823.91,-340.24 835.16,-347.24"/>
<polygon fill="#666666" stroke="#666666" points="833.36,-350.25 843.7,-352.56 837.06,-344.31 833.36,-350.25"/>
</g>
<!-- TxnStatus__Uncommitted -->
<g id="node18" class="node">
<title>TxnStatus__Uncommitted</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1569,-156.95C1569,-156.95 1647,-156.95 1647,-156.95 1653,-156.95 1659,-162.95 1659,-168.95 1659,-168.95 1659,-205.95 1659,-205.95 1659,-211.95 1653,-217.95 1647,-217.95 1647,-217.95 1569,-217.95 1569,-217.95 1563,-217.95 1557,-211.95 1557,-205.95 1557,-205.95 1557,-168.95 1557,-168.95 1557,-162.95 1563,-156.95 1569,-156.95"/>
<text text-anchor="start" x="1565" y="-202.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1565" y="-187.75" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Uncommitted</text>
<polyline fill="none" stroke="#8a8898" points="1557,-179.95 1659,-179.95 "/>
<text text-anchor="start" x="1565" y="-164.75" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务还没提交</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;TxnStatus__Uncommitted -->
<g id="edge23" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;TxnStatus__Uncommitted</title>
<path fill="none" stroke="#666666" d="M801.02,-267.76C943.86,-261.01 1235.76,-244.29 1481,-211.45 1502.62,-208.56 1526.15,-204.37 1546.95,-200.29"/>
<polygon fill="#666666" stroke="#666666" points="1547.81,-203.69 1556.93,-198.31 1546.44,-196.82 1547.81,-203.69"/>
</g>
<!-- ReleasedLocks__new&#45;&gt;ReleasedLocks__push -->
<g id="edge15" class="edge">
<title>ReleasedLocks__new&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M549.59,-673.41C701.66,-666.95 1171.79,-646.98 1337.48,-639.94"/>
<polygon fill="green" stroke="green" points="1338.1,-643.42 1347.94,-639.5 1337.8,-636.42 1338.1,-643.42"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge16" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1446.06,-632.91C1507.37,-625.65 1615.46,-607.9 1699,-567.45 1720.16,-557.21 1740.84,-540.81 1756.39,-526.81"/>
<polygon fill="green" stroke="green" points="1759.07,-529.1 1764.03,-519.74 1754.31,-523.96 1759.07,-529.1"/>
</g>
<!-- TxnStatus__TtlExpire&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge17" class="edge">
<title>TxnStatus__TtlExpire&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1697.02,-500.45C1706.35,-500.45 1715.66,-500.45 1724.53,-500.45"/>
<polygon fill="green" stroke="green" points="1724.72,-503.95 1734.72,-500.45 1724.72,-496.95 1724.72,-503.95"/>
</g>
<!-- CheckTxnStatus__primary_key -->
<g id="node11" class="node">
<title>CheckTxnStatus__primary_key</title>
<path fill="#feed9b" stroke="#f7e495" d="M248,-465.95C248,-465.95 371,-465.95 371,-465.95 377,-465.95 383,-471.95 383,-477.95 383,-477.95 383,-506.95 383,-506.95 383,-512.95 377,-518.95 371,-518.95 371,-518.95 248,-518.95 248,-518.95 242,-518.95 236,-512.95 236,-506.95 236,-506.95 236,-477.95 236,-477.95 236,-471.95 242,-465.95 248,-465.95"/>
<text text-anchor="start" x="244" y="-503.75" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="244" y="-488.75" font-family="Times,serif" font-size="14.00" fill="#40575d"> primary_key</text>
<text text-anchor="start" x="244" y="-473.75" font-family="Times,serif" font-size="14.00" fill="#40575d"> 请求中的primary_key</text>
</g>
<!-- CheckTxnStatus__primary_key&#45;&gt;SnapshotReader__load_lock -->
<g id="edge10" class="edge">
<title>CheckTxnStatus__primary_key&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M383.03,-470.58C401.39,-465.04 420.92,-459.15 438.63,-453.81"/>
<polygon fill="green" stroke="green" points="439.7,-457.14 448.27,-450.91 437.68,-450.44 439.7,-457.14"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node22" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#1c2123" d="M1061,-484.45C1061,-484.45 1265,-484.45 1265,-484.45 1271,-484.45 1277,-490.45 1277,-496.45 1277,-496.45 1277,-548.45 1277,-548.45 1277,-554.45 1271,-560.45 1265,-560.45 1265,-560.45 1061,-560.45 1061,-560.45 1055,-560.45 1049,-554.45 1049,-548.45 1049,-548.45 1049,-496.45 1049,-496.45 1049,-490.45 1055,-484.45 1061,-484.45"/>
<text text-anchor="start" x="1057" y="-545.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="1057" y="-530.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mark_rollback_on_mismatching_lock</text>
<polyline fill="none" stroke="#1c2123" points="1049,-522.45 1277,-522.45 "/>
<text text-anchor="start" x="1057" y="-507.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">将start_ts加入到lock</text>
<text text-anchor="start" x="1057" y="-492.25" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的rollback_ts数组中</text>
</g>
<!-- mismatch_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge35" class="edge">
<title>mismatch_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M999.54,-525.24C1011.92,-525.03 1025.13,-524.8 1038.46,-524.58"/>
<polygon fill="green" stroke="green" points="1038.72,-528.07 1048.66,-524.4 1038.6,-521.07 1038.72,-528.07"/>
</g>
<!-- TxnStatus__PessimisticRollback -->
<g id="node21" class="node">
<title>TxnStatus__PessimisticRollback</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1529,-260.45C1529,-260.45 1687,-260.45 1687,-260.45 1693,-260.45 1699,-266.45 1699,-272.45 1699,-272.45 1699,-362.45 1699,-362.45 1699,-368.45 1693,-374.45 1687,-374.45 1687,-374.45 1529,-374.45 1529,-374.45 1523,-374.45 1517,-368.45 1517,-362.45 1517,-362.45 1517,-272.45 1517,-272.45 1517,-266.45 1523,-260.45 1529,-260.45"/>
<text text-anchor="start" x="1525" y="-359.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1525" y="-344.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> PessimisticRollback</text>
<polyline fill="none" stroke="#8a8898" points="1517,-336.45 1699,-336.45 "/>
<text text-anchor="start" x="1525" y="-321.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">the primary key is </text>
<text text-anchor="start" x="1525" y="-306.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> pessimistically</text>
<text text-anchor="start" x="1525" y="-291.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> rolled back</text>
<polyline fill="none" stroke="#8a8898" points="1517,-283.45 1699,-283.45 "/>
<text text-anchor="start" x="1525" y="-268.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">在本次check中被rollblack了</text>
</g>
<!-- MvccTxn__unlock_key&#45;&gt;TxnStatus__PessimisticRollback -->
<g id="edge33" class="edge">
<title>MvccTxn__unlock_key&#45;&gt;TxnStatus__PessimisticRollback</title>
<path fill="none" stroke="#666666" d="M1481.2,-317.45C1489.63,-317.45 1498.25,-317.45 1506.83,-317.45"/>
<polygon fill="#666666" stroke="#666666" points="1506.87,-320.95 1516.87,-317.45 1506.87,-313.95 1506.87,-320.95"/>
</g>
<!-- rollback_lock&#45;&gt;ReleasedLocks__push -->
<g id="edge32" class="edge">
<title>rollback_lock&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1237.64,-445.6C1252.09,-453.51 1266.12,-463.37 1277,-475.45 1307.21,-509.01 1286.51,-533.89 1313,-570.45 1324.73,-586.65 1341.34,-601.11 1356.62,-612.41"/>
<polygon fill="green" stroke="green" points="1354.76,-615.38 1364.93,-618.35 1358.83,-609.69 1354.76,-615.38"/>
</g>
<!-- rollback_lock&#45;&gt;TxnStatus__TtlExpire -->
<g id="edge31" class="edge">
<title>rollback_lock&#45;&gt;TxnStatus__TtlExpire</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1237.73,-431.33C1302.02,-442.64 1397.76,-459.71 1481,-475.45 1490.11,-477.18 1499.58,-479 1509.06,-480.84"/>
<polygon fill="green" stroke="green" points="1508.43,-484.29 1518.92,-482.77 1509.78,-477.42 1508.43,-484.29"/>
</g>
<!-- Lock__min_commit_ts&#45;&gt;MvccTxn__put_lock -->
<g id="edge28" class="edge">
<title>Lock__min_commit_ts&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1013.03,-120.99C1105.29,-131.46 1251.27,-148.03 1333.8,-157.4"/>
<polygon fill="green" stroke="green" points="1333.45,-160.88 1343.78,-158.53 1334.24,-153.92 1333.45,-160.88"/>
</g>
<!-- MvccTxn__put_lock&#45;&gt;TxnStatus__Uncommitted -->
<g id="edge34" class="edge">
<title>MvccTxn__put_lock&#45;&gt;TxnStatus__Uncommitted</title>
<path fill="none" stroke="#666666" d="M1450.2,-170.2C1479.53,-173.43 1516.26,-177.47 1546.8,-180.83"/>
<polygon fill="#666666" stroke="#666666" points="1546.58,-184.33 1556.9,-181.94 1547.35,-177.37 1546.58,-184.33"/>
</g>
<!-- Lock__expired&#45;&gt;MvccTxn__unlock_key -->
<g id="edge29" class="edge">
<title>Lock__expired&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1012.19,-385.99C1024.51,-383.38 1037.08,-380.79 1049,-378.45 1134.67,-361.65 1232.68,-344.62 1302.63,-332.84"/>
<polygon fill="green" stroke="green" points="1303.46,-336.25 1312.75,-331.14 1302.3,-329.35 1303.46,-336.25"/>
</g>
<!-- Lock__expired&#45;&gt;rollback_lock -->
<g id="edge30" class="edge">
<title>Lock__expired&#45;&gt;rollback_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1012.13,-409.45C1033.57,-410.74 1056.65,-412.12 1078.12,-413.42"/>
<polygon fill="green" stroke="green" points="1078,-416.91 1088.19,-414.02 1078.42,-409.93 1078,-416.91"/>
</g>
<!-- CheckTxnStatus__current_ts -->
<g id="node19" class="node">
<title>CheckTxnStatus__current_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M254.5,-283.45C254.5,-283.45 364.5,-283.45 364.5,-283.45 370.5,-283.45 376.5,-289.45 376.5,-295.45 376.5,-295.45 376.5,-339.45 376.5,-339.45 376.5,-345.45 370.5,-351.45 364.5,-351.45 364.5,-351.45 254.5,-351.45 254.5,-351.45 248.5,-351.45 242.5,-345.45 242.5,-339.45 242.5,-339.45 242.5,-295.45 242.5,-295.45 242.5,-289.45 248.5,-283.45 254.5,-283.45"/>
<text text-anchor="start" x="250.5" y="-336.25" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="250.5" y="-321.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> current_ts</text>
<text text-anchor="start" x="250.5" y="-306.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> 当前时间戳</text>
<text text-anchor="start" x="250.5" y="-291.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> 用来判断是否过期</text>
</g>
<!-- CheckTxnStatus__current_ts&#45;&gt;Lock__min_commit_ts -->
<g id="edge24" class="edge">
<title>CheckTxnStatus__current_ts&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M376.68,-289.4C438.47,-263.73 533.6,-225.59 618,-197.45 689.33,-173.68 771.38,-151.06 832.99,-134.99"/>
<polygon fill="green" stroke="green" points="833.9,-138.37 842.7,-132.47 832.14,-131.59 833.9,-138.37"/>
</g>
<!-- CheckTxnStatus__current_ts&#45;&gt;Lock__expired -->
<g id="edge26" class="edge">
<title>CheckTxnStatus__current_ts&#45;&gt;Lock__expired</title>
<path fill="none" stroke="#666666" d="M376.77,-326.81C486.91,-342.35 707.95,-373.54 833.77,-391.3"/>
<polygon fill="#666666" stroke="#666666" points="833.38,-394.78 843.77,-392.71 834.36,-387.85 833.38,-394.78"/>
</g>
<!-- CheckTxnStatus__caller_start_ts -->
<g id="node20" class="node">
<title>CheckTxnStatus__caller_start_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M256,-105.45C256,-105.45 363,-105.45 363,-105.45 369,-105.45 375,-111.45 375,-117.45 375,-117.45 375,-161.45 375,-161.45 375,-167.45 369,-173.45 363,-173.45 363,-173.45 256,-173.45 256,-173.45 250,-173.45 244,-167.45 244,-161.45 244,-161.45 244,-117.45 244,-117.45 244,-111.45 250,-105.45 256,-105.45"/>
<text text-anchor="start" x="252" y="-158.25" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="252" y="-143.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> caller_start_ts</text>
<text text-anchor="start" x="252" y="-128.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> 会用于更新max_ts</text>
<text text-anchor="start" x="252" y="-113.25" font-family="Times,serif" font-size="14.00" fill="#40575d"> 和min_commit_ts</text>
</g>
<!-- CheckTxnStatus__caller_start_ts&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge27" class="edge">
<title>CheckTxnStatus__caller_start_ts&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M375.01,-116.93C386.04,-113.07 397.68,-109.01 409.23,-104.98"/>
<polygon fill="green" stroke="green" points="410.61,-108.2 418.9,-101.6 408.3,-101.59 410.61,-108.2"/>
</g>
<!-- CheckTxnStatus__caller_start_ts&#45;&gt;Lock__min_commit_ts -->
<g id="edge25" class="edge">
<title>CheckTxnStatus__caller_start_ts&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M375.02,-136.52C484.3,-131.56 706.25,-121.48 832.88,-115.73"/>
<polygon fill="green" stroke="green" points="833.13,-119.22 842.96,-115.27 832.81,-112.23 833.13,-119.22"/>
</g>
<!-- MvccTxn__put_lock2 -->
<g id="node23" class="node">
<title>MvccTxn__put_lock2</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1339,-484.45C1339,-484.45 1455,-484.45 1455,-484.45 1461,-484.45 1467,-490.45 1467,-496.45 1467,-496.45 1467,-548.45 1467,-548.45 1467,-554.45 1461,-560.45 1455,-560.45 1455,-560.45 1339,-560.45 1339,-560.45 1333,-560.45 1327,-554.45 1327,-548.45 1327,-548.45 1327,-496.45 1327,-496.45 1327,-490.45 1333,-484.45 1339,-484.45"/>
<text text-anchor="start" x="1335" y="-545.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1335" y="-530.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<polyline fill="none" stroke="#8a8898" points="1327,-522.45 1467,-522.45 "/>
<text text-anchor="start" x="1335" y="-507.25" font-family="Times,serif" font-size="14.00" fill="#5d6179">更新其他事务lock的</text>
<text text-anchor="start" x="1335" y="-492.25" font-family="Times,serif" font-size="14.00" fill="#5d6179"> rollback_ts</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock2 -->
<g id="edge36" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock2</title>
<path fill="none" stroke="#666666" d="M1277.28,-522.45C1290.62,-522.45 1304.01,-522.45 1316.74,-522.45"/>
<polygon fill="#666666" stroke="#666666" points="1316.8,-525.95 1326.8,-522.45 1316.8,-518.95 1316.8,-525.95"/>
</g>
</g>
</svg>
