<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1510pt" height="733pt"
 viewBox="0.00 0.00 1510.00 733.19" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 729.19)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-729.19 1506,-729.19 1506,4 -4,4"/>
<!-- check_txn_status_missing_lock -->
<g id="node1" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="none" stroke="#1c2123" d="M177,-197.19C177,-197.19 12,-197.19 12,-197.19 6,-197.19 0,-191.19 0,-185.19 0,-185.19 0,-173.19 0,-173.19 0,-167.19 6,-161.19 12,-161.19 12,-161.19 177,-161.19 177,-161.19 183,-161.19 189,-167.19 189,-173.19 189,-173.19 189,-185.19 189,-185.19 189,-191.19 183,-197.19 177,-197.19"/>
<text text-anchor="middle" x="94.5" y="-175.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_txn_status_missing_lock</text>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node2" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M237,-141.19C237,-141.19 365,-141.19 365,-141.19 371,-141.19 377,-147.19 377,-153.19 377,-153.19 377,-205.19 377,-205.19 377,-211.19 371,-217.19 365,-217.19 365,-217.19 237,-217.19 237,-217.19 231,-217.19 225,-211.19 225,-205.19 225,-205.19 225,-153.19 225,-153.19 225,-147.19 231,-141.19 237,-141.19"/>
<text text-anchor="start" x="233" y="-201.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="233" y="-186.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
<polyline fill="none" stroke="#1c2123" points="225,-179.19 377,-179.19 "/>
<text text-anchor="start" x="233" y="-163.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">scan all versions from</text>
<text text-anchor="start" x="233" y="-148.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> max to start_ts</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge1" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M189.07,-179.19C197.6,-179.19 206.2,-179.19 214.65,-179.19"/>
<polygon fill="#666666" stroke="#666666" points="214.86,-182.69 224.86,-179.19 214.86,-175.69 214.86,-182.69"/>
</g>
<!-- TxnCommitRecord__SingleRecord -->
<g id="node3" class="node">
<title>TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="#1c2123" d="M460.5,-48.69C460.5,-48.69 586.5,-48.69 586.5,-48.69 592.5,-48.69 598.5,-54.69 598.5,-60.69 598.5,-60.69 598.5,-97.69 598.5,-97.69 598.5,-103.69 592.5,-109.69 586.5,-109.69 586.5,-109.69 460.5,-109.69 460.5,-109.69 454.5,-109.69 448.5,-103.69 448.5,-97.69 448.5,-97.69 448.5,-60.69 448.5,-60.69 448.5,-54.69 454.5,-48.69 460.5,-48.69"/>
<text text-anchor="start" x="456.5" y="-94.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="456.5" y="-79.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> SingleRecord</text>
<polyline fill="none" stroke="#1c2123" points="448.5,-71.69 598.5,-71.69 "/>
<text text-anchor="start" x="456.5" y="-56.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">write.start_ts == start_ts</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord -->
<g id="edge2" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M377.27,-145.06C399.32,-135.06 423.45,-124.11 445.6,-114.07"/>
<polygon fill="green" stroke="green" points="447.3,-117.14 454.96,-109.82 444.41,-110.76 447.3,-117.14"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback -->
<g id="node4" class="node">
<title>TxnCommitRecord__OverlappedRollback</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M434.5,-141.19C434.5,-141.19 612.5,-141.19 612.5,-141.19 618.5,-141.19 624.5,-147.19 624.5,-153.19 624.5,-153.19 624.5,-205.19 624.5,-205.19 624.5,-211.19 618.5,-217.19 612.5,-217.19 612.5,-217.19 434.5,-217.19 434.5,-217.19 428.5,-217.19 422.5,-211.19 422.5,-205.19 422.5,-205.19 422.5,-153.19 422.5,-153.19 422.5,-147.19 428.5,-141.19 434.5,-141.19"/>
<text text-anchor="start" x="430.5" y="-201.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnCommitRecord</text>
<text text-anchor="start" x="430.5" y="-186.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> OverlappedRollback</text>
<polyline fill="none" stroke="#8a8898" points="422.5,-179.19 624.5,-179.19 "/>
<text text-anchor="start" x="430.5" y="-163.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit_ts == start_ts</text>
<text text-anchor="start" x="430.5" y="-148.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 且write.has_overlapped_rollback</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback -->
<g id="edge3" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M377.27,-179.19C388.46,-179.19 400.19,-179.19 411.93,-179.19"/>
<polygon fill="green" stroke="green" points="412.23,-182.69 422.23,-179.19 412.23,-175.69 412.23,-182.69"/>
</g>
<!-- TxnCommitRecord__None -->
<g id="node5" class="node">
<title>TxnCommitRecord__None</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M425,-348.69C425,-348.69 622,-348.69 622,-348.69 628,-348.69 634,-354.69 634,-360.69 634,-360.69 634,-435.69 634,-435.69 634,-441.69 628,-447.69 622,-447.69 622,-447.69 425,-447.69 425,-447.69 419,-447.69 413,-441.69 413,-435.69 413,-435.69 413,-360.69 413,-360.69 413,-354.69 419,-348.69 425,-348.69"/>
<text text-anchor="start" x="421" y="-432.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnCommitRecord</text>
<text text-anchor="start" x="421" y="-417.49" font-family="Times,serif" font-size="14.00" fill="#5d6179"> None(Some(OverlappedWrite))</text>
<polyline fill="none" stroke="#8a8898" points="413,-409.69 634,-409.69 "/>
<text text-anchor="start" x="421" y="-394.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit_ts == start_ts</text>
<text text-anchor="start" x="421" y="-379.49" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 并且!write.has_overlapped_rollback</text>
<polyline fill="none" stroke="#8a8898" points="413,-371.69 634,-371.69 "/>
<text text-anchor="start" x="421" y="-356.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">或者没对应的commit record</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None -->
<g id="edge4" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M340.41,-217.34C374.91,-251.6 426.03,-302.38 465.33,-341.41"/>
<polygon fill="green" stroke="green" points="462.96,-343.99 472.53,-348.56 467.9,-339.03 462.96,-343.99"/>
</g>
<!-- WriteType_Rollback -->
<g id="node8" class="node">
<title>WriteType_Rollback</title>
<path fill="none" stroke="#1c2123" d="M712.5,-21.69C712.5,-21.69 855.5,-21.69 855.5,-21.69 861.5,-21.69 867.5,-27.69 867.5,-33.69 867.5,-33.69 867.5,-100.69 867.5,-100.69 867.5,-106.69 861.5,-112.69 855.5,-112.69 855.5,-112.69 712.5,-112.69 712.5,-112.69 706.5,-112.69 700.5,-106.69 700.5,-100.69 700.5,-100.69 700.5,-33.69 700.5,-33.69 700.5,-27.69 706.5,-21.69 712.5,-21.69"/>
<text text-anchor="start" x="708.5" y="-97.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType</text>
<text text-anchor="start" x="708.5" y="-82.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Rollback</text>
<polyline fill="none" stroke="#1c2123" points="700.5,-74.69 867.5,-74.69 "/>
<text text-anchor="start" x="708.5" y="-59.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果write type 为Rollback</text>
<text text-anchor="start" x="708.5" y="-44.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则事务状态为rollback</text>
<text text-anchor="start" x="708.5" y="-29.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 否则为comitted</text>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;WriteType_Rollback -->
<g id="edge6" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;WriteType_Rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M598.58,-75.75C627.13,-74.43 660.1,-72.9 690.2,-71.5"/>
<polygon fill="green" stroke="green" points="690.46,-74.99 700.29,-71.03 690.13,-68 690.46,-74.99"/>
</g>
<!-- TxnStatus__RolledBack -->
<g id="node9" class="node">
<title>TxnStatus__RolledBack</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1000.5,-122.19C1000.5,-122.19 1060.5,-122.19 1060.5,-122.19 1066.5,-122.19 1072.5,-128.19 1072.5,-134.19 1072.5,-134.19 1072.5,-148.19 1072.5,-148.19 1072.5,-154.19 1066.5,-160.19 1060.5,-160.19 1060.5,-160.19 1000.5,-160.19 1000.5,-160.19 994.5,-160.19 988.5,-154.19 988.5,-148.19 988.5,-148.19 988.5,-134.19 988.5,-134.19 988.5,-128.19 994.5,-122.19 1000.5,-122.19"/>
<text text-anchor="start" x="996.5" y="-144.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="996.5" y="-129.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> RolledBack</text>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__RolledBack -->
<g id="edge7" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M598.85,-104.81C621.44,-111.6 646.51,-118.16 670,-122.19 778.54,-140.83 907.98,-142.81 978.13,-142.24"/>
<polygon fill="green" stroke="green" points="978.49,-145.74 988.45,-142.13 978.41,-138.74 978.49,-145.74"/>
</g>
<!-- TxnStatus__Committed -->
<g id="node10" class="node">
<title>TxnStatus__Committed</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1001,-11.19C1001,-11.19 1060,-11.19 1060,-11.19 1066,-11.19 1072,-17.19 1072,-23.19 1072,-23.19 1072,-37.19 1072,-37.19 1072,-43.19 1066,-49.19 1060,-49.19 1060,-49.19 1001,-49.19 1001,-49.19 995,-49.19 989,-43.19 989,-37.19 989,-37.19 989,-23.19 989,-23.19 989,-17.19 995,-11.19 1001,-11.19"/>
<text text-anchor="start" x="997" y="-33.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="997" y="-18.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Committed</text>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__Committed -->
<g id="edge8" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__Committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M576.46,-48.61C603.39,-34.51 637.4,-19.34 670,-12.19 778.07,11.49 908.6,-6.19 978.84,-19.35"/>
<polygon fill="green" stroke="green" points="978.28,-22.81 988.76,-21.26 979.6,-15.93 978.28,-22.81"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback&#45;&gt;TxnStatus__RolledBack -->
<g id="edge9" class="edge">
<title>TxnCommitRecord__OverlappedRollback&#45;&gt;TxnStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M624.85,-173.89C700.1,-169.63 805.58,-163.08 898,-155.19 924.52,-152.93 953.99,-149.85 978.3,-147.15"/>
<polygon fill="green" stroke="green" points="978.83,-150.61 988.38,-146.02 978.05,-143.65 978.83,-150.61"/>
</g>
<!-- MissingLockAction__construct_write -->
<g id="node6" class="node">
<title>MissingLockAction__construct_write</title>
<path fill="none" stroke="#1c2123" d="M729.5,-303.69C729.5,-303.69 838.5,-303.69 838.5,-303.69 844.5,-303.69 850.5,-309.69 850.5,-315.69 850.5,-315.69 850.5,-352.69 850.5,-352.69 850.5,-358.69 844.5,-364.69 838.5,-364.69 838.5,-364.69 729.5,-364.69 729.5,-364.69 723.5,-364.69 717.5,-358.69 717.5,-352.69 717.5,-352.69 717.5,-315.69 717.5,-315.69 717.5,-309.69 723.5,-303.69 729.5,-303.69"/>
<text text-anchor="start" x="725.5" y="-349.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">MissingLockAction</text>
<text text-anchor="start" x="725.5" y="-334.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> construct_write</text>
<polyline fill="none" stroke="#1c2123" points="717.5,-326.69 850.5,-326.69 "/>
<text text-anchor="start" x="725.5" y="-311.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">构造要写入的Write</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MissingLockAction__construct_write -->
<g id="edge10" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MissingLockAction__construct_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M634.13,-371.05C658.82,-364.94 684.49,-358.58 707.42,-352.9"/>
<polygon fill="green" stroke="green" points="708.54,-356.23 717.41,-350.43 706.86,-349.44 708.54,-356.23"/>
</g>
<!-- TxnStatus__LockNotExistDoNothing -->
<g id="node11" class="node">
<title>TxnStatus__LockNotExistDoNothing</title>
<path fill="#bcffb9" stroke="#8a8898" d="M946,-663.69C946,-663.69 1115,-663.69 1115,-663.69 1121,-663.69 1127,-669.69 1127,-675.69 1127,-675.69 1127,-712.69 1127,-712.69 1127,-718.69 1121,-724.69 1115,-724.69 1115,-724.69 946,-724.69 946,-724.69 940,-724.69 934,-718.69 934,-712.69 934,-712.69 934,-675.69 934,-675.69 934,-669.69 940,-663.69 946,-663.69"/>
<text text-anchor="start" x="942" y="-709.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="942" y="-694.49" font-family="Times,serif" font-size="14.00" fill="#5d6179"> LockNotExistDoNothing</text>
<polyline fill="none" stroke="#8a8898" points="934,-686.69 1127,-686.69 "/>
<text text-anchor="start" x="942" y="-671.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果resolving_pessimistic_lock</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExistDoNothing -->
<g id="edge11" class="edge">
<title>TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExistDoNothing</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M561.79,-447.76C584.26,-478.84 612.56,-520.25 634,-559.19 653.39,-594.42 638.05,-617.78 670,-642.19 690.01,-657.49 825.06,-673.94 923.77,-684.16"/>
<polygon fill="green" stroke="green" points="923.5,-687.65 933.8,-685.19 924.21,-680.68 923.5,-687.65"/>
</g>
<!-- TxnStatus__LockNotExist -->
<g id="node12" class="node">
<title>TxnStatus__LockNotExist</title>
<path fill="#bcffb9" stroke="#8a8898" d="M975.5,-384.19C975.5,-384.19 1085.5,-384.19 1085.5,-384.19 1091.5,-384.19 1097.5,-390.19 1097.5,-396.19 1097.5,-396.19 1097.5,-478.19 1097.5,-478.19 1097.5,-484.19 1091.5,-490.19 1085.5,-490.19 1085.5,-490.19 975.5,-490.19 975.5,-490.19 969.5,-490.19 963.5,-484.19 963.5,-478.19 963.5,-478.19 963.5,-396.19 963.5,-396.19 963.5,-390.19 969.5,-384.19 975.5,-384.19"/>
<text text-anchor="start" x="971.5" y="-474.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="971.5" y="-459.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> LockNotExist</text>
<polyline fill="none" stroke="#8a8898" points="963.5,-452.19 1097.5,-452.19 "/>
<text text-anchor="start" x="971.5" y="-436.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnCommitRecord</text>
<text text-anchor="start" x="971.5" y="-421.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> None</text>
<text text-anchor="start" x="971.5" y="-406.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 最后对应的状态为</text>
<text text-anchor="start" x="971.5" y="-391.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> LockNotExist</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExist -->
<g id="edge12" class="edge">
<title>TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExist</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M608.6,-447.87C628.13,-457.1 649.28,-465.35 670,-470.19 768.67,-493.27 797.43,-482.62 898,-470.19 916.13,-467.95 935.36,-464.04 953.35,-459.67"/>
<polygon fill="green" stroke="green" points="954.35,-463.02 963.2,-457.2 952.65,-456.23 954.35,-463.02"/>
</g>
<!-- ErrorInner__TxnNotFound -->
<g id="node13" class="node">
<title>ErrorInner__TxnNotFound</title>
<path fill="none" stroke="#1c2123" d="M708,-384.19C708,-384.19 860,-384.19 860,-384.19 866,-384.19 872,-390.19 872,-396.19 872,-396.19 872,-448.19 872,-448.19 872,-454.19 866,-460.19 860,-460.19 860,-460.19 708,-460.19 708,-460.19 702,-460.19 696,-454.19 696,-448.19 696,-448.19 696,-396.19 696,-396.19 696,-390.19 702,-384.19 708,-384.19"/>
<text text-anchor="start" x="704" y="-444.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrorInner</text>
<text text-anchor="start" x="704" y="-429.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> TxnNotFound</text>
<polyline fill="none" stroke="#1c2123" points="696,-422.19 872,-422.19 "/>
<text text-anchor="start" x="704" y="-406.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果MissingLock::Action为</text>
<text text-anchor="start" x="704" y="-391.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReturnErr</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;ErrorInner__TxnNotFound -->
<g id="edge13" class="edge">
<title>TxnCommitRecord__None&#45;&gt;ErrorInner__TxnNotFound</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M634.13,-408.37C651.22,-409.96 668.78,-411.59 685.58,-413.15"/>
<polygon fill="green" stroke="green" points="685.65,-416.67 695.93,-414.11 686.29,-409.7 685.65,-416.67"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node14" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M1090,-269.19C1090,-269.19 971,-269.19 971,-269.19 965,-269.19 959,-263.19 959,-257.19 959,-257.19 959,-245.19 959,-245.19 959,-239.19 965,-233.19 971,-233.19 971,-233.19 1090,-233.19 1090,-233.19 1096,-233.19 1102,-239.19 1102,-245.19 1102,-245.19 1102,-257.19 1102,-257.19 1102,-263.19 1096,-269.19 1090,-269.19"/>
<text text-anchor="middle" x="1030.5" y="-247.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;collapse_prev_rollback -->
<g id="edge14" class="edge">
<title>TxnCommitRecord__None&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M580.04,-348.42C605.67,-328.24 637.58,-306.76 670,-294.19 719.24,-275.11 858.71,-262.55 948.76,-256.17"/>
<polygon fill="green" stroke="green" points="949.21,-259.65 958.94,-255.46 948.72,-252.67 949.21,-259.65"/>
</g>
<!-- MissingLockAction__collapse_rollback -->
<g id="node15" class="node">
<title>MissingLockAction__collapse_rollback</title>
<path fill="none" stroke="#1c2123" d="M733.5,-208.19C733.5,-208.19 834.5,-208.19 834.5,-208.19 840.5,-208.19 846.5,-214.19 846.5,-220.19 846.5,-220.19 846.5,-234.19 846.5,-234.19 846.5,-240.19 840.5,-246.19 834.5,-246.19 834.5,-246.19 733.5,-246.19 733.5,-246.19 727.5,-246.19 721.5,-240.19 721.5,-234.19 721.5,-234.19 721.5,-220.19 721.5,-220.19 721.5,-214.19 727.5,-208.19 733.5,-208.19"/>
<text text-anchor="start" x="729.5" y="-230.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">MissingLockAction</text>
<text text-anchor="start" x="729.5" y="-215.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> collapse_rollback</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MissingLockAction__collapse_rollback -->
<g id="edge15" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MissingLockAction__collapse_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M566.54,-348.36C593.46,-319.27 630.64,-283.93 670,-261.19 682.76,-253.82 697.26,-247.91 711.53,-243.22"/>
<polygon fill="green" stroke="green" points="712.83,-246.48 721.34,-240.17 710.75,-239.8 712.83,-246.48"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node16" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#1c2123" d="M682,-556.19C682,-556.19 886,-556.19 886,-556.19 892,-556.19 898,-562.19 898,-568.19 898,-568.19 898,-620.19 898,-620.19 898,-626.19 892,-632.19 886,-632.19 886,-632.19 682,-632.19 682,-632.19 676,-632.19 670,-626.19 670,-620.19 670,-620.19 670,-568.19 670,-568.19 670,-562.19 676,-556.19 682,-556.19"/>
<text text-anchor="start" x="678" y="-616.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="678" y="-601.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mark_rollback_on_mismatching_lock</text>
<polyline fill="none" stroke="#1c2123" points="670,-594.19 898,-594.19 "/>
<text text-anchor="start" x="678" y="-578.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果lock不为None</text>
<text text-anchor="start" x="678" y="-563.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并且overlappe为None</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge16" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M590.06,-447.91C631.49,-479.31 684.54,-519.54 724.53,-549.86"/>
<polygon fill="green" stroke="green" points="722.51,-552.72 732.6,-555.98 726.74,-547.15 722.51,-552.72"/>
</g>
<!-- make_rollback -->
<g id="node7" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M1067.5,-545.19C1067.5,-545.19 993.5,-545.19 993.5,-545.19 987.5,-545.19 981.5,-539.19 981.5,-533.19 981.5,-533.19 981.5,-521.19 981.5,-521.19 981.5,-515.19 987.5,-509.19 993.5,-509.19 993.5,-509.19 1067.5,-509.19 1067.5,-509.19 1073.5,-509.19 1079.5,-515.19 1079.5,-521.19 1079.5,-521.19 1079.5,-533.19 1079.5,-533.19 1079.5,-539.19 1073.5,-545.19 1067.5,-545.19"/>
<text text-anchor="middle" x="1030.5" y="-523.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
</g>
<!-- MissingLockAction__construct_write&#45;&gt;make_rollback -->
<g id="edge5" class="edge">
<title>MissingLockAction__construct_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M850.63,-346.55C867.99,-352.63 885.39,-361.7 898,-375.19 937.47,-417.43 893.02,-459.41 934,-500.19 944.12,-510.27 957.7,-516.65 971.44,-520.67"/>
<polygon fill="#666666" stroke="#666666" points="970.86,-524.14 981.42,-523.2 972.59,-517.35 970.86,-524.14"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node17" class="node">
<title>MvccTxn__put_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1383,-416.19C1383,-416.19 1490,-416.19 1490,-416.19 1496,-416.19 1502,-422.19 1502,-428.19 1502,-428.19 1502,-480.19 1502,-480.19 1502,-486.19 1496,-492.19 1490,-492.19 1490,-492.19 1383,-492.19 1383,-492.19 1377,-492.19 1371,-486.19 1371,-480.19 1371,-480.19 1371,-428.19 1371,-428.19 1371,-422.19 1377,-416.19 1383,-416.19"/>
<text text-anchor="start" x="1379" y="-476.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1379" y="-461.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_write</text>
<polyline fill="none" stroke="#8a8898" points="1371,-454.19 1502,-454.19 "/>
<text text-anchor="start" x="1379" y="-438.99" font-family="Times,serif" font-size="14.00" fill="#5d6179">写入rollback type的</text>
<text text-anchor="start" x="1379" y="-423.99" font-family="Times,serif" font-size="14.00" fill="#5d6179"> write</text>
</g>
<!-- MissingLockAction__construct_write&#45;&gt;MvccTxn__put_write -->
<g id="edge17" class="edge">
<title>MissingLockAction__construct_write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M850.63,-339.48C919.77,-345.65 1031.63,-357.34 1127,-375.19 1207.86,-390.32 1298.94,-414.55 1361.04,-432.19"/>
<polygon fill="#666666" stroke="#666666" points="1360.18,-435.59 1370.76,-434.97 1362.1,-428.86 1360.18,-435.59"/>
</g>
<!-- Write -->
<g id="node18" class="node">
<title>Write</title>
<path fill="none" stroke="#1c2123" d="M1264,-497.19C1264,-497.19 1234,-497.19 1234,-497.19 1228,-497.19 1222,-491.19 1222,-485.19 1222,-485.19 1222,-473.19 1222,-473.19 1222,-467.19 1228,-461.19 1234,-461.19 1234,-461.19 1264,-461.19 1264,-461.19 1270,-461.19 1276,-467.19 1276,-473.19 1276,-473.19 1276,-485.19 1276,-485.19 1276,-491.19 1270,-497.19 1264,-497.19"/>
<text text-anchor="middle" x="1249" y="-475.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
</g>
<!-- make_rollback&#45;&gt;Write -->
<g id="edge18" class="edge">
<title>make_rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1079.55,-516.54C1119.46,-507.69 1175.38,-495.29 1211.65,-487.25"/>
<polygon fill="green" stroke="green" points="1212.77,-490.59 1221.78,-485.01 1211.26,-483.75 1212.77,-490.59"/>
</g>
<!-- WriteType_Rollback&#45;&gt;TxnStatus__RolledBack -->
<g id="edge23" class="edge">
<title>WriteType_Rollback&#45;&gt;TxnStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M867.78,-92.25C904.56,-103.38 946.69,-116.13 978.73,-125.83"/>
<polygon fill="green" stroke="green" points="977.74,-129.18 988.33,-128.73 979.77,-122.48 977.74,-129.18"/>
</g>
<!-- WriteType_Rollback&#45;&gt;TxnStatus__Committed -->
<g id="edge24" class="edge">
<title>WriteType_Rollback&#45;&gt;TxnStatus__Committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M867.78,-54.67C904.65,-49.09 946.9,-42.69 978.96,-37.84"/>
<polygon fill="green" stroke="green" points="979.63,-41.28 989,-36.32 978.59,-34.36 979.63,-41.28"/>
</g>
<!-- MissingLockAction__collapse_rollback&#45;&gt;collapse_prev_rollback -->
<g id="edge29" class="edge">
<title>MissingLockAction__collapse_rollback&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M846.7,-233.25C877.59,-236.28 915.4,-239.99 948.59,-243.25"/>
<polygon fill="#666666" stroke="#666666" points="948.44,-246.75 958.73,-244.25 949.12,-239.79 948.44,-246.75"/>
</g>
<!-- protected -->
<g id="node20" class="node">
<title>protected</title>
<path fill="#feed9b" stroke="#f7e495" d="M62.5,-504.19C62.5,-504.19 126.5,-504.19 126.5,-504.19 132.5,-504.19 138.5,-510.19 138.5,-516.19 138.5,-516.19 138.5,-538.19 138.5,-538.19 138.5,-544.19 132.5,-550.19 126.5,-550.19 126.5,-550.19 62.5,-550.19 62.5,-550.19 56.5,-550.19 50.5,-544.19 50.5,-538.19 50.5,-538.19 50.5,-516.19 50.5,-516.19 50.5,-510.19 56.5,-504.19 62.5,-504.19"/>
<text text-anchor="start" x="58.5" y="-534.99" font-family="Times,serif" font-size="14.00" fill="#40575d">protected</text>
<polyline fill="none" stroke="#f7e495" points="50.5,-527.19 138.5,-527.19 "/>
<text text-anchor="start" x="58.5" y="-511.99" font-family="Times,serif" font-size="14.00" fill="#40575d">传入的参数</text>
</g>
<!-- MissingLockAction__collapse_rollback&#45;&gt;protected -->
<g id="edge21" class="edge">
<title>MissingLockAction__collapse_rollback&#45;&gt;protected</title>
<path fill="none" stroke="#666666" d="M721.24,-242.32C704.55,-246.6 686.54,-251.41 670,-256.19 554.7,-289.57 522.43,-289.87 413,-339.19 309.19,-385.99 196.46,-458.44 137.25,-498.36"/>
<polygon fill="#666666" stroke="#666666" points="135.23,-495.5 128.91,-504 139.16,-501.3 135.23,-495.5"/>
</g>
<!-- Lock__rollback_ts__push -->
<g id="node22" class="node">
<title>Lock__rollback_ts__push</title>
<path fill="none" stroke="#1c2123" d="M1175,-611.69C1175,-611.69 1323,-611.69 1323,-611.69 1329,-611.69 1335,-617.69 1335,-623.69 1335,-623.69 1335,-690.69 1335,-690.69 1335,-696.69 1329,-702.69 1323,-702.69 1323,-702.69 1175,-702.69 1175,-702.69 1169,-702.69 1163,-696.69 1163,-690.69 1163,-690.69 1163,-623.69 1163,-623.69 1163,-617.69 1169,-611.69 1175,-611.69"/>
<text text-anchor="start" x="1171" y="-687.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock</text>
<text text-anchor="start" x="1171" y="-672.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rollback_ts</text>
<text text-anchor="start" x="1171" y="-657.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push</text>
<polyline fill="none" stroke="#1c2123" points="1163,-649.69 1335,-649.69 "/>
<text text-anchor="start" x="1171" y="-634.49" font-family="Times,serif" font-size="14.00" fill="#2f3638">将事务的start_ts</text>
<text text-anchor="start" x="1171" y="-619.49" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push到lock的rollback_ts中</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push -->
<g id="edge26" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push</title>
<path fill="none" stroke="#666666" d="M898.26,-609.6C976.25,-620.22 1078.7,-634.16 1152.54,-644.2"/>
<polygon fill="#666666" stroke="#666666" points="1152.38,-647.71 1162.76,-645.59 1153.33,-640.78 1152.38,-647.71"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node23" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1386,-576.69C1386,-576.69 1487,-576.69 1487,-576.69 1493,-576.69 1499,-582.69 1499,-588.69 1499,-588.69 1499,-625.69 1499,-625.69 1499,-631.69 1493,-637.69 1487,-637.69 1487,-637.69 1386,-637.69 1386,-637.69 1380,-637.69 1374,-631.69 1374,-625.69 1374,-625.69 1374,-588.69 1374,-588.69 1374,-582.69 1380,-576.69 1386,-576.69"/>
<text text-anchor="start" x="1382" y="-622.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1382" y="-607.49" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<polyline fill="none" stroke="#8a8898" points="1374,-599.69 1499,-599.69 "/>
<text text-anchor="middle" x="1436.5" y="-584.49" font-family="Times,serif" font-size="14.00" fill="#5d6179">写入更新后的lock</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock -->
<g id="edge27" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="#666666" d="M898.26,-594.68C1009.48,-595.43 1183.96,-597.34 1335,-602.19 1344.33,-602.49 1354.14,-602.88 1363.83,-603.32"/>
<polygon fill="#666666" stroke="#666666" points="1363.71,-606.82 1373.86,-603.78 1364.03,-599.82 1363.71,-606.82"/>
</g>
<!-- Write&#45;&gt;MvccTxn__put_write -->
<g id="edge19" class="edge">
<title>Write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1276.18,-475.66C1298.17,-472.7 1330.69,-468.32 1360.64,-464.28"/>
<polygon fill="green" stroke="green" points="1361.23,-467.73 1370.67,-462.93 1360.3,-460.8 1361.23,-467.73"/>
</g>
<!-- MissingLockAction__ProtectedRollback -->
<g id="node19" class="node">
<title>MissingLockAction__ProtectedRollback</title>
<path fill="none" stroke="#1c2123" d="M473,-568.19C473,-568.19 574,-568.19 574,-568.19 580,-568.19 586,-574.19 586,-580.19 586,-580.19 586,-594.19 586,-594.19 586,-600.19 580,-606.19 574,-606.19 574,-606.19 473,-606.19 473,-606.19 467,-606.19 461,-600.19 461,-594.19 461,-594.19 461,-580.19 461,-580.19 461,-574.19 467,-568.19 473,-568.19"/>
<text text-anchor="start" x="469" y="-590.99" font-family="Times,serif" font-size="14.00" fill="#2f3638">MissingLockAction</text>
<text text-anchor="start" x="469" y="-575.99" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ProtectedRollback</text>
</g>
<!-- MissingLockAction__ProtectedRollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge20" class="edge">
<title>MissingLockAction__ProtectedRollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M586.09,-588.86C608.24,-589.46 634.08,-590.16 659.61,-590.85"/>
<polygon fill="green" stroke="green" points="659.66,-594.35 669.75,-591.13 659.85,-587.36 659.66,-594.35"/>
</g>
<!-- protected&#45;&gt;make_rollback -->
<g id="edge22" class="edge">
<title>protected&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M138.68,-527.19C290.21,-527.19 797.96,-527.19 971.09,-527.19"/>
<polygon fill="#666666" stroke="#666666" points="971.28,-530.69 981.28,-527.19 971.28,-523.69 971.28,-530.69"/>
</g>
<!-- protected&#45;&gt;MissingLockAction__ProtectedRollback -->
<g id="edge30" class="edge">
<title>protected&#45;&gt;MissingLockAction__ProtectedRollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M138.79,-533.28C212.19,-543.59 361.73,-564.6 450.91,-577.13"/>
<polygon fill="green" stroke="green" points="450.55,-580.62 460.94,-578.54 451.53,-573.69 450.55,-580.62"/>
</g>
<!-- resolving_pessimistic_lock -->
<g id="node21" class="node">
<title>resolving_pessimistic_lock</title>
<path fill="#feed9b" stroke="#f7e495" d="M24.5,-680.19C24.5,-680.19 164.5,-680.19 164.5,-680.19 170.5,-680.19 176.5,-686.19 176.5,-692.19 176.5,-692.19 176.5,-706.19 176.5,-706.19 176.5,-712.19 170.5,-718.19 164.5,-718.19 164.5,-718.19 24.5,-718.19 24.5,-718.19 18.5,-718.19 12.5,-712.19 12.5,-706.19 12.5,-706.19 12.5,-692.19 12.5,-692.19 12.5,-686.19 18.5,-680.19 24.5,-680.19"/>
<text text-anchor="start" x="20.5" y="-702.99" font-family="Times,serif" font-size="14.00" fill="#40575d">resolving_pessimistic_lock</text>
<text text-anchor="start" x="20.5" y="-687.99" font-family="Times,serif" font-size="14.00" fill="#40575d"> 传入的参数</text>
</g>
<!-- resolving_pessimistic_lock&#45;&gt;TxnStatus__LockNotExistDoNothing -->
<g id="edge25" class="edge">
<title>resolving_pessimistic_lock&#45;&gt;TxnStatus__LockNotExistDoNothing</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M176.75,-698.76C345.84,-697.85 735.47,-695.77 923.79,-694.76"/>
<polygon fill="green" stroke="green" points="923.99,-698.26 933.98,-694.7 923.96,-691.26 923.99,-698.26"/>
</g>
<!-- Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock -->
<g id="edge28" class="edge">
<title>Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1335.15,-634.24C1344.83,-631.63 1354.63,-628.99 1364.11,-626.44"/>
<polygon fill="green" stroke="green" points="1365.11,-629.79 1373.86,-623.81 1363.29,-623.03 1365.11,-629.79"/>
</g>
</g>
</svg>
