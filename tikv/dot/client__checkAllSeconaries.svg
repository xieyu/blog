<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1668pt" height="223pt"
 viewBox="0.00 0.00 1668.00 222.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 218.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-218.5 1664,-218.5 1664,4 -4,4"/>
<!-- LockResover__checkAllSecondaries -->
<g id="node1" class="node">
<title>LockResover__checkAllSecondaries</title>
<path fill="none" stroke="#1c2123" d="M119,-62.5C119,-62.5 229,-62.5 229,-62.5 235,-62.5 241,-68.5 241,-74.5 241,-74.5 241,-88.5 241,-88.5 241,-94.5 235,-100.5 229,-100.5 229,-100.5 119,-100.5 119,-100.5 113,-100.5 107,-94.5 107,-88.5 107,-88.5 107,-74.5 107,-74.5 107,-68.5 113,-62.5 119,-62.5"/>
<text text-anchor="start" x="115" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResover</text>
<text text-anchor="start" x="115" y="-70.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> checkAllSecondaries</text>
</g>
<!-- LockResover__checkSecondaries -->
<g id="node2" class="node">
<title>LockResover__checkSecondaries</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M687,-102C687,-102 863,-102 863,-102 869,-102 875,-108 875,-114 875,-114 875,-181 875,-181 875,-187 869,-193 863,-193 863,-193 687,-193 687,-193 681,-193 675,-187 675,-181 675,-181 675,-114 675,-114 675,-108 681,-102 687,-102"/>
<text text-anchor="start" x="683" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResover</text>
<text text-anchor="start" x="683" y="-162.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> checkSecondaries</text>
<polyline fill="none" stroke="#8a8898" points="675,-155 875,-155 "/>
<text text-anchor="start" x="683" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">每个region 单独起一个</text>
<text text-anchor="start" x="683" y="-124.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> goroutine向TiKV发送</text>
<text text-anchor="start" x="683" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> CmdCheckSecondaryLocks请求</text>
</g>
<!-- LockResover__checkAllSecondaries&#45;&gt;LockResover__checkSecondaries -->
<g id="edge1" class="edge">
<title>LockResover__checkAllSecondaries&#45;&gt;LockResover__checkSecondaries</title>
<path fill="none" stroke="#666666" d="M241.37,-84.37C331.69,-88.86 498.2,-99.21 639,-119.5 647.43,-120.72 656.13,-122.13 664.86,-123.68"/>
<polygon fill="#666666" stroke="#666666" points="664.25,-127.12 674.71,-125.47 665.5,-120.24 664.25,-127.12"/>
</g>
<!-- asyncResolveData -->
<g id="node3" class="node">
<title>asyncResolveData</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1514,-0.5C1514,-0.5 1648,-0.5 1648,-0.5 1654,-0.5 1660,-6.5 1660,-12.5 1660,-12.5 1660,-118.5 1660,-118.5 1660,-124.5 1654,-130.5 1648,-130.5 1648,-130.5 1514,-130.5 1514,-130.5 1508,-130.5 1502,-124.5 1502,-118.5 1502,-118.5 1502,-12.5 1502,-12.5 1502,-6.5 1508,-0.5 1514,-0.5"/>
<text text-anchor="start" x="1510" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">asyncResolveData</text>
<text text-anchor="start" x="1510" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 多个goroutine之间共享</text>
<polyline fill="none" stroke="#8a8898" points="1502,-92.5 1660,-92.5 "/>
<text text-anchor="start" x="1510" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">mutex sync.Mutex</text>
<polyline fill="none" stroke="#8a8898" points="1502,-69.5 1660,-69.5 "/>
<text text-anchor="start" x="1510" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">commitTs uint64</text>
<polyline fill="none" stroke="#8a8898" points="1502,-46.5 1660,-46.5 "/>
<text text-anchor="start" x="1510" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">keys [][]byte</text>
<polyline fill="none" stroke="#8a8898" points="1502,-23.5 1660,-23.5 "/>
<text text-anchor="start" x="1510" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">missingLock bool</text>
</g>
<!-- LockResover__checkAllSecondaries&#45;&gt;asyncResolveData -->
<g id="edge2" class="edge">
<title>LockResover__checkAllSecondaries&#45;&gt;asyncResolveData</title>
<path fill="none" stroke="#666666" d="M241.12,-65.39C316.22,-48.54 442.66,-24.5 553,-24.5 553,-24.5 553,-24.5 1194.5,-24.5 1296.92,-24.5 1413.78,-38.99 1491.74,-50.74"/>
<polygon fill="#666666" stroke="#666666" points="1491.58,-54.25 1502,-52.3 1492.64,-47.33 1491.58,-54.25"/>
</g>
<!-- RegionCache__GroupKeysByRegion -->
<g id="node4" class="node">
<title>RegionCache__GroupKeysByRegion</title>
<path fill="none" stroke="#1c2123" d="M289,-129C289,-129 421,-129 421,-129 427,-129 433,-135 433,-141 433,-141 433,-178 433,-178 433,-184 427,-190 421,-190 421,-190 289,-190 289,-190 283,-190 277,-184 277,-178 277,-178 277,-141 277,-141 277,-135 283,-129 289,-129"/>
<text text-anchor="start" x="285" y="-174.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RegionCache</text>
<text text-anchor="start" x="285" y="-159.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> GroupKeysByRegion</text>
<polyline fill="none" stroke="#1c2123" points="277,-152 433,-152 "/>
<text text-anchor="start" x="285" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据region将key做分组</text>
</g>
<!-- LockResover__checkAllSecondaries&#45;&gt;RegionCache__GroupKeysByRegion -->
<g id="edge3" class="edge">
<title>LockResover__checkAllSecondaries&#45;&gt;RegionCache__GroupKeysByRegion</title>
<path fill="none" stroke="#666666" d="M218.79,-100.58C235.6,-107.91 255.35,-116.51 274.49,-124.85"/>
<polygon fill="#666666" stroke="#666666" points="273.25,-128.13 283.82,-128.92 276.05,-121.71 273.25,-128.13"/>
</g>
<!-- storage__SendReq -->
<g id="node5" class="node">
<title>storage__SendReq</title>
<path fill="none" stroke="#1c2123" d="M1144,-94C1144,-94 1243,-94 1243,-94 1249,-94 1255,-100 1255,-106 1255,-106 1255,-135 1255,-135 1255,-141 1249,-147 1243,-147 1243,-147 1144,-147 1144,-147 1138,-147 1132,-141 1132,-135 1132,-135 1132,-106 1132,-106 1132,-100 1138,-94 1144,-94"/>
<text text-anchor="start" x="1140" y="-131.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">storage</text>
<text text-anchor="start" x="1140" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> SendReq</text>
<text text-anchor="start" x="1140" y="-101.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 向TiKV发送请求</text>
</g>
<!-- LockResover__checkAllSecondaries&#45;&gt;storage__SendReq -->
<g id="edge4" class="edge">
<title>LockResover__checkAllSecondaries&#45;&gt;storage__SendReq</title>
<path fill="none" stroke="#666666" d="M241.18,-76.16C316.61,-70.54 443.6,-62.5 553,-62.5 553,-62.5 553,-62.5 776,-62.5 918.47,-62.5 957.01,-50.17 1096,-81.5 1105.95,-83.74 1116.21,-86.89 1126.15,-90.44"/>
<polygon fill="#666666" stroke="#666666" points="1124.97,-93.74 1135.56,-93.95 1127.42,-87.18 1124.97,-93.74"/>
</g>
<!-- CmdCheckSecondaryLocks -->
<g id="node9" class="node">
<title>CmdCheckSecondaryLocks</title>
<path fill="none" stroke="#1c2123" d="M1075.5,-214.5C1075.5,-214.5 931.5,-214.5 931.5,-214.5 925.5,-214.5 919.5,-208.5 919.5,-202.5 919.5,-202.5 919.5,-190.5 919.5,-190.5 919.5,-184.5 925.5,-178.5 931.5,-178.5 931.5,-178.5 1075.5,-178.5 1075.5,-178.5 1081.5,-178.5 1087.5,-184.5 1087.5,-190.5 1087.5,-190.5 1087.5,-202.5 1087.5,-202.5 1087.5,-208.5 1081.5,-214.5 1075.5,-214.5"/>
<text text-anchor="middle" x="1003.5" y="-192.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdCheckSecondaryLocks</text>
</g>
<!-- LockResover__checkSecondaries&#45;&gt;CmdCheckSecondaryLocks -->
<g id="edge9" class="edge">
<title>LockResover__checkSecondaries&#45;&gt;CmdCheckSecondaryLocks</title>
<path fill="none" stroke="#666666" d="M875.02,-168.92C886.43,-171.39 898.05,-173.9 909.38,-176.35"/>
<polygon fill="#666666" stroke="#666666" points="908.74,-179.8 919.26,-178.49 910.22,-172.96 908.74,-179.8"/>
</g>
<!-- CheckSecondaryLocksRequest -->
<g id="node10" class="node">
<title>CheckSecondaryLocksRequest</title>
<path fill="none" stroke="#1c2123" d="M923,-91C923,-91 1084,-91 1084,-91 1090,-91 1096,-97 1096,-103 1096,-103 1096,-148 1096,-148 1096,-154 1090,-160 1084,-160 1084,-160 923,-160 923,-160 917,-160 911,-154 911,-148 911,-148 911,-103 911,-103 911,-97 917,-91 923,-91"/>
<text text-anchor="start" x="919" y="-144.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocksRequest</text>
<polyline fill="none" stroke="#1c2123" points="911,-137 1096,-137 "/>
<text text-anchor="start" x="919" y="-121.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Keys</text>
<polyline fill="none" stroke="#1c2123" points="911,-114 1096,-114 "/>
<text text-anchor="start" x="919" y="-98.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">StartVersion: txnID,</text>
</g>
<!-- LockResover__checkSecondaries&#45;&gt;CheckSecondaryLocksRequest -->
<g id="edge10" class="edge">
<title>LockResover__checkSecondaries&#45;&gt;CheckSecondaryLocksRequest</title>
<path fill="none" stroke="#666666" d="M875.02,-137.88C883.57,-137.05 892.24,-136.21 900.82,-135.38"/>
<polygon fill="#666666" stroke="#666666" points="901.22,-138.85 910.83,-134.4 900.54,-131.89 901.22,-138.85"/>
</g>
<!-- regions -->
<g id="node8" class="node">
<title>regions</title>
<path fill="none" stroke="#1c2123" d="M481,-129C481,-129 627,-129 627,-129 633,-129 639,-135 639,-141 639,-141 639,-178 639,-178 639,-184 633,-190 627,-190 627,-190 481,-190 481,-190 475,-190 469,-184 469,-178 469,-178 469,-141 469,-141 469,-135 475,-129 481,-129"/>
<text text-anchor="start" x="477" y="-174.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">regions</text>
<polyline fill="none" stroke="#1c2123" points="469,-167 639,-167 "/>
<text text-anchor="start" x="477" y="-151.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">map[RegionVersID][][]byes</text>
<text text-anchor="start" x="477" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> regionVerID到keys的映射</text>
</g>
<!-- RegionCache__GroupKeysByRegion&#45;&gt;regions -->
<g id="edge7" class="edge">
<title>RegionCache__GroupKeysByRegion&#45;&gt;regions</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M433.01,-159.5C441.47,-159.5 450.14,-159.5 458.78,-159.5"/>
<polygon fill="green" stroke="green" points="458.87,-163 468.87,-159.5 458.87,-156 458.87,-163"/>
</g>
<!-- asyncResolveData__addKeys -->
<g id="node11" class="node">
<title>asyncResolveData__addKeys</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1303,-62.5C1303,-62.5 1454,-62.5 1454,-62.5 1460,-62.5 1466,-68.5 1466,-74.5 1466,-74.5 1466,-156.5 1466,-156.5 1466,-162.5 1460,-168.5 1454,-168.5 1454,-168.5 1303,-168.5 1303,-168.5 1297,-168.5 1291,-162.5 1291,-156.5 1291,-156.5 1291,-74.5 1291,-74.5 1291,-68.5 1297,-62.5 1303,-62.5"/>
<text text-anchor="start" x="1299" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">asyncResolveData</text>
<text text-anchor="start" x="1299" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> addKeys</text>
<polyline fill="none" stroke="#8a8898" points="1291,-130.5 1466,-130.5 "/>
<text text-anchor="start" x="1299" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">使用checkresp更新</text>
<text text-anchor="start" x="1299" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> asyncResoveData</text>
<text text-anchor="start" x="1299" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 会使用lock.MinCommitTS</text>
<text text-anchor="start" x="1299" y="-70.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 来更新整体的commitTs</text>
</g>
<!-- storage__SendReq&#45;&gt;asyncResolveData__addKeys -->
<g id="edge13" class="edge">
<title>storage__SendReq&#45;&gt;asyncResolveData__addKeys</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1255.18,-118.84C1263.41,-118.62 1272.01,-118.38 1280.68,-118.15"/>
<polygon fill="green" stroke="green" points="1280.96,-121.64 1290.86,-117.87 1280.77,-114.64 1280.96,-121.64"/>
</g>
<!-- TxnStatus -->
<g id="node6" class="node">
<title>TxnStatus</title>
<path fill="none" stroke="#1c2123" d="M59,-177.5C59,-177.5 12,-177.5 12,-177.5 6,-177.5 0,-171.5 0,-165.5 0,-165.5 0,-153.5 0,-153.5 0,-147.5 6,-141.5 12,-141.5 12,-141.5 59,-141.5 59,-141.5 65,-141.5 71,-147.5 71,-153.5 71,-153.5 71,-165.5 71,-165.5 71,-171.5 65,-177.5 59,-177.5"/>
<text text-anchor="middle" x="35.5" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus</text>
</g>
<!-- LockInfo -->
<g id="node7" class="node">
<title>LockInfo</title>
<path fill="none" stroke="#1c2123" d="M195.5,-177.5C195.5,-177.5 152.5,-177.5 152.5,-177.5 146.5,-177.5 140.5,-171.5 140.5,-165.5 140.5,-165.5 140.5,-153.5 140.5,-153.5 140.5,-147.5 146.5,-141.5 152.5,-141.5 152.5,-141.5 195.5,-141.5 195.5,-141.5 201.5,-141.5 207.5,-147.5 207.5,-153.5 207.5,-153.5 207.5,-165.5 207.5,-165.5 207.5,-171.5 201.5,-177.5 195.5,-177.5"/>
<text text-anchor="middle" x="174" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockInfo</text>
</g>
<!-- TxnStatus&#45;&gt;LockInfo -->
<g id="edge5" class="edge">
<title>TxnStatus&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" d="M71.3,-159.5C89.16,-159.5 111.08,-159.5 129.99,-159.5"/>
<polygon fill="#666666" stroke="#666666" points="130.14,-163 140.14,-159.5 130.14,-156 130.14,-163"/>
</g>
<!-- LockInfo&#45;&gt;RegionCache__GroupKeysByRegion -->
<g id="edge6" class="edge">
<title>LockInfo&#45;&gt;RegionCache__GroupKeysByRegion</title>
<path fill="none" stroke="#666666" d="M207.83,-159.5C224.48,-159.5 245.58,-159.5 266.54,-159.5"/>
<polygon fill="#666666" stroke="#666666" points="266.79,-163 276.79,-159.5 266.79,-156 266.79,-163"/>
</g>
<!-- regions&#45;&gt;LockResover__checkSecondaries -->
<g id="edge8" class="edge">
<title>regions&#45;&gt;LockResover__checkSecondaries</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M639.04,-154.89C647.45,-154.43 656.08,-153.96 664.7,-153.49"/>
<polygon fill="green" stroke="green" points="665.01,-156.98 674.8,-152.94 664.63,-149.99 665.01,-156.98"/>
</g>
<!-- CmdCheckSecondaryLocks&#45;&gt;storage__SendReq -->
<g id="edge11" class="edge">
<title>CmdCheckSecondaryLocks&#45;&gt;storage__SendReq</title>
<path fill="none" stroke="#666666" d="M1070.96,-178.45C1079.47,-175.68 1088,-172.68 1096,-169.5 1108.93,-164.36 1122.45,-158.1 1135.14,-151.79"/>
<polygon fill="#666666" stroke="#666666" points="1136.86,-154.84 1144.21,-147.2 1133.71,-148.59 1136.86,-154.84"/>
</g>
<!-- CheckSecondaryLocksRequest&#45;&gt;storage__SendReq -->
<g id="edge12" class="edge">
<title>CheckSecondaryLocksRequest&#45;&gt;storage__SendReq</title>
<path fill="none" stroke="#666666" d="M1096.02,-123.07C1104.65,-122.84 1113.31,-122.61 1121.71,-122.38"/>
<polygon fill="#666666" stroke="#666666" points="1121.89,-125.88 1131.8,-122.11 1121.71,-118.88 1121.89,-125.88"/>
</g>
<!-- asyncResolveData__addKeys&#45;&gt;asyncResolveData -->
<g id="edge14" class="edge">
<title>asyncResolveData__addKeys&#45;&gt;asyncResolveData</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1466.28,-93.86C1474.8,-91.74 1483.45,-89.58 1491.98,-87.45"/>
<polygon fill="green" stroke="green" points="1493.07,-90.79 1501.93,-84.97 1491.38,-83.99 1493.07,-90.79"/>
</g>
</g>
</svg>
