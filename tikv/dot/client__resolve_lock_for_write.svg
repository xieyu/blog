<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="991pt" height="532pt"
 viewBox="0.00 0.00 991.00 532.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 528.2)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-528.2 987,-528.2 987,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_status_ttl</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M804,-30.2C804,-30.2 960,-30.2 960,-30.2 966,-30.2 972,-36.2 972,-42.2 972,-42.2 972,-264.2 972,-264.2 972,-270.2 966,-276.2 960,-276.2 960,-276.2 804,-276.2 804,-276.2 798,-276.2 792,-270.2 792,-264.2 792,-264.2 792,-42.2 792,-42.2 792,-36.2 798,-30.2 804,-30.2"/>
<text text-anchor="middle" x="882" y="-256.2" font-family="Times,serif" font-size="20.00">status ttl==0</text>
</g>
<!-- LockResolver__resolveLocks -->
<g id="node1" class="node">
<title>LockResolver__resolveLocks</title>
<path fill="none" stroke="#1c2123" d="M12,-55.7C12,-55.7 95,-55.7 95,-55.7 101,-55.7 107,-61.7 107,-67.7 107,-67.7 107,-104.7 107,-104.7 107,-110.7 101,-116.7 95,-116.7 95,-116.7 12,-116.7 12,-116.7 6,-116.7 0,-110.7 0,-104.7 0,-104.7 0,-67.7 0,-67.7 0,-61.7 6,-55.7 12,-55.7"/>
<text text-anchor="start" x="8" y="-101.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="8" y="-86.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> resolveLocks</text>
<polyline fill="none" stroke="#1c2123" points="0,-78.7 107,-78.7 "/>
<text text-anchor="start" x="8" y="-63.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolve一批lock</text>
</g>
<!-- resolve -->
<g id="node2" class="node">
<title>resolve</title>
<path fill="none" stroke="#1c2123" d="M191,-159.2C191,-159.2 271,-159.2 271,-159.2 277,-159.2 283,-165.2 283,-171.2 283,-171.2 283,-193.2 283,-193.2 283,-199.2 277,-205.2 271,-205.2 271,-205.2 191,-205.2 191,-205.2 185,-205.2 179,-199.2 179,-193.2 179,-193.2 179,-171.2 179,-171.2 179,-165.2 185,-159.2 191,-159.2"/>
<text text-anchor="start" x="187" y="-190" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolve</text>
<polyline fill="none" stroke="#1c2123" points="179,-182.2 283,-182.2 "/>
<text text-anchor="start" x="187" y="-167" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolve单个key</text>
</g>
<!-- LockResolver__resolveLocks&#45;&gt;resolve -->
<g id="edge1" class="edge">
<title>LockResolver__resolveLocks&#45;&gt;resolve</title>
<path fill="none" stroke="#666666" d="M93.19,-117.01C108.19,-128.06 125.87,-140.05 143,-149.2 151.35,-153.67 160.45,-157.81 169.5,-161.56"/>
<polygon fill="#666666" stroke="#666666" points="168.3,-164.85 178.89,-165.31 170.9,-158.35 168.3,-164.85"/>
</g>
<!-- cleanTxns -->
<g id="node3" class="node">
<title>cleanTxns</title>
<path fill="#feed9b" stroke="#f7e495" d="M155,-32.7C155,-32.7 307,-32.7 307,-32.7 313,-32.7 319,-38.7 319,-44.7 319,-44.7 319,-127.7 319,-127.7 319,-133.7 313,-139.7 307,-139.7 307,-139.7 155,-139.7 155,-139.7 149,-139.7 143,-133.7 143,-127.7 143,-127.7 143,-44.7 143,-44.7 143,-38.7 149,-32.7 155,-32.7"/>
<text text-anchor="start" x="151" y="-124.5" font-family="Times,serif" font-size="14.00" fill="#40575d">cleanTxns</text>
<polyline fill="none" stroke="#f7e495" points="143,-116.7 319,-116.7 "/>
<text text-anchor="start" x="151" y="-101.5" font-family="Times,serif" font-size="14.00" fill="#40575d">// TxnID &#45;&gt; []Region,</text>
<polyline fill="none" stroke="#f7e495" points="143,-93.7 319,-93.7 "/>
<text text-anchor="start" x="151" y="-78.5" font-family="Times,serif" font-size="14.00" fill="#40575d">record resolved Regions.</text>
<polyline fill="none" stroke="#f7e495" points="143,-70.7 319,-70.7 "/>
<text text-anchor="start" x="151" y="-55.5" font-family="Times,serif" font-size="14.00" fill="#40575d">map[uint64]map[</text>
<text text-anchor="start" x="151" y="-40.5" font-family="Times,serif" font-size="14.00" fill="#40575d"> locate.RegionVerID]struct{}</text>
</g>
<!-- LockResolver__resolveLocks&#45;&gt;cleanTxns -->
<g id="edge2" class="edge">
<title>LockResolver__resolveLocks&#45;&gt;cleanTxns</title>
<path fill="none" stroke="#666666" d="M107.16,-86.2C115.37,-86.2 124.08,-86.2 132.91,-86.2"/>
<polygon fill="#666666" stroke="#666666" points="132.92,-89.7 142.92,-86.2 132.92,-82.7 132.92,-89.7"/>
</g>
<!-- cleanRegions -->
<g id="node4" class="node">
<title>cleanRegions</title>
<path fill="#feed9b" stroke="#f7e495" d="M552,-39.2C552,-39.2 733,-39.2 733,-39.2 739,-39.2 745,-45.2 745,-51.2 745,-51.2 745,-65.2 745,-65.2 745,-71.2 739,-77.2 733,-77.2 733,-77.2 552,-77.2 552,-77.2 546,-77.2 540,-71.2 540,-65.2 540,-65.2 540,-51.2 540,-51.2 540,-45.2 546,-39.2 552,-39.2"/>
<text text-anchor="start" x="548" y="-62" font-family="Times,serif" font-size="14.00" fill="#40575d">cleanRegions</text>
<text text-anchor="middle" x="642.5" y="-47" font-family="Times,serif" font-size="14.00" fill="#40575d"> map[locate.RegionVerID]struct{}</text>
</g>
<!-- LockResolver__resolveLocks&#45;&gt;cleanRegions -->
<g id="edge3" class="edge">
<title>LockResolver__resolveLocks&#45;&gt;cleanRegions</title>
<path fill="none" stroke="#666666" d="M87.08,-55.6C102.73,-42.96 122.52,-29.75 143,-23.2 288.61,23.33 469.93,-10.77 568.83,-36.55"/>
<polygon fill="#666666" stroke="#666666" points="568.16,-40 578.72,-39.18 569.95,-33.23 568.16,-40"/>
</g>
<!-- LockResolver__resolveLockAsync -->
<g id="node5" class="node">
<title>LockResolver__resolveLockAsync</title>
<path fill="#bcffb9" stroke="#8a8898" d="M812,-176.7C812,-176.7 952,-176.7 952,-176.7 958,-176.7 964,-182.7 964,-188.7 964,-188.7 964,-225.7 964,-225.7 964,-231.7 958,-237.7 952,-237.7 952,-237.7 812,-237.7 812,-237.7 806,-237.7 800,-231.7 800,-225.7 800,-225.7 800,-188.7 800,-188.7 800,-182.7 806,-176.7 812,-176.7"/>
<text text-anchor="start" x="808" y="-222.5" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="808" y="-207.5" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolveLockAsync</text>
<polyline fill="none" stroke="#8a8898" points="800,-199.7 964,-199.7 "/>
<text text-anchor="start" x="808" y="-184.5" font-family="Times,serif" font-size="14.00" fill="#5d6179">清理async commit 的lock</text>
</g>
<!-- resolve&#45;&gt;LockResolver__resolveLockAsync -->
<g id="edge10" class="edge">
<title>resolve&#45;&gt;LockResolver__resolveLockAsync</title>
<path fill="none" stroke="#666666" d="M283.34,-183.98C375.7,-187.22 576.03,-194.35 745,-201.2 759.39,-201.79 774.64,-202.43 789.51,-203.08"/>
<polygon fill="#666666" stroke="#666666" points="789.6,-206.58 799.74,-203.52 789.9,-199.59 789.6,-206.58"/>
</g>
<!-- LockResolver__resolvePessimisticLock -->
<g id="node6" class="node">
<title>LockResolver__resolvePessimisticLock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M819.5,-96.7C819.5,-96.7 944.5,-96.7 944.5,-96.7 950.5,-96.7 956.5,-102.7 956.5,-108.7 956.5,-108.7 956.5,-145.7 956.5,-145.7 956.5,-151.7 950.5,-157.7 944.5,-157.7 944.5,-157.7 819.5,-157.7 819.5,-157.7 813.5,-157.7 807.5,-151.7 807.5,-145.7 807.5,-145.7 807.5,-108.7 807.5,-108.7 807.5,-102.7 813.5,-96.7 819.5,-96.7"/>
<text text-anchor="start" x="815.5" y="-142.5" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="815.5" y="-127.5" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolvePessimisticLock</text>
<polyline fill="none" stroke="#8a8898" points="807.5,-119.7 956.5,-119.7 "/>
<text text-anchor="start" x="815.5" y="-104.5" font-family="Times,serif" font-size="14.00" fill="#5d6179">清理悲观事务lock</text>
</g>
<!-- resolve&#45;&gt;LockResolver__resolvePessimisticLock -->
<g id="edge11" class="edge">
<title>resolve&#45;&gt;LockResolver__resolvePessimisticLock</title>
<path fill="none" stroke="#666666" d="M283.2,-177.86C394.82,-168.4 660.97,-145.85 797.34,-134.29"/>
<polygon fill="#666666" stroke="#666666" points="797.66,-137.78 807.33,-133.45 797.07,-130.8 797.66,-137.78"/>
</g>
<!-- LockResolver__resolveLock -->
<g id="node7" class="node">
<title>LockResolver__resolveLock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M848,-39.2C848,-39.2 916,-39.2 916,-39.2 922,-39.2 928,-45.2 928,-51.2 928,-51.2 928,-65.2 928,-65.2 928,-71.2 922,-77.2 916,-77.2 916,-77.2 848,-77.2 848,-77.2 842,-77.2 836,-71.2 836,-65.2 836,-65.2 836,-51.2 836,-51.2 836,-45.2 842,-39.2 848,-39.2"/>
<text text-anchor="start" x="844" y="-62" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="844" y="-47" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolveLock</text>
</g>
<!-- resolve&#45;&gt;LockResolver__resolveLock -->
<g id="edge12" class="edge">
<title>resolve&#45;&gt;LockResolver__resolveLock</title>
<path fill="none" stroke="#666666" d="M283.1,-171.04C305.18,-166.3 331.33,-160.83 355,-156.2 527.84,-122.43 572.08,-119.52 745,-86.2 771.63,-81.07 801.12,-75.04 825.81,-69.9"/>
<polygon fill="#666666" stroke="#666666" points="826.65,-73.3 835.72,-67.82 825.22,-66.45 826.65,-73.3"/>
</g>
<!-- LockResolver__getTxnStatusFromLock -->
<g id="node8" class="node">
<title>LockResolver__getTxnStatusFromLock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M367,-221.2C367,-221.2 492,-221.2 492,-221.2 498,-221.2 504,-227.2 504,-233.2 504,-233.2 504,-285.2 504,-285.2 504,-291.2 498,-297.2 492,-297.2 492,-297.2 367,-297.2 367,-297.2 361,-297.2 355,-291.2 355,-285.2 355,-285.2 355,-233.2 355,-233.2 355,-227.2 361,-221.2 367,-221.2"/>
<text text-anchor="start" x="363" y="-282" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="363" y="-267" font-family="Times,serif" font-size="14.00" fill="#5d6179"> getTxnStatusFromLock</text>
<polyline fill="none" stroke="#8a8898" points="355,-259.2 504,-259.2 "/>
<text text-anchor="start" x="363" y="-244" font-family="Times,serif" font-size="14.00" fill="#5d6179">根据lock.primarykey</text>
<text text-anchor="start" x="363" y="-229" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 获取事务的status</text>
</g>
<!-- resolve&#45;&gt;LockResolver__getTxnStatusFromLock -->
<g id="edge13" class="edge">
<title>resolve&#45;&gt;LockResolver__getTxnStatusFromLock</title>
<path fill="none" stroke="#666666" d="M283.12,-202.23C302.13,-209.69 324.24,-218.35 345.39,-226.64"/>
<polygon fill="#666666" stroke="#666666" points="344.11,-229.89 354.7,-230.28 346.67,-223.38 344.11,-229.89"/>
</g>
<!-- tikverr__NewErrorWriteConflictWithArgs -->
<g id="node11" class="node">
<title>tikverr__NewErrorWriteConflictWithArgs</title>
<path fill="none" stroke="#1c2123" d="M793,-364.7C793,-364.7 971,-364.7 971,-364.7 977,-364.7 983,-370.7 983,-376.7 983,-376.7 983,-511.7 983,-511.7 983,-517.7 977,-523.7 971,-523.7 971,-523.7 793,-523.7 793,-523.7 787,-523.7 781,-517.7 781,-511.7 781,-511.7 781,-376.7 781,-376.7 781,-370.7 787,-364.7 793,-364.7"/>
<text text-anchor="start" x="789" y="-508.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">tikverr</text>
<text text-anchor="start" x="789" y="-493.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> NewErrorWriteConflictWithArgs</text>
<polyline fill="none" stroke="#1c2123" points="781,-485.7 983,-485.7 "/>
<text text-anchor="start" x="789" y="-470.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write conflict detected!</text>
<polyline fill="none" stroke="#1c2123" points="781,-462.7 983,-462.7 "/>
<text text-anchor="start" x="789" y="-447.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">If it&#39;s a optimistic conflict</text>
<text text-anchor="start" x="789" y="-432.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> and current txn is earlier</text>
<text text-anchor="start" x="789" y="-417.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> than the lock owner,</text>
<text text-anchor="start" x="789" y="-402.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> abort current transaction.</text>
<text text-anchor="start" x="789" y="-387.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> This could avoids the deadlock</text>
<text text-anchor="start" x="789" y="-372.5" font-family="Times,serif" font-size="14.00" fill="#2f3638"> scene of two large transaction.</text>
</g>
<!-- resolve&#45;&gt;tikverr__NewErrorWriteConflictWithArgs -->
<g id="edge14" class="edge">
<title>resolve&#45;&gt;tikverr__NewErrorWriteConflictWithArgs</title>
<path fill="none" stroke="#666666" d="M248.39,-205.28C269.72,-233.58 309.66,-281 355,-307.2 486.12,-383 659.56,-417.6 770.74,-432.87"/>
<polygon fill="#666666" stroke="#666666" points="770.59,-436.38 780.96,-434.25 771.52,-429.45 770.59,-436.38"/>
</g>
<!-- cleanTxns&#45;&gt;cleanRegions -->
<g id="edge17" class="edge">
<title>cleanTxns&#45;&gt;cleanRegions</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M319.09,-80.25C380.52,-76.05 463.33,-70.39 529.65,-65.85"/>
<polygon fill="green" stroke="green" points="529.98,-69.34 539.72,-65.16 529.51,-62.35 529.98,-69.34"/>
</g>
<!-- cleanRegions&#45;&gt;LockResolver__resolvePessimisticLock -->
<g id="edge15" class="edge">
<title>cleanRegions&#45;&gt;LockResolver__resolvePessimisticLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M709.03,-77.24C736.41,-85.2 768.56,-94.54 797.6,-102.97"/>
<polygon fill="green" stroke="green" points="796.74,-106.37 807.32,-105.8 798.69,-99.65 796.74,-106.37"/>
</g>
<!-- cleanRegions&#45;&gt;LockResolver__resolveLock -->
<g id="edge16" class="edge">
<title>cleanRegions&#45;&gt;LockResolver__resolveLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M745.25,-58.2C772.78,-58.2 801.55,-58.2 825.49,-58.2"/>
<polygon fill="green" stroke="green" points="825.78,-61.7 835.78,-58.2 825.78,-54.7 825.78,-61.7"/>
</g>
<!-- TxnStatus -->
<g id="node9" class="node">
<title>TxnStatus</title>
<path fill="none" stroke="#1c2123" d="M556,-210.7C556,-210.7 729,-210.7 729,-210.7 735,-210.7 741,-216.7 741,-222.7 741,-222.7 741,-313.7 741,-313.7 741,-319.7 735,-325.7 729,-325.7 729,-325.7 556,-325.7 556,-325.7 550,-325.7 544,-319.7 544,-313.7 544,-313.7 544,-222.7 544,-222.7 544,-216.7 550,-210.7 556,-210.7"/>
<text text-anchor="start" x="552" y="-310.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus</text>
<polyline fill="none" stroke="#1c2123" points="544,-302.7 741,-302.7 "/>
<text text-anchor="start" x="552" y="-287.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">ttl uint64</text>
<polyline fill="none" stroke="#1c2123" points="544,-279.7 741,-279.7 "/>
<text text-anchor="start" x="552" y="-264.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitTS uint64</text>
<polyline fill="none" stroke="#1c2123" points="544,-256.7 741,-256.7 "/>
<text text-anchor="start" x="552" y="-241.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">action kvrpcpb.Action</text>
<polyline fill="none" stroke="#1c2123" points="544,-233.7 741,-233.7 "/>
<text text-anchor="start" x="552" y="-218.5" font-family="Times,serif" font-size="14.00" fill="#2f3638">primaryLock *kvrpcpb.LockInfo</text>
</g>
<!-- LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus -->
<g id="edge4" class="edge">
<title>LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus</title>
<path fill="none" stroke="#666666" d="M504,-262.34C513.64,-262.75 523.66,-263.18 533.72,-263.61"/>
<polygon fill="#666666" stroke="#666666" points="533.63,-267.1 543.77,-264.03 533.92,-260.11 533.63,-267.1"/>
</g>
<!-- TxnStatus&#45;&gt;LockResolver__resolveLockAsync -->
<g id="edge5" class="edge">
<title>TxnStatus&#45;&gt;LockResolver__resolveLockAsync</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M741.13,-243.13C757.23,-238.99 773.87,-234.72 789.81,-230.62"/>
<polygon fill="green" stroke="green" points="790.82,-233.98 799.63,-228.1 789.08,-227.2 790.82,-233.98"/>
</g>
<!-- TxnStatus&#45;&gt;LockResolver__resolvePessimisticLock -->
<g id="edge6" class="edge">
<title>TxnStatus&#45;&gt;LockResolver__resolvePessimisticLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M714.7,-210.63C735.38,-195.39 758.47,-179.72 781,-167.2 786.47,-164.16 792.22,-161.24 798.08,-158.44"/>
<polygon fill="green" stroke="green" points="799.75,-161.53 807.36,-154.16 796.82,-155.17 799.75,-161.53"/>
</g>
<!-- TxnStatus&#45;&gt;LockResolver__resolveLock -->
<g id="edge7" class="edge">
<title>TxnStatus&#45;&gt;LockResolver__resolveLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M681.52,-210.34C713.01,-164.01 756.44,-104.07 781,-87.2 794.26,-78.1 810.39,-71.82 825.79,-67.5"/>
<polygon fill="green" stroke="green" points="826.95,-70.81 835.77,-64.93 825.21,-64.03 826.95,-70.81"/>
</g>
<!-- msBeforeExpired -->
<g id="node10" class="node">
<title>msBeforeExpired</title>
<path fill="#feed9b" stroke="#f7e495" d="M825,-284.7C825,-284.7 939,-284.7 939,-284.7 945,-284.7 951,-290.7 951,-296.7 951,-296.7 951,-333.7 951,-333.7 951,-339.7 945,-345.7 939,-345.7 939,-345.7 825,-345.7 825,-345.7 819,-345.7 813,-339.7 813,-333.7 813,-333.7 813,-296.7 813,-296.7 813,-290.7 819,-284.7 825,-284.7"/>
<text text-anchor="start" x="821" y="-330.5" font-family="Times,serif" font-size="14.00" fill="#40575d">msBeforeExpired</text>
<text text-anchor="start" x="821" y="-315.5" font-family="Times,serif" font-size="14.00" fill="#40575d"> 等到下次lock expire</text>
<polyline fill="none" stroke="#f7e495" points="813,-307.7 951,-307.7 "/>
<text text-anchor="start" x="821" y="-292.5" font-family="Times,serif" font-size="14.00" fill="#40575d">由上层重试</text>
</g>
<!-- TxnStatus&#45;&gt;msBeforeExpired -->
<g id="edge8" class="edge">
<title>TxnStatus&#45;&gt;msBeforeExpired</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M741.13,-287.52C761.7,-291.59 783.16,-295.84 802.9,-299.75"/>
<polygon fill="green" stroke="green" points="802.26,-303.19 812.75,-301.7 803.62,-296.32 802.26,-303.19"/>
</g>
<!-- TxnStatus&#45;&gt;tikverr__NewErrorWriteConflictWithArgs -->
<g id="edge9" class="edge">
<title>TxnStatus&#45;&gt;tikverr__NewErrorWriteConflictWithArgs</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M721.27,-325.83C737.66,-337.98 755.24,-351.01 772.53,-363.82"/>
<polygon fill="green" stroke="green" points="770.86,-366.94 780.98,-370.09 775.03,-361.32 770.86,-366.94"/>
</g>
</g>
</svg>
