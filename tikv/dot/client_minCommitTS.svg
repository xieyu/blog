<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1318pt" height="255pt"
 viewBox="0.00 0.00 1318.00 255.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 251)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-251 1314,-251 1314,4 -4,4"/>
<!-- actionPrewrite__handleSingleBatch -->
<g id="node1" class="node">
<title>actionPrewrite__handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M125,-111C125,-111 304,-111 304,-111 310,-111 316,-117 316,-123 316,-123 316,-175 316,-175 316,-181 310,-187 304,-187 304,-187 125,-187 125,-187 119,-187 113,-181 113,-175 113,-175 113,-123 113,-123 113,-117 119,-111 125,-111"/>
<text text-anchor="start" x="121" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionPrewrite</text>
<text text-anchor="start" x="121" y="-156.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handleSingleBatch</text>
<polyline fill="none" stroke="#1c2123" points="113,-149 316,-149 "/>
<text text-anchor="start" x="121" y="-133.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用resp中的minCommitTS</text>
<text text-anchor="start" x="121" y="-118.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新committer的minCommitTS</text>
</g>
<!-- c__buildPrewriteRequest -->
<g id="node2" class="node">
<title>c__buildPrewriteRequest</title>
<path fill="none" stroke="#1c2123" d="M493,-120C493,-120 364,-120 364,-120 358,-120 352,-114 352,-108 352,-108 352,-96 352,-96 352,-90 358,-84 364,-84 364,-84 493,-84 493,-84 499,-84 505,-90 505,-96 505,-96 505,-108 505,-108 505,-114 499,-120 493,-120"/>
<text text-anchor="middle" x="428.5" y="-98.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">c__buildPrewriteRequest</text>
</g>
<!-- actionPrewrite__handleSingleBatch&#45;&gt;c__buildPrewriteRequest -->
<g id="edge1" class="edge">
<title>actionPrewrite__handleSingleBatch&#45;&gt;c__buildPrewriteRequest</title>
<path fill="none" stroke="#666666" d="M316.22,-126.67C324.82,-124.76 333.47,-122.85 341.94,-120.97"/>
<polygon fill="#666666" stroke="#666666" points="342.77,-124.37 351.78,-118.79 341.26,-117.54 342.77,-124.37"/>
</g>
<!-- prewriteResp__MinCommitTS -->
<g id="node3" class="node">
<title>prewriteResp__MinCommitTS</title>
<path fill="none" stroke="#1c2123" d="M853,-125.5C853,-125.5 1004,-125.5 1004,-125.5 1010,-125.5 1016,-131.5 1016,-137.5 1016,-137.5 1016,-234.5 1016,-234.5 1016,-240.5 1010,-246.5 1004,-246.5 1004,-246.5 853,-246.5 853,-246.5 847,-246.5 841,-240.5 841,-234.5 841,-234.5 841,-137.5 841,-137.5 841,-131.5 847,-125.5 853,-125.5"/>
<text text-anchor="start" x="849" y="-231.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewriteResp</text>
<text text-anchor="start" x="849" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MinCommitTS</text>
<polyline fill="none" stroke="#1c2123" points="841,-208.5 1016,-208.5 "/>
<text text-anchor="start" x="849" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">TiKV返回resp上</text>
<text text-anchor="start" x="849" y="-178.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会带着一个minCommitTS</text>
<text text-anchor="start" x="849" y="-163.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commiter要用它</text>
<text text-anchor="start" x="849" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来更新自己的</text>
<text text-anchor="start" x="849" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> minCommitTS</text>
</g>
<!-- actionPrewrite__handleSingleBatch&#45;&gt;prewriteResp__MinCommitTS -->
<g id="edge2" class="edge">
<title>actionPrewrite__handleSingleBatch&#45;&gt;prewriteResp__MinCommitTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M316,-154.22C452.74,-161.33 695.76,-173.96 830.6,-180.96"/>
<polygon fill="green" stroke="green" points="830.74,-184.48 840.91,-181.5 831.11,-177.49 830.74,-184.48"/>
</g>
<!-- c__minCommitTS -->
<g id="node4" class="node">
<title>c__minCommitTS</title>
<path fill="#feed9b" stroke="#f7e495" d="M553,-116C553,-116 657,-116 657,-116 663,-116 669,-122 669,-128 669,-128 669,-142 669,-142 669,-148 663,-154 657,-154 657,-154 553,-154 553,-154 547,-154 541,-148 541,-142 541,-142 541,-128 541,-128 541,-122 547,-116 553,-116"/>
<text text-anchor="start" x="549" y="-138.8" font-family="Times,serif" font-size="14.00" fill="#40575d">twoPhaseCommitter</text>
<text text-anchor="start" x="549" y="-123.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> minCommitTS</text>
</g>
<!-- actionPrewrite__handleSingleBatch&#45;&gt;c__minCommitTS -->
<g id="edge3" class="edge">
<title>actionPrewrite__handleSingleBatch&#45;&gt;c__minCommitTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M316.05,-145.38C383.21,-142.96 470.02,-139.83 530.69,-137.64"/>
<polygon fill="green" stroke="green" points="531.08,-141.13 540.95,-137.27 530.83,-134.13 531.08,-141.13"/>
</g>
<!-- c__buildPrewriteRequest&#45;&gt;c__minCommitTS -->
<g id="edge13" class="edge">
<title>c__buildPrewriteRequest&#45;&gt;c__minCommitTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M505.02,-116.28C513.63,-117.91 522.39,-119.57 530.97,-121.19"/>
<polygon fill="green" stroke="green" points="530.45,-124.65 540.92,-123.07 531.75,-117.77 530.45,-124.65"/>
</g>
<!-- c__forUpdateTS -->
<g id="node12" class="node">
<title>c__forUpdateTS</title>
<path fill="#feed9b" stroke="#f7e495" d="M553,-59C553,-59 657,-59 657,-59 663,-59 669,-65 669,-71 669,-71 669,-85 669,-85 669,-91 663,-97 657,-97 657,-97 553,-97 553,-97 547,-97 541,-91 541,-85 541,-85 541,-71 541,-71 541,-65 547,-59 553,-59"/>
<text text-anchor="start" x="549" y="-81.8" font-family="Times,serif" font-size="14.00" fill="#40575d">twoPhaseCommitter</text>
<text text-anchor="start" x="549" y="-66.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> forUpdateTS</text>
</g>
<!-- c__buildPrewriteRequest&#45;&gt;c__forUpdateTS -->
<g id="edge14" class="edge">
<title>c__buildPrewriteRequest&#45;&gt;c__forUpdateTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M505.02,-91.61C513.63,-90.43 522.39,-89.22 530.97,-88.04"/>
<polygon fill="green" stroke="green" points="531.49,-91.51 540.92,-86.68 530.54,-84.57 531.49,-91.51"/>
</g>
<!-- prewriteResp__MinCommitTS&#45;&gt;c__minCommitTS -->
<g id="edge12" class="edge">
<title>prewriteResp__MinCommitTS&#45;&gt;c__minCommitTS</title>
<path fill="none" stroke="#666666" d="M840.79,-172.24C790.23,-164.22 727.18,-154.22 679.15,-146.6"/>
<polygon fill="#666666" stroke="#666666" points="679.56,-143.13 669.13,-145.02 678.46,-150.04 679.56,-143.13"/>
</g>
<!-- minCommitTS -->
<g id="node13" class="node">
<title>minCommitTS</title>
<path fill="none" stroke="#1c2123" d="M793,-96C793,-96 717,-96 717,-96 711,-96 705,-90 705,-84 705,-84 705,-72 705,-72 705,-66 711,-60 717,-60 717,-60 793,-60 793,-60 799,-60 805,-66 805,-72 805,-72 805,-84 805,-84 805,-90 799,-96 793,-96"/>
<text text-anchor="middle" x="755" y="-74.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">minCommitTS</text>
</g>
<!-- c__minCommitTS&#45;&gt;minCommitTS -->
<g id="edge16" class="edge">
<title>c__minCommitTS&#45;&gt;minCommitTS</title>
<path fill="none" stroke="#666666" d="M655.69,-115.86C669.2,-110.66 683.93,-104.99 697.77,-99.66"/>
<polygon fill="#666666" stroke="#666666" points="699.12,-102.89 707.19,-96.03 696.6,-96.36 699.12,-102.89"/>
</g>
<!-- c__execute -->
<g id="node5" class="node">
<title>c__execute</title>
<path fill="none" stroke="#1c2123" d="M65,-115C65,-115 12,-115 12,-115 6,-115 0,-109 0,-103 0,-103 0,-91 0,-91 0,-85 6,-79 12,-79 12,-79 65,-79 65,-79 71,-79 77,-85 77,-91 77,-91 77,-103 77,-103 77,-109 71,-115 65,-115"/>
<text text-anchor="middle" x="38.5" y="-93.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">c__execute</text>
</g>
<!-- c__execute&#45;&gt;actionPrewrite__handleSingleBatch -->
<g id="edge4" class="edge">
<title>c__execute&#45;&gt;actionPrewrite__handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M77.26,-108.28C85.19,-110.66 93.95,-113.27 103.07,-116"/>
<polygon fill="green" stroke="green" points="102.11,-119.36 112.69,-118.87 104.12,-112.66 102.11,-119.36"/>
</g>
<!-- c__store__GetTimeStampWithRetry -->
<g id="node6" class="node">
<title>c__store__GetTimeStampWithRetry</title>
<path fill="none" stroke="#1c2123" d="M138.5,-0.5C138.5,-0.5 290.5,-0.5 290.5,-0.5 296.5,-0.5 302.5,-6.5 302.5,-12.5 302.5,-12.5 302.5,-79.5 302.5,-79.5 302.5,-85.5 296.5,-91.5 290.5,-91.5 290.5,-91.5 138.5,-91.5 138.5,-91.5 132.5,-91.5 126.5,-85.5 126.5,-79.5 126.5,-79.5 126.5,-12.5 126.5,-12.5 126.5,-6.5 132.5,-0.5 138.5,-0.5"/>
<text text-anchor="start" x="134.5" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetTimeStampWithRetry</text>
<polyline fill="none" stroke="#1c2123" points="126.5,-68.5 302.5,-68.5 "/>
<text text-anchor="start" x="134.5" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果需要线性一致性</text>
<text text-anchor="start" x="134.5" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> needLinearizability</text>
<text text-anchor="start" x="134.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先获取一个lastTS</text>
<text text-anchor="start" x="134.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> minCommitTS = lastTS + 1</text>
</g>
<!-- c__execute&#45;&gt;c__store__GetTimeStampWithRetry -->
<g id="edge6" class="edge">
<title>c__execute&#45;&gt;c__store__GetTimeStampWithRetry</title>
<path fill="none" stroke="#666666" d="M77.26,-85.93C89.03,-82.48 102.6,-78.5 116.52,-74.43"/>
<polygon fill="#666666" stroke="#666666" points="117.58,-77.76 126.19,-71.59 115.61,-71.05 117.58,-77.76"/>
</g>
<!-- lastestTS -->
<g id="node7" class="node">
<title>lastestTS</title>
<path fill="none" stroke="#1c2123" d="M449.5,-65C449.5,-65 407.5,-65 407.5,-65 401.5,-65 395.5,-59 395.5,-53 395.5,-53 395.5,-41 395.5,-41 395.5,-35 401.5,-29 407.5,-29 407.5,-29 449.5,-29 449.5,-29 455.5,-29 461.5,-35 461.5,-41 461.5,-41 461.5,-53 461.5,-53 461.5,-59 455.5,-65 449.5,-65"/>
<text text-anchor="middle" x="428.5" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">lastestTS</text>
</g>
<!-- c__store__GetTimeStampWithRetry&#45;&gt;lastestTS -->
<g id="edge5" class="edge">
<title>c__store__GetTimeStampWithRetry&#45;&gt;lastestTS</title>
<path fill="none" stroke="#666666" d="M302.65,-46.41C331.2,-46.55 361.63,-46.69 385.31,-46.8"/>
<polygon fill="#666666" stroke="#666666" points="385.33,-50.3 395.35,-46.85 385.36,-43.3 385.33,-50.3"/>
</g>
<!-- lastestTS&#45;&gt;c__minCommitTS -->
<g id="edge7" class="edge">
<title>lastestTS&#45;&gt;c__minCommitTS</title>
<path fill="none" stroke="#666666" d="M461.86,-56.18C475.67,-60.8 491.63,-67.11 505,-75 523.19,-85.73 523.24,-94.59 541,-106 543.73,-107.76 546.59,-109.47 549.52,-111.12"/>
<polygon fill="#666666" stroke="#666666" points="547.98,-114.26 558.44,-115.89 551.28,-108.09 547.98,-114.26"/>
</g>
<!-- PrewriteRequest -->
<g id="node8" class="node">
<title>PrewriteRequest</title>
<path fill="none" stroke="#1c2123" d="M873.5,-45.5C873.5,-45.5 983.5,-45.5 983.5,-45.5 989.5,-45.5 995.5,-51.5 995.5,-57.5 995.5,-57.5 995.5,-94.5 995.5,-94.5 995.5,-100.5 989.5,-106.5 983.5,-106.5 983.5,-106.5 873.5,-106.5 873.5,-106.5 867.5,-106.5 861.5,-100.5 861.5,-94.5 861.5,-94.5 861.5,-57.5 861.5,-57.5 861.5,-51.5 867.5,-45.5 873.5,-45.5"/>
<text text-anchor="start" x="869.5" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PrewriteRequest</text>
<polyline fill="none" stroke="#1c2123" points="861.5,-83.5 995.5,-83.5 "/>
<text text-anchor="start" x="869.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发给TiKV的请求上</text>
<text text-anchor="start" x="869.5" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 带了minCommitTS</text>
</g>
<!-- TiKV -->
<g id="node9" class="node">
<title>TiKV</title>
<path fill="none" stroke="#1c2123" d="M1094,-149C1094,-149 1064,-149 1064,-149 1058,-149 1052,-143 1052,-137 1052,-137 1052,-125 1052,-125 1052,-119 1058,-113 1064,-113 1064,-113 1094,-113 1094,-113 1100,-113 1106,-119 1106,-125 1106,-125 1106,-137 1106,-137 1106,-143 1100,-149 1094,-149"/>
<text text-anchor="middle" x="1079" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">TiKV</text>
</g>
<!-- PrewriteRequest&#45;&gt;TiKV -->
<g id="edge8" class="edge">
<title>PrewriteRequest&#45;&gt;TiKV</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M995.93,-100.6C1011.84,-106.5 1028.23,-112.57 1042.14,-117.72"/>
<polygon fill="green" stroke="green" points="1041.2,-121.1 1051.79,-121.29 1043.63,-114.54 1041.2,-121.1"/>
</g>
<!-- TiKV&#45;&gt;prewriteResp__MinCommitTS -->
<g id="edge9" class="edge">
<title>TiKV&#45;&gt;prewriteResp__MinCommitTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1051.94,-140.65C1044.25,-143.5 1035.34,-146.8 1025.9,-150.3"/>
<polygon fill="green" stroke="green" points="1024.47,-147.09 1016.31,-153.85 1026.91,-153.66 1024.47,-147.09"/>
</g>
<!-- TiKV__ConcurrencyManager_max_ts -->
<g id="node10" class="node">
<title>TiKV__ConcurrencyManager_max_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M1154,-152.5C1154,-152.5 1298,-152.5 1298,-152.5 1304,-152.5 1310,-158.5 1310,-164.5 1310,-164.5 1310,-201.5 1310,-201.5 1310,-207.5 1304,-213.5 1298,-213.5 1298,-213.5 1154,-213.5 1154,-213.5 1148,-213.5 1142,-207.5 1142,-201.5 1142,-201.5 1142,-164.5 1142,-164.5 1142,-158.5 1148,-152.5 1154,-152.5"/>
<text text-anchor="start" x="1150" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#40575d">TiKV</text>
<text text-anchor="start" x="1150" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> ConcurrencyManager</text>
<polyline fill="none" stroke="#f7e495" points="1142,-175.5 1310,-175.5 "/>
<text text-anchor="start" x="1150" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#40575d">max_ts: Arc&lt;AtomicU64&gt;,</text>
</g>
<!-- TiKV&#45;&gt;TiKV__ConcurrencyManager_max_ts -->
<g id="edge10" class="edge">
<title>TiKV&#45;&gt;TiKV__ConcurrencyManager_max_ts</title>
<path fill="none" stroke="#666666" d="M1106.26,-140.42C1113.97,-143.18 1122.88,-146.38 1132.28,-149.75"/>
<polygon fill="#666666" stroke="#666666" points="1131.23,-153.09 1141.83,-153.17 1133.6,-146.5 1131.23,-153.09"/>
</g>
<!-- TiKV__Lock__MinCommitTS -->
<g id="node11" class="node">
<title>TiKV__Lock__MinCommitTS</title>
<path fill="#feed9b" stroke="#f7e495" d="M1177,-27C1177,-27 1275,-27 1275,-27 1281,-27 1287,-33 1287,-39 1287,-39 1287,-121 1287,-121 1287,-127 1281,-133 1275,-133 1275,-133 1177,-133 1177,-133 1171,-133 1165,-127 1165,-121 1165,-121 1165,-39 1165,-39 1165,-33 1171,-27 1177,-27"/>
<text text-anchor="start" x="1173" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#40575d">TiKV</text>
<text text-anchor="start" x="1173" y="-102.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> Lock</text>
<text text-anchor="start" x="1173" y="-87.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> MinCommitTS</text>
<polyline fill="none" stroke="#f7e495" points="1165,-80 1287,-80 "/>
<text text-anchor="start" x="1173" y="-64.8" font-family="Times,serif" font-size="14.00" fill="#40575d">将minCommitTS</text>
<text text-anchor="start" x="1173" y="-49.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 保存在prewrite的</text>
<text text-anchor="start" x="1173" y="-34.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> lock中</text>
</g>
<!-- TiKV&#45;&gt;TiKV__Lock__MinCommitTS -->
<g id="edge11" class="edge">
<title>TiKV&#45;&gt;TiKV__Lock__MinCommitTS</title>
<path fill="none" stroke="#666666" d="M1106.26,-121.76C1120.1,-116.9 1137.8,-110.67 1155.28,-104.52"/>
<polygon fill="#666666" stroke="#666666" points="1156.68,-107.74 1164.95,-101.12 1154.35,-101.14 1156.68,-107.74"/>
</g>
<!-- c__forUpdateTS&#45;&gt;minCommitTS -->
<g id="edge15" class="edge">
<title>c__forUpdateTS&#45;&gt;minCommitTS</title>
<path fill="none" stroke="#666666" d="M669.19,-78C677.68,-78 686.37,-78 694.79,-78"/>
<polygon fill="#666666" stroke="#666666" points="694.89,-81.5 704.89,-78 694.89,-74.5 694.89,-81.5"/>
</g>
<!-- minCommitTS&#45;&gt;PrewriteRequest -->
<g id="edge17" class="edge">
<title>minCommitTS&#45;&gt;PrewriteRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M805.15,-77.43C819.52,-77.26 835.58,-77.07 851.21,-76.89"/>
<polygon fill="green" stroke="green" points="851.45,-80.39 861.4,-76.77 851.36,-73.39 851.45,-80.39"/>
</g>
</g>
</svg>
