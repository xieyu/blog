<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: propose_conf_change Pages: 1 -->
<svg width="1459pt" height="302pt"
 viewBox="0.00 0.00 1459.00 301.90" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 297.9)">
<title>propose_conf_change</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-297.9 1455,-297.9 1455,4 -4,4"/>
<!-- propose_conf_change -->
<g id="node1" class="node">
<title>propose_conf_change</title>
<path fill="none" stroke="#1c2123" d="M123,-219.5C123,-219.5 12,-219.5 12,-219.5 6,-219.5 0,-213.5 0,-207.5 0,-207.5 0,-195.5 0,-195.5 0,-189.5 6,-183.5 12,-183.5 12,-183.5 123,-183.5 123,-183.5 129,-183.5 135,-189.5 135,-195.5 135,-195.5 135,-207.5 135,-207.5 135,-213.5 129,-219.5 123,-219.5"/>
<text text-anchor="middle" x="67.5" y="-197.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">propose_conf_change</text>
</g>
<!-- msgEntryConfChange -->
<g id="node2" class="node">
<title>msgEntryConfChange</title>
<path fill="none" stroke="#1c2123" d="M305.5,-246.5C305.5,-246.5 191.5,-246.5 191.5,-246.5 185.5,-246.5 179.5,-240.5 179.5,-234.5 179.5,-234.5 179.5,-222.5 179.5,-222.5 179.5,-216.5 185.5,-210.5 191.5,-210.5 191.5,-210.5 305.5,-210.5 305.5,-210.5 311.5,-210.5 317.5,-216.5 317.5,-222.5 317.5,-222.5 317.5,-234.5 317.5,-234.5 317.5,-240.5 311.5,-246.5 305.5,-246.5"/>
<text text-anchor="middle" x="248.5" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">msgEntryConfChange</text>
</g>
<!-- propose_conf_change&#45;&gt;msgEntryConfChange -->
<g id="edge1" class="edge">
<title>propose_conf_change&#45;&gt;msgEntryConfChange</title>
<path fill="none" stroke="#666666" d="M135.15,-211.55C146.3,-213.24 157.95,-214.99 169.36,-216.71"/>
<polygon fill="#666666" stroke="#666666" points="168.89,-220.18 179.3,-218.21 169.93,-213.26 168.89,-220.18"/>
</g>
<!-- msgEntryConfChangeV2 -->
<g id="node3" class="node">
<title>msgEntryConfChangeV2</title>
<path fill="none" stroke="#1c2123" d="M314,-192.5C314,-192.5 183,-192.5 183,-192.5 177,-192.5 171,-186.5 171,-180.5 171,-180.5 171,-168.5 171,-168.5 171,-162.5 177,-156.5 183,-156.5 183,-156.5 314,-156.5 314,-156.5 320,-156.5 326,-162.5 326,-168.5 326,-168.5 326,-180.5 326,-180.5 326,-186.5 320,-192.5 314,-192.5"/>
<text text-anchor="middle" x="248.5" y="-170.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">msgEntryConfChangeV2</text>
</g>
<!-- propose_conf_change&#45;&gt;msgEntryConfChangeV2 -->
<g id="edge2" class="edge">
<title>propose_conf_change&#45;&gt;msgEntryConfChangeV2</title>
<path fill="none" stroke="#666666" d="M135.15,-191.45C143.51,-190.19 152.16,-188.88 160.77,-187.58"/>
<polygon fill="#666666" stroke="#666666" points="161.47,-191.02 170.84,-186.06 160.43,-184.09 161.47,-191.02"/>
</g>
<!-- msgPropose -->
<g id="node4" class="node">
<title>msgPropose</title>
<path fill="none" stroke="#1c2123" d="M433,-234.5C433,-234.5 374,-234.5 374,-234.5 368,-234.5 362,-228.5 362,-222.5 362,-222.5 362,-210.5 362,-210.5 362,-204.5 368,-198.5 374,-198.5 374,-198.5 433,-198.5 433,-198.5 439,-198.5 445,-204.5 445,-210.5 445,-210.5 445,-222.5 445,-222.5 445,-228.5 439,-234.5 433,-234.5"/>
<text text-anchor="middle" x="403.5" y="-212.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">msgPropose</text>
</g>
<!-- propose_conf_change&#45;&gt;msgPropose -->
<g id="edge3" class="edge">
<title>propose_conf_change&#45;&gt;msgPropose</title>
<path fill="none" stroke="#666666" d="M94.46,-219.74C114.37,-232.55 143.08,-248.59 171,-255.5 237.87,-272.04 259.02,-271.59 326,-255.5 339.63,-252.23 353.57,-246.1 365.75,-239.65"/>
<polygon fill="#666666" stroke="#666666" points="367.64,-242.61 374.69,-234.7 364.24,-236.48 367.64,-242.61"/>
</g>
<!-- step -->
<g id="node6" class="node">
<title>step</title>
<path fill="none" stroke="#1c2123" d="M418.5,-169.5C418.5,-169.5 388.5,-169.5 388.5,-169.5 382.5,-169.5 376.5,-163.5 376.5,-157.5 376.5,-157.5 376.5,-145.5 376.5,-145.5 376.5,-139.5 382.5,-133.5 388.5,-133.5 388.5,-133.5 418.5,-133.5 418.5,-133.5 424.5,-133.5 430.5,-139.5 430.5,-145.5 430.5,-145.5 430.5,-157.5 430.5,-157.5 430.5,-163.5 424.5,-169.5 418.5,-169.5"/>
<text text-anchor="middle" x="403.5" y="-147.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">step</text>
</g>
<!-- propose_conf_change&#45;&gt;step -->
<g id="edge7" class="edge">
<title>propose_conf_change&#45;&gt;step</title>
<path fill="none" stroke="#666666" d="M94.46,-183.26C114.37,-170.45 143.08,-154.41 171,-147.5 238.33,-130.85 320.08,-138.46 366.21,-145.19"/>
<polygon fill="#666666" stroke="#666666" points="365.91,-148.69 376.32,-146.74 366.96,-141.77 365.91,-148.69"/>
</g>
<!-- msgEntryConfChange&#45;&gt;msgPropose -->
<g id="edge4" class="edge">
<title>msgEntryConfChange&#45;&gt;msgPropose</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M317.94,-223.13C329.28,-222.24 340.85,-221.33 351.66,-220.49"/>
<polygon fill="green" stroke="green" points="352.05,-223.97 361.74,-219.7 351.5,-216.99 352.05,-223.97"/>
</g>
<!-- msgEntryConfChangeV2&#45;&gt;msgPropose -->
<g id="edge5" class="edge">
<title>msgEntryConfChangeV2&#45;&gt;msgPropose</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M315.27,-192.56C327.68,-195.96 340.46,-199.47 352.29,-202.72"/>
<polygon fill="green" stroke="green" points="351.41,-206.1 361.98,-205.38 353.26,-199.35 351.41,-206.1"/>
</g>
<!-- step_leader -->
<g id="node5" class="node">
<title>step_leader</title>
<path fill="none" stroke="#1c2123" d="M547,-196.5C547,-196.5 493,-196.5 493,-196.5 487,-196.5 481,-190.5 481,-184.5 481,-184.5 481,-172.5 481,-172.5 481,-166.5 487,-160.5 493,-160.5 493,-160.5 547,-160.5 547,-160.5 553,-160.5 559,-166.5 559,-172.5 559,-172.5 559,-184.5 559,-184.5 559,-190.5 553,-196.5 547,-196.5"/>
<text text-anchor="middle" x="520" y="-174.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_leader</text>
</g>
<!-- msgPropose&#45;&gt;step_leader -->
<g id="edge6" class="edge">
<title>msgPropose&#45;&gt;step_leader</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M445.19,-203C453.6,-200.21 462.52,-197.24 471.16,-194.38"/>
<polygon fill="green" stroke="green" points="472.35,-197.67 480.74,-191.2 470.15,-191.03 472.35,-197.67"/>
</g>
<!-- merge_from_bytes -->
<g id="node7" class="node">
<title>merge_from_bytes</title>
<path fill="none" stroke="#1c2123" d="M781,-242.5C781,-242.5 685,-242.5 685,-242.5 679,-242.5 673,-236.5 673,-230.5 673,-230.5 673,-218.5 673,-218.5 673,-212.5 679,-206.5 685,-206.5 685,-206.5 781,-206.5 781,-206.5 787,-206.5 793,-212.5 793,-218.5 793,-218.5 793,-230.5 793,-230.5 793,-236.5 787,-242.5 781,-242.5"/>
<text text-anchor="middle" x="733" y="-220.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">merge_from_bytes</text>
</g>
<!-- step_leader&#45;&gt;merge_from_bytes -->
<g id="edge9" class="edge">
<title>step_leader&#45;&gt;merge_from_bytes</title>
<path fill="none" stroke="#666666" d="M559.21,-186.83C588.07,-193.12 628.46,-201.93 662.93,-209.44"/>
<polygon fill="#666666" stroke="#666666" points="662.44,-212.92 672.95,-211.63 663.93,-206.08 662.44,-212.92"/>
</g>
<!-- has_pending_conf -->
<g id="node8" class="node">
<title>has_pending_conf</title>
<path fill="none" stroke="#1c2123" d="M607,-65.5C607,-65.5 859,-65.5 859,-65.5 865,-65.5 871,-71.5 871,-77.5 871,-77.5 871,-137.5 871,-137.5 871,-143.5 865,-149.5 859,-149.5 859,-149.5 607,-149.5 607,-149.5 601,-149.5 595,-143.5 595,-137.5 595,-137.5 595,-77.5 595,-77.5 595,-71.5 601,-65.5 607,-65.5"/>
<text text-anchor="middle" x="733" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_pending_conf</text>
<polyline fill="none" stroke="#1c2123" points="595,-126.5 871,-126.5 "/>
<text text-anchor="middle" x="733" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.pending_conf_index &gt; self.raft_log.applied</text>
<polyline fill="none" stroke="#1c2123" points="595,-103.5 871,-103.5 "/>
<text text-anchor="start" x="603" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果有pending_conf</text>
<text text-anchor="start" x="603" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 此次conf change会被ignore掉</text>
</g>
<!-- step_leader&#45;&gt;has_pending_conf -->
<g id="edge10" class="edge">
<title>step_leader&#45;&gt;has_pending_conf</title>
<path fill="none" stroke="#666666" d="M559.21,-165.64C570.5,-161.84 583.55,-157.45 597.33,-152.82"/>
<polygon fill="#666666" stroke="#666666" points="598.6,-156.08 606.97,-149.57 596.37,-149.45 598.6,-156.08"/>
</g>
<!-- append_entry -->
<g id="node9" class="node">
<title>append_entry</title>
<path fill="none" stroke="#1c2123" d="M1059.5,-242.5C1059.5,-242.5 993.5,-242.5 993.5,-242.5 987.5,-242.5 981.5,-236.5 981.5,-230.5 981.5,-230.5 981.5,-218.5 981.5,-218.5 981.5,-212.5 987.5,-206.5 993.5,-206.5 993.5,-206.5 1059.5,-206.5 1059.5,-206.5 1065.5,-206.5 1071.5,-212.5 1071.5,-218.5 1071.5,-218.5 1071.5,-230.5 1071.5,-230.5 1071.5,-236.5 1065.5,-242.5 1059.5,-242.5"/>
<text text-anchor="middle" x="1026.5" y="-220.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">append_entry</text>
</g>
<!-- step_leader&#45;&gt;append_entry -->
<g id="edge11" class="edge">
<title>step_leader&#45;&gt;append_entry</title>
<path fill="none" stroke="#666666" d="M559.19,-179.09C623.66,-180.42 758.09,-184.62 871,-197.5 904.52,-201.32 941.78,-207.77 971.31,-213.41"/>
<polygon fill="#666666" stroke="#666666" points="970.93,-216.9 981.41,-215.36 972.26,-210.02 970.93,-216.9"/>
</g>
<!-- bcast_append -->
<g id="node10" class="node">
<title>bcast_append</title>
<path fill="none" stroke="#1c2123" d="M1349.5,-265.5C1349.5,-265.5 1283.5,-265.5 1283.5,-265.5 1277.5,-265.5 1271.5,-259.5 1271.5,-253.5 1271.5,-253.5 1271.5,-241.5 1271.5,-241.5 1271.5,-235.5 1277.5,-229.5 1283.5,-229.5 1283.5,-229.5 1349.5,-229.5 1349.5,-229.5 1355.5,-229.5 1361.5,-235.5 1361.5,-241.5 1361.5,-241.5 1361.5,-253.5 1361.5,-253.5 1361.5,-259.5 1355.5,-265.5 1349.5,-265.5"/>
<text text-anchor="middle" x="1316.5" y="-243.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">bcast_append</text>
</g>
<!-- step_leader&#45;&gt;bcast_append -->
<g id="edge12" class="edge">
<title>step_leader&#45;&gt;bcast_append</title>
<path fill="none" stroke="#666666" d="M532.9,-196.64C545.78,-214.44 568.12,-240.47 595,-251.5 821.57,-344.44 901.13,-254.39 1146,-251.5 1184.38,-251.05 1227.63,-250.02 1260.84,-249.12"/>
<polygon fill="#666666" stroke="#666666" points="1261.35,-252.6 1271.25,-248.83 1261.16,-245.61 1261.35,-252.6"/>
</g>
<!-- pending_conf_index -->
<g id="node11" class="node">
<title>pending_conf_index</title>
<path fill="#feed9b" stroke="#f7e495" d="M919,-23C919,-23 1134,-23 1134,-23 1140,-23 1146,-29 1146,-35 1146,-35 1146,-110 1146,-110 1146,-116 1140,-122 1134,-122 1134,-122 919,-122 919,-122 913,-122 907,-116 907,-110 907,-110 907,-35 907,-35 907,-29 913,-23 919,-23"/>
<text text-anchor="middle" x="1026.5" y="-106.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pending_conf_index</text>
<polyline fill="none" stroke="#f7e495" points="907,-99 1146,-99 "/>
<text text-anchor="start" x="915" y="-83.8" font-family="Times,serif" font-size="14.00" fill="#40575d">此处修改了pending_conf_index</text>
<text text-anchor="middle" x="1026.5" y="-68.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> ，在后面commit_apply时会用到</text>
<polyline fill="none" stroke="#f7e495" points="907,-61 1146,-61 "/>
<text text-anchor="start" x="915" y="-45.8" font-family="Times,serif" font-size="14.00" fill="#40575d">self.pending_conf_index =</text>
<text text-anchor="start" x="915" y="-30.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> self.raft_log.last_index() + i as u64 + 1;</text>
</g>
<!-- step_leader&#45;&gt;pending_conf_index -->
<g id="edge13" class="edge">
<title>step_leader&#45;&gt;pending_conf_index</title>
<path fill="none" stroke="#666666" d="M525.8,-160.14C534.32,-131.74 555.08,-78.07 595,-55.5 686.16,-3.96 806.36,-13.88 896.58,-33.45"/>
<polygon fill="#666666" stroke="#666666" points="896.08,-36.92 906.6,-35.68 897.6,-30.09 896.08,-36.92"/>
</g>
<!-- step&#45;&gt;step_leader -->
<g id="edge8" class="edge">
<title>step&#45;&gt;step_leader</title>
<path fill="none" stroke="#666666" d="M430.77,-157.69C442.67,-160.5 457.13,-163.91 470.86,-167.15"/>
<polygon fill="#666666" stroke="#666666" points="470.16,-170.58 480.69,-169.47 471.76,-163.77 470.16,-170.58"/>
</g>
<!-- merge_from_bytes&#45;&gt;append_entry -->
<g id="edge16" class="edge">
<title>merge_from_bytes&#45;&gt;append_entry</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M793.34,-224.5C845.51,-224.5 920.8,-224.5 971.36,-224.5"/>
<polygon fill="green" stroke="green" points="971.44,-228 981.44,-224.5 971.44,-221 971.44,-228"/>
</g>
<!-- has_pending_conf&#45;&gt;pending_conf_index -->
<g id="edge14" class="edge">
<title>has_pending_conf&#45;&gt;pending_conf_index</title>
<path fill="none" stroke="#666666" d="M871.21,-91.02C879.61,-90.02 888.05,-89 896.41,-88"/>
<polygon fill="#666666" stroke="#666666" points="897.06,-91.45 906.57,-86.78 896.22,-84.5 897.06,-91.45"/>
</g>
<!-- append_entry&#45;&gt;bcast_append -->
<g id="edge17" class="edge">
<title>append_entry&#45;&gt;bcast_append</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1071.55,-228.02C1122.48,-232.09 1206.31,-238.78 1261.21,-243.16"/>
<polygon fill="green" stroke="green" points="1261.2,-246.67 1271.45,-243.98 1261.76,-239.7 1261.2,-246.67"/>
</g>
<!-- commit_apply -->
<g id="node12" class="node">
<title>commit_apply</title>
<path fill="none" stroke="#1c2123" d="M1194,-0.5C1194,-0.5 1439,-0.5 1439,-0.5 1445,-0.5 1451,-6.5 1451,-12.5 1451,-12.5 1451,-132.5 1451,-132.5 1451,-138.5 1445,-144.5 1439,-144.5 1439,-144.5 1194,-144.5 1194,-144.5 1188,-144.5 1182,-138.5 1182,-132.5 1182,-132.5 1182,-12.5 1182,-12.5 1182,-6.5 1188,-0.5 1194,-0.5"/>
<text text-anchor="middle" x="1316.5" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit_apply</text>
<polyline fill="none" stroke="#1c2123" points="1182,-121.5 1451,-121.5 "/>
<text text-anchor="start" x="1190" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader节点在commit_apply时, </text>
<text text-anchor="start" x="1190" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送emty EntryConfChangeV2消息</text>
<polyline fill="none" stroke="#1c2123" points="1182,-83.5 1451,-83.5 "/>
<text text-anchor="start" x="1190" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">let old_applied = self.raft_log.applied;</text>
<text text-anchor="start" x="1190" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> if self.prs.conf().auto_leave</text>
<text text-anchor="start" x="1190" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &amp;&amp; old_applied &lt;= self.pending_conf_index</text>
<text text-anchor="start" x="1190" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &amp;&amp; applied &gt;= self.pending_conf_index</text>
<text text-anchor="start" x="1190" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &amp;&amp; self.state == StateRole::Leader</text>
</g>
<!-- pending_conf_index&#45;&gt;commit_apply -->
<g id="edge15" class="edge">
<title>pending_conf_index&#45;&gt;commit_apply</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1146.3,-72.5C1154.77,-72.5 1163.35,-72.5 1171.93,-72.5"/>
<polygon fill="green" stroke="green" points="1172,-76 1182,-72.5 1172,-69 1172,-76"/>
</g>
</g>
</svg>
