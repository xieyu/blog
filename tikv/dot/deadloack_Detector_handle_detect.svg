<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handle_detect Pages: 1 -->
<svg width="1613pt" height="616pt"
 viewBox="0.00 0.00 1613.00 615.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 611.5)">
<title>handle_detect</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-611.5 1609,-611.5 1609,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_DetectTable</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M567,-55.5C567,-55.5 1342,-55.5 1342,-55.5 1348,-55.5 1354,-61.5 1354,-67.5 1354,-67.5 1354,-437.5 1354,-437.5 1354,-443.5 1348,-449.5 1342,-449.5 1342,-449.5 567,-449.5 567,-449.5 561,-449.5 555,-443.5 555,-437.5 555,-437.5 555,-67.5 555,-67.5 555,-61.5 561,-55.5 567,-55.5"/>
<text text-anchor="middle" x="954.5" y="-429.5" font-family="Times,serif" font-size="20.00">DetectTable</text>
</g>
<!-- DetectTable_detect -->
<g id="node1" class="node">
<title>DetectTable_detect</title>
<path fill="none" stroke="#1c2123" d="M615.5,-272C615.5,-272 764.5,-272 764.5,-272 770.5,-272 776.5,-278 776.5,-284 776.5,-284 776.5,-351 776.5,-351 776.5,-357 770.5,-363 764.5,-363 764.5,-363 615.5,-363 615.5,-363 609.5,-363 603.5,-357 603.5,-351 603.5,-351 603.5,-284 603.5,-284 603.5,-278 609.5,-272 615.5,-272"/>
<text text-anchor="middle" x="690" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">DetectTable::detect</text>
<polyline fill="none" stroke="#1c2123" points="603.5,-340 776.5,-340 "/>
<text text-anchor="start" x="611.5" y="-324.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理Detect类型的请求</text>
<text text-anchor="start" x="611.5" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn_ts, lock_ts, lock_hash</text>
<text text-anchor="start" x="611.5" y="-294.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果不会deadlock,则将边</text>
<text text-anchor="start" x="611.5" y="-279.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 加入wait_for_map中</text>
</g>
<!-- active_expire -->
<g id="node4" class="node">
<title>active_expire</title>
<path fill="none" stroke="#1c2123" d="M923,-64C923,-64 1033,-64 1033,-64 1039,-64 1045,-70 1045,-76 1045,-76 1045,-113 1045,-113 1045,-119 1039,-125 1033,-125 1033,-125 923,-125 923,-125 917,-125 911,-119 911,-113 911,-113 911,-76 911,-76 911,-70 917,-64 923,-64"/>
<text text-anchor="middle" x="978" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.active_expire</text>
<polyline fill="none" stroke="#1c2123" points="911,-102 1045,-102 "/>
<text text-anchor="start" x="919" y="-86.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历整个map</text>
<text text-anchor="start" x="919" y="-71.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 清理掉过期的entry</text>
</g>
<!-- DetectTable_detect&#45;&gt;active_expire -->
<g id="edge1" class="edge">
<title>DetectTable_detect&#45;&gt;active_expire</title>
<path fill="none" stroke="#666666" d="M776.81,-292.36C791.82,-284.76 806.09,-275 817,-262.5 855.58,-218.3 812.42,-177.87 853,-135.5 865.9,-122.03 883.32,-112.98 901.01,-106.91"/>
<polygon fill="#666666" stroke="#666666" points="902.35,-110.16 910.84,-103.83 900.26,-103.48 902.35,-110.16"/>
</g>
<!-- register_if_existed -->
<g id="node5" class="node">
<title>register_if_existed</title>
<path fill="none" stroke="#1c2123" d="M865,-144.5C865,-144.5 1091,-144.5 1091,-144.5 1097,-144.5 1103,-150.5 1103,-156.5 1103,-156.5 1103,-208.5 1103,-208.5 1103,-214.5 1097,-220.5 1091,-220.5 1091,-220.5 865,-220.5 865,-220.5 859,-220.5 853,-214.5 853,-208.5 853,-208.5 853,-156.5 853,-156.5 853,-150.5 859,-144.5 865,-144.5"/>
<text text-anchor="middle" x="978" y="-205.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">2.register_if_existed</text>
<polyline fill="none" stroke="#1c2123" points="853,-197.5 1103,-197.5 "/>
<text text-anchor="start" x="861" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">插入txn_ts =&gt;(lock_ts =&gt; lock_hash)</text>
<text text-anchor="start" x="861" y="-167.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> wait_for_map中已存在txn_ts =&gt; lock_ts</text>
<text text-anchor="start" x="861" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 不会导致死锁</text>
</g>
<!-- DetectTable_detect&#45;&gt;register_if_existed -->
<g id="edge2" class="edge">
<title>DetectTable_detect&#45;&gt;register_if_existed</title>
<path fill="none" stroke="#666666" d="M776.6,-284.51C790.49,-277.93 804.43,-270.54 817,-262.5 835.03,-250.96 834.73,-241.65 853,-230.5 855.86,-228.76 858.79,-227.06 861.78,-225.4"/>
<polygon fill="#666666" stroke="#666666" points="863.7,-228.34 870.89,-220.57 860.42,-222.16 863.7,-228.34"/>
</g>
<!-- do_detect -->
<g id="node6" class="node">
<title>do_detect</title>
<path fill="none" stroke="#1c2123" d="M879.5,-240C879.5,-240 1076.5,-240 1076.5,-240 1082.5,-240 1088.5,-246 1088.5,-252 1088.5,-252 1088.5,-289 1088.5,-289 1088.5,-295 1082.5,-301 1076.5,-301 1076.5,-301 879.5,-301 879.5,-301 873.5,-301 867.5,-295 867.5,-289 867.5,-289 867.5,-252 867.5,-252 867.5,-246 873.5,-240 879.5,-240"/>
<text text-anchor="middle" x="978" y="-285.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">3.do_detect</text>
<polyline fill="none" stroke="#1c2123" points="867.5,-278 1088.5,-278 "/>
<text text-anchor="start" x="875.5" y="-262.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查如果加了txn_ts =&gt; Lock_ts 边</text>
<text text-anchor="start" x="875.5" y="-247.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> DAG依赖是否有环</text>
</g>
<!-- DetectTable_detect&#45;&gt;do_detect -->
<g id="edge3" class="edge">
<title>DetectTable_detect&#45;&gt;do_detect</title>
<path fill="none" stroke="#666666" d="M776.81,-303.4C802.16,-299.23 830.38,-294.59 857.45,-290.15"/>
<polygon fill="#666666" stroke="#666666" points="858.07,-293.59 867.37,-288.52 856.93,-286.68 858.07,-293.59"/>
</g>
<!-- register -->
<g id="node7" class="node">
<title>register</title>
<path fill="none" stroke="#1c2123" d="M877.5,-320C877.5,-320 1078.5,-320 1078.5,-320 1084.5,-320 1090.5,-326 1090.5,-332 1090.5,-332 1090.5,-399 1090.5,-399 1090.5,-405 1084.5,-411 1078.5,-411 1078.5,-411 877.5,-411 877.5,-411 871.5,-411 865.5,-405 865.5,-399 865.5,-399 865.5,-332 865.5,-332 865.5,-326 871.5,-320 877.5,-320"/>
<text text-anchor="middle" x="978" y="-395.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">4.register</text>
<polyline fill="none" stroke="#1c2123" points="865.5,-388 1090.5,-388 "/>
<text text-anchor="start" x="873.5" y="-372.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">插入txn_ts =&gt;(lock_ts =&gt; lock_hash)</text>
<text text-anchor="start" x="873.5" y="-357.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 到wait_for_map中</text>
<text text-anchor="start" x="873.5" y="-342.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn_ts =&gt; lock_ts这个</text>
<text text-anchor="start" x="873.5" y="-327.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entry应该不存在</text>
</g>
<!-- DetectTable_detect&#45;&gt;register -->
<g id="edge4" class="edge">
<title>DetectTable_detect&#45;&gt;register</title>
<path fill="none" stroke="#666666" d="M776.81,-331.9C801.47,-336.04 828.84,-340.63 855.23,-345.06"/>
<polygon fill="#666666" stroke="#666666" points="854.84,-348.55 865.28,-346.75 856,-341.64 854.84,-348.55"/>
</g>
<!-- WaiterMgrScheduler_deadlock -->
<g id="node15" class="node">
<title>WaiterMgrScheduler_deadlock</title>
<path fill="none" stroke="#1c2123" d="M896,-458C896,-458 1060,-458 1060,-458 1066,-458 1072,-464 1072,-470 1072,-470 1072,-507 1072,-507 1072,-513 1066,-519 1060,-519 1060,-519 896,-519 896,-519 890,-519 884,-513 884,-507 884,-507 884,-470 884,-470 884,-464 890,-458 896,-458"/>
<text text-anchor="middle" x="978" y="-503.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">WaiterMgrScheduler::deadlock</text>
<polyline fill="none" stroke="#1c2123" points="884,-496 1072,-496 "/>
<text text-anchor="start" x="892" y="-480.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送Task::Deadlock到</text>
<text text-anchor="start" x="892" y="-465.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> WaiterManager channel</text>
</g>
<!-- DetectTable_detect&#45;&gt;WaiterMgrScheduler_deadlock -->
<g id="edge18" class="edge">
<title>DetectTable_detect&#45;&gt;WaiterMgrScheduler_deadlock</title>
<path fill="none" stroke="#666666" d="M734.65,-363.09C765.26,-392.67 808.53,-429.97 853,-453.5 859.81,-457.1 867.04,-460.37 874.44,-463.33"/>
<polygon fill="#666666" stroke="#666666" points="873.3,-466.64 883.89,-466.91 875.78,-460.1 873.3,-466.64"/>
</g>
<!-- DetectTable_clean_up_wait_for -->
<g id="node2" class="node">
<title>DetectTable_clean_up_wait_for</title>
<path fill="none" stroke="#1c2123" d="M575,-168.5C575,-168.5 805,-168.5 805,-168.5 811,-168.5 817,-174.5 817,-180.5 817,-180.5 817,-240.5 817,-240.5 817,-246.5 811,-252.5 805,-252.5 805,-252.5 575,-252.5 575,-252.5 569,-252.5 563,-246.5 563,-240.5 563,-240.5 563,-180.5 563,-180.5 563,-174.5 569,-168.5 575,-168.5"/>
<text text-anchor="middle" x="690" y="-237.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">DetectTable::clean_up_wait_for</text>
<polyline fill="none" stroke="#1c2123" points="563,-229.5 817,-229.5 "/>
<text text-anchor="start" x="571" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理CleanUpWaitFor类型的请求</text>
<polyline fill="none" stroke="#1c2123" points="563,-206.5 817,-206.5 "/>
<text text-anchor="start" x="571" y="-191.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从wait_for_map中删除</text>
<text text-anchor="middle" x="690" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn =&gt; lock_ts =&gt; lock_hash 的这个entry</text>
</g>
<!-- DetectTable_clean_up -->
<g id="node3" class="node">
<title>DetectTable_clean_up</title>
<path fill="none" stroke="#1c2123" d="M623,-65.5C623,-65.5 757,-65.5 757,-65.5 763,-65.5 769,-71.5 769,-77.5 769,-77.5 769,-137.5 769,-137.5 769,-143.5 763,-149.5 757,-149.5 757,-149.5 623,-149.5 623,-149.5 617,-149.5 611,-143.5 611,-137.5 611,-137.5 611,-77.5 611,-77.5 611,-71.5 617,-65.5 623,-65.5"/>
<text text-anchor="middle" x="690" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">DetectTable_clean_up</text>
<polyline fill="none" stroke="#1c2123" points="611,-126.5 769,-126.5 "/>
<text text-anchor="start" x="619" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理cleanup类型的请求</text>
<polyline fill="none" stroke="#1c2123" points="611,-103.5 769,-103.5 "/>
<text text-anchor="start" x="619" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从wait_for_map中删掉</text>
<text text-anchor="start" x="619" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn这个entry</text>
</g>
<!-- Locks_is_expired -->
<g id="node9" class="node">
<title>Locks_is_expired</title>
<path fill="none" stroke="#1c2123" d="M1180,-71.5C1180,-71.5 1305,-71.5 1305,-71.5 1311,-71.5 1317,-77.5 1317,-83.5 1317,-83.5 1317,-105.5 1317,-105.5 1317,-111.5 1311,-117.5 1305,-117.5 1305,-117.5 1180,-117.5 1180,-117.5 1174,-117.5 1168,-111.5 1168,-105.5 1168,-105.5 1168,-83.5 1168,-83.5 1168,-77.5 1174,-71.5 1180,-71.5"/>
<text text-anchor="middle" x="1242.5" y="-102.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Locks::is_expired</text>
<polyline fill="none" stroke="#1c2123" points="1168,-94.5 1317,-94.5 "/>
<text text-anchor="start" x="1176" y="-79.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查Locks是否过期了</text>
</g>
<!-- active_expire&#45;&gt;Locks_is_expired -->
<g id="edge10" class="edge">
<title>active_expire&#45;&gt;Locks_is_expired</title>
<path fill="none" stroke="#666666" d="M1045.24,-94.5C1079.39,-94.5 1121.4,-94.5 1157.78,-94.5"/>
<polygon fill="#666666" stroke="#666666" points="1157.88,-98 1167.88,-94.5 1157.88,-91 1157.88,-98"/>
</g>
<!-- wait_for_map -->
<g id="node8" class="node">
<title>wait_for_map</title>
<path fill="#feed9b" stroke="#f7e495" d="M1151,-221C1151,-221 1334,-221 1334,-221 1340,-221 1346,-227 1346,-233 1346,-233 1346,-308 1346,-308 1346,-314 1340,-320 1334,-320 1334,-320 1151,-320 1151,-320 1145,-320 1139,-314 1139,-308 1139,-308 1139,-233 1139,-233 1139,-227 1145,-221 1151,-221"/>
<text text-anchor="middle" x="1242.5" y="-304.8" font-family="Times,serif" font-size="14.00" fill="#40575d">wait_for_map</text>
<polyline fill="none" stroke="#f7e495" points="1139,-297 1346,-297 "/>
<text text-anchor="start" x="1147" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#40575d">HashMap&lt;TimeStamp,</text>
<text text-anchor="start" x="1147" y="-266.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> HashMap&lt;TimeStamp, Locks&gt;&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="1139,-259 1346,-259 "/>
<text text-anchor="start" x="1147" y="-243.8" font-family="Times,serif" font-size="14.00" fill="#40575d">保存了事务的依赖DAG图</text>
<text text-anchor="start" x="1147" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> txn_ts =&gt; (lock_ts =&gt; Locks)</text>
</g>
<!-- register_if_existed&#45;&gt;wait_for_map -->
<g id="edge7" class="edge">
<title>register_if_existed&#45;&gt;wait_for_map</title>
<path fill="none" stroke="#666666" d="M1092.61,-220.59C1104.75,-224.65 1117.09,-228.79 1129.21,-232.86"/>
<polygon fill="#666666" stroke="#666666" points="1128.28,-236.24 1138.87,-236.1 1130.5,-229.6 1128.28,-236.24"/>
</g>
<!-- do_detect&#45;&gt;wait_for_map -->
<g id="edge5" class="edge">
<title>do_detect&#45;&gt;wait_for_map</title>
<path fill="none" stroke="#666666" d="M1088.8,-270.5C1102.01,-270.5 1115.52,-270.5 1128.77,-270.5"/>
<polygon fill="#666666" stroke="#666666" points="1128.85,-274 1138.85,-270.5 1128.85,-267 1128.85,-274"/>
</g>
<!-- register&#45;&gt;wait_for_map -->
<g id="edge6" class="edge">
<title>register&#45;&gt;wait_for_map</title>
<path fill="none" stroke="#666666" d="M1090.7,-325.07C1103.38,-320.49 1116.31,-315.81 1128.99,-311.22"/>
<polygon fill="#666666" stroke="#666666" points="1130.43,-314.42 1138.64,-307.73 1128.05,-307.84 1130.43,-314.42"/>
</g>
<!-- Detector_run -->
<g id="node10" class="node">
<title>Detector_run</title>
<path fill="none" stroke="#1c2123" d="M12,-22C12,-22 150,-22 150,-22 156,-22 162,-28 162,-34 162,-34 162,-71 162,-71 162,-77 156,-83 150,-83 150,-83 12,-83 12,-83 6,-83 0,-77 0,-71 0,-71 0,-34 0,-34 0,-28 6,-22 12,-22"/>
<text text-anchor="middle" x="81" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Detector::run</text>
<polyline fill="none" stroke="#1c2123" points="0,-60 162,-60 "/>
<text text-anchor="start" x="8" y="-44.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从Future channel中取task</text>
<text text-anchor="start" x="8" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并执行</text>
</g>
<!-- handle_detect -->
<g id="node11" class="node">
<title>handle_detect</title>
<path fill="none" stroke="#1c2123" d="M210,-59.5C210,-59.5 335,-59.5 335,-59.5 341,-59.5 347,-65.5 347,-71.5 347,-71.5 347,-93.5 347,-93.5 347,-99.5 341,-105.5 335,-105.5 335,-105.5 210,-105.5 210,-105.5 204,-105.5 198,-99.5 198,-93.5 198,-93.5 198,-71.5 198,-71.5 198,-65.5 204,-59.5 210,-59.5"/>
<text text-anchor="middle" x="272.5" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_detect</text>
<polyline fill="none" stroke="#1c2123" points="198,-82.5 347,-82.5 "/>
<text text-anchor="start" x="206" y="-67.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理自己的detect请求</text>
</g>
<!-- Detector_run&#45;&gt;handle_detect -->
<g id="edge8" class="edge">
<title>Detector_run&#45;&gt;handle_detect</title>
<path fill="none" stroke="#666666" d="M162.09,-65.18C170.58,-66.52 179.24,-67.89 187.78,-69.25"/>
<polygon fill="#666666" stroke="#666666" points="187.3,-72.71 197.72,-70.82 188.39,-65.8 187.3,-72.71"/>
</g>
<!-- handle_detect_rpc -->
<g id="node12" class="node">
<title>handle_detect_rpc</title>
<path fill="none" stroke="#1c2123" d="M600.5,-0.5C600.5,-0.5 779.5,-0.5 779.5,-0.5 785.5,-0.5 791.5,-6.5 791.5,-12.5 791.5,-12.5 791.5,-34.5 791.5,-34.5 791.5,-40.5 785.5,-46.5 779.5,-46.5 779.5,-46.5 600.5,-46.5 600.5,-46.5 594.5,-46.5 588.5,-40.5 588.5,-34.5 588.5,-34.5 588.5,-12.5 588.5,-12.5 588.5,-6.5 594.5,-0.5 600.5,-0.5"/>
<text text-anchor="middle" x="690" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_detect_rpc</text>
<polyline fill="none" stroke="#1c2123" points="588.5,-23.5 791.5,-23.5 "/>
<text text-anchor="middle" x="690" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理其他node发来的detect请求</text>
</g>
<!-- Detector_run&#45;&gt;handle_detect_rpc -->
<g id="edge9" class="edge">
<title>Detector_run&#45;&gt;handle_detect_rpc</title>
<path fill="none" stroke="#666666" d="M162.29,-48.66C268.98,-43.57 457.95,-34.54 578.16,-28.8"/>
<polygon fill="#666666" stroke="#666666" points="578.67,-32.28 588.49,-28.3 578.34,-25.28 578.67,-32.28"/>
</g>
<!-- send_request_to_leader -->
<g id="node13" class="node">
<title>send_request_to_leader</title>
<path fill="none" stroke="#1c2123" d="M395,-52C395,-52 515,-52 515,-52 521,-52 527,-58 527,-64 527,-64 527,-101 527,-101 527,-107 521,-113 515,-113 515,-113 395,-113 395,-113 389,-113 383,-107 383,-101 383,-101 383,-64 383,-64 383,-58 389,-52 395,-52"/>
<text text-anchor="middle" x="455" y="-97.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_request_to_leader</text>
<polyline fill="none" stroke="#1c2123" points="383,-90 527,-90 "/>
<text text-anchor="start" x="391" y="-74.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">自己不是leader</text>
<text text-anchor="middle" x="455" y="-59.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将请求转发给leader</text>
</g>
<!-- handle_detect&#45;&gt;send_request_to_leader -->
<g id="edge12" class="edge">
<title>handle_detect&#45;&gt;send_request_to_leader</title>
<path fill="none" stroke="#666666" d="M347.18,-82.5C355.56,-82.5 364.15,-82.5 372.62,-82.5"/>
<polygon fill="#666666" stroke="#666666" points="372.89,-86 382.89,-82.5 372.89,-79 372.89,-86"/>
</g>
<!-- handle_detect_locally -->
<g id="node14" class="node">
<title>handle_detect_locally</title>
<path fill="none" stroke="#1c2123" d="M398,-180C398,-180 512,-180 512,-180 518,-180 524,-186 524,-192 524,-192 524,-229 524,-229 524,-235 518,-241 512,-241 512,-241 398,-241 398,-241 392,-241 386,-235 386,-229 386,-229 386,-192 386,-192 386,-186 392,-180 398,-180"/>
<text text-anchor="middle" x="455" y="-225.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_detect_locally</text>
<polyline fill="none" stroke="#1c2123" points="386,-218 524,-218 "/>
<text text-anchor="start" x="394" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">自己是leader</text>
<text text-anchor="start" x="394" y="-187.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 直接处理detect请求</text>
</g>
<!-- handle_detect&#45;&gt;handle_detect_locally -->
<g id="edge13" class="edge">
<title>handle_detect&#45;&gt;handle_detect_locally</title>
<path fill="none" stroke="#666666" d="M306.19,-105.68C332.93,-124.65 371.25,-151.82 402.17,-173.75"/>
<polygon fill="#666666" stroke="#666666" points="400.5,-176.85 410.68,-179.78 404.55,-171.14 400.5,-176.85"/>
</g>
<!-- send_request_to_leader&#45;&gt;handle_detect_rpc -->
<g id="edge11" class="edge">
<title>send_request_to_leader&#45;&gt;handle_detect_rpc</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M527.14,-59.31C536.47,-56.54 545.94,-53.86 555,-51.5 562.52,-49.54 570.3,-47.63 578.16,-45.78"/>
<polygon fill="green" stroke="green" points="579.19,-49.13 588.14,-43.47 577.61,-42.31 579.19,-49.13"/>
</g>
<!-- handle_detect_locally&#45;&gt;DetectTable_detect -->
<g id="edge14" class="edge">
<title>handle_detect_locally&#45;&gt;DetectTable_detect</title>
<path fill="none" stroke="#666666" d="M512.08,-241.13C525.98,-248.39 540.93,-255.93 555,-262.5 567.47,-268.32 580.73,-274.16 593.88,-279.75"/>
<polygon fill="#666666" stroke="#666666" points="592.84,-283.12 603.41,-283.78 595.56,-276.67 592.84,-283.12"/>
</g>
<!-- handle_detect_locally&#45;&gt;DetectTable_clean_up_wait_for -->
<g id="edge15" class="edge">
<title>handle_detect_locally&#45;&gt;DetectTable_clean_up_wait_for</title>
<path fill="none" stroke="#666666" d="M524.02,-210.5C533.09,-210.5 542.64,-210.5 552.38,-210.5"/>
<polygon fill="#666666" stroke="#666666" points="552.6,-214 562.6,-210.5 552.6,-207 552.6,-214"/>
</g>
<!-- handle_detect_locally&#45;&gt;DetectTable_clean_up -->
<g id="edge16" class="edge">
<title>handle_detect_locally&#45;&gt;DetectTable_clean_up</title>
<path fill="none" stroke="#666666" d="M512.82,-179.93C526.5,-172.93 541.16,-165.73 555,-159.5 569.79,-152.84 585.71,-146.21 601.24,-140.03"/>
<polygon fill="#666666" stroke="#666666" points="602.82,-143.16 610.83,-136.23 600.25,-136.65 602.82,-143.16"/>
</g>
<!-- handle_detect_locally&#45;&gt;WaiterMgrScheduler_deadlock -->
<g id="edge17" class="edge">
<title>handle_detect_locally&#45;&gt;WaiterMgrScheduler_deadlock</title>
<path fill="none" stroke="#666666" d="M458.53,-241.25C464.71,-294.38 485.6,-402.54 555,-453.5 646.62,-520.77 781.51,-519.55 873.97,-508.03"/>
<polygon fill="#666666" stroke="#666666" points="874.45,-511.5 883.91,-506.74 873.54,-504.56 874.45,-511.5"/>
</g>
<!-- WaiterManager_handle_deadlock -->
<g id="node16" class="node">
<title>WaiterManager_handle_deadlock</title>
<path fill="none" stroke="#1c2123" d="M1154,-458.5C1154,-458.5 1331,-458.5 1331,-458.5 1337,-458.5 1343,-464.5 1343,-470.5 1343,-470.5 1343,-522.5 1343,-522.5 1343,-528.5 1337,-534.5 1331,-534.5 1331,-534.5 1154,-534.5 1154,-534.5 1148,-534.5 1142,-528.5 1142,-522.5 1142,-522.5 1142,-470.5 1142,-470.5 1142,-464.5 1148,-458.5 1154,-458.5"/>
<text text-anchor="middle" x="1242.5" y="-519.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WaiterManager::handle_deadlock</text>
<polyline fill="none" stroke="#1c2123" points="1142,-511.5 1343,-511.5 "/>
<text text-anchor="start" x="1150" y="-496.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将死锁的lock, waiter_ts从</text>
<text text-anchor="start" x="1150" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等待队列中取出来</text>
<text text-anchor="start" x="1150" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并通知waiter_ts死锁了</text>
</g>
<!-- WaiterMgrScheduler_deadlock&#45;&gt;WaiterManager_handle_deadlock -->
<g id="edge19" class="edge">
<title>WaiterMgrScheduler_deadlock&#45;&gt;WaiterManager_handle_deadlock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1072.29,-491.34C1091.49,-491.93 1111.87,-492.55 1131.6,-493.15"/>
<polygon fill="green" stroke="green" points="1131.74,-496.66 1141.84,-493.46 1131.95,-489.66 1131.74,-496.66"/>
</g>
<!-- WaitTable_remove_waiter -->
<g id="node17" class="node">
<title>WaitTable_remove_waiter</title>
<path fill="none" stroke="#1c2123" d="M1424,-546C1424,-546 1563,-546 1563,-546 1569,-546 1575,-552 1575,-558 1575,-558 1575,-595 1575,-595 1575,-601 1569,-607 1563,-607 1563,-607 1424,-607 1424,-607 1418,-607 1412,-601 1412,-595 1412,-595 1412,-558 1412,-558 1412,-552 1418,-546 1424,-546"/>
<text text-anchor="middle" x="1493.5" y="-591.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">WaitTable::remove_waiter</text>
<polyline fill="none" stroke="#1c2123" points="1412,-584 1575,-584 "/>
<text text-anchor="start" x="1420" y="-568.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将死锁的wait_ts从</text>
<text text-anchor="start" x="1420" y="-553.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等待队列取出</text>
</g>
<!-- WaiterManager_handle_deadlock&#45;&gt;WaitTable_remove_waiter -->
<g id="edge20" class="edge">
<title>WaiterManager_handle_deadlock&#45;&gt;WaitTable_remove_waiter</title>
<path fill="none" stroke="#666666" d="M1343.34,-528.58C1362.79,-534.83 1383.07,-541.34 1402.19,-547.48"/>
<polygon fill="#666666" stroke="#666666" points="1401.17,-550.83 1411.76,-550.56 1403.31,-544.17 1401.17,-550.83"/>
</g>
<!-- waiter_deadlock_with -->
<g id="node18" class="node">
<title>waiter_deadlock_with</title>
<path fill="none" stroke="#1c2123" d="M1394,-466C1394,-466 1593,-466 1593,-466 1599,-466 1605,-472 1605,-478 1605,-478 1605,-515 1605,-515 1605,-521 1599,-527 1593,-527 1593,-527 1394,-527 1394,-527 1388,-527 1382,-521 1382,-515 1382,-515 1382,-478 1382,-478 1382,-472 1388,-466 1394,-466"/>
<text text-anchor="middle" x="1493.5" y="-511.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Waiter::deadlock_with</text>
<polyline fill="none" stroke="#1c2123" points="1382,-504 1605,-504 "/>
<text text-anchor="start" x="1390" y="-488.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备pr为MvccErrorInner::DeadLock</text>
<text text-anchor="start" x="1390" y="-473.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 包含了deadlock_key_hash</text>
</g>
<!-- WaiterManager_handle_deadlock&#45;&gt;waiter_deadlock_with -->
<g id="edge21" class="edge">
<title>WaiterManager_handle_deadlock&#45;&gt;waiter_deadlock_with</title>
<path fill="none" stroke="#666666" d="M1343.34,-496.5C1352.58,-496.5 1362.01,-496.5 1371.42,-496.5"/>
<polygon fill="#666666" stroke="#666666" points="1371.6,-500 1381.6,-496.5 1371.6,-493 1371.6,-500"/>
</g>
<!-- waiter_notify -->
<g id="node19" class="node">
<title>waiter_notify</title>
<path fill="none" stroke="#1c2123" d="M1423.5,-386C1423.5,-386 1563.5,-386 1563.5,-386 1569.5,-386 1575.5,-392 1575.5,-398 1575.5,-398 1575.5,-435 1575.5,-435 1575.5,-441 1569.5,-447 1563.5,-447 1563.5,-447 1423.5,-447 1423.5,-447 1417.5,-447 1411.5,-441 1411.5,-435 1411.5,-435 1411.5,-398 1411.5,-398 1411.5,-392 1417.5,-386 1423.5,-386"/>
<text text-anchor="middle" x="1493.5" y="-431.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Waiter::notify</text>
<polyline fill="none" stroke="#1c2123" points="1411.5,-424 1575.5,-424 "/>
<text text-anchor="start" x="1419.5" y="-408.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.去掉timeout定时器</text>
<text text-anchor="start" x="1419.5" y="-393.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.调用waiter的回调函数</text>
</g>
<!-- WaiterManager_handle_deadlock&#45;&gt;waiter_notify -->
<g id="edge22" class="edge">
<title>WaiterManager_handle_deadlock&#45;&gt;waiter_notify</title>
<path fill="none" stroke="#666666" d="M1343.34,-464.42C1362.67,-458.21 1382.83,-451.74 1401.84,-445.63"/>
<polygon fill="#666666" stroke="#666666" points="1402.92,-448.96 1411.37,-442.56 1400.78,-442.29 1402.92,-448.96"/>
</g>
</g>
</svg>
