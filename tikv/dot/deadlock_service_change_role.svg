<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: deadlock_service_change_role Pages: 1 -->
<svg width="1160pt" height="322pt"
 viewBox="0.00 0.00 1160.00 322.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 318)">
<title>deadlock_service_change_role</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-318 1156,-318 1156,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RoleChangeNotifier</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M245,-23C245,-23 397,-23 397,-23 403,-23 409,-29 409,-35 409,-35 409,-199 409,-199 409,-205 403,-211 397,-211 397,-211 245,-211 245,-211 239,-211 233,-205 233,-199 233,-199 233,-35 233,-35 233,-29 239,-23 245,-23"/>
<text text-anchor="middle" x="321" y="-191" font-family="Times,serif" font-size="20.00">RoleChangeNotifier</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_RaftStore</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-8C20,-8 201,-8 201,-8 207,-8 213,-14 213,-20 213,-20 213,-294 213,-294 213,-300 207,-306 201,-306 201,-306 20,-306 20,-306 14,-306 8,-300 8,-294 8,-294 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="110.5" y="-286" font-family="Times,serif" font-size="20.00">RaftStore</text>
</g>
<!-- on_region_changed -->
<g id="node1" class="node">
<title>on_region_changed</title>
<path fill="none" stroke="#1c2123" d="M267.5,-111.5C267.5,-111.5 374.5,-111.5 374.5,-111.5 380.5,-111.5 386.5,-117.5 386.5,-123.5 386.5,-123.5 386.5,-160.5 386.5,-160.5 386.5,-166.5 380.5,-172.5 374.5,-172.5 374.5,-172.5 267.5,-172.5 267.5,-172.5 261.5,-172.5 255.5,-166.5 255.5,-160.5 255.5,-160.5 255.5,-123.5 255.5,-123.5 255.5,-117.5 261.5,-111.5 267.5,-111.5"/>
<text text-anchor="middle" x="321" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_region_changed</text>
<polyline fill="none" stroke="#1c2123" points="255.5,-149.5 386.5,-149.5 "/>
<text text-anchor="start" x="263.5" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是leader region</text>
<text text-anchor="start" x="263.5" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发生了改变</text>
</g>
<!-- deadlock_Scheduler_change_role -->
<g id="node8" class="node">
<title>deadlock_Scheduler_change_role</title>
<path fill="none" stroke="#1c2123" d="M449,-60C449,-60 607,-60 607,-60 613,-60 619,-66 619,-72 619,-72 619,-132 619,-132 619,-138 613,-144 607,-144 607,-144 449,-144 449,-144 443,-144 437,-138 437,-132 437,-132 437,-72 437,-72 437,-66 443,-60 449,-60"/>
<text text-anchor="start" x="445" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">deadlock_Scheduler</text>
<polyline fill="none" stroke="#1c2123" points="437,-121 619,-121 "/>
<text text-anchor="start" x="445" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">change_role</text>
<polyline fill="none" stroke="#1c2123" points="437,-98 619,-98 "/>
<text text-anchor="start" x="445" y="-82.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">向channel中放入change_role</text>
<text text-anchor="start" x="445" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> task</text>
</g>
<!-- on_region_changed&#45;&gt;deadlock_Scheduler_change_role -->
<g id="edge6" class="edge">
<title>on_region_changed&#45;&gt;deadlock_Scheduler_change_role</title>
<path fill="none" stroke="#666666" d="M386.58,-129.4C399.43,-126.89 413.19,-124.21 426.91,-121.53"/>
<polygon fill="#666666" stroke="#666666" points="427.72,-124.94 436.86,-119.59 426.38,-118.07 427.72,-124.94"/>
</g>
<!-- on_role_changed -->
<g id="node2" class="node">
<title>on_role_changed</title>
<path fill="none" stroke="#1c2123" d="M257,-31.5C257,-31.5 385,-31.5 385,-31.5 391,-31.5 397,-37.5 397,-43.5 397,-43.5 397,-80.5 397,-80.5 397,-86.5 391,-92.5 385,-92.5 385,-92.5 257,-92.5 257,-92.5 251,-92.5 245,-86.5 245,-80.5 245,-80.5 245,-43.5 245,-43.5 245,-37.5 251,-31.5 257,-31.5"/>
<text text-anchor="middle" x="321" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_role_changed</text>
<polyline fill="none" stroke="#1c2123" points="245,-69.5 397,-69.5 "/>
<text text-anchor="start" x="253" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果leader region的role</text>
<text text-anchor="start" x="253" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发生了改变</text>
</g>
<!-- on_role_changed&#45;&gt;deadlock_Scheduler_change_role -->
<g id="edge7" class="edge">
<title>on_role_changed&#45;&gt;deadlock_Scheduler_change_role</title>
<path fill="none" stroke="#666666" d="M397.17,-76.67C406.85,-78.56 416.89,-80.52 426.9,-82.47"/>
<polygon fill="#666666" stroke="#666666" points="426.39,-85.93 436.88,-84.41 427.73,-79.06 426.39,-85.93"/>
</g>
<!-- PeerFsmDelegate_destroy_peer -->
<g id="node3" class="node">
<title>PeerFsmDelegate_destroy_peer</title>
<path fill="none" stroke="#1c2123" d="M193,-268C193,-268 28,-268 28,-268 22,-268 16,-262 16,-256 16,-256 16,-244 16,-244 16,-238 22,-232 28,-232 28,-232 193,-232 193,-232 199,-232 205,-238 205,-244 205,-244 205,-256 205,-256 205,-262 199,-268 193,-268"/>
<text text-anchor="middle" x="110.5" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate_destroy_peer</text>
</g>
<!-- PeerFsmDelegate_destroy_peer&#45;&gt;on_region_changed -->
<g id="edge1" class="edge">
<title>PeerFsmDelegate_destroy_peer&#45;&gt;on_region_changed</title>
<path fill="none" stroke="#666666" d="M191.27,-231.98C198.76,-229.34 206.12,-226.36 213,-223 236.45,-211.56 259.86,-194.62 278.78,-179.19"/>
<polygon fill="#666666" stroke="#666666" points="281.15,-181.78 286.6,-172.69 276.67,-176.39 281.15,-181.78"/>
</g>
<!-- RaftPollerBuilder_init -->
<g id="node4" class="node">
<title>RaftPollerBuilder_init</title>
<path fill="none" stroke="#1c2123" d="M167,-214C167,-214 54,-214 54,-214 48,-214 42,-208 42,-202 42,-202 42,-190 42,-190 42,-184 48,-178 54,-178 54,-178 167,-178 167,-178 173,-178 179,-184 179,-190 179,-190 179,-202 179,-202 179,-208 173,-214 167,-214"/>
<text text-anchor="middle" x="110.5" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftPollerBuilder_init</text>
</g>
<!-- RaftPollerBuilder_init&#45;&gt;on_region_changed -->
<g id="edge2" class="edge">
<title>RaftPollerBuilder_init&#45;&gt;on_region_changed</title>
<path fill="none" stroke="#666666" d="M179.19,-178.47C200.44,-172.97 224,-166.86 245.67,-161.25"/>
<polygon fill="#666666" stroke="#666666" points="246.68,-164.61 255.48,-158.71 244.92,-157.83 246.68,-164.61"/>
</g>
<!-- Peer_set_region -->
<g id="node5" class="node">
<title>Peer_set_region</title>
<path fill="none" stroke="#1c2123" d="M150.5,-160C150.5,-160 70.5,-160 70.5,-160 64.5,-160 58.5,-154 58.5,-148 58.5,-148 58.5,-136 58.5,-136 58.5,-130 64.5,-124 70.5,-124 70.5,-124 150.5,-124 150.5,-124 156.5,-124 162.5,-130 162.5,-136 162.5,-136 162.5,-148 162.5,-148 162.5,-154 156.5,-160 150.5,-160"/>
<text text-anchor="middle" x="110.5" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer_set_region</text>
</g>
<!-- Peer_set_region&#45;&gt;on_region_changed -->
<g id="edge3" class="edge">
<title>Peer_set_region&#45;&gt;on_region_changed</title>
<path fill="none" stroke="#666666" d="M162.5,-142C187.31,-142 217.6,-142 244.98,-142"/>
<polygon fill="#666666" stroke="#666666" points="245.31,-145.5 255.31,-142 245.31,-138.5 245.31,-145.5"/>
</g>
<!-- Peer_activate -->
<g id="node6" class="node">
<title>Peer_activate</title>
<path fill="none" stroke="#1c2123" d="M143,-106C143,-106 78,-106 78,-106 72,-106 66,-100 66,-94 66,-94 66,-82 66,-82 66,-76 72,-70 78,-70 78,-70 143,-70 143,-70 149,-70 155,-76 155,-82 155,-82 155,-94 155,-94 155,-100 149,-106 143,-106"/>
<text text-anchor="middle" x="110.5" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer_activate</text>
</g>
<!-- Peer_activate&#45;&gt;on_region_changed -->
<g id="edge4" class="edge">
<title>Peer_activate&#45;&gt;on_region_changed</title>
<path fill="none" stroke="#666666" d="M155.21,-99.32C181.39,-106.1 215.37,-114.9 245.67,-122.75"/>
<polygon fill="#666666" stroke="#666666" points="244.8,-126.14 255.36,-125.26 246.56,-119.36 244.8,-126.14"/>
</g>
<!-- Peer_on_role_changed -->
<g id="node7" class="node">
<title>Peer_on_role_changed</title>
<path fill="none" stroke="#1c2123" d="M168.5,-52C168.5,-52 52.5,-52 52.5,-52 46.5,-52 40.5,-46 40.5,-40 40.5,-40 40.5,-28 40.5,-28 40.5,-22 46.5,-16 52.5,-16 52.5,-16 168.5,-16 168.5,-16 174.5,-16 180.5,-22 180.5,-28 180.5,-28 180.5,-40 180.5,-40 180.5,-46 174.5,-52 168.5,-52"/>
<text text-anchor="middle" x="110.5" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer_on_role_changed</text>
</g>
<!-- Peer_on_role_changed&#45;&gt;on_role_changed -->
<g id="edge5" class="edge">
<title>Peer_on_role_changed&#45;&gt;on_role_changed</title>
<path fill="none" stroke="#666666" d="M180.64,-43.28C198.04,-45.62 216.92,-48.16 235,-50.59"/>
<polygon fill="#666666" stroke="#666666" points="234.57,-54.06 244.95,-51.92 235.51,-47.12 234.57,-54.06"/>
</g>
<!-- handle_change_role -->
<g id="node10" class="node">
<title>handle_change_role</title>
<path fill="none" stroke="#1c2123" d="M667,-118C667,-118 780,-118 780,-118 786,-118 792,-124 792,-130 792,-130 792,-152 792,-152 792,-158 786,-164 780,-164 780,-164 667,-164 667,-164 661,-164 655,-158 655,-152 655,-152 655,-130 655,-130 655,-124 661,-118 667,-118"/>
<text text-anchor="middle" x="723.5" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_change_role</text>
<polyline fill="none" stroke="#1c2123" points="655,-141 792,-141 "/>
<text text-anchor="start" x="663" y="-125.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理change_role task</text>
</g>
<!-- deadlock_Scheduler_change_role&#45;&gt;handle_change_role -->
<g id="edge8" class="edge">
<title>deadlock_Scheduler_change_role&#45;&gt;handle_change_role</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M619.24,-120.19C627.87,-121.93 636.58,-123.68 645.09,-125.4"/>
<polygon fill="green" stroke="green" points="644.46,-128.84 654.95,-127.39 645.84,-121.98 644.46,-128.84"/>
</g>
<!-- Detector_run -->
<g id="node9" class="node">
<title>Detector_run</title>
<path fill="none" stroke="#1c2123" d="M495.5,-163C495.5,-163 560.5,-163 560.5,-163 566.5,-163 572.5,-169 572.5,-175 572.5,-175 572.5,-187 572.5,-187 572.5,-193 566.5,-199 560.5,-199 560.5,-199 495.5,-199 495.5,-199 489.5,-199 483.5,-193 483.5,-187 483.5,-187 483.5,-175 483.5,-175 483.5,-169 489.5,-163 495.5,-163"/>
<text text-anchor="middle" x="528" y="-177.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Detector::run</text>
</g>
<!-- Detector_run&#45;&gt;handle_change_role -->
<g id="edge9" class="edge">
<title>Detector_run&#45;&gt;handle_change_role</title>
<path fill="none" stroke="#666666" d="M572.91,-171.92C594.17,-167.53 620.35,-162.12 644.84,-157.05"/>
<polygon fill="#666666" stroke="#666666" points="645.76,-160.44 654.84,-154.99 644.34,-153.58 645.76,-160.44"/>
</g>
<!-- change_role -->
<g id="node11" class="node">
<title>change_role</title>
<path fill="none" stroke="#1c2123" d="M899,-159C899,-159 840,-159 840,-159 834,-159 828,-153 828,-147 828,-147 828,-135 828,-135 828,-129 834,-123 840,-123 840,-123 899,-123 899,-123 905,-123 911,-129 911,-135 911,-135 911,-147 911,-147 911,-153 905,-159 899,-159"/>
<text text-anchor="middle" x="869.5" y="-137.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">change_role</text>
</g>
<!-- handle_change_role&#45;&gt;change_role -->
<g id="edge10" class="edge">
<title>handle_change_role&#45;&gt;change_role</title>
<path fill="none" stroke="#666666" d="M792.28,-141C800.8,-141 809.39,-141 817.58,-141"/>
<polygon fill="#666666" stroke="#666666" points="817.71,-144.5 827.71,-141 817.71,-137.5 817.71,-144.5"/>
</g>
<!-- reset -->
<g id="node12" class="node">
<title>reset</title>
<path fill="none" stroke="#1c2123" d="M959,-110.5C959,-110.5 1140,-110.5 1140,-110.5 1146,-110.5 1152,-116.5 1152,-122.5 1152,-122.5 1152,-159.5 1152,-159.5 1152,-165.5 1146,-171.5 1140,-171.5 1140,-171.5 959,-171.5 959,-171.5 953,-171.5 947,-165.5 947,-159.5 947,-159.5 947,-122.5 947,-122.5 947,-116.5 953,-110.5 959,-110.5"/>
<text text-anchor="middle" x="1049.5" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset</text>
<polyline fill="none" stroke="#1c2123" points="947,-148.5 1152,-148.5 "/>
<text text-anchor="start" x="955" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.清空detect_table</text>
<text text-anchor="start" x="955" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.清除leader_client和leader_info</text>
</g>
<!-- change_role&#45;&gt;reset -->
<g id="edge11" class="edge">
<title>change_role&#45;&gt;reset</title>
<path fill="none" stroke="#666666" d="M911.34,-141C919.17,-141 927.71,-141 936.58,-141"/>
<polygon fill="#666666" stroke="#666666" points="936.71,-144.5 946.71,-141 936.71,-137.5 936.71,-144.5"/>
</g>
</g>
</svg>
