<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: leader_info Pages: 1 -->
<svg width="967pt" height="401pt"
 viewBox="0.00 0.00 967.00 401.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 397)">
<title>leader_info</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-397 963,-397 963,4 -4,4"/>
<!-- handle_detect -->
<g id="node1" class="node">
<title>handle_detect</title>
<path fill="none" stroke="#1c2123" d="M12,-294.5C12,-294.5 137,-294.5 137,-294.5 143,-294.5 149,-300.5 149,-306.5 149,-306.5 149,-343.5 149,-343.5 149,-349.5 143,-355.5 137,-355.5 137,-355.5 12,-355.5 12,-355.5 6,-355.5 0,-349.5 0,-343.5 0,-343.5 0,-306.5 0,-306.5 0,-300.5 6,-294.5 12,-294.5"/>
<text text-anchor="middle" x="74.5" y="-340.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_detect</text>
<polyline fill="none" stroke="#1c2123" points="0,-332.5 149,-332.5 "/>
<text text-anchor="start" x="8" y="-317.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果leaer_client为none</text>
<text text-anchor="start" x="8" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先刷新leader info</text>
</g>
<!-- refresh_leader_info -->
<g id="node2" class="node">
<title>refresh_leader_info</title>
<path fill="none" stroke="#1c2123" d="M197,-254C197,-254 374,-254 374,-254 380,-254 386,-260 386,-266 386,-266 386,-318 386,-318 386,-324 380,-330 374,-330 374,-330 197,-330 197,-330 191,-330 185,-324 185,-318 185,-318 185,-266 185,-266 185,-260 191,-254 197,-254"/>
<text text-anchor="middle" x="285.5" y="-314.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">refresh_leader_info</text>
<polyline fill="none" stroke="#1c2123" points="185,-307 386,-307 "/>
<text text-anchor="start" x="193" y="-291.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.去pdclient获取LEADER_KEY</text>
<text text-anchor="start" x="193" y="-276.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 所在region的leader storeId</text>
<text text-anchor="start" x="193" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.解析storeId对应的 addr</text>
</g>
<!-- handle_detect&#45;&gt;refresh_leader_info -->
<g id="edge3" class="edge">
<title>handle_detect&#45;&gt;refresh_leader_info</title>
<path fill="none" stroke="#666666" d="M149.19,-313.37C157.46,-312.06 166.03,-310.71 174.64,-309.35"/>
<polygon fill="#666666" stroke="#666666" points="175.42,-312.77 184.75,-307.75 174.33,-305.85 175.42,-312.77"/>
</g>
<!-- reconnect_leader -->
<g id="node9" class="node">
<title>reconnect_leader</title>
<path fill="none" stroke="#1c2123" d="M804,-331.5C804,-331.5 947,-331.5 947,-331.5 953,-331.5 959,-337.5 959,-343.5 959,-343.5 959,-380.5 959,-380.5 959,-386.5 953,-392.5 947,-392.5 947,-392.5 804,-392.5 804,-392.5 798,-392.5 792,-386.5 792,-380.5 792,-380.5 792,-343.5 792,-343.5 792,-337.5 798,-331.5 804,-331.5"/>
<text text-anchor="middle" x="875.5" y="-377.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reconnect_leader</text>
<polyline fill="none" stroke="#1c2123" points="792,-369.5 959,-369.5 "/>
<text text-anchor="start" x="800" y="-354.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建leader的detect接口的</text>
<text text-anchor="start" x="800" y="-339.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> grpc stream</text>
</g>
<!-- handle_detect&#45;&gt;reconnect_leader -->
<g id="edge4" class="edge">
<title>handle_detect&#45;&gt;reconnect_leader</title>
<path fill="none" stroke="#666666" d="M149.05,-335.68C161.05,-337.25 173.36,-338.75 185,-340 437.66,-367.08 502.01,-376.5 756,-369 764.37,-368.75 773.06,-368.41 781.77,-368"/>
<polygon fill="#666666" stroke="#666666" points="782.16,-371.49 791.97,-367.5 781.81,-364.5 782.16,-371.49"/>
</g>
<!-- update_leader_info -->
<g id="node7" class="node">
<title>update_leader_info</title>
<path fill="none" stroke="#1c2123" d="M609,-313C609,-313 706,-313 706,-313 712,-313 718,-319 718,-325 718,-325 718,-347 718,-347 718,-353 712,-359 706,-359 706,-359 609,-359 609,-359 603,-359 597,-353 597,-347 597,-347 597,-325 597,-325 597,-319 603,-313 609,-313"/>
<text text-anchor="middle" x="657.5" y="-343.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_leader_info</text>
<polyline fill="none" stroke="#1c2123" points="597,-336 718,-336 "/>
<text text-anchor="middle" x="657.5" y="-320.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新leader信息</text>
</g>
<!-- refresh_leader_info&#45;&gt;update_leader_info -->
<g id="edge5" class="edge">
<title>refresh_leader_info&#45;&gt;update_leader_info</title>
<path fill="none" stroke="#666666" d="M386.14,-303.85C449.64,-311.4 530.33,-321 586.97,-327.73"/>
<polygon fill="#666666" stroke="#666666" points="586.56,-331.21 596.9,-328.91 587.38,-324.26 586.56,-331.21"/>
</g>
<!-- get_leader_info -->
<g id="node8" class="node">
<title>get_leader_info</title>
<path fill="none" stroke="#1c2123" d="M511,-281C511,-281 434,-281 434,-281 428,-281 422,-275 422,-269 422,-269 422,-257 422,-257 422,-251 428,-245 434,-245 434,-245 511,-245 511,-245 517,-245 523,-251 523,-257 523,-257 523,-269 523,-269 523,-275 517,-281 511,-281"/>
<text text-anchor="middle" x="472.5" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_leader_info</text>
</g>
<!-- refresh_leader_info&#45;&gt;get_leader_info -->
<g id="edge6" class="edge">
<title>refresh_leader_info&#45;&gt;get_leader_info</title>
<path fill="none" stroke="#666666" d="M386.04,-276.4C394.7,-275.04 403.28,-273.69 411.46,-272.41"/>
<polygon fill="#666666" stroke="#666666" points="412.27,-275.83 421.6,-270.82 411.18,-268.91 412.27,-275.83"/>
</g>
<!-- reset -->
<g id="node10" class="node">
<title>reset</title>
<path fill="none" stroke="#1c2123" d="M487.5,-227C487.5,-227 457.5,-227 457.5,-227 451.5,-227 445.5,-221 445.5,-215 445.5,-215 445.5,-203 445.5,-203 445.5,-197 451.5,-191 457.5,-191 457.5,-191 487.5,-191 487.5,-191 493.5,-191 499.5,-197 499.5,-203 499.5,-203 499.5,-215 499.5,-215 499.5,-221 493.5,-227 487.5,-227"/>
<text text-anchor="middle" x="472.5" y="-205.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset</text>
</g>
<!-- refresh_leader_info&#45;&gt;reset -->
<g id="edge7" class="edge">
<title>refresh_leader_info&#45;&gt;reset</title>
<path fill="none" stroke="#666666" d="M371.42,-253.9C394.23,-243.67 417.66,-233.16 436.11,-224.88"/>
<polygon fill="#666666" stroke="#666666" points="437.58,-228.05 445.27,-220.77 434.72,-221.67 437.58,-228.05"/>
</g>
<!-- pd_client_get_region_info -->
<g id="node3" class="node">
<title>pd_client_get_region_info</title>
<path fill="none" stroke="#1c2123" d="M582,-232.5C582,-232.5 733,-232.5 733,-232.5 739,-232.5 745,-238.5 745,-244.5 745,-244.5 745,-281.5 745,-281.5 745,-287.5 739,-293.5 733,-293.5 733,-293.5 582,-293.5 582,-293.5 576,-293.5 570,-287.5 570,-281.5 570,-281.5 570,-244.5 570,-244.5 570,-238.5 576,-232.5 582,-232.5"/>
<text text-anchor="middle" x="657.5" y="-278.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. pd_client::get_region_info</text>
<polyline fill="none" stroke="#1c2123" points="570,-270.5 745,-270.5 "/>
<text text-anchor="start" x="578" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">去PD获取LEADER_KEY</text>
<text text-anchor="start" x="578" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 所在的region信息</text>
</g>
<!-- LEADER_KEY -->
<g id="node4" class="node">
<title>LEADER_KEY</title>
<path fill="none" stroke="#1c2123" d="M571,-152.5C571,-152.5 744,-152.5 744,-152.5 750,-152.5 756,-158.5 756,-164.5 756,-164.5 756,-201.5 756,-201.5 756,-207.5 750,-213.5 744,-213.5 744,-213.5 571,-213.5 571,-213.5 565,-213.5 559,-207.5 559,-201.5 559,-201.5 559,-164.5 559,-164.5 559,-158.5 565,-152.5 571,-152.5"/>
<text text-anchor="middle" x="657.5" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. LEADER_KEY</text>
<polyline fill="none" stroke="#1c2123" points="559,-190.5 756,-190.5 "/>
<text text-anchor="start" x="567" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">为空串b&quot;&quot;</text>
<text text-anchor="start" x="567" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 第一个region就是leader region</text>
</g>
<!-- leader_get_store_id -->
<g id="node5" class="node">
<title>leader_get_store_id</title>
<path fill="none" stroke="#1c2123" d="M601.5,-87C601.5,-87 713.5,-87 713.5,-87 719.5,-87 725.5,-93 725.5,-99 725.5,-99 725.5,-121 725.5,-121 725.5,-127 719.5,-133 713.5,-133 713.5,-133 601.5,-133 601.5,-133 595.5,-133 589.5,-127 589.5,-121 589.5,-121 589.5,-99 589.5,-99 589.5,-93 595.5,-87 601.5,-87"/>
<text text-anchor="middle" x="657.5" y="-117.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">3.leader.get_store_id</text>
<polyline fill="none" stroke="#1c2123" points="589.5,-110 725.5,-110 "/>
<text text-anchor="middle" x="657.5" y="-94.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取leader的store_id</text>
</g>
<!-- resolve_store_address -->
<g id="node6" class="node">
<title>resolve_store_address</title>
<path fill="none" stroke="#1c2123" d="M586,-22C586,-22 729,-22 729,-22 735,-22 741,-28 741,-34 741,-34 741,-56 741,-56 741,-62 735,-68 729,-68 729,-68 586,-68 586,-68 580,-68 574,-62 574,-56 574,-56 574,-34 574,-34 574,-28 580,-22 586,-22"/>
<text text-anchor="middle" x="657.5" y="-52.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">4.resolve_store_address</text>
<polyline fill="none" stroke="#1c2123" points="574,-45 741,-45 "/>
<text text-anchor="start" x="582" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">解析出leader store address</text>
</g>
<!-- wait_op_ -->
<g id="node11" class="node">
<title>wait_op_</title>
<path fill="none" stroke="#1c2123" d="M897,-90C897,-90 854,-90 854,-90 848,-90 842,-84 842,-78 842,-78 842,-66 842,-66 842,-60 848,-54 854,-54 854,-54 897,-54 897,-54 903,-54 909,-60 909,-66 909,-66 909,-78 909,-78 909,-84 903,-90 897,-90"/>
<text text-anchor="middle" x="875.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wait_op_</text>
</g>
<!-- resolve_store_address&#45;&gt;wait_op_ -->
<g id="edge12" class="edge">
<title>resolve_store_address&#45;&gt;wait_op_</title>
<path fill="none" stroke="#666666" d="M741.08,-55.32C771.96,-59.18 805.78,-63.41 831.64,-66.64"/>
<polygon fill="#666666" stroke="#666666" points="831.49,-70.15 841.85,-67.92 832.36,-63.21 831.49,-70.15"/>
</g>
<!-- resolver_resolve -->
<g id="node12" class="node">
<title>resolver_resolve</title>
<path fill="none" stroke="#1c2123" d="M916.5,-36C916.5,-36 834.5,-36 834.5,-36 828.5,-36 822.5,-30 822.5,-24 822.5,-24 822.5,-12 822.5,-12 822.5,-6 828.5,0 834.5,0 834.5,0 916.5,0 916.5,0 922.5,0 928.5,-6 928.5,-12 928.5,-12 928.5,-24 928.5,-24 928.5,-30 922.5,-36 916.5,-36"/>
<text text-anchor="middle" x="875.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolver_resolve</text>
</g>
<!-- resolve_store_address&#45;&gt;resolver_resolve -->
<g id="edge13" class="edge">
<title>resolve_store_address&#45;&gt;resolver_resolve</title>
<path fill="none" stroke="#666666" d="M741.08,-34.68C764.74,-31.72 790.11,-28.55 812.31,-25.77"/>
<polygon fill="#666666" stroke="#666666" points="812.79,-29.24 822.28,-24.53 811.92,-22.3 812.79,-29.24"/>
</g>
<!-- update_leader_info&#45;&gt;reconnect_leader -->
<g id="edge2" class="edge">
<title>update_leader_info&#45;&gt;reconnect_leader</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M718.09,-343.17C737.71,-345.54 760.02,-348.22 781.52,-350.81"/>
<polygon fill="green" stroke="green" points="781.31,-354.31 791.66,-352.03 782.15,-347.36 781.31,-354.31"/>
</g>
<!-- get_leader_info&#45;&gt;pd_client_get_region_info -->
<g id="edge8" class="edge">
<title>get_leader_info&#45;&gt;pd_client_get_region_info</title>
<path fill="none" stroke="#666666" d="M523.02,-263C534.47,-263 547.03,-263 559.72,-263"/>
<polygon fill="#666666" stroke="#666666" points="559.92,-266.5 569.92,-263 559.92,-259.5 559.92,-266.5"/>
</g>
<!-- get_leader_info&#45;&gt;LEADER_KEY -->
<g id="edge9" class="edge">
<title>get_leader_info&#45;&gt;LEADER_KEY</title>
<path fill="none" stroke="#666666" d="M511.2,-244.88C526.03,-237.88 543.24,-229.91 559,-223 563.12,-221.19 567.34,-219.37 571.62,-217.54"/>
<polygon fill="#666666" stroke="#666666" points="573.19,-220.67 581.03,-213.54 570.45,-214.23 573.19,-220.67"/>
</g>
<!-- get_leader_info&#45;&gt;leader_get_store_id -->
<g id="edge10" class="edge">
<title>get_leader_info&#45;&gt;leader_get_store_id</title>
<path fill="none" stroke="#666666" d="M513.27,-244.78C516.83,-242.16 520.16,-239.24 523,-236 552.24,-202.69 526.99,-173.66 559,-143 565.17,-137.09 572.43,-132.24 580.17,-128.25"/>
<polygon fill="#666666" stroke="#666666" points="581.82,-131.34 589.43,-123.96 578.88,-124.99 581.82,-131.34"/>
</g>
<!-- get_leader_info&#45;&gt;resolve_store_address -->
<g id="edge11" class="edge">
<title>get_leader_info&#45;&gt;resolve_store_address</title>
<path fill="none" stroke="#666666" d="M514.24,-244.82C517.52,-242.21 520.52,-239.28 523,-236 566.46,-178.57 510.74,-131.47 559,-78 561.02,-75.76 563.2,-73.67 565.5,-71.73"/>
<polygon fill="#666666" stroke="#666666" points="567.8,-74.38 573.79,-65.64 563.66,-68.74 567.8,-74.38"/>
</g>
<!-- get_leader_info&#45;&gt;update_leader_info -->
<g id="edge1" class="edge">
<title>get_leader_info&#45;&gt;update_leader_info</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M509.72,-281.03C524.79,-288.25 542.58,-296.4 559,-303 568.08,-306.65 577.73,-310.24 587.3,-313.64"/>
<polygon fill="green" stroke="green" points="586.23,-316.97 596.82,-316.97 588.54,-310.37 586.23,-316.97"/>
</g>
</g>
</svg>
