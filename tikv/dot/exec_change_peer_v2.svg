<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: exec_chnage_peer_v2 Pages: 1 -->
<svg width="1857pt" height="1181pt"
 viewBox="0.00 0.00 1857.00 1180.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1176.91)">
<title>exec_chnage_peer_v2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1176.91 1853,-1176.91 1853,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_ApplyDelegate</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-54.91C20,-54.91 1829,-54.91 1829,-54.91 1835,-54.91 1841,-60.91 1841,-66.91 1841,-66.91 1841,-1152.91 1841,-1152.91 1841,-1158.91 1835,-1164.91 1829,-1164.91 1829,-1164.91 20,-1164.91 20,-1164.91 14,-1164.91 8,-1158.91 8,-1152.91 8,-1152.91 8,-66.91 8,-66.91 8,-60.91 14,-54.91 20,-54.91"/>
<text text-anchor="middle" x="924.5" y="-1144.91" font-family="Times,serif" font-size="20.00">ApplyDelegate</text>
</g>
<!-- ConfChangeType_RemoveNode -->
<g id="node1" class="node">
<title>ConfChangeType_RemoveNode</title>
<path fill="none" stroke="#1c2123" d="M855.5,-953.41C855.5,-953.41 1049.5,-953.41 1049.5,-953.41 1055.5,-953.41 1061.5,-959.41 1061.5,-965.41 1061.5,-965.41 1061.5,-1040.41 1061.5,-1040.41 1061.5,-1046.41 1055.5,-1052.41 1049.5,-1052.41 1049.5,-1052.41 855.5,-1052.41 855.5,-1052.41 849.5,-1052.41 843.5,-1046.41 843.5,-1040.41 843.5,-1040.41 843.5,-965.41 843.5,-965.41 843.5,-959.41 849.5,-953.41 855.5,-953.41"/>
<text text-anchor="middle" x="952.5" y="-1037.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConfChangeType_RemoveNode</text>
<polyline fill="none" stroke="#1c2123" points="843.5,-1029.41 1061.5,-1029.41 "/>
<text text-anchor="start" x="851.5" y="-1014.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">EnterJoint 不能直接删除Voter peer</text>
<polyline fill="none" stroke="#1c2123" points="843.5,-1006.41 1061.5,-1006.41 "/>
<text text-anchor="start" x="851.5" y="-991.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果self.id == peer.get_id</text>
<text text-anchor="start" x="851.5" y="-976.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.stopped = true</text>
<text text-anchor="start" x="851.5" y="-961.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.pending_remove = true</text>
</g>
<!-- pending_remove -->
<g id="node2" class="node">
<title>pending_remove</title>
<path fill="none" stroke="#1c2123" d="M1258,-922.91C1258,-922.91 1420,-922.91 1420,-922.91 1426,-922.91 1432,-928.91 1432,-934.91 1432,-934.91 1432,-956.91 1432,-956.91 1432,-962.91 1426,-968.91 1420,-968.91 1420,-968.91 1258,-968.91 1258,-968.91 1252,-968.91 1246,-962.91 1246,-956.91 1246,-956.91 1246,-934.91 1246,-934.91 1246,-928.91 1252,-922.91 1258,-922.91"/>
<text text-anchor="middle" x="1339" y="-953.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_remove</text>
<polyline fill="none" stroke="#1c2123" points="1246,-945.91 1432,-945.91 "/>
<text text-anchor="start" x="1254" y="-930.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">将pending_remove设置为true</text>
</g>
<!-- ConfChangeType_RemoveNode&#45;&gt;pending_remove -->
<g id="edge1" class="edge">
<title>ConfChangeType_RemoveNode&#45;&gt;pending_remove</title>
<path fill="none" stroke="#666666" d="M1061.63,-986.88C1116.31,-978.77 1182.3,-968.99 1236.08,-961.01"/>
<polygon fill="#666666" stroke="#666666" points="1236.6,-964.48 1245.98,-959.55 1235.57,-957.55 1236.6,-964.48"/>
</g>
<!-- stopped -->
<g id="node3" class="node">
<title>stopped</title>
<path fill="none" stroke="#1c2123" d="M1288.5,-988.41C1288.5,-988.41 1389.5,-988.41 1389.5,-988.41 1395.5,-988.41 1401.5,-994.41 1401.5,-1000.41 1401.5,-1000.41 1401.5,-1037.41 1401.5,-1037.41 1401.5,-1043.41 1395.5,-1049.41 1389.5,-1049.41 1389.5,-1049.41 1288.5,-1049.41 1288.5,-1049.41 1282.5,-1049.41 1276.5,-1043.41 1276.5,-1037.41 1276.5,-1037.41 1276.5,-1000.41 1276.5,-1000.41 1276.5,-994.41 1282.5,-988.41 1288.5,-988.41"/>
<text text-anchor="middle" x="1339" y="-1034.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">stopped</text>
<polyline fill="none" stroke="#1c2123" points="1276.5,-1026.41 1401.5,-1026.41 "/>
<text text-anchor="start" x="1284.5" y="-1011.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">不用再apply log了</text>
<text text-anchor="start" x="1284.5" y="-996.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 停止ApplyFsm</text>
</g>
<!-- ConfChangeType_RemoveNode&#45;&gt;stopped -->
<g id="edge2" class="edge">
<title>ConfChangeType_RemoveNode&#45;&gt;stopped</title>
<path fill="none" stroke="#666666" d="M1061.63,-1007.41C1127.11,-1010.13 1208.81,-1013.53 1266.34,-1015.92"/>
<polygon fill="#666666" stroke="#666666" points="1266.3,-1019.43 1276.43,-1016.34 1266.59,-1012.43 1266.3,-1019.43"/>
</g>
<!-- handle_raft_committed_entries -->
<g id="node4" class="node">
<title>handle_raft_committed_entries</title>
<path fill="none" stroke="#1c2123" d="M1498,-1012.41C1498,-1012.41 1661,-1012.41 1661,-1012.41 1667,-1012.41 1673,-1018.41 1673,-1024.41 1673,-1024.41 1673,-1061.41 1673,-1061.41 1673,-1067.41 1667,-1073.41 1661,-1073.41 1661,-1073.41 1498,-1073.41 1498,-1073.41 1492,-1073.41 1486,-1067.41 1486,-1061.41 1486,-1061.41 1486,-1024.41 1486,-1024.41 1486,-1018.41 1492,-1012.41 1498,-1012.41"/>
<text text-anchor="middle" x="1579.5" y="-1058.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_committed_entries</text>
<polyline fill="none" stroke="#1c2123" points="1486,-1050.41 1673,-1050.41 "/>
<text text-anchor="start" x="1494" y="-1035.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果pending_remove，</text>
<text text-anchor="start" x="1494" y="-1020.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就skip掉所有log entry</text>
</g>
<!-- pending_remove&#45;&gt;handle_raft_committed_entries -->
<g id="edge3" class="edge">
<title>pending_remove&#45;&gt;handle_raft_committed_entries</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1410.08,-969.01C1417.59,-972.08 1425.03,-975.4 1432,-978.91 1449.18,-987.55 1450.84,-994.24 1468,-1002.91 1471.59,-1004.72 1475.27,-1006.49 1479.03,-1008.21"/>
<polygon fill="green" stroke="green" points="1477.91,-1011.54 1488.47,-1012.39 1480.74,-1005.14 1477.91,-1011.54"/>
</g>
<!-- PeerState_Normal -->
<g id="node5" class="node">
<title>PeerState_Normal</title>
<path fill="none" stroke="#1c2123" d="M1625.5,-913.91C1625.5,-913.91 1533.5,-913.91 1533.5,-913.91 1527.5,-913.91 1521.5,-907.91 1521.5,-901.91 1521.5,-901.91 1521.5,-889.91 1521.5,-889.91 1521.5,-883.91 1527.5,-877.91 1533.5,-877.91 1533.5,-877.91 1625.5,-877.91 1625.5,-877.91 1631.5,-877.91 1637.5,-883.91 1637.5,-889.91 1637.5,-889.91 1637.5,-901.91 1637.5,-901.91 1637.5,-907.91 1631.5,-913.91 1625.5,-913.91"/>
<text text-anchor="middle" x="1579.5" y="-892.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerState_Normal</text>
</g>
<!-- pending_remove&#45;&gt;PeerState_Normal -->
<g id="edge4" class="edge">
<title>pending_remove&#45;&gt;PeerState_Normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1432.21,-926.57C1458.59,-921.04 1486.84,-915.12 1511.41,-909.97"/>
<polygon fill="green" stroke="green" points="1512.27,-913.37 1521.34,-907.89 1510.83,-906.52 1512.27,-913.37"/>
</g>
<!-- PeerState_Tombstone -->
<g id="node6" class="node">
<title>PeerState_Tombstone</title>
<path fill="none" stroke="#1c2123" d="M1480,-932.41C1480,-932.41 1679,-932.41 1679,-932.41 1685,-932.41 1691,-938.41 1691,-944.41 1691,-944.41 1691,-981.41 1691,-981.41 1691,-987.41 1685,-993.41 1679,-993.41 1679,-993.41 1480,-993.41 1480,-993.41 1474,-993.41 1468,-987.41 1468,-981.41 1468,-981.41 1468,-944.41 1468,-944.41 1468,-938.41 1474,-932.41 1480,-932.41"/>
<text text-anchor="middle" x="1579.5" y="-978.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerState_Tombstone</text>
<polyline fill="none" stroke="#1c2123" points="1468,-970.41 1691,-970.41 "/>
<text text-anchor="start" x="1476" y="-955.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置region的PeerState为TombStone</text>
<text text-anchor="start" x="1476" y="-940.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 后续会清理该Region的数据</text>
</g>
<!-- pending_remove&#45;&gt;PeerState_Tombstone -->
<g id="edge5" class="edge">
<title>pending_remove&#45;&gt;PeerState_Tombstone</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1432.21,-952.48C1440.6,-953.08 1449.17,-953.69 1457.75,-954.3"/>
<polygon fill="green" stroke="green" points="1457.6,-957.8 1467.82,-955.02 1458.1,-950.81 1457.6,-957.8"/>
</g>
<!-- write_peer_state -->
<g id="node7" class="node">
<title>write_peer_state</title>
<path fill="none" stroke="#1c2123" d="M1821,-980.91C1821,-980.91 1739,-980.91 1739,-980.91 1733,-980.91 1727,-974.91 1727,-968.91 1727,-968.91 1727,-956.91 1727,-956.91 1727,-950.91 1733,-944.91 1739,-944.91 1739,-944.91 1821,-944.91 1821,-944.91 1827,-944.91 1833,-950.91 1833,-956.91 1833,-956.91 1833,-968.91 1833,-968.91 1833,-974.91 1827,-980.91 1821,-980.91"/>
<text text-anchor="middle" x="1780" y="-959.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_peer_state</text>
</g>
<!-- PeerState_Normal&#45;&gt;write_peer_state -->
<g id="edge6" class="edge">
<title>PeerState_Normal&#45;&gt;write_peer_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1637.59,-907.7C1654.94,-911.86 1673.92,-917 1691,-922.91 1705.3,-927.86 1720.45,-934.28 1734.07,-940.53"/>
<polygon fill="green" stroke="green" points="1732.69,-943.75 1743.23,-944.81 1735.65,-937.4 1732.69,-943.75"/>
</g>
<!-- PeerState_Tombstone&#45;&gt;write_peer_state -->
<g id="edge7" class="edge">
<title>PeerState_Tombstone&#45;&gt;write_peer_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1691.07,-962.91C1699.83,-962.91 1708.47,-962.91 1716.72,-962.91"/>
<polygon fill="green" stroke="green" points="1716.93,-966.41 1726.93,-962.91 1716.93,-959.41 1716.93,-966.41"/>
</g>
<!-- region_mut_peers -->
<g id="node8" class="node">
<title>region_mut_peers</title>
<path fill="none" stroke="#1c2123" d="M581.5,-127.91C581.5,-127.91 490.5,-127.91 490.5,-127.91 484.5,-127.91 478.5,-121.91 478.5,-115.91 478.5,-115.91 478.5,-103.91 478.5,-103.91 478.5,-97.91 484.5,-91.91 490.5,-91.91 490.5,-91.91 581.5,-91.91 581.5,-91.91 587.5,-91.91 593.5,-97.91 593.5,-103.91 593.5,-103.91 593.5,-115.91 593.5,-115.91 593.5,-121.91 587.5,-127.91 581.5,-127.91"/>
<text text-anchor="middle" x="536" y="-106.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_mut_peers</text>
</g>
<!-- Region -->
<g id="node9" class="node">
<title>Region</title>
<path fill="#feed9b" stroke="#f7e495" d="M707,-83.91C707,-83.91 1198,-83.91 1198,-83.91 1204,-83.91 1210,-89.91 1210,-95.91 1210,-95.91 1210,-209.91 1210,-209.91 1210,-215.91 1204,-221.91 1198,-221.91 1198,-221.91 707,-221.91 707,-221.91 701,-221.91 695,-215.91 695,-209.91 695,-209.91 695,-95.91 695,-95.91 695,-89.91 701,-83.91 707,-83.91"/>
<text text-anchor="middle" x="952.5" y="-206.71" font-family="Times,serif" font-size="14.00" fill="#40575d">Region</text>
<polyline fill="none" stroke="#f7e495" points="695,-198.91 1210,-198.91 "/>
<text text-anchor="start" x="703" y="-183.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub start_key: ::std::vec::Vec&lt;u8&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="695,-175.91 1210,-175.91 "/>
<text text-anchor="start" x="703" y="-160.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub end_key: ::std::vec::Vec&lt;u8&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="695,-152.91 1210,-152.91 "/>
<text text-anchor="start" x="703" y="-137.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region_epoch: ::protobuf::SingularPtrField&lt;RegionEpoch&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="695,-129.91 1210,-129.91 "/>
<text text-anchor="start" x="703" y="-114.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub peers: ::protobuf::RepeatedField&lt;Peer&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="695,-106.91 1210,-106.91 "/>
<text text-anchor="start" x="703" y="-91.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub encryption_meta: ::protobuf::SingularPtrField&lt;super::encryptionpb::EncryptionMeta&gt;,</text>
</g>
<!-- region_mut_peers&#45;&gt;Region -->
<g id="edge8" class="edge">
<title>region_mut_peers&#45;&gt;Region:peers</title>
<path fill="none" stroke="#666666" d="M593.64,-114.16C620.67,-115.88 653.79,-117.53 684.64,-117.85"/>
<polygon fill="#666666" stroke="#666666" points="684.98,-121.35 695,-117.91 685.02,-114.35 684.98,-121.35"/>
</g>
<!-- ExecResult_ChangePeer -->
<g id="node10" class="node">
<title>ExecResult_ChangePeer</title>
<path fill="#feed9b" stroke="#f7e495" d="M427.5,-146.91C427.5,-146.91 644.5,-146.91 644.5,-146.91 650.5,-146.91 656.5,-152.91 656.5,-158.91 656.5,-158.91 656.5,-302.91 656.5,-302.91 656.5,-308.91 650.5,-314.91 644.5,-314.91 644.5,-314.91 427.5,-314.91 427.5,-314.91 421.5,-314.91 415.5,-308.91 415.5,-302.91 415.5,-302.91 415.5,-158.91 415.5,-158.91 415.5,-152.91 421.5,-146.91 427.5,-146.91"/>
<text text-anchor="middle" x="536" y="-299.71" font-family="Times,serif" font-size="14.00" fill="#40575d">ExecResult::ChangePeer</text>
<polyline fill="none" stroke="#f7e495" points="415.5,-291.91 656.5,-291.91 "/>
<text text-anchor="start" x="423.5" y="-276.71" font-family="Times,serif" font-size="14.00" fill="#40575d">要发给peerFsmDelegate的消息</text>
<polyline fill="none" stroke="#f7e495" points="415.5,-268.91 656.5,-268.91 "/>
<text text-anchor="start" x="423.5" y="-253.71" font-family="Times,serif" font-size="14.00" fill="#40575d">注意此处的conf_change字段是</text>
<text text-anchor="start" x="423.5" y="-238.71" font-family="Times,serif" font-size="14.00" fill="#40575d"> default空消息</text>
<text text-anchor="start" x="423.5" y="-223.71" font-family="Times,serif" font-size="14.00" fill="#40575d"> pub index: u64,</text>
<polyline fill="none" stroke="#f7e495" points="415.5,-215.91 656.5,-215.91 "/>
<text text-anchor="start" x="423.5" y="-200.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub conf_change: ConfChangeV2,</text>
<polyline fill="none" stroke="#f7e495" points="415.5,-192.91 656.5,-192.91 "/>
<text text-anchor="start" x="423.5" y="-177.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub changes: Vec&lt;ChangePeerRequest&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="415.5,-169.91 656.5,-169.91 "/>
<text text-anchor="start" x="423.5" y="-154.71" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region: Region,</text>
</g>
<!-- ExecResult_ChangePeer&#45;&gt;Region -->
<g id="edge9" class="edge">
<title>ExecResult_ChangePeer&#45;&gt;Region</title>
<path fill="none" stroke="#666666" d="M656.61,-208.4C665.75,-206.68 675.17,-204.91 684.78,-203.1"/>
<polygon fill="#666666" stroke="#666666" points="685.67,-206.49 694.85,-201.2 684.38,-199.61 685.67,-206.49"/>
</g>
<!-- exec_change_peer_v2 -->
<g id="node11" class="node">
<title>exec_change_peer_v2</title>
<path fill="none" stroke="#1c2123" d="M141,-743.91C141,-743.91 28,-743.91 28,-743.91 22,-743.91 16,-737.91 16,-731.91 16,-731.91 16,-719.91 16,-719.91 16,-713.91 22,-707.91 28,-707.91 28,-707.91 141,-707.91 141,-707.91 147,-707.91 153,-713.91 153,-719.91 153,-719.91 153,-731.91 153,-731.91 153,-737.91 147,-743.91 141,-743.91"/>
<text text-anchor="middle" x="84.5" y="-722.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">exec_change_peer_v2</text>
</g>
<!-- exec_change_peer_v2&#45;&gt;pending_remove -->
<g id="edge10" class="edge">
<title>exec_change_peer_v2&#45;&gt;pending_remove</title>
<path fill="none" stroke="#666666" d="M87.04,-707.66C94.33,-625.13 127.5,-287.27 189,-203.91 324.79,-19.86 1036.92,75.62 1210,-73.91 1339.34,-185.64 1340.42,-766.46 1338.59,-912.54"/>
<polygon fill="#666666" stroke="#666666" points="1335.09,-912.63 1338.45,-922.67 1342.09,-912.72 1335.09,-912.63"/>
</g>
<!-- exec_change_peer_v2&#45;&gt;write_peer_state -->
<g id="edge11" class="edge">
<title>exec_change_peer_v2&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M94.37,-744.13C133.86,-822.38 302.05,-1125.91 535,-1125.91 535,-1125.91 535,-1125.91 1340,-1125.91 1497.17,-1125.91 1555.39,-1162.36 1691,-1082.91 1727.29,-1061.64 1753.01,-1018.89 1766.93,-990.58"/>
<polygon fill="#666666" stroke="#666666" points="1770.24,-991.77 1771.36,-981.23 1763.92,-988.77 1770.24,-991.77"/>
</g>
<!-- apply_conf_change -->
<g id="node12" class="node">
<title>apply_conf_change</title>
<path fill="none" stroke="#1c2123" d="M425,-627.91C425,-627.91 647,-627.91 647,-627.91 653,-627.91 659,-633.91 659,-639.91 659,-639.91 659,-699.91 659,-699.91 659,-705.91 653,-711.91 647,-711.91 647,-711.91 425,-711.91 425,-711.91 419,-711.91 413,-705.91 413,-699.91 413,-699.91 413,-639.91 413,-639.91 413,-633.91 419,-627.91 425,-627.91"/>
<text text-anchor="middle" x="536" y="-696.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_conf_change</text>
<polyline fill="none" stroke="#1c2123" points="413,-688.91 659,-688.91 "/>
<text text-anchor="start" x="421" y="-673.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新region的ver: conf_ver + changes.len</text>
<text text-anchor="start" x="421" y="-658.71" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新region的peer list</text>
<polyline fill="none" stroke="#1c2123" points="413,-650.91 659,-650.91 "/>
<text text-anchor="start" x="421" y="-635.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新peer的role</text>
</g>
<!-- exec_change_peer_v2&#45;&gt;apply_conf_change -->
<g id="edge12" class="edge">
<title>exec_change_peer_v2&#45;&gt;apply_conf_change</title>
<path fill="none" stroke="#666666" d="M123.43,-707.86C142.63,-699.6 166.57,-690.63 189,-685.91 258.54,-671.27 337.61,-666.73 402.59,-666.1"/>
<polygon fill="#666666" stroke="#666666" points="402.92,-669.59 412.9,-666.03 402.87,-662.59 402.92,-669.59"/>
</g>
<!-- apply_leave_joint -->
<g id="node13" class="node">
<title>apply_leave_joint</title>
<path fill="none" stroke="#1c2123" d="M454.5,-731.41C454.5,-731.41 617.5,-731.41 617.5,-731.41 623.5,-731.41 629.5,-737.41 629.5,-743.41 629.5,-743.41 629.5,-818.41 629.5,-818.41 629.5,-824.41 623.5,-830.41 617.5,-830.41 617.5,-830.41 454.5,-830.41 454.5,-830.41 448.5,-830.41 442.5,-824.41 442.5,-818.41 442.5,-818.41 442.5,-743.41 442.5,-743.41 442.5,-737.41 448.5,-731.41 454.5,-731.41"/>
<text text-anchor="middle" x="536" y="-815.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_leave_joint</text>
<polyline fill="none" stroke="#1c2123" points="442.5,-807.41 629.5,-807.41 "/>
<text text-anchor="start" x="450.5" y="-792.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">将peer角色由:</text>
<text text-anchor="start" x="450.5" y="-777.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> IncomingVoter 改为Voter</text>
<text text-anchor="start" x="450.5" y="-762.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> DemotingVoter 改为Leanner</text>
<polyline fill="none" stroke="#1c2123" points="442.5,-754.41 629.5,-754.41 "/>
<text text-anchor="start" x="450.5" y="-739.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">更改conf_ver += change_num</text>
</g>
<!-- exec_change_peer_v2&#45;&gt;apply_leave_joint -->
<g id="edge13" class="edge">
<title>exec_change_peer_v2&#45;&gt;apply_leave_joint</title>
<path fill="none" stroke="#666666" d="M123.42,-743.98C142.62,-752.24 166.56,-761.22 189,-765.91 269.5,-782.73 362.74,-785.86 432.14,-785.12"/>
<polygon fill="#666666" stroke="#666666" points="432.25,-788.62 442.2,-784.99 432.15,-781.62 432.25,-788.62"/>
</g>
<!-- confchange_kind -->
<g id="node14" class="node">
<title>confchange_kind</title>
<path fill="none" stroke="#1c2123" d="M215.5,-695.41C215.5,-695.41 350.5,-695.41 350.5,-695.41 356.5,-695.41 362.5,-701.41 362.5,-707.41 362.5,-707.41 362.5,-744.41 362.5,-744.41 362.5,-750.41 356.5,-756.41 350.5,-756.41 350.5,-756.41 215.5,-756.41 215.5,-756.41 209.5,-756.41 203.5,-750.41 203.5,-744.41 203.5,-744.41 203.5,-707.41 203.5,-707.41 203.5,-701.41 209.5,-695.41 215.5,-695.41"/>
<text text-anchor="middle" x="283" y="-741.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">confchange_kind</text>
<polyline fill="none" stroke="#1c2123" points="203.5,-733.41 362.5,-733.41 "/>
<text text-anchor="start" x="211.5" y="-718.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据changes的num</text>
<text text-anchor="start" x="211.5" y="-703.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来判断是joint还是leave</text>
</g>
<!-- exec_change_peer_v2&#45;&gt;confchange_kind -->
<g id="edge14" class="edge">
<title>exec_change_peer_v2&#45;&gt;confchange_kind</title>
<path fill="none" stroke="#666666" d="M153.12,-725.91C166.04,-725.91 179.74,-725.91 193.2,-725.91"/>
<polygon fill="#666666" stroke="#666666" points="193.43,-729.41 203.43,-725.91 193.43,-722.41 193.43,-729.41"/>
</g>
<!-- apply_conf_change&#45;&gt;ConfChangeType_RemoveNode -->
<g id="edge18" class="edge">
<title>apply_conf_change&#45;&gt;ConfChangeType_RemoveNode</title>
<path fill="none" stroke="#666666" d="M649.9,-712C653.18,-715.07 656.23,-718.37 659,-721.91 720.63,-800.6 626.67,-870.96 695,-943.91 730.14,-981.42 783.93,-997.36 833.19,-1003.44"/>
<polygon fill="#666666" stroke="#666666" points="832.98,-1006.94 843.3,-1004.56 833.75,-999.98 832.98,-1006.94"/>
</g>
<!-- apply_conf_change&#45;&gt;Region -->
<g id="edge17" class="edge">
<title>apply_conf_change&#45;&gt;Region</title>
<path fill="none" stroke="#666666" d="M552.01,-627.52C590.73,-518.29 691.22,-235.51 695,-231.91 696.13,-230.83 697.28,-229.76 698.44,-228.71"/>
<polygon fill="#666666" stroke="#666666" points="700.98,-231.14 706.3,-221.98 696.43,-225.83 700.98,-231.14"/>
</g>
<!-- find_peer_mut -->
<g id="node15" class="node">
<title>find_peer_mut</title>
<path fill="none" stroke="#1c2123" d="M897.5,-240.91C897.5,-240.91 1007.5,-240.91 1007.5,-240.91 1013.5,-240.91 1019.5,-246.91 1019.5,-252.91 1019.5,-252.91 1019.5,-304.91 1019.5,-304.91 1019.5,-310.91 1013.5,-316.91 1007.5,-316.91 1007.5,-316.91 897.5,-316.91 897.5,-316.91 891.5,-316.91 885.5,-310.91 885.5,-304.91 885.5,-304.91 885.5,-252.91 885.5,-252.91 885.5,-246.91 891.5,-240.91 897.5,-240.91"/>
<text text-anchor="middle" x="952.5" y="-301.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">find_peer_mut</text>
<polyline fill="none" stroke="#1c2123" points="885.5,-293.91 1019.5,-293.91 "/>
<text text-anchor="start" x="893.5" y="-278.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">从region peers中</text>
<text text-anchor="start" x="893.5" y="-263.71" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 根据store_查找peer</text>
<text text-anchor="start" x="893.5" y="-248.71" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 返回可mut peer</text>
</g>
<!-- apply_conf_change&#45;&gt;find_peer_mut -->
<g id="edge19" class="edge">
<title>apply_conf_change&#45;&gt;find_peer_mut</title>
<path fill="none" stroke="#666666" d="M543.66,-627.67C557.62,-554.13 597.14,-403.18 695,-326.91 745.96,-287.18 819.75,-276.82 875.12,-275.44"/>
<polygon fill="#666666" stroke="#666666" points="875.29,-278.94 885.23,-275.28 875.18,-271.94 875.29,-278.94"/>
</g>
<!-- get_region_epoch -->
<g id="node16" class="node">
<title>get_region_epoch</title>
<path fill="none" stroke="#1c2123" d="M997,-371.91C997,-371.91 908,-371.91 908,-371.91 902,-371.91 896,-365.91 896,-359.91 896,-359.91 896,-347.91 896,-347.91 896,-341.91 902,-335.91 908,-335.91 908,-335.91 997,-335.91 997,-335.91 1003,-335.91 1009,-341.91 1009,-347.91 1009,-347.91 1009,-359.91 1009,-359.91 1009,-365.91 1003,-371.91 997,-371.91"/>
<text text-anchor="middle" x="952.5" y="-350.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_region_epoch</text>
</g>
<!-- apply_conf_change&#45;&gt;get_region_epoch -->
<g id="edge20" class="edge">
<title>apply_conf_change&#45;&gt;get_region_epoch</title>
<path fill="none" stroke="#666666" d="M546.76,-627.76C564.24,-562.68 607.56,-439.16 695,-380.91 751.22,-343.45 830.25,-340.77 885.69,-344.88"/>
<polygon fill="#666666" stroke="#666666" points="885.5,-348.37 895.76,-345.72 886.08,-341.4 885.5,-348.37"/>
</g>
<!-- find_peer -->
<g id="node17" class="node">
<title>find_peer</title>
<path fill="none" stroke="#1c2123" d="M897.5,-390.41C897.5,-390.41 1007.5,-390.41 1007.5,-390.41 1013.5,-390.41 1019.5,-396.41 1019.5,-402.41 1019.5,-402.41 1019.5,-439.41 1019.5,-439.41 1019.5,-445.41 1013.5,-451.41 1007.5,-451.41 1007.5,-451.41 897.5,-451.41 897.5,-451.41 891.5,-451.41 885.5,-445.41 885.5,-439.41 885.5,-439.41 885.5,-402.41 885.5,-402.41 885.5,-396.41 891.5,-390.41 897.5,-390.41"/>
<text text-anchor="middle" x="952.5" y="-436.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">find_peer</text>
<polyline fill="none" stroke="#1c2123" points="885.5,-428.41 1019.5,-428.41 "/>
<text text-anchor="start" x="893.5" y="-413.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">从region peers中</text>
<text text-anchor="start" x="893.5" y="-398.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 根据store_查找peer</text>
</g>
<!-- apply_conf_change&#45;&gt;find_peer -->
<g id="edge21" class="edge">
<title>apply_conf_change&#45;&gt;find_peer</title>
<path fill="none" stroke="#666666" d="M556.56,-627.81C581.46,-579.33 629.26,-501.3 695,-461.91 749.33,-429.35 821.25,-420.18 875.11,-418.53"/>
<polygon fill="#666666" stroke="#666666" points="875.37,-422.02 885.29,-418.3 875.21,-415.02 875.37,-422.02"/>
</g>
<!-- set_role -->
<g id="node18" class="node">
<title>set_role</title>
<path fill="none" stroke="#1c2123" d="M970,-1106.91C970,-1106.91 935,-1106.91 935,-1106.91 929,-1106.91 923,-1100.91 923,-1094.91 923,-1094.91 923,-1082.91 923,-1082.91 923,-1076.91 929,-1070.91 935,-1070.91 935,-1070.91 970,-1070.91 970,-1070.91 976,-1070.91 982,-1076.91 982,-1082.91 982,-1082.91 982,-1094.91 982,-1094.91 982,-1100.91 976,-1106.91 970,-1106.91"/>
<text text-anchor="middle" x="952.5" y="-1085.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_role</text>
</g>
<!-- apply_conf_change&#45;&gt;set_role -->
<g id="edge22" class="edge">
<title>apply_conf_change&#45;&gt;set_role</title>
<path fill="none" stroke="#666666" d="M650.4,-712.05C653.51,-715.11 656.4,-718.39 659,-721.91 704.17,-783 641.26,-1008.2 695,-1061.91 752.25,-1119.12 856.52,-1109 912.88,-1098.11"/>
<polygon fill="#666666" stroke="#666666" points="913.72,-1101.51 922.82,-1096.08 912.33,-1094.65 913.72,-1101.51"/>
</g>
<!-- ConfChangeType_AddNode -->
<g id="node19" class="node">
<title>ConfChangeType_AddNode</title>
<path fill="none" stroke="#1c2123" d="M850,-470.91C850,-470.91 1055,-470.91 1055,-470.91 1061,-470.91 1067,-476.91 1067,-482.91 1067,-482.91 1067,-588.91 1067,-588.91 1067,-594.91 1061,-600.91 1055,-600.91 1055,-600.91 850,-600.91 850,-600.91 844,-600.91 838,-594.91 838,-588.91 838,-588.91 838,-482.91 838,-482.91 838,-476.91 844,-470.91 850,-470.91"/>
<text text-anchor="middle" x="952.5" y="-585.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConfChangeType::AddNode</text>
<polyline fill="none" stroke="#1c2123" points="838,-577.91 1067,-577.91 "/>
<text text-anchor="start" x="846" y="-562.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">peer不存在</text>
<polyline fill="none" stroke="#1c2123" points="838,-554.91 1067,-554.91 "/>
<text text-anchor="start" x="846" y="-539.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果ConfChangeKind</text>
<text text-anchor="start" x="846" y="-524.71" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 为Simple: 设置role为Voter</text>
<polyline fill="none" stroke="#1c2123" points="838,-516.91 1067,-516.91 "/>
<text text-anchor="start" x="846" y="-501.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">EnterJoint: 设置role 为IncomingVoter</text>
<polyline fill="none" stroke="#1c2123" points="838,-493.91 1067,-493.91 "/>
<text text-anchor="middle" x="952.5" y="-478.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">将peer加到region的peers中</text>
</g>
<!-- apply_conf_change&#45;&gt;ConfChangeType_AddNode -->
<g id="edge23" class="edge">
<title>apply_conf_change&#45;&gt;ConfChangeType_AddNode</title>
<path fill="none" stroke="#666666" d="M646.71,-627.77C662.84,-621.91 679.3,-616.12 695,-610.91 738.09,-596.58 785.73,-582.25 828.13,-570"/>
<polygon fill="#666666" stroke="#666666" points="829.3,-573.31 837.94,-567.18 827.36,-566.58 829.3,-573.31"/>
</g>
<!-- ConfChangeType_AddLeanerNode -->
<g id="node20" class="node">
<title>ConfChangeType_AddLeanerNode</title>
<path fill="none" stroke="#1c2123" d="M859.5,-620.41C859.5,-620.41 1045.5,-620.41 1045.5,-620.41 1051.5,-620.41 1057.5,-626.41 1057.5,-632.41 1057.5,-632.41 1057.5,-707.41 1057.5,-707.41 1057.5,-713.41 1051.5,-719.41 1045.5,-719.41 1045.5,-719.41 859.5,-719.41 859.5,-719.41 853.5,-719.41 847.5,-713.41 847.5,-707.41 847.5,-707.41 847.5,-632.41 847.5,-632.41 847.5,-626.41 853.5,-620.41 859.5,-620.41"/>
<text text-anchor="middle" x="952.5" y="-704.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConfChangeType::AddLeanerNode</text>
<polyline fill="none" stroke="#1c2123" points="847.5,-696.41 1057.5,-696.41 "/>
<text text-anchor="start" x="855.5" y="-681.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">peer不存在</text>
<polyline fill="none" stroke="#1c2123" points="847.5,-673.41 1057.5,-673.41 "/>
<text text-anchor="start" x="855.5" y="-658.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">将role设置为learner</text>
<text text-anchor="start" x="855.5" y="-643.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并加入region的peers中</text>
<text text-anchor="start" x="855.5" y="-628.21" font-family="Times,serif" font-size="14.00" fill="#2f3638"> leaner不能投票</text>
</g>
<!-- apply_conf_change&#45;&gt;ConfChangeType_AddLeanerNode -->
<g id="edge24" class="edge">
<title>apply_conf_change&#45;&gt;ConfChangeType_AddLeanerNode</title>
<path fill="none" stroke="#666666" d="M659.12,-669.91C715.44,-669.91 781.9,-669.91 837.22,-669.91"/>
<polygon fill="#666666" stroke="#666666" points="837.41,-673.41 847.41,-669.91 837.41,-666.41 837.41,-673.41"/>
</g>
<!-- ConfChangeType_AddLearnerNode_voter -->
<g id="node21" class="node">
<title>ConfChangeType_AddLearnerNode_voter</title>
<path fill="none" stroke="#1c2123" d="M849,-738.91C849,-738.91 1056,-738.91 1056,-738.91 1062,-738.91 1068,-744.91 1068,-750.91 1068,-750.91 1068,-810.91 1068,-810.91 1068,-816.91 1062,-822.91 1056,-822.91 1056,-822.91 849,-822.91 849,-822.91 843,-822.91 837,-816.91 837,-810.91 837,-810.91 837,-750.91 837,-750.91 837,-744.91 843,-738.91 849,-738.91"/>
<text text-anchor="start" x="845" y="-807.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConfChangeType::AddLeanerNode</text>
<polyline fill="none" stroke="#1c2123" points="837,-799.91 1068,-799.91 "/>
<text text-anchor="start" x="845" y="-784.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">peer存在且是voter</text>
<polyline fill="none" stroke="#1c2123" points="837,-776.91 1068,-776.91 "/>
<text text-anchor="start" x="845" y="-761.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">Simple: 设置role为Learner</text>
<text text-anchor="start" x="845" y="-746.71" font-family="Times,serif" font-size="14.00" fill="#2f3638"> EnterJoint: 设置role为DemotingVoter</text>
</g>
<!-- apply_conf_change&#45;&gt;ConfChangeType_AddLearnerNode_voter -->
<g id="edge25" class="edge">
<title>apply_conf_change&#45;&gt;ConfChangeType_AddLearnerNode_voter</title>
<path fill="none" stroke="#666666" d="M642.9,-712.05C660.16,-718.17 677.97,-724.03 695,-728.91 737.46,-741.06 784.66,-751.48 826.88,-759.73"/>
<polygon fill="#666666" stroke="#666666" points="826.45,-763.21 836.93,-761.67 827.78,-756.34 826.45,-763.21"/>
</g>
<!-- ConfChangeType_AddNode_Learner -->
<g id="node22" class="node">
<title>ConfChangeType_AddNode_Learner</title>
<path fill="none" stroke="#1c2123" d="M852,-841.91C852,-841.91 1053,-841.91 1053,-841.91 1059,-841.91 1065,-847.91 1065,-853.91 1065,-853.91 1065,-921.91 1065,-921.91 1065,-927.91 1059,-933.91 1053,-933.91 1053,-933.91 852,-933.91 852,-933.91 846,-933.91 840,-927.91 840,-921.91 840,-921.91 840,-853.91 840,-853.91 840,-847.91 846,-841.91 852,-841.91"/>
<text text-anchor="middle" x="952.5" y="-918.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConfChangeType_AddNode_Learner</text>
<polyline fill="none" stroke="#1c2123" points="840,-910.91 1065,-910.91 "/>
<text text-anchor="start" x="848" y="-895.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">peer存在且是learner</text>
<polyline fill="none" stroke="#1c2123" points="840,-887.91 1065,-887.91 "/>
<text text-anchor="start" x="848" y="-872.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">Simple: 设置role为Voter</text>
<polyline fill="none" stroke="#1c2123" points="840,-864.91 1065,-864.91 "/>
<text text-anchor="start" x="848" y="-849.71" font-family="Times,serif" font-size="14.00" fill="#2f3638">EnterJoint: 设置role为IncomingVoter</text>
</g>
<!-- apply_conf_change&#45;&gt;ConfChangeType_AddNode_Learner -->
<g id="edge26" class="edge">
<title>apply_conf_change&#45;&gt;ConfChangeType_AddNode_Learner</title>
<path fill="none" stroke="#666666" d="M648.69,-712.12C652.36,-715.16 655.81,-718.42 659,-721.91 694,-760.18 656.5,-798.16 695,-832.91 731.46,-865.81 782.71,-880.75 829.83,-887.03"/>
<polygon fill="#666666" stroke="#666666" points="829.46,-890.51 839.81,-888.24 830.3,-883.56 829.46,-890.51"/>
</g>
<!-- apply_leave_joint&#45;&gt;set_role -->
<g id="edge27" class="edge">
<title>apply_leave_joint&#45;&gt;set_role</title>
<path fill="none" stroke="#666666" d="M549.62,-830.5C569.01,-895.58 612.82,-1007.86 695,-1061.91 761.46,-1105.62 859.21,-1101.66 912.81,-1095.15"/>
<polygon fill="#666666" stroke="#666666" points="913.46,-1098.59 922.92,-1093.83 912.55,-1091.65 913.46,-1098.59"/>
</g>
<!-- confchange_kind&#45;&gt;apply_conf_change -->
<g id="edge15" class="edge">
<title>confchange_kind&#45;&gt;apply_conf_change</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M362.73,-708.34C375.57,-705.48 389.17,-702.44 402.88,-699.38"/>
<polygon fill="green" stroke="green" points="403.88,-702.75 412.88,-697.15 402.35,-695.91 403.88,-702.75"/>
</g>
<!-- confchange_kind&#45;&gt;apply_leave_joint -->
<g id="edge16" class="edge">
<title>confchange_kind&#45;&gt;apply_leave_joint</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M362.73,-743.16C384.87,-748.01 409.28,-753.36 432.58,-758.46"/>
<polygon fill="green" stroke="green" points="431.98,-761.91 442.49,-760.64 433.48,-755.08 431.98,-761.91"/>
</g>
<!-- handle_raft_entry_conf_change -->
<g id="node23" class="node">
<title>handle_raft_entry_conf_change</title>
<path fill="none" stroke="#1c2123" d="M365,-248.91C365,-248.91 201,-248.91 201,-248.91 195,-248.91 189,-242.91 189,-236.91 189,-236.91 189,-224.91 189,-224.91 189,-218.91 195,-212.91 201,-212.91 201,-212.91 365,-212.91 365,-212.91 371,-212.91 377,-218.91 377,-224.91 377,-224.91 377,-236.91 377,-236.91 377,-242.91 371,-248.91 365,-248.91"/>
<text text-anchor="middle" x="283" y="-227.21" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_entry_conf_change</text>
</g>
<!-- handle_raft_entry_conf_change&#45;&gt;ExecResult_ChangePeer -->
<g id="edge28" class="edge">
<title>handle_raft_entry_conf_change&#45;&gt;ExecResult_ChangePeer</title>
<path fill="none" stroke="#666666" d="M377.11,-230.91C386.23,-230.91 395.59,-230.91 404.99,-230.91"/>
<polygon fill="#666666" stroke="#666666" points="405.19,-234.41 415.19,-230.91 405.19,-227.41 405.19,-234.41"/>
</g>
</g>
</svg>
