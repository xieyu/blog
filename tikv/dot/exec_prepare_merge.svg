<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: exec_prepar_merge Pages: 1 -->
<svg width="522pt" height="514pt"
 viewBox="0.00 0.00 522.00 513.91" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 509.91)">
<title>exec_prepar_merge</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-509.91 518,-509.91 518,4 -4,4"/>
<!-- ApplyDelegate__exec_prepare_merge -->
<g id="node1" class="node">
<title>ApplyDelegate__exec_prepare_merge</title>
<path fill="none" stroke="#1c2123" d="M12,-217.51C12,-217.51 147,-217.51 147,-217.51 153,-217.51 159,-223.51 159,-229.51 159,-229.51 159,-319.51 159,-319.51 159,-325.51 153,-331.51 147,-331.51 147,-331.51 12,-331.51 12,-331.51 6,-331.51 0,-325.51 0,-319.51 0,-319.51 0,-229.51 0,-229.51 0,-223.51 6,-217.51 12,-217.51"/>
<text text-anchor="start" x="8" y="-316.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="8" y="-301.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> exec_prepare_merge</text>
<polyline fill="none" stroke="#1c2123" points="0,-293.51 159,-293.51 "/>
<text text-anchor="start" x="8" y="-278.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">更改region epoch</text>
<text text-anchor="start" x="8" y="-263.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的conf_ver</text>
<polyline fill="none" stroke="#1c2123" points="0,-255.51 159,-255.51 "/>
<text text-anchor="start" x="8" y="-240.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置Peer状态为Merging</text>
<text text-anchor="start" x="8" y="-225.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 保存MergeState</text>
</g>
<!-- region__mut_region_epoch__set_version -->
<g id="node2" class="node">
<title>region__mut_region_epoch__set_version</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M229.5,-297.51C229.5,-297.51 327.5,-297.51 327.5,-297.51 333.5,-297.51 339.5,-303.51 339.5,-309.51 339.5,-309.51 339.5,-361.51 339.5,-361.51 339.5,-367.51 333.5,-373.51 327.5,-373.51 327.5,-373.51 229.5,-373.51 229.5,-373.51 223.5,-373.51 217.5,-367.51 217.5,-361.51 217.5,-361.51 217.5,-309.51 217.5,-309.51 217.5,-303.51 223.5,-297.51 229.5,-297.51"/>
<text text-anchor="start" x="225.5" y="-358.31" font-family="Times,serif" font-size="14.00" fill="#5d6179">region</text>
<text text-anchor="start" x="225.5" y="-343.31" font-family="Times,serif" font-size="14.00" fill="#5d6179"> mut_region_epoch</text>
<text text-anchor="start" x="225.5" y="-328.31" font-family="Times,serif" font-size="14.00" fill="#5d6179"> set_version</text>
<polyline fill="none" stroke="#8a8898" points="217.5,-320.51 339.5,-320.51 "/>
<text text-anchor="start" x="225.5" y="-305.31" font-family="Times,serif" font-size="14.00" fill="#5d6179">将version + 1</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;region__mut_region_epoch__set_version -->
<g id="edge1" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;region__mut_region_epoch__set_version</title>
<path fill="none" stroke="#666666" d="M159.21,-298.88C175.27,-303.85 192.07,-309.05 207.79,-313.92"/>
<polygon fill="#666666" stroke="#666666" points="206.84,-317.29 217.43,-316.9 208.91,-310.6 206.84,-317.29"/>
</g>
<!-- region__mut_region_epoch__set_conf_ver -->
<g id="node3" class="node">
<title>region__mut_region_epoch__set_conf_ver</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M207,-149.01C207,-149.01 350,-149.01 350,-149.01 356,-149.01 362,-155.01 362,-161.01 362,-161.01 362,-266.01 362,-266.01 362,-272.01 356,-278.01 350,-278.01 350,-278.01 207,-278.01 207,-278.01 201,-278.01 195,-272.01 195,-266.01 195,-266.01 195,-161.01 195,-161.01 195,-155.01 201,-149.01 207,-149.01"/>
<text text-anchor="start" x="203" y="-262.81" font-family="Times,serif" font-size="14.00" fill="#5d6179">region</text>
<text text-anchor="start" x="203" y="-247.81" font-family="Times,serif" font-size="14.00" fill="#5d6179"> mut_region_epoch</text>
<text text-anchor="start" x="203" y="-232.81" font-family="Times,serif" font-size="14.00" fill="#5d6179"> set_conf_ver</text>
<polyline fill="none" stroke="#8a8898" points="195,-225.01 362,-225.01 "/>
<text text-anchor="start" x="203" y="-209.81" font-family="Times,serif" font-size="14.00" fill="#5d6179">将conf_ver + 1</text>
<polyline fill="none" stroke="#8a8898" points="195,-202.01 362,-202.01 "/>
<text text-anchor="start" x="203" y="-186.81" font-family="Times,serif" font-size="14.00" fill="#5d6179">we don&#39;t want to do</text>
<text text-anchor="start" x="203" y="-171.81" font-family="Times,serif" font-size="14.00" fill="#5d6179"> conf change after</text>
<text text-anchor="start" x="203" y="-156.81" font-family="Times,serif" font-size="14.00" fill="#5d6179"> prepare_merge is comitted</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;region__mut_region_epoch__set_conf_ver -->
<g id="edge2" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;region__mut_region_epoch__set_conf_ver</title>
<path fill="none" stroke="#666666" d="M159.21,-250.13C167.7,-247.51 176.39,-244.81 185.02,-242.14"/>
<polygon fill="#666666" stroke="#666666" points="186.2,-245.44 194.72,-239.14 184.13,-238.75 186.2,-245.44"/>
</g>
<!-- MergeState -->
<g id="node4" class="node">
<title>MergeState</title>
<path fill="none" stroke="#1c2123" d="M210,-37.51C210,-37.51 347,-37.51 347,-37.51 353,-37.51 359,-43.51 359,-49.51 359,-49.51 359,-117.51 359,-117.51 359,-123.51 353,-129.51 347,-129.51 347,-129.51 210,-129.51 210,-129.51 204,-129.51 198,-123.51 198,-117.51 198,-117.51 198,-49.51 198,-49.51 198,-43.51 204,-37.51 210,-37.51"/>
<text text-anchor="middle" x="278.5" y="-114.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">MergeState</text>
<polyline fill="none" stroke="#1c2123" points="198,-106.51 359,-106.51 "/>
<text text-anchor="start" x="206" y="-91.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 min_index = 1;</text>
<polyline fill="none" stroke="#1c2123" points="198,-83.51 359,-83.51 "/>
<text text-anchor="start" x="206" y="-68.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">metapb.Region target = 2;</text>
<polyline fill="none" stroke="#1c2123" points="198,-60.51 359,-60.51 "/>
<text text-anchor="start" x="206" y="-45.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 commit = 3;</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;MergeState -->
<g id="edge3" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;MergeState</title>
<path fill="none" stroke="#666666" d="M123.32,-217.25C143.6,-191.99 169.05,-162.81 195,-139.51 196.28,-138.35 197.59,-137.2 198.92,-136.06"/>
<polygon fill="#666666" stroke="#666666" points="201.27,-138.67 206.75,-129.6 196.81,-133.27 201.27,-138.67"/>
</g>
<!-- write_peer_state -->
<g id="node5" class="node">
<title>write_peer_state</title>
<path fill="none" stroke="#1c2123" d="M497,-353.51C497,-353.51 415,-353.51 415,-353.51 409,-353.51 403,-347.51 403,-341.51 403,-341.51 403,-329.51 403,-329.51 403,-323.51 409,-317.51 415,-317.51 415,-317.51 497,-317.51 497,-317.51 503,-317.51 509,-323.51 509,-329.51 509,-329.51 509,-341.51 509,-341.51 509,-347.51 503,-353.51 497,-353.51"/>
<text text-anchor="middle" x="456" y="-331.81" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_peer_state</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;write_peer_state -->
<g id="edge4" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M95.15,-331.76C110.95,-380.37 141.38,-447.11 195,-478.51 259.05,-516.01 296.76,-513.9 362,-478.51 406.94,-454.12 433.56,-397.59 446.13,-363.36"/>
<polygon fill="#666666" stroke="#666666" points="449.58,-364.11 449.59,-353.52 442.98,-361.79 449.58,-364.11"/>
</g>
<!-- PeerState__Merging -->
<g id="node6" class="node">
<title>PeerState__Merging</title>
<path fill="none" stroke="#1c2123" d="M236,-392.51C236,-392.51 321,-392.51 321,-392.51 327,-392.51 333,-398.51 333,-404.51 333,-404.51 333,-456.51 333,-456.51 333,-462.51 327,-468.51 321,-468.51 321,-468.51 236,-468.51 236,-468.51 230,-468.51 224,-462.51 224,-456.51 224,-456.51 224,-404.51 224,-404.51 224,-398.51 230,-392.51 236,-392.51"/>
<text text-anchor="start" x="232" y="-453.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerState</text>
<text text-anchor="start" x="232" y="-438.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Merging</text>
<polyline fill="none" stroke="#1c2123" points="224,-430.51 333,-430.51 "/>
<text text-anchor="start" x="232" y="-415.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">将当前peerstate</text>
<text text-anchor="start" x="232" y="-400.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置为merging</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;PeerState__Merging -->
<g id="edge5" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;PeerState__Merging</title>
<path fill="none" stroke="#666666" d="M135.15,-331.72C153.36,-349.33 174.3,-368.11 195,-383.51 201.32,-388.21 208.17,-392.79 215.11,-397.14"/>
<polygon fill="#666666" stroke="#666666" points="213.56,-400.3 223.92,-402.51 217.21,-394.32 213.56,-400.3"/>
</g>
<!-- ExecResult__PrepareMerge -->
<g id="node7" class="node">
<title>ExecResult__PrepareMerge</title>
<path fill="none" stroke="#1c2123" d="M410,-106.51C410,-106.51 502,-106.51 502,-106.51 508,-106.51 514,-112.51 514,-118.51 514,-118.51 514,-178.51 514,-178.51 514,-184.51 508,-190.51 502,-190.51 502,-190.51 410,-190.51 410,-190.51 404,-190.51 398,-184.51 398,-178.51 398,-178.51 398,-118.51 398,-118.51 398,-112.51 404,-106.51 410,-106.51"/>
<text text-anchor="start" x="406" y="-175.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecResult</text>
<text text-anchor="start" x="406" y="-160.31" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PrepareMerge</text>
<polyline fill="none" stroke="#1c2123" points="398,-152.51 514,-152.51 "/>
<text text-anchor="start" x="406" y="-137.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">region: Region,</text>
<polyline fill="none" stroke="#1c2123" points="398,-129.51 514,-129.51 "/>
<text text-anchor="start" x="406" y="-114.31" font-family="Times,serif" font-size="14.00" fill="#2f3638">state: MergeState,</text>
</g>
<!-- ApplyDelegate__exec_prepare_merge&#45;&gt;ExecResult__PrepareMerge -->
<g id="edge6" class="edge">
<title>ApplyDelegate__exec_prepare_merge&#45;&gt;ExecResult__PrepareMerge</title>
<path fill="none" stroke="#666666" d="M89.03,-217.36C101.23,-158.32 129.87,-69.1 195,-27.51 257.55,12.45 295.42,5.3 362,-27.51 391.79,-42.18 414.7,-71.49 430.33,-97.58"/>
<polygon fill="#666666" stroke="#666666" points="427.32,-99.37 435.35,-106.28 433.38,-95.87 427.32,-99.37"/>
</g>
<!-- region__mut_region_epoch__set_version&#45;&gt;write_peer_state -->
<g id="edge10" class="edge">
<title>region__mut_region_epoch__set_version&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M339.9,-335.51C356.89,-335.51 375.41,-335.51 392.53,-335.51"/>
<polygon fill="#666666" stroke="#666666" points="392.98,-339.01 402.98,-335.51 392.98,-332.01 392.98,-339.01"/>
</g>
<!-- region__mut_region_epoch__set_version&#45;&gt;ExecResult__PrepareMerge -->
<g id="edge8" class="edge">
<title>region__mut_region_epoch__set_version&#45;&gt;ExecResult__PrepareMerge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M339.93,-304.74C347.76,-299.52 355.36,-293.74 362,-287.51 388.83,-262.31 411.9,-227.97 428.34,-199.74"/>
<polygon fill="green" stroke="green" points="431.53,-201.22 433.45,-190.8 425.45,-197.75 431.53,-201.22"/>
</g>
<!-- region__mut_region_epoch__set_conf_ver&#45;&gt;write_peer_state -->
<g id="edge11" class="edge">
<title>region__mut_region_epoch__set_conf_ver&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M362.11,-270.93C382.7,-285.25 403.67,-299.83 420.47,-311.5"/>
<polygon fill="#666666" stroke="#666666" points="418.64,-314.49 428.84,-317.32 422.63,-308.74 418.64,-314.49"/>
</g>
<!-- region__mut_region_epoch__set_conf_ver&#45;&gt;ExecResult__PrepareMerge -->
<g id="edge9" class="edge">
<title>region__mut_region_epoch__set_conf_ver&#45;&gt;ExecResult__PrepareMerge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M362.11,-182.91C370.9,-179.65 379.75,-176.38 388.32,-173.2"/>
<polygon fill="green" stroke="green" points="389.69,-176.43 397.85,-169.67 387.26,-169.86 389.69,-176.43"/>
</g>
<!-- MergeState&#45;&gt;write_peer_state -->
<g id="edge12" class="edge">
<title>MergeState&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M352.53,-129.62C355.89,-132.79 359.07,-136.09 362,-139.51 385.17,-166.53 424.84,-260.53 444,-307.85"/>
<polygon fill="#666666" stroke="#666666" points="440.78,-309.23 447.76,-317.2 447.28,-306.61 440.78,-309.23"/>
</g>
<!-- MergeState&#45;&gt;ExecResult__PrepareMerge -->
<g id="edge7" class="edge">
<title>MergeState&#45;&gt;ExecResult__PrepareMerge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M359.03,-112.96C368.83,-116.59 378.76,-120.27 388.34,-123.82"/>
<polygon fill="green" stroke="green" points="387.18,-127.12 397.78,-127.31 389.62,-120.56 387.18,-127.12"/>
</g>
<!-- PeerState__Merging&#45;&gt;write_peer_state -->
<g id="edge13" class="edge">
<title>PeerState__Merging&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M333.11,-401.49C358.67,-387.65 388.82,-371.33 412.73,-358.39"/>
<polygon fill="#666666" stroke="#666666" points="414.44,-361.44 421.57,-353.6 411.11,-355.28 414.44,-361.44"/>
</g>
</g>
</svg>
