<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: follower_apply_reads Pages: 1 -->
<svg width="1060pt" height="868pt"
 viewBox="0.00 0.00 1060.00 868.04" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 864.04)">
<title>follower_apply_reads</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-864.04 1056,-864.04 1056,4 -4,4"/>
<!-- Peer__apply_reads -->
<g id="node1" class="node">
<title>Peer__apply_reads</title>
<path fill="none" stroke="#1c2123" d="M129.5,-150.5C129.5,-150.5 34.5,-150.5 34.5,-150.5 28.5,-150.5 22.5,-144.5 22.5,-138.5 22.5,-138.5 22.5,-126.5 22.5,-126.5 22.5,-120.5 28.5,-114.5 34.5,-114.5 34.5,-114.5 129.5,-114.5 129.5,-114.5 135.5,-114.5 141.5,-120.5 141.5,-126.5 141.5,-126.5 141.5,-138.5 141.5,-138.5 141.5,-144.5 135.5,-150.5 129.5,-150.5"/>
<text text-anchor="middle" x="82" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__apply_reads</text>
</g>
<!-- ReadIndexQueue__advance_replica_reads -->
<g id="node2" class="node">
<title>ReadIndexQueue__advance_replica_reads</title>
<path fill="none" stroke="#1c2123" d="M222.5,-128.5C222.5,-128.5 401.5,-128.5 401.5,-128.5 407.5,-128.5 413.5,-134.5 413.5,-140.5 413.5,-140.5 413.5,-230.5 413.5,-230.5 413.5,-236.5 407.5,-242.5 401.5,-242.5 401.5,-242.5 222.5,-242.5 222.5,-242.5 216.5,-242.5 210.5,-236.5 210.5,-230.5 210.5,-230.5 210.5,-140.5 210.5,-140.5 210.5,-134.5 216.5,-128.5 222.5,-128.5"/>
<text text-anchor="start" x="218.5" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<text text-anchor="start" x="218.5" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> advance_replica_reads</text>
<polyline fill="none" stroke="#1c2123" points="210.5,-204.5 413.5,-204.5 "/>
<text text-anchor="start" x="218.5" y="-189.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据context使用uuid找到</text>
<text text-anchor="start" x="218.5" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应的ReadIndexRequest</text>
<text text-anchor="start" x="218.5" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后设置它的read_index</text>
<polyline fill="none" stroke="#1c2123" points="210.5,-151.5 413.5,-151.5 "/>
<text text-anchor="start" x="218.5" y="-136.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">会将addtion_request设置为None</text>
</g>
<!-- Peer__apply_reads&#45;&gt;ReadIndexQueue__advance_replica_reads -->
<g id="edge1" class="edge">
<title>Peer__apply_reads&#45;&gt;ReadIndexQueue__advance_replica_reads</title>
<path fill="none" stroke="#666666" d="M141.72,-146.15C159.74,-150.34 180.21,-155.1 200.52,-159.82"/>
<polygon fill="#666666" stroke="#666666" points="199.94,-163.28 210.47,-162.13 201.52,-156.46 199.94,-163.28"/>
</g>
<!-- Peer__post_pending_read_index_on_replica -->
<g id="node3" class="node">
<title>Peer__post_pending_read_index_on_replica</title>
<path fill="none" stroke="#1c2123" d="M212,-414.5C212,-414.5 412,-414.5 412,-414.5 418,-414.5 424,-420.5 424,-426.5 424,-426.5 424,-478.5 424,-478.5 424,-484.5 418,-490.5 412,-490.5 412,-490.5 212,-490.5 212,-490.5 206,-490.5 200,-484.5 200,-478.5 200,-478.5 200,-426.5 200,-426.5 200,-420.5 206,-414.5 212,-414.5"/>
<text text-anchor="start" x="208" y="-475.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="208" y="-460.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> post_pending_read_index_on_replica</text>
<polyline fill="none" stroke="#1c2123" points="200,-452.5 424,-452.5 "/>
<text text-anchor="start" x="208" y="-437.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">看已经ready的reads</text>
<text text-anchor="start" x="208" y="-422.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 能否调用它的回调函数</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Peer__post_pending_read_index_on_replica -->
<g id="edge2" class="edge">
<title>Peer__apply_reads&#45;&gt;Peer__post_pending_read_index_on_replica</title>
<path fill="none" stroke="#666666" d="M95.91,-150.62C130.58,-199.28 226.55,-333.97 277.77,-405.86"/>
<polygon fill="#666666" stroke="#666666" points="275.14,-408.2 283.79,-414.31 280.84,-404.13 275.14,-408.2"/>
</g>
<!-- ReadIndexQueue__clear_uncommitted_role_change -->
<g id="node4" class="node">
<title>ReadIndexQueue__clear_uncommitted_role_change</title>
<path fill="none" stroke="#1c2123" d="M485.5,-0.5C485.5,-0.5 660.5,-0.5 660.5,-0.5 666.5,-0.5 672.5,-6.5 672.5,-12.5 672.5,-12.5 672.5,-26.5 672.5,-26.5 672.5,-32.5 666.5,-38.5 660.5,-38.5 660.5,-38.5 485.5,-38.5 485.5,-38.5 479.5,-38.5 473.5,-32.5 473.5,-26.5 473.5,-26.5 473.5,-12.5 473.5,-12.5 473.5,-6.5 479.5,-0.5 485.5,-0.5"/>
<text text-anchor="start" x="481.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<text text-anchor="start" x="481.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> clear_uncommitted_role_change</text>
</g>
<!-- Peer__apply_reads&#45;&gt;ReadIndexQueue__clear_uncommitted_role_change -->
<g id="edge3" class="edge">
<title>Peer__apply_reads&#45;&gt;ReadIndexQueue__clear_uncommitted_role_change</title>
<path fill="none" stroke="#666666" d="M98.64,-114.32C119.25,-91.83 157.88,-54.55 200,-38.5 284.3,-6.39 387.17,-3.63 463.35,-7.77"/>
<polygon fill="#666666" stroke="#666666" points="463.26,-11.27 473.45,-8.37 463.67,-4.28 463.26,-11.27"/>
</g>
<!-- Ready__ss__is_some -->
<g id="node5" class="node">
<title>Ready__ss__is_some</title>
<path fill="none" stroke="#1c2123" d="M239,-48C239,-48 385,-48 385,-48 391,-48 397,-54 397,-60 397,-60 397,-97 397,-97 397,-103 391,-109 385,-109 385,-109 239,-109 239,-109 233,-109 227,-103 227,-97 227,-97 227,-60 227,-60 227,-54 233,-48 239,-48"/>
<text text-anchor="middle" x="312" y="-93.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Ready.ss.is_some()</text>
<polyline fill="none" stroke="#1c2123" points="227,-86 397,-86 "/>
<text text-anchor="start" x="235" y="-70.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader_id</text>
<text text-anchor="start" x="235" y="-55.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者role角色发生了变化</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Ready__ss__is_some -->
<g id="edge4" class="edge">
<title>Peer__apply_reads&#45;&gt;Ready__ss__is_some</title>
<path fill="none" stroke="#666666" d="M141.72,-118.59C164.55,-113.19 191.28,-106.85 216.67,-100.84"/>
<polygon fill="#666666" stroke="#666666" points="217.77,-104.18 226.7,-98.47 216.16,-97.37 217.77,-104.18"/>
</g>
<!-- ReadIndexQueue__contexts -->
<g id="node6" class="node">
<title>ReadIndexQueue__contexts</title>
<path fill="#feed9b" stroke="#f7e495" d="M504,-96.5C504,-96.5 642,-96.5 642,-96.5 648,-96.5 654,-102.5 654,-108.5 654,-108.5 654,-160.5 654,-160.5 654,-166.5 648,-172.5 642,-172.5 642,-172.5 504,-172.5 504,-172.5 498,-172.5 492,-166.5 492,-160.5 492,-160.5 492,-108.5 492,-108.5 492,-102.5 498,-96.5 504,-96.5"/>
<text text-anchor="start" x="500" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ReadIndexQueue</text>
<text text-anchor="start" x="500" y="-142.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> contexts</text>
<polyline fill="none" stroke="#f7e495" points="492,-134.5 654,-134.5 "/>
<text text-anchor="start" x="500" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#40575d">从uuid 到在reads 数组中</text>
<text text-anchor="start" x="500" y="-104.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> offset的映射</text>
</g>
<!-- ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__contexts -->
<g id="edge5" class="edge">
<title>ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__contexts</title>
<path fill="none" stroke="#666666" d="M413.51,-165.71C435.95,-161.29 459.62,-156.63 481.62,-152.3"/>
<polygon fill="#666666" stroke="#666666" points="482.47,-155.7 491.6,-150.33 481.11,-148.83 482.47,-155.7"/>
</g>
<!-- ReadIndexQueue__fold -->
<g id="node7" class="node">
<title>ReadIndexQueue__fold</title>
<path fill="none" stroke="#1c2123" d="M764,-91.5C764,-91.5 850,-91.5 850,-91.5 856,-91.5 862,-97.5 862,-103.5 862,-103.5 862,-117.5 862,-117.5 862,-123.5 856,-129.5 850,-129.5 850,-129.5 764,-129.5 764,-129.5 758,-129.5 752,-123.5 752,-117.5 752,-117.5 752,-103.5 752,-103.5 752,-97.5 758,-91.5 764,-91.5"/>
<text text-anchor="start" x="760" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<text text-anchor="start" x="760" y="-99.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> fold</text>
</g>
<!-- ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__fold -->
<g id="edge6" class="edge">
<title>ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__fold</title>
<path fill="none" stroke="#666666" d="M409.9,-128.36C414.72,-125.1 419.44,-121.8 424,-118.5 441.1,-106.11 440.21,-94.85 460,-87.5 553.52,-52.78 670.94,-72.65 742.14,-90.98"/>
<polygon fill="#666666" stroke="#666666" points="741.31,-94.38 751.87,-93.55 743.09,-87.61 741.31,-94.38"/>
</g>
<!-- ReadIndexQueue__reads -->
<g id="node8" class="node">
<title>ReadIndexQueue__reads</title>
<path fill="#feed9b" stroke="#f7e495" d="M947,-268.5C947,-268.5 1033,-268.5 1033,-268.5 1039,-268.5 1045,-274.5 1045,-280.5 1045,-280.5 1045,-294.5 1045,-294.5 1045,-300.5 1039,-306.5 1033,-306.5 1033,-306.5 947,-306.5 947,-306.5 941,-306.5 935,-300.5 935,-294.5 935,-294.5 935,-280.5 935,-280.5 935,-274.5 941,-268.5 947,-268.5"/>
<text text-anchor="start" x="943" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#40575d">ReadIndexQueue</text>
<text text-anchor="start" x="943" y="-276.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> reads</text>
</g>
<!-- ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__reads -->
<g id="edge7" class="edge">
<title>ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexQueue__reads</title>
<path fill="none" stroke="#666666" d="M413.54,-191.97C488.84,-197.59 594.25,-207.13 686,-221.5 769.26,-234.54 863.99,-256.31 925.03,-271.26"/>
<polygon fill="#666666" stroke="#666666" points="924.36,-274.7 934.9,-273.69 926.03,-267.9 924.36,-274.7"/>
</g>
<!-- ReadIndexRequest__addtion_request -->
<g id="node9" class="node">
<title>ReadIndexRequest__addtion_request</title>
<path fill="none" stroke="#1c2123" d="M501.5,-230.5C501.5,-230.5 644.5,-230.5 644.5,-230.5 650.5,-230.5 656.5,-236.5 656.5,-242.5 656.5,-242.5 656.5,-354.5 656.5,-354.5 656.5,-360.5 650.5,-366.5 644.5,-366.5 644.5,-366.5 501.5,-366.5 501.5,-366.5 495.5,-366.5 489.5,-360.5 489.5,-354.5 489.5,-354.5 489.5,-242.5 489.5,-242.5 489.5,-236.5 495.5,-230.5 501.5,-230.5"/>
<text text-anchor="start" x="497.5" y="-351.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexRequest</text>
<text text-anchor="start" x="497.5" y="-336.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> addtion_request</text>
<polyline fill="none" stroke="#1c2123" points="489.5,-328.5 656.5,-328.5 "/>
<text text-anchor="start" x="497.5" y="-313.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">the response of this</text>
<text text-anchor="start" x="497.5" y="-298.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read index request</text>
<text text-anchor="start" x="497.5" y="-283.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is lost</text>
<text text-anchor="start" x="497.5" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> but we need it for </text>
<text text-anchor="start" x="497.5" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> the memory lock checking</text>
<text text-anchor="start" x="497.5" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReSend the request</text>
</g>
<!-- ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexRequest__addtion_request -->
<g id="edge22" class="edge">
<title>ReadIndexQueue__advance_replica_reads&#45;&gt;ReadIndexRequest__addtion_request</title>
<path fill="none" stroke="#666666" d="M413.51,-229.35C435.31,-238.86 458.26,-248.88 479.73,-258.24"/>
<polygon fill="#666666" stroke="#666666" points="478.58,-261.56 489.15,-262.35 481.38,-255.15 478.58,-261.56"/>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexRequest__addtion_request -->
<g id="edge8" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexRequest__addtion_request</title>
<path fill="none" stroke="#666666" d="M377.02,-414.43C408.23,-395.88 446.33,-373.22 480.54,-352.88"/>
<polygon fill="#666666" stroke="#666666" points="482.34,-355.89 489.14,-347.77 478.76,-349.87 482.34,-355.89"/>
</g>
<!-- Peer__send_read_command -->
<g id="node10" class="node">
<title>Peer__send_read_command</title>
<path fill="none" stroke="#1c2123" d="M880,-316.5C880,-316.5 734,-316.5 734,-316.5 728,-316.5 722,-310.5 722,-304.5 722,-304.5 722,-292.5 722,-292.5 722,-286.5 728,-280.5 734,-280.5 734,-280.5 880,-280.5 880,-280.5 886,-280.5 892,-286.5 892,-292.5 892,-292.5 892,-304.5 892,-304.5 892,-310.5 886,-316.5 880,-316.5"/>
<text text-anchor="middle" x="807" y="-294.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__send_read_command</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;Peer__send_read_command -->
<g id="edge9" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;Peer__send_read_command</title>
<path fill="none" stroke="#666666" d="M424.14,-418.22C436.19,-415.03 448.31,-412.05 460,-409.5 559.18,-387.86 599.24,-429.2 686,-376.5 709.4,-362.28 699.94,-342.73 722,-326.5 724.38,-324.75 726.88,-323.1 729.46,-321.56"/>
<polygon fill="#666666" stroke="#666666" points="731.38,-324.5 738.52,-316.67 728.05,-318.34 731.38,-324.5"/>
</g>
<!-- Peer__response_read -->
<g id="node11" class="node">
<title>Peer__response_read</title>
<path fill="none" stroke="#1c2123" d="M746,-683C746,-683 868,-683 868,-683 874,-683 880,-689 880,-695 880,-695 880,-732 880,-732 880,-738 874,-744 868,-744 868,-744 746,-744 746,-744 740,-744 734,-738 734,-732 734,-732 734,-695 734,-695 734,-689 740,-683 746,-683"/>
<text text-anchor="start" x="742" y="-728.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="742" y="-713.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> response_read</text>
<polyline fill="none" stroke="#1c2123" points="734,-706 880,-706 "/>
<text text-anchor="start" x="742" y="-690.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用callback read回调</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;Peer__response_read -->
<g id="edge10" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;Peer__response_read</title>
<path fill="none" stroke="#666666" d="M314.82,-490.71C320.87,-569.2 347.02,-747.67 460,-824.5 543.06,-880.99 592.47,-861.12 686,-824.5 723.12,-809.96 755.63,-777.96 777.42,-752.03"/>
<polygon fill="#666666" stroke="#666666" points="780.2,-754.16 783.83,-744.21 774.78,-749.73 780.2,-754.16"/>
</g>
<!-- Peer__response_read__CmdType__ReadIndex -->
<g id="node12" class="node">
<title>Peer__response_read__CmdType__ReadIndex</title>
<path fill="none" stroke="#1c2123" d="M498.5,-686C498.5,-686 647.5,-686 647.5,-686 653.5,-686 659.5,-692 659.5,-698 659.5,-698 659.5,-803 659.5,-803 659.5,-809 653.5,-815 647.5,-815 647.5,-815 498.5,-815 498.5,-815 492.5,-815 486.5,-809 486.5,-803 486.5,-803 486.5,-698 486.5,-698 486.5,-692 492.5,-686 498.5,-686"/>
<text text-anchor="start" x="494.5" y="-799.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="494.5" y="-784.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> response_read</text>
<polyline fill="none" stroke="#1c2123" points="486.5,-777 659.5,-777 "/>
<text text-anchor="start" x="494.5" y="-761.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdType</text>
<text text-anchor="start" x="494.5" y="-746.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadIndex</text>
<polyline fill="none" stroke="#1c2123" points="486.5,-739 659.5,-739 "/>
<text text-anchor="start" x="494.5" y="-723.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果请求类型</text>
<text text-anchor="start" x="494.5" y="-708.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就是readindex</text>
<text text-anchor="start" x="494.5" y="-693.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用回调，回传readindex</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;Peer__response_read__CmdType__ReadIndex -->
<g id="edge11" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;Peer__response_read__CmdType__ReadIndex</title>
<path fill="none" stroke="#666666" d="M331.85,-490.72C356.57,-538.2 403.52,-619.84 460,-676.5 465.61,-682.13 471.71,-687.57 478.08,-692.78"/>
<polygon fill="#666666" stroke="#666666" points="476.25,-695.79 486.26,-699.24 480.59,-690.3 476.25,-695.79"/>
</g>
<!-- Peer__ready_to_handle_unsafe_replica_read -->
<g id="node13" class="node">
<title>Peer__ready_to_handle_unsafe_replica_read</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M472,-500C472,-500 674,-500 674,-500 680,-500 686,-506 686,-512 686,-512 686,-655 686,-655 686,-661 680,-667 674,-667 674,-667 472,-667 472,-667 466,-667 460,-661 460,-655 460,-655 460,-512 460,-512 460,-506 466,-500 472,-500"/>
<text text-anchor="start" x="468" y="-651.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Peer</text>
<text text-anchor="start" x="468" y="-636.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> ready_to_handle_unsafe_replica_read</text>
<polyline fill="none" stroke="#8a8898" points="460,-629 686,-629 "/>
<text text-anchor="start" x="468" y="-613.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">applied_index &gt;= read_index</text>
<polyline fill="none" stroke="#8a8898" points="460,-606 686,-606 "/>
<text text-anchor="start" x="468" y="-590.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pending_merge_state.is_none</text>
<text text-anchor="start" x="468" y="-575.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> !is_applying_snapshot</text>
<text text-anchor="start" x="468" y="-560.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 是否可以读副本</text>
<polyline fill="none" stroke="#8a8898" points="460,-553 686,-553 "/>
<text text-anchor="start" x="468" y="-537.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果不可以，需要将read重新push</text>
<text text-anchor="start" x="468" y="-522.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 到pending_reads队列front</text>
<text text-anchor="start" x="468" y="-507.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 等待下次read ready</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;Peer__ready_to_handle_unsafe_replica_read -->
<g id="edge12" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;Peer__ready_to_handle_unsafe_replica_read</title>
<path fill="none" stroke="#666666" d="M388.26,-490.57C407.86,-500.48 429.49,-511.42 450.82,-522.21"/>
<polygon fill="#666666" stroke="#666666" points="449.43,-525.43 459.93,-526.82 452.59,-519.18 449.43,-525.43"/>
</g>
<!-- ReadIndexQueue__push_front -->
<g id="node14" class="node">
<title>ReadIndexQueue__push_front</title>
<path fill="none" stroke="#1c2123" d="M743.5,-431C743.5,-431 870.5,-431 870.5,-431 876.5,-431 882.5,-437 882.5,-443 882.5,-443 882.5,-510 882.5,-510 882.5,-516 876.5,-522 870.5,-522 870.5,-522 743.5,-522 743.5,-522 737.5,-522 731.5,-516 731.5,-510 731.5,-510 731.5,-443 731.5,-443 731.5,-437 737.5,-431 743.5,-431"/>
<text text-anchor="start" x="739.5" y="-506.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<text text-anchor="start" x="739.5" y="-491.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push_front</text>
<polyline fill="none" stroke="#1c2123" points="731.5,-484 882.5,-484 "/>
<text text-anchor="start" x="739.5" y="-468.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果还不能调用回调</text>
<text text-anchor="start" x="739.5" y="-453.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则将ReadIndexRequest</text>
<text text-anchor="start" x="739.5" y="-438.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 放回队列</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexQueue__push_front -->
<g id="edge13" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexQueue__push_front</title>
<path fill="none" stroke="#666666" d="M424.25,-457.92C514.36,-462.3 639.38,-468.39 721.44,-472.38"/>
<polygon fill="#666666" stroke="#666666" points="721.32,-475.88 731.48,-472.87 721.66,-468.89 721.32,-475.88"/>
</g>
<!-- ReadIndexQueue__pop_front -->
<g id="node15" class="node">
<title>ReadIndexQueue__pop_front</title>
<path fill="none" stroke="#1c2123" d="M758,-335.5C758,-335.5 856,-335.5 856,-335.5 862,-335.5 868,-341.5 868,-347.5 868,-347.5 868,-399.5 868,-399.5 868,-405.5 862,-411.5 856,-411.5 856,-411.5 758,-411.5 758,-411.5 752,-411.5 746,-405.5 746,-399.5 746,-399.5 746,-347.5 746,-347.5 746,-341.5 752,-335.5 758,-335.5"/>
<text text-anchor="start" x="754" y="-396.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<text text-anchor="start" x="754" y="-381.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pop_front</text>
<polyline fill="none" stroke="#1c2123" points="746,-373.5 868,-373.5 "/>
<text text-anchor="start" x="754" y="-358.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">取出已经ready的</text>
<text text-anchor="start" x="754" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadIndexRequest</text>
</g>
<!-- Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexQueue__pop_front -->
<g id="edge14" class="edge">
<title>Peer__post_pending_read_index_on_replica&#45;&gt;ReadIndexQueue__pop_front</title>
<path fill="none" stroke="#666666" d="M424.39,-444.84C498.96,-438.44 599.01,-427.42 686,-409.5 702.32,-406.14 719.62,-401.57 735.84,-396.81"/>
<polygon fill="#666666" stroke="#666666" points="737.22,-400.05 745.79,-393.83 735.21,-393.34 737.22,-400.05"/>
</g>
<!-- Ready__ss__is_some&#45;&gt;ReadIndexQueue__clear_uncommitted_role_change -->
<g id="edge27" class="edge">
<title>Ready__ss__is_some&#45;&gt;ReadIndexQueue__clear_uncommitted_role_change</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M397.09,-59.34C423.02,-53.44 451.74,-46.9 478.28,-40.85"/>
<polygon fill="green" stroke="green" points="479.36,-44.19 488.33,-38.56 477.8,-37.37 479.36,-44.19"/>
</g>
<!-- ReadIndexQueue__fold&#45;&gt;ReadIndexQueue__reads -->
<g id="edge21" class="edge">
<title>ReadIndexQueue__fold&#45;&gt;ReadIndexQueue__reads</title>
<path fill="none" stroke="#666666" d="M829.73,-129.78C846.88,-145.15 871.29,-167.37 892,-187.5 917.07,-211.87 944.75,-240.6 964.1,-260.99"/>
<polygon fill="#666666" stroke="#666666" points="961.67,-263.52 971.09,-268.38 966.76,-258.71 961.67,-263.52"/>
</g>
<!-- ReadIndexRequest__addtion_request&#45;&gt;Peer__send_read_command -->
<g id="edge26" class="edge">
<title>ReadIndexRequest__addtion_request&#45;&gt;Peer__send_read_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M656.77,-298.5C674.56,-298.5 693.49,-298.5 711.68,-298.5"/>
<polygon fill="green" stroke="green" points="711.69,-302 721.69,-298.5 711.69,-295 711.69,-302"/>
</g>
<!-- req__get_header__get_replica_read -->
<g id="node18" class="node">
<title>req__get_header__get_replica_read</title>
<path fill="none" stroke="#1c2123" d="M940,-660.5C940,-660.5 1040,-660.5 1040,-660.5 1046,-660.5 1052,-666.5 1052,-672.5 1052,-672.5 1052,-754.5 1052,-754.5 1052,-760.5 1046,-766.5 1040,-766.5 1040,-766.5 940,-766.5 940,-766.5 934,-766.5 928,-760.5 928,-754.5 928,-754.5 928,-672.5 928,-672.5 928,-666.5 934,-660.5 940,-660.5"/>
<text text-anchor="start" x="936" y="-751.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">req</text>
<text text-anchor="start" x="936" y="-736.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_header</text>
<text text-anchor="middle" x="990" y="-721.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_replica_read</text>
<polyline fill="none" stroke="#1c2123" points="928,-713.5 1052,-713.5 "/>
<text text-anchor="start" x="936" y="-698.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查request header</text>
<text text-anchor="start" x="936" y="-683.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 是否明确需要</text>
<text text-anchor="start" x="936" y="-668.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> replica read</text>
</g>
<!-- Peer__response_read&#45;&gt;req__get_header__get_replica_read -->
<g id="edge23" class="edge">
<title>Peer__response_read&#45;&gt;req__get_header__get_replica_read</title>
<path fill="none" stroke="#666666" d="M880.06,-713.5C892.46,-713.5 905.34,-713.5 917.72,-713.5"/>
<polygon fill="#666666" stroke="#666666" points="917.98,-717 927.98,-713.5 917.98,-710 917.98,-717"/>
</g>
<!-- Peer__handle_read -->
<g id="node19" class="node">
<title>Peer__handle_read</title>
<path fill="none" stroke="#1c2123" d="M1038,-641.5C1038,-641.5 942,-641.5 942,-641.5 936,-641.5 930,-635.5 930,-629.5 930,-629.5 930,-617.5 930,-617.5 930,-611.5 936,-605.5 942,-605.5 942,-605.5 1038,-605.5 1038,-605.5 1044,-605.5 1050,-611.5 1050,-617.5 1050,-617.5 1050,-629.5 1050,-629.5 1050,-635.5 1044,-641.5 1038,-641.5"/>
<text text-anchor="middle" x="990" y="-619.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__handle_read</text>
</g>
<!-- Peer__response_read&#45;&gt;Peer__handle_read -->
<g id="edge24" class="edge">
<title>Peer__response_read&#45;&gt;Peer__handle_read</title>
<path fill="none" stroke="#666666" d="M865.71,-682.99C885.37,-672.78 907.55,-661.47 928,-651.5 931.77,-649.66 935.69,-647.79 939.63,-645.92"/>
<polygon fill="#666666" stroke="#666666" points="941.27,-649.02 948.84,-641.61 938.3,-642.68 941.27,-649.02"/>
</g>
<!-- Callback__invoke_read -->
<g id="node20" class="node">
<title>Callback__invoke_read</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M958.5,-786C958.5,-786 1021.5,-786 1021.5,-786 1027.5,-786 1033.5,-792 1033.5,-798 1033.5,-798 1033.5,-835 1033.5,-835 1033.5,-841 1027.5,-847 1021.5,-847 1021.5,-847 958.5,-847 958.5,-847 952.5,-847 946.5,-841 946.5,-835 946.5,-835 946.5,-798 946.5,-798 946.5,-792 952.5,-786 958.5,-786"/>
<text text-anchor="start" x="954.5" y="-831.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Callback</text>
<text text-anchor="start" x="954.5" y="-816.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> invoke_read</text>
<polyline fill="none" stroke="#8a8898" points="946.5,-809 1033.5,-809 "/>
<text text-anchor="middle" x="990" y="-793.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">调用回调</text>
</g>
<!-- Peer__response_read&#45;&gt;Callback__invoke_read -->
<g id="edge25" class="edge">
<title>Peer__response_read&#45;&gt;Callback__invoke_read</title>
<path fill="none" stroke="#666666" d="M861.82,-744.12C885.75,-757.74 913.8,-773.71 937.46,-787.17"/>
<polygon fill="#666666" stroke="#666666" points="935.87,-790.3 946.3,-792.2 939.34,-784.21 935.87,-790.3"/>
</g>
<!-- Peer__ready_to_handle_unsafe_replica_read&#45;&gt;Peer__response_read -->
<g id="edge17" class="edge">
<title>Peer__ready_to_handle_unsafe_replica_read&#45;&gt;Peer__response_read</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M686.26,-646.41C705.57,-657.22 725.01,-668.12 742.45,-677.89"/>
<polygon fill="green" stroke="green" points="740.94,-681.06 751.37,-682.89 744.36,-674.95 740.94,-681.06"/>
</g>
<!-- Peer__ready_to_handle_unsafe_replica_read&#45;&gt;ReadIndexQueue__push_front -->
<g id="edge18" class="edge">
<title>Peer__ready_to_handle_unsafe_replica_read&#45;&gt;ReadIndexQueue__push_front</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M686.26,-531.72C698.31,-526.17 710.41,-520.59 722.04,-515.22"/>
<polygon fill="green" stroke="green" points="723.65,-518.34 731.26,-510.97 720.72,-511.98 723.65,-518.34"/>
</g>
<!-- ReadIndexQueue__push_front&#45;&gt;ReadIndexQueue__reads -->
<g id="edge16" class="edge">
<title>ReadIndexQueue__push_front&#45;&gt;ReadIndexQueue__reads</title>
<path fill="none" stroke="#666666" d="M881.64,-430.66C885.24,-427.69 888.72,-424.63 892,-421.5 925.56,-389.48 955.39,-344.52 972.83,-315.7"/>
<polygon fill="#666666" stroke="#666666" points="975.93,-317.33 978.05,-306.94 969.92,-313.74 975.93,-317.33"/>
</g>
<!-- ReadIndexQueue__pop_front&#45;&gt;ReadIndexQueue__reads -->
<g id="edge15" class="edge">
<title>ReadIndexQueue__pop_front&#45;&gt;ReadIndexQueue__reads</title>
<path fill="none" stroke="#666666" d="M868.02,-344.98C891.25,-333.94 917.51,-321.47 939.62,-310.96"/>
<polygon fill="#666666" stroke="#666666" points="941.29,-314.04 948.82,-306.59 938.29,-307.72 941.29,-314.04"/>
</g>
<!-- Peer__post_apply -->
<g id="node16" class="node">
<title>Peer__post_apply</title>
<path fill="none" stroke="#1c2123" d="M19.5,-458.5C19.5,-458.5 144.5,-458.5 144.5,-458.5 150.5,-458.5 156.5,-464.5 156.5,-470.5 156.5,-470.5 156.5,-522.5 156.5,-522.5 156.5,-528.5 150.5,-534.5 144.5,-534.5 144.5,-534.5 19.5,-534.5 19.5,-534.5 13.5,-534.5 7.5,-528.5 7.5,-522.5 7.5,-522.5 7.5,-470.5 7.5,-470.5 7.5,-464.5 13.5,-458.5 19.5,-458.5"/>
<text text-anchor="start" x="15.5" y="-519.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="15.5" y="-504.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> post_apply</text>
<polyline fill="none" stroke="#1c2123" points="7.5,-496.5 156.5,-496.5 "/>
<text text-anchor="start" x="15.5" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyFsm apply 完了</text>
<text text-anchor="start" x="15.5" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 一批comitted log entry</text>
</g>
<!-- Peer__post_apply&#45;&gt;Peer__post_pending_read_index_on_replica -->
<g id="edge19" class="edge">
<title>Peer__post_apply&#45;&gt;Peer__post_pending_read_index_on_replica</title>
<path fill="none" stroke="#666666" d="M156.71,-482.28C167.38,-480.22 178.58,-478.05 189.88,-475.87"/>
<polygon fill="#666666" stroke="#666666" points="190.67,-479.29 199.83,-473.95 189.34,-472.41 190.67,-479.29"/>
</g>
<!-- Peer__handle_raft_ready_append -->
<g id="node17" class="node">
<title>Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M12,-378C12,-378 152,-378 152,-378 158,-378 164,-384 164,-390 164,-390 164,-427 164,-427 164,-433 158,-439 152,-439 152,-439 12,-439 12,-439 6,-439 0,-433 0,-427 0,-427 0,-390 0,-390 0,-384 6,-378 12,-378"/>
<text text-anchor="start" x="8" y="-423.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="8" y="-408.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_ready_append</text>
<polyline fill="none" stroke="#1c2123" points="0,-401 164,-401 "/>
<text text-anchor="start" x="8" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">snapshot apply 成功了</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__post_pending_read_index_on_replica -->
<g id="edge20" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__post_pending_read_index_on_replica</title>
<path fill="none" stroke="#666666" d="M164.03,-424.14C172.49,-425.77 181.22,-427.45 190,-429.15"/>
<polygon fill="#666666" stroke="#666666" points="189.45,-432.61 199.93,-431.07 190.77,-425.73 189.45,-432.61"/>
</g>
</g>
</svg>
