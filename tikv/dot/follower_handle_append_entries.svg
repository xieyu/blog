<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: follower_handle_append_entries Pages: 1 -->
<svg width="1777pt" height="920pt"
 viewBox="0.00 0.00 1777.00 920.06" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 916.06)">
<title>follower_handle_append_entries</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-916.06 1773,-916.06 1773,4 -4,4"/>
<g id="clust5" class="cluster">
<title>cluster_RaftLog</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M469,-362.56C469,-362.56 1629.5,-362.56 1629.5,-362.56 1635.5,-362.56 1641.5,-368.56 1641.5,-374.56 1641.5,-374.56 1641.5,-782.56 1641.5,-782.56 1641.5,-788.56 1635.5,-794.56 1629.5,-794.56 1629.5,-794.56 469,-794.56 469,-794.56 463,-794.56 457,-788.56 457,-782.56 457,-782.56 457,-374.56 457,-374.56 457,-368.56 463,-362.56 469,-362.56"/>
<text text-anchor="middle" x="1049.25" y="-774.56" font-family="Times,serif" font-size="20.00">RaftLog</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_Unstable</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1140,-164.56C1140,-164.56 1563,-164.56 1563,-164.56 1569,-164.56 1575,-170.56 1575,-176.56 1575,-176.56 1575,-234.56 1575,-234.56 1575,-240.56 1569,-246.56 1563,-246.56 1563,-246.56 1140,-246.56 1140,-246.56 1134,-246.56 1128,-240.56 1128,-234.56 1128,-234.56 1128,-176.56 1128,-176.56 1128,-170.56 1134,-164.56 1140,-164.56"/>
<text text-anchor="middle" x="1351.5" y="-226.56" font-family="Times,serif" font-size="20.00">Unstable</text>
</g>
<!-- RaftCore -->
<g id="node1" class="node">
<title>RaftCore</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M229,-583.06C229,-583.06 417,-583.06 417,-583.06 423,-583.06 429,-589.06 429,-595.06 429,-595.06 429,-732.06 429,-732.06 429,-738.06 423,-744.06 417,-744.06 417,-744.06 229,-744.06 229,-744.06 223,-744.06 217,-738.06 217,-732.06 217,-732.06 217,-595.06 217,-595.06 217,-589.06 223,-583.06 229,-583.06"/>
<text text-anchor="middle" x="323" y="-728.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore</text>
<polyline fill="none" stroke="#60b5ac" points="217,-721.06 429,-721.06 "/>
<text text-anchor="start" x="225" y="-705.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub leader_id: u64</text>
<polyline fill="none" stroke="#60b5ac" points="217,-698.06 429,-698.06 "/>
<text text-anchor="start" x="225" y="-682.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub election_elapsed: usize</text>
<polyline fill="none" stroke="#60b5ac" points="217,-675.06 429,-675.06 "/>
<text text-anchor="start" x="225" y="-659.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub state: StateRole</text>
<polyline fill="none" stroke="#60b5ac" points="217,-652.06 429,-652.06 "/>
<text text-anchor="start" x="225" y="-636.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub pending_request_snapshot: u64</text>
<polyline fill="none" stroke="#60b5ac" points="217,-629.06 429,-629.06 "/>
<text text-anchor="start" x="225" y="-613.86" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub raft_log: RaftLog&lt;T&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="217,-606.06 429,-606.06 "/>
<text text-anchor="middle" x="323" y="-590.86" font-family="Times,serif" font-size="14.00" fill="#5d6179"> </text>
</g>
<!-- RaftLog -->
<g id="node2" class="node">
<title>RaftLog</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M1481.5,-617.56C1481.5,-617.56 1598.5,-617.56 1598.5,-617.56 1604.5,-617.56 1610.5,-623.56 1610.5,-629.56 1610.5,-629.56 1610.5,-743.56 1610.5,-743.56 1610.5,-749.56 1604.5,-755.56 1598.5,-755.56 1598.5,-755.56 1481.5,-755.56 1481.5,-755.56 1475.5,-755.56 1469.5,-749.56 1469.5,-743.56 1469.5,-743.56 1469.5,-629.56 1469.5,-629.56 1469.5,-623.56 1475.5,-617.56 1481.5,-617.56"/>
<text text-anchor="middle" x="1540" y="-740.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftLog</text>
<polyline fill="none" stroke="#60b5ac" points="1469.5,-732.56 1610.5,-732.56 "/>
<text text-anchor="middle" x="1540" y="-717.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub committed: u64</text>
<polyline fill="none" stroke="#60b5ac" points="1469.5,-709.56 1610.5,-709.56 "/>
<text text-anchor="start" x="1477.5" y="-694.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub store: T</text>
<polyline fill="none" stroke="#60b5ac" points="1469.5,-686.56 1610.5,-686.56 "/>
<text text-anchor="start" x="1477.5" y="-671.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub unstable: Unstable</text>
<polyline fill="none" stroke="#60b5ac" points="1469.5,-663.56 1610.5,-663.56 "/>
<text text-anchor="start" x="1477.5" y="-648.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub persisted: u64</text>
<polyline fill="none" stroke="#60b5ac" points="1469.5,-640.56 1610.5,-640.56 "/>
<text text-anchor="start" x="1477.5" y="-625.36" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub applied: u64</text>
</g>
<!-- RaftCore&#45;&gt;RaftLog -->
<g id="edge1" class="edge">
<title>RaftCore:raft_log&#45;&gt;RaftLog</title>
<path fill="none" stroke="#666666" d="M429,-617.56C469.7,-617.56 426.1,-772.08 457,-798.56 533.6,-864.22 1268.21,-827.02 1365,-798.56 1398.88,-788.6 1432.4,-769.78 1460.83,-750.37"/>
<polygon fill="#666666" stroke="#666666" points="1462.89,-753.2 1469.1,-744.61 1458.89,-747.45 1462.89,-753.2"/>
</g>
<!-- step -->
<g id="node3" class="node">
<title>step</title>
<path fill="none" stroke="#1c2123" d="M42,-418.56C42,-418.56 12,-418.56 12,-418.56 6,-418.56 0,-412.56 0,-406.56 0,-406.56 0,-394.56 0,-394.56 0,-388.56 6,-382.56 12,-382.56 12,-382.56 42,-382.56 42,-382.56 48,-382.56 54,-388.56 54,-394.56 54,-394.56 54,-406.56 54,-406.56 54,-412.56 48,-418.56 42,-418.56"/>
<text text-anchor="middle" x="27" y="-396.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">step</text>
</g>
<!-- step_follower -->
<g id="node4" class="node">
<title>step_follower</title>
<path fill="none" stroke="#1c2123" d="M169,-418.56C169,-418.56 102,-418.56 102,-418.56 96,-418.56 90,-412.56 90,-406.56 90,-406.56 90,-394.56 90,-394.56 90,-388.56 96,-382.56 102,-382.56 102,-382.56 169,-382.56 169,-382.56 175,-382.56 181,-388.56 181,-394.56 181,-394.56 181,-406.56 181,-406.56 181,-412.56 175,-418.56 169,-418.56"/>
<text text-anchor="middle" x="135.5" y="-396.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_follower</text>
</g>
<!-- step&#45;&gt;step_follower -->
<g id="edge2" class="edge">
<title>step&#45;&gt;step_follower</title>
<path fill="none" stroke="#666666" d="M54.05,-400.56C61.84,-400.56 70.68,-400.56 79.59,-400.56"/>
<polygon fill="#666666" stroke="#666666" points="79.62,-404.06 89.62,-400.56 79.62,-397.06 79.62,-404.06"/>
</g>
<!-- step_follower&#45;&gt;RaftCore -->
<g id="edge3" class="edge">
<title>step_follower&#45;&gt;RaftCore</title>
<path fill="none" stroke="#666666" d="M149.25,-418.64C171.68,-450.44 219.58,-518.36 259.27,-574.63"/>
<polygon fill="#666666" stroke="#666666" points="256.44,-576.68 265.06,-582.84 262.16,-572.65 256.44,-576.68"/>
</g>
<!-- handle_append_entries -->
<g id="node5" class="node">
<title>handle_append_entries</title>
<path fill="none" stroke="#1c2123" d="M381.5,-360.56C381.5,-360.56 264.5,-360.56 264.5,-360.56 258.5,-360.56 252.5,-354.56 252.5,-348.56 252.5,-348.56 252.5,-336.56 252.5,-336.56 252.5,-330.56 258.5,-324.56 264.5,-324.56 264.5,-324.56 381.5,-324.56 381.5,-324.56 387.5,-324.56 393.5,-330.56 393.5,-336.56 393.5,-336.56 393.5,-348.56 393.5,-348.56 393.5,-354.56 387.5,-360.56 381.5,-360.56"/>
<text text-anchor="middle" x="323" y="-338.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_append_entries</text>
</g>
<!-- step_follower&#45;&gt;handle_append_entries -->
<g id="edge4" class="edge">
<title>step_follower&#45;&gt;handle_append_entries</title>
<path fill="none" stroke="#666666" d="M181.4,-386.52C203.37,-379.66 230.25,-371.25 254.61,-363.63"/>
<polygon fill="#666666" stroke="#666666" points="255.67,-366.97 264.16,-360.65 253.58,-360.29 255.67,-366.97"/>
</g>
<!-- handle_append_entries&#45;&gt;RaftLog -->
<g id="edge5" class="edge">
<title>handle_append_entries&#45;&gt;RaftLog</title>
<path fill="none" stroke="#666666" d="M331.28,-360.79C352.98,-414.44 418.13,-570.4 457,-608.56 565.94,-715.53 618.1,-722.84 767,-756.56 826.68,-770.08 1314.46,-758.94 1365,-749.56 1396.92,-743.64 1430.76,-732.58 1460.02,-721.36"/>
<polygon fill="#666666" stroke="#666666" points="1461.31,-724.61 1469.36,-717.71 1458.77,-718.09 1461.31,-724.61"/>
</g>
<!-- pending_request_snapshot -->
<g id="node6" class="node">
<title>pending_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M666,-314.56C666,-314.56 530,-314.56 530,-314.56 524,-314.56 518,-308.56 518,-302.56 518,-302.56 518,-290.56 518,-290.56 518,-284.56 524,-278.56 530,-278.56 530,-278.56 666,-278.56 666,-278.56 672,-278.56 678,-284.56 678,-290.56 678,-290.56 678,-302.56 678,-302.56 678,-308.56 672,-314.56 666,-314.56"/>
<text text-anchor="middle" x="598" y="-292.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_request_snapshot</text>
</g>
<!-- handle_append_entries&#45;&gt;pending_request_snapshot -->
<g id="edge6" class="edge">
<title>handle_append_entries&#45;&gt;pending_request_snapshot</title>
<path fill="none" stroke="#666666" d="M393.6,-330.84C428.25,-325 470.55,-317.87 507.58,-311.63"/>
<polygon fill="#666666" stroke="#666666" points="508.6,-315.01 517.88,-309.9 507.43,-308.11 508.6,-315.01"/>
</g>
<!-- send_request_snapshot -->
<g id="node7" class="node">
<title>send_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M943.5,-314.56C943.5,-314.56 826.5,-314.56 826.5,-314.56 820.5,-314.56 814.5,-308.56 814.5,-302.56 814.5,-302.56 814.5,-290.56 814.5,-290.56 814.5,-284.56 820.5,-278.56 826.5,-278.56 826.5,-278.56 943.5,-278.56 943.5,-278.56 949.5,-278.56 955.5,-284.56 955.5,-290.56 955.5,-290.56 955.5,-302.56 955.5,-302.56 955.5,-308.56 949.5,-314.56 943.5,-314.56"/>
<text text-anchor="middle" x="885" y="-292.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_request_snapshot</text>
</g>
<!-- handle_append_entries&#45;&gt;send_request_snapshot -->
<g id="edge7" class="edge">
<title>handle_append_entries&#45;&gt;send_request_snapshot</title>
<path fill="none" stroke="#666666" d="M393.71,-342.02C474.93,-340.76 613.07,-336.67 731,-323.56 754.93,-320.91 780.77,-316.82 804.28,-312.62"/>
<polygon fill="#666666" stroke="#666666" points="804.98,-316.05 814.2,-310.82 803.73,-309.17 804.98,-316.05"/>
</g>
<!-- MsgAppendResponse_lower -->
<g id="node8" class="node">
<title>MsgAppendResponse_lower</title>
<path fill="#feed9b" stroke="#f7e495" d="M506,-1.56C506,-1.56 690,-1.56 690,-1.56 696,-1.56 702,-7.56 702,-13.56 702,-13.56 702,-103.56 702,-103.56 702,-109.56 696,-115.56 690,-115.56 690,-115.56 506,-115.56 506,-115.56 500,-115.56 494,-109.56 494,-103.56 494,-103.56 494,-13.56 494,-13.56 494,-7.56 500,-1.56 506,-1.56"/>
<text text-anchor="middle" x="598" y="-100.36" font-family="Times,serif" font-size="14.00" fill="#40575d">MsgAppendResponse</text>
<polyline fill="none" stroke="#f7e495" points="494,-92.56 702,-92.56 "/>
<text text-anchor="start" x="502" y="-77.36" font-family="Times,serif" font-size="14.00" fill="#40575d">got message with </text>
<text text-anchor="start" x="502" y="-62.36" font-family="Times,serif" font-size="14.00" fill="#40575d"> lower index than committed</text>
<polyline fill="none" stroke="#f7e495" points="494,-54.56 702,-54.56 "/>
<text text-anchor="start" x="502" y="-39.36" font-family="Times,serif" font-size="14.00" fill="#40575d">to = m.from</text>
<text text-anchor="start" x="502" y="-24.36" font-family="Times,serif" font-size="14.00" fill="#40575d"> index = self.raft_log.committed</text>
<text text-anchor="start" x="502" y="-9.36" font-family="Times,serif" font-size="14.00" fill="#40575d"> commit = self.raft_log.committed</text>
</g>
<!-- handle_append_entries&#45;&gt;MsgAppendResponse_lower -->
<g id="edge8" class="edge">
<title>handle_append_entries&#45;&gt;MsgAppendResponse_lower</title>
<path fill="none" stroke="#666666" d="M331.37,-324.41C348.27,-284.71 393.31,-189.04 457,-130.56 465.57,-122.69 475.17,-115.45 485.2,-108.84"/>
<polygon fill="#666666" stroke="#666666" points="487.15,-111.75 493.73,-103.44 483.41,-105.84 487.15,-111.75"/>
</g>
<!-- maybe_append -->
<g id="node9" class="node">
<title>maybe_append</title>
<path fill="none" stroke="#1c2123" d="M477,-492.56C477,-492.56 719,-492.56 719,-492.56 725,-492.56 731,-498.56 731,-504.56 731,-504.56 731,-586.56 731,-586.56 731,-592.56 725,-598.56 719,-598.56 719,-598.56 477,-598.56 477,-598.56 471,-598.56 465,-592.56 465,-586.56 465,-586.56 465,-504.56 465,-504.56 465,-498.56 471,-492.56 477,-492.56"/>
<text text-anchor="middle" x="598" y="-583.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">maybe_append</text>
<polyline fill="none" stroke="#1c2123" points="465,-575.56 731,-575.56 "/>
<text text-anchor="start" x="473" y="-560.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">Returns None if the entries</text>
<text text-anchor="start" x="473" y="-545.36" font-family="Times,serif" font-size="14.00" fill="#2f3638"> cannot be appended. Otherwise,</text>
<text text-anchor="start" x="473" y="-530.36" font-family="Times,serif" font-size="14.00" fill="#2f3638"> it returns Some((conflict_index, last_index)).</text>
<text text-anchor="start" x="473" y="-515.36" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Panics if it finds a conflicting</text>
<text text-anchor="start" x="473" y="-500.36" font-family="Times,serif" font-size="14.00" fill="#2f3638"> index less than committed index.</text>
</g>
<!-- handle_append_entries&#45;&gt;maybe_append -->
<g id="edge9" class="edge">
<title>handle_append_entries&#45;&gt;maybe_append</title>
<path fill="none" stroke="#666666" d="M348.23,-360.58C385.79,-388.51 459.74,-443.5 517.3,-486.3"/>
<polygon fill="#666666" stroke="#666666" points="515.55,-489.36 525.67,-492.52 519.73,-483.75 515.55,-489.36"/>
</g>
<!-- send -->
<g id="node10" class="node">
<title>send</title>
<path fill="none" stroke="#1c2123" d="M1757,-242.56C1757,-242.56 1727,-242.56 1727,-242.56 1721,-242.56 1715,-236.56 1715,-230.56 1715,-230.56 1715,-218.56 1715,-218.56 1715,-212.56 1721,-206.56 1727,-206.56 1727,-206.56 1757,-206.56 1757,-206.56 1763,-206.56 1769,-212.56 1769,-218.56 1769,-218.56 1769,-230.56 1769,-230.56 1769,-236.56 1763,-242.56 1757,-242.56"/>
<text text-anchor="middle" x="1742" y="-220.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">send</text>
</g>
<!-- handle_append_entries&#45;&gt;send -->
<g id="edge10" class="edge">
<title>handle_append_entries&#45;&gt;send</title>
<path fill="none" stroke="#666666" d="M352.77,-324.47C433.31,-275.59 669.25,-144.56 884,-144.56 884,-144.56 884,-144.56 1203,-144.56 1414.68,-144.56 1485.5,-74.75 1679,-160.56 1696.92,-168.51 1712.29,-184.27 1723.24,-198.16"/>
<polygon fill="#666666" stroke="#666666" points="1720.68,-200.58 1729.47,-206.48 1726.28,-196.38 1720.68,-200.58"/>
</g>
<!-- pending_request_snapshot&#45;&gt;send_request_snapshot -->
<g id="edge13" class="edge">
<title>pending_request_snapshot&#45;&gt;send_request_snapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M678.01,-296.56C717.26,-296.56 764.59,-296.56 803.97,-296.56"/>
<polygon fill="green" stroke="green" points="804.07,-300.06 814.07,-296.56 804.07,-293.06 804.07,-300.06"/>
</g>
<!-- MsgAppendResponse_lower&#45;&gt;send -->
<g id="edge25" class="edge">
<title>MsgAppendResponse_lower&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M702.13,-37.06C904.99,-0.52 1363.53,53.07 1679,-130.56 1704.2,-145.23 1721.08,-174.72 1730.78,-196.78"/>
<polygon fill="green" stroke="green" points="1727.67,-198.41 1734.74,-206.31 1734.14,-195.73 1727.67,-198.41"/>
</g>
<!-- MessageAppendResponse_reject -->
<g id="node11" class="node">
<title>MessageAppendResponse_reject</title>
<path fill="#feed9b" stroke="#f7e495" d="M1413,-255.06C1413,-255.06 1667,-255.06 1667,-255.06 1673,-255.06 1679,-261.06 1679,-267.06 1679,-267.06 1679,-342.06 1679,-342.06 1679,-348.06 1673,-354.06 1667,-354.06 1667,-354.06 1413,-354.06 1413,-354.06 1407,-354.06 1401,-348.06 1401,-342.06 1401,-342.06 1401,-267.06 1401,-267.06 1401,-261.06 1407,-255.06 1413,-255.06"/>
<text text-anchor="middle" x="1540" y="-338.86" font-family="Times,serif" font-size="14.00" fill="#40575d">MessageAppendResponse</text>
<polyline fill="none" stroke="#f7e495" points="1401,-331.06 1679,-331.06 "/>
<text text-anchor="start" x="1409" y="-315.86" font-family="Times,serif" font-size="14.00" fill="#40575d">maybe_append返回了None</text>
<polyline fill="none" stroke="#f7e495" points="1401,-308.06 1679,-308.06 "/>
<text text-anchor="start" x="1409" y="-292.86" font-family="Times,serif" font-size="14.00" fill="#40575d">to_send.index = m.index;</text>
<text text-anchor="start" x="1409" y="-277.86" font-family="Times,serif" font-size="14.00" fill="#40575d"> to_send.reject = true;</text>
<text text-anchor="start" x="1409" y="-262.86" font-family="Times,serif" font-size="14.00" fill="#40575d"> to_send.reject_hint = self.raft_log.last_index();</text>
</g>
<!-- maybe_append&#45;&gt;MessageAppendResponse_reject -->
<g id="edge11" class="edge">
<title>maybe_append&#45;&gt;MessageAppendResponse_reject</title>
<path fill="none" stroke="#666666" d="M630.95,-492.5C660.36,-449 708.25,-390.11 767,-361.56 821.49,-335.09 1182.15,-317.64 1390.69,-309.63"/>
<polygon fill="#666666" stroke="#666666" points="1390.96,-313.12 1400.82,-309.24 1390.69,-306.12 1390.96,-313.12"/>
</g>
<!-- match_term -->
<g id="node14" class="node">
<title>match_term</title>
<path fill="none" stroke="#1c2123" d="M1134.5,-550.56C1134.5,-550.56 1269.5,-550.56 1269.5,-550.56 1275.5,-550.56 1281.5,-556.56 1281.5,-562.56 1281.5,-562.56 1281.5,-584.56 1281.5,-584.56 1281.5,-590.56 1275.5,-596.56 1269.5,-596.56 1269.5,-596.56 1134.5,-596.56 1134.5,-596.56 1128.5,-596.56 1122.5,-590.56 1122.5,-584.56 1122.5,-584.56 1122.5,-562.56 1122.5,-562.56 1122.5,-556.56 1128.5,-550.56 1134.5,-550.56"/>
<text text-anchor="middle" x="1202" y="-581.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">match_term</text>
<polyline fill="none" stroke="#1c2123" points="1122.5,-573.56 1281.5,-573.56 "/>
<text text-anchor="middle" x="1202" y="-558.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查term和idx是否匹配</text>
</g>
<!-- maybe_append&#45;&gt;match_term -->
<g id="edge14" class="edge">
<title>maybe_append&#45;&gt;match_term</title>
<path fill="none" stroke="#666666" d="M630.73,-598.58C659.99,-641.84 707.8,-699.84 767,-725.56 815.1,-746.47 960.19,-755.85 1003,-725.56 1042.24,-697.8 1004.33,-656.87 1039,-623.56 1059.04,-604.31 1086.33,-592.46 1112.8,-585.17"/>
<polygon fill="#666666" stroke="#666666" points="1113.68,-588.55 1122.49,-582.68 1111.94,-581.77 1113.68,-588.55"/>
</g>
<!-- find_conflict -->
<g id="node15" class="node">
<title>find_conflict</title>
<path fill="none" stroke="#1c2123" d="M796.5,-557.06C796.5,-557.06 973.5,-557.06 973.5,-557.06 979.5,-557.06 985.5,-563.06 985.5,-569.06 985.5,-569.06 985.5,-704.06 985.5,-704.06 985.5,-710.06 979.5,-716.06 973.5,-716.06 973.5,-716.06 796.5,-716.06 796.5,-716.06 790.5,-716.06 784.5,-710.06 784.5,-704.06 784.5,-704.06 784.5,-569.06 784.5,-569.06 784.5,-563.06 790.5,-557.06 796.5,-557.06"/>
<text text-anchor="middle" x="885" y="-700.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">find_conflict</text>
<polyline fill="none" stroke="#1c2123" points="784.5,-693.06 985.5,-693.06 "/>
<text text-anchor="start" x="792.5" y="-677.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">It returns the first index </text>
<text text-anchor="start" x="792.5" y="-662.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> of conflicting entries </text>
<text text-anchor="start" x="792.5" y="-647.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> between the existing</text>
<text text-anchor="start" x="792.5" y="-632.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entries and the given</text>
<text text-anchor="start" x="792.5" y="-617.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entries, if there are any.</text>
<polyline fill="none" stroke="#1c2123" points="784.5,-610.06 985.5,-610.06 "/>
<text text-anchor="start" x="792.5" y="-594.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历entries，检查每个entries</text>
<text text-anchor="start" x="792.5" y="-579.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> index对应的term是否一致</text>
<text text-anchor="start" x="792.5" y="-564.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.match_term(e.index, e.term)</text>
</g>
<!-- maybe_append&#45;&gt;find_conflict -->
<g id="edge15" class="edge">
<title>maybe_append&#45;&gt;find_conflict</title>
<path fill="none" stroke="#666666" d="M731.07,-587.73C745.62,-592.38 760.32,-597.07 774.55,-601.62"/>
<polygon fill="#666666" stroke="#666666" points="773.73,-605.03 784.32,-604.74 775.86,-598.36 773.73,-605.03"/>
</g>
<!-- append -->
<g id="node16" class="node">
<title>append</title>
<path fill="none" stroke="#1c2123" d="M779,-371.06C779,-371.06 991,-371.06 991,-371.06 997,-371.06 1003,-377.06 1003,-383.06 1003,-383.06 1003,-526.06 1003,-526.06 1003,-532.06 997,-538.06 991,-538.06 991,-538.06 779,-538.06 779,-538.06 773,-538.06 767,-532.06 767,-526.06 767,-526.06 767,-383.06 767,-383.06 767,-377.06 773,-371.06 779,-371.06"/>
<text text-anchor="middle" x="885" y="-522.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">append</text>
<polyline fill="none" stroke="#1c2123" points="767,-515.06 1003,-515.06 "/>
<text text-anchor="start" x="775" y="-499.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">Appends a set of entries</text>
<text text-anchor="start" x="775" y="-484.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> to the unstable list.</text>
<polyline fill="none" stroke="#1c2123" points="767,-477.06 1003,-477.06 "/>
<text text-anchor="start" x="775" y="-461.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">这里只放入了unstable list中</text>
<text text-anchor="start" x="775" y="-446.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 后面由应用自己调用ready 将</text>
<text text-anchor="start" x="775" y="-431.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> unstable list中的entries保存，持久化</text>
<text text-anchor="start" x="775" y="-416.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后再发送消息</text>
<polyline fill="none" stroke="#1c2123" points="767,-409.06 1003,-409.06 "/>
<text text-anchor="start" x="775" y="-393.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">因此后面的commit_to使用</text>
<text text-anchor="start" x="775" y="-378.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> last_new_index是OK的</text>
</g>
<!-- maybe_append&#45;&gt;append -->
<g id="edge16" class="edge">
<title>maybe_append&#45;&gt;append</title>
<path fill="none" stroke="#666666" d="M731.07,-503.39C739.75,-500.62 748.47,-497.84 757.12,-495.08"/>
<polygon fill="#666666" stroke="#666666" points="758.39,-498.35 766.85,-491.97 756.26,-491.68 758.39,-498.35"/>
</g>
<!-- commit_to -->
<g id="node17" class="node">
<title>commit_to</title>
<path fill="none" stroke="#1c2123" d="M1051,-633.06C1051,-633.06 1353,-633.06 1353,-633.06 1359,-633.06 1365,-639.06 1365,-645.06 1365,-645.06 1365,-728.06 1365,-728.06 1365,-734.06 1359,-740.06 1353,-740.06 1353,-740.06 1051,-740.06 1051,-740.06 1045,-740.06 1039,-734.06 1039,-728.06 1039,-728.06 1039,-645.06 1039,-645.06 1039,-639.06 1045,-633.06 1051,-633.06"/>
<text text-anchor="middle" x="1202" y="-724.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">committed_to</text>
<polyline fill="none" stroke="#1c2123" points="1039,-717.06 1365,-717.06 "/>
<text text-anchor="start" x="1047" y="-701.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.commit_to(cmp::min(committed, last_new_index));</text>
<polyline fill="none" stroke="#1c2123" points="1039,-694.06 1365,-694.06 "/>
<text text-anchor="start" x="1047" y="-678.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">committed 为msg的committed index</text>
<polyline fill="none" stroke="#1c2123" points="1039,-671.06 1365,-671.06 "/>
<text text-anchor="start" x="1047" y="-655.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">last_new_index 为append之后</text>
<text text-anchor="start" x="1047" y="-640.86" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower自己本地的 entries idx</text>
</g>
<!-- maybe_append&#45;&gt;commit_to -->
<g id="edge17" class="edge">
<title>maybe_append&#45;&gt;commit_to</title>
<path fill="none" stroke="#666666" d="M627.48,-598.93C655.85,-645.8 704.19,-710.87 767,-739.56 856.01,-780.23 965.43,-766.5 1052.14,-742.84"/>
<polygon fill="#666666" stroke="#666666" points="1053.1,-746.21 1061.79,-740.14 1051.21,-739.47 1053.1,-746.21"/>
</g>
<!-- MessageAppendResponse_reject&#45;&gt;send -->
<g id="edge26" class="edge">
<title>MessageAppendResponse_reject&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1668.13,-254.95C1671.79,-253.48 1675.42,-252.01 1679,-250.56 1687.57,-247.09 1696.77,-243.28 1705.39,-239.67"/>
<polygon fill="green" stroke="green" points="1706.95,-242.81 1714.81,-235.71 1704.24,-236.36 1706.95,-242.81"/>
</g>
<!-- MessageAppendResponse -->
<g id="node12" class="node">
<title>MessageAppendResponse</title>
<path fill="#feed9b" stroke="#f7e495" d="M1440.5,-819.56C1440.5,-819.56 1639.5,-819.56 1639.5,-819.56 1645.5,-819.56 1651.5,-825.56 1651.5,-831.56 1651.5,-831.56 1651.5,-899.56 1651.5,-899.56 1651.5,-905.56 1645.5,-911.56 1639.5,-911.56 1639.5,-911.56 1440.5,-911.56 1440.5,-911.56 1434.5,-911.56 1428.5,-905.56 1428.5,-899.56 1428.5,-899.56 1428.5,-831.56 1428.5,-831.56 1428.5,-825.56 1434.5,-819.56 1440.5,-819.56"/>
<text text-anchor="middle" x="1540" y="-896.36" font-family="Times,serif" font-size="14.00" fill="#40575d">MessageAppendResponse</text>
<polyline fill="none" stroke="#f7e495" points="1428.5,-888.56 1651.5,-888.56 "/>
<text text-anchor="start" x="1436.5" y="-873.36" font-family="Times,serif" font-size="14.00" fill="#40575d">to_send.to = m.from</text>
<polyline fill="none" stroke="#f7e495" points="1428.5,-865.56 1651.5,-865.56 "/>
<text text-anchor="start" x="1436.5" y="-850.36" font-family="Times,serif" font-size="14.00" fill="#40575d">index</text>
<polyline fill="none" stroke="#f7e495" points="1428.5,-842.56 1651.5,-842.56 "/>
<text text-anchor="start" x="1436.5" y="-827.36" font-family="Times,serif" font-size="14.00" fill="#40575d">set_commit(self.raft_log.committed);</text>
</g>
<!-- MessageAppendResponse&#45;&gt;send -->
<g id="edge27" class="edge">
<title>MessageAppendResponse&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1651.69,-825.45C1662.19,-817.91 1671.64,-809.02 1679,-798.56 1741.82,-709.29 1742.62,-356.4 1741.47,-253.11"/>
<polygon fill="green" stroke="green" points="1744.96,-252.79 1741.33,-242.84 1737.96,-252.88 1744.96,-252.79"/>
</g>
<!-- last_idx -->
<g id="node13" class="node">
<title>last_idx</title>
<path fill="none" stroke="#1c2123" d="M1219.5,-886.56C1219.5,-886.56 1184.5,-886.56 1184.5,-886.56 1178.5,-886.56 1172.5,-880.56 1172.5,-874.56 1172.5,-874.56 1172.5,-862.56 1172.5,-862.56 1172.5,-856.56 1178.5,-850.56 1184.5,-850.56 1184.5,-850.56 1219.5,-850.56 1219.5,-850.56 1225.5,-850.56 1231.5,-856.56 1231.5,-862.56 1231.5,-862.56 1231.5,-874.56 1231.5,-874.56 1231.5,-880.56 1225.5,-886.56 1219.5,-886.56"/>
<text text-anchor="middle" x="1202" y="-864.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">last_idx</text>
</g>
<!-- last_idx&#45;&gt;MessageAppendResponse -->
<g id="edge12" class="edge">
<title>last_idx&#45;&gt;MessageAppendResponse:index</title>
<path fill="none" stroke="#666666" d="M1231.6,-865.42C1272.07,-861.24 1348.69,-854.29 1416.61,-853.62"/>
<polygon fill="#666666" stroke="#666666" points="1417.02,-857.11 1427,-853.56 1416.98,-850.11 1417.02,-857.11"/>
</g>
<!-- match_term&#45;&gt;MessageAppendResponse_reject -->
<g id="edge18" class="edge">
<title>match_term&#45;&gt;MessageAppendResponse_reject</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1218.86,-550.28C1248.43,-508.39 1316.03,-419.53 1399.44,-359.94"/>
<polygon fill="green" stroke="green" points="1401.63,-362.69 1407.83,-354.09 1397.63,-356.95 1401.63,-362.69"/>
</g>
<!-- term -->
<g id="node18" class="node">
<title>term</title>
<path fill="none" stroke="#1c2123" d="M1458.5,-514.56C1458.5,-514.56 1621.5,-514.56 1621.5,-514.56 1627.5,-514.56 1633.5,-520.56 1633.5,-526.56 1633.5,-526.56 1633.5,-586.56 1633.5,-586.56 1633.5,-592.56 1627.5,-598.56 1621.5,-598.56 1621.5,-598.56 1458.5,-598.56 1458.5,-598.56 1452.5,-598.56 1446.5,-592.56 1446.5,-586.56 1446.5,-586.56 1446.5,-526.56 1446.5,-526.56 1446.5,-520.56 1452.5,-514.56 1458.5,-514.56"/>
<text text-anchor="middle" x="1540" y="-583.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">term</text>
<polyline fill="none" stroke="#1c2123" points="1446.5,-575.56 1633.5,-575.56 "/>
<text text-anchor="start" x="1454.5" y="-560.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">term(&amp;self, idx: u64)</text>
<polyline fill="none" stroke="#1c2123" points="1446.5,-552.56 1633.5,-552.56 "/>
<text text-anchor="start" x="1454.5" y="-537.36" font-family="Times,serif" font-size="14.00" fill="#2f3638">For a given index find the term</text>
<text text-anchor="start" x="1454.5" y="-522.36" font-family="Times,serif" font-size="14.00" fill="#2f3638"> associated with it</text>
</g>
<!-- match_term&#45;&gt;term -->
<g id="edge19" class="edge">
<title>match_term&#45;&gt;term</title>
<path fill="none" stroke="#666666" d="M1281.78,-569.58C1327.87,-567.25 1386.58,-564.28 1436.28,-561.76"/>
<polygon fill="#666666" stroke="#666666" points="1436.6,-565.25 1446.41,-561.25 1436.25,-558.26 1436.6,-565.25"/>
</g>
<!-- find_conflict&#45;&gt;match_term -->
<g id="edge20" class="edge">
<title>find_conflict&#45;&gt;match_term</title>
<path fill="none" stroke="#666666" d="M985.67,-616.63C1026.38,-608.49 1073.07,-599.15 1112.55,-591.25"/>
<polygon fill="#666666" stroke="#666666" points="1113.31,-594.67 1122.43,-589.28 1111.93,-587.81 1113.31,-594.67"/>
</g>
<!-- append&#45;&gt;commit_to -->
<g id="edge22" class="edge">
<title>append&#45;&gt;commit_to</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M994.44,-538.32C997.39,-541.37 1000.25,-544.45 1003,-547.56 1023.34,-570.59 1016.33,-585.83 1039,-606.56 1047.24,-614.1 1056.31,-621.08 1065.83,-627.52"/>
<polygon fill="green" stroke="green" points="1064.02,-630.52 1074.31,-633.04 1067.84,-624.65 1064.02,-630.52"/>
</g>
<!-- truncate_and_append -->
<g id="node19" class="node">
<title>truncate_and_append</title>
<path fill="none" stroke="#1c2123" d="M1256,-208.56C1256,-208.56 1148,-208.56 1148,-208.56 1142,-208.56 1136,-202.56 1136,-196.56 1136,-196.56 1136,-184.56 1136,-184.56 1136,-178.56 1142,-172.56 1148,-172.56 1148,-172.56 1256,-172.56 1256,-172.56 1262,-172.56 1268,-178.56 1268,-184.56 1268,-184.56 1268,-196.56 1268,-196.56 1268,-202.56 1262,-208.56 1256,-208.56"/>
<text text-anchor="middle" x="1202" y="-186.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">truncate_and_append</text>
</g>
<!-- append&#45;&gt;truncate_and_append -->
<g id="edge21" class="edge">
<title>append&#45;&gt;truncate_and_append</title>
<path fill="none" stroke="#666666" d="M985.67,-371.03C1050.05,-317.08 1129.4,-250.57 1171.5,-215.29"/>
<polygon fill="#666666" stroke="#666666" points="1173.99,-217.76 1179.41,-208.66 1169.5,-212.4 1173.99,-217.76"/>
</g>
<!-- commit_to&#45;&gt;RaftLog -->
<g id="edge23" class="edge">
<title>commit_to&#45;&gt;RaftLog</title>
<path fill="none" stroke="#666666" d="M1365.09,-686.56C1397.83,-686.56 1430.86,-686.56 1459.21,-686.56"/>
<polygon fill="#666666" stroke="#666666" points="1459.43,-690.06 1469.43,-686.56 1459.43,-683.06 1459.43,-690.06"/>
</g>
<!-- entries -->
<g id="node20" class="node">
<title>entries</title>
<path fill="none" stroke="#1c2123" d="M1555,-208.56C1555,-208.56 1525,-208.56 1525,-208.56 1519,-208.56 1513,-202.56 1513,-196.56 1513,-196.56 1513,-184.56 1513,-184.56 1513,-178.56 1519,-172.56 1525,-172.56 1525,-172.56 1555,-172.56 1555,-172.56 1561,-172.56 1567,-178.56 1567,-184.56 1567,-184.56 1567,-196.56 1567,-196.56 1567,-202.56 1561,-208.56 1555,-208.56"/>
<text text-anchor="middle" x="1540" y="-186.86" font-family="Times,serif" font-size="14.00" fill="#2f3638">entries</text>
</g>
<!-- truncate_and_append&#45;&gt;entries -->
<g id="edge24" class="edge">
<title>truncate_and_append&#45;&gt;entries</title>
<path fill="none" stroke="#666666" d="M1268.18,-190.56C1338.1,-190.56 1446.63,-190.56 1502.71,-190.56"/>
<polygon fill="#666666" stroke="#666666" points="1502.88,-194.06 1512.88,-190.56 1502.88,-187.06 1502.88,-194.06"/>
</g>
</g>
</svg>
