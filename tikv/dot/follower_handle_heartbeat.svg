<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: handle_heartbeats Pages: 1 -->
<svg width="1409pt" height="608pt"
 viewBox="0.00 0.00 1409.00 608.41" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 604.41)">
<title>handle_heartbeats</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-604.41 1405,-604.41 1405,4 -4,4"/>
<!-- step -->
<g id="node1" class="node">
<title>step</title>
<path fill="none" stroke="#1c2123" d="M42,-268C42,-268 12,-268 12,-268 6,-268 0,-262 0,-256 0,-256 0,-244 0,-244 0,-238 6,-232 12,-232 12,-232 42,-232 42,-232 48,-232 54,-238 54,-244 54,-244 54,-256 54,-256 54,-262 48,-268 42,-268"/>
<text text-anchor="middle" x="27" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step</text>
</g>
<!-- step_follower -->
<g id="node2" class="node">
<title>step_follower</title>
<path fill="none" stroke="#1c2123" d="M221,-422C221,-422 154,-422 154,-422 148,-422 142,-416 142,-410 142,-410 142,-398 142,-398 142,-392 148,-386 154,-386 154,-386 221,-386 221,-386 227,-386 233,-392 233,-398 233,-398 233,-410 233,-410 233,-416 227,-422 221,-422"/>
<text text-anchor="middle" x="187.5" y="-400.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_follower</text>
</g>
<!-- step&#45;&gt;step_follower -->
<g id="edge1" class="edge">
<title>step&#45;&gt;step_follower</title>
<path fill="none" stroke="#666666" d="M46.8,-268.27C75.05,-295.71 128.5,-347.65 160.47,-378.71"/>
<polygon fill="#666666" stroke="#666666" points="158.11,-381.29 167.72,-385.75 162.99,-376.27 158.11,-381.29"/>
</g>
<!-- step_candidate -->
<g id="node3" class="node">
<title>step_candidate</title>
<path fill="none" stroke="#1c2123" d="M224,-268C224,-268 151,-268 151,-268 145,-268 139,-262 139,-256 139,-256 139,-244 139,-244 139,-238 145,-232 151,-232 151,-232 224,-232 224,-232 230,-232 236,-238 236,-244 236,-244 236,-256 236,-256 236,-262 230,-268 224,-268"/>
<text text-anchor="middle" x="187.5" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_candidate</text>
</g>
<!-- step&#45;&gt;step_candidate -->
<g id="edge2" class="edge">
<title>step&#45;&gt;step_candidate</title>
<path fill="none" stroke="#666666" d="M54.17,-250C74.34,-250 103,-250 128.49,-250"/>
<polygon fill="#666666" stroke="#666666" points="128.82,-253.5 138.82,-250 128.82,-246.5 128.82,-253.5"/>
</g>
<!-- case_leader_lower_term -->
<g id="node4" class="node">
<title>case_leader_lower_term</title>
<path fill="#feed9b" stroke="#f7e495" d="M102,-41.5C102,-41.5 273,-41.5 273,-41.5 279,-41.5 285,-47.5 285,-53.5 285,-53.5 285,-128.5 285,-128.5 285,-134.5 279,-140.5 273,-140.5 273,-140.5 102,-140.5 102,-140.5 96,-140.5 90,-134.5 90,-128.5 90,-128.5 90,-53.5 90,-53.5 90,-47.5 96,-41.5 102,-41.5"/>
<text text-anchor="middle" x="187.5" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#40575d">case_leader_lower_term</text>
<polyline fill="none" stroke="#f7e495" points="90,-117.5 285,-117.5 "/>
<text text-anchor="start" x="98" y="-102.3" font-family="Times,serif" font-size="14.00" fill="#40575d">received messages from a leader</text>
<text text-anchor="start" x="98" y="-87.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> at a lower term</text>
<polyline fill="none" stroke="#f7e495" points="90,-79.5 285,-79.5 "/>
<text text-anchor="start" x="98" y="-64.3" font-family="Times,serif" font-size="14.00" fill="#40575d">需要考虑network delay</text>
<text text-anchor="start" x="98" y="-49.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> network partition</text>
</g>
<!-- step&#45;&gt;case_leader_lower_term -->
<g id="edge3" class="edge">
<title>step&#45;&gt;case_leader_lower_term</title>
<path fill="none" stroke="#666666" d="M46.18,-231.76C66.5,-211.38 100.39,-177.38 129.78,-147.9"/>
<polygon fill="#666666" stroke="#666666" points="132.57,-150.06 137.15,-140.51 127.61,-145.12 132.57,-150.06"/>
</g>
<!-- election_elapsed -->
<g id="node7" class="node">
<title>election_elapsed</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M423,-511C423,-511 569,-511 569,-511 575,-511 581,-517 581,-523 581,-523 581,-545 581,-545 581,-551 575,-557 569,-557 569,-557 423,-557 423,-557 417,-557 411,-551 411,-545 411,-545 411,-523 411,-523 411,-517 417,-511 423,-511"/>
<text text-anchor="middle" x="496" y="-541.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">election_elapsed</text>
<polyline fill="none" stroke="#60b5ac" points="411,-534 581,-534 "/>
<text text-anchor="start" x="419" y="-518.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">将election_elapsed重置为0</text>
</g>
<!-- step_follower&#45;&gt;election_elapsed -->
<g id="edge6" class="edge">
<title>step_follower&#45;&gt;election_elapsed</title>
<path fill="none" stroke="#666666" d="M207.41,-422.17C231.67,-444.4 276.02,-481.47 321,-501 345.88,-511.81 374.28,-519.08 400.82,-523.98"/>
<polygon fill="#666666" stroke="#666666" points="400.43,-527.47 410.89,-525.74 401.64,-520.57 400.43,-527.47"/>
</g>
<!-- leader_id -->
<g id="node8" class="node">
<title>leader_id</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M409,-400.5C409,-400.5 583,-400.5 583,-400.5 589,-400.5 595,-406.5 595,-412.5 595,-412.5 595,-479.5 595,-479.5 595,-485.5 589,-491.5 583,-491.5 583,-491.5 409,-491.5 409,-491.5 403,-491.5 397,-485.5 397,-479.5 397,-479.5 397,-412.5 397,-412.5 397,-406.5 403,-400.5 409,-400.5"/>
<text text-anchor="middle" x="496" y="-476.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">leader_id</text>
<polyline fill="none" stroke="#60b5ac" points="397,-468.5 595,-468.5 "/>
<text text-anchor="start" x="405" y="-453.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub struct RaftCore&lt;T: Storage&gt;</text>
<text text-anchor="start" x="405" y="-438.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> pub leader_id: u64</text>
<text text-anchor="start" x="405" y="-423.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 更新leader_id</text>
<text text-anchor="start" x="405" y="-408.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 方便后续redirect请求 到leader</text>
</g>
<!-- step_follower&#45;&gt;leader_id -->
<g id="edge7" class="edge">
<title>step_follower&#45;&gt;leader_id</title>
<path fill="none" stroke="#666666" d="M233.07,-410.11C273.23,-415.61 333.92,-423.93 386.76,-431.17"/>
<polygon fill="#666666" stroke="#666666" points="386.49,-434.66 396.87,-432.55 387.44,-427.73 386.49,-434.66"/>
</g>
<!-- handle_heartbeat -->
<g id="node9" class="node">
<title>handle_heartbeat</title>
<path fill="none" stroke="#1c2123" d="M453.5,-345C453.5,-345 538.5,-345 538.5,-345 544.5,-345 550.5,-351 550.5,-357 550.5,-357 550.5,-369 550.5,-369 550.5,-375 544.5,-381 538.5,-381 538.5,-381 453.5,-381 453.5,-381 447.5,-381 441.5,-375 441.5,-369 441.5,-369 441.5,-357 441.5,-357 441.5,-351 447.5,-345 453.5,-345"/>
<text text-anchor="middle" x="496" y="-359.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_heartbeat</text>
</g>
<!-- step_follower&#45;&gt;handle_heartbeat -->
<g id="edge8" class="edge">
<title>step_follower&#45;&gt;handle_heartbeat</title>
<path fill="none" stroke="#666666" d="M233.07,-398.04C285.25,-391.06 372.08,-379.44 431.35,-371.51"/>
<polygon fill="#666666" stroke="#666666" points="431.9,-374.97 441.35,-370.18 430.97,-368.03 431.9,-374.97"/>
</g>
<!-- step_candidate&#45;&gt;handle_heartbeat -->
<g id="edge9" class="edge">
<title>step_candidate&#45;&gt;handle_heartbeat</title>
<path fill="none" stroke="#666666" d="M217.78,-268.14C244,-283.73 283.93,-305.87 321,-320 356.57,-333.56 397.89,-343.98 431.33,-351.16"/>
<polygon fill="#666666" stroke="#666666" points="430.93,-354.66 441.44,-353.29 432.37,-347.81 430.93,-354.66"/>
</g>
<!-- become_follower -->
<g id="node10" class="node">
<title>become_follower</title>
<path fill="none" stroke="#1c2123" d="M333,-127.5C333,-127.5 659,-127.5 659,-127.5 665,-127.5 671,-133.5 671,-139.5 671,-139.5 671,-244.5 671,-244.5 671,-250.5 665,-256.5 659,-256.5 659,-256.5 333,-256.5 333,-256.5 327,-256.5 321,-250.5 321,-244.5 321,-244.5 321,-139.5 321,-139.5 321,-133.5 327,-127.5 333,-127.5"/>
<text text-anchor="middle" x="496" y="-241.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">become_follower</text>
<polyline fill="none" stroke="#1c2123" points="321,-233.5 671,-233.5 "/>
<text text-anchor="start" x="329" y="-218.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将term重置为heartbeat消息的term</text>
<text text-anchor="middle" x="496" y="-203.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将角色设置为follower</text>
<polyline fill="none" stroke="#1c2123" points="321,-195.5 671,-195.5 "/>
<text text-anchor="start" x="329" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.reset(term);</text>
<text text-anchor="start" x="329" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.leader_id = leader_id;</text>
<text text-anchor="start" x="329" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.state = StateRole::Follower;</text>
<text text-anchor="start" x="329" y="-135.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.pending_request_snapshot = pending_request_snapshot;</text>
</g>
<!-- step_candidate&#45;&gt;become_follower -->
<g id="edge10" class="edge">
<title>step_candidate&#45;&gt;become_follower</title>
<path fill="none" stroke="#666666" d="M236.05,-241C257.11,-237.02 283.36,-232.05 311,-226.82"/>
<polygon fill="#666666" stroke="#666666" points="311.65,-230.26 320.83,-224.96 310.35,-223.38 311.65,-230.26"/>
</g>
<!-- check_quorum -->
<g id="node5" class="node">
<title>check_quorum</title>
<path fill="none" stroke="#1c2123" d="M533,-109C533,-109 459,-109 459,-109 453,-109 447,-103 447,-97 447,-97 447,-85 447,-85 447,-79 453,-73 459,-73 459,-73 533,-73 533,-73 539,-73 545,-79 545,-85 545,-85 545,-97 545,-97 545,-103 539,-109 533,-109"/>
<text text-anchor="middle" x="496" y="-87.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_quorum</text>
</g>
<!-- case_leader_lower_term&#45;&gt;check_quorum -->
<g id="edge4" class="edge">
<title>case_leader_lower_term&#45;&gt;check_quorum</title>
<path fill="none" stroke="#666666" d="M285.06,-91C334.82,-91 393.88,-91 436.65,-91"/>
<polygon fill="#666666" stroke="#666666" points="436.89,-94.5 446.89,-91 436.89,-87.5 436.89,-94.5"/>
</g>
<!-- pre_vote -->
<g id="node6" class="node">
<title>pre_vote</title>
<path fill="none" stroke="#1c2123" d="M516,-55C516,-55 476,-55 476,-55 470,-55 464,-49 464,-43 464,-43 464,-31 464,-31 464,-25 470,-19 476,-19 476,-19 516,-19 516,-19 522,-19 528,-25 528,-31 528,-31 528,-43 528,-43 528,-49 522,-55 516,-55"/>
<text text-anchor="middle" x="496" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pre_vote</text>
</g>
<!-- case_leader_lower_term&#45;&gt;pre_vote -->
<g id="edge5" class="edge">
<title>case_leader_lower_term&#45;&gt;pre_vote</title>
<path fill="none" stroke="#666666" d="M285.01,-70.78C297.11,-68.41 309.33,-66.09 321,-64 366.32,-55.87 418.55,-47.96 453.87,-42.83"/>
<polygon fill="#666666" stroke="#666666" points="454.41,-46.28 463.81,-41.39 453.41,-39.35 454.41,-46.28"/>
</g>
<!-- MsgHeartbeatResponse -->
<g id="node11" class="node">
<title>MsgHeartbeatResponse</title>
<path fill="#feed9b" stroke="#f7e495" d="M719,-440C719,-440 952,-440 952,-440 958,-440 964,-446 964,-452 964,-452 964,-512 964,-512 964,-518 958,-524 952,-524 952,-524 719,-524 719,-524 713,-524 707,-518 707,-512 707,-512 707,-452 707,-452 707,-446 713,-440 719,-440"/>
<text text-anchor="middle" x="835.5" y="-508.8" font-family="Times,serif" font-size="14.00" fill="#40575d">MsgHeartbeatResponse</text>
<polyline fill="none" stroke="#f7e495" points="707,-501 964,-501 "/>
<text text-anchor="start" x="715" y="-485.8" font-family="Times,serif" font-size="14.00" fill="#40575d">to_send.to = m.from;</text>
<polyline fill="none" stroke="#f7e495" points="707,-478 964,-478 "/>
<text text-anchor="start" x="715" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#40575d">to_send.context = m.take_context();</text>
<text text-anchor="start" x="715" y="-447.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> to_send.commit = self.raft_log.committed;</text>
</g>
<!-- handle_heartbeat&#45;&gt;MsgHeartbeatResponse -->
<g id="edge11" class="edge">
<title>handle_heartbeat&#45;&gt;MsgHeartbeatResponse</title>
<path fill="none" stroke="#666666" d="M550.5,-362.66C586.48,-364.51 633.93,-371.11 671,-391 691.79,-402.15 687.62,-416.56 707,-430 709.19,-431.52 711.43,-433.01 713.72,-434.46"/>
<polygon fill="#666666" stroke="#666666" points="712.36,-437.72 722.73,-439.89 715.97,-431.73 712.36,-437.72"/>
</g>
<!-- raft_log_commit_to -->
<g id="node12" class="node">
<title>raft_log_commit_to</title>
<path fill="none" stroke="#1c2123" d="M726.5,-321.5C726.5,-321.5 944.5,-321.5 944.5,-321.5 950.5,-321.5 956.5,-327.5 956.5,-333.5 956.5,-333.5 956.5,-408.5 956.5,-408.5 956.5,-414.5 950.5,-420.5 944.5,-420.5 944.5,-420.5 726.5,-420.5 726.5,-420.5 720.5,-420.5 714.5,-414.5 714.5,-408.5 714.5,-408.5 714.5,-333.5 714.5,-333.5 714.5,-327.5 720.5,-321.5 726.5,-321.5"/>
<text text-anchor="middle" x="835.5" y="-405.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">raft_log.commit_to</text>
<polyline fill="none" stroke="#1c2123" points="714.5,-397.5 956.5,-397.5 "/>
<text text-anchor="start" x="722.5" y="-382.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将log commit index</text>
<text text-anchor="start" x="722.5" y="-367.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置为和message一致</text>
<polyline fill="none" stroke="#1c2123" points="714.5,-359.5 956.5,-359.5 "/>
<text text-anchor="start" x="722.5" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">这个地方为什么可以直接设置？</text>
<text text-anchor="start" x="722.5" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果follower的index 比commit小呢？</text>
</g>
<!-- handle_heartbeat&#45;&gt;raft_log_commit_to -->
<g id="edge12" class="edge">
<title>handle_heartbeat&#45;&gt;raft_log_commit_to</title>
<path fill="none" stroke="#666666" d="M550.85,-364.28C592.11,-365.25 650.83,-366.65 704.14,-367.91"/>
<polygon fill="#666666" stroke="#666666" points="704.3,-371.41 714.38,-368.15 704.46,-364.42 704.3,-371.41"/>
</g>
<!-- send_request_snapshot -->
<g id="node13" class="node">
<title>send_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M894,-303C894,-303 777,-303 777,-303 771,-303 765,-297 765,-291 765,-291 765,-279 765,-279 765,-273 771,-267 777,-267 777,-267 894,-267 894,-267 900,-267 906,-273 906,-279 906,-279 906,-291 906,-291 906,-297 900,-303 894,-303"/>
<text text-anchor="middle" x="835.5" y="-281.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_request_snapshot</text>
</g>
<!-- handle_heartbeat&#45;&gt;send_request_snapshot -->
<g id="edge13" class="edge">
<title>handle_heartbeat&#45;&gt;send_request_snapshot</title>
<path fill="none" stroke="#666666" d="M550.85,-349.46C593.21,-338.92 653.77,-324.1 707,-312 722.53,-308.47 739.16,-304.84 755.11,-301.43"/>
<polygon fill="#666666" stroke="#666666" points="755.88,-304.85 764.94,-299.34 754.43,-298 755.88,-304.85"/>
</g>
<!-- send -->
<g id="node14" class="node">
<title>send</title>
<path fill="none" stroke="#1c2123" d="M1389,-481C1389,-481 1359,-481 1359,-481 1353,-481 1347,-475 1347,-469 1347,-469 1347,-457 1347,-457 1347,-451 1353,-445 1359,-445 1359,-445 1389,-445 1389,-445 1395,-445 1401,-451 1401,-457 1401,-457 1401,-469 1401,-469 1401,-475 1395,-481 1389,-481"/>
<text text-anchor="middle" x="1374" y="-459.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">send</text>
</g>
<!-- handle_heartbeat&#45;&gt;send -->
<g id="edge14" class="edge">
<title>handle_heartbeat&#45;&gt;send</title>
<path fill="none" stroke="#666666" d="M550.73,-357.25C588.94,-356.24 638.97,-361.64 671,-391 719.32,-435.28 655.31,-493.71 707,-534 901.3,-685.44 1230.12,-537.6 1337.75,-482.11"/>
<polygon fill="#666666" stroke="#666666" points="1339.63,-485.08 1346.88,-477.35 1336.4,-478.87 1339.63,-485.08"/>
</g>
<!-- reset -->
<g id="node17" class="node">
<title>reset</title>
<path fill="none" stroke="#1c2123" d="M785.5,-112.5C785.5,-112.5 885.5,-112.5 885.5,-112.5 891.5,-112.5 897.5,-118.5 897.5,-124.5 897.5,-124.5 897.5,-161.5 897.5,-161.5 897.5,-167.5 891.5,-173.5 885.5,-173.5 885.5,-173.5 785.5,-173.5 785.5,-173.5 779.5,-173.5 773.5,-167.5 773.5,-161.5 773.5,-161.5 773.5,-124.5 773.5,-124.5 773.5,-118.5 779.5,-112.5 785.5,-112.5"/>
<text text-anchor="middle" x="835.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset</text>
<polyline fill="none" stroke="#1c2123" points="773.5,-150.5 897.5,-150.5 "/>
<text text-anchor="start" x="781.5" y="-135.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Resets the current</text>
<text text-anchor="start" x="781.5" y="-120.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> node to given term</text>
</g>
<!-- become_follower&#45;&gt;reset -->
<g id="edge20" class="edge">
<title>become_follower&#45;&gt;reset</title>
<path fill="none" stroke="#666666" d="M671.19,-166.71C703.77,-161.98 736.09,-157.29 763.27,-153.34"/>
<polygon fill="#666666" stroke="#666666" points="764.03,-156.77 773.42,-151.87 763.02,-149.84 764.03,-156.77"/>
</g>
<!-- MsgHeartbeatResponse&#45;&gt;send -->
<g id="edge18" class="edge">
<title>MsgHeartbeatResponse&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M964.32,-477.47C1086.03,-473.16 1261.45,-466.95 1336.59,-464.29"/>
<polygon fill="green" stroke="green" points="1337.06,-467.77 1346.93,-463.92 1336.82,-460.78 1337.06,-467.77"/>
</g>
<!-- send_request_snapshot&#45;&gt;send -->
<g id="edge16" class="edge">
<title>send_request_snapshot&#45;&gt;send</title>
<path fill="none" stroke="#666666" d="M906.11,-286.61C926.85,-290.3 948.23,-297.73 964,-312 1003.08,-347.37 959.08,-391.78 1000,-425 1025.83,-445.97 1248.28,-457.68 1336.85,-461.55"/>
<polygon fill="#666666" stroke="#666666" points="1336.82,-465.05 1346.96,-461.98 1337.12,-458.06 1336.82,-465.05"/>
</g>
<!-- MsgAppendResponse -->
<g id="node16" class="node">
<title>MsgAppendResponse</title>
<path fill="#feed9b" stroke="#f7e495" d="M1012,-277C1012,-277 1299,-277 1299,-277 1305,-277 1311,-283 1311,-289 1311,-289 1311,-403 1311,-403 1311,-409 1305,-415 1299,-415 1299,-415 1012,-415 1012,-415 1006,-415 1000,-409 1000,-403 1000,-403 1000,-289 1000,-289 1000,-283 1006,-277 1012,-277"/>
<text text-anchor="middle" x="1155.5" y="-399.8" font-family="Times,serif" font-size="14.00" fill="#40575d">MsgAppendResponse</text>
<polyline fill="none" stroke="#f7e495" points="1000,-392 1311,-392 "/>
<text text-anchor="start" x="1008" y="-376.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.index = self.raft_log.committed;</text>
<polyline fill="none" stroke="#f7e495" points="1000,-369 1311,-369 "/>
<text text-anchor="start" x="1008" y="-353.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.reject = true;</text>
<polyline fill="none" stroke="#f7e495" points="1000,-346 1311,-346 "/>
<text text-anchor="start" x="1008" y="-330.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.reject_hint = self.raft_log.last_index();</text>
<polyline fill="none" stroke="#f7e495" points="1000,-323 1311,-323 "/>
<text text-anchor="start" x="1008" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.to = self.leader_id;</text>
<polyline fill="none" stroke="#f7e495" points="1000,-300 1311,-300 "/>
<text text-anchor="start" x="1008" y="-284.8" font-family="Times,serif" font-size="14.00" fill="#40575d">m.request_snapshot = self.pending_request_snapshot;</text>
</g>
<!-- send_request_snapshot&#45;&gt;MsgAppendResponse -->
<g id="edge17" class="edge">
<title>send_request_snapshot&#45;&gt;MsgAppendResponse</title>
<path fill="none" stroke="#666666" d="M906.29,-298.39C931.17,-303.16 960.37,-308.76 989.82,-314.41"/>
<polygon fill="#666666" stroke="#666666" points="989.34,-317.88 999.82,-316.33 990.66,-311.01 989.34,-317.88"/>
</g>
<!-- pending_request_snapshot -->
<g id="node15" class="node">
<title>pending_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M564,-311C564,-311 428,-311 428,-311 422,-311 416,-305 416,-299 416,-299 416,-287 416,-287 416,-281 422,-275 428,-275 428,-275 564,-275 564,-275 570,-275 576,-281 576,-287 576,-287 576,-299 576,-299 576,-305 570,-311 564,-311"/>
<text text-anchor="middle" x="496" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_request_snapshot</text>
</g>
<!-- pending_request_snapshot&#45;&gt;send_request_snapshot -->
<g id="edge15" class="edge">
<title>pending_request_snapshot&#45;&gt;send_request_snapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M576.13,-291.12C629.85,-289.85 700.64,-288.17 754.54,-286.9"/>
<polygon fill="green" stroke="green" points="754.83,-290.39 764.74,-286.65 754.66,-283.39 754.83,-290.39"/>
</g>
<!-- MsgAppendResponse&#45;&gt;send -->
<g id="edge19" class="edge">
<title>MsgAppendResponse&#45;&gt;send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1284.32,-415.07C1304.03,-425.73 1322.84,-435.9 1338.03,-444.1"/>
<polygon fill="green" stroke="green" points="1336.53,-447.27 1347,-448.95 1339.86,-441.11 1336.53,-447.27"/>
</g>
<!-- reset_randomized_election_timeout -->
<g id="node18" class="node">
<title>reset_randomized_election_timeout</title>
<path fill="none" stroke="#1c2123" d="M1061.5,-196.5C1061.5,-196.5 1249.5,-196.5 1249.5,-196.5 1255.5,-196.5 1261.5,-202.5 1261.5,-208.5 1261.5,-208.5 1261.5,-245.5 1261.5,-245.5 1261.5,-251.5 1255.5,-257.5 1249.5,-257.5 1249.5,-257.5 1061.5,-257.5 1061.5,-257.5 1055.5,-257.5 1049.5,-251.5 1049.5,-245.5 1049.5,-245.5 1049.5,-208.5 1049.5,-208.5 1049.5,-202.5 1055.5,-196.5 1061.5,-196.5"/>
<text text-anchor="middle" x="1155.5" y="-242.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset_randomized_election_timeout</text>
<polyline fill="none" stroke="#1c2123" points="1049.5,-234.5 1261.5,-234.5 "/>
<text text-anchor="start" x="1057.5" y="-219.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">重新生成一个随机</text>
<text text-anchor="start" x="1057.5" y="-204.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> election_timout时间</text>
</g>
<!-- reset&#45;&gt;reset_randomized_election_timeout -->
<g id="edge21" class="edge">
<title>reset&#45;&gt;reset_randomized_election_timeout</title>
<path fill="none" stroke="#666666" d="M897.8,-159.64C928.47,-167.94 966.18,-178.07 1000,-187 1012.83,-190.39 1026.26,-193.9 1039.62,-197.39"/>
<polygon fill="#666666" stroke="#666666" points="1038.77,-200.78 1049.33,-199.92 1040.54,-194.01 1038.77,-200.78"/>
</g>
<!-- abort_leader_transfer -->
<g id="node19" class="node">
<title>abort_leader_transfer</title>
<path fill="none" stroke="#1c2123" d="M1081,-108.5C1081,-108.5 1230,-108.5 1230,-108.5 1236,-108.5 1242,-114.5 1242,-120.5 1242,-120.5 1242,-165.5 1242,-165.5 1242,-171.5 1236,-177.5 1230,-177.5 1230,-177.5 1081,-177.5 1081,-177.5 1075,-177.5 1069,-171.5 1069,-165.5 1069,-165.5 1069,-120.5 1069,-120.5 1069,-114.5 1075,-108.5 1081,-108.5"/>
<text text-anchor="middle" x="1155.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">abort_leader_transfer</text>
<polyline fill="none" stroke="#1c2123" points="1069,-154.5 1242,-154.5 "/>
<text text-anchor="start" x="1077" y="-139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.lead_transferee = None;</text>
<polyline fill="none" stroke="#1c2123" points="1069,-131.5 1242,-131.5 "/>
<text text-anchor="start" x="1077" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Stops the transfer of a leader</text>
</g>
<!-- reset&#45;&gt;abort_leader_transfer -->
<g id="edge22" class="edge">
<title>reset&#45;&gt;abort_leader_transfer</title>
<path fill="none" stroke="#666666" d="M897.81,-143C943.33,-143 1006.28,-143 1058.45,-143"/>
<polygon fill="#666666" stroke="#666666" points="1058.73,-146.5 1068.73,-143 1058.73,-139.5 1058.73,-146.5"/>
</g>
<!-- reset_votes -->
<g id="node20" class="node">
<title>reset_votes</title>
<path fill="none" stroke="#1c2123" d="M1182,-90C1182,-90 1129,-90 1129,-90 1123,-90 1117,-84 1117,-78 1117,-78 1117,-66 1117,-66 1117,-60 1123,-54 1129,-54 1129,-54 1182,-54 1182,-54 1188,-54 1194,-60 1194,-66 1194,-66 1194,-78 1194,-78 1194,-84 1188,-90 1182,-90"/>
<text text-anchor="middle" x="1155.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">reset_votes</text>
</g>
<!-- reset&#45;&gt;reset_votes -->
<g id="edge23" class="edge">
<title>reset&#45;&gt;reset_votes</title>
<path fill="none" stroke="#666666" d="M897.51,-125.18C928.12,-116.6 965.85,-106.56 1000,-99 1035.59,-91.12 1076.2,-84.1 1106.86,-79.19"/>
<polygon fill="#666666" stroke="#666666" points="1107.52,-82.63 1116.85,-77.61 1106.43,-75.72 1107.52,-82.63"/>
</g>
<!-- pr_reset -->
<g id="node21" class="node">
<title>pr_reset</title>
<path fill="none" stroke="#1c2123" d="M1173.5,-36C1173.5,-36 1137.5,-36 1137.5,-36 1131.5,-36 1125.5,-30 1125.5,-24 1125.5,-24 1125.5,-12 1125.5,-12 1125.5,-6 1131.5,0 1137.5,0 1137.5,0 1173.5,0 1173.5,0 1179.5,0 1185.5,-6 1185.5,-12 1185.5,-12 1185.5,-24 1185.5,-24 1185.5,-30 1179.5,-36 1173.5,-36"/>
<text text-anchor="middle" x="1155.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pr_reset</text>
</g>
<!-- reset&#45;&gt;pr_reset -->
<g id="edge24" class="edge">
<title>reset&#45;&gt;pr_reset</title>
<path fill="none" stroke="#666666" d="M877.69,-112.46C909.51,-90.36 955.5,-61.57 1000,-45 1037.71,-30.96 1083.38,-24.13 1115.24,-20.87"/>
<polygon fill="#666666" stroke="#666666" points="1115.86,-24.32 1125.48,-19.89 1115.2,-17.35 1115.86,-24.32"/>
</g>
</g>
</svg>
