<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: handle_heartbeat_response Pages: 1 -->
<svg width="1792pt" height="916pt"
 viewBox="0.00 0.00 1792.00 916.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 912)">
<title>handle_heartbeat_response</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-912 1788,-912 1788,4 -4,4"/>
<!-- ProgressTracker -->
<g id="node1" class="node">
<title>ProgressTracker</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M126,-707.5C126,-707.5 276,-707.5 276,-707.5 282,-707.5 288,-713.5 288,-719.5 288,-719.5 288,-856.5 288,-856.5 288,-862.5 282,-868.5 276,-868.5 276,-868.5 126,-868.5 126,-868.5 120,-868.5 114,-862.5 114,-856.5 114,-856.5 114,-719.5 114,-719.5 114,-713.5 120,-707.5 126,-707.5"/>
<text text-anchor="middle" x="201" y="-853.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">ProgressTracker</text>
<polyline fill="none" stroke="#60b5ac" points="114,-845.5 288,-845.5 "/>
<text text-anchor="start" x="122" y="-830.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">progress: ProgressMap</text>
<polyline fill="none" stroke="#60b5ac" points="114,-822.5 288,-822.5 "/>
<text text-anchor="start" x="122" y="-807.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">conf: Configuration</text>
<polyline fill="none" stroke="#60b5ac" points="114,-799.5 288,-799.5 "/>
<text text-anchor="start" x="122" y="-784.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">votes: HashMap&lt;u64, bool&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="114,-776.5 288,-776.5 "/>
<text text-anchor="start" x="122" y="-761.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">max_inflight: usize</text>
<polyline fill="none" stroke="#60b5ac" points="114,-753.5 288,-753.5 "/>
<text text-anchor="start" x="122" y="-738.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">group_commit: bool</text>
<polyline fill="none" stroke="#60b5ac" points="114,-730.5 288,-730.5 "/>
<text text-anchor="start" x="122" y="-715.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) logger: Logger</text>
</g>
<!-- Configuration -->
<g id="node3" class="node">
<title>Configuration</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M366.5,-792.5C366.5,-792.5 580.5,-792.5 580.5,-792.5 586.5,-792.5 592.5,-798.5 592.5,-804.5 592.5,-804.5 592.5,-895.5 592.5,-895.5 592.5,-901.5 586.5,-907.5 580.5,-907.5 580.5,-907.5 366.5,-907.5 366.5,-907.5 360.5,-907.5 354.5,-901.5 354.5,-895.5 354.5,-895.5 354.5,-804.5 354.5,-804.5 354.5,-798.5 360.5,-792.5 366.5,-792.5"/>
<text text-anchor="middle" x="473.5" y="-892.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Configuration</text>
<polyline fill="none" stroke="#60b5ac" points="354.5,-884.5 592.5,-884.5 "/>
<text text-anchor="start" x="362.5" y="-869.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) voters: JointConfig</text>
<polyline fill="none" stroke="#60b5ac" points="354.5,-861.5 592.5,-861.5 "/>
<text text-anchor="start" x="362.5" y="-846.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) learners: HashSet&lt;u64&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="354.5,-838.5 592.5,-838.5 "/>
<text text-anchor="start" x="362.5" y="-823.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) learners_next: HashSet&lt;u64&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="354.5,-815.5 592.5,-815.5 "/>
<text text-anchor="start" x="362.5" y="-800.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) auto_leave: bool</text>
</g>
<!-- ProgressTracker&#45;&gt;Configuration -->
<g id="edge2" class="edge">
<title>ProgressTracker:conf&#45;&gt;Configuration</title>
<path fill="none" stroke="#666666" d="M288,-811C306.32,-811 325.44,-812.86 344.14,-815.77"/>
<polygon fill="#666666" stroke="#666666" points="343.74,-819.25 354.17,-817.44 344.88,-812.35 343.74,-819.25"/>
</g>
<!-- ProgressMap -->
<g id="node5" class="node">
<title>ProgressMap</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M336,-727C336,-727 611,-727 611,-727 617,-727 623,-733 623,-739 623,-739 623,-761 623,-761 623,-767 617,-773 611,-773 611,-773 336,-773 336,-773 330,-773 324,-767 324,-761 324,-761 324,-739 324,-739 324,-733 330,-727 336,-727"/>
<text text-anchor="middle" x="473.5" y="-757.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ProgressMap</text>
<polyline fill="none" stroke="#60b5ac" points="324,-750 623,-750 "/>
<text text-anchor="middle" x="473.5" y="-734.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub type ProgressMap = HashMap&lt;u64, Progress&gt;</text>
</g>
<!-- ProgressTracker&#45;&gt;ProgressMap -->
<g id="edge3" class="edge">
<title>ProgressTracker&#45;&gt;ProgressMap</title>
<path fill="none" stroke="#666666" d="M288.33,-775.87C296.64,-774.7 305.24,-773.5 313.97,-772.27"/>
<polygon fill="#666666" stroke="#666666" points="314.47,-775.74 323.88,-770.88 313.49,-768.8 314.47,-775.74"/>
</g>
<!-- ProgressState -->
<g id="node2" class="node">
<title>ProgressState</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M1033,-333C1033,-333 1099,-333 1099,-333 1105,-333 1111,-339 1111,-345 1111,-345 1111,-413 1111,-413 1111,-419 1105,-425 1099,-425 1099,-425 1033,-425 1033,-425 1027,-425 1021,-419 1021,-413 1021,-413 1021,-345 1021,-345 1021,-339 1027,-333 1033,-333"/>
<text text-anchor="middle" x="1066" y="-409.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ProgressState</text>
<polyline fill="none" stroke="#60b5ac" points="1021,-402 1111,-402 "/>
<text text-anchor="start" x="1029" y="-386.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Probe</text>
<polyline fill="none" stroke="#60b5ac" points="1021,-379 1111,-379 "/>
<text text-anchor="start" x="1029" y="-363.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Replicate</text>
<polyline fill="none" stroke="#60b5ac" points="1021,-356 1111,-356 "/>
<text text-anchor="start" x="1029" y="-340.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Snapshot</text>
</g>
<!-- JointConfig -->
<g id="node4" class="node">
<title>JointConfig</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M671,-815.5C671,-815.5 867,-815.5 867,-815.5 873,-815.5 879,-821.5 879,-827.5 879,-827.5 879,-872.5 879,-872.5 879,-878.5 873,-884.5 867,-884.5 867,-884.5 671,-884.5 671,-884.5 665,-884.5 659,-878.5 659,-872.5 659,-872.5 659,-827.5 659,-827.5 659,-821.5 665,-815.5 671,-815.5"/>
<text text-anchor="middle" x="769" y="-869.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">JointConfig</text>
<polyline fill="none" stroke="#60b5ac" points="659,-861.5 879,-861.5 "/>
<text text-anchor="start" x="667" y="-846.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) incoming: MajorityConfig</text>
<polyline fill="none" stroke="#60b5ac" points="659,-838.5 879,-838.5 "/>
<text text-anchor="start" x="667" y="-823.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(crate) outgoing: MajorityConfig</text>
</g>
<!-- Configuration&#45;&gt;JointConfig -->
<g id="edge1" class="edge">
<title>Configuration&#45;&gt;JointConfig</title>
<path fill="none" stroke="#666666" d="M592.61,-850C611.02,-850 630.06,-850 648.5,-850"/>
<polygon fill="#666666" stroke="#666666" points="648.68,-853.5 658.68,-850 648.68,-846.5 648.68,-853.5"/>
</g>
<!-- Progress -->
<g id="node6" class="node">
<title>Progress</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M699,-298.5C699,-298.5 839,-298.5 839,-298.5 845,-298.5 851,-304.5 851,-310.5 851,-310.5 851,-447.5 851,-447.5 851,-453.5 845,-459.5 839,-459.5 839,-459.5 699,-459.5 699,-459.5 693,-459.5 687,-453.5 687,-447.5 687,-447.5 687,-310.5 687,-310.5 687,-304.5 693,-298.5 699,-298.5"/>
<text text-anchor="middle" x="769" y="-444.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Progress</text>
<polyline fill="none" stroke="#60b5ac" points="687,-436.5 851,-436.5 "/>
<text text-anchor="start" x="695" y="-421.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub matched: u64</text>
<polyline fill="none" stroke="#60b5ac" points="687,-413.5 851,-413.5 "/>
<text text-anchor="start" x="695" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub next_idx: u64</text>
<polyline fill="none" stroke="#60b5ac" points="687,-390.5 851,-390.5 "/>
<text text-anchor="start" x="695" y="-375.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub state: ProgressState</text>
<polyline fill="none" stroke="#60b5ac" points="687,-367.5 851,-367.5 "/>
<text text-anchor="start" x="695" y="-352.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub committed_index: u64</text>
<polyline fill="none" stroke="#60b5ac" points="687,-344.5 851,-344.5 "/>
<text text-anchor="start" x="695" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub ins: Inflights</text>
<polyline fill="none" stroke="#60b5ac" points="687,-321.5 851,-321.5 "/>
<text text-anchor="start" x="695" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub recent_active: bool, ...</text>
</g>
<!-- ProgressMap&#45;&gt;Progress -->
<g id="edge4" class="edge">
<title>ProgressMap&#45;&gt;Progress</title>
<path fill="none" stroke="#666666" d="M608.69,-726.98C613.73,-724.02 618.53,-720.71 623,-717 697.92,-654.9 735.03,-546.94 752.79,-469.74"/>
<polygon fill="#666666" stroke="#666666" points="756.31,-470.06 755.07,-459.53 749.47,-468.53 756.31,-470.06"/>
</g>
<!-- Progress&#45;&gt;ProgressState -->
<g id="edge5" class="edge">
<title>Progress&#45;&gt;ProgressState</title>
<path fill="none" stroke="#666666" d="M851,-379C901.8,-379 965.9,-379 1010.65,-379"/>
<polygon fill="#666666" stroke="#666666" points="1010.74,-382.5 1020.74,-379 1010.74,-375.5 1010.74,-382.5"/>
</g>
<!-- send_append -->
<g id="node14" class="node">
<title>send_append</title>
<path fill="none" stroke="#1c2123" d="M927,-200C927,-200 1205,-200 1205,-200 1211,-200 1217,-206 1217,-212 1217,-212 1217,-272 1217,-272 1217,-278 1211,-284 1205,-284 1205,-284 927,-284 927,-284 921,-284 915,-278 915,-272 915,-272 915,-212 915,-212 915,-206 921,-200 927,-200"/>
<text text-anchor="middle" x="1066" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_append</text>
<polyline fill="none" stroke="#1c2123" points="915,-261 1217,-261 "/>
<text text-anchor="start" x="923" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">if pr.mached &lt; self.r.raft_log.last_index() </text>
<text text-anchor="start" x="923" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pr.pending_request_snapshot != INVALID_INDEX</text>
<polyline fill="none" stroke="#1c2123" points="915,-223 1217,-223 "/>
<text text-anchor="start" x="923" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">向该follower发送要补齐的消息消息</text>
</g>
<!-- Progress&#45;&gt;send_append -->
<g id="edge22" class="edge">
<title>Progress:matched&#45;&gt;send_append</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M852,-425C905.28,-425 876.24,-359.57 915,-323 928.35,-310.4 944.03,-299.16 960.14,-289.35"/>
<polygon fill="green" stroke="green" points="962.29,-292.14 969.12,-284.04 958.73,-286.12 962.29,-292.14"/>
</g>
<!-- step_leader -->
<g id="node7" class="node">
<title>step_leader</title>
<path fill="none" stroke="#1c2123" d="M66,-386C66,-386 12,-386 12,-386 6,-386 0,-380 0,-374 0,-374 0,-362 0,-362 0,-356 6,-350 12,-350 12,-350 66,-350 66,-350 72,-350 78,-356 78,-362 78,-362 78,-374 78,-374 78,-380 72,-386 66,-386"/>
<text text-anchor="middle" x="39" y="-364.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">step_leader</text>
</g>
<!-- handle_heartbeat_response -->
<g id="node8" class="node">
<title>handle_heartbeat_response</title>
<path fill="none" stroke="#1c2123" d="M270.5,-386C270.5,-386 131.5,-386 131.5,-386 125.5,-386 119.5,-380 119.5,-374 119.5,-374 119.5,-362 119.5,-362 119.5,-356 125.5,-350 131.5,-350 131.5,-350 270.5,-350 270.5,-350 276.5,-350 282.5,-356 282.5,-362 282.5,-362 282.5,-374 282.5,-374 282.5,-380 276.5,-386 270.5,-386"/>
<text text-anchor="middle" x="201" y="-364.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_heartbeat_response</text>
</g>
<!-- step_leader&#45;&gt;handle_heartbeat_response -->
<g id="edge6" class="edge">
<title>step_leader&#45;&gt;handle_heartbeat_response</title>
<path fill="none" stroke="#666666" d="M78.32,-368C87.81,-368 98.38,-368 109.22,-368"/>
<polygon fill="#666666" stroke="#666666" points="109.22,-371.5 119.22,-368 109.22,-364.5 109.22,-371.5"/>
</g>
<!-- handle_heartbeat_response&#45;&gt;Progress -->
<g id="edge7" class="edge">
<title>handle_heartbeat_response&#45;&gt;Progress</title>
<path fill="none" stroke="#666666" d="M217.94,-386.33C239.34,-409.39 279.82,-447.83 324,-463 449.68,-506.16 494.66,-497.49 623,-463 641.66,-457.98 660.4,-449.92 677.92,-440.72"/>
<polygon fill="#666666" stroke="#666666" points="679.84,-443.66 686.96,-435.82 676.51,-437.51 679.84,-443.66"/>
</g>
<!-- get_mut -->
<g id="node9" class="node">
<title>get_mut</title>
<path fill="none" stroke="#1c2123" d="M410,-384.5C410,-384.5 537,-384.5 537,-384.5 543,-384.5 549,-390.5 549,-396.5 549,-396.5 549,-441.5 549,-441.5 549,-447.5 543,-453.5 537,-453.5 537,-453.5 410,-453.5 410,-453.5 404,-453.5 398,-447.5 398,-441.5 398,-441.5 398,-396.5 398,-396.5 398,-390.5 404,-384.5 410,-384.5"/>
<text text-anchor="middle" x="473.5" y="-438.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_mut</text>
<polyline fill="none" stroke="#1c2123" points="398,-430.5 549,-430.5 "/>
<text text-anchor="start" x="406" y="-415.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_mut(m.from)</text>
<polyline fill="none" stroke="#1c2123" points="398,-407.5 549,-407.5 "/>
<text text-anchor="start" x="406" y="-392.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取follower的progress</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;get_mut -->
<g id="edge8" class="edge">
<title>handle_heartbeat_response&#45;&gt;get_mut</title>
<path fill="none" stroke="#666666" d="M282.79,-383.23C315.81,-389.46 354.02,-396.66 387.45,-402.97"/>
<polygon fill="#666666" stroke="#666666" points="387.19,-406.48 397.67,-404.89 388.49,-399.6 387.19,-406.48"/>
</g>
<!-- update_committed -->
<g id="node10" class="node">
<title>update_committed</title>
<path fill="none" stroke="#1c2123" d="M384,-266.5C384,-266.5 563,-266.5 563,-266.5 569,-266.5 575,-272.5 575,-278.5 575,-278.5 575,-353.5 575,-353.5 575,-359.5 569,-365.5 563,-365.5 563,-365.5 384,-365.5 384,-365.5 378,-365.5 372,-359.5 372,-353.5 372,-353.5 372,-278.5 372,-278.5 372,-272.5 378,-266.5 384,-266.5"/>
<text text-anchor="middle" x="473.5" y="-350.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_committed</text>
<polyline fill="none" stroke="#1c2123" points="372,-342.5 575,-342.5 "/>
<text text-anchor="start" x="380" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pr.update_committed(m.commit);</text>
<polyline fill="none" stroke="#1c2123" points="372,-319.5 575,-319.5 "/>
<text text-anchor="start" x="380" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新pr的commited index</text>
<text text-anchor="start" x="380" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在后面计算major commit</text>
<text text-anchor="start" x="380" y="-274.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> index时候会用到</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;update_committed -->
<g id="edge9" class="edge">
<title>handle_heartbeat_response&#45;&gt;update_committed</title>
<path fill="none" stroke="#666666" d="M282.79,-352.47C307.64,-347.69 335.43,-342.35 361.92,-337.26"/>
<polygon fill="#666666" stroke="#666666" points="362.84,-340.65 372,-335.32 361.51,-333.77 362.84,-340.65"/>
</g>
<!-- recent_active -->
<g id="node11" class="node">
<title>recent_active</title>
<path fill="none" stroke="#1c2123" d="M414,-201C414,-201 533,-201 533,-201 539,-201 545,-207 545,-213 545,-213 545,-235 545,-235 545,-241 539,-247 533,-247 533,-247 414,-247 414,-247 408,-247 402,-241 402,-235 402,-235 402,-213 402,-213 402,-207 408,-201 414,-201"/>
<text text-anchor="middle" x="473.5" y="-231.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">recent_active</text>
<polyline fill="none" stroke="#1c2123" points="402,-224 545,-224 "/>
<text text-anchor="middle" x="473.5" y="-208.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pr.recent_active = true;</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;recent_active -->
<g id="edge10" class="edge">
<title>handle_heartbeat_response&#45;&gt;recent_active</title>
<path fill="none" stroke="#666666" d="M216.47,-349.9C237.45,-324.96 278.75,-280.47 324,-257 344.83,-246.2 369.09,-238.92 391.89,-234.02"/>
<polygon fill="#666666" stroke="#666666" points="392.79,-237.41 401.9,-231.99 391.4,-230.54 392.79,-237.41"/>
</g>
<!-- resume -->
<g id="node12" class="node">
<title>resume</title>
<path fill="none" stroke="#1c2123" d="M489.5,-144C489.5,-144 457.5,-144 457.5,-144 451.5,-144 445.5,-138 445.5,-132 445.5,-132 445.5,-120 445.5,-120 445.5,-114 451.5,-108 457.5,-108 457.5,-108 489.5,-108 489.5,-108 495.5,-108 501.5,-114 501.5,-120 501.5,-120 501.5,-132 501.5,-132 501.5,-138 495.5,-144 489.5,-144"/>
<text text-anchor="middle" x="473.5" y="-122.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resume</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;resume -->
<g id="edge11" class="edge">
<title>handle_heartbeat_response&#45;&gt;resume</title>
<path fill="none" stroke="#666666" d="M206.98,-349.98C219.33,-308.87 255.44,-207.82 324,-158 356.49,-134.39 402.87,-127.55 435.13,-125.88"/>
<polygon fill="#666666" stroke="#666666" points="435.62,-129.36 445.48,-125.49 435.36,-122.37 435.62,-129.36"/>
</g>
<!-- free_first_one -->
<g id="node13" class="node">
<title>free_first_one</title>
<path fill="none" stroke="#1c2123" d="M507.5,-90C507.5,-90 439.5,-90 439.5,-90 433.5,-90 427.5,-84 427.5,-78 427.5,-78 427.5,-66 427.5,-66 427.5,-60 433.5,-54 439.5,-54 439.5,-54 507.5,-54 507.5,-54 513.5,-54 519.5,-60 519.5,-66 519.5,-66 519.5,-78 519.5,-78 519.5,-84 513.5,-90 507.5,-90"/>
<text text-anchor="middle" x="473.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">free_first_one</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;free_first_one -->
<g id="edge12" class="edge">
<title>handle_heartbeat_response&#45;&gt;free_first_one</title>
<path fill="none" stroke="#666666" d="M204.44,-349.74C212.06,-300.53 240.1,-164.44 324,-99 350.27,-78.51 387.07,-71.71 417.46,-70.06"/>
<polygon fill="#666666" stroke="#666666" points="417.64,-73.56 427.5,-69.69 417.38,-66.56 417.64,-73.56"/>
</g>
<!-- handle_heartbeat_response&#45;&gt;send_append -->
<g id="edge13" class="edge">
<title>handle_heartbeat_response&#45;&gt;send_append</title>
<path fill="none" stroke="#666666" d="M207.98,-349.87C221.56,-312.01 258.74,-225.28 324,-191 421.36,-139.86 717.95,-179.51 905.05,-211.67"/>
<polygon fill="#666666" stroke="#666666" points="904.54,-215.13 914.99,-213.39 905.73,-208.23 904.54,-215.13"/>
</g>
<!-- pending_request_snapshot -->
<g id="node15" class="node">
<title>pending_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M541.5,-36C541.5,-36 405.5,-36 405.5,-36 399.5,-36 393.5,-30 393.5,-24 393.5,-24 393.5,-12 393.5,-12 393.5,-6 399.5,0 405.5,0 405.5,0 541.5,0 541.5,0 547.5,0 553.5,-6 553.5,-12 553.5,-12 553.5,-24 553.5,-24 553.5,-30 547.5,-36 541.5,-36"/>
<text text-anchor="middle" x="473.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_request_snapshot</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;pending_request_snapshot -->
<g id="edge14" class="edge">
<title>handle_heartbeat_response&#45;&gt;pending_request_snapshot</title>
<path fill="none" stroke="#666666" d="M202.92,-349.86C206.78,-294.48 226.38,-126.36 324,-45 340.6,-31.17 361.9,-23.45 383.17,-19.33"/>
<polygon fill="#666666" stroke="#666666" points="383.97,-22.75 393.25,-17.64 382.81,-15.84 383.97,-22.75"/>
</g>
<!-- recv_ack -->
<g id="node16" class="node">
<title>recv_ack</title>
<path fill="none" stroke="#1c2123" d="M494,-708C494,-708 453,-708 453,-708 447,-708 441,-702 441,-696 441,-696 441,-684 441,-684 441,-678 447,-672 453,-672 453,-672 494,-672 494,-672 500,-672 506,-678 506,-684 506,-684 506,-696 506,-696 506,-702 500,-708 494,-708"/>
<text text-anchor="middle" x="473.5" y="-686.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">recv_ack</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;recv_ack -->
<g id="edge15" class="edge">
<title>handle_heartbeat_response&#45;&gt;recv_ack</title>
<path fill="none" stroke="#666666" d="M203.63,-386.07C209.36,-438.21 233.45,-589.88 324,-663 353.89,-687.14 398.26,-692.48 430.72,-692.64"/>
<polygon fill="#666666" stroke="#666666" points="430.84,-696.14 440.8,-692.53 430.76,-689.14 430.84,-696.14"/>
</g>
<!-- has_quorum -->
<g id="node17" class="node">
<title>has_quorum</title>
<path fill="none" stroke="#1c2123" d="M503.5,-654C503.5,-654 443.5,-654 443.5,-654 437.5,-654 431.5,-648 431.5,-642 431.5,-642 431.5,-630 431.5,-630 431.5,-624 437.5,-618 443.5,-618 443.5,-618 503.5,-618 503.5,-618 509.5,-618 515.5,-624 515.5,-630 515.5,-630 515.5,-642 515.5,-642 515.5,-648 509.5,-654 503.5,-654"/>
<text text-anchor="middle" x="473.5" y="-632.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_quorum</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;has_quorum -->
<g id="edge16" class="edge">
<title>handle_heartbeat_response&#45;&gt;has_quorum</title>
<path fill="none" stroke="#666666" d="M205.42,-386.04C215.07,-431.55 246.95,-551.51 324,-609 351.74,-629.7 390.38,-636.22 421.29,-637.69"/>
<polygon fill="#666666" stroke="#666666" points="421.35,-641.2 431.45,-638.01 421.57,-634.2 421.35,-641.2"/>
</g>
<!-- advance -->
<g id="node18" class="node">
<title>advance</title>
<path fill="none" stroke="#1c2123" d="M492,-600C492,-600 455,-600 455,-600 449,-600 443,-594 443,-588 443,-588 443,-576 443,-576 443,-570 449,-564 455,-564 455,-564 492,-564 492,-564 498,-564 504,-570 504,-576 504,-576 504,-588 504,-588 504,-594 498,-600 492,-600"/>
<text text-anchor="middle" x="473.5" y="-578.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">advance</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;advance -->
<g id="edge17" class="edge">
<title>handle_heartbeat_response&#45;&gt;advance</title>
<path fill="none" stroke="#666666" d="M208.21,-386.2C222.24,-424.34 260.23,-512.64 324,-555 356.26,-576.43 400.77,-582.11 432.63,-583.09"/>
<polygon fill="#666666" stroke="#666666" points="432.85,-586.59 442.91,-583.26 432.97,-579.6 432.85,-586.59"/>
</g>
<!-- handle_ready_read_index -->
<g id="node19" class="node">
<title>handle_ready_read_index</title>
<path fill="none" stroke="#1c2123" d="M539.5,-546C539.5,-546 407.5,-546 407.5,-546 401.5,-546 395.5,-540 395.5,-534 395.5,-534 395.5,-522 395.5,-522 395.5,-516 401.5,-510 407.5,-510 407.5,-510 539.5,-510 539.5,-510 545.5,-510 551.5,-516 551.5,-522 551.5,-522 551.5,-534 551.5,-534 551.5,-540 545.5,-546 539.5,-546"/>
<text text-anchor="middle" x="473.5" y="-524.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_ready_read_index</text>
</g>
<!-- handle_heartbeat_response&#45;&gt;handle_ready_read_index -->
<g id="edge18" class="edge">
<title>handle_heartbeat_response&#45;&gt;handle_ready_read_index</title>
<path fill="none" stroke="#666666" d="M213.83,-386.13C233.26,-414.34 274.72,-468.38 324,-496 342.67,-506.46 364.42,-513.51 385.43,-518.25"/>
<polygon fill="#666666" stroke="#666666" points="384.84,-521.7 395.34,-520.34 386.28,-514.85 384.84,-521.7"/>
</g>
<!-- get_mut&#45;&gt;Progress -->
<g id="edge19" class="edge">
<title>get_mut&#45;&gt;Progress</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M549.32,-408.8C588.15,-403.51 635.92,-397 676.88,-391.42"/>
<polygon fill="green" stroke="green" points="677.44,-394.88 686.87,-390.06 676.49,-387.94 677.44,-394.88"/>
</g>
<!-- update_committed&#45;&gt;Progress -->
<g id="edge20" class="edge">
<title>update_committed&#45;&gt;Progress:committed_index</title>
<path fill="none" stroke="#666666" d="M575.16,-342.96C606.74,-349.49 642.11,-354.89 675.65,-355.85"/>
<polygon fill="#666666" stroke="#666666" points="675.95,-359.35 686,-356 676.05,-352.36 675.95,-359.35"/>
</g>
<!-- recent_active&#45;&gt;Progress -->
<g id="edge21" class="edge">
<title>recent_active&#45;&gt;Progress:recent_active</title>
<path fill="none" stroke="#666666" d="M545.22,-232.57C570.65,-237.48 598.97,-245.12 623,-257 652.34,-271.5 650.32,-302.47 675.76,-308.84"/>
<polygon fill="#666666" stroke="#666666" points="675.67,-312.35 686,-310 676.46,-305.4 675.67,-312.35"/>
</g>
<!-- maybe_send_append -->
<g id="node20" class="node">
<title>maybe_send_append</title>
<path fill="none" stroke="#1c2123" d="M1372,-260C1372,-260 1265,-260 1265,-260 1259,-260 1253,-254 1253,-248 1253,-248 1253,-236 1253,-236 1253,-230 1259,-224 1265,-224 1265,-224 1372,-224 1372,-224 1378,-224 1384,-230 1384,-236 1384,-236 1384,-248 1384,-248 1384,-254 1378,-260 1372,-260"/>
<text text-anchor="middle" x="1318.5" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">maybe_send_append</text>
</g>
<!-- send_append&#45;&gt;maybe_send_append -->
<g id="edge23" class="edge">
<title>send_append&#45;&gt;maybe_send_append</title>
<path fill="none" stroke="#666666" d="M1217.06,-242C1225.77,-242 1234.33,-242 1242.53,-242"/>
<polygon fill="#666666" stroke="#666666" points="1242.73,-245.5 1252.73,-242 1242.73,-238.5 1242.73,-245.5"/>
</g>
<!-- prepare_send_entries -->
<g id="node21" class="node">
<title>prepare_send_entries</title>
<path fill="none" stroke="#1c2123" d="M1432,-310.5C1432,-310.5 1772,-310.5 1772,-310.5 1778,-310.5 1784,-316.5 1784,-322.5 1784,-322.5 1784,-367.5 1784,-367.5 1784,-373.5 1778,-379.5 1772,-379.5 1772,-379.5 1432,-379.5 1432,-379.5 1426,-379.5 1420,-373.5 1420,-367.5 1420,-367.5 1420,-322.5 1420,-322.5 1420,-316.5 1426,-310.5 1432,-310.5"/>
<text text-anchor="middle" x="1602" y="-364.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prepare_send_entries</text>
<polyline fill="none" stroke="#1c2123" points="1420,-356.5 1784,-356.5 "/>
<text text-anchor="middle" x="1602" y="-341.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备向follower发送一批entries, 从pr.next_idx开始</text>
<polyline fill="none" stroke="#1c2123" points="1420,-333.5 1784,-333.5 "/>
<text text-anchor="middle" x="1602" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">let ents = self.raft_log.entries(pr.next_idx, self.max_msg_size);</text>
</g>
<!-- maybe_send_append&#45;&gt;prepare_send_entries -->
<g id="edge24" class="edge">
<title>maybe_send_append&#45;&gt;prepare_send_entries</title>
<path fill="none" stroke="#666666" d="M1345.7,-260.27C1365.36,-273.25 1393.37,-290.22 1420,-301 1425.15,-303.09 1430.43,-305.09 1435.79,-307.01"/>
<polygon fill="#666666" stroke="#666666" points="1434.92,-310.42 1445.52,-310.39 1437.22,-303.81 1434.92,-310.42"/>
</g>
<!-- prepare_send_snapshot -->
<g id="node22" class="node">
<title>prepare_send_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1482.5,-192.5C1482.5,-192.5 1721.5,-192.5 1721.5,-192.5 1727.5,-192.5 1733.5,-198.5 1733.5,-204.5 1733.5,-204.5 1733.5,-279.5 1733.5,-279.5 1733.5,-285.5 1727.5,-291.5 1721.5,-291.5 1721.5,-291.5 1482.5,-291.5 1482.5,-291.5 1476.5,-291.5 1470.5,-285.5 1470.5,-279.5 1470.5,-279.5 1470.5,-204.5 1470.5,-204.5 1470.5,-198.5 1476.5,-192.5 1482.5,-192.5"/>
<text text-anchor="middle" x="1602" y="-276.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prepare_send_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="1470.5,-268.5 1733.5,-268.5 "/>
<text text-anchor="start" x="1478.5" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">let term = self.raft_log.term(pr.next_idx &#45; 1);</text>
<polyline fill="none" stroke="#1c2123" points="1470.5,-245.5 1733.5,-245.5 "/>
<text text-anchor="start" x="1478.5" y="-230.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果term为None说明</text>
<text text-anchor="start" x="1478.5" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower的next_idx是无效的</text>
<text text-anchor="start" x="1478.5" y="-200.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送snapshot</text>
</g>
<!-- maybe_send_append&#45;&gt;prepare_send_snapshot -->
<g id="edge25" class="edge">
<title>maybe_send_append&#45;&gt;prepare_send_snapshot</title>
<path fill="none" stroke="#666666" d="M1384.08,-242C1406.9,-242 1433.53,-242 1460.17,-242"/>
<polygon fill="#666666" stroke="#666666" points="1460.37,-245.5 1470.37,-242 1460.37,-238.5 1460.37,-245.5"/>
</g>
<!-- try_batching -->
<g id="node23" class="node">
<title>try_batching</title>
<path fill="none" stroke="#1c2123" d="M1632.5,-174C1632.5,-174 1571.5,-174 1571.5,-174 1565.5,-174 1559.5,-168 1559.5,-162 1559.5,-162 1559.5,-150 1559.5,-150 1559.5,-144 1565.5,-138 1571.5,-138 1571.5,-138 1632.5,-138 1632.5,-138 1638.5,-138 1644.5,-144 1644.5,-150 1644.5,-150 1644.5,-162 1644.5,-162 1644.5,-168 1638.5,-174 1632.5,-174"/>
<text text-anchor="middle" x="1602" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">try_batching</text>
</g>
<!-- maybe_send_append&#45;&gt;try_batching -->
<g id="edge26" class="edge">
<title>maybe_send_append&#45;&gt;try_batching</title>
<path fill="none" stroke="#666666" d="M1344.2,-223.85C1363.77,-210.4 1392.34,-192.77 1420,-183 1462.03,-168.16 1512.36,-161.47 1549.27,-158.46"/>
<polygon fill="#666666" stroke="#666666" points="1549.59,-161.95 1559.3,-157.71 1549.07,-154.97 1549.59,-161.95"/>
</g>
</g>
</svg>
