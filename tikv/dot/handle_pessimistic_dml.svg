<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handle_pessimistic_dml Pages: 1 -->
<svg width="1601pt" height="622pt"
 viewBox="0.00 0.00 1601.00 622.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 618)">
<title>handle_pessimistic_dml</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-618 1597,-618 1597,4 -4,4"/>
<g id="clust3" class="cluster">
<title>cluster_ForLoop</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M696,-8C696,-8 1573,-8 1573,-8 1579,-8 1585,-14 1585,-20 1585,-20 1585,-594 1585,-594 1585,-600 1579,-606 1573,-606 1573,-606 696,-606 696,-606 690,-606 684,-600 684,-594 684,-594 684,-20 684,-20 684,-14 690,-8 696,-8"/>
<text text-anchor="middle" x="1134.5" y="-586" font-family="Times,serif" font-size="20.00">ForLoop</text>
</g>
<!-- ExecStmt_Exec -->
<g id="node1" class="node">
<title>ExecStmt_Exec</title>
<path fill="none" stroke="#1c2123" d="M12,-251.5C12,-251.5 222,-251.5 222,-251.5 228,-251.5 234,-257.5 234,-263.5 234,-263.5 234,-406.5 234,-406.5 234,-412.5 228,-418.5 222,-418.5 222,-418.5 12,-418.5 12,-418.5 6,-418.5 0,-412.5 0,-406.5 0,-406.5 0,-263.5 0,-263.5 0,-257.5 6,-251.5 12,-251.5"/>
<text text-anchor="start" x="8" y="-403.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecStmt</text>
<polyline fill="none" stroke="#1c2123" points="0,-395.5 234,-395.5 "/>
<text text-anchor="start" x="8" y="-380.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Exec</text>
<polyline fill="none" stroke="#1c2123" points="0,-372.5 234,-372.5 "/>
<text text-anchor="start" x="8" y="-357.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">build an executor from a plan</text>
<text text-anchor="start" x="8" y="-342.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> if the executor doesn&#39;t return result</text>
<text text-anchor="start" x="8" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> like insert, update statements</text>
<text text-anchor="start" x="8" y="-312.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> it executes in this function</text>
<polyline fill="none" stroke="#1c2123" points="0,-304.5 234,-304.5 "/>
<text text-anchor="start" x="8" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">if Executor returns result, execution</text>
<text text-anchor="start" x="8" y="-274.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is done after this function function</text>
<text text-anchor="start" x="8" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> in the returned sqlexec.RecordSet.Next</text>
</g>
<!-- StmtCtx_TxnCtx_IsPessimistic -->
<g id="node2" class="node">
<title>StmtCtx_TxnCtx_IsPessimistic</title>
<path fill="#feed9b" stroke="#f7e495" d="M331,-365C331,-365 414,-365 414,-365 420,-365 426,-371 426,-377 426,-377 426,-391 426,-391 426,-397 420,-403 414,-403 414,-403 331,-403 331,-403 325,-403 319,-397 319,-391 319,-391 319,-377 319,-377 319,-371 325,-365 331,-365"/>
<text text-anchor="start" x="327" y="-387.8" font-family="Times,serif" font-size="14.00" fill="#40575d">StmtCtx.TxnCtx</text>
<text text-anchor="start" x="327" y="-372.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> IsPessimistic</text>
</g>
<!-- ExecStmt_Exec&#45;&gt;StmtCtx_TxnCtx_IsPessimistic -->
<g id="edge2" class="edge">
<title>ExecStmt_Exec&#45;&gt;StmtCtx_TxnCtx_IsPessimistic</title>
<path fill="none" stroke="#666666" d="M234.36,-357.49C259.98,-362.44 286.18,-367.51 308.71,-371.86"/>
<polygon fill="#666666" stroke="#666666" points="308.31,-375.35 318.79,-373.81 309.64,-368.48 308.31,-375.35"/>
</g>
<!-- handlePessimisticSelectForUpdate -->
<g id="node4" class="node">
<title>handlePessimisticSelectForUpdate</title>
<path fill="none" stroke="#1c2123" d="M282,-207.5C282,-207.5 463,-207.5 463,-207.5 469,-207.5 475,-213.5 475,-219.5 475,-219.5 475,-256.5 475,-256.5 475,-262.5 469,-268.5 463,-268.5 463,-268.5 282,-268.5 282,-268.5 276,-268.5 270,-262.5 270,-256.5 270,-256.5 270,-219.5 270,-219.5 270,-213.5 276,-207.5 282,-207.5"/>
<text text-anchor="middle" x="372.5" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handlePessimisticSelectForUpdate</text>
<polyline fill="none" stroke="#1c2123" points="270,-245.5 475,-245.5 "/>
<text text-anchor="start" x="278" y="-230.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理select for update statement</text>
<text text-anchor="start" x="278" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> in pessimistic transaction</text>
</g>
<!-- ExecStmt_Exec&#45;&gt;handlePessimisticSelectForUpdate -->
<g id="edge3" class="edge">
<title>ExecStmt_Exec&#45;&gt;handlePessimisticSelectForUpdate</title>
<path fill="none" stroke="#666666" d="M234.36,-290.47C250.42,-284.33 266.71,-278.1 282.17,-272.18"/>
<polygon fill="#666666" stroke="#666666" points="283.6,-275.38 291.69,-268.54 281.1,-268.84 283.6,-275.38"/>
</g>
<!-- ExecStmt_handleNoDelay -->
<g id="node5" class="node">
<title>ExecStmt_handleNoDelay</title>
<path fill="none" stroke="#1c2123" d="M334,-300C334,-300 411,-300 411,-300 417,-300 423,-306 423,-312 423,-312 423,-334 423,-334 423,-340 417,-346 411,-346 411,-346 334,-346 334,-346 328,-346 322,-340 322,-334 322,-334 322,-312 322,-312 322,-306 328,-300 334,-300"/>
<text text-anchor="start" x="330" y="-330.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecStmt</text>
<polyline fill="none" stroke="#1c2123" points="322,-323 423,-323 "/>
<text text-anchor="start" x="330" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleNoDelay</text>
</g>
<!-- ExecStmt_Exec&#45;&gt;ExecStmt_handleNoDelay -->
<g id="edge5" class="edge">
<title>ExecStmt_Exec&#45;&gt;ExecStmt_handleNoDelay</title>
<path fill="none" stroke="#666666" d="M234.36,-329.49C261.12,-328.23 288.5,-326.93 311.69,-325.83"/>
<polygon fill="#666666" stroke="#666666" points="311.87,-329.33 321.69,-325.36 311.54,-322.33 311.87,-329.33"/>
</g>
<!-- ExecStmt_handlePessimisticDML -->
<g id="node6" class="node">
<title>ExecStmt_handlePessimisticDML</title>
<path fill="none" stroke="#1c2123" d="M523,-330C523,-330 644,-330 644,-330 650,-330 656,-336 656,-342 656,-342 656,-364 656,-364 656,-370 650,-376 644,-376 644,-376 523,-376 523,-376 517,-376 511,-370 511,-364 511,-364 511,-342 511,-342 511,-336 517,-330 523,-330"/>
<text text-anchor="start" x="519" y="-360.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecStmt</text>
<polyline fill="none" stroke="#1c2123" points="511,-353 656,-353 "/>
<text text-anchor="middle" x="583.5" y="-337.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handlePessimisticDML</text>
</g>
<!-- StmtCtx_TxnCtx_IsPessimistic&#45;&gt;ExecStmt_handlePessimisticDML -->
<g id="edge4" class="edge">
<title>StmtCtx_TxnCtx_IsPessimistic&#45;&gt;ExecStmt_handlePessimisticDML</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M426.24,-376.18C448.77,-372.84 475.6,-368.86 500.61,-365.15"/>
<polygon fill="green" stroke="green" points="501.45,-368.56 510.83,-363.63 500.42,-361.64 501.45,-368.56"/>
</g>
<!-- isSelectForUpdate -->
<g id="node3" class="node">
<title>isSelectForUpdate</title>
<path fill="#feed9b" stroke="#f7e495" d="M71,-196C71,-196 163,-196 163,-196 169,-196 175,-202 175,-208 175,-208 175,-220 175,-220 175,-226 169,-232 163,-232 163,-232 71,-232 71,-232 65,-232 59,-226 59,-220 59,-220 59,-208 59,-208 59,-202 65,-196 71,-196"/>
<text text-anchor="middle" x="117" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#40575d">isSelectForUpdate</text>
</g>
<!-- isSelectForUpdate&#45;&gt;handlePessimisticSelectForUpdate -->
<g id="edge1" class="edge">
<title>isSelectForUpdate&#45;&gt;handlePessimisticSelectForUpdate</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M175.21,-219.42C200.22,-221.78 230.47,-224.65 259.65,-227.41"/>
<polygon fill="green" stroke="green" points="259.63,-230.92 269.92,-228.38 260.29,-223.96 259.63,-230.92"/>
</g>
<!-- ExecStmt_handleNoDelay&#45;&gt;ExecStmt_handlePessimisticDML -->
<g id="edge6" class="edge">
<title>ExecStmt_handleNoDelay&#45;&gt;ExecStmt_handlePessimisticDML</title>
<path fill="none" stroke="#666666" d="M423.03,-330.11C446.26,-333.44 474.55,-337.5 500.82,-341.28"/>
<polygon fill="#666666" stroke="#666666" points="500.38,-344.75 510.77,-342.7 501.37,-337.82 500.38,-344.75"/>
</g>
<!-- handleNoDelayExecutor -->
<g id="node7" class="node">
<title>handleNoDelayExecutor</title>
<path fill="none" stroke="#1c2123" d="M855,-475C855,-475 729,-475 729,-475 723,-475 717,-469 717,-463 717,-463 717,-451 717,-451 717,-445 723,-439 729,-439 729,-439 855,-439 855,-439 861,-439 867,-445 867,-451 867,-451 867,-463 867,-463 867,-469 861,-475 855,-475"/>
<text text-anchor="middle" x="792" y="-453.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleNoDelayExecutor</text>
</g>
<!-- ExecStmt_handlePessimisticDML&#45;&gt;handleNoDelayExecutor -->
<g id="edge7" class="edge">
<title>ExecStmt_handlePessimisticDML&#45;&gt;handleNoDelayExecutor</title>
<path fill="none" stroke="#666666" d="M630.33,-376.08C664.76,-393.42 711.68,-417.05 745.92,-434.3"/>
<polygon fill="#666666" stroke="#666666" points="744.72,-437.61 755.23,-438.98 747.87,-431.36 744.72,-437.61"/>
</g>
<!-- handlePessimisticLockError -->
<g id="node8" class="node">
<title>handlePessimisticLockError</title>
<path fill="none" stroke="#1c2123" d="M704,-219.5C704,-219.5 880,-219.5 880,-219.5 886,-219.5 892,-225.5 892,-231.5 892,-231.5 892,-268.5 892,-268.5 892,-274.5 886,-280.5 880,-280.5 880,-280.5 704,-280.5 704,-280.5 698,-280.5 692,-274.5 692,-268.5 692,-268.5 692,-231.5 692,-231.5 692,-225.5 698,-219.5 704,-219.5"/>
<text text-anchor="middle" x="792" y="-265.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handlePessimisticLockError</text>
<polyline fill="none" stroke="#1c2123" points="692,-257.5 892,-257.5 "/>
<text text-anchor="start" x="700" y="-242.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">update Ts and rebuild Executor if</text>
<text text-anchor="start" x="700" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> the err is write conflict</text>
</g>
<!-- ExecStmt_handlePessimisticDML&#45;&gt;handlePessimisticLockError -->
<g id="edge8" class="edge">
<title>ExecStmt_handlePessimisticDML&#45;&gt;handlePessimisticLockError</title>
<path fill="none" stroke="#666666" d="M630.84,-329.88C657.24,-316.72 690.87,-299.95 720.48,-285.17"/>
<polygon fill="#666666" stroke="#666666" points="722.15,-288.26 729.53,-280.66 719.02,-281.99 722.15,-288.26"/>
</g>
<!-- Executor_Next -->
<g id="node9" class="node">
<title>Executor_Next</title>
<path fill="none" stroke="#1c2123" d="M1233,-515C1233,-515 1335,-515 1335,-515 1341,-515 1347,-521 1347,-527 1347,-527 1347,-541 1347,-541 1347,-547 1341,-553 1335,-553 1335,-553 1233,-553 1233,-553 1227,-553 1221,-547 1221,-541 1221,-541 1221,-527 1221,-527 1221,-521 1227,-515 1233,-515"/>
<text text-anchor="start" x="1229" y="-537.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">执行executor</text>
<text text-anchor="start" x="1229" y="-522.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用executor::next</text>
</g>
<!-- handleNoDelayExecutor&#45;&gt;Executor_Next -->
<g id="edge9" class="edge">
<title>handleNoDelayExecutor&#45;&gt;Executor_Next</title>
<path fill="none" stroke="#666666" d="M809.63,-475.07C833.21,-499.21 878.97,-540.82 928,-557 1022.11,-588.06 1137.7,-571.15 1210.89,-554.2"/>
<polygon fill="#666666" stroke="#666666" points="1212,-557.53 1220.92,-551.81 1210.38,-550.72 1212,-557.53"/>
</g>
<!-- buildExecutor -->
<g id="node10" class="node">
<title>buildExecutor</title>
<path fill="none" stroke="#1c2123" d="M1005,-501C1005,-501 1075,-501 1075,-501 1081,-501 1087,-507 1087,-513 1087,-513 1087,-535 1087,-535 1087,-541 1081,-547 1075,-547 1075,-547 1005,-547 1005,-547 999,-547 993,-541 993,-535 993,-535 993,-513 993,-513 993,-507 999,-501 1005,-501"/>
<text text-anchor="middle" x="1040" y="-531.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">buildExecutor</text>
<polyline fill="none" stroke="#1c2123" points="993,-524 1087,-524 "/>
<text text-anchor="start" x="1001" y="-508.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">重建Executor</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;buildExecutor -->
<g id="edge12" class="edge">
<title>handlePessimisticLockError&#45;&gt;buildExecutor</title>
<path fill="none" stroke="#666666" d="M809.94,-280.94C845.14,-345.15 923.37,-487.29 928,-491 943.71,-503.56 964.1,-511.35 983.1,-516.17"/>
<polygon fill="#666666" stroke="#666666" points="982.35,-519.59 992.89,-518.43 983.93,-512.77 982.35,-519.59"/>
</g>
<!-- ErrDeadlock -->
<g id="node12" class="node">
<title>ErrDeadlock</title>
<path fill="none" stroke="#1c2123" d="M1071,-52C1071,-52 1009,-52 1009,-52 1003,-52 997,-46 997,-40 997,-40 997,-28 997,-28 997,-22 1003,-16 1009,-16 1009,-16 1071,-16 1071,-16 1077,-16 1083,-22 1083,-28 1083,-28 1083,-40 1083,-40 1083,-46 1077,-52 1071,-52"/>
<text text-anchor="middle" x="1040" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrDeadlock</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;ErrDeadlock -->
<g id="edge13" class="edge">
<title>handlePessimisticLockError&#45;&gt;ErrDeadlock</title>
<path fill="none" stroke="#666666" d="M807.38,-219.36C828.21,-178.32 870.65,-106.02 928,-66 945.38,-53.87 967.32,-46.31 987.09,-41.6"/>
<polygon fill="#666666" stroke="#666666" points="987.88,-45.01 996.9,-39.45 986.38,-38.17 987.88,-45.01"/>
</g>
<!-- ErrWriteConflict -->
<g id="node13" class="node">
<title>ErrWriteConflict</title>
<path fill="none" stroke="#1c2123" d="M1082,-126C1082,-126 998,-126 998,-126 992,-126 986,-120 986,-114 986,-114 986,-102 986,-102 986,-96 992,-90 998,-90 998,-90 1082,-90 1082,-90 1088,-90 1094,-96 1094,-102 1094,-102 1094,-114 1094,-114 1094,-120 1088,-126 1082,-126"/>
<text text-anchor="middle" x="1040" y="-104.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrWriteConflict</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;ErrWriteConflict -->
<g id="edge14" class="edge">
<title>handlePessimisticLockError&#45;&gt;ErrWriteConflict</title>
<path fill="none" stroke="#666666" d="M823.12,-219.36C848.9,-194.73 888.09,-160.89 928,-140 942.86,-132.22 959.86,-126.11 976.02,-121.41"/>
<polygon fill="#666666" stroke="#666666" points="977.23,-124.7 985.94,-118.66 975.37,-117.95 977.23,-124.7"/>
</g>
<!-- ErrDeadlock_IsRetryable -->
<g id="node14" class="node">
<title>ErrDeadlock_IsRetryable</title>
<path fill="none" stroke="#1c2123" d="M1200,-28.5C1200,-28.5 1368,-28.5 1368,-28.5 1374,-28.5 1380,-34.5 1380,-40.5 1380,-40.5 1380,-77.5 1380,-77.5 1380,-83.5 1374,-89.5 1368,-89.5 1368,-89.5 1200,-89.5 1200,-89.5 1194,-89.5 1188,-83.5 1188,-77.5 1188,-77.5 1188,-40.5 1188,-40.5 1188,-34.5 1194,-28.5 1200,-28.5"/>
<text text-anchor="middle" x="1284" y="-74.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrDeadlock::IsRetryable</text>
<polyline fill="none" stroke="#1c2123" points="1188,-66.5 1380,-66.5 "/>
<text text-anchor="start" x="1196" y="-51.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果错误不可重试的</text>
<text text-anchor="start" x="1196" y="-36.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就返回err,退出上面的forloop</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;ErrDeadlock_IsRetryable -->
<g id="edge15" class="edge">
<title>handlePessimisticLockError&#45;&gt;ErrDeadlock_IsRetryable</title>
<path fill="none" stroke="#666666" d="M807.3,-219.39C827.78,-179.54 869.52,-111.39 928,-81 949.73,-69.71 1080.85,-63.96 1177.44,-61.23"/>
<polygon fill="#666666" stroke="#666666" points="1177.66,-64.72 1187.56,-60.95 1177.46,-57.72 1177.66,-64.72"/>
</g>
<!-- GetForUpdateTS -->
<g id="node15" class="node">
<title>GetForUpdateTS</title>
<path fill="none" stroke="#1c2123" d="M1327,-160C1327,-160 1241,-160 1241,-160 1235,-160 1229,-154 1229,-148 1229,-148 1229,-136 1229,-136 1229,-130 1235,-124 1241,-124 1241,-124 1327,-124 1327,-124 1333,-124 1339,-130 1339,-136 1339,-136 1339,-148 1339,-148 1339,-154 1333,-160 1327,-160"/>
<text text-anchor="middle" x="1284" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetForUpdateTS</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;GetForUpdateTS -->
<g id="edge16" class="edge">
<title>handlePessimisticLockError&#45;&gt;GetForUpdateTS</title>
<path fill="none" stroke="#666666" d="M825.52,-219.28C851.17,-197.19 889.01,-169.09 928,-156 980.03,-138.54 1131.26,-138.59 1218.64,-140.24"/>
<polygon fill="#666666" stroke="#666666" points="1218.64,-143.74 1228.71,-140.44 1218.78,-136.74 1218.64,-143.74"/>
</g>
<!-- GetGlobalConfig_PessimisticTxn_MaxRetryCount -->
<g id="node16" class="node">
<title>GetGlobalConfig_PessimisticTxn_MaxRetryCount</title>
<path fill="none" stroke="#1c2123" d="M972.5,-165C972.5,-165 1107.5,-165 1107.5,-165 1113.5,-165 1119.5,-171 1119.5,-177 1119.5,-177 1119.5,-229 1119.5,-229 1119.5,-235 1113.5,-241 1107.5,-241 1107.5,-241 972.5,-241 972.5,-241 966.5,-241 960.5,-235 960.5,-229 960.5,-229 960.5,-177 960.5,-177 960.5,-171 966.5,-165 972.5,-165"/>
<text text-anchor="start" x="968.5" y="-225.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetGlobalConfig().</text>
<text text-anchor="start" x="968.5" y="-210.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PessimisticTxn</text>
<text text-anchor="start" x="968.5" y="-195.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .MaxRetryCount</text>
<polyline fill="none" stroke="#1c2123" points="960.5,-188 1119.5,-188 "/>
<text text-anchor="start" x="968.5" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查是否超过了最次数</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;GetGlobalConfig_PessimisticTxn_MaxRetryCount -->
<g id="edge17" class="edge">
<title>handlePessimisticLockError&#45;&gt;GetGlobalConfig_PessimisticTxn_MaxRetryCount</title>
<path fill="none" stroke="#666666" d="M892.35,-231.02C911.56,-227.35 931.58,-223.52 950.42,-219.92"/>
<polygon fill="#666666" stroke="#666666" points="951.29,-223.32 960.46,-218.01 949.98,-216.44 951.29,-223.32"/>
</g>
<!-- UpdateForUpdateTS -->
<g id="node17" class="node">
<title>UpdateForUpdateTS</title>
<path fill="none" stroke="#1c2123" d="M940,-260C940,-260 1140,-260 1140,-260 1146,-260 1152,-266 1152,-272 1152,-272 1152,-324 1152,-324 1152,-330 1146,-336 1140,-336 1140,-336 940,-336 940,-336 934,-336 928,-330 928,-324 928,-324 928,-272 928,-272 928,-266 934,-260 940,-260"/>
<text text-anchor="middle" x="1040" y="-320.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">UpdateForUpdateTS</text>
<polyline fill="none" stroke="#1c2123" points="928,-313 1152,-313 "/>
<text text-anchor="start" x="936" y="-297.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">update the ForUpdateTS</text>
<text text-anchor="start" x="936" y="-282.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> if the newForUpdateTS is 0, it obtain</text>
<text text-anchor="start" x="936" y="-267.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> a new TS from PD</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;UpdateForUpdateTS -->
<g id="edge18" class="edge">
<title>handlePessimisticLockError&#45;&gt;UpdateForUpdateTS</title>
<path fill="none" stroke="#666666" d="M892.35,-269.39C900.78,-271.03 909.37,-272.71 917.95,-274.38"/>
<polygon fill="#666666" stroke="#666666" points="917.51,-277.86 928,-276.34 918.85,-270.99 917.51,-277.86"/>
</g>
<!-- StmtRollback -->
<g id="node18" class="node">
<title>StmtRollback</title>
<path fill="none" stroke="#1c2123" d="M953,-355C953,-355 1127,-355 1127,-355 1133,-355 1139,-361 1139,-367 1139,-367 1139,-389 1139,-389 1139,-395 1133,-401 1127,-401 1127,-401 953,-401 953,-401 947,-401 941,-395 941,-389 941,-389 941,-367 941,-367 941,-361 947,-355 953,-355"/>
<text text-anchor="middle" x="1040" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">StmtRollback</text>
<polyline fill="none" stroke="#1c2123" points="941,-378 1139,-378 "/>
<text text-anchor="start" x="949" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">providdes statment level rollback</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;StmtRollback -->
<g id="edge19" class="edge">
<title>handlePessimisticLockError&#45;&gt;StmtRollback</title>
<path fill="none" stroke="#666666" d="M828.98,-280.72C855.02,-301.63 891.86,-328.57 928,-346 931.81,-347.84 935.75,-349.59 939.76,-351.26"/>
<polygon fill="#666666" stroke="#666666" points="938.67,-354.59 949.25,-355 941.23,-348.08 938.67,-354.59"/>
</g>
<!-- StmtCtx_ResetForRetry -->
<g id="node19" class="node">
<title>StmtCtx_ResetForRetry</title>
<path fill="none" stroke="#1c2123" d="M942.5,-420.5C942.5,-420.5 1137.5,-420.5 1137.5,-420.5 1143.5,-420.5 1149.5,-426.5 1149.5,-432.5 1149.5,-432.5 1149.5,-469.5 1149.5,-469.5 1149.5,-475.5 1143.5,-481.5 1137.5,-481.5 1137.5,-481.5 942.5,-481.5 942.5,-481.5 936.5,-481.5 930.5,-475.5 930.5,-469.5 930.5,-469.5 930.5,-432.5 930.5,-432.5 930.5,-426.5 936.5,-420.5 942.5,-420.5"/>
<text text-anchor="middle" x="1040" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">StatementContext::ResetForRetry</text>
<polyline fill="none" stroke="#1c2123" points="930.5,-458.5 1149.5,-458.5 "/>
<text text-anchor="start" x="938.5" y="-443.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">重置changed states during execution</text>
<text text-anchor="start" x="938.5" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 比如affectedRows, updated等</text>
</g>
<!-- handlePessimisticLockError&#45;&gt;StmtCtx_ResetForRetry -->
<g id="edge20" class="edge">
<title>handlePessimisticLockError&#45;&gt;StmtCtx_ResetForRetry</title>
<path fill="none" stroke="#666666" d="M811.46,-280.6C834.56,-316.5 877.3,-375.61 928,-411 930.13,-412.49 932.32,-413.93 934.57,-415.32"/>
<polygon fill="#666666" stroke="#666666" points="933.03,-418.47 943.44,-420.44 936.53,-412.41 933.03,-418.47"/>
</g>
<!-- LockKeys -->
<g id="node11" class="node">
<title>LockKeys</title>
<path fill="none" stroke="#1c2123" d="M1443,-511C1443,-511 1550,-511 1550,-511 1556,-511 1562,-517 1562,-523 1562,-523 1562,-545 1562,-545 1562,-551 1556,-557 1550,-557 1550,-557 1443,-557 1443,-557 1437,-557 1431,-551 1431,-545 1431,-545 1431,-523 1431,-523 1431,-517 1437,-511 1443,-511"/>
<text text-anchor="middle" x="1496.5" y="-541.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockKeys</text>
<polyline fill="none" stroke="#1c2123" points="1431,-534 1562,-534 "/>
<text text-anchor="start" x="1439" y="-518.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">尝试获取key的lock</text>
</g>
<!-- Executor_Next&#45;&gt;LockKeys -->
<g id="edge11" class="edge">
<title>Executor_Next&#45;&gt;LockKeys</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1347.02,-534C1370.05,-534 1396.41,-534 1420.48,-534"/>
<polygon fill="green" stroke="green" points="1420.63,-537.5 1430.63,-534 1420.63,-530.5 1420.63,-537.5"/>
</g>
<!-- buildExecutor&#45;&gt;Executor_Next -->
<g id="edge10" class="edge">
<title>buildExecutor&#45;&gt;Executor_Next</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1087.09,-525.9C1121.91,-527.34 1170.37,-529.35 1210.38,-531"/>
<polygon fill="green" stroke="green" points="1210.49,-534.51 1220.62,-531.42 1210.78,-527.51 1210.49,-534.51"/>
</g>
<!-- ErrDeadlock&#45;&gt;ErrDeadlock_IsRetryable -->
<g id="edge26" class="edge">
<title>ErrDeadlock&#45;&gt;ErrDeadlock_IsRetryable</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1083.15,-38.35C1109.35,-41.06 1144.29,-44.67 1177.62,-48.11"/>
<polygon fill="green" stroke="green" points="1177.6,-51.63 1187.9,-49.18 1178.32,-44.67 1177.6,-51.63"/>
</g>
<!-- ErrWriteConflict&#45;&gt;GetForUpdateTS -->
<g id="edge21" class="edge">
<title>ErrWriteConflict&#45;&gt;GetForUpdateTS</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1094.11,-115.46C1130.76,-120.61 1179.71,-127.49 1218.59,-132.95"/>
<polygon fill="green" stroke="green" points="1218.37,-136.45 1228.76,-134.38 1219.34,-129.52 1218.37,-136.45"/>
</g>
<!-- LazyTxn_cleanup -->
<g id="node20" class="node">
<title>LazyTxn_cleanup</title>
<path fill="none" stroke="#1c2123" d="M1238.5,-360C1238.5,-360 1329.5,-360 1329.5,-360 1335.5,-360 1341.5,-366 1341.5,-372 1341.5,-372 1341.5,-384 1341.5,-384 1341.5,-390 1335.5,-396 1329.5,-396 1329.5,-396 1238.5,-396 1238.5,-396 1232.5,-396 1226.5,-390 1226.5,-384 1226.5,-384 1226.5,-372 1226.5,-372 1226.5,-366 1232.5,-360 1238.5,-360"/>
<text text-anchor="middle" x="1284" y="-374.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LazyTxn::cleanup</text>
</g>
<!-- StmtRollback&#45;&gt;LazyTxn_cleanup -->
<g id="edge22" class="edge">
<title>StmtRollback&#45;&gt;LazyTxn_cleanup</title>
<path fill="none" stroke="#666666" d="M1139.08,-378C1164.88,-378 1192.11,-378 1215.87,-378"/>
<polygon fill="#666666" stroke="#666666" points="1216.17,-381.5 1226.17,-378 1216.17,-374.5 1216.17,-381.5"/>
</g>
<!-- LazyTxn_cleanupStmtBuf -->
<g id="node21" class="node">
<title>LazyTxn_cleanupStmtBuf</title>
<path fill="none" stroke="#1c2123" d="M1428,-290C1428,-290 1565,-290 1565,-290 1571,-290 1577,-296 1577,-302 1577,-302 1577,-324 1577,-324 1577,-330 1571,-336 1565,-336 1565,-336 1428,-336 1428,-336 1422,-336 1416,-330 1416,-324 1416,-324 1416,-302 1416,-302 1416,-296 1422,-290 1428,-290"/>
<text text-anchor="middle" x="1496.5" y="-320.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LazyTxn::cleanupStmtBuf</text>
<polyline fill="none" stroke="#1c2123" points="1416,-313 1577,-313 "/>
<text text-anchor="start" x="1424" y="-297.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">清理掉MemBuffer</text>
</g>
<!-- LazyTxn_cleanup&#45;&gt;LazyTxn_cleanupStmtBuf -->
<g id="edge23" class="edge">
<title>LazyTxn_cleanup&#45;&gt;LazyTxn_cleanupStmtBuf</title>
<path fill="none" stroke="#666666" d="M1341.69,-360.5C1363.09,-353.89 1387.93,-346.22 1411.32,-338.99"/>
<polygon fill="#666666" stroke="#666666" points="1412.37,-342.33 1420.89,-336.04 1410.3,-335.64 1412.37,-342.33"/>
</g>
<!-- LazyTxn_initStmtBuf -->
<g id="node22" class="node">
<title>LazyTxn_initStmtBuf</title>
<path fill="none" stroke="#1c2123" d="M1440,-355C1440,-355 1553,-355 1553,-355 1559,-355 1565,-361 1565,-367 1565,-367 1565,-389 1565,-389 1565,-395 1559,-401 1553,-401 1553,-401 1440,-401 1440,-401 1434,-401 1428,-395 1428,-389 1428,-389 1428,-367 1428,-367 1428,-361 1434,-355 1440,-355"/>
<text text-anchor="middle" x="1496.5" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LazyTxn::initStmtBuf</text>
<polyline fill="none" stroke="#1c2123" points="1428,-378 1565,-378 "/>
<text text-anchor="start" x="1436" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备StmtBuf</text>
</g>
<!-- LazyTxn_cleanup&#45;&gt;LazyTxn_initStmtBuf -->
<g id="edge24" class="edge">
<title>LazyTxn_cleanup&#45;&gt;LazyTxn_initStmtBuf</title>
<path fill="none" stroke="#666666" d="M1341.69,-378C1365.02,-378 1392.43,-378 1417.6,-378"/>
<polygon fill="#666666" stroke="#666666" points="1417.85,-381.5 1427.85,-378 1417.85,-374.5 1417.85,-381.5"/>
</g>
<!-- LazyTxn_mutations -->
<g id="node23" class="node">
<title>LazyTxn_mutations</title>
<path fill="#feed9b" stroke="#f7e495" d="M1430.5,-420C1430.5,-420 1562.5,-420 1562.5,-420 1568.5,-420 1574.5,-426 1574.5,-432 1574.5,-432 1574.5,-454 1574.5,-454 1574.5,-460 1568.5,-466 1562.5,-466 1562.5,-466 1430.5,-466 1430.5,-466 1424.5,-466 1418.5,-460 1418.5,-454 1418.5,-454 1418.5,-432 1418.5,-432 1418.5,-426 1424.5,-420 1430.5,-420"/>
<text text-anchor="middle" x="1496.5" y="-450.8" font-family="Times,serif" font-size="14.00" fill="#40575d">LazyTxn::mutations</text>
<polyline fill="none" stroke="#f7e495" points="1418.5,-443 1574.5,-443 "/>
<text text-anchor="middle" x="1496.5" y="-427.8" font-family="Times,serif" font-size="14.00" fill="#40575d">清理掉已有的mutations</text>
</g>
<!-- LazyTxn_cleanup&#45;&gt;LazyTxn_mutations -->
<g id="edge25" class="edge">
<title>LazyTxn_cleanup&#45;&gt;LazyTxn_mutations</title>
<path fill="none" stroke="#666666" d="M1341.69,-395.5C1363.09,-402.11 1387.93,-409.78 1411.32,-417.01"/>
<polygon fill="#666666" stroke="#666666" points="1410.3,-420.36 1420.89,-419.96 1412.37,-413.67 1410.3,-420.36"/>
</g>
</g>
</svg>
