<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: kv_raft Pages: 1 -->
<svg width="1283pt" height="230pt"
 viewBox="0.00 0.00 1283.00 230.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 226)">
<title>kv_raft</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-226 1279,-226 1279,4 -4,4"/>
<!-- kv_Service_batch_raft -->
<g id="node1" class="node">
<title>kv_Service_batch_raft</title>
<path fill="none" stroke="#1c2123" d="M449,-160.5C449,-160.5 509,-160.5 509,-160.5 515,-160.5 521,-166.5 521,-172.5 521,-172.5 521,-209.5 521,-209.5 521,-215.5 515,-221.5 509,-221.5 509,-221.5 449,-221.5 449,-221.5 443,-221.5 437,-215.5 437,-209.5 437,-209.5 437,-172.5 437,-172.5 437,-166.5 443,-160.5 449,-160.5"/>
<text text-anchor="start" x="445" y="-206.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GRPC 接口</text>
<polyline fill="none" stroke="#1c2123" points="437,-198.5 521,-198.5 "/>
<text text-anchor="start" x="445" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv/Service</text>
<text text-anchor="middle" x="479" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> batch_raft</text>
</g>
<!-- RaftStoreRouter_send_raft_msg -->
<g id="node6" class="node">
<title>RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#1c2123" d="M627,-92C627,-92 708,-92 708,-92 714,-92 720,-98 720,-104 720,-104 720,-118 720,-118 720,-124 714,-130 708,-130 708,-130 627,-130 627,-130 621,-130 615,-124 615,-118 615,-118 615,-104 615,-104 615,-98 621,-92 627,-92"/>
<text text-anchor="middle" x="667.5" y="-114.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftStoreRouter</text>
<text text-anchor="middle" x="667.5" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_msg</text>
</g>
<!-- kv_Service_batch_raft&#45;&gt;RaftStoreRouter_send_raft_msg -->
<g id="edge4" class="edge">
<title>kv_Service_batch_raft&#45;&gt;RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M521.11,-174.87C538.98,-167.73 560.1,-159.13 579,-151 591.23,-145.74 604.32,-139.88 616.55,-134.3"/>
<polygon fill="#666666" stroke="#666666" points="618.08,-137.45 625.72,-130.1 615.17,-131.08 618.08,-137.45"/>
</g>
<!-- kv_Service_raft -->
<g id="node2" class="node">
<title>kv_Service_raft</title>
<path fill="none" stroke="#1c2123" d="M449,-80.5C449,-80.5 509,-80.5 509,-80.5 515,-80.5 521,-86.5 521,-92.5 521,-92.5 521,-129.5 521,-129.5 521,-135.5 515,-141.5 509,-141.5 509,-141.5 449,-141.5 449,-141.5 443,-141.5 437,-135.5 437,-129.5 437,-129.5 437,-92.5 437,-92.5 437,-86.5 443,-80.5 449,-80.5"/>
<text text-anchor="start" x="445" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GRPC 接口</text>
<polyline fill="none" stroke="#1c2123" points="437,-118.5 521,-118.5 "/>
<text text-anchor="start" x="445" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv/Service</text>
<text text-anchor="middle" x="479" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> raft</text>
</g>
<!-- kv_Service_raft&#45;&gt;RaftStoreRouter_send_raft_msg -->
<g id="edge5" class="edge">
<title>kv_Service_raft&#45;&gt;RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M521.39,-111C545.85,-111 577.28,-111 604.63,-111"/>
<polygon fill="#666666" stroke="#666666" points="604.89,-114.5 614.89,-111 604.89,-107.5 604.89,-114.5"/>
</g>
<!-- kv_Service_snapshot -->
<g id="node3" class="node">
<title>kv_Service_snapshot</title>
<path fill="none" stroke="#1c2123" d="M12,-0.5C12,-0.5 68,-0.5 68,-0.5 74,-0.5 80,-6.5 80,-12.5 80,-12.5 80,-49.5 80,-49.5 80,-55.5 74,-61.5 68,-61.5 68,-61.5 12,-61.5 12,-61.5 6,-61.5 0,-55.5 0,-49.5 0,-49.5 0,-12.5 0,-12.5 0,-6.5 6,-0.5 12,-0.5"/>
<text text-anchor="start" x="8" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">GRPC接口</text>
<polyline fill="none" stroke="#1c2123" points="0,-38.5 80,-38.5 "/>
<text text-anchor="start" x="8" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv/Service</text>
<text text-anchor="middle" x="40" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snapshot</text>
</g>
<!-- snap_scheduler -->
<g id="node4" class="node">
<title>snap_scheduler</title>
<path fill="none" stroke="#1c2123" d="M128,-8C128,-8 331,-8 331,-8 337,-8 343,-14 343,-20 343,-20 343,-42 343,-42 343,-48 337,-54 331,-54 331,-54 128,-54 128,-54 122,-54 116,-48 116,-42 116,-42 116,-20 116,-20 116,-14 122,-8 128,-8"/>
<text text-anchor="middle" x="229.5" y="-38.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_scheduler</text>
<polyline fill="none" stroke="#1c2123" points="116,-31 343,-31 "/>
<text text-anchor="middle" x="229.5" y="-15.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">接收snap数据，保存到对应文件中</text>
</g>
<!-- kv_Service_snapshot&#45;&gt;snap_scheduler -->
<g id="edge1" class="edge">
<title>kv_Service_snapshot&#45;&gt;snap_scheduler</title>
<path fill="none" stroke="#666666" d="M80.31,-31C88.11,-31 96.68,-31 105.65,-31"/>
<polygon fill="#666666" stroke="#666666" points="105.92,-34.5 115.92,-31 105.92,-27.5 105.92,-34.5"/>
</g>
<!-- snap_handler -->
<g id="node5" class="node">
<title>snap_handler</title>
<path fill="none" stroke="#1c2123" d="M391,-0.5C391,-0.5 567,-0.5 567,-0.5 573,-0.5 579,-6.5 579,-12.5 579,-12.5 579,-49.5 579,-49.5 579,-55.5 573,-61.5 567,-61.5 567,-61.5 391,-61.5 391,-61.5 385,-61.5 379,-55.5 379,-49.5 379,-49.5 379,-12.5 379,-12.5 379,-6.5 385,-0.5 391,-0.5"/>
<text text-anchor="middle" x="479" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_handler</text>
<polyline fill="none" stroke="#1c2123" points="379,-38.5 579,-38.5 "/>
<text text-anchor="start" x="387" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap handler线程接受完数据后</text>
<text text-anchor="start" x="387" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_msg</text>
</g>
<!-- snap_scheduler&#45;&gt;snap_handler -->
<g id="edge2" class="edge">
<title>snap_scheduler&#45;&gt;snap_handler</title>
<path fill="none" stroke="#666666" d="M343.02,-31C351.47,-31 359.98,-31 368.41,-31"/>
<polygon fill="#666666" stroke="#666666" points="368.63,-34.5 378.63,-31 368.63,-27.5 368.63,-34.5"/>
</g>
<!-- snap_handler&#45;&gt;RaftStoreRouter_send_raft_msg -->
<g id="edge3" class="edge">
<title>snap_handler&#45;&gt;RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M556.62,-61.56C564.2,-64.7 571.76,-67.89 579,-71 591.23,-76.26 604.32,-82.12 616.55,-87.7"/>
<polygon fill="#666666" stroke="#666666" points="615.17,-90.92 625.72,-91.9 618.08,-84.55 615.17,-90.92"/>
</g>
<!-- ServerRaftStoreRouter_send_raft_msg -->
<g id="node7" class="node">
<title>ServerRaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#1c2123" d="M768,-92C768,-92 884,-92 884,-92 890,-92 896,-98 896,-104 896,-104 896,-118 896,-118 896,-124 890,-130 884,-130 884,-130 768,-130 768,-130 762,-130 756,-124 756,-118 756,-118 756,-104 756,-104 756,-98 762,-92 768,-92"/>
<text text-anchor="middle" x="826" y="-114.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ServerRaftStoreRouter</text>
<text text-anchor="start" x="764" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_msg</text>
</g>
<!-- RaftStoreRouter_send_raft_msg&#45;&gt;ServerRaftStoreRouter_send_raft_msg -->
<g id="edge6" class="edge">
<title>RaftStoreRouter_send_raft_msg&#45;&gt;ServerRaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M720.18,-111C728.37,-111 737,-111 745.65,-111"/>
<polygon fill="#666666" stroke="#666666" points="745.79,-114.5 755.79,-111 745.79,-107.5 745.79,-114.5"/>
</g>
<!-- RaftRouter_send_raft_msg -->
<g id="node8" class="node">
<title>RaftRouter_send_raft_msg</title>
<path fill="none" stroke="#1c2123" d="M944,-92C944,-92 1021,-92 1021,-92 1027,-92 1033,-98 1033,-104 1033,-104 1033,-118 1033,-118 1033,-124 1027,-130 1021,-130 1021,-130 944,-130 944,-130 938,-130 932,-124 932,-118 932,-118 932,-104 932,-104 932,-98 938,-92 944,-92"/>
<text text-anchor="middle" x="982.5" y="-114.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftRouter</text>
<text text-anchor="middle" x="982.5" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_msg</text>
</g>
<!-- ServerRaftStoreRouter_send_raft_msg&#45;&gt;RaftRouter_send_raft_msg -->
<g id="edge7" class="edge">
<title>ServerRaftStoreRouter_send_raft_msg&#45;&gt;RaftRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M896.12,-111C904.68,-111 913.39,-111 921.8,-111"/>
<polygon fill="#666666" stroke="#666666" points="921.88,-114.5 931.88,-111 921.88,-107.5 921.88,-114.5"/>
</g>
<!-- RaftRouter_try_send -->
<g id="node9" class="node">
<title>RaftRouter_try_send</title>
<path fill="none" stroke="#1c2123" d="M1081,-65.5C1081,-65.5 1263,-65.5 1263,-65.5 1269,-65.5 1275,-71.5 1275,-77.5 1275,-77.5 1275,-144.5 1275,-144.5 1275,-150.5 1269,-156.5 1263,-156.5 1263,-156.5 1081,-156.5 1081,-156.5 1075,-156.5 1069,-150.5 1069,-144.5 1069,-144.5 1069,-77.5 1069,-77.5 1069,-71.5 1075,-65.5 1081,-65.5"/>
<text text-anchor="middle" x="1172" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftRouter</text>
<text text-anchor="middle" x="1172" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> try_send</text>
<polyline fill="none" stroke="#1c2123" points="1069,-118.5 1275,-118.5 "/>
<text text-anchor="start" x="1077" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据normals中的map</text>
<text text-anchor="start" x="1077" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 找到region_id对应的PeerFsm的</text>
<text text-anchor="start" x="1077" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Mailbox, 使用它发送消息</text>
</g>
<!-- RaftRouter_send_raft_msg&#45;&gt;RaftRouter_try_send -->
<g id="edge8" class="edge">
<title>RaftRouter_send_raft_msg&#45;&gt;RaftRouter_try_send</title>
<path fill="none" stroke="#666666" d="M1033.25,-111C1041.29,-111 1049.89,-111 1058.72,-111"/>
<polygon fill="#666666" stroke="#666666" points="1058.77,-114.5 1068.77,-111 1058.77,-107.5 1058.77,-114.5"/>
</g>
</g>
</svg>
