<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: LocalReader_read Pages: 1 -->
<svg width="1545pt" height="720pt"
 viewBox="0.00 0.00 1545.00 719.96" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 715.96)">
<title>LocalReader_read</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-715.96 1541,-715.96 1541,4 -4,4"/>
<!-- LocalReader__read -->
<g id="node1" class="node">
<title>LocalReader__read</title>
<path fill="none" stroke="#1c2123" d="M12,-115C12,-115 281,-115 281,-115 287,-115 293,-121 293,-127 293,-127 293,-187 293,-187 293,-193 287,-199 281,-199 281,-199 12,-199 12,-199 6,-199 0,-193 0,-187 0,-187 0,-127 0,-127 0,-121 6,-115 12,-115"/>
<text text-anchor="start" x="8" y="-183.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="8" y="-168.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read</text>
<polyline fill="none" stroke="#1c2123" points="0,-161 293,-161 "/>
<text text-anchor="start" x="8" y="-145.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. check leader lease</text>
<polyline fill="none" stroke="#1c2123" points="0,-138 293,-138 "/>
<text text-anchor="start" x="8" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. 对于同一个RPC request 使用同一个snapshot</text>
</g>
<!-- LocalReader__propose_raft_command -->
<g id="node2" class="node">
<title>LocalReader__propose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M341,-126.5C341,-126.5 467,-126.5 467,-126.5 473,-126.5 479,-132.5 479,-138.5 479,-138.5 479,-175.5 479,-175.5 479,-181.5 473,-187.5 467,-187.5 467,-187.5 341,-187.5 341,-187.5 335,-187.5 329,-181.5 329,-175.5 329,-175.5 329,-138.5 329,-138.5 329,-132.5 335,-126.5 341,-126.5"/>
<text text-anchor="start" x="337" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="337" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="329,-149.5 479,-149.5 "/>
<text text-anchor="start" x="337" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">提交raft read cmd</text>
</g>
<!-- LocalReader__read&#45;&gt;LocalReader__propose_raft_command -->
<g id="edge1" class="edge">
<title>LocalReader__read&#45;&gt;LocalReader__propose_raft_command</title>
<path fill="none" stroke="#666666" d="M293.16,-157C301.93,-157 310.58,-157 318.94,-157"/>
<polygon fill="#666666" stroke="#666666" points="318.99,-160.5 328.99,-157 318.99,-153.5 318.99,-160.5"/>
</g>
<!-- LocalReader__pre_propose_raft_command -->
<g id="node3" class="node">
<title>LocalReader__pre_propose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M529.5,-485.5C529.5,-485.5 679.5,-485.5 679.5,-485.5 685.5,-485.5 691.5,-491.5 691.5,-497.5 691.5,-497.5 691.5,-534.5 691.5,-534.5 691.5,-540.5 685.5,-546.5 679.5,-546.5 679.5,-546.5 529.5,-546.5 529.5,-546.5 523.5,-546.5 517.5,-540.5 517.5,-534.5 517.5,-534.5 517.5,-497.5 517.5,-497.5 517.5,-491.5 523.5,-485.5 529.5,-485.5"/>
<text text-anchor="start" x="525.5" y="-531.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="525.5" y="-516.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pre_propose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="517.5,-508.5 691.5,-508.5 "/>
<text text-anchor="start" x="525.5" y="-493.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备ReadDelegate</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;LocalReader__pre_propose_raft_command -->
<g id="edge2" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;LocalReader__pre_propose_raft_command</title>
<path fill="none" stroke="#666666" d="M421.92,-187.61C457.89,-252.65 541.88,-404.56 581.75,-476.67"/>
<polygon fill="#666666" stroke="#666666" points="578.72,-478.41 586.62,-485.47 584.84,-475.02 578.72,-478.41"/>
</g>
<!-- LocalReader__redirect -->
<g id="node4" class="node">
<title>LocalReader__redirect</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1205,-568.5C1205,-568.5 1318,-568.5 1318,-568.5 1324,-568.5 1330,-574.5 1330,-580.5 1330,-580.5 1330,-647.5 1330,-647.5 1330,-653.5 1324,-659.5 1318,-659.5 1318,-659.5 1205,-659.5 1205,-659.5 1199,-659.5 1193,-653.5 1193,-647.5 1193,-647.5 1193,-580.5 1193,-580.5 1193,-574.5 1199,-568.5 1205,-568.5"/>
<text text-anchor="start" x="1201" y="-644.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LocalReader</text>
<text text-anchor="start" x="1201" y="-629.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> redirect</text>
<polyline fill="none" stroke="#8a8898" points="1193,-621.5 1330,-621.5 "/>
<text text-anchor="start" x="1201" y="-606.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">不再leader lease内了</text>
<text text-anchor="start" x="1201" y="-591.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 将RaftCommand</text>
<text text-anchor="start" x="1201" y="-576.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 发送给raftstore</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;LocalReader__redirect -->
<g id="edge3" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="#666666" d="M406.42,-187.51C411.11,-258.57 431.05,-438.03 515,-556 582.26,-650.52 619.22,-669.56 730,-704 776.04,-718.31 1122.8,-710.58 1157,-698 1175.96,-691.03 1194.02,-679.04 1209.59,-666.28"/>
<polygon fill="#666666" stroke="#666666" points="1212.15,-668.7 1217.5,-659.55 1207.62,-663.37 1212.15,-668.7"/>
</g>
<!-- ReadDelegate__is_in_leader_lease -->
<g id="node5" class="node">
<title>ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="#1c2123" d="M954,-156.5C954,-156.5 1136,-156.5 1136,-156.5 1142,-156.5 1148,-162.5 1148,-168.5 1148,-168.5 1148,-205.5 1148,-205.5 1148,-211.5 1142,-217.5 1136,-217.5 1136,-217.5 954,-217.5 954,-217.5 948,-217.5 942,-211.5 942,-205.5 942,-205.5 942,-168.5 942,-168.5 942,-162.5 948,-156.5 954,-156.5"/>
<text text-anchor="middle" x="1045" y="-202.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadDelegate__is_in_leader_lease</text>
<polyline fill="none" stroke="#1c2123" points="942,-194.5 1148,-194.5 "/>
<text text-anchor="start" x="950" y="-179.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查是否还在leader</text>
<text text-anchor="start" x="950" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> lease内</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease -->
<g id="edge4" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="#666666" d="M479.24,-160.49C590.62,-165.71 801.76,-175.63 931.95,-181.74"/>
<polygon fill="#666666" stroke="#666666" points="931.8,-185.24 941.96,-182.21 932.13,-178.24 931.8,-185.24"/>
</g>
<!-- LocalReader__execute -->
<g id="node6" class="node">
<title>LocalReader__execute</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1212,-119C1212,-119 1311,-119 1311,-119 1317,-119 1323,-125 1323,-131 1323,-131 1323,-183 1323,-183 1323,-189 1317,-195 1311,-195 1311,-195 1212,-195 1212,-195 1206,-195 1200,-189 1200,-183 1200,-183 1200,-131 1200,-131 1200,-125 1206,-119 1212,-119"/>
<text text-anchor="start" x="1208" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LocalReader</text>
<text text-anchor="start" x="1208" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> execute</text>
<polyline fill="none" stroke="#8a8898" points="1200,-157 1323,-157 "/>
<text text-anchor="start" x="1208" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">还在leader lease内</text>
<text text-anchor="start" x="1208" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 直接读</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;LocalReader__execute -->
<g id="edge5" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;LocalReader__execute</title>
<path fill="none" stroke="#666666" d="M479.23,-152.99C614.23,-146.38 908.88,-135.04 1157,-147 1167.63,-147.51 1178.85,-148.32 1189.83,-149.26"/>
<polygon fill="#666666" stroke="#666666" points="1189.55,-152.75 1199.82,-150.15 1190.17,-145.77 1189.55,-152.75"/>
</g>
<!-- Callback__invoke_read -->
<g id="node7" class="node">
<title>Callback__invoke_read</title>
<path fill="none" stroke="#1c2123" d="M1378,-59.5C1378,-59.5 1525,-59.5 1525,-59.5 1531,-59.5 1537,-65.5 1537,-71.5 1537,-71.5 1537,-108.5 1537,-108.5 1537,-114.5 1531,-120.5 1525,-120.5 1525,-120.5 1378,-120.5 1378,-120.5 1372,-120.5 1366,-114.5 1366,-108.5 1366,-108.5 1366,-71.5 1366,-71.5 1366,-65.5 1372,-59.5 1378,-59.5"/>
<text text-anchor="start" x="1374" y="-105.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Callback</text>
<text text-anchor="start" x="1374" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> invoke_read</text>
<polyline fill="none" stroke="#1c2123" points="1366,-82.5 1537,-82.5 "/>
<text text-anchor="start" x="1374" y="-67.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用callback的invoke_read</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;Callback__invoke_read -->
<g id="edge6" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;Callback__invoke_read</title>
<path fill="none" stroke="#666666" d="M479.13,-137.35C560.34,-117.58 694.74,-90 812.5,-90 812.5,-90 812.5,-90 1046,-90 1152.01,-90 1273.64,-90 1355.62,-90"/>
<polygon fill="#666666" stroke="#666666" points="1355.66,-93.5 1365.66,-90 1355.66,-86.5 1355.66,-93.5"/>
</g>
<!-- ThreadReadId -->
<g id="node8" class="node">
<title>ThreadReadId</title>
<path fill="none" stroke="#1c2123" d="M527,-0.5C527,-0.5 682,-0.5 682,-0.5 688,-0.5 694,-6.5 694,-12.5 694,-12.5 694,-49.5 694,-49.5 694,-55.5 688,-61.5 682,-61.5 682,-61.5 527,-61.5 527,-61.5 521,-61.5 515,-55.5 515,-49.5 515,-49.5 515,-12.5 515,-12.5 515,-6.5 521,-0.5 527,-0.5"/>
<text text-anchor="middle" x="604.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ThreadReadId</text>
<polyline fill="none" stroke="#1c2123" points="515,-38.5 694,-38.5 "/>
<text text-anchor="start" x="523" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">judge read requests </text>
<text text-anchor="start" x="523" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> from the same GRPC stream</text>
</g>
<!-- LocalReader__propose_raft_command&#45;&gt;ThreadReadId -->
<g id="edge7" class="edge">
<title>LocalReader__propose_raft_command&#45;&gt;ThreadReadId</title>
<path fill="none" stroke="#666666" d="M443.37,-126.33C464.02,-110.45 490.27,-91.25 515,-76 520.08,-72.87 525.4,-69.76 530.8,-66.73"/>
<polygon fill="#666666" stroke="#666666" points="532.87,-69.59 539.95,-61.71 529.5,-63.46 532.87,-69.59"/>
</g>
<!-- LocalReader__get_delegate -->
<g id="node9" class="node">
<title>LocalReader__get_delegate</title>
<path fill="none" stroke="#1c2123" d="M742,-276.5C742,-276.5 885,-276.5 885,-276.5 891,-276.5 897,-282.5 897,-288.5 897,-288.5 897,-385.5 897,-385.5 897,-391.5 891,-397.5 885,-397.5 885,-397.5 742,-397.5 742,-397.5 736,-397.5 730,-391.5 730,-385.5 730,-385.5 730,-288.5 730,-288.5 730,-282.5 736,-276.5 742,-276.5"/>
<text text-anchor="start" x="738" y="-382.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader</text>
<text text-anchor="start" x="738" y="-367.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_delegate</text>
<polyline fill="none" stroke="#1c2123" points="730,-359.5 897,-359.5 "/>
<text text-anchor="start" x="738" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果cache中没有</text>
<text text-anchor="start" x="738" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者read delegate</text>
<text text-anchor="start" x="738" y="-314.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的track_ver发生了变化</text>
<text text-anchor="start" x="738" y="-299.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则去storeMeta的readers</text>
<text text-anchor="start" x="738" y="-284.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取最新的ReadDelegate</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;LocalReader__get_delegate -->
<g id="edge8" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;LocalReader__get_delegate</title>
<path fill="none" stroke="#666666" d="M641.08,-485.23C666.77,-463.02 702.44,-432.17 734.6,-404.36"/>
<polygon fill="#666666" stroke="#666666" points="736.98,-406.93 742.26,-397.74 732.4,-401.64 736.98,-406.93"/>
</g>
<!-- Inspector__inspect -->
<g id="node10" class="node">
<title>Inspector__inspect</title>
<path fill="none" stroke="#1c2123" d="M861,-534C861,-534 766,-534 766,-534 760,-534 754,-528 754,-522 754,-522 754,-510 754,-510 754,-504 760,-498 766,-498 766,-498 861,-498 861,-498 867,-498 873,-504 873,-510 873,-510 873,-522 873,-522 873,-528 867,-534 861,-534"/>
<text text-anchor="middle" x="813.5" y="-512.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Inspector__inspect</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;Inspector__inspect -->
<g id="edge9" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;Inspector__inspect</title>
<path fill="none" stroke="#666666" d="M691.79,-516C709.06,-516 726.99,-516 743.58,-516"/>
<polygon fill="#666666" stroke="#666666" points="743.72,-519.5 753.72,-516 743.72,-512.5 743.72,-519.5"/>
</g>
<!-- Inspector__has_applied_to_current_term -->
<g id="node11" class="node">
<title>Inspector__has_applied_to_current_term</title>
<path fill="none" stroke="#1c2123" d="M945,-561C945,-561 1145,-561 1145,-561 1151,-561 1157,-567 1157,-573 1157,-573 1157,-655 1157,-655 1157,-661 1151,-667 1145,-667 1145,-667 945,-667 945,-667 939,-667 933,-661 933,-655 933,-655 933,-573 933,-573 933,-567 939,-561 945,-561"/>
<text text-anchor="start" x="941" y="-651.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Inspector</text>
<text text-anchor="start" x="941" y="-636.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> has_applied_to_current_term</text>
<polyline fill="none" stroke="#1c2123" points="933,-629 1157,-629 "/>
<text text-anchor="start" x="941" y="-613.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果applied index term</text>
<text text-anchor="start" x="941" y="-598.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和current raft term不一致</text>
<text text-anchor="start" x="941" y="-583.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> leader transfer must happened</text>
<text text-anchor="start" x="941" y="-568.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> if read locally we may read old value</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;Inspector__has_applied_to_current_term -->
<g id="edge10" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;Inspector__has_applied_to_current_term</title>
<path fill="none" stroke="#666666" d="M691.61,-535.24C757.61,-550 849.52,-570.54 922.92,-586.94"/>
<polygon fill="#666666" stroke="#666666" points="922.17,-590.36 932.7,-589.12 923.7,-583.53 922.17,-590.36"/>
</g>
<!-- RequestHeader__get_read_quorum -->
<g id="node12" class="node">
<title>RequestHeader__get_read_quorum</title>
<path fill="none" stroke="#1c2123" d="M760,-618C760,-618 867,-618 867,-618 873,-618 879,-624 879,-630 879,-630 879,-682 879,-682 879,-688 873,-694 867,-694 867,-694 760,-694 760,-694 754,-694 748,-688 748,-682 748,-682 748,-630 748,-630 748,-624 754,-618 760,-618"/>
<text text-anchor="start" x="756" y="-678.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RequestHeader</text>
<text text-anchor="start" x="756" y="-663.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_read_quorum</text>
<polyline fill="none" stroke="#1c2123" points="748,-656 879,-656 "/>
<text text-anchor="start" x="756" y="-640.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">请求头中明确要求</text>
<text text-anchor="start" x="756" y="-625.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 走一次ReadIndex</text>
</g>
<!-- LocalReader__pre_propose_raft_command&#45;&gt;RequestHeader__get_read_quorum -->
<g id="edge11" class="edge">
<title>LocalReader__pre_propose_raft_command&#45;&gt;RequestHeader__get_read_quorum</title>
<path fill="none" stroke="#666666" d="M650.67,-546.55C679.06,-565.75 716.15,-590.84 747.66,-612.15"/>
<polygon fill="#666666" stroke="#666666" points="745.72,-615.06 755.96,-617.76 749.64,-609.26 745.72,-615.06"/>
</g>
<!-- ReadDelegate__is_in_leader_lease&#45;&gt;LocalReader__redirect -->
<g id="edge22" class="edge">
<title>ReadDelegate__is_in_leader_lease&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1145.58,-217.63C1149.7,-220.76 1153.54,-224.21 1157,-228 1241.74,-320.91 1258.37,-475.75 1260.86,-558.25"/>
<polygon fill="green" stroke="green" points="1257.36,-558.52 1261.1,-568.43 1264.36,-558.35 1257.36,-558.52"/>
</g>
<!-- ReadDelegate__is_in_leader_lease&#45;&gt;LocalReader__execute -->
<g id="edge23" class="edge">
<title>ReadDelegate__is_in_leader_lease&#45;&gt;LocalReader__execute</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1148.22,-172.7C1162.33,-170.73 1176.54,-168.74 1189.9,-166.87"/>
<polygon fill="green" stroke="green" points="1190.51,-170.32 1199.93,-165.47 1189.54,-163.39 1190.51,-170.32"/>
</g>
<!-- LocalReader__execute&#45;&gt;Callback__invoke_read -->
<g id="edge19" class="edge">
<title>LocalReader__execute&#45;&gt;Callback__invoke_read</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1323.02,-135.43C1333.67,-131.64 1344.98,-127.61 1356.29,-123.57"/>
<polygon fill="green" stroke="green" points="1357.54,-126.85 1365.78,-120.19 1355.19,-120.25 1357.54,-126.85"/>
</g>
<!-- LocalReader__get_value -->
<g id="node16" class="node">
<title>LocalReader__get_value</title>
<path fill="none" stroke="#1c2123" d="M1515.5,-175C1515.5,-175 1387.5,-175 1387.5,-175 1381.5,-175 1375.5,-169 1375.5,-163 1375.5,-163 1375.5,-151 1375.5,-151 1375.5,-145 1381.5,-139 1387.5,-139 1387.5,-139 1515.5,-139 1515.5,-139 1521.5,-139 1527.5,-145 1527.5,-151 1527.5,-151 1527.5,-163 1527.5,-163 1527.5,-169 1521.5,-175 1515.5,-175"/>
<text text-anchor="middle" x="1451.5" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader__get_value</text>
</g>
<!-- LocalReader__execute&#45;&gt;LocalReader__get_value -->
<g id="edge20" class="edge">
<title>LocalReader__execute&#45;&gt;LocalReader__get_value</title>
<path fill="none" stroke="#666666" d="M1323.02,-157C1336.41,-157 1350.84,-157 1365.01,-157"/>
<polygon fill="#666666" stroke="#666666" points="1365.26,-160.5 1375.26,-157 1365.26,-153.5 1365.26,-160.5"/>
</g>
<!-- LocalReader__get_snapshot -->
<g id="node17" class="node">
<title>LocalReader__get_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1524.5,-229C1524.5,-229 1378.5,-229 1378.5,-229 1372.5,-229 1366.5,-223 1366.5,-217 1366.5,-217 1366.5,-205 1366.5,-205 1366.5,-199 1372.5,-193 1378.5,-193 1378.5,-193 1524.5,-193 1524.5,-193 1530.5,-193 1536.5,-199 1536.5,-205 1536.5,-205 1536.5,-217 1536.5,-217 1536.5,-223 1530.5,-229 1524.5,-229"/>
<text text-anchor="middle" x="1451.5" y="-207.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocalReader__get_snapshot</text>
</g>
<!-- LocalReader__execute&#45;&gt;LocalReader__get_snapshot -->
<g id="edge21" class="edge">
<title>LocalReader__execute&#45;&gt;LocalReader__get_snapshot</title>
<path fill="none" stroke="#666666" d="M1323.02,-174.38C1340.58,-179.43 1359.93,-184.99 1378.14,-190.22"/>
<polygon fill="#666666" stroke="#666666" points="1377.25,-193.6 1387.83,-193 1379.19,-186.87 1377.25,-193.6"/>
</g>
<!-- LocalReader__get_delegate&#45;&gt;ReadDelegate__is_in_leader_lease -->
<g id="edge24" class="edge">
<title>LocalReader__get_delegate&#45;&gt;ReadDelegate__is_in_leader_lease</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M871.38,-276.35C889.82,-259.07 911.18,-241.34 933,-228 936.35,-225.95 939.83,-223.98 943.38,-222.08"/>
<polygon fill="green" stroke="green" points="945.03,-225.17 952.37,-217.53 941.87,-218.92 945.03,-225.17"/>
</g>
<!-- StoreMeta__readers -->
<g id="node14" class="node">
<title>StoreMeta__readers</title>
<path fill="#feed9b" stroke="#f7e495" d="M970.5,-332.5C970.5,-332.5 1119.5,-332.5 1119.5,-332.5 1125.5,-332.5 1131.5,-338.5 1131.5,-344.5 1131.5,-344.5 1131.5,-449.5 1131.5,-449.5 1131.5,-455.5 1125.5,-461.5 1119.5,-461.5 1119.5,-461.5 970.5,-461.5 970.5,-461.5 964.5,-461.5 958.5,-455.5 958.5,-449.5 958.5,-449.5 958.5,-344.5 958.5,-344.5 958.5,-338.5 964.5,-332.5 970.5,-332.5"/>
<text text-anchor="start" x="966.5" y="-446.3" font-family="Times,serif" font-size="14.00" fill="#40575d">StoreMeta</text>
<text text-anchor="start" x="966.5" y="-431.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> readers</text>
<polyline fill="none" stroke="#f7e495" points="958.5,-423.5 1131.5,-423.5 "/>
<text text-anchor="start" x="966.5" y="-408.3" font-family="Times,serif" font-size="14.00" fill="#40575d">pub readers: HashMap&lt;u64,</text>
<text text-anchor="start" x="966.5" y="-393.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> ReadDelegate&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="958.5,-385.5 1131.5,-385.5 "/>
<text text-anchor="start" x="966.5" y="-370.3" font-family="Times,serif" font-size="14.00" fill="#40575d">如果LRU cache中没有</text>
<text text-anchor="start" x="966.5" y="-355.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 加锁后访问store_meta</text>
<text text-anchor="start" x="966.5" y="-340.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 获取对应的readers</text>
</g>
<!-- LocalReader__get_delegate&#45;&gt;StoreMeta__readers -->
<g id="edge17" class="edge">
<title>LocalReader__get_delegate&#45;&gt;StoreMeta__readers</title>
<path fill="none" stroke="#666666" d="M897.03,-358.58C913.68,-362.93 931.32,-367.54 948.37,-372"/>
<polygon fill="#666666" stroke="#666666" points="947.78,-375.46 958.34,-374.6 949.55,-368.69 947.78,-375.46"/>
</g>
<!-- ReadDelegate__Tracker__any_new -->
<g id="node15" class="node">
<title>ReadDelegate__Tracker__any_new</title>
<path fill="none" stroke="#1c2123" d="M952,-237C952,-237 1138,-237 1138,-237 1144,-237 1150,-243 1150,-249 1150,-249 1150,-301 1150,-301 1150,-307 1144,-313 1138,-313 1138,-313 952,-313 952,-313 946,-313 940,-307 940,-301 940,-301 940,-249 940,-249 940,-243 946,-237 952,-237"/>
<text text-anchor="middle" x="1045" y="-297.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadDelegate__Tracker__any_new</text>
<polyline fill="none" stroke="#1c2123" points="940,-290 1150,-290 "/>
<text text-anchor="start" x="948" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查版本是否落后于</text>
<text text-anchor="start" x="948" y="-259.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> StoreMeta中的</text>
<text text-anchor="start" x="948" y="-244.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadDelegate</text>
</g>
<!-- LocalReader__get_delegate&#45;&gt;ReadDelegate__Tracker__any_new -->
<g id="edge18" class="edge">
<title>LocalReader__get_delegate&#45;&gt;ReadDelegate__Tracker__any_new</title>
<path fill="none" stroke="#666666" d="M897.03,-314.7C907.76,-311.8 918.91,-308.79 930.04,-305.79"/>
<polygon fill="#666666" stroke="#666666" points="931.07,-309.13 939.81,-303.15 929.25,-302.38 931.07,-309.13"/>
</g>
<!-- Inspector__inspect&#45;&gt;Inspector__has_applied_to_current_term -->
<g id="edge12" class="edge">
<title>Inspector__inspect&#45;&gt;Inspector__has_applied_to_current_term</title>
<path fill="none" stroke="#666666" d="M856.86,-534.09C875.84,-542.19 899.29,-552.21 923.09,-562.37"/>
<polygon fill="#666666" stroke="#666666" points="922,-565.71 932.58,-566.42 924.75,-559.27 922,-565.71"/>
</g>
<!-- Inspector__inspect_lease -->
<g id="node13" class="node">
<title>Inspector__inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M967,-480.5C967,-480.5 1123,-480.5 1123,-480.5 1129,-480.5 1135,-486.5 1135,-492.5 1135,-492.5 1135,-529.5 1135,-529.5 1135,-535.5 1129,-541.5 1123,-541.5 1123,-541.5 967,-541.5 967,-541.5 961,-541.5 955,-535.5 955,-529.5 955,-529.5 955,-492.5 955,-492.5 955,-486.5 961,-480.5 967,-480.5"/>
<text text-anchor="start" x="963" y="-526.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Inspector</text>
<text text-anchor="start" x="963" y="-511.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect_lease</text>
<polyline fill="none" stroke="#1c2123" points="955,-503.5 1135,-503.5 "/>
<text text-anchor="start" x="963" y="-488.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查leader lease是否已过期</text>
</g>
<!-- Inspector__inspect&#45;&gt;Inspector__inspect_lease -->
<g id="edge13" class="edge">
<title>Inspector__inspect&#45;&gt;Inspector__inspect_lease</title>
<path fill="none" stroke="#666666" d="M873.01,-514.73C894.83,-514.25 920.27,-513.7 944.74,-513.16"/>
<polygon fill="#666666" stroke="#666666" points="944.87,-516.66 954.79,-512.94 944.72,-509.66 944.87,-516.66"/>
</g>
<!-- Inspector__has_applied_to_current_term&#45;&gt;LocalReader__redirect -->
<g id="edge14" class="edge">
<title>Inspector__has_applied_to_current_term&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1157.02,-614C1165.74,-614 1174.43,-614 1182.85,-614"/>
<polygon fill="green" stroke="green" points="1182.98,-617.5 1192.98,-614 1182.98,-610.5 1182.98,-617.5"/>
</g>
<!-- RequestHeader__get_read_quorum&#45;&gt;LocalReader__redirect -->
<g id="edge15" class="edge">
<title>RequestHeader__get_read_quorum&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M879.28,-672.48C949.17,-687.39 1063.07,-703.34 1157,-677 1167.73,-673.99 1178.45,-669.53 1188.71,-664.34"/>
<polygon fill="green" stroke="green" points="1190.41,-667.41 1197.59,-659.62 1187.12,-661.23 1190.41,-667.41"/>
</g>
<!-- Inspector__inspect_lease&#45;&gt;LocalReader__redirect -->
<g id="edge16" class="edge">
<title>Inspector__inspect_lease&#45;&gt;LocalReader__redirect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1133.59,-541.6C1141.59,-544.92 1149.5,-548.41 1157,-552 1165.85,-556.24 1174.94,-561.01 1183.87,-565.97"/>
<polygon fill="green" stroke="green" points="1182.3,-569.1 1192.73,-570.98 1185.75,-563.01 1182.3,-569.1"/>
</g>
</g>
</svg>
