<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: lock_manager_wake_up Pages: 1 -->
<svg width="1534pt" height="680pt"
 viewBox="0.00 0.00 1534.00 679.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 675.5)">
<title>lock_manager_wake_up</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-675.5 1530,-675.5 1530,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ReleasedLock</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M915,-271.5C915,-271.5 1318,-271.5 1318,-271.5 1324,-271.5 1330,-277.5 1330,-283.5 1330,-283.5 1330,-383.5 1330,-383.5 1330,-389.5 1324,-395.5 1318,-395.5 1318,-395.5 915,-395.5 915,-395.5 909,-395.5 903,-389.5 903,-383.5 903,-383.5 903,-283.5 903,-283.5 903,-277.5 909,-271.5 915,-271.5"/>
<text text-anchor="middle" x="1116.5" y="-375.5" font-family="Times,serif" font-size="20.00">ReleasedLock</text>
</g>
<!-- LockManager_wake_up -->
<g id="node1" class="node">
<title>LockManager_wake_up</title>
<path fill="none" stroke="#1c2123" d="M1370,-288C1370,-288 1514,-288 1514,-288 1520,-288 1526,-294 1526,-300 1526,-300 1526,-337 1526,-337 1526,-343 1520,-349 1514,-349 1514,-349 1370,-349 1370,-349 1364,-349 1358,-343 1358,-337 1358,-337 1358,-300 1358,-300 1358,-294 1364,-288 1370,-288"/>
<text text-anchor="middle" x="1442" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockManager::wake_up</text>
<polyline fill="none" stroke="#1c2123" points="1358,-326 1526,-326 "/>
<text text-anchor="start" x="1366" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">唤醒lock.hash等待队列中</text>
<text text-anchor="start" x="1366" y="-295.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的第一个waiter</text>
</g>
<!-- ReleasedLocks_push -->
<g id="node2" class="node">
<title>ReleasedLocks_push</title>
<path fill="none" stroke="#1c2123" d="M923,-296C923,-296 1050,-296 1050,-296 1056,-296 1062,-302 1062,-308 1062,-308 1062,-345 1062,-345 1062,-351 1056,-357 1050,-357 1050,-357 923,-357 923,-357 917,-357 911,-351 911,-345 911,-345 911,-308 911,-308 911,-302 917,-296 923,-296"/>
<text text-anchor="start" x="919" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">push</text>
<polyline fill="none" stroke="#1c2123" points="911,-334 1062,-334 "/>
<text text-anchor="start" x="919" y="-318.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">hashes.push(lock.hash)</text>
<text text-anchor="start" x="919" y="-303.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将lock.hash数组hashes</text>
</g>
<!-- ReleasedLocks_wake_up -->
<g id="node3" class="node">
<title>ReleasedLocks_wake_up</title>
<path fill="none" stroke="#1c2123" d="M1110,-280.5C1110,-280.5 1310,-280.5 1310,-280.5 1316,-280.5 1322,-286.5 1322,-292.5 1322,-292.5 1322,-344.5 1322,-344.5 1322,-350.5 1316,-356.5 1310,-356.5 1310,-356.5 1110,-356.5 1110,-356.5 1104,-356.5 1098,-350.5 1098,-344.5 1098,-344.5 1098,-292.5 1098,-292.5 1098,-286.5 1104,-280.5 1110,-280.5"/>
<text text-anchor="start" x="1106" y="-341.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wake_up</text>
<polyline fill="none" stroke="#1c2123" points="1098,-333.5 1322,-333.5 "/>
<text text-anchor="start" x="1106" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将start_ts, hashes</text>
<text text-anchor="start" x="1106" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit_ts, pessimistic</text>
<text text-anchor="start" x="1106" y="-288.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等参数传给LockManager::wake_up</text>
</g>
<!-- ReleasedLocks_push&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge1" class="edge">
<title>ReleasedLocks_push&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1062.18,-323.8C1070.4,-323.51 1078.91,-323.2 1087.51,-322.89"/>
<polygon fill="green" stroke="green" points="1087.76,-326.38 1097.63,-322.52 1087.51,-319.39 1087.76,-326.38"/>
</g>
<!-- ReleasedLocks_wake_up&#45;&gt;LockManager_wake_up -->
<g id="edge13" class="edge">
<title>ReleasedLocks_wake_up&#45;&gt;LockManager_wake_up</title>
<path fill="none" stroke="#666666" d="M1322.29,-318.5C1330.77,-318.5 1339.28,-318.5 1347.62,-318.5"/>
<polygon fill="#666666" stroke="#666666" points="1347.72,-322 1357.72,-318.5 1347.72,-315 1347.72,-322"/>
</g>
<!-- Command_process_write -->
<g id="node4" class="node">
<title>Command_process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-260.5C12,-260.5 80,-260.5 80,-260.5 86,-260.5 92,-266.5 92,-272.5 92,-272.5 92,-294.5 92,-294.5 92,-300.5 86,-306.5 80,-306.5 80,-306.5 12,-306.5 12,-306.5 6,-306.5 0,-300.5 0,-294.5 0,-294.5 0,-272.5 0,-272.5 0,-266.5 6,-260.5 12,-260.5"/>
<text text-anchor="start" x="8" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Command</text>
<polyline fill="none" stroke="#1c2123" points="0,-283.5 92,-283.5 "/>
<text text-anchor="middle" x="46" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Cleanup_process_write -->
<g id="node5" class="node">
<title>Cleanup_process_write</title>
<path fill="none" stroke="#1c2123" d="M177.5,-65.5C177.5,-65.5 245.5,-65.5 245.5,-65.5 251.5,-65.5 257.5,-71.5 257.5,-77.5 257.5,-77.5 257.5,-99.5 257.5,-99.5 257.5,-105.5 251.5,-111.5 245.5,-111.5 245.5,-111.5 177.5,-111.5 177.5,-111.5 171.5,-111.5 165.5,-105.5 165.5,-99.5 165.5,-99.5 165.5,-77.5 165.5,-77.5 165.5,-71.5 171.5,-65.5 177.5,-65.5"/>
<text text-anchor="start" x="173.5" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Cleanup</text>
<polyline fill="none" stroke="#1c2123" points="165.5,-88.5 257.5,-88.5 "/>
<text text-anchor="start" x="173.5" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;Cleanup_process_write -->
<g id="edge2" class="edge">
<title>Command_process_write&#45;&gt;Cleanup_process_write</title>
<path fill="none" stroke="#666666" d="M52.83,-260.43C62.71,-225.78 85.89,-160.25 128,-121.5 136,-114.14 145.84,-108.34 155.9,-103.78"/>
<polygon fill="#666666" stroke="#666666" points="157.27,-107.01 165.16,-99.95 154.59,-100.54 157.27,-107.01"/>
</g>
<!-- CheckSecondaryLocks_process_write -->
<g id="node6" class="node">
<title>CheckSecondaryLocks_process_write</title>
<path fill="none" stroke="#1c2123" d="M511,-580C511,-580 644,-580 644,-580 650,-580 656,-586 656,-592 656,-592 656,-659 656,-659 656,-665 650,-671 644,-671 644,-671 511,-671 511,-671 505,-671 499,-665 499,-659 499,-659 499,-592 499,-592 499,-586 505,-580 511,-580"/>
<text text-anchor="start" x="507" y="-655.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks</text>
<polyline fill="none" stroke="#1c2123" points="499,-648 656,-648 "/>
<text text-anchor="start" x="507" y="-632.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
<text text-anchor="start" x="507" y="-617.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果是悲观锁</text>
<text text-anchor="start" x="507" y="-602.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 且lock.ts == self.start_ts</text>
<text text-anchor="start" x="507" y="-587.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则释放锁？</text>
</g>
<!-- Command_process_write&#45;&gt;CheckSecondaryLocks_process_write -->
<g id="edge3" class="edge">
<title>Command_process_write&#45;&gt;CheckSecondaryLocks_process_write</title>
<path fill="none" stroke="#666666" d="M50.34,-306.78C57.36,-347.23 77.39,-430.63 128,-477.5 228.77,-570.81 389.67,-605.38 488.88,-618.12"/>
<polygon fill="#666666" stroke="#666666" points="488.53,-621.61 498.88,-619.36 489.39,-614.66 488.53,-621.61"/>
</g>
<!-- PessimisticLockRollback_process_write -->
<g id="node7" class="node">
<title>PessimisticLockRollback_process_write</title>
<path fill="none" stroke="#1c2123" d="M512,-388C512,-388 643,-388 643,-388 649,-388 655,-394 655,-400 655,-400 655,-445 655,-445 655,-451 649,-457 643,-457 643,-457 512,-457 512,-457 506,-457 500,-451 500,-445 500,-445 500,-400 500,-400 500,-394 506,-388 512,-388"/>
<text text-anchor="start" x="508" y="-441.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PessimisticLockRollback</text>
<polyline fill="none" stroke="#1c2123" points="500,-434 655,-434 "/>
<text text-anchor="start" x="508" y="-418.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
<polyline fill="none" stroke="#1c2123" points="500,-411 655,-411 "/>
<text text-anchor="start" x="508" y="-395.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">释放掉悲观锁</text>
</g>
<!-- Command_process_write&#45;&gt;PessimisticLockRollback_process_write -->
<g id="edge4" class="edge">
<title>Command_process_write&#45;&gt;PessimisticLockRollback_process_write</title>
<path fill="none" stroke="#666666" d="M56.33,-306.96C68.41,-333.88 92.27,-376.82 128,-396.5 188.04,-429.57 377.05,-429.48 489.64,-426.18"/>
<polygon fill="#666666" stroke="#666666" points="490.06,-429.67 499.95,-425.87 489.85,-422.68 490.06,-429.67"/>
</g>
<!-- ResolveLockLite_process_write -->
<g id="node8" class="node">
<title>ResolveLockLite_process_write</title>
<path fill="none" stroke="#1c2123" d="M168.5,-195.5C168.5,-195.5 254.5,-195.5 254.5,-195.5 260.5,-195.5 266.5,-201.5 266.5,-207.5 266.5,-207.5 266.5,-229.5 266.5,-229.5 266.5,-235.5 260.5,-241.5 254.5,-241.5 254.5,-241.5 168.5,-241.5 168.5,-241.5 162.5,-241.5 156.5,-235.5 156.5,-229.5 156.5,-229.5 156.5,-207.5 156.5,-207.5 156.5,-201.5 162.5,-195.5 168.5,-195.5"/>
<text text-anchor="start" x="164.5" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLockLite</text>
<polyline fill="none" stroke="#1c2123" points="156.5,-218.5 266.5,-218.5 "/>
<text text-anchor="start" x="164.5" y="-203.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;ResolveLockLite_process_write -->
<g id="edge5" class="edge">
<title>Command_process_write&#45;&gt;ResolveLockLite_process_write</title>
<path fill="none" stroke="#666666" d="M92.11,-265.57C109.01,-258.85 128.55,-251.08 146.82,-243.82"/>
<polygon fill="#666666" stroke="#666666" points="148.24,-247.02 156.24,-240.07 145.65,-240.51 148.24,-247.02"/>
</g>
<!-- ResolveLock_process_write -->
<g id="node9" class="node">
<title>ResolveLock_process_write</title>
<path fill="none" stroke="#1c2123" d="M177.5,-260.5C177.5,-260.5 245.5,-260.5 245.5,-260.5 251.5,-260.5 257.5,-266.5 257.5,-272.5 257.5,-272.5 257.5,-294.5 257.5,-294.5 257.5,-300.5 251.5,-306.5 245.5,-306.5 245.5,-306.5 177.5,-306.5 177.5,-306.5 171.5,-306.5 165.5,-300.5 165.5,-294.5 165.5,-294.5 165.5,-272.5 165.5,-272.5 165.5,-266.5 171.5,-260.5 177.5,-260.5"/>
<text text-anchor="start" x="173.5" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLock</text>
<polyline fill="none" stroke="#1c2123" points="165.5,-283.5 257.5,-283.5 "/>
<text text-anchor="start" x="173.5" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;ResolveLock_process_write -->
<g id="edge6" class="edge">
<title>Command_process_write&#45;&gt;ResolveLock_process_write</title>
<path fill="none" stroke="#666666" d="M92.11,-283.5C111.6,-283.5 134.59,-283.5 155.1,-283.5"/>
<polygon fill="#666666" stroke="#666666" points="155.25,-287 165.25,-283.5 155.25,-280 155.25,-287"/>
</g>
<!-- Rollback_process_write -->
<g id="node10" class="node">
<title>Rollback_process_write</title>
<path fill="none" stroke="#1c2123" d="M177.5,-0.5C177.5,-0.5 245.5,-0.5 245.5,-0.5 251.5,-0.5 257.5,-6.5 257.5,-12.5 257.5,-12.5 257.5,-34.5 257.5,-34.5 257.5,-40.5 251.5,-46.5 245.5,-46.5 245.5,-46.5 177.5,-46.5 177.5,-46.5 171.5,-46.5 165.5,-40.5 165.5,-34.5 165.5,-34.5 165.5,-12.5 165.5,-12.5 165.5,-6.5 171.5,-0.5 177.5,-0.5"/>
<text text-anchor="start" x="173.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Rollback</text>
<polyline fill="none" stroke="#1c2123" points="165.5,-23.5 257.5,-23.5 "/>
<text text-anchor="start" x="173.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;Rollback_process_write -->
<g id="edge7" class="edge">
<title>Command_process_write&#45;&gt;Rollback_process_write</title>
<path fill="none" stroke="#666666" d="M48.92,-260.49C53.89,-215.26 71.06,-114.1 128,-55.5 135.71,-47.57 145.6,-41.57 155.84,-37.04"/>
<polygon fill="#666666" stroke="#666666" points="157.29,-40.23 165.29,-33.28 154.71,-33.73 157.29,-40.23"/>
</g>
<!-- Commit_process_write -->
<g id="node11" class="node">
<title>Commit_process_write</title>
<path fill="none" stroke="#1c2123" d="M177.5,-130.5C177.5,-130.5 245.5,-130.5 245.5,-130.5 251.5,-130.5 257.5,-136.5 257.5,-142.5 257.5,-142.5 257.5,-164.5 257.5,-164.5 257.5,-170.5 251.5,-176.5 245.5,-176.5 245.5,-176.5 177.5,-176.5 177.5,-176.5 171.5,-176.5 165.5,-170.5 165.5,-164.5 165.5,-164.5 165.5,-142.5 165.5,-142.5 165.5,-136.5 171.5,-130.5 177.5,-130.5"/>
<text text-anchor="start" x="173.5" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commit</text>
<polyline fill="none" stroke="#1c2123" points="165.5,-153.5 257.5,-153.5 "/>
<text text-anchor="start" x="173.5" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;Commit_process_write -->
<g id="edge8" class="edge">
<title>Command_process_write&#45;&gt;Commit_process_write</title>
<path fill="none" stroke="#666666" d="M61.46,-260.28C75.97,-238.63 100.12,-206.73 128,-186.5 136.42,-180.39 146.13,-175.21 155.87,-170.89"/>
<polygon fill="#666666" stroke="#666666" points="157.28,-174.09 165.17,-167.01 154.59,-167.63 157.28,-174.09"/>
</g>
<!-- PreWriter_process_write -->
<g id="node12" class="node">
<title>PreWriter_process_write</title>
<path fill="none" stroke="#1c2123" d="M140,-326C140,-326 283,-326 283,-326 289,-326 295,-332 295,-338 295,-338 295,-375 295,-375 295,-381 289,-387 283,-387 283,-387 140,-387 140,-387 134,-387 128,-381 128,-375 128,-375 128,-338 128,-338 128,-332 134,-326 140,-326"/>
<text text-anchor="start" x="136" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PreWriter</text>
<polyline fill="none" stroke="#1c2123" points="128,-364 295,-364 "/>
<text text-anchor="start" x="136" y="-348.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
<text text-anchor="start" x="136" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1pc 提交完后会释放lock</text>
</g>
<!-- Command_process_write&#45;&gt;PreWriter_process_write -->
<g id="edge9" class="edge">
<title>Command_process_write&#45;&gt;PreWriter_process_write</title>
<path fill="none" stroke="#666666" d="M92.11,-303.64C104.63,-309.23 118.59,-315.46 132.41,-321.64"/>
<polygon fill="#666666" stroke="#666666" points="131.38,-325.01 141.94,-325.89 134.24,-318.62 131.38,-325.01"/>
</g>
<!-- CheckTxnStatus_process_write -->
<g id="node13" class="node">
<title>CheckTxnStatus_process_write</title>
<path fill="none" stroke="#1c2123" d="M350.5,-476.5C350.5,-476.5 432.5,-476.5 432.5,-476.5 438.5,-476.5 444.5,-482.5 444.5,-488.5 444.5,-488.5 444.5,-510.5 444.5,-510.5 444.5,-516.5 438.5,-522.5 432.5,-522.5 432.5,-522.5 350.5,-522.5 350.5,-522.5 344.5,-522.5 338.5,-516.5 338.5,-510.5 338.5,-510.5 338.5,-488.5 338.5,-488.5 338.5,-482.5 344.5,-476.5 350.5,-476.5"/>
<text text-anchor="start" x="346.5" y="-507.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus</text>
<polyline fill="none" stroke="#1c2123" points="338.5,-499.5 444.5,-499.5 "/>
<text text-anchor="start" x="346.5" y="-484.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- Command_process_write&#45;&gt;CheckTxnStatus_process_write -->
<g id="edge10" class="edge">
<title>Command_process_write&#45;&gt;CheckTxnStatus_process_write</title>
<path fill="none" stroke="#666666" d="M53.06,-306.66C62.99,-339.92 85.95,-400.8 128,-433.5 185.91,-478.54 270.82,-493.19 328.26,-497.77"/>
<polygon fill="#666666" stroke="#666666" points="328.07,-501.26 338.29,-498.49 328.57,-494.28 328.07,-501.26"/>
</g>
<!-- Cleanup_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge18" class="edge">
<title>Cleanup_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M257.53,-83C326.22,-75.11 461.33,-61.5 576.5,-61.5 576.5,-61.5 576.5,-61.5 790,-61.5 911.83,-61.5 958.53,-31.18 1062,-95.5 1127.62,-136.29 1170.1,-218.46 1191.75,-270.86"/>
<polygon fill="#666666" stroke="#666666" points="1188.57,-272.31 1195.56,-280.28 1195.06,-269.69 1188.57,-272.31"/>
</g>
<!-- cleanup -->
<g id="node17" class="node">
<title>cleanup</title>
<path fill="none" stroke="#1c2123" d="M409,-201.5C409,-201.5 374,-201.5 374,-201.5 368,-201.5 362,-195.5 362,-189.5 362,-189.5 362,-177.5 362,-177.5 362,-171.5 368,-165.5 374,-165.5 374,-165.5 409,-165.5 409,-165.5 415,-165.5 421,-171.5 421,-177.5 421,-177.5 421,-189.5 421,-189.5 421,-195.5 415,-201.5 409,-201.5"/>
<text text-anchor="middle" x="391.5" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleanup</text>
</g>
<!-- Cleanup_process_write&#45;&gt;cleanup -->
<g id="edge19" class="edge">
<title>Cleanup_process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M257.74,-104.75C270.05,-109.67 283.22,-115.4 295,-121.5 316.42,-132.6 339.12,-147.21 357.01,-159.45"/>
<polygon fill="#666666" stroke="#666666" points="355.17,-162.43 365.38,-165.25 359.15,-156.68 355.17,-162.43"/>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge14" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M656.3,-635.64C758.16,-644.78 938.26,-646.34 1062,-565.5 1133.48,-518.8 1175.08,-424.19 1194.81,-366.57"/>
<polygon fill="#666666" stroke="#666666" points="1198.17,-367.55 1198.01,-356.96 1191.53,-365.34 1198.17,-367.55"/>
</g>
<!-- MvccTxn_unlock_key -->
<g id="node14" class="node">
<title>MvccTxn_unlock_key</title>
<path fill="none" stroke="#1c2123" d="M715,-321C715,-321 863,-321 863,-321 869,-321 875,-327 875,-333 875,-333 875,-370 875,-370 875,-376 869,-382 863,-382 863,-382 715,-382 715,-382 709,-382 703,-376 703,-370 703,-370 703,-333 703,-333 703,-327 709,-321 715,-321"/>
<text text-anchor="start" x="711" y="-366.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<polyline fill="none" stroke="#1c2123" points="703,-359 875,-359 "/>
<text text-anchor="start" x="711" y="-343.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">unlock_key 删掉store中key</text>
<text text-anchor="start" x="711" y="-328.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应的lock</text>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;MvccTxn_unlock_key -->
<g id="edge15" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M625.15,-579.61C639.15,-565.02 654.19,-548.51 667,-532.5 704.17,-486.05 741.37,-428.31 764.51,-390.71"/>
<polygon fill="#666666" stroke="#666666" points="767.57,-392.43 769.8,-382.07 761.6,-388.77 767.57,-392.43"/>
</g>
<!-- PessimisticLockRollback_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge23" class="edge">
<title>PessimisticLockRollback_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M655.16,-418.78C751.24,-412.95 920.5,-398.78 1062,-366.5 1071.23,-364.4 1080.7,-361.96 1090.18,-359.32"/>
<polygon fill="#666666" stroke="#666666" points="1091.39,-362.62 1100.05,-356.51 1089.47,-355.89 1091.39,-362.62"/>
</g>
<!-- PessimisticLockRollback_process_write&#45;&gt;MvccTxn_unlock_key -->
<g id="edge24" class="edge">
<title>PessimisticLockRollback_process_write&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M655.02,-396.57C667.41,-392.37 680.37,-387.98 693.13,-383.65"/>
<polygon fill="#666666" stroke="#666666" points="694.49,-386.89 702.84,-380.36 692.24,-380.26 694.49,-386.89"/>
</g>
<!-- ResolveLockLite_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge31" class="edge">
<title>ResolveLockLite_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M266.5,-200.47C276.25,-196.41 286.13,-191.72 295,-186.5 312.94,-175.93 311.71,-164.34 331,-156.5 432.39,-115.3 467.06,-137.5 576.5,-137.5 576.5,-137.5 576.5,-137.5 790,-137.5 927.81,-137.5 1071.75,-221.03 1149.89,-274.6"/>
<polygon fill="#666666" stroke="#666666" points="1147.96,-277.52 1158.17,-280.34 1151.94,-271.77 1147.96,-277.52"/>
</g>
<!-- ResolveLockLite_process_write&#45;&gt;cleanup -->
<g id="edge32" class="edge">
<title>ResolveLockLite_process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M266.87,-207.81C294.25,-202.43 326.8,-196.03 351.63,-191.14"/>
<polygon fill="#666666" stroke="#666666" points="352.62,-194.51 361.76,-189.15 351.27,-187.65 352.62,-194.51"/>
</g>
<!-- commit -->
<g id="node18" class="node">
<title>commit</title>
<path fill="none" stroke="#1c2123" d="M409,-255.5C409,-255.5 374,-255.5 374,-255.5 368,-255.5 362,-249.5 362,-243.5 362,-243.5 362,-231.5 362,-231.5 362,-225.5 368,-219.5 374,-219.5 374,-219.5 409,-219.5 409,-219.5 415,-219.5 421,-225.5 421,-231.5 421,-231.5 421,-243.5 421,-243.5 421,-249.5 415,-255.5 409,-255.5"/>
<text text-anchor="middle" x="391.5" y="-233.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit</text>
</g>
<!-- ResolveLockLite_process_write&#45;&gt;commit -->
<g id="edge33" class="edge">
<title>ResolveLockLite_process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M266.87,-224.3C294.25,-227.23 326.8,-230.7 351.63,-233.35"/>
<polygon fill="#666666" stroke="#666666" points="351.44,-236.85 361.76,-234.43 352.19,-229.89 351.44,-236.85"/>
</g>
<!-- ResolveLock_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge28" class="edge">
<title>ResolveLock_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M257.51,-280.66C409.81,-271.4 905.03,-244.03 1062,-269.5 1074.15,-271.47 1086.66,-274.31 1099,-277.63"/>
<polygon fill="#666666" stroke="#666666" points="1098.28,-281.06 1108.86,-280.39 1100.17,-274.32 1098.28,-281.06"/>
</g>
<!-- ResolveLock_process_write&#45;&gt;cleanup -->
<g id="edge29" class="edge">
<title>ResolveLock_process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M257.71,-270.42C270.41,-265.59 283.79,-259.33 295,-251.5 314.87,-237.61 311.52,-224.95 331,-210.5 337.53,-205.65 345.08,-201.4 352.55,-197.8"/>
<polygon fill="#666666" stroke="#666666" points="354.23,-200.88 361.9,-193.57 351.35,-194.5 354.23,-200.88"/>
</g>
<!-- ResolveLock_process_write&#45;&gt;commit -->
<g id="edge30" class="edge">
<title>ResolveLock_process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M257.88,-271.77C287.05,-264.23 324.53,-254.55 352.2,-247.4"/>
<polygon fill="#666666" stroke="#666666" points="353.11,-250.78 361.92,-244.89 351.36,-244 353.11,-250.78"/>
</g>
<!-- Rollback_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge34" class="edge">
<title>Rollback_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M257.61,-23.5C326.4,-23.5 461.64,-23.5 576.5,-23.5 576.5,-23.5 576.5,-23.5 790,-23.5 911.48,-23.5 960.65,16.48 1062,-50.5 1139.37,-101.64 1179.61,-207.86 1197.36,-270.12"/>
<polygon fill="#666666" stroke="#666666" points="1194.08,-271.39 1200.12,-280.09 1200.83,-269.52 1194.08,-271.39"/>
</g>
<!-- Rollback_process_write&#45;&gt;cleanup -->
<g id="edge35" class="edge">
<title>Rollback_process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M257.69,-35.86C270.53,-40.69 283.99,-47.13 295,-55.5 331.09,-82.93 360.04,-127.54 376.25,-156.19"/>
<polygon fill="#666666" stroke="#666666" points="373.35,-158.19 381.24,-165.25 379.48,-154.81 373.35,-158.19"/>
</g>
<!-- Commit_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge20" class="edge">
<title>Commit_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M257.58,-142.44C326.04,-126.64 460.55,-99.5 576.5,-99.5 576.5,-99.5 576.5,-99.5 790,-99.5 913.08,-99.5 955.13,-90.46 1062,-151.5 1112.67,-180.44 1154.73,-233.38 1180.7,-271.92"/>
<polygon fill="#666666" stroke="#666666" points="1177.87,-273.99 1186.31,-280.4 1183.71,-270.13 1177.87,-273.99"/>
</g>
<!-- Commit_process_write&#45;&gt;commit -->
<g id="edge21" class="edge">
<title>Commit_process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M257.79,-169.66C270.1,-174.57 283.26,-180.32 295,-186.5 312.02,-195.45 314.19,-201.16 331,-210.5 337.9,-214.33 345.45,-218.08 352.78,-221.5"/>
<polygon fill="#666666" stroke="#666666" points="351.34,-224.69 361.89,-225.64 354.24,-218.32 351.34,-224.69"/>
</g>
<!-- one_pc_commit_ts -->
<g id="node15" class="node">
<title>one_pc_commit_ts</title>
<path fill="none" stroke="#1c2123" d="M440,-369.5C440,-369.5 343,-369.5 343,-369.5 337,-369.5 331,-363.5 331,-357.5 331,-357.5 331,-345.5 331,-345.5 331,-339.5 337,-333.5 343,-333.5 343,-333.5 440,-333.5 440,-333.5 446,-333.5 452,-339.5 452,-345.5 452,-345.5 452,-357.5 452,-357.5 452,-363.5 446,-369.5 440,-369.5"/>
<text text-anchor="middle" x="391.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">one_pc_commit_ts</text>
</g>
<!-- PreWriter_process_write&#45;&gt;one_pc_commit_ts -->
<g id="edge11" class="edge">
<title>PreWriter_process_write&#45;&gt;one_pc_commit_ts</title>
<path fill="none" stroke="#666666" d="M295.25,-354.18C303.77,-353.94 312.36,-353.69 320.72,-353.46"/>
<polygon fill="#666666" stroke="#666666" points="320.88,-356.96 330.78,-353.18 320.69,-349.96 320.88,-356.96"/>
</g>
<!-- CheckTxnStatus_process_write&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge16" class="edge">
<title>CheckTxnStatus_process_write&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M444.72,-521.04C458.55,-525.77 473.64,-530.09 488,-532.5 566.46,-545.67 588.58,-545.9 667,-532.5 840.27,-502.9 1028.02,-414.9 1130.77,-361.41"/>
<polygon fill="#666666" stroke="#666666" points="1132.6,-364.4 1139.84,-356.66 1129.36,-358.2 1132.6,-364.4"/>
</g>
<!-- check_txn_status_lock_exists -->
<g id="node16" class="node">
<title>check_txn_status_lock_exists</title>
<path fill="none" stroke="#1c2123" d="M500,-476.5C500,-476.5 655,-476.5 655,-476.5 661,-476.5 667,-482.5 667,-488.5 667,-488.5 667,-510.5 667,-510.5 667,-516.5 661,-522.5 655,-522.5 655,-522.5 500,-522.5 500,-522.5 494,-522.5 488,-516.5 488,-510.5 488,-510.5 488,-488.5 488,-488.5 488,-482.5 494,-476.5 500,-476.5"/>
<text text-anchor="middle" x="577.5" y="-507.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_txn_status_lock_exists</text>
<polyline fill="none" stroke="#1c2123" points="488,-499.5 667,-499.5 "/>
<text text-anchor="start" x="496" y="-484.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果lock TtlExpire 释放lock</text>
</g>
<!-- CheckTxnStatus_process_write&#45;&gt;check_txn_status_lock_exists -->
<g id="edge17" class="edge">
<title>CheckTxnStatus_process_write&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="#666666" d="M444.73,-499.5C455.17,-499.5 466.45,-499.5 477.87,-499.5"/>
<polygon fill="#666666" stroke="#666666" points="477.92,-503 487.92,-499.5 477.92,-496 477.92,-503"/>
</g>
<!-- MvccTxn_unlock_key&#45;&gt;ReleasedLocks_push -->
<g id="edge22" class="edge">
<title>MvccTxn_unlock_key&#45;&gt;ReleasedLocks_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M875.18,-340.61C883.59,-339.53 892.13,-338.44 900.54,-337.36"/>
<polygon fill="green" stroke="green" points="901.25,-340.8 910.72,-336.06 900.36,-333.86 901.25,-340.8"/>
</g>
<!-- one_pc_commit_ts&#45;&gt;ReleasedLocks_wake_up -->
<g id="edge25" class="edge">
<title>one_pc_commit_ts&#45;&gt;ReleasedLocks_wake_up</title>
<path fill="none" stroke="#666666" d="M449.67,-333.49C462.2,-330.06 475.46,-326.83 488,-324.5 739.38,-277.87 807.8,-259.15 1062,-286.5 1070.49,-287.41 1079.21,-288.62 1087.96,-290.02"/>
<polygon fill="#666666" stroke="#666666" points="1087.4,-293.47 1097.85,-291.68 1088.57,-286.57 1087.4,-293.47"/>
</g>
<!-- handle_1pc_locks -->
<g id="node19" class="node">
<title>handle_1pc_locks</title>
<path fill="none" stroke="#1c2123" d="M622.5,-369.5C622.5,-369.5 532.5,-369.5 532.5,-369.5 526.5,-369.5 520.5,-363.5 520.5,-357.5 520.5,-357.5 520.5,-345.5 520.5,-345.5 520.5,-339.5 526.5,-333.5 532.5,-333.5 532.5,-333.5 622.5,-333.5 622.5,-333.5 628.5,-333.5 634.5,-339.5 634.5,-345.5 634.5,-345.5 634.5,-357.5 634.5,-357.5 634.5,-363.5 628.5,-369.5 622.5,-369.5"/>
<text text-anchor="middle" x="577.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_1pc_locks</text>
</g>
<!-- one_pc_commit_ts&#45;&gt;handle_1pc_locks -->
<g id="edge26" class="edge">
<title>one_pc_commit_ts&#45;&gt;handle_1pc_locks</title>
<path fill="none" stroke="#666666" d="M452.24,-351.5C470.83,-351.5 491.43,-351.5 510.43,-351.5"/>
<polygon fill="#666666" stroke="#666666" points="510.49,-355 520.49,-351.5 510.49,-348 510.49,-355"/>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;MvccTxn_unlock_key -->
<g id="edge12" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M648.85,-476.31C655.15,-473.33 661.3,-470.06 667,-466.5 700.52,-445.56 732.67,-414.29 755.39,-389.64"/>
<polygon fill="#666666" stroke="#666666" points="758,-391.97 762.13,-382.22 752.82,-387.27 758,-391.97"/>
</g>
<!-- rollback_lock -->
<g id="node20" class="node">
<title>rollback_lock</title>
<path fill="none" stroke="#1c2123" d="M611,-201.5C611,-201.5 544,-201.5 544,-201.5 538,-201.5 532,-195.5 532,-189.5 532,-189.5 532,-177.5 532,-177.5 532,-171.5 538,-165.5 544,-165.5 544,-165.5 611,-165.5 611,-165.5 617,-165.5 623,-171.5 623,-177.5 623,-177.5 623,-189.5 623,-189.5 623,-195.5 617,-201.5 611,-201.5"/>
<text text-anchor="middle" x="577.5" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_lock</text>
</g>
<!-- cleanup&#45;&gt;rollback_lock -->
<g id="edge36" class="edge">
<title>cleanup&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M421.25,-183.5C447.97,-183.5 488.49,-183.5 521.44,-183.5"/>
<polygon fill="#666666" stroke="#666666" points="521.84,-187 531.84,-183.5 521.84,-180 521.84,-187"/>
</g>
<!-- commit&#45;&gt;MvccTxn_unlock_key -->
<g id="edge38" class="edge">
<title>commit&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M421.26,-245.79C477.55,-262.01 604.47,-298.6 693.14,-324.16"/>
<polygon fill="#666666" stroke="#666666" points="692.37,-327.58 702.95,-326.98 694.31,-320.85 692.37,-327.58"/>
</g>
<!-- handle_1pc_locks&#45;&gt;MvccTxn_unlock_key -->
<g id="edge27" class="edge">
<title>handle_1pc_locks&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M634.64,-351.5C652.58,-351.5 672.96,-351.5 692.87,-351.5"/>
<polygon fill="#666666" stroke="#666666" points="692.91,-355 702.91,-351.5 692.91,-348 692.91,-355"/>
</g>
<!-- rollback_lock&#45;&gt;MvccTxn_unlock_key -->
<g id="edge37" class="edge">
<title>rollback_lock&#45;&gt;MvccTxn_unlock_key</title>
<path fill="none" stroke="#666666" d="M601.32,-201.8C634.86,-228.7 698.21,-279.5 741.74,-314.4"/>
<polygon fill="#666666" stroke="#666666" points="739.63,-317.2 749.62,-320.72 744.01,-311.74 739.63,-317.2"/>
</g>
</g>
</svg>
