<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: mvcc_reader_seek_write Pages: 1 -->
<svg width="1469pt" height="408pt"
 viewBox="0.00 0.00 1469.00 408.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 404)">
<title>mvcc_reader_seek_write</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-404 1465,-404 1465,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_Cursor</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M676,-102C676,-102 926.5,-102 926.5,-102 932.5,-102 938.5,-108 938.5,-114 938.5,-114 938.5,-238 938.5,-238 938.5,-244 932.5,-250 926.5,-250 926.5,-250 676,-250 676,-250 670,-250 664,-244 664,-238 664,-238 664,-114 664,-114 664,-108 670,-102 676,-102"/>
<text text-anchor="middle" x="801.25" y="-230" font-family="Times,serif" font-size="20.00">Cursor</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_WriteRef</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1018.5,-8C1018.5,-8 1441,-8 1441,-8 1447,-8 1453,-14 1453,-20 1453,-20 1453,-182 1453,-182 1453,-188 1447,-194 1441,-194 1441,-194 1018.5,-194 1018.5,-194 1012.5,-194 1006.5,-188 1006.5,-182 1006.5,-182 1006.5,-20 1006.5,-20 1006.5,-14 1012.5,-8 1018.5,-8"/>
<text text-anchor="middle" x="1229.75" y="-174" font-family="Times,serif" font-size="20.00">WriteRef</text>
</g>
<!-- near_seek -->
<g id="node1" class="node">
<title>near_seek</title>
<path fill="none" stroke="#1c2123" d="M684,-111C684,-111 791,-111 791,-111 797,-111 803,-117 803,-123 803,-123 803,-145 803,-145 803,-151 797,-157 791,-157 791,-157 684,-157 684,-157 678,-157 672,-151 672,-145 672,-145 672,-123 672,-123 672,-117 678,-111 684,-111"/>
<text text-anchor="middle" x="737.5" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">near_seek</text>
<polyline fill="none" stroke="#1c2123" points="672,-134 803,-134 "/>
<text text-anchor="start" x="680" y="-118.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Seek the specific key</text>
</g>
<!-- value -->
<g id="node3" class="node">
<title>value</title>
<path fill="none" stroke="#1c2123" d="M918.5,-146C918.5,-146 888.5,-146 888.5,-146 882.5,-146 876.5,-140 876.5,-134 876.5,-134 876.5,-122 876.5,-122 876.5,-116 882.5,-110 888.5,-110 888.5,-110 918.5,-110 918.5,-110 924.5,-110 930.5,-116 930.5,-122 930.5,-122 930.5,-134 930.5,-134 930.5,-140 924.5,-146 918.5,-146"/>
<text text-anchor="middle" x="903.5" y="-124.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">value</text>
</g>
<!-- near_seek&#45;&gt;value -->
<g id="edge11" class="edge">
<title>near_seek&#45;&gt;value</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M803.32,-131.63C824.67,-130.85 847.66,-130.01 866.11,-129.33"/>
<polygon fill="green" stroke="green" points="866.27,-132.83 876.14,-128.96 866.02,-125.83 866.27,-132.83"/>
</g>
<!-- key -->
<g id="node2" class="node">
<title>key</title>
<path fill="none" stroke="#1c2123" d="M752.5,-212C752.5,-212 722.5,-212 722.5,-212 716.5,-212 710.5,-206 710.5,-200 710.5,-200 710.5,-188 710.5,-188 710.5,-182 716.5,-176 722.5,-176 722.5,-176 752.5,-176 752.5,-176 758.5,-176 764.5,-182 764.5,-188 764.5,-188 764.5,-200 764.5,-200 764.5,-206 758.5,-212 752.5,-212"/>
<text text-anchor="middle" x="737.5" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key</text>
</g>
<!-- decode_ts_from -->
<g id="node9" class="node">
<title>decode_ts_from</title>
<path fill="none" stroke="#1c2123" d="M860.5,-338.5C860.5,-338.5 946.5,-338.5 946.5,-338.5 952.5,-338.5 958.5,-344.5 958.5,-350.5 958.5,-350.5 958.5,-387.5 958.5,-387.5 958.5,-393.5 952.5,-399.5 946.5,-399.5 946.5,-399.5 860.5,-399.5 860.5,-399.5 854.5,-399.5 848.5,-393.5 848.5,-387.5 848.5,-387.5 848.5,-350.5 848.5,-350.5 848.5,-344.5 854.5,-338.5 860.5,-338.5"/>
<text text-anchor="middle" x="903.5" y="-384.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">decode_ts_from</text>
<polyline fill="none" stroke="#1c2123" points="848.5,-376.5 958.5,-376.5 "/>
<text text-anchor="start" x="856.5" y="-361.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将ts从{key}{ts}</text>
<text text-anchor="start" x="856.5" y="-346.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 中解析出来</text>
</g>
<!-- key&#45;&gt;decode_ts_from -->
<g id="edge13" class="edge">
<title>key&#45;&gt;decode_ts_from</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M749.05,-212.27C765.64,-239.89 799.96,-292.89 839,-329 840.11,-330.02 841.24,-331.04 842.4,-332.04"/>
<polygon fill="green" stroke="green" points="840.38,-334.9 850.37,-338.45 844.77,-329.45 840.38,-334.9"/>
</g>
<!-- write_key -->
<g id="node11" class="node">
<title>write_key</title>
<path fill="#feed9b" stroke="#f7e495" d="M851,-258.5C851,-258.5 956,-258.5 956,-258.5 962,-258.5 968,-264.5 968,-270.5 968,-270.5 968,-307.5 968,-307.5 968,-313.5 962,-319.5 956,-319.5 956,-319.5 851,-319.5 851,-319.5 845,-319.5 839,-313.5 839,-307.5 839,-307.5 839,-270.5 839,-270.5 839,-264.5 845,-258.5 851,-258.5"/>
<text text-anchor="middle" x="903.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#40575d">write_key</text>
<polyline fill="none" stroke="#f7e495" points="839,-296.5 968,-296.5 "/>
<text text-anchor="start" x="847" y="-281.3" font-family="Times,serif" font-size="14.00" fill="#40575d">包含了ts,格式如下</text>
<text text-anchor="start" x="847" y="-266.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> key ts</text>
</g>
<!-- key&#45;&gt;write_key -->
<g id="edge16" class="edge">
<title>key&#45;&gt;write_key</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M764.8,-210.04C783.18,-221.17 808.54,-236.39 837.88,-253.32"/>
<polygon fill="green" stroke="green" points="836.27,-256.43 846.69,-258.38 839.76,-250.36 836.27,-256.43"/>
</g>
<!-- parse -->
<g id="node4" class="node">
<title>parse</title>
<path fill="none" stroke="#1c2123" d="M1056.5,-104C1056.5,-104 1026.5,-104 1026.5,-104 1020.5,-104 1014.5,-98 1014.5,-92 1014.5,-92 1014.5,-80 1014.5,-80 1014.5,-74 1020.5,-68 1026.5,-68 1026.5,-68 1056.5,-68 1056.5,-68 1062.5,-68 1068.5,-74 1068.5,-80 1068.5,-80 1068.5,-92 1068.5,-92 1068.5,-98 1062.5,-104 1056.5,-104"/>
<text text-anchor="middle" x="1041.5" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">parse</text>
</g>
<!-- value&#45;&gt;parse -->
<g id="edge12" class="edge">
<title>value&#45;&gt;parse</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M930.72,-119.9C951.7,-113.42 981.34,-104.27 1004.53,-97.11"/>
<polygon fill="green" stroke="green" points="1005.84,-100.37 1014.36,-94.07 1003.77,-93.68 1005.84,-100.37"/>
</g>
<!-- WriteRef -->
<g id="node5" class="node">
<title>WriteRef</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M1127,-17C1127,-17 1322,-17 1322,-17 1328,-17 1334,-23 1334,-29 1334,-29 1334,-143 1334,-143 1334,-149 1328,-155 1322,-155 1322,-155 1127,-155 1127,-155 1121,-155 1115,-149 1115,-143 1115,-143 1115,-29 1115,-29 1115,-23 1121,-17 1127,-17"/>
<text text-anchor="middle" x="1224.5" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">WriteRef</text>
<polyline fill="none" stroke="#60b5ac" points="1115,-132 1334,-132 "/>
<text text-anchor="start" x="1123" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub write_type: WriteType,</text>
<polyline fill="none" stroke="#60b5ac" points="1115,-109 1334,-109 "/>
<text text-anchor="start" x="1123" y="-93.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub start_ts: TimeStamp,</text>
<polyline fill="none" stroke="#60b5ac" points="1115,-86 1334,-86 "/>
<text text-anchor="start" x="1123" y="-70.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub short_value: Option&lt;&amp;&#39;a [u8]&gt;,</text>
<polyline fill="none" stroke="#60b5ac" points="1115,-63 1334,-63 "/>
<text text-anchor="start" x="1123" y="-47.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub has_overlapped_rollback: bool,</text>
<polyline fill="none" stroke="#60b5ac" points="1115,-40 1334,-40 "/>
<text text-anchor="start" x="1123" y="-24.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub gc_fence: Option&lt;TimeStamp&gt;,</text>
</g>
<!-- parse&#45;&gt;WriteRef -->
<g id="edge1" class="edge">
<title>parse&#45;&gt;WriteRef</title>
<path fill="none" stroke="#666666" d="M1068.82,-86C1078.98,-86 1091.36,-86 1104.64,-86"/>
<polygon fill="#666666" stroke="#666666" points="1104.96,-89.5 1114.96,-86 1104.96,-82.5 1104.96,-89.5"/>
</g>
<!-- WriteType -->
<g id="node6" class="node">
<title>WriteType</title>
<path fill="none" stroke="#1c2123" d="M1382,-17C1382,-17 1433,-17 1433,-17 1439,-17 1445,-23 1445,-29 1445,-29 1445,-143 1445,-143 1445,-149 1439,-155 1433,-155 1433,-155 1382,-155 1382,-155 1376,-155 1370,-149 1370,-143 1370,-143 1370,-29 1370,-29 1370,-23 1376,-17 1382,-17"/>
<text text-anchor="middle" x="1407.5" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType</text>
<polyline fill="none" stroke="#1c2123" points="1370,-132 1445,-132 "/>
<text text-anchor="start" x="1378" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Put,</text>
<polyline fill="none" stroke="#1c2123" points="1370,-109 1445,-109 "/>
<text text-anchor="start" x="1378" y="-93.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Delete,</text>
<polyline fill="none" stroke="#1c2123" points="1370,-86 1445,-86 "/>
<text text-anchor="start" x="1378" y="-70.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock,</text>
<polyline fill="none" stroke="#1c2123" points="1370,-63 1445,-63 "/>
<text text-anchor="start" x="1378" y="-47.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Rollback,</text>
<polyline fill="none" stroke="#1c2123" points="1370,-40 1445,-40 "/>
<text text-anchor="middle" x="1407.5" y="-24.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
</g>
<!-- WriteRef&#45;&gt;WriteType -->
<g id="edge2" class="edge">
<title>WriteRef&#45;&gt;WriteType</title>
<path fill="none" stroke="#666666" d="M1334.18,-86C1343.06,-86 1351.69,-86 1359.72,-86"/>
<polygon fill="#666666" stroke="#666666" points="1359.89,-89.5 1369.89,-86 1359.89,-82.5 1359.89,-89.5"/>
</g>
<!-- seek_write -->
<g id="node7" class="node">
<title>seek_write</title>
<path fill="none" stroke="#1c2123" d="M12,-109.5C12,-109.5 282,-109.5 282,-109.5 288,-109.5 294,-115.5 294,-121.5 294,-121.5 294,-196.5 294,-196.5 294,-202.5 288,-208.5 282,-208.5 282,-208.5 12,-208.5 12,-208.5 6,-208.5 0,-202.5 0,-196.5 0,-196.5 0,-121.5 0,-121.5 0,-115.5 6,-109.5 12,-109.5"/>
<text text-anchor="middle" x="147" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">seek_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-185.5 294,-185.5 "/>
<text text-anchor="start" x="8" y="-170.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">seek_write(&amp;mut self, key: &amp;Key, ts: Timestamp)</text>
<polyline fill="none" stroke="#1c2123" points="0,-162.5 294,-162.5 "/>
<text text-anchor="start" x="8" y="-147.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Return (commit_ts, write_record) of</text>
<text text-anchor="start" x="8" y="-132.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> the write record for `key`</text>
<text text-anchor="start" x="8" y="-117.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> committed before or equal to`ts`</text>
</g>
<!-- seek_write&#45;&gt;near_seek -->
<g id="edge3" class="edge">
<title>seek_write&#45;&gt;near_seek</title>
<path fill="none" stroke="#666666" d="M294.41,-141.66C306.44,-140.62 318.42,-139.71 330,-139 445.52,-131.96 579.85,-131.89 661.48,-132.74"/>
<polygon fill="#666666" stroke="#666666" points="661.62,-136.25 671.66,-132.86 661.7,-129.25 661.62,-136.25"/>
</g>
<!-- seek_write&#45;&gt;key -->
<g id="edge4" class="edge">
<title>seek_write&#45;&gt;key</title>
<path fill="none" stroke="#666666" d="M220.28,-208.59C252.38,-227.72 291.55,-247.31 330,-257 464.92,-291.02 629.93,-236.76 701.08,-208.9"/>
<polygon fill="#666666" stroke="#666666" points="702.49,-212.1 710.48,-205.15 699.9,-205.6 702.49,-212.1"/>
</g>
<!-- seek_write&#45;&gt;value -->
<g id="edge5" class="edge">
<title>seek_write&#45;&gt;value</title>
<path fill="none" stroke="#666666" d="M294.35,-132.88C306.39,-131.1 318.39,-129.44 330,-128 538.94,-102.13 594.18,-75.17 803,-102 824.47,-104.76 847.91,-110.73 866.65,-116.26"/>
<polygon fill="#666666" stroke="#666666" points="865.67,-119.62 876.26,-119.18 867.7,-112.92 865.67,-119.62"/>
</g>
<!-- seek_write&#45;&gt;parse -->
<g id="edge6" class="edge">
<title>seek_write&#45;&gt;parse</title>
<path fill="none" stroke="#666666" d="M270.82,-109.4C358.87,-78.27 481.1,-44 592.5,-44 592.5,-44 592.5,-44 738.5,-44 835.43,-44 948.2,-65.49 1004.56,-77.72"/>
<polygon fill="#666666" stroke="#666666" points="1003.89,-81.16 1014.41,-79.89 1005.4,-74.32 1003.89,-81.16"/>
</g>
<!-- create_write_cursor -->
<g id="node8" class="node">
<title>create_write_cursor</title>
<path fill="none" stroke="#1c2123" d="M342,-148.5C342,-148.5 503,-148.5 503,-148.5 509,-148.5 515,-154.5 515,-160.5 515,-160.5 515,-235.5 515,-235.5 515,-241.5 509,-247.5 503,-247.5 503,-247.5 342,-247.5 342,-247.5 336,-247.5 330,-241.5 330,-235.5 330,-235.5 330,-160.5 330,-160.5 330,-154.5 336,-148.5 342,-148.5"/>
<text text-anchor="middle" x="422.5" y="-232.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">create_write_cursor</text>
<polyline fill="none" stroke="#1c2123" points="330,-224.5 515,-224.5 "/>
<text text-anchor="start" x="338" y="-209.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CursorBuilder::new</text>
<text text-anchor="start" x="338" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> (&amp;self.snapshot, CF_WRITE)</text>
<polyline fill="none" stroke="#1c2123" points="330,-186.5 515,-186.5 "/>
<text text-anchor="start" x="338" y="-171.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果write_cursor为none</text>
<text text-anchor="start" x="338" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建write_cursor</text>
</g>
<!-- seek_write&#45;&gt;create_write_cursor -->
<g id="edge7" class="edge">
<title>seek_write&#45;&gt;create_write_cursor</title>
<path fill="none" stroke="#666666" d="M294.36,-179.87C302.94,-181.09 311.46,-182.31 319.8,-183.5"/>
<polygon fill="#666666" stroke="#666666" points="319.48,-186.99 329.88,-184.93 320.47,-180.06 319.48,-186.99"/>
</g>
<!-- seek_write&#45;&gt;decode_ts_from -->
<g id="edge8" class="edge">
<title>seek_write&#45;&gt;decode_ts_from</title>
<path fill="none" stroke="#666666" d="M211.05,-208.72C244.58,-232.7 287.56,-259.73 330,-276 505.56,-343.32 729.6,-361.91 837.99,-367.05"/>
<polygon fill="#666666" stroke="#666666" points="837.97,-370.55 848.11,-367.5 838.28,-363.55 837.97,-370.55"/>
</g>
<!-- write_cursor -->
<g id="node10" class="node">
<title>write_cursor</title>
<path fill="#feed9b" stroke="#f7e495" d="M563,-176C563,-176 624,-176 624,-176 630,-176 636,-182 636,-188 636,-188 636,-200 636,-200 636,-206 630,-212 624,-212 624,-212 563,-212 563,-212 557,-212 551,-206 551,-200 551,-200 551,-188 551,-188 551,-182 557,-176 563,-176"/>
<text text-anchor="middle" x="593.5" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#40575d">write_cursor</text>
</g>
<!-- create_write_cursor&#45;&gt;write_cursor -->
<g id="edge15" class="edge">
<title>create_write_cursor&#45;&gt;write_cursor</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M515.42,-195.82C524.13,-195.62 532.73,-195.41 540.86,-195.22"/>
<polygon fill="green" stroke="green" points="540.95,-198.72 550.86,-194.99 540.78,-191.72 540.95,-198.72"/>
</g>
<!-- commit_ts -->
<g id="node12" class="node">
<title>commit_ts</title>
<path fill="none" stroke="#1c2123" d="M1067,-347C1067,-347 1016,-347 1016,-347 1010,-347 1004,-341 1004,-335 1004,-335 1004,-323 1004,-323 1004,-317 1010,-311 1016,-311 1016,-311 1067,-311 1067,-311 1073,-311 1079,-317 1079,-323 1079,-323 1079,-335 1079,-335 1079,-341 1073,-347 1067,-347"/>
<text text-anchor="middle" x="1041.5" y="-325.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit_ts</text>
</g>
<!-- decode_ts_from&#45;&gt;commit_ts -->
<g id="edge14" class="edge">
<title>decode_ts_from&#45;&gt;commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M958.64,-353.08C970.33,-349.64 982.59,-346.03 993.95,-342.69"/>
<polygon fill="green" stroke="green" points="995.07,-346.01 1003.68,-339.83 993.1,-339.29 995.07,-346.01"/>
</g>
<!-- write_cursor&#45;&gt;near_seek -->
<g id="edge9" class="edge">
<title>write_cursor&#45;&gt;near_seek</title>
<path fill="none" stroke="#666666" d="M636.34,-176.32C647.75,-171.5 660.37,-166.17 672.7,-160.96"/>
<polygon fill="#666666" stroke="#666666" points="674.2,-164.12 682.05,-157.01 671.48,-157.68 674.2,-164.12"/>
</g>
<!-- write_cursor&#45;&gt;key -->
<g id="edge10" class="edge">
<title>write_cursor&#45;&gt;key</title>
<path fill="none" stroke="#666666" d="M636.34,-194C656.59,-194 680.67,-194 700.14,-194"/>
<polygon fill="#666666" stroke="#666666" points="700.14,-197.5 710.14,-194 700.14,-190.5 700.14,-197.5"/>
</g>
<!-- write_key&#45;&gt;commit_ts -->
<g id="edge17" class="edge">
<title>write_key&#45;&gt;commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M968.12,-307.71C976.96,-310.31 985.91,-312.94 994.35,-315.43"/>
<polygon fill="green" stroke="green" points="993.41,-318.8 1003.99,-318.26 995.39,-312.08 993.41,-318.8"/>
</g>
</g>
</svg>
