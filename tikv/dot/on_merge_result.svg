<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: on_merge_result Pages: 1 -->
<svg width="1500pt" height="1247pt"
 viewBox="0.00 0.00 1500.00 1247.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1243)">
<title>on_merge_result</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1243 1496,-1243 1496,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_CoprocessorHost</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M531,-1123C531,-1123 762,-1123 762,-1123 768,-1123 774,-1129 774,-1135 774,-1135 774,-1219 774,-1219 774,-1225 768,-1231 762,-1231 762,-1231 531,-1231 531,-1231 525,-1231 519,-1225 519,-1219 519,-1219 519,-1135 519,-1135 519,-1129 525,-1123 531,-1123"/>
<text text-anchor="middle" x="646.5" y="-1211" font-family="Times,serif" font-size="20.00">CoprocessorHost</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_StoreMeta</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M549,-913C549,-913 744,-913 744,-913 750,-913 756,-919 756,-925 756,-925 756,-1103 756,-1103 756,-1109 750,-1115 744,-1115 744,-1115 549,-1115 549,-1115 543,-1115 537,-1109 537,-1103 537,-1103 537,-925 537,-925 537,-919 543,-913 549,-913"/>
<text text-anchor="middle" x="646.5" y="-1095" font-family="Times,serif" font-size="20.00">StoreMeta</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_PeerStorage</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M857,-487C857,-487 946,-487 946,-487 952,-487 958,-493 958,-499 958,-499 958,-557 958,-557 958,-563 952,-569 946,-569 946,-569 857,-569 857,-569 851,-569 845,-563 845,-557 845,-557 845,-499 845,-499 845,-493 851,-487 857,-487"/>
<text text-anchor="middle" x="901.5" y="-549" font-family="Times,serif" font-size="20.00">PeerStorage</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_Peer</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M561,-577C561,-577 1472,-577 1472,-577 1478,-577 1484,-583 1484,-589 1484,-589 1484,-893 1484,-893 1484,-899 1478,-905 1472,-905 1472,-905 561,-905 561,-905 555,-905 549,-899 549,-893 549,-893 549,-589 549,-589 549,-583 555,-577 561,-577"/>
<text text-anchor="middle" x="1016.5" y="-885" font-family="Times,serif" font-size="20.00">Peer</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_PeerFsm</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M564.5,-410C564.5,-410 728.5,-410 728.5,-410 734.5,-410 740.5,-416 740.5,-422 740.5,-422 740.5,-557 740.5,-557 740.5,-563 734.5,-569 728.5,-569 728.5,-569 564.5,-569 564.5,-569 558.5,-569 552.5,-563 552.5,-557 552.5,-557 552.5,-422 552.5,-422 552.5,-416 558.5,-410 564.5,-410"/>
<text text-anchor="middle" x="646.5" y="-549" font-family="Times,serif" font-size="20.00">PeerFsm</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_PDTask</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M585,-270C585,-270 1275.5,-270 1275.5,-270 1281.5,-270 1287.5,-276 1287.5,-282 1287.5,-282 1287.5,-390 1287.5,-390 1287.5,-396 1281.5,-402 1275.5,-402 1275.5,-402 585,-402 585,-402 579,-402 573,-396 573,-390 573,-390 573,-282 573,-282 573,-276 579,-270 585,-270"/>
<text text-anchor="middle" x="930.25" y="-382" font-family="Times,serif" font-size="20.00">worker/pd</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_Router</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M581,-8C581,-8 994.5,-8 994.5,-8 1000.5,-8 1006.5,-14 1006.5,-20 1006.5,-20 1006.5,-250 1006.5,-250 1006.5,-256 1000.5,-262 994.5,-262 994.5,-262 581,-262 581,-262 575,-262 569,-256 569,-250 569,-250 569,-20 569,-20 569,-14 575,-8 581,-8"/>
<text text-anchor="middle" x="787.75" y="-242" font-family="Times,serif" font-size="20.00">Router</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_PeerFsmDelegate</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-530C20,-530 487,-530 487,-530 493,-530 499,-536 499,-542 499,-542 499,-784 499,-784 499,-790 493,-796 487,-796 487,-796 20,-796 20,-796 14,-796 8,-790 8,-784 8,-784 8,-542 8,-542 8,-536 14,-530 20,-530"/>
<text text-anchor="middle" x="253.5" y="-776" font-family="Times,serif" font-size="20.00">PeerFsmDelegate</text>
</g>
<!-- on_region_changed -->
<g id="node1" class="node">
<title>on_region_changed</title>
<path fill="none" stroke="#1c2123" d="M539,-1131.5C539,-1131.5 754,-1131.5 754,-1131.5 760,-1131.5 766,-1137.5 766,-1143.5 766,-1143.5 766,-1180.5 766,-1180.5 766,-1186.5 760,-1192.5 754,-1192.5 754,-1192.5 539,-1192.5 539,-1192.5 533,-1192.5 527,-1186.5 527,-1180.5 527,-1180.5 527,-1143.5 527,-1143.5 527,-1137.5 533,-1131.5 539,-1131.5"/>
<text text-anchor="middle" x="646.5" y="-1177.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_region_changed</text>
<polyline fill="none" stroke="#1c2123" points="527,-1169.5 766,-1169.5 "/>
<text text-anchor="start" x="535" y="-1154.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">触发region change的obserer</text>
<text text-anchor="start" x="535" y="-1139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送事件RegionChangeEvent::Destroy</text>
</g>
<!-- store_meta_lock -->
<g id="node2" class="node">
<title>store_meta_lock</title>
<path fill="none" stroke="#1c2123" d="M688,-1077C688,-1077 605,-1077 605,-1077 599,-1077 593,-1071 593,-1065 593,-1065 593,-1053 593,-1053 593,-1047 599,-1041 605,-1041 605,-1041 688,-1041 688,-1041 694,-1041 700,-1047 700,-1053 700,-1053 700,-1065 700,-1065 700,-1071 694,-1077 688,-1077"/>
<text text-anchor="middle" x="646.5" y="-1055.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">store_meta_lock</text>
</g>
<!-- pending_snapshot_regions -->
<g id="node3" class="node">
<title>pending_snapshot_regions</title>
<path fill="none" stroke="#1c2123" d="M715,-1023C715,-1023 578,-1023 578,-1023 572,-1023 566,-1017 566,-1011 566,-1011 566,-999 566,-999 566,-993 572,-987 578,-987 578,-987 715,-987 715,-987 721,-987 727,-993 727,-999 727,-999 727,-1011 727,-1011 727,-1017 721,-1023 715,-1023"/>
<text text-anchor="middle" x="646.5" y="-1001.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_snapshot_regions</text>
</g>
<!-- readers -->
<g id="node4" class="node">
<title>readers</title>
<path fill="none" stroke="#1c2123" d="M557,-922C557,-922 736,-922 736,-922 742,-922 748,-928 748,-934 748,-934 748,-956 748,-956 748,-962 742,-968 736,-968 736,-968 557,-968 557,-968 551,-968 545,-962 545,-956 545,-956 545,-934 545,-934 545,-928 551,-922 557,-922"/>
<text text-anchor="middle" x="646.5" y="-952.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">readers</text>
<polyline fill="none" stroke="#1c2123" points="545,-945 748,-945 "/>
<text text-anchor="start" x="553" y="-929.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">meta.readers.remove(&amp;region_id)</text>
</g>
<!-- clear_meta -->
<g id="node5" class="node">
<title>clear_meta</title>
<path fill="none" stroke="#1c2123" d="M928,-531C928,-531 875,-531 875,-531 869,-531 863,-525 863,-519 863,-519 863,-507 863,-507 863,-501 869,-495 875,-495 875,-495 928,-495 928,-495 934,-495 940,-501 940,-507 940,-507 940,-519 940,-519 940,-525 934,-531 928,-531"/>
<text text-anchor="middle" x="901.5" y="-509.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">clear_meta</text>
</g>
<!-- destroy -->
<g id="node6" class="node">
<title>destroy</title>
<path fill="none" stroke="#1c2123" d="M569,-683C569,-683 724,-683 724,-683 730,-683 736,-689 736,-695 736,-695 736,-763 736,-763 736,-769 730,-775 724,-775 724,-775 569,-775 569,-775 563,-775 557,-769 557,-763 557,-763 557,-695 557,-695 557,-689 563,-683 569,-683"/>
<text text-anchor="middle" x="646.5" y="-759.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">destroy</text>
<polyline fill="none" stroke="#1c2123" points="557,-752 736,-752 "/>
<text text-anchor="start" x="565" y="-736.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. set the region to tombstone</text>
<polyline fill="none" stroke="#1c2123" points="557,-729 736,-729 "/>
<text text-anchor="start" x="565" y="-713.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. clear data</text>
<polyline fill="none" stroke="#1c2123" points="557,-706 736,-706 "/>
<text text-anchor="start" x="565" y="-690.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">3. notify all pending requests</text>
</g>
<!-- destroy&#45;&gt;clear_meta -->
<g id="edge1" class="edge">
<title>destroy&#45;&gt;clear_meta</title>
<path fill="none" stroke="#666666" d="M687.81,-682.66C717.54,-649.95 759.98,-606.2 802,-573 819.13,-559.47 839.52,-546.58 857.3,-536.25"/>
<polygon fill="#666666" stroke="#666666" points="859.39,-539.09 866.33,-531.08 855.91,-533.01 859.39,-539.09"/>
</g>
<!-- write_peer_state -->
<g id="node7" class="node">
<title>write_peer_state</title>
<path fill="none" stroke="#1c2123" d="M834.5,-585.5C834.5,-585.5 968.5,-585.5 968.5,-585.5 974.5,-585.5 980.5,-591.5 980.5,-597.5 980.5,-597.5 980.5,-634.5 980.5,-634.5 980.5,-640.5 974.5,-646.5 968.5,-646.5 968.5,-646.5 834.5,-646.5 834.5,-646.5 828.5,-646.5 822.5,-640.5 822.5,-634.5 822.5,-634.5 822.5,-597.5 822.5,-597.5 822.5,-591.5 828.5,-585.5 834.5,-585.5"/>
<text text-anchor="middle" x="901.5" y="-631.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_peer_state</text>
<polyline fill="none" stroke="#1c2123" points="822.5,-623.5 980.5,-623.5 "/>
<text text-anchor="start" x="830.5" y="-608.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">写入peer状态Tombstone</text>
<text text-anchor="start" x="830.5" y="-593.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PeerState::Tombstone</text>
</g>
<!-- destroy&#45;&gt;write_peer_state -->
<g id="edge2" class="edge">
<title>destroy&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M736.16,-686.07C757.61,-675.98 780.54,-665.42 802,-656 806.1,-654.2 810.32,-652.38 814.58,-650.56"/>
<polygon fill="#666666" stroke="#666666" points="816.12,-653.71 823.96,-646.59 813.39,-647.26 816.12,-653.71"/>
</g>
<!-- consume -->
<g id="node8" class="node">
<title>consume</title>
<path fill="none" stroke="#1c2123" d="M857,-665.5C857,-665.5 946,-665.5 946,-665.5 952,-665.5 958,-671.5 958,-677.5 958,-677.5 958,-714.5 958,-714.5 958,-720.5 952,-726.5 946,-726.5 946,-726.5 857,-726.5 857,-726.5 851,-726.5 845,-720.5 845,-714.5 845,-714.5 845,-677.5 845,-677.5 845,-671.5 851,-665.5 857,-665.5"/>
<text text-anchor="middle" x="901.5" y="-711.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">consume</text>
<polyline fill="none" stroke="#1c2123" points="845,-703.5 958,-703.5 "/>
<text text-anchor="start" x="853" y="-688.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将raftlog日志</text>
<text text-anchor="start" x="853" y="-673.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 写入engine中？</text>
</g>
<!-- destroy&#45;&gt;consume -->
<g id="edge3" class="edge">
<title>destroy&#45;&gt;consume</title>
<path fill="none" stroke="#666666" d="M736.34,-717.41C768.71,-713.19 804.69,-708.5 834.7,-704.58"/>
<polygon fill="#666666" stroke="#666666" points="835.17,-708.05 844.63,-703.29 834.26,-701.11 835.17,-708.05"/>
</g>
<!-- pending_reads_clear_all -->
<g id="node9" class="node">
<title>pending_reads_clear_all</title>
<path fill="none" stroke="#1c2123" d="M964,-781C964,-781 839,-781 839,-781 833,-781 827,-775 827,-769 827,-769 827,-757 827,-757 827,-751 833,-745 839,-745 839,-745 964,-745 964,-745 970,-745 976,-751 976,-757 976,-757 976,-769 976,-769 976,-775 970,-781 964,-781"/>
<text text-anchor="middle" x="901.5" y="-759.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_reads_clear_all</text>
</g>
<!-- destroy&#45;&gt;pending_reads_clear_all -->
<g id="edge4" class="edge">
<title>destroy&#45;&gt;pending_reads_clear_all</title>
<path fill="none" stroke="#666666" d="M736.34,-740.94C762.49,-744.45 790.99,-748.28 816.8,-751.75"/>
<polygon fill="#666666" stroke="#666666" points="816.55,-755.25 826.93,-753.11 817.48,-748.31 816.55,-755.25"/>
</g>
<!-- notify_req_region_removed -->
<g id="node10" class="node">
<title>notify_req_region_removed</title>
<path fill="none" stroke="#1c2123" d="M1049,-812C1049,-812 1270,-812 1270,-812 1276,-812 1282,-818 1282,-824 1282,-824 1282,-846 1282,-846 1282,-852 1276,-858 1270,-858 1270,-858 1049,-858 1049,-858 1043,-858 1037,-852 1037,-846 1037,-846 1037,-824 1037,-824 1037,-818 1043,-812 1049,-812"/>
<text text-anchor="middle" x="1159.5" y="-842.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify_req_region_removed</text>
<polyline fill="none" stroke="#1c2123" points="1037,-835 1282,-835 "/>
<text text-anchor="start" x="1045" y="-819.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用回调cb, 返回RegionNotFound错误</text>
</g>
<!-- destroy&#45;&gt;notify_req_region_removed -->
<g id="edge5" class="edge">
<title>destroy&#45;&gt;notify_req_region_removed</title>
<path fill="none" stroke="#666666" d="M736.02,-768.73C757.27,-776.93 780.15,-784.67 802,-790 890.77,-811.65 915.9,-799.2 1006.5,-811 1013.09,-811.86 1019.83,-812.77 1026.63,-813.73"/>
<polygon fill="#666666" stroke="#666666" points="1026.23,-817.21 1036.63,-815.16 1027.22,-810.28 1026.23,-817.21"/>
</g>
<!-- proposals -->
<g id="node11" class="node">
<title>proposals</title>
<path fill="#feed9b" stroke="#f7e495" d="M816.5,-820C816.5,-820 986.5,-820 986.5,-820 992.5,-820 998.5,-826 998.5,-832 998.5,-832 998.5,-854 998.5,-854 998.5,-860 992.5,-866 986.5,-866 986.5,-866 816.5,-866 816.5,-866 810.5,-866 804.5,-860 804.5,-854 804.5,-854 804.5,-832 804.5,-832 804.5,-826 810.5,-820 816.5,-820"/>
<text text-anchor="middle" x="901.5" y="-850.8" font-family="Times,serif" font-size="14.00" fill="#40575d">proposals</text>
<polyline fill="none" stroke="#f7e495" points="804.5,-843 998.5,-843 "/>
<text text-anchor="start" x="812.5" y="-827.8" font-family="Times,serif" font-size="14.00" fill="#40575d">ProposalQueue&lt;EK::Snapshot&gt;,</text>
</g>
<!-- destroy&#45;&gt;proposals -->
<g id="edge6" class="edge">
<title>destroy&#45;&gt;proposals</title>
<path fill="none" stroke="#666666" d="M736.33,-774.37C757.66,-784.8 780.5,-795.59 802,-805 810.6,-808.76 819.7,-812.54 828.76,-816.18"/>
<polygon fill="#666666" stroke="#666666" points="827.57,-819.48 838.16,-819.91 830.15,-812.97 827.57,-819.48"/>
</g>
<!-- pending_reads -->
<g id="node12" class="node">
<title>pending_reads</title>
<path fill="none" stroke="#1c2123" d="M1070.5,-740C1070.5,-740 1248.5,-740 1248.5,-740 1254.5,-740 1260.5,-746 1260.5,-752 1260.5,-752 1260.5,-774 1260.5,-774 1260.5,-780 1254.5,-786 1248.5,-786 1248.5,-786 1070.5,-786 1070.5,-786 1064.5,-786 1058.5,-780 1058.5,-774 1058.5,-774 1058.5,-752 1058.5,-752 1058.5,-746 1064.5,-740 1070.5,-740"/>
<text text-anchor="middle" x="1159.5" y="-770.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_reads</text>
<polyline fill="none" stroke="#1c2123" points="1058.5,-763 1260.5,-763 "/>
<text text-anchor="middle" x="1159.5" y="-747.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue&lt;EK::Snapshot&gt;</text>
</g>
<!-- pending_reads_clear_all&#45;&gt;pending_reads -->
<g id="edge7" class="edge">
<title>pending_reads_clear_all&#45;&gt;pending_reads</title>
<path fill="none" stroke="#666666" d="M976.2,-763C998.56,-763 1023.64,-763 1047.86,-763"/>
<polygon fill="#666666" stroke="#666666" points="1048.18,-766.5 1058.18,-763 1048.18,-759.5 1048.18,-766.5"/>
</g>
<!-- cb_invoke_with_response -->
<g id="node13" class="node">
<title>cb_invoke_with_response</title>
<path fill="none" stroke="#1c2123" d="M1464,-853C1464,-853 1330,-853 1330,-853 1324,-853 1318,-847 1318,-841 1318,-841 1318,-829 1318,-829 1318,-823 1324,-817 1330,-817 1330,-817 1464,-817 1464,-817 1470,-817 1476,-823 1476,-829 1476,-829 1476,-841 1476,-841 1476,-847 1470,-853 1464,-853"/>
<text text-anchor="middle" x="1397" y="-831.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cb_invoke_with_response</text>
</g>
<!-- notify_req_region_removed&#45;&gt;cb_invoke_with_response -->
<g id="edge9" class="edge">
<title>notify_req_region_removed&#45;&gt;cb_invoke_with_response</title>
<path fill="none" stroke="#666666" d="M1282.04,-835C1290.68,-835 1299.29,-835 1307.68,-835"/>
<polygon fill="#666666" stroke="#666666" points="1307.8,-838.5 1317.8,-835 1307.8,-831.5 1307.8,-838.5"/>
</g>
<!-- proposals&#45;&gt;notify_req_region_removed -->
<g id="edge8" class="edge">
<title>proposals&#45;&gt;notify_req_region_removed</title>
<path fill="none" stroke="#666666" d="M998.55,-840C1007.72,-839.71 1017.12,-839.42 1026.56,-839.12"/>
<polygon fill="#666666" stroke="#666666" points="1026.9,-842.61 1036.79,-838.8 1026.69,-835.62 1026.9,-842.61"/>
</g>
<!-- pending_remove -->
<g id="node14" class="node">
<title>pending_remove</title>
<path fill="#feed9b" stroke="#f7e495" d="M572.5,-484C572.5,-484 720.5,-484 720.5,-484 726.5,-484 732.5,-490 732.5,-496 732.5,-496 732.5,-518 732.5,-518 732.5,-524 726.5,-530 720.5,-530 720.5,-530 572.5,-530 572.5,-530 566.5,-530 560.5,-524 560.5,-518 560.5,-518 560.5,-496 560.5,-496 560.5,-490 566.5,-484 572.5,-484"/>
<text text-anchor="middle" x="646.5" y="-514.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pending_remove</text>
<polyline fill="none" stroke="#f7e495" points="560.5,-507 732.5,-507 "/>
<text text-anchor="middle" x="646.5" y="-491.8" font-family="Times,serif" font-size="14.00" fill="#40575d">设置pending_remove为true</text>
</g>
<!-- stop -->
<g id="node15" class="node">
<title>stop</title>
<path fill="none" stroke="#1c2123" d="M597.5,-419C597.5,-419 695.5,-419 695.5,-419 701.5,-419 707.5,-425 707.5,-431 707.5,-431 707.5,-453 707.5,-453 707.5,-459 701.5,-465 695.5,-465 695.5,-465 597.5,-465 597.5,-465 591.5,-465 585.5,-459 585.5,-453 585.5,-453 585.5,-431 585.5,-431 585.5,-425 591.5,-419 597.5,-419"/>
<text text-anchor="middle" x="646.5" y="-449.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">stop</text>
<polyline fill="none" stroke="#1c2123" points="585.5,-442 707.5,-442 "/>
<text text-anchor="start" x="593.5" y="-426.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置stopped为true</text>
</g>
<!-- PdTask_DestroyPeer -->
<g id="node16" class="node">
<title>PdTask_DestroyPeer</title>
<path fill="none" stroke="#1c2123" d="M593,-296.5C593,-296.5 700,-296.5 700,-296.5 706,-296.5 712,-302.5 712,-308.5 712,-308.5 712,-345.5 712,-345.5 712,-351.5 706,-357.5 700,-357.5 700,-357.5 593,-357.5 593,-357.5 587,-357.5 581,-351.5 581,-345.5 581,-345.5 581,-308.5 581,-308.5 581,-302.5 587,-296.5 593,-296.5"/>
<text text-anchor="middle" x="646.5" y="-342.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PdTask::DestroyPeer</text>
<polyline fill="none" stroke="#1c2123" points="581,-334.5 712,-334.5 "/>
<text text-anchor="start" x="589" y="-319.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">由pd worker来处理</text>
<text text-anchor="middle" x="646.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> DestoryPeer消息</text>
</g>
<!-- handle_destroy_peer -->
<g id="node17" class="node">
<title>handle_destroy_peer</title>
<path fill="none" stroke="#1c2123" d="M814,-301C814,-301 989,-301 989,-301 995,-301 1001,-307 1001,-313 1001,-313 1001,-335 1001,-335 1001,-341 995,-347 989,-347 989,-347 814,-347 814,-347 808,-347 802,-341 802,-335 802,-335 802,-313 802,-313 802,-307 808,-301 814,-301"/>
<text text-anchor="middle" x="901.5" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_destroy_peer</text>
<polyline fill="none" stroke="#1c2123" points="802,-324 1001,-324 "/>
<text text-anchor="start" x="810" y="-308.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从region_peers 删除掉region_id</text>
</g>
<!-- PdTask_DestroyPeer&#45;&gt;handle_destroy_peer -->
<g id="edge10" class="edge">
<title>PdTask_DestroyPeer&#45;&gt;handle_destroy_peer</title>
<path fill="none" stroke="#666666" d="M712.33,-326.23C736.47,-325.94 764.59,-325.61 791.61,-325.29"/>
<polygon fill="#666666" stroke="#666666" points="791.95,-328.79 801.9,-325.17 791.86,-321.79 791.95,-328.79"/>
</g>
<!-- region_peers -->
<g id="node18" class="node">
<title>region_peers</title>
<path fill="none" stroke="#1c2123" d="M1051.5,-279C1051.5,-279 1267.5,-279 1267.5,-279 1273.5,-279 1279.5,-285 1279.5,-291 1279.5,-291 1279.5,-351 1279.5,-351 1279.5,-357 1273.5,-363 1267.5,-363 1267.5,-363 1051.5,-363 1051.5,-363 1045.5,-363 1039.5,-357 1039.5,-351 1039.5,-351 1039.5,-291 1039.5,-291 1039.5,-285 1045.5,-279 1051.5,-279"/>
<text text-anchor="middle" x="1159.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_peers</text>
<polyline fill="none" stroke="#1c2123" points="1039.5,-340 1279.5,-340 "/>
<text text-anchor="start" x="1047.5" y="-324.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_peers: HashMap&lt;u64, PeerStat&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1039.5,-317 1279.5,-317 "/>
<text text-anchor="start" x="1047.5" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">key为region_id</text>
<text text-anchor="start" x="1047.5" y="-286.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region_peers.remove(&amp;region_id)</text>
</g>
<!-- handle_destroy_peer&#45;&gt;region_peers -->
<g id="edge11" class="edge">
<title>handle_destroy_peer&#45;&gt;region_peers</title>
<path fill="none" stroke="#666666" d="M1001.11,-322.84C1010.32,-322.74 1019.74,-322.63 1029.17,-322.52"/>
<polygon fill="#666666" stroke="#666666" points="1029.44,-326.01 1039.39,-322.4 1029.35,-319.01 1029.44,-326.01"/>
</g>
<!-- router_close -->
<g id="node19" class="node">
<title>router_close</title>
<path fill="none" stroke="#1c2123" d="M589,-153C589,-153 704,-153 704,-153 710,-153 716,-159 716,-165 716,-165 716,-187 716,-187 716,-193 710,-199 704,-199 704,-199 589,-199 589,-199 583,-199 577,-193 577,-187 577,-187 577,-165 577,-165 577,-159 583,-153 589,-153"/>
<text text-anchor="middle" x="646.5" y="-183.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">router.close</text>
<polyline fill="none" stroke="#1c2123" points="577,-176 716,-176 "/>
<text text-anchor="start" x="585" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">关闭region的mailbox</text>
</g>
<!-- normals -->
<g id="node20" class="node">
<title>normals</title>
<path fill="#feed9b" stroke="#f7e495" d="M816.5,-16.5C816.5,-16.5 986.5,-16.5 986.5,-16.5 992.5,-16.5 998.5,-22.5 998.5,-28.5 998.5,-28.5 998.5,-103.5 998.5,-103.5 998.5,-109.5 992.5,-115.5 986.5,-115.5 986.5,-115.5 816.5,-115.5 816.5,-115.5 810.5,-115.5 804.5,-109.5 804.5,-103.5 804.5,-103.5 804.5,-28.5 804.5,-28.5 804.5,-22.5 810.5,-16.5 816.5,-16.5"/>
<text text-anchor="middle" x="901.5" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#40575d">normals</text>
<polyline fill="none" stroke="#f7e495" points="804.5,-92.5 998.5,-92.5 "/>
<text text-anchor="start" x="812.5" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#40575d">从region_id到PeerFsm的</text>
<text text-anchor="start" x="812.5" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> mailbox的映射</text>
<polyline fill="none" stroke="#f7e495" points="804.5,-54.5 998.5,-54.5 "/>
<text text-anchor="start" x="812.5" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#40575d">normals: Arc&lt;Mutex&lt;HashMap</text>
<text text-anchor="start" x="812.5" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> &lt;u64, BasicMailbox&lt;N&gt;&gt;&gt;&gt;,</text>
</g>
<!-- router_close&#45;&gt;normals -->
<g id="edge12" class="edge">
<title>router_close&#45;&gt;normals</title>
<path fill="none" stroke="#666666" d="M700.54,-152.94C727.9,-141.04 762.29,-126.09 794.79,-111.96"/>
<polygon fill="#666666" stroke="#666666" points="796.57,-115 804.35,-107.8 793.78,-108.58 796.57,-115"/>
</g>
<!-- mailboxes_remove -->
<g id="node21" class="node">
<title>mailboxes_remove</title>
<path fill="none" stroke="#1c2123" d="M950,-170C950,-170 853,-170 853,-170 847,-170 841,-164 841,-158 841,-158 841,-146 841,-146 841,-140 847,-134 853,-134 853,-134 950,-134 950,-134 956,-134 962,-140 962,-146 962,-146 962,-158 962,-158 962,-164 956,-170 950,-170"/>
<text text-anchor="middle" x="901.5" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">mailboxes_remove</text>
</g>
<!-- router_close&#45;&gt;mailboxes_remove -->
<g id="edge13" class="edge">
<title>router_close&#45;&gt;mailboxes_remove</title>
<path fill="none" stroke="#666666" d="M716.3,-169.47C751.72,-166.11 794.83,-162.02 830.44,-158.65"/>
<polygon fill="#666666" stroke="#666666" points="831.12,-162.1 840.75,-157.67 830.46,-155.13 831.12,-162.1"/>
</g>
<!-- mailboxe_close -->
<g id="node22" class="node">
<title>mailboxe_close</title>
<path fill="none" stroke="#1c2123" d="M940.5,-224C940.5,-224 862.5,-224 862.5,-224 856.5,-224 850.5,-218 850.5,-212 850.5,-212 850.5,-200 850.5,-200 850.5,-194 856.5,-188 862.5,-188 862.5,-188 940.5,-188 940.5,-188 946.5,-188 952.5,-194 952.5,-200 952.5,-200 952.5,-212 952.5,-212 952.5,-218 946.5,-224 940.5,-224"/>
<text text-anchor="middle" x="901.5" y="-202.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">mailboxe_close</text>
</g>
<!-- router_close&#45;&gt;mailboxe_close -->
<g id="edge14" class="edge">
<title>router_close&#45;&gt;mailboxe_close</title>
<path fill="none" stroke="#666666" d="M716.3,-184.16C754.95,-188.74 802.75,-194.41 839.97,-198.82"/>
<polygon fill="#666666" stroke="#666666" points="839.83,-202.33 850.18,-200.03 840.66,-195.38 839.83,-202.33"/>
</g>
<!-- on_merge_result -->
<g id="node23" class="node">
<title>on_merge_result</title>
<path fill="none" stroke="#1c2123" d="M112,-682C112,-682 28,-682 28,-682 22,-682 16,-676 16,-670 16,-670 16,-658 16,-658 16,-652 22,-646 28,-646 28,-646 112,-646 112,-646 118,-646 124,-652 124,-658 124,-658 124,-670 124,-670 124,-676 118,-682 112,-682"/>
<text text-anchor="middle" x="70" y="-660.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_merge_result</text>
</g>
<!-- pending_merge_state -->
<g id="node24" class="node">
<title>pending_merge_state</title>
<path fill="none" stroke="#1c2123" d="M319,-574C319,-574 210,-574 210,-574 204,-574 198,-568 198,-562 198,-562 198,-550 198,-550 198,-544 204,-538 210,-538 210,-538 319,-538 319,-538 325,-538 331,-544 331,-550 331,-550 331,-562 331,-562 331,-568 325,-574 319,-574"/>
<text text-anchor="middle" x="264.5" y="-552.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_merge_state</text>
</g>
<!-- on_merge_result&#45;&gt;pending_merge_state -->
<g id="edge15" class="edge">
<title>on_merge_result&#45;&gt;pending_merge_state</title>
<path fill="none" stroke="#666666" d="M86.15,-645.78C102.51,-627.28 130.25,-599.13 160,-583 168.75,-578.25 178.38,-574.31 188.13,-571.04"/>
<polygon fill="#666666" stroke="#666666" points="189.4,-574.32 197.9,-568 187.31,-567.63 189.4,-574.32"/>
</g>
<!-- is_applying_snapshot -->
<g id="node25" class="node">
<title>is_applying_snapshot</title>
<path fill="none" stroke="#1c2123" d="M319.5,-628C319.5,-628 209.5,-628 209.5,-628 203.5,-628 197.5,-622 197.5,-616 197.5,-616 197.5,-604 197.5,-604 197.5,-598 203.5,-592 209.5,-592 209.5,-592 319.5,-592 319.5,-592 325.5,-592 331.5,-598 331.5,-604 331.5,-604 331.5,-616 331.5,-616 331.5,-622 325.5,-628 319.5,-628"/>
<text text-anchor="middle" x="264.5" y="-606.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_applying_snapshot</text>
</g>
<!-- on_merge_result&#45;&gt;is_applying_snapshot -->
<g id="edge16" class="edge">
<title>on_merge_result&#45;&gt;is_applying_snapshot</title>
<path fill="none" stroke="#666666" d="M124.08,-647.52C135.88,-643.97 148.34,-640.29 160,-637 168.95,-634.47 178.37,-631.9 187.72,-629.4"/>
<polygon fill="#666666" stroke="#666666" points="188.65,-632.78 197.42,-626.82 186.85,-626.01 188.65,-632.78"/>
</g>
<!-- is_initialized -->
<g id="node26" class="node">
<title>is_initialized</title>
<path fill="none" stroke="#1c2123" d="M295.5,-682C295.5,-682 233.5,-682 233.5,-682 227.5,-682 221.5,-676 221.5,-670 221.5,-670 221.5,-658 221.5,-658 221.5,-652 227.5,-646 233.5,-646 233.5,-646 295.5,-646 295.5,-646 301.5,-646 307.5,-652 307.5,-658 307.5,-658 307.5,-670 307.5,-670 307.5,-676 301.5,-682 295.5,-682"/>
<text text-anchor="middle" x="264.5" y="-660.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_initialized</text>
</g>
<!-- on_merge_result&#45;&gt;is_initialized -->
<g id="edge17" class="edge">
<title>on_merge_result&#45;&gt;is_initialized</title>
<path fill="none" stroke="#666666" d="M124.11,-664C151.25,-664 184.15,-664 211.18,-664"/>
<polygon fill="#666666" stroke="#666666" points="211.22,-667.5 221.22,-664 211.22,-660.5 211.22,-667.5"/>
</g>
<!-- MergeResultKind_FromTargetLog -->
<g id="node27" class="node">
<title>MergeResultKind_FromTargetLog</title>
<path fill="none" stroke="#1c2123" d="M172,-701C172,-701 357,-701 357,-701 363,-701 369,-707 369,-713 369,-713 369,-725 369,-725 369,-731 363,-737 357,-737 357,-737 172,-737 172,-737 166,-737 160,-731 160,-725 160,-725 160,-713 160,-713 160,-707 166,-701 172,-701"/>
<text text-anchor="middle" x="264.5" y="-715.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">MergeResultKind::FromTargetLog</text>
</g>
<!-- on_merge_result&#45;&gt;MergeResultKind_FromTargetLog -->
<g id="edge18" class="edge">
<title>on_merge_result&#45;&gt;MergeResultKind_FromTargetLog</title>
<path fill="none" stroke="#666666" d="M124.1,-680.4C135.9,-683.96 148.36,-687.66 160,-691 168.39,-693.41 177.17,-695.87 185.92,-698.29"/>
<polygon fill="#666666" stroke="#666666" points="185.2,-701.72 195.77,-700.99 187.06,-694.97 185.2,-701.72"/>
</g>
<!-- destroy_peer -->
<g id="node28" class="node">
<title>destroy_peer</title>
<path fill="none" stroke="#1c2123" d="M479,-747C479,-747 417,-747 417,-747 411,-747 405,-741 405,-735 405,-735 405,-723 405,-723 405,-717 411,-711 417,-711 417,-711 479,-711 479,-711 485,-711 491,-717 491,-723 491,-723 491,-735 491,-735 491,-741 485,-747 479,-747"/>
<text text-anchor="middle" x="448" y="-725.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">destroy_peer</text>
</g>
<!-- on_merge_result&#45;&gt;destroy_peer -->
<g id="edge19" class="edge">
<title>on_merge_result&#45;&gt;destroy_peer</title>
<path fill="none" stroke="#666666" d="M83.61,-682.07C98.97,-702.31 126.98,-733.99 160,-747 237.5,-777.53 335.89,-760.62 395.02,-745.14"/>
<polygon fill="#666666" stroke="#666666" points="396.14,-748.46 404.88,-742.47 394.31,-741.7 396.14,-748.46"/>
</g>
<!-- MergeResultKind_FromTargetLog&#45;&gt;destroy_peer -->
<g id="edge20" class="edge">
<title>MergeResultKind_FromTargetLog&#45;&gt;destroy_peer</title>
<path fill="none" stroke="#666666" d="M369.24,-724.72C378.06,-725.2 386.71,-725.68 394.86,-726.13"/>
<polygon fill="#666666" stroke="#666666" points="394.7,-729.62 404.88,-726.68 395.08,-722.63 394.7,-729.62"/>
</g>
<!-- destroy_peer&#45;&gt;on_region_changed -->
<g id="edge21" class="edge">
<title>destroy_peer&#45;&gt;on_region_changed</title>
<path fill="none" stroke="#666666" d="M449.86,-747.03C453.5,-815.96 469.77,-1061.76 519,-1119 520.72,-1121 522.54,-1122.91 524.44,-1124.73"/>
<polygon fill="#666666" stroke="#666666" points="522.29,-1127.49 532.17,-1131.31 526.83,-1122.16 522.29,-1127.49"/>
</g>
<!-- destroy_peer&#45;&gt;store_meta_lock -->
<g id="edge22" class="edge">
<title>destroy_peer&#45;&gt;store_meta_lock</title>
<path fill="none" stroke="#666666" d="M450.67,-747.11C456.47,-806.11 477.71,-991.4 519,-1032 535.81,-1048.53 560.1,-1056.04 582.91,-1059.15"/>
<polygon fill="#666666" stroke="#666666" points="582.59,-1062.64 592.91,-1060.26 583.36,-1055.68 582.59,-1062.64"/>
</g>
<!-- destroy_peer&#45;&gt;pending_snapshot_regions -->
<g id="edge23" class="edge">
<title>destroy_peer&#45;&gt;pending_snapshot_regions</title>
<path fill="none" stroke="#666666" d="M448.23,-747.21C447.36,-793.23 451.87,-915.02 519,-978 529.35,-987.71 542.29,-994.27 555.91,-998.64"/>
<polygon fill="#666666" stroke="#666666" points="555.36,-1002.12 565.93,-1001.45 557.25,-995.38 555.36,-1002.12"/>
</g>
<!-- destroy_peer&#45;&gt;readers -->
<g id="edge24" class="edge">
<title>destroy_peer&#45;&gt;readers</title>
<path fill="none" stroke="#666666" d="M450.76,-747.01C455.27,-783.17 470.53,-864.87 519,-909 524.1,-913.65 529.77,-917.7 535.79,-921.23"/>
<polygon fill="#666666" stroke="#666666" points="534.36,-924.44 544.84,-926.04 537.65,-918.26 534.36,-924.44"/>
</g>
<!-- destroy_peer&#45;&gt;destroy -->
<g id="edge25" class="edge">
<title>destroy_peer&#45;&gt;destroy</title>
<path fill="none" stroke="#666666" d="M491.15,-729C507.58,-729 527.14,-729 546.73,-729"/>
<polygon fill="#666666" stroke="#666666" points="546.97,-732.5 556.97,-729 546.97,-725.5 546.97,-732.5"/>
</g>
<!-- destroy_peer&#45;&gt;pending_remove -->
<g id="edge26" class="edge">
<title>destroy_peer&#45;&gt;pending_remove</title>
<path fill="none" stroke="#666666" d="M452.97,-710.93C460.7,-679.4 480.52,-613.83 519,-573 533.89,-557.21 553.4,-544.49 572.64,-534.6"/>
<polygon fill="#666666" stroke="#666666" points="574.31,-537.67 581.73,-530.11 571.22,-531.4 574.31,-537.67"/>
</g>
<!-- destroy_peer&#45;&gt;stop -->
<g id="edge27" class="edge">
<title>destroy_peer&#45;&gt;stop</title>
<path fill="none" stroke="#666666" d="M448.28,-710.95C447.49,-664.72 452.08,-541.01 519,-475 534.07,-460.14 554.94,-451.73 575.39,-447.03"/>
<polygon fill="#666666" stroke="#666666" points="576.26,-450.43 585.37,-445.02 574.87,-443.57 576.26,-450.43"/>
</g>
<!-- destroy_peer&#45;&gt;PdTask_DestroyPeer -->
<g id="edge28" class="edge">
<title>destroy_peer&#45;&gt;PdTask_DestroyPeer</title>
<path fill="none" stroke="#666666" d="M448.24,-710.63C447,-658.04 449.84,-504.32 519,-406 532.43,-386.91 552.09,-371.46 571.93,-359.47"/>
<polygon fill="#666666" stroke="#666666" points="573.83,-362.41 580.73,-354.37 570.32,-356.35 573.83,-362.41"/>
</g>
<!-- destroy_peer&#45;&gt;router_close -->
<g id="edge29" class="edge">
<title>destroy_peer&#45;&gt;router_close</title>
<path fill="none" stroke="#666666" d="M449.86,-710.99C453.76,-635.26 471.69,-342.96 519,-266 535.1,-239.81 561.96,-219.1 586.8,-204.17"/>
<polygon fill="#666666" stroke="#666666" points="588.59,-207.18 595.48,-199.14 585.08,-201.13 588.59,-207.18"/>
</g>
</g>
</svg>
