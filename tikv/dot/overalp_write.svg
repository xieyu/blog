<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1044pt" height="325pt"
 viewBox="0.00 0.00 1044.00 325.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 321)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-321 1040,-321 1040,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_same_ts</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M103,-26C103,-26 223,-26 223,-26 229,-26 235,-32 235,-38 235,-38 235,-173 235,-173 235,-179 229,-185 223,-185 223,-185 103,-185 103,-185 97,-185 91,-179 91,-173 91,-173 91,-38 91,-38 91,-32 97,-26 103,-26"/>
<text text-anchor="middle" x="163" y="-165" font-family="Times,serif" font-size="20.00">same ts on key1</text>
</g>
<!-- t1__start_ts -->
<g id="node1" class="node">
<title>t1__start_ts</title>
<path fill="#bcffb9" stroke="#8a8898" d="M143,-100C143,-100 182,-100 182,-100 188,-100 194,-106 194,-112 194,-112 194,-134 194,-134 194,-140 188,-146 182,-146 182,-146 143,-146 143,-146 137,-146 131,-140 131,-134 131,-134 131,-112 131,-112 131,-106 137,-100 143,-100"/>
<text text-anchor="start" x="139" y="-130.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="131,-123 194,-123 "/>
<text text-anchor="start" x="139" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">start_ts</text>
</g>
<!-- t1__mid -->
<g id="node2" class="node">
<title>t1__mid</title>
<path fill="#bcffb9" stroke="#8a8898" d="M275,-141C275,-141 322,-141 322,-141 328,-141 334,-147 334,-153 334,-153 334,-175 334,-175 334,-181 328,-187 322,-187 322,-187 275,-187 275,-187 269,-187 263,-181 263,-175 263,-175 263,-153 263,-153 263,-147 269,-141 275,-141"/>
<text text-anchor="start" x="271" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="263,-164 334,-164 "/>
<text text-anchor="middle" x="298.5" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">执行中...</text>
</g>
<!-- t1__start_ts&#45;&gt;t1__mid -->
<g id="edge1" class="edge">
<title>t1__start_ts&#45;&gt;t1__mid</title>
<path fill="none" stroke="#666666" d="M194.24,-132.41C211.61,-137.72 233.64,-144.46 252.88,-150.35"/>
<polygon fill="#666666" stroke="#666666" points="252.06,-153.76 262.65,-153.34 254.11,-147.06 252.06,-153.76"/>
</g>
<!-- WriteRecord -->
<g id="node9" class="node">
<title>WriteRecord</title>
<path fill="none" stroke="#1c2123" d="M777,-0.5C777,-0.5 1024,-0.5 1024,-0.5 1030,-0.5 1036,-6.5 1036,-12.5 1036,-12.5 1036,-195.5 1036,-195.5 1036,-201.5 1030,-207.5 1024,-207.5 1024,-207.5 777,-207.5 777,-207.5 771,-207.5 765,-201.5 765,-195.5 765,-195.5 765,-12.5 765,-12.5 765,-6.5 771,-0.5 777,-0.5"/>
<text text-anchor="start" x="773" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write column</text>
<polyline fill="none" stroke="#1c2123" points="765,-184.5 1036,-184.5 "/>
<text text-anchor="start" x="773" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">写到CF_WRITE的kv</text>
<polyline fill="none" stroke="#1c2123" points="765,-161.5 1036,-161.5 "/>
<text text-anchor="middle" x="819.5" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key1 t1.start_ts</text>
<polyline fill="none" stroke="#1c2123" points="874,-92.5 874,-161.5 "/>
<text text-anchor="start" x="882" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_type: Rollback</text>
<polyline fill="none" stroke="#1c2123" points="874,-138.5 1036,-138.5 "/>
<text text-anchor="start" x="882" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: t1.start_ts</text>
<polyline fill="none" stroke="#1c2123" points="874,-115.5 1036,-115.5 "/>
<text text-anchor="start" x="882" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="765,-92.5 1036,-92.5 "/>
<text text-anchor="middle" x="824.5" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key1 t3.commit_ts</text>
<polyline fill="none" stroke="#1c2123" points="884,-23.5 884,-92.5 "/>
<text text-anchor="start" x="892" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_type: Rollback</text>
<polyline fill="none" stroke="#1c2123" points="884,-69.5 1036,-69.5 "/>
<text text-anchor="start" x="892" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: t3.start_ts</text>
<polyline fill="none" stroke="#1c2123" points="884,-46.5 1036,-46.5 "/>
<text text-anchor="start" x="892" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="765,-23.5 1036,-23.5 "/>
<text text-anchor="start" x="773" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">...</text>
</g>
<!-- t1__start_ts&#45;&gt;WriteRecord -->
<g id="edge7" class="edge">
<title>t1__start_ts&#45;&gt;WriteRecord:t1</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M194.17,-123.35C281.31,-124.31 538.03,-126.92 754.71,-127"/>
<polygon fill="green" stroke="green" points="755,-130.5 765,-127 755,-123.5 755,-130.5"/>
</g>
<!-- t1__primary_key__expired -->
<g id="node3" class="node">
<title>t1__primary_key__expired</title>
<path fill="#bcffb9" stroke="#8a8898" d="M455,-137.5C455,-137.5 517,-137.5 517,-137.5 523,-137.5 529,-143.5 529,-149.5 529,-149.5 529,-186.5 529,-186.5 529,-192.5 523,-198.5 517,-198.5 517,-198.5 455,-198.5 455,-198.5 449,-198.5 443,-192.5 443,-186.5 443,-186.5 443,-149.5 443,-149.5 443,-143.5 449,-137.5 455,-137.5"/>
<text text-anchor="start" x="451" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="443,-175.5 529,-175.5 "/>
<text text-anchor="start" x="451" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">primary_key</text>
<text text-anchor="start" x="451" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> expired</text>
</g>
<!-- t1__mid&#45;&gt;t1__primary_key__expired -->
<g id="edge2" class="edge">
<title>t1__mid&#45;&gt;t1__primary_key__expired</title>
<path fill="none" stroke="#666666" d="M334.39,-164.75C362.02,-165.35 401.05,-166.19 432.46,-166.87"/>
<polygon fill="#666666" stroke="#666666" points="432.71,-170.37 442.79,-167.09 432.86,-163.37 432.71,-170.37"/>
</g>
<!-- t1__rollback_lock -->
<g id="node4" class="node">
<title>t1__rollback_lock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M650,-145C650,-145 717,-145 717,-145 723,-145 729,-151 729,-157 729,-157 729,-179 729,-179 729,-185 723,-191 717,-191 717,-191 650,-191 650,-191 644,-191 638,-185 638,-179 638,-179 638,-157 638,-157 638,-151 644,-145 650,-145"/>
<text text-anchor="start" x="646" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务：t1</text>
<polyline fill="none" stroke="#8a8898" points="638,-168 729,-168 "/>
<text text-anchor="start" x="646" y="-152.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">rollback_lock</text>
</g>
<!-- t1__primary_key__expired&#45;&gt;t1__rollback_lock -->
<g id="edge3" class="edge">
<title>t1__primary_key__expired&#45;&gt;t1__rollback_lock</title>
<path fill="none" stroke="#666666" d="M529.42,-168C558.18,-168 596.46,-168 627.54,-168"/>
<polygon fill="#666666" stroke="#666666" points="627.78,-171.5 637.78,-168 627.78,-164.5 627.78,-171.5"/>
</g>
<!-- t1__rollback_lock&#45;&gt;WriteRecord -->
<g id="edge9" class="edge">
<title>t1__rollback_lock&#45;&gt;WriteRecord:t1</title>
<path fill="none" stroke="#666666" d="M713.7,-144.86C725.53,-137.31 739.89,-130.24 754.7,-127.85"/>
<polygon fill="#666666" stroke="#666666" points="755.32,-131.31 765,-127 754.75,-124.34 755.32,-131.31"/>
</g>
<!-- t3__start_ts -->
<g id="node5" class="node">
<title>t3__start_ts</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M12,-35C12,-35 51,-35 51,-35 57,-35 63,-41 63,-47 63,-47 63,-69 63,-69 63,-75 57,-81 51,-81 51,-81 12,-81 12,-81 6,-81 0,-75 0,-69 0,-69 0,-47 0,-47 0,-41 6,-35 12,-35"/>
<text text-anchor="start" x="8" y="-65.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t3</text>
<polyline fill="none" stroke="#8a8898" points="0,-58 63,-58 "/>
<text text-anchor="start" x="8" y="-42.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">start_ts</text>
</g>
<!-- t3__commit_ts -->
<g id="node6" class="node">
<title>t3__commit_ts</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M137,-35C137,-35 188,-35 188,-35 194,-35 200,-41 200,-47 200,-47 200,-69 200,-69 200,-75 194,-81 188,-81 188,-81 137,-81 137,-81 131,-81 125,-75 125,-69 125,-69 125,-47 125,-47 125,-41 131,-35 137,-35"/>
<text text-anchor="start" x="133" y="-65.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t3</text>
<polyline fill="none" stroke="#8a8898" points="125,-58 200,-58 "/>
<text text-anchor="start" x="133" y="-42.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit_ts</text>
</g>
<!-- t3__start_ts&#45;&gt;t3__commit_ts -->
<g id="edge4" class="edge">
<title>t3__start_ts&#45;&gt;t3__commit_ts</title>
<path fill="none" stroke="#666666" d="M63.07,-58C78.37,-58 97.24,-58 114.34,-58"/>
<polygon fill="#666666" stroke="#666666" points="114.72,-61.5 124.72,-58 114.72,-54.5 114.72,-61.5"/>
</g>
<!-- t3__commit_ts&#45;&gt;WriteRecord -->
<g id="edge8" class="edge">
<title>t3__commit_ts&#45;&gt;WriteRecord:t3</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M200.12,-58C292.53,-58 542.94,-58 754.93,-58"/>
<polygon fill="green" stroke="green" points="755,-61.5 765,-58 755,-54.5 755,-61.5"/>
</g>
<!-- t2__start_ts -->
<g id="node7" class="node">
<title>t2__start_ts</title>
<path fill="none" stroke="#1c2123" d="M279,-244C279,-244 318,-244 318,-244 324,-244 330,-250 330,-256 330,-256 330,-278 330,-278 330,-284 324,-290 318,-290 318,-290 279,-290 279,-290 273,-290 267,-284 267,-278 267,-278 267,-256 267,-256 267,-250 273,-244 279,-244"/>
<text text-anchor="start" x="275" y="-274.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务: t2</text>
<polyline fill="none" stroke="#1c2123" points="267,-267 330,-267 "/>
<text text-anchor="start" x="275" y="-251.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts</text>
</g>
<!-- t2__current_ts -->
<g id="node8" class="node">
<title>t2__current_ts</title>
<path fill="none" stroke="#1c2123" d="M382,-217.5C382,-217.5 590,-217.5 590,-217.5 596,-217.5 602,-223.5 602,-229.5 602,-229.5 602,-304.5 602,-304.5 602,-310.5 596,-316.5 590,-316.5 590,-316.5 382,-316.5 382,-316.5 376,-316.5 370,-310.5 370,-304.5 370,-304.5 370,-229.5 370,-229.5 370,-223.5 376,-217.5 382,-217.5"/>
<text text-anchor="start" x="378" y="-301.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务: t2</text>
<text text-anchor="start" x="378" y="-286.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> current_ts</text>
<polyline fill="none" stroke="#1c2123" points="370,-278.5 602,-278.5 "/>
<text text-anchor="start" x="378" y="-263.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务t2执行时发现和t1的lock有冲突</text>
<polyline fill="none" stroke="#1c2123" points="370,-255.5 602,-255.5 "/>
<text text-anchor="start" x="378" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送CheckTxnStatus命令到TiKV</text>
<text text-anchor="start" x="378" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查t1的状态</text>
</g>
<!-- t2__start_ts&#45;&gt;t2__current_ts -->
<g id="edge5" class="edge">
<title>t2__start_ts&#45;&gt;t2__current_ts</title>
<path fill="none" stroke="#666666" d="M330.13,-267C338.88,-267 348.99,-267 359.76,-267"/>
<polygon fill="#666666" stroke="#666666" points="359.83,-270.5 369.83,-267 359.83,-263.5 359.83,-270.5"/>
</g>
<!-- t2__current_ts&#45;&gt;t1__rollback_lock -->
<g id="edge6" class="edge">
<title>t2__current_ts&#45;&gt;t1__rollback_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M585.04,-217.35C600.05,-209.75 615.06,-202.15 628.64,-195.27"/>
<polygon fill="green" stroke="green" points="630.46,-198.28 637.8,-190.64 627.3,-192.03 630.46,-198.28"/>
</g>
</g>
</svg>
