<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1278pt" height="377pt"
 viewBox="0.00 0.00 1278.00 376.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 372.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-372.5 1274,-372.5 1274,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_same_ts</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M103,-63.5C103,-63.5 223,-63.5 223,-63.5 229,-63.5 235,-69.5 235,-75.5 235,-75.5 235,-210.5 235,-210.5 235,-216.5 229,-222.5 223,-222.5 223,-222.5 103,-222.5 103,-222.5 97,-222.5 91,-216.5 91,-210.5 91,-210.5 91,-75.5 91,-75.5 91,-69.5 97,-63.5 103,-63.5"/>
<text text-anchor="middle" x="163" y="-202.5" font-family="Times,serif" font-size="20.00">same ts on key1</text>
</g>
<!-- t1__start_ts -->
<g id="node1" class="node">
<title>t1__start_ts</title>
<path fill="#bcffb9" stroke="#8a8898" d="M143,-137.5C143,-137.5 182,-137.5 182,-137.5 188,-137.5 194,-143.5 194,-149.5 194,-149.5 194,-171.5 194,-171.5 194,-177.5 188,-183.5 182,-183.5 182,-183.5 143,-183.5 143,-183.5 137,-183.5 131,-177.5 131,-171.5 131,-171.5 131,-149.5 131,-149.5 131,-143.5 137,-137.5 143,-137.5"/>
<text text-anchor="start" x="139" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="131,-160.5 194,-160.5 "/>
<text text-anchor="start" x="139" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">start_ts</text>
</g>
<!-- t1__mid -->
<g id="node2" class="node">
<title>t1__mid</title>
<path fill="#bcffb9" stroke="#8a8898" d="M275,-192.5C275,-192.5 322,-192.5 322,-192.5 328,-192.5 334,-198.5 334,-204.5 334,-204.5 334,-226.5 334,-226.5 334,-232.5 328,-238.5 322,-238.5 322,-238.5 275,-238.5 275,-238.5 269,-238.5 263,-232.5 263,-226.5 263,-226.5 263,-204.5 263,-204.5 263,-198.5 269,-192.5 275,-192.5"/>
<text text-anchor="start" x="271" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="263,-215.5 334,-215.5 "/>
<text text-anchor="middle" x="298.5" y="-200.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">执行中...</text>
</g>
<!-- t1__start_ts&#45;&gt;t1__mid -->
<g id="edge1" class="edge">
<title>t1__start_ts&#45;&gt;t1__mid</title>
<path fill="none" stroke="#666666" d="M194.24,-173.12C211.69,-180.28 233.84,-189.37 253.14,-197.29"/>
<polygon fill="#666666" stroke="#666666" points="252.07,-200.64 262.65,-201.2 254.73,-194.16 252.07,-200.64"/>
</g>
<!-- WriteRecord -->
<g id="node9" class="node">
<title>WriteRecord</title>
<path fill="none" stroke="#1c2123" d="M777,-0.5C777,-0.5 1060,-0.5 1060,-0.5 1066,-0.5 1072,-6.5 1072,-12.5 1072,-12.5 1072,-256.5 1072,-256.5 1072,-262.5 1066,-268.5 1060,-268.5 1060,-268.5 777,-268.5 777,-268.5 771,-268.5 765,-262.5 765,-256.5 765,-256.5 765,-12.5 765,-12.5 765,-6.5 771,-0.5 777,-0.5"/>
<text text-anchor="middle" x="918.5" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write column</text>
<polyline fill="none" stroke="#1c2123" points="765,-245.5 1072,-245.5 "/>
<text text-anchor="start" x="773" y="-230.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">写到CF_WRITE的kv</text>
<polyline fill="none" stroke="#1c2123" points="765,-222.5 1072,-222.5 "/>
<text text-anchor="start" x="773" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key1 t1.start_ts</text>
<text text-anchor="start" x="773" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和下面的</text>
<text text-anchor="start" x="773" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> t3.commit_ts相同</text>
<polyline fill="none" stroke="#1c2123" points="887,-115.5 887,-222.5 "/>
<text text-anchor="start" x="895" y="-207.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_type: Rollback</text>
<polyline fill="none" stroke="#1c2123" points="887,-199.5 1072,-199.5 "/>
<text text-anchor="start" x="895" y="-184.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: t1.start_ts</text>
<polyline fill="none" stroke="#1c2123" points="887,-176.5 1072,-176.5 "/>
<text text-anchor="start" x="895" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">short_value: t1.short_value</text>
<text text-anchor="start" x="895" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 被用于标记是否要protected</text>
<polyline fill="none" stroke="#1c2123" points="887,-138.5 1072,-138.5 "/>
<text text-anchor="start" x="895" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="765,-115.5 1072,-115.5 "/>
<text text-anchor="middle" x="830.5" y="-65.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">key1 t3.commit_ts</text>
<polyline fill="none" stroke="#1c2123" points="896,-23.5 896,-115.5 "/>
<text text-anchor="start" x="904" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_type: Rollback</text>
<polyline fill="none" stroke="#1c2123" points="896,-92.5 1072,-92.5 "/>
<text text-anchor="start" x="904" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: t3.start_ts</text>
<polyline fill="none" stroke="#1c2123" points="896,-69.5 1072,-69.5 "/>
<text text-anchor="start" x="904" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">short_value: t3.short_value</text>
<polyline fill="none" stroke="#1c2123" points="896,-46.5 1072,-46.5 "/>
<text text-anchor="start" x="904" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="765,-23.5 1072,-23.5 "/>
<text text-anchor="start" x="773" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">...</text>
</g>
<!-- t1__start_ts&#45;&gt;WriteRecord -->
<g id="edge7" class="edge">
<title>t1__start_ts&#45;&gt;WriteRecord:t1</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M194.17,-161.28C281.3,-163.44 538.01,-169.31 754.71,-169.5"/>
<polygon fill="green" stroke="green" points="755,-173 765,-169.5 755,-166 755,-173"/>
</g>
<!-- t1__primary_key__expired -->
<g id="node3" class="node">
<title>t1__primary_key__expired</title>
<path fill="#bcffb9" stroke="#8a8898" d="M455,-189C455,-189 517,-189 517,-189 523,-189 529,-195 529,-201 529,-201 529,-238 529,-238 529,-244 523,-250 517,-250 517,-250 455,-250 455,-250 449,-250 443,-244 443,-238 443,-238 443,-201 443,-201 443,-195 449,-189 455,-189"/>
<text text-anchor="start" x="451" y="-234.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t1</text>
<polyline fill="none" stroke="#8a8898" points="443,-227 529,-227 "/>
<text text-anchor="start" x="451" y="-211.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">primary_key</text>
<text text-anchor="start" x="451" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> expired</text>
</g>
<!-- t1__mid&#45;&gt;t1__primary_key__expired -->
<g id="edge2" class="edge">
<title>t1__mid&#45;&gt;t1__primary_key__expired</title>
<path fill="none" stroke="#666666" d="M334.39,-216.25C362.02,-216.85 401.05,-217.69 432.46,-218.37"/>
<polygon fill="#666666" stroke="#666666" points="432.71,-221.87 442.79,-218.59 432.86,-214.87 432.71,-221.87"/>
</g>
<!-- t1__rollback_lock -->
<g id="node4" class="node">
<title>t1__rollback_lock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M650,-235.5C650,-235.5 717,-235.5 717,-235.5 723,-235.5 729,-241.5 729,-247.5 729,-247.5 729,-269.5 729,-269.5 729,-275.5 723,-281.5 717,-281.5 717,-281.5 650,-281.5 650,-281.5 644,-281.5 638,-275.5 638,-269.5 638,-269.5 638,-247.5 638,-247.5 638,-241.5 644,-235.5 650,-235.5"/>
<text text-anchor="start" x="646" y="-266.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务：t1</text>
<polyline fill="none" stroke="#8a8898" points="638,-258.5 729,-258.5 "/>
<text text-anchor="start" x="646" y="-243.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">rollback_lock</text>
</g>
<!-- t1__primary_key__expired&#45;&gt;t1__rollback_lock -->
<g id="edge3" class="edge">
<title>t1__primary_key__expired&#45;&gt;t1__rollback_lock</title>
<path fill="none" stroke="#666666" d="M529.42,-227.96C558.3,-233.72 596.79,-241.4 627.95,-247.62"/>
<polygon fill="#666666" stroke="#666666" points="627.29,-251.06 637.78,-249.58 628.66,-244.19 627.29,-251.06"/>
</g>
<!-- t1__rollback_lock&#45;&gt;WriteRecord -->
<g id="edge11" class="edge">
<title>t1__rollback_lock&#45;&gt;WriteRecord:t1</title>
<path fill="none" stroke="#666666" d="M693.66,-235.12C704.53,-211.32 725.03,-177.04 754.95,-170.57"/>
<polygon fill="#666666" stroke="#666666" points="755.43,-174.04 765,-169.5 754.68,-167.08 755.43,-174.04"/>
</g>
<!-- set_overlapped_rollback -->
<g id="node10" class="node">
<title>set_overlapped_rollback</title>
<path fill="#feed9b" stroke="#f7e495" d="M1120,-127.5C1120,-127.5 1258,-127.5 1258,-127.5 1264,-127.5 1270,-133.5 1270,-139.5 1270,-139.5 1270,-191.5 1270,-191.5 1270,-197.5 1264,-203.5 1258,-203.5 1258,-203.5 1120,-203.5 1120,-203.5 1114,-203.5 1108,-197.5 1108,-191.5 1108,-191.5 1108,-139.5 1108,-139.5 1108,-133.5 1114,-127.5 1120,-127.5"/>
<text text-anchor="start" x="1116" y="-188.3" font-family="Times,serif" font-size="14.00" fill="#40575d">set_overlapped_rollback</text>
<polyline fill="none" stroke="#f7e495" points="1108,-180.5 1270,-180.5 "/>
<text text-anchor="start" x="1116" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#40575d">将t3的</text>
<text text-anchor="start" x="1116" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> has_overalapped_rollback</text>
<text text-anchor="start" x="1116" y="-135.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 字段设置为true</text>
</g>
<!-- t1__rollback_lock&#45;&gt;set_overlapped_rollback -->
<g id="edge10" class="edge">
<title>t1__rollback_lock&#45;&gt;set_overlapped_rollback</title>
<path fill="none" stroke="#666666" d="M729.24,-272.67C803.56,-293.66 955.77,-325.75 1072,-278.5 1105.49,-264.88 1134.6,-236.44 1155.29,-211.49"/>
<polygon fill="#666666" stroke="#666666" points="1158.15,-213.52 1161.7,-203.54 1152.7,-209.13 1158.15,-213.52"/>
</g>
<!-- t3__start_ts -->
<g id="node5" class="node">
<title>t3__start_ts</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M12,-72.5C12,-72.5 51,-72.5 51,-72.5 57,-72.5 63,-78.5 63,-84.5 63,-84.5 63,-106.5 63,-106.5 63,-112.5 57,-118.5 51,-118.5 51,-118.5 12,-118.5 12,-118.5 6,-118.5 0,-112.5 0,-106.5 0,-106.5 0,-84.5 0,-84.5 0,-78.5 6,-72.5 12,-72.5"/>
<text text-anchor="start" x="8" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t3</text>
<polyline fill="none" stroke="#8a8898" points="0,-95.5 63,-95.5 "/>
<text text-anchor="start" x="8" y="-80.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">start_ts</text>
</g>
<!-- t3__commit_ts -->
<g id="node6" class="node">
<title>t3__commit_ts</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M137,-72.5C137,-72.5 188,-72.5 188,-72.5 194,-72.5 200,-78.5 200,-84.5 200,-84.5 200,-106.5 200,-106.5 200,-112.5 194,-118.5 188,-118.5 188,-118.5 137,-118.5 137,-118.5 131,-118.5 125,-112.5 125,-106.5 125,-106.5 125,-84.5 125,-84.5 125,-78.5 131,-72.5 137,-72.5"/>
<text text-anchor="start" x="133" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务: t3</text>
<polyline fill="none" stroke="#8a8898" points="125,-95.5 200,-95.5 "/>
<text text-anchor="start" x="133" y="-80.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit_ts</text>
</g>
<!-- t3__start_ts&#45;&gt;t3__commit_ts -->
<g id="edge4" class="edge">
<title>t3__start_ts&#45;&gt;t3__commit_ts</title>
<path fill="none" stroke="#666666" d="M63.07,-95.5C78.37,-95.5 97.24,-95.5 114.34,-95.5"/>
<polygon fill="#666666" stroke="#666666" points="114.72,-99 124.72,-95.5 114.72,-92 114.72,-99"/>
</g>
<!-- t3__commit_ts&#45;&gt;WriteRecord -->
<g id="edge8" class="edge">
<title>t3__commit_ts&#45;&gt;WriteRecord:t3</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M200.09,-92.82C292.45,-86.28 542.74,-70.02 754.93,-69.51"/>
<polygon fill="green" stroke="green" points="755,-73.01 765,-69.5 755,-66.01 755,-73.01"/>
</g>
<!-- t2__start_ts -->
<g id="node7" class="node">
<title>t2__start_ts</title>
<path fill="none" stroke="#1c2123" d="M279,-295.5C279,-295.5 318,-295.5 318,-295.5 324,-295.5 330,-301.5 330,-307.5 330,-307.5 330,-329.5 330,-329.5 330,-335.5 324,-341.5 318,-341.5 318,-341.5 279,-341.5 279,-341.5 273,-341.5 267,-335.5 267,-329.5 267,-329.5 267,-307.5 267,-307.5 267,-301.5 273,-295.5 279,-295.5"/>
<text text-anchor="start" x="275" y="-326.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务: t2</text>
<polyline fill="none" stroke="#1c2123" points="267,-318.5 330,-318.5 "/>
<text text-anchor="start" x="275" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts</text>
</g>
<!-- t2__current_ts -->
<g id="node8" class="node">
<title>t2__current_ts</title>
<path fill="none" stroke="#1c2123" d="M382,-269C382,-269 590,-269 590,-269 596,-269 602,-275 602,-281 602,-281 602,-356 602,-356 602,-362 596,-368 590,-368 590,-368 382,-368 382,-368 376,-368 370,-362 370,-356 370,-356 370,-281 370,-281 370,-275 376,-269 382,-269"/>
<text text-anchor="start" x="378" y="-352.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务: t2</text>
<text text-anchor="start" x="378" y="-337.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> current_ts</text>
<polyline fill="none" stroke="#1c2123" points="370,-330 602,-330 "/>
<text text-anchor="start" x="378" y="-314.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务t2执行时发现和t1的lock有冲突</text>
<polyline fill="none" stroke="#1c2123" points="370,-307 602,-307 "/>
<text text-anchor="start" x="378" y="-291.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送CheckTxnStatus命令到TiKV</text>
<text text-anchor="start" x="378" y="-276.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查t1的状态</text>
</g>
<!-- t2__start_ts&#45;&gt;t2__current_ts -->
<g id="edge5" class="edge">
<title>t2__start_ts&#45;&gt;t2__current_ts</title>
<path fill="none" stroke="#666666" d="M330.13,-318.5C338.88,-318.5 348.99,-318.5 359.76,-318.5"/>
<polygon fill="#666666" stroke="#666666" points="359.83,-322 369.83,-318.5 359.83,-315 359.83,-322"/>
</g>
<!-- t2__current_ts&#45;&gt;t1__rollback_lock -->
<g id="edge6" class="edge">
<title>t2__current_ts&#45;&gt;t1__rollback_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M602.14,-283.16C611.09,-280.41 619.85,-277.73 628.09,-275.2"/>
<polygon fill="green" stroke="green" points="629.33,-278.48 637.87,-272.2 627.28,-271.79 629.33,-278.48"/>
</g>
<!-- WriteRecord&#45;&gt;set_overlapped_rollback -->
<g id="edge9" class="edge">
<title>WriteRecord:t3_overlapped_rollback&#45;&gt;set_overlapped_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1072,-34.5C1118.07,-34.5 1150.26,-80.47 1168.85,-117.95"/>
<polygon fill="green" stroke="green" points="1165.83,-119.73 1173.29,-127.26 1172.15,-116.72 1165.83,-119.73"/>
</g>
</g>
</svg>
