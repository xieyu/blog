<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: title Pages: 1 -->
<svg width="1547pt" height="462pt"
 viewBox="0.00 0.00 1547.00 462.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 458)">
<title>title</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-458 1543,-458 1543,4 -4,4"/>
<!-- set_overlapped_rollback -->
<g id="node1" class="node">
<title>set_overlapped_rollback</title>
<path fill="none" stroke="#1c2123" d="M901.5,-195C901.5,-195 776.5,-195 776.5,-195 770.5,-195 764.5,-189 764.5,-183 764.5,-183 764.5,-171 764.5,-171 764.5,-165 770.5,-159 776.5,-159 776.5,-159 901.5,-159 901.5,-159 907.5,-159 913.5,-165 913.5,-171 913.5,-171 913.5,-183 913.5,-183 913.5,-189 907.5,-195 901.5,-195"/>
<text text-anchor="middle" x="839" y="-173.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_overlapped_rollback</text>
</g>
<!-- has_overlapped_rollback -->
<g id="node2" class="node">
<title>has_overlapped_rollback</title>
<path fill="#feed9b" stroke="#f7e495" d="M970,-105C970,-105 1098,-105 1098,-105 1104,-105 1110,-111 1110,-117 1110,-117 1110,-129 1110,-129 1110,-135 1104,-141 1098,-141 1098,-141 970,-141 970,-141 964,-141 958,-135 958,-129 958,-129 958,-117 958,-117 958,-111 964,-105 970,-105"/>
<text text-anchor="middle" x="1034" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#40575d">has_overlapped_rollback</text>
</g>
<!-- set_overlapped_rollback&#45;&gt;has_overlapped_rollback -->
<g id="edge1" class="edge">
<title>set_overlapped_rollback&#45;&gt;has_overlapped_rollback</title>
<path fill="none" stroke="#666666" d="M904.53,-158.94C921.92,-154.08 940.86,-148.78 958.73,-143.78"/>
<polygon fill="#666666" stroke="#666666" points="959.84,-147.1 968.53,-141.04 957.95,-140.36 959.84,-147.1"/>
</g>
<!-- gc_fence -->
<g id="node4" class="node">
<title>gc_fence</title>
<path fill="#feed9b" stroke="#f7e495" d="M1013.5,-160C1013.5,-160 1054.5,-160 1054.5,-160 1060.5,-160 1066.5,-166 1066.5,-172 1066.5,-172 1066.5,-184 1066.5,-184 1066.5,-190 1060.5,-196 1054.5,-196 1054.5,-196 1013.5,-196 1013.5,-196 1007.5,-196 1001.5,-190 1001.5,-184 1001.5,-184 1001.5,-172 1001.5,-172 1001.5,-166 1007.5,-160 1013.5,-160"/>
<text text-anchor="middle" x="1034" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#40575d">gc_fence</text>
</g>
<!-- set_overlapped_rollback&#45;&gt;gc_fence -->
<g id="edge3" class="edge">
<title>set_overlapped_rollback&#45;&gt;gc_fence</title>
<path fill="none" stroke="#666666" d="M913.52,-177.38C939.72,-177.52 968.34,-177.66 990.99,-177.78"/>
<polygon fill="#666666" stroke="#666666" points="991.25,-181.28 1001.27,-177.84 991.29,-174.28 991.25,-181.28"/>
</g>
<!-- get_txn_commit_record -->
<g id="node3" class="node">
<title>get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M1159,-0.5C1159,-0.5 1362,-0.5 1362,-0.5 1368,-0.5 1374,-6.5 1374,-12.5 1374,-12.5 1374,-109.5 1374,-109.5 1374,-115.5 1368,-121.5 1362,-121.5 1362,-121.5 1159,-121.5 1159,-121.5 1153,-121.5 1147,-115.5 1147,-109.5 1147,-109.5 1147,-12.5 1147,-12.5 1147,-6.5 1153,-0.5 1159,-0.5"/>
<text text-anchor="middle" x="1260.5" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_txn_commit_record</text>
<polyline fill="none" stroke="#1c2123" points="1147,-98.5 1374,-98.5 "/>
<text text-anchor="start" x="1155" y="-83.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历key从max到start_ts </text>
<text text-anchor="start" x="1155" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 所有write version</text>
<text text-anchor="start" x="1155" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果事务的commit_ts == start_ts</text>
<text text-anchor="start" x="1155" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 再根据has_overlapped_rollback标记</text>
<text text-anchor="start" x="1155" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 确定是返回OverlappedRollback</text>
<text text-anchor="start" x="1155" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 还是OverlappedWrite</text>
</g>
<!-- has_overlapped_rollback&#45;&gt;get_txn_commit_record -->
<g id="edge2" class="edge">
<title>has_overlapped_rollback&#45;&gt;get_txn_commit_record</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1100.24,-104.98C1111.89,-101.76 1124.38,-98.32 1137.04,-94.82"/>
<polygon fill="green" stroke="green" points="1138.03,-98.18 1146.74,-92.14 1136.17,-91.43 1138.03,-98.18"/>
</g>
<!-- OverlappedRollback -->
<g id="node9" class="node">
<title>OverlappedRollback</title>
<path fill="none" stroke="#1c2123" d="M1527,-155C1527,-155 1423,-155 1423,-155 1417,-155 1411,-149 1411,-143 1411,-143 1411,-131 1411,-131 1411,-125 1417,-119 1423,-119 1423,-119 1527,-119 1527,-119 1533,-119 1539,-125 1539,-131 1539,-131 1539,-143 1539,-143 1539,-149 1533,-155 1527,-155"/>
<text text-anchor="middle" x="1475" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">OverlappedRollback</text>
</g>
<!-- has_overlapped_rollback&#45;&gt;OverlappedRollback -->
<g id="edge11" class="edge">
<title>has_overlapped_rollback&#45;&gt;OverlappedRollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1110.28,-128.93C1122.54,-129.73 1135.12,-130.47 1147,-131 1234.09,-134.91 1334.34,-136.29 1400.63,-136.76"/>
<polygon fill="green" stroke="green" points="1400.95,-140.27 1410.98,-136.83 1401,-133.27 1400.95,-140.27"/>
<text text-anchor="middle" x="1260.5" y="-140.8" font-family="Times,serif" font-size="14.00">true</text>
</g>
<!-- get_txn_commit_record&#45;&gt;OverlappedRollback -->
<g id="edge12" class="edge">
<title>get_txn_commit_record&#45;&gt;OverlappedRollback</title>
<path fill="none" stroke="#666666" d="M1374.28,-101.34C1387.92,-106.21 1401.42,-111.04 1413.86,-115.49"/>
<polygon fill="#666666" stroke="#666666" points="1413.01,-118.9 1423.6,-118.98 1415.37,-112.31 1413.01,-118.9"/>
</g>
<!-- OverlappedWrite -->
<g id="node10" class="node">
<title>OverlappedWrite</title>
<path fill="none" stroke="#1c2123" d="M1518,-79C1518,-79 1432,-79 1432,-79 1426,-79 1420,-73 1420,-67 1420,-67 1420,-55 1420,-55 1420,-49 1426,-43 1432,-43 1432,-43 1518,-43 1518,-43 1524,-43 1530,-49 1530,-55 1530,-55 1530,-67 1530,-67 1530,-73 1524,-79 1518,-79"/>
<text text-anchor="middle" x="1475" y="-57.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">OverlappedWrite</text>
</g>
<!-- get_txn_commit_record&#45;&gt;OverlappedWrite -->
<g id="edge13" class="edge">
<title>get_txn_commit_record&#45;&gt;OverlappedWrite</title>
<path fill="none" stroke="#666666" d="M1374.28,-61C1386.45,-61 1398.51,-61 1409.8,-61"/>
<polygon fill="#666666" stroke="#666666" points="1409.95,-64.5 1419.95,-61 1409.95,-57.5 1409.95,-64.5"/>
</g>
<!-- make_rollback -->
<g id="node5" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M556,-235C556,-235 687,-235 687,-235 693,-235 699,-241 699,-247 699,-247 699,-337 699,-337 699,-343 693,-349 687,-349 687,-349 556,-349 556,-349 550,-349 544,-343 544,-337 544,-337 544,-247 544,-247 544,-241 550,-235 556,-235"/>
<text text-anchor="middle" x="621.5" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
<polyline fill="none" stroke="#1c2123" points="544,-326 699,-326 "/>
<text text-anchor="start" x="552" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Generate the write record</text>
<text text-anchor="start" x="552" y="-295.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> that should be written </text>
<text text-anchor="start" x="552" y="-280.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> that means to perform a </text>
<text text-anchor="start" x="552" y="-265.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> specified rollback</text>
<polyline fill="none" stroke="#1c2123" points="544,-258 699,-258 "/>
<text text-anchor="start" x="552" y="-242.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果protected</text>
</g>
<!-- make_rollback&#45;&gt;set_overlapped_rollback -->
<g id="edge4" class="edge">
<title>make_rollback&#45;&gt;set_overlapped_rollback</title>
<path fill="none" stroke="#666666" d="M699.08,-251.13C731.37,-233.9 767.73,-214.5 795.15,-199.86"/>
<polygon fill="#666666" stroke="#666666" points="796.92,-202.89 804.09,-195.09 793.62,-196.71 796.92,-202.89"/>
</g>
<!-- put_write -->
<g id="node7" class="node">
<title>put_write</title>
<path fill="none" stroke="#1c2123" d="M769,-340C769,-340 909,-340 909,-340 915,-340 921,-346 921,-352 921,-352 921,-404 921,-404 921,-410 915,-416 909,-416 909,-416 769,-416 769,-416 763,-416 757,-410 757,-404 757,-404 757,-352 757,-352 757,-346 763,-340 769,-340"/>
<text text-anchor="middle" x="839" y="-400.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">put_write</text>
<polyline fill="none" stroke="#1c2123" points="757,-393 921,-393 "/>
<text text-anchor="start" x="765" y="-377.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">写入rollback record</text>
<text text-anchor="start" x="765" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应write的commit_ts为</text>
<text text-anchor="start" x="765" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 事务的start_ts</text>
</g>
<!-- make_rollback&#45;&gt;put_write -->
<g id="edge7" class="edge">
<title>make_rollback&#45;&gt;put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M699.08,-322.56C714.76,-328.82 731.4,-335.46 747.51,-341.89"/>
<polygon fill="green" stroke="green" points="746.33,-345.19 756.92,-345.64 748.93,-338.69 746.33,-345.19"/>
</g>
<!-- rollback_lock -->
<g id="node6" class="node">
<title>rollback_lock</title>
<path fill="none" stroke="#1c2123" d="M241,-421C241,-421 174,-421 174,-421 168,-421 162,-415 162,-409 162,-409 162,-397 162,-397 162,-391 168,-385 174,-385 174,-385 241,-385 241,-385 247,-385 253,-391 253,-397 253,-397 253,-409 253,-409 253,-415 247,-421 241,-421"/>
<text text-anchor="middle" x="207.5" y="-399.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_lock</text>
</g>
<!-- rollback_lock&#45;&gt;get_txn_commit_record -->
<g id="edge5" class="edge">
<title>rollback_lock&#45;&gt;get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M253.09,-412.18C328.43,-426.86 485.9,-454 620.5,-454 620.5,-454 620.5,-454 1035,-454 1185.32,-454 1055.62,-254.8 1145.46,-129.72"/>
<polygon fill="#666666" stroke="#666666" points="1148.39,-131.66 1151.7,-121.6 1142.84,-127.4 1148.39,-131.66"/>
</g>
<!-- rollback_lock&#45;&gt;make_rollback -->
<g id="edge6" class="edge">
<title>rollback_lock&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M253.38,-390.91C320.55,-372.81 448.49,-338.34 534.17,-315.26"/>
<polygon fill="#666666" stroke="#666666" points="535.13,-318.62 543.88,-312.64 533.31,-311.87 535.13,-318.62"/>
</g>
<!-- rollback_lock&#45;&gt;put_write -->
<g id="edge8" class="edge">
<title>rollback_lock&#45;&gt;put_write</title>
<path fill="none" stroke="#666666" d="M253.3,-403.88C344.77,-405.27 559.49,-406.5 739,-392 741.54,-391.8 744.11,-391.57 746.7,-391.32"/>
<polygon fill="#666666" stroke="#666666" points="747.19,-394.79 756.78,-390.28 746.47,-387.83 747.19,-394.79"/>
</g>
<!-- protected -->
<g id="node8" class="node">
<title>protected</title>
<path fill="#feed9b" stroke="#f7e495" d="M558.5,-100.5C558.5,-100.5 684.5,-100.5 684.5,-100.5 690.5,-100.5 696.5,-106.5 696.5,-112.5 696.5,-112.5 696.5,-149.5 696.5,-149.5 696.5,-155.5 690.5,-161.5 684.5,-161.5 684.5,-161.5 558.5,-161.5 558.5,-161.5 552.5,-161.5 546.5,-155.5 546.5,-149.5 546.5,-149.5 546.5,-112.5 546.5,-112.5 546.5,-106.5 552.5,-100.5 558.5,-100.5"/>
<text text-anchor="middle" x="621.5" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#40575d">protected</text>
<polyline fill="none" stroke="#f7e495" points="546.5,-138.5 696.5,-138.5 "/>
<text text-anchor="start" x="554.5" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#40575d">悲观事务的primay key</text>
<text text-anchor="start" x="554.5" y="-108.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 需要protected</text>
</g>
<!-- protected&#45;&gt;set_overlapped_rollback -->
<g id="edge9" class="edge">
<title>protected&#45;&gt;set_overlapped_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M696.66,-146.83C715.33,-150.81 735.48,-155.12 754.56,-159.19"/>
<polygon fill="green" stroke="green" points="753.92,-162.63 764.43,-161.3 755.38,-155.79 753.92,-162.63"/>
</g>
<!-- protected&#45;&gt;has_overlapped_rollback -->
<g id="edge10" class="edge">
<title>protected&#45;&gt;has_overlapped_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M696.84,-129.55C767.45,-128.18 873.54,-126.11 947.6,-124.66"/>
<polygon fill="green" stroke="green" points="947.9,-128.16 957.83,-124.46 947.76,-121.16 947.9,-128.16"/>
<text text-anchor="middle" x="839" y="-132.8" font-family="Times,serif" font-size="14.00">true</text>
</g>
<!-- CheckSecondaryLocks_process_write -->
<g id="node11" class="node">
<title>CheckSecondaryLocks_process_write</title>
<path fill="none" stroke="#1c2123" d="M307,-246C307,-246 108,-246 108,-246 102,-246 96,-240 96,-234 96,-234 96,-222 96,-222 96,-216 102,-210 108,-210 108,-210 307,-210 307,-210 313,-210 319,-216 319,-222 319,-222 319,-234 319,-234 319,-240 313,-246 307,-246"/>
<text text-anchor="middle" x="207.5" y="-224.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks_process_write</text>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;has_overlapped_rollback -->
<g id="edge17" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;has_overlapped_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M240.51,-209.97C298.71,-178.34 426.7,-114.03 544,-91 683.63,-63.59 849.54,-85.66 947.79,-104.25"/>
<polygon fill="green" stroke="green" points="947.19,-107.7 957.67,-106.15 948.51,-100.82 947.19,-107.7"/>
<text text-anchor="middle" x="728" y="-83.8" font-family="Times,serif" font-size="14.00">true</text>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;make_rollback -->
<g id="edge14" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M319.18,-245.19C386.46,-255.64 471.15,-268.8 533.59,-278.5"/>
<polygon fill="#666666" stroke="#666666" points="533.39,-282.01 543.81,-280.09 534.46,-275.09 533.39,-282.01"/>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;put_write -->
<g id="edge15" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;put_write</title>
<path fill="none" stroke="#666666" d="M244.08,-246.14C304.12,-275.75 430.15,-333.73 544,-359 610.77,-373.82 688,-378.34 746.55,-379.28"/>
<polygon fill="#666666" stroke="#666666" points="746.84,-382.78 756.89,-379.41 746.93,-375.78 746.84,-382.78"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node12" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M681,-216C681,-216 562,-216 562,-216 556,-216 550,-210 550,-204 550,-204 550,-192 550,-192 550,-186 556,-180 562,-180 562,-180 681,-180 681,-180 687,-180 693,-186 693,-192 693,-192 693,-204 693,-204 693,-210 687,-216 681,-216"/>
<text text-anchor="middle" x="621.5" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;collapse_prev_rollback -->
<g id="edge16" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M319.18,-219.94C388.61,-214.89 476.56,-208.48 539.5,-203.9"/>
<polygon fill="#666666" stroke="#666666" points="540.05,-207.37 549.77,-203.15 539.54,-200.39 540.05,-207.37"/>
</g>
<!-- cleanup -->
<g id="node13" class="node">
<title>cleanup</title>
<path fill="none" stroke="#1c2123" d="M47,-123C47,-123 12,-123 12,-123 6,-123 0,-117 0,-111 0,-111 0,-99 0,-99 0,-93 6,-87 12,-87 12,-87 47,-87 47,-87 53,-87 59,-93 59,-99 59,-99 59,-111 59,-111 59,-117 53,-123 47,-123"/>
<text text-anchor="middle" x="29.5" y="-101.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleanup</text>
</g>
<!-- cleanup&#45;&gt;rollback_lock -->
<g id="edge18" class="edge">
<title>cleanup&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M36.89,-123.19C47.38,-152.08 69.72,-209.8 96,-255 122.4,-300.42 160.26,-348.32 184.11,-376.92"/>
<polygon fill="#666666" stroke="#666666" points="181.62,-379.4 190.73,-384.81 186.98,-374.9 181.62,-379.4"/>
</g>
<!-- check_txn_status_missing_lock -->
<g id="node14" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="none" stroke="#1c2123" d="M514,-55C514,-55 349,-55 349,-55 343,-55 337,-49 337,-43 337,-43 337,-31 337,-31 337,-25 343,-19 349,-19 349,-19 514,-19 514,-19 520,-19 526,-25 526,-31 526,-31 526,-43 526,-43 526,-49 520,-55 514,-55"/>
<text text-anchor="middle" x="431.5" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_txn_status_missing_lock</text>
</g>
<!-- cleanup&#45;&gt;check_txn_status_missing_lock -->
<g id="edge19" class="edge">
<title>cleanup&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="#666666" d="M59.27,-100.11C114.43,-90.73 237.54,-69.8 326.9,-54.61"/>
<polygon fill="#666666" stroke="#666666" points="327.53,-58.06 336.8,-52.93 326.36,-51.15 327.53,-58.06"/>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;get_txn_commit_record -->
<g id="edge20" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M526,-35.56C583.89,-34.79 659.76,-34 727,-34 727,-34 727,-34 1035,-34 1068.09,-34 1103.72,-36.93 1136.64,-40.85"/>
<polygon fill="#666666" stroke="#666666" points="1136.41,-44.35 1146.76,-42.1 1137.26,-37.4 1136.41,-44.35"/>
</g>
</g>
</svg>
