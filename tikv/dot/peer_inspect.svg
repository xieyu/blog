<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: peer_inspect Pages: 1 -->
<svg width="977pt" height="538pt"
 viewBox="0.00 0.00 977.00 538.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 534)">
<title>peer_inspect</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-534 973,-534 973,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RaftRs</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M535,-164C535,-164 713,-164 713,-164 719,-164 725,-170 725,-176 725,-176 725,-260 725,-260 725,-266 719,-272 713,-272 713,-272 535,-272 535,-272 529,-272 523,-266 523,-260 523,-260 523,-176 523,-176 523,-170 529,-164 535,-164"/>
<text text-anchor="middle" x="624" y="-252" font-family="Times,serif" font-size="20.00">raft&#45;rs</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_Lease</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M600.5,-8C600.5,-8 949,-8 949,-8 955,-8 961,-14 961,-20 961,-20 961,-144 961,-144 961,-150 955,-156 949,-156 949,-156 600.5,-156 600.5,-156 594.5,-156 588.5,-150 588.5,-144 588.5,-144 588.5,-20 588.5,-20 588.5,-14 594.5,-8 600.5,-8"/>
<text text-anchor="middle" x="774.75" y="-136" font-family="Times,serif" font-size="20.00">Lease</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_Peer</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-280C20,-280 929,-280 929,-280 935,-280 941,-286 941,-292 941,-292 941,-510 941,-510 941,-516 935,-522 929,-522 929,-522 20,-522 20,-522 14,-522 8,-516 8,-510 8,-510 8,-292 8,-292 8,-286 14,-280 20,-280"/>
<text text-anchor="middle" x="474.5" y="-502" font-family="Times,serif" font-size="20.00">Peer</text>
</g>
<!-- in_lease -->
<g id="node1" class="node">
<title>in_lease</title>
<path fill="none" stroke="#1c2123" d="M543,-172.5C543,-172.5 705,-172.5 705,-172.5 711,-172.5 717,-178.5 717,-184.5 717,-184.5 717,-221.5 717,-221.5 717,-227.5 711,-233.5 705,-233.5 705,-233.5 543,-233.5 543,-233.5 537,-233.5 531,-227.5 531,-221.5 531,-221.5 531,-184.5 531,-184.5 531,-178.5 537,-172.5 543,-172.5"/>
<text text-anchor="middle" x="624" y="-218.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">in_lease</text>
<polyline fill="none" stroke="#1c2123" points="531,-210.5 717,-210.5 "/>
<text text-anchor="start" x="539" y="-195.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.state == StateRole::Leader</text>
<text text-anchor="start" x="539" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &amp;&amp; self.check_quorum</text>
</g>
<!-- bound -->
<g id="node2" class="node">
<title>bound</title>
<path fill="#feed9b" stroke="#f7e495" d="M765,-17C765,-17 941,-17 941,-17 947,-17 953,-23 953,-29 953,-29 953,-51 953,-51 953,-57 947,-63 941,-63 941,-63 765,-63 765,-63 759,-63 753,-57 753,-51 753,-51 753,-29 753,-29 753,-23 759,-17 765,-17"/>
<text text-anchor="middle" x="853" y="-47.8" font-family="Times,serif" font-size="14.00" fill="#40575d">bound</text>
<polyline fill="none" stroke="#f7e495" points="753,-40 953,-40 "/>
<text text-anchor="middle" x="853" y="-24.8" font-family="Times,serif" font-size="14.00" fill="#40575d">bound = self.next_expired_time()</text>
</g>
<!-- Lease_inspect -->
<g id="node3" class="node">
<title>Lease_inspect</title>
<path fill="none" stroke="#1c2123" d="M608.5,-81C608.5,-81 639.5,-81 639.5,-81 645.5,-81 651.5,-87 651.5,-93 651.5,-93 651.5,-105 651.5,-105 651.5,-111 645.5,-117 639.5,-117 639.5,-117 608.5,-117 608.5,-117 602.5,-117 596.5,-111 596.5,-105 596.5,-105 596.5,-93 596.5,-93 596.5,-87 602.5,-81 608.5,-81"/>
<text text-anchor="middle" x="624" y="-95.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">inspect</text>
</g>
<!-- Lease_inspect&#45;&gt;bound -->
<g id="edge1" class="edge">
<title>Lease_inspect&#45;&gt;bound</title>
<path fill="none" stroke="#666666" d="M651.93,-92C677.16,-85.44 716.43,-75.24 753.53,-65.59"/>
<polygon fill="#666666" stroke="#666666" points="754.61,-68.93 763.41,-63.03 752.85,-62.15 754.61,-68.93"/>
</g>
<!-- monotonic_raw_now -->
<g id="node4" class="node">
<title>monotonic_raw_now</title>
<path fill="none" stroke="#1c2123" d="M907,-118C907,-118 799,-118 799,-118 793,-118 787,-112 787,-106 787,-106 787,-94 787,-94 787,-88 793,-82 799,-82 799,-82 907,-82 907,-82 913,-82 919,-88 919,-94 919,-94 919,-106 919,-106 919,-112 913,-118 907,-118"/>
<text text-anchor="middle" x="853" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">monotonic_raw_now</text>
</g>
<!-- Lease_inspect&#45;&gt;monotonic_raw_now -->
<g id="edge2" class="edge">
<title>Lease_inspect&#45;&gt;monotonic_raw_now</title>
<path fill="none" stroke="#666666" d="M651.93,-99.12C682.48,-99.25 733.64,-99.48 776.57,-99.67"/>
<polygon fill="#666666" stroke="#666666" points="776.71,-103.17 786.73,-99.71 776.74,-96.17 776.71,-103.17"/>
</g>
<!-- not_has_applied_to_current_term -->
<g id="node5" class="node">
<title>not_has_applied_to_current_term</title>
<path fill="none" stroke="#1c2123" d="M214,-369C214,-369 483,-369 483,-369 489,-369 495,-375 495,-381 495,-381 495,-471 495,-471 495,-477 489,-483 483,-483 483,-483 214,-483 214,-483 208,-483 202,-477 202,-471 202,-471 202,-381 202,-381 202,-375 208,-369 214,-369"/>
<text text-anchor="middle" x="348.5" y="-467.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">!self.has_applied_to_current_term()</text>
<polyline fill="none" stroke="#1c2123" points="202,-460 495,-460 "/>
<text text-anchor="start" x="210" y="-444.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">If applied index&#39;s term is differ</text>
<text text-anchor="start" x="210" y="-429.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> from current raft&#39;s term, leader transfer</text>
<text text-anchor="start" x="210" y="-414.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> must happened, if read locally, </text>
<text text-anchor="start" x="210" y="-399.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> we may read old value.</text>
<polyline fill="none" stroke="#1c2123" points="202,-392 495,-392 "/>
<text text-anchor="middle" x="348.5" y="-376.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.get_store().applied_index_term() == self.term</text>
</g>
<!-- RequestPolicy_ReadIndex -->
<g id="node9" class="node">
<title>RequestPolicy_ReadIndex</title>
<path fill="none" stroke="#1c2123" d="M921,-432C921,-432 785,-432 785,-432 779,-432 773,-426 773,-420 773,-420 773,-408 773,-408 773,-402 779,-396 785,-396 785,-396 921,-396 921,-396 927,-396 933,-402 933,-408 933,-408 933,-420 933,-420 933,-426 927,-432 921,-432"/>
<text text-anchor="middle" x="853" y="-410.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RequestPolicy_ReadIndex</text>
</g>
<!-- not_has_applied_to_current_term&#45;&gt;RequestPolicy_ReadIndex -->
<g id="edge6" class="edge">
<title>not_has_applied_to_current_term&#45;&gt;RequestPolicy_ReadIndex</title>
<path fill="none" stroke="#666666" d="M495.15,-441.59C564.85,-446.55 649.41,-448.95 725,-441 739.57,-439.47 754.93,-436.97 769.74,-434.1"/>
<polygon fill="#666666" stroke="#666666" points="770.77,-437.47 779.89,-432.06 769.39,-430.6 770.77,-437.47"/>
</g>
<!-- inspect_lease -->
<g id="node6" class="node">
<title>inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M246.5,-288.5C246.5,-288.5 450.5,-288.5 450.5,-288.5 456.5,-288.5 462.5,-294.5 462.5,-300.5 462.5,-300.5 462.5,-337.5 462.5,-337.5 462.5,-343.5 456.5,-349.5 450.5,-349.5 450.5,-349.5 246.5,-349.5 246.5,-349.5 240.5,-349.5 234.5,-343.5 234.5,-337.5 234.5,-337.5 234.5,-300.5 234.5,-300.5 234.5,-294.5 240.5,-288.5 246.5,-288.5"/>
<text text-anchor="middle" x="348.5" y="-334.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">inspect_lease</text>
<polyline fill="none" stroke="#1c2123" points="234.5,-326.5 462.5,-326.5 "/>
<text text-anchor="start" x="242.5" y="-311.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用raft&#45;rs检查是否在in_lease</text>
<text text-anchor="start" x="242.5" y="-296.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查Lease是否在bound时间范围内</text>
</g>
<!-- inspect_lease&#45;&gt;in_lease -->
<g id="edge10" class="edge">
<title>inspect_lease&#45;&gt;in_lease</title>
<path fill="none" stroke="#666666" d="M421.72,-288.37C458.48,-272.78 503.32,-253.76 541.34,-237.63"/>
<polygon fill="#666666" stroke="#666666" points="543.01,-240.73 550.85,-233.6 540.28,-234.28 543.01,-240.73"/>
</g>
<!-- inspect_lease&#45;&gt;Lease_inspect -->
<g id="edge11" class="edge">
<title>inspect_lease&#45;&gt;Lease_inspect</title>
<path fill="none" stroke="#666666" d="M379.26,-288.37C412.62,-254.86 469.12,-200.52 523,-160 543.35,-144.7 567.7,-129.78 587.29,-118.52"/>
<polygon fill="#666666" stroke="#666666" points="589.23,-121.45 596.19,-113.46 585.77,-115.36 589.23,-121.45"/>
</g>
<!-- LeaseState_Valid -->
<g id="node10" class="node">
<title>LeaseState_Valid</title>
<path fill="none" stroke="#1c2123" d="M667,-324C667,-324 581,-324 581,-324 575,-324 569,-318 569,-312 569,-312 569,-300 569,-300 569,-294 575,-288 581,-288 581,-288 667,-288 667,-288 673,-288 679,-294 679,-300 679,-300 679,-312 679,-312 679,-318 673,-324 667,-324"/>
<text text-anchor="middle" x="624" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaseState_Valid</text>
</g>
<!-- inspect_lease&#45;&gt;LeaseState_Valid -->
<g id="edge7" class="edge">
<title>inspect_lease&#45;&gt;LeaseState_Valid</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M462.72,-313.62C495.44,-312.06 530.01,-310.42 558.64,-309.06"/>
<polygon fill="green" stroke="green" points="559.08,-312.54 568.9,-308.57 558.75,-305.55 559.08,-312.54"/>
</g>
<!-- LeaseState_Expired -->
<g id="node11" class="node">
<title>LeaseState_Expired</title>
<path fill="none" stroke="#1c2123" d="M674.5,-432C674.5,-432 573.5,-432 573.5,-432 567.5,-432 561.5,-426 561.5,-420 561.5,-420 561.5,-408 561.5,-408 561.5,-402 567.5,-396 573.5,-396 573.5,-396 674.5,-396 674.5,-396 680.5,-396 686.5,-402 686.5,-408 686.5,-408 686.5,-420 686.5,-420 686.5,-426 680.5,-432 674.5,-432"/>
<text text-anchor="middle" x="624" y="-410.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaseState_Expired</text>
</g>
<!-- inspect_lease&#45;&gt;LeaseState_Expired -->
<g id="edge8" class="edge">
<title>inspect_lease&#45;&gt;LeaseState_Expired</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M462.6,-344.81C473.87,-349.16 484.87,-354.19 495,-360 509.99,-368.6 507.96,-378.48 523,-387 531.89,-392.04 541.77,-396.17 551.75,-399.55"/>
<polygon fill="green" stroke="green" points="550.73,-402.9 561.32,-402.56 552.83,-396.22 550.73,-402.9"/>
</g>
<!-- LeaseState_Suspect -->
<g id="node12" class="node">
<title>LeaseState_Suspect</title>
<path fill="none" stroke="#1c2123" d="M674,-378C674,-378 574,-378 574,-378 568,-378 562,-372 562,-366 562,-366 562,-354 562,-354 562,-348 568,-342 574,-342 574,-342 674,-342 674,-342 680,-342 686,-348 686,-354 686,-354 686,-366 686,-366 686,-372 680,-378 674,-378"/>
<text text-anchor="middle" x="624" y="-356.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaseState_Suspect</text>
</g>
<!-- inspect_lease&#45;&gt;LeaseState_Suspect -->
<g id="edge9" class="edge">
<title>inspect_lease&#45;&gt;LeaseState_Suspect</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M462.72,-335.97C492.82,-340.48 524.49,-345.23 551.65,-349.3"/>
<polygon fill="green" stroke="green" points="551.42,-352.81 561.83,-350.83 552.46,-345.89 551.42,-352.81"/>
</g>
<!-- propose -->
<g id="node7" class="node">
<title>propose</title>
<path fill="none" stroke="#1c2123" d="M63,-390C63,-390 28,-390 28,-390 22,-390 16,-384 16,-378 16,-378 16,-366 16,-366 16,-360 22,-354 28,-354 28,-354 63,-354 63,-354 69,-354 75,-360 75,-366 75,-366 75,-378 75,-378 75,-384 69,-390 63,-390"/>
<text text-anchor="middle" x="45.5" y="-368.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">propose</text>
</g>
<!-- inspect -->
<g id="node8" class="node">
<title>inspect</title>
<path fill="none" stroke="#1c2123" d="M154,-390C154,-390 123,-390 123,-390 117,-390 111,-384 111,-378 111,-378 111,-366 111,-366 111,-360 117,-354 123,-354 123,-354 154,-354 154,-354 160,-354 166,-360 166,-366 166,-366 166,-378 166,-378 166,-384 160,-390 154,-390"/>
<text text-anchor="middle" x="138.5" y="-368.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">inspect</text>
</g>
<!-- propose&#45;&gt;inspect -->
<g id="edge3" class="edge">
<title>propose&#45;&gt;inspect</title>
<path fill="none" stroke="#666666" d="M75.29,-372C83.36,-372 92.25,-372 100.71,-372"/>
<polygon fill="#666666" stroke="#666666" points="100.75,-375.5 110.75,-372 100.75,-368.5 100.75,-375.5"/>
</g>
<!-- inspect&#45;&gt;not_has_applied_to_current_term -->
<g id="edge4" class="edge">
<title>inspect&#45;&gt;not_has_applied_to_current_term</title>
<path fill="none" stroke="#666666" d="M166.27,-378.95C173.76,-380.89 182.47,-383.16 191.94,-385.62"/>
<polygon fill="#666666" stroke="#666666" points="191.1,-389.01 201.66,-388.14 192.86,-382.24 191.1,-389.01"/>
</g>
<!-- inspect&#45;&gt;inspect_lease -->
<g id="edge5" class="edge">
<title>inspect&#45;&gt;inspect_lease</title>
<path fill="none" stroke="#666666" d="M166.27,-365.18C181.75,-361.23 202.47,-355.96 224.35,-350.38"/>
<polygon fill="#666666" stroke="#666666" points="225.31,-353.75 234.14,-347.89 223.58,-346.96 225.31,-353.75"/>
</g>
<!-- RequestPolicy_ReadLocal -->
<g id="node13" class="node">
<title>RequestPolicy_ReadLocal</title>
<path fill="none" stroke="#1c2123" d="M921,-324C921,-324 785,-324 785,-324 779,-324 773,-318 773,-312 773,-312 773,-300 773,-300 773,-294 779,-288 785,-288 785,-288 921,-288 921,-288 927,-288 933,-294 933,-300 933,-300 933,-312 933,-312 933,-318 927,-324 921,-324"/>
<text text-anchor="middle" x="853" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RequestPolicy_ReadLocal</text>
</g>
<!-- LeaseState_Valid&#45;&gt;RequestPolicy_ReadLocal -->
<g id="edge12" class="edge">
<title>LeaseState_Valid&#45;&gt;RequestPolicy_ReadLocal</title>
<path fill="none" stroke="#666666" d="M679.08,-306C704.08,-306 734.42,-306 762.68,-306"/>
<polygon fill="#666666" stroke="#666666" points="762.98,-309.5 772.98,-306 762.98,-302.5 762.98,-309.5"/>
</g>
<!-- LeaseState_Expired&#45;&gt;RequestPolicy_ReadIndex -->
<g id="edge13" class="edge">
<title>LeaseState_Expired&#45;&gt;RequestPolicy_ReadIndex</title>
<path fill="none" stroke="#666666" d="M686.73,-414C710.14,-414 737.29,-414 762.74,-414"/>
<polygon fill="#666666" stroke="#666666" points="762.77,-417.5 772.77,-414 762.77,-410.5 762.77,-417.5"/>
</g>
<!-- LeaseState_Suspect&#45;&gt;RequestPolicy_ReadIndex -->
<g id="edge14" class="edge">
<title>LeaseState_Suspect&#45;&gt;RequestPolicy_ReadIndex</title>
<path fill="none" stroke="#666666" d="M686.13,-374.54C710.7,-380.39 739.46,-387.23 766.07,-393.56"/>
<polygon fill="#666666" stroke="#666666" points="765.61,-397.05 776.15,-395.96 767.23,-390.24 765.61,-397.05"/>
</g>
</g>
</svg>
