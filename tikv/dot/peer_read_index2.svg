<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: peer_read_index2 Pages: 1 -->
<svg width="1277pt" height="928pt"
 viewBox="0.00 0.00 1277.00 927.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 923.5)">
<title>peer_read_index2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-923.5 1273,-923.5 1273,4 -4,4"/>
<!-- Peer__propose -->
<g id="node1" class="node">
<title>Peer__propose</title>
<path fill="none" stroke="#1c2123" d="M85,-482.5C85,-482.5 12,-482.5 12,-482.5 6,-482.5 0,-476.5 0,-470.5 0,-470.5 0,-458.5 0,-458.5 0,-452.5 6,-446.5 12,-446.5 12,-446.5 85,-446.5 85,-446.5 91,-446.5 97,-452.5 97,-458.5 97,-458.5 97,-470.5 97,-470.5 97,-476.5 91,-482.5 85,-482.5"/>
<text text-anchor="middle" x="48.5" y="-460.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__propose</text>
</g>
<!-- Peer__inspect -->
<g id="node2" class="node">
<title>Peer__inspect</title>
<path fill="none" stroke="#1c2123" d="M224,-509.5C224,-509.5 156,-509.5 156,-509.5 150,-509.5 144,-503.5 144,-497.5 144,-497.5 144,-485.5 144,-485.5 144,-479.5 150,-473.5 156,-473.5 156,-473.5 224,-473.5 224,-473.5 230,-473.5 236,-479.5 236,-485.5 236,-485.5 236,-497.5 236,-497.5 236,-503.5 230,-509.5 224,-509.5"/>
<text text-anchor="middle" x="190" y="-487.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__inspect</text>
</g>
<!-- Peer__propose&#45;&gt;Peer__inspect -->
<g id="edge1" class="edge">
<title>Peer__propose&#45;&gt;Peer__inspect</title>
<path fill="none" stroke="#666666" d="M97.12,-473.72C108.96,-476.01 121.75,-478.48 133.91,-480.84"/>
<polygon fill="#666666" stroke="#666666" points="133.47,-484.32 143.95,-482.78 134.8,-477.44 133.47,-484.32"/>
</g>
<!-- Peer__read_index -->
<g id="node3" class="node">
<title>Peer__read_index</title>
<path fill="none" stroke="#1c2123" d="M235,-455.5C235,-455.5 145,-455.5 145,-455.5 139,-455.5 133,-449.5 133,-443.5 133,-443.5 133,-431.5 133,-431.5 133,-425.5 139,-419.5 145,-419.5 145,-419.5 235,-419.5 235,-419.5 241,-419.5 247,-425.5 247,-431.5 247,-431.5 247,-443.5 247,-443.5 247,-449.5 241,-455.5 235,-455.5"/>
<text text-anchor="middle" x="190" y="-433.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__read_index</text>
</g>
<!-- Peer__propose&#45;&gt;Peer__read_index -->
<g id="edge2" class="edge">
<title>Peer__propose&#45;&gt;Peer__read_index</title>
<path fill="none" stroke="#666666" d="M97.12,-455.28C105.49,-453.66 114.34,-451.95 123.1,-450.25"/>
<polygon fill="#666666" stroke="#666666" points="123.78,-453.69 132.94,-448.35 122.45,-446.82 123.78,-453.69"/>
</g>
<!-- Peer__pre_read_index -->
<g id="node4" class="node">
<title>Peer__pre_read_index</title>
<path fill="none" stroke="#1c2123" d="M329.5,-752C329.5,-752 443.5,-752 443.5,-752 449.5,-752 455.5,-758 455.5,-764 455.5,-764 455.5,-831 455.5,-831 455.5,-837 449.5,-843 443.5,-843 443.5,-843 329.5,-843 329.5,-843 323.5,-843 317.5,-837 317.5,-831 317.5,-831 317.5,-764 317.5,-764 317.5,-758 323.5,-752 329.5,-752"/>
<text text-anchor="middle" x="386.5" y="-827.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__pre_read_index</text>
<polyline fill="none" stroke="#1c2123" points="317.5,-820 455.5,-820 "/>
<text text-anchor="start" x="325.5" y="-804.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果正在splitting</text>
<text text-anchor="start" x="325.5" y="-789.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者merging返回</text>
<text text-anchor="start" x="325.5" y="-774.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadIndexNotReady</text>
<text text-anchor="start" x="325.5" y="-759.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 错误</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__pre_read_index -->
<g id="edge3" class="edge">
<title>Peer__read_index&#45;&gt;Peer__pre_read_index</title>
<path fill="none" stroke="#666666" d="M238.43,-455.66C241.67,-458.25 244.6,-461.18 247,-464.5 318.74,-563.65 215.3,-635.55 283,-737.5 289.73,-747.63 298.8,-756.28 308.77,-763.59"/>
<polygon fill="#666666" stroke="#666666" points="307.1,-766.68 317.33,-769.42 311.04,-760.9 307.1,-766.68"/>
</g>
<!-- monotonic_raw_now -->
<g id="node5" class="node">
<title>monotonic_raw_now</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M310.5,-500C310.5,-500 462.5,-500 462.5,-500 468.5,-500 474.5,-506 474.5,-512 474.5,-512 474.5,-549 474.5,-549 474.5,-555 468.5,-561 462.5,-561 462.5,-561 310.5,-561 310.5,-561 304.5,-561 298.5,-555 298.5,-549 298.5,-549 298.5,-512 298.5,-512 298.5,-506 304.5,-500 310.5,-500"/>
<text text-anchor="middle" x="386.5" y="-545.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">monotonic_raw_now</text>
<polyline fill="none" stroke="#8a8898" points="298.5,-538 474.5,-538 "/>
<text text-anchor="start" x="306.5" y="-522.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">获取当前时间戳</text>
<text text-anchor="start" x="306.5" y="-507.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 作为后续renew_lease_time</text>
</g>
<!-- Peer__read_index&#45;&gt;monotonic_raw_now -->
<g id="edge4" class="edge">
<title>Peer__read_index&#45;&gt;monotonic_raw_now</title>
<path fill="none" stroke="#666666" d="M229.46,-455.55C235.37,-458.46 241.38,-461.51 247,-464.5 263.36,-473.2 266.49,-477.1 283,-485.5 289.61,-488.86 296.52,-492.23 303.51,-495.51"/>
<polygon fill="#666666" stroke="#666666" points="302.51,-498.9 313.05,-499.93 305.45,-492.55 302.51,-498.9"/>
</g>
<!-- Peer__inspect_lease -->
<g id="node6" class="node">
<title>Peer__inspect_lease</title>
<path fill="none" stroke="#1c2123" d="M303.5,-618.5C303.5,-618.5 469.5,-618.5 469.5,-618.5 475.5,-618.5 481.5,-624.5 481.5,-630.5 481.5,-630.5 481.5,-682.5 481.5,-682.5 481.5,-688.5 475.5,-694.5 469.5,-694.5 469.5,-694.5 303.5,-694.5 303.5,-694.5 297.5,-694.5 291.5,-688.5 291.5,-682.5 291.5,-682.5 291.5,-630.5 291.5,-630.5 291.5,-624.5 297.5,-618.5 303.5,-618.5"/>
<text text-anchor="middle" x="386.5" y="-679.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer::inspect_lease</text>
<polyline fill="none" stroke="#1c2123" points="291.5,-671.5 481.5,-671.5 "/>
<text text-anchor="start" x="299.5" y="-656.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果当前节点为leader</text>
<text text-anchor="start" x="299.5" y="-641.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并且lease为Valid或者Expired</text>
<text text-anchor="start" x="299.5" y="-626.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 不是suspect</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__inspect_lease -->
<g id="edge5" class="edge">
<title>Peer__read_index&#45;&gt;Peer__inspect_lease</title>
<path fill="none" stroke="#666666" d="M237.47,-455.6C241.01,-458.21 244.26,-461.16 247,-464.5 287.5,-513.82 243.2,-553.62 283,-603.5 285.19,-606.24 287.55,-608.85 290.07,-611.34"/>
<polygon fill="#666666" stroke="#666666" points="288.22,-614.39 298,-618.45 292.89,-609.17 288.22,-614.39"/>
</g>
<!-- ReadIndexRequest__push_command -->
<g id="node7" class="node">
<title>ReadIndexRequest__push_command</title>
<path fill="none" stroke="#1c2123" d="M538,-618.5C538,-618.5 794,-618.5 794,-618.5 800,-618.5 806,-624.5 806,-630.5 806,-630.5 806,-712.5 806,-712.5 806,-718.5 800,-724.5 794,-724.5 794,-724.5 538,-724.5 538,-724.5 532,-724.5 526,-718.5 526,-712.5 526,-712.5 526,-630.5 526,-630.5 526,-624.5 532,-618.5 538,-618.5"/>
<text text-anchor="start" x="534" y="-709.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexRequest</text>
<text text-anchor="start" x="534" y="-694.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push_command</text>
<polyline fill="none" stroke="#1c2123" points="526,-686.5 806,-686.5 "/>
<text text-anchor="start" x="534" y="-671.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果pending_reads队列中</text>
<text text-anchor="start" x="534" y="-656.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 最后一个read的renew_lease_time</text>
<text text-anchor="start" x="534" y="-641.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> + max_lease &gt; renew_lease_time</text>
<text text-anchor="start" x="534" y="-626.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则直接把它放到该reads的commands数组中</text>
</g>
<!-- Peer__read_index&#45;&gt;ReadIndexRequest__push_command -->
<g id="edge6" class="edge">
<title>Peer__read_index&#45;&gt;ReadIndexRequest__push_command</title>
<path fill="none" stroke="#666666" d="M238.11,-455.51C241.47,-458.13 244.5,-461.11 247,-464.5 311,-551.32 201.27,-634.12 283,-704.5 317.43,-734.15 423.78,-722.79 515.55,-705.73"/>
<polygon fill="#666666" stroke="#666666" points="516.35,-709.14 525.52,-703.84 515.05,-702.26 516.35,-709.14"/>
</g>
<!-- Peer__bcast_wakeup_message -->
<g id="node8" class="node">
<title>Peer__bcast_wakeup_message</title>
<path fill="none" stroke="#1c2123" d="M306.5,-0.5C306.5,-0.5 466.5,-0.5 466.5,-0.5 472.5,-0.5 478.5,-6.5 478.5,-12.5 478.5,-12.5 478.5,-94.5 478.5,-94.5 478.5,-100.5 472.5,-106.5 466.5,-106.5 466.5,-106.5 306.5,-106.5 306.5,-106.5 300.5,-106.5 294.5,-100.5 294.5,-94.5 294.5,-94.5 294.5,-12.5 294.5,-12.5 294.5,-6.5 300.5,-0.5 306.5,-0.5"/>
<text text-anchor="middle" x="386.5" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__bcast_wakeup_message</text>
<polyline fill="none" stroke="#1c2123" points="294.5,-83.5 478.5,-83.5 "/>
<text text-anchor="start" x="302.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果自己不是leader，并且</text>
<text text-anchor="start" x="302.5" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> leader节点为invalid</text>
<text text-anchor="start" x="302.5" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> leader可能hibernated了</text>
<text text-anchor="start" x="302.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 向region中所有peer</text>
<text text-anchor="start" x="302.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送MsgRegionWakeUp</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__bcast_wakeup_message -->
<g id="edge7" class="edge">
<title>Peer__read_index&#45;&gt;Peer__bcast_wakeup_message</title>
<path fill="none" stroke="#666666" d="M192.01,-419.18C195.7,-367.44 212.24,-217.7 283,-121.5 284.78,-119.08 286.67,-116.72 288.66,-114.42"/>
<polygon fill="#666666" stroke="#666666" points="291.48,-116.54 295.77,-106.85 286.37,-111.75 291.48,-116.54"/>
</g>
<!-- Uuid__new_v4 -->
<g id="node9" class="node">
<title>Uuid__new_v4</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M319.5,-366.5C319.5,-366.5 453.5,-366.5 453.5,-366.5 459.5,-366.5 465.5,-372.5 465.5,-378.5 465.5,-378.5 465.5,-430.5 465.5,-430.5 465.5,-436.5 459.5,-442.5 453.5,-442.5 453.5,-442.5 319.5,-442.5 319.5,-442.5 313.5,-442.5 307.5,-436.5 307.5,-430.5 307.5,-430.5 307.5,-378.5 307.5,-378.5 307.5,-372.5 313.5,-366.5 319.5,-366.5"/>
<text text-anchor="start" x="315.5" y="-427.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Uuid</text>
<text text-anchor="start" x="315.5" y="-412.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> new_v4</text>
<polyline fill="none" stroke="#8a8898" points="307.5,-404.5 465.5,-404.5 "/>
<text text-anchor="start" x="315.5" y="-389.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">使用Uuid作为唯一标识</text>
<text text-anchor="start" x="315.5" y="-374.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 传给下面的raft</text>
</g>
<!-- Peer__read_index&#45;&gt;Uuid__new_v4 -->
<g id="edge8" class="edge">
<title>Peer__read_index&#45;&gt;Uuid__new_v4</title>
<path fill="none" stroke="#666666" d="M247.26,-427.96C262.92,-425.3 280.32,-422.35 297.34,-419.46"/>
<polygon fill="#666666" stroke="#666666" points="298.03,-422.89 307.31,-417.77 296.86,-415.99 298.03,-422.89"/>
</g>
<!-- RawNode__read_index -->
<g id="node10" class="node">
<title>RawNode__read_index</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M606,-336.5C606,-336.5 726,-336.5 726,-336.5 732,-336.5 738,-342.5 738,-348.5 738,-348.5 738,-370.5 738,-370.5 738,-376.5 732,-382.5 726,-382.5 726,-382.5 606,-382.5 606,-382.5 600,-382.5 594,-376.5 594,-370.5 594,-370.5 594,-348.5 594,-348.5 594,-342.5 600,-336.5 606,-336.5"/>
<text text-anchor="middle" x="666" y="-367.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RawNode__read_index</text>
<polyline fill="none" stroke="#8a8898" points="594,-359.5 738,-359.5 "/>
<text text-anchor="middle" x="666" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> </text>
</g>
<!-- Peer__read_index&#45;&gt;RawNode__read_index -->
<g id="edge9" class="edge">
<title>Peer__read_index&#45;&gt;RawNode__read_index</title>
<path fill="none" stroke="#666666" d="M204.91,-419.35C221.18,-399.79 250.09,-369.81 283,-357.5 381.44,-320.69 504.39,-330.22 583.78,-342.82"/>
<polygon fill="#666666" stroke="#666666" points="583.29,-346.29 593.72,-344.45 584.42,-339.38 583.29,-346.29"/>
</g>
<!-- Lease__inspect__Suspect -->
<g id="node11" class="node">
<title>Lease__inspect__Suspect</title>
<path fill="none" stroke="#1c2123" d="M295,-164.5C295,-164.5 478,-164.5 478,-164.5 484,-164.5 490,-170.5 490,-176.5 490,-176.5 490,-258.5 490,-258.5 490,-264.5 484,-270.5 478,-270.5 478,-270.5 295,-270.5 295,-270.5 289,-270.5 283,-264.5 283,-258.5 283,-258.5 283,-176.5 283,-176.5 283,-170.5 289,-164.5 295,-164.5"/>
<text text-anchor="start" x="291" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果lease::inspect</text>
<text text-anchor="start" x="291" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 结果为Suspect</text>
<text text-anchor="start" x="291" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 说明TimeoutNow已经发出去了</text>
<text text-anchor="start" x="291" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose一个空消息</text>
<text text-anchor="start" x="291" y="-195.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 用来update leader lease</text>
<polyline fill="none" stroke="#1c2123" points="283,-187.5 490,-187.5 "/>
<text text-anchor="start" x="291" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">空消息上带了renew_lease_time</text>
</g>
<!-- Peer__read_index&#45;&gt;Lease__inspect__Suspect -->
<g id="edge10" class="edge">
<title>Peer__read_index&#45;&gt;Lease__inspect__Suspect</title>
<path fill="none" stroke="#666666" d="M198.74,-419.4C212.38,-389.04 243.07,-327.12 283,-285.5 285.71,-282.68 288.55,-279.91 291.5,-277.2"/>
<polygon fill="#666666" stroke="#666666" points="293.81,-279.83 299.03,-270.61 289.2,-274.57 293.81,-279.83"/>
</g>
<!-- Peer__post_propose -->
<g id="node12" class="node">
<title>Peer__post_propose</title>
<path fill="none" stroke="#1c2123" d="M601,-122.5C601,-122.5 731,-122.5 731,-122.5 737,-122.5 743,-128.5 743,-134.5 743,-134.5 743,-186.5 743,-186.5 743,-192.5 737,-198.5 731,-198.5 731,-198.5 601,-198.5 601,-198.5 595,-198.5 589,-192.5 589,-186.5 589,-186.5 589,-134.5 589,-134.5 589,-128.5 595,-122.5 601,-122.5"/>
<text text-anchor="start" x="597" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="597" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> post_propose</text>
<polyline fill="none" stroke="#1c2123" points="589,-160.5 743,-160.5 "/>
<text text-anchor="start" x="597" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将propose放入proposals</text>
<text text-anchor="start" x="597" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 队列中</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__post_propose -->
<g id="edge11" class="edge">
<title>Peer__read_index&#45;&gt;Peer__post_propose</title>
<path fill="none" stroke="#666666" d="M190.34,-419.18C189.57,-367.14 195.43,-218.11 283,-154.5 328.42,-121.51 480.77,-134.77 578.79,-147.54"/>
<polygon fill="#666666" stroke="#666666" points="578.62,-151.04 588.99,-148.89 579.54,-144.11 578.62,-151.04"/>
</g>
<!-- Peer__propose_normal -->
<g id="node13" class="node">
<title>Peer__propose_normal</title>
<path fill="none" stroke="#1c2123" d="M604.5,-241.5C604.5,-241.5 727.5,-241.5 727.5,-241.5 733.5,-241.5 739.5,-247.5 739.5,-253.5 739.5,-253.5 739.5,-305.5 739.5,-305.5 739.5,-311.5 733.5,-317.5 727.5,-317.5 727.5,-317.5 604.5,-317.5 604.5,-317.5 598.5,-317.5 592.5,-311.5 592.5,-305.5 592.5,-305.5 592.5,-253.5 592.5,-253.5 592.5,-247.5 598.5,-241.5 604.5,-241.5"/>
<text text-anchor="start" x="600.5" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="600.5" y="-287.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose_normal</text>
<polyline fill="none" stroke="#1c2123" points="592.5,-279.5 739.5,-279.5 "/>
<text text-anchor="start" x="600.5" y="-264.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">propose一个空消息</text>
<text text-anchor="start" x="600.5" y="-249.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 带了renew_lease_time</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__propose_normal -->
<g id="edge12" class="edge">
<title>Peer__read_index&#45;&gt;Peer__propose_normal</title>
<path fill="none" stroke="#666666" d="M200.35,-419.43C214.49,-394.12 243.88,-348.85 283,-327.5 333.01,-300.2 485.8,-287.98 582.31,-282.85"/>
<polygon fill="#666666" stroke="#666666" points="582.54,-286.35 592.34,-282.34 582.17,-279.36 582.54,-286.35"/>
</g>
<!-- Peer__pending_reads__push_back -->
<g id="node14" class="node">
<title>Peer__pending_reads__push_back</title>
<path fill="none" stroke="#1c2123" d="M854,-544C854,-544 1015,-544 1015,-544 1021,-544 1027,-550 1027,-556 1027,-556 1027,-623 1027,-623 1027,-629 1021,-635 1015,-635 1015,-635 854,-635 854,-635 848,-635 842,-629 842,-623 842,-623 842,-556 842,-556 842,-550 848,-544 854,-544"/>
<text text-anchor="start" x="850" y="-619.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="850" y="-604.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pending_reads</text>
<text text-anchor="start" x="850" y="-589.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push_back</text>
<polyline fill="none" stroke="#1c2123" points="842,-582 1027,-582 "/>
<text text-anchor="start" x="850" y="-566.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将ReadIndexRequest</text>
<text text-anchor="start" x="850" y="-551.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 放入pending_reads等待队列</text>
</g>
<!-- Peer__read_index&#45;&gt;Peer__pending_reads__push_back -->
<g id="edge13" class="edge">
<title>Peer__read_index&#45;&gt;Peer__pending_reads__push_back</title>
<path fill="none" stroke="#666666" d="M236.95,-455.63C240.64,-458.24 244.07,-461.19 247,-464.5 279.97,-501.76 242.98,-540.94 283,-570.5 325.91,-602.2 659.55,-597.47 831.6,-592.81"/>
<polygon fill="#666666" stroke="#666666" points="831.79,-596.3 841.69,-592.53 831.59,-589.3 831.79,-596.3"/>
</g>
<!-- ReadIndexRequest__with_command -->
<g id="node15" class="node">
<title>ReadIndexRequest__with_command</title>
<path fill="none" stroke="#1c2123" d="M576.5,-402C576.5,-402 755.5,-402 755.5,-402 761.5,-402 767.5,-408 767.5,-414 767.5,-414 767.5,-549 767.5,-549 767.5,-555 761.5,-561 755.5,-561 755.5,-561 576.5,-561 576.5,-561 570.5,-561 564.5,-555 564.5,-549 564.5,-549 564.5,-414 564.5,-414 564.5,-408 570.5,-402 576.5,-402"/>
<text text-anchor="start" x="572.5" y="-545.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexRequest</text>
<text text-anchor="start" x="572.5" y="-530.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> with_command</text>
<polyline fill="none" stroke="#1c2123" points="564.5,-523 767.5,-523 "/>
<text text-anchor="start" x="572.5" y="-507.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用uuid,callback</text>
<text text-anchor="start" x="572.5" y="-492.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 还有monotonic_raw_now</text>
<text text-anchor="start" x="572.5" y="-477.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建一个ReadIndexRequest</text>
<text text-anchor="start" x="572.5" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后放到pending_reads</text>
<text text-anchor="start" x="572.5" y="-447.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 队列中</text>
<polyline fill="none" stroke="#1c2123" points="564.5,-440 767.5,-440 "/>
<text text-anchor="start" x="572.5" y="-424.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">这个地方的monotonic_raw_now</text>
<text text-anchor="start" x="572.5" y="-409.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 后面会用来renew lease</text>
</g>
<!-- Peer__read_index&#45;&gt;ReadIndexRequest__with_command -->
<g id="edge14" class="edge">
<title>Peer__read_index&#45;&gt;ReadIndexRequest__with_command</title>
<path fill="none" stroke="#666666" d="M247.33,-447.47C259.09,-449.33 271.43,-451.12 283,-452.5 374.01,-463.35 477.74,-470.93 554.12,-475.6"/>
<polygon fill="#666666" stroke="#666666" points="554.04,-479.11 564.23,-476.22 554.46,-472.12 554.04,-479.11"/>
</g>
<!-- Peer__is_splitting -->
<g id="node17" class="node">
<title>Peer__is_splitting</title>
<path fill="none" stroke="#1c2123" d="M586,-858C586,-858 746,-858 746,-858 752,-858 758,-864 758,-870 758,-870 758,-907 758,-907 758,-913 752,-919 746,-919 746,-919 586,-919 586,-919 580,-919 574,-913 574,-907 574,-907 574,-870 574,-870 574,-864 580,-858 586,-858"/>
<text text-anchor="start" x="582" y="-903.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="582" y="-888.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is_splitting</text>
<polyline fill="none" stroke="#1c2123" points="574,-881 758,-881 "/>
<text text-anchor="middle" x="666" y="-865.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据last_committed_split_idx</text>
</g>
<!-- Peer__pre_read_index&#45;&gt;Peer__is_splitting -->
<g id="edge24" class="edge">
<title>Peer__pre_read_index&#45;&gt;Peer__is_splitting</title>
<path fill="none" stroke="#666666" d="M455.84,-823.78C478.09,-832.04 502.99,-840.96 526,-848.5 538.27,-852.52 551.21,-856.53 564.06,-860.39"/>
<polygon fill="#666666" stroke="#666666" points="563.28,-863.81 573.86,-863.3 565.28,-857.1 563.28,-863.81"/>
</g>
<!-- Peer__is_merging -->
<g id="node18" class="node">
<title>Peer__is_merging</title>
<path fill="none" stroke="#1c2123" d="M557,-748C557,-748 775,-748 775,-748 781,-748 787,-754 787,-760 787,-760 787,-827 787,-827 787,-833 781,-839 775,-839 775,-839 557,-839 557,-839 551,-839 545,-833 545,-827 545,-827 545,-760 545,-760 545,-754 551,-748 557,-748"/>
<text text-anchor="start" x="553" y="-823.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="553" y="-808.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> is_merging</text>
<polyline fill="none" stroke="#1c2123" points="545,-801 787,-801 "/>
<text text-anchor="start" x="553" y="-785.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据last_committed_prepare_merge_idx</text>
<text text-anchor="start" x="553" y="-770.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pending_merge_state</text>
<text text-anchor="start" x="553" y="-755.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来判断</text>
</g>
<!-- Peer__pre_read_index&#45;&gt;Peer__is_merging -->
<g id="edge25" class="edge">
<title>Peer__pre_read_index&#45;&gt;Peer__is_merging</title>
<path fill="none" stroke="#666666" d="M455.74,-796.52C479.68,-796.17 507.43,-795.77 534.75,-795.38"/>
<polygon fill="#666666" stroke="#666666" points="534.83,-798.88 544.78,-795.23 534.73,-791.88 534.83,-798.88"/>
</g>
<!-- monotonic_raw_now&#45;&gt;ReadIndexRequest__push_command -->
<g id="edge26" class="edge">
<title>monotonic_raw_now&#45;&gt;ReadIndexRequest__push_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M447.71,-561.09C478.13,-576.55 516.06,-595.82 551.67,-613.92"/>
<polygon fill="green" stroke="green" points="550.17,-617.08 560.67,-618.49 553.34,-610.84 550.17,-617.08"/>
</g>
<!-- monotonic_raw_now&#45;&gt;Peer__propose_normal -->
<g id="edge27" class="edge">
<title>monotonic_raw_now&#45;&gt;Peer__propose_normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M440.69,-499.84C458.59,-487.21 477.24,-471.14 490,-452.5 522.66,-404.8 486.2,-369.43 526,-327.5 541.17,-311.52 561.9,-300.86 582.72,-293.75"/>
<polygon fill="green" stroke="green" points="583.8,-297.08 592.28,-290.73 581.69,-290.41 583.8,-297.08"/>
</g>
<!-- monotonic_raw_now&#45;&gt;ReadIndexRequest__with_command -->
<g id="edge15" class="edge">
<title>monotonic_raw_now&#45;&gt;ReadIndexRequest__with_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M474.54,-515.13C499.77,-510.68 527.66,-505.75 554.14,-501.08"/>
<polygon fill="green" stroke="green" points="554.97,-504.48 564.21,-499.3 553.75,-497.59 554.97,-504.48"/>
</g>
<!-- Peer__inspect_lease&#45;&gt;ReadIndexRequest__push_command -->
<g id="edge19" class="edge">
<title>Peer__inspect_lease&#45;&gt;ReadIndexRequest__push_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M481.84,-661.6C492.77,-662.19 504.12,-662.8 515.57,-663.42"/>
<polygon fill="green" stroke="green" points="515.47,-666.92 525.65,-663.97 515.85,-659.93 515.47,-666.92"/>
</g>
<!-- Peer__pending_reads -->
<g id="node16" class="node">
<title>Peer__pending_reads</title>
<path fill="#feed9b" stroke="#f7e495" d="M1075,-596C1075,-596 1257,-596 1257,-596 1263,-596 1269,-602 1269,-608 1269,-608 1269,-645 1269,-645 1269,-651 1263,-657 1257,-657 1257,-657 1075,-657 1075,-657 1069,-657 1063,-651 1063,-645 1063,-645 1063,-608 1063,-608 1063,-602 1069,-596 1075,-596"/>
<text text-anchor="start" x="1071" y="-641.8" font-family="Times,serif" font-size="14.00" fill="#40575d">Peer</text>
<text text-anchor="start" x="1071" y="-626.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_reads</text>
<polyline fill="none" stroke="#f7e495" points="1063,-619 1269,-619 "/>
<text text-anchor="start" x="1071" y="-603.8" font-family="Times,serif" font-size="14.00" fill="#40575d">ReadIndexQueue&lt;EK::Snapshot&gt;,</text>
</g>
<!-- ReadIndexRequest__push_command&#45;&gt;Peer__pending_reads -->
<g id="edge23" class="edge">
<title>ReadIndexRequest__push_command&#45;&gt;Peer__pending_reads</title>
<path fill="none" stroke="#666666" d="M806.06,-662.86C872.94,-658.24 954.21,-651.97 1027,-644.5 1035.47,-643.63 1044.22,-642.66 1053.02,-641.63"/>
<polygon fill="#666666" stroke="#666666" points="1053.44,-645.11 1062.96,-640.45 1052.61,-638.15 1053.44,-645.11"/>
</g>
<!-- Uuid__new_v4&#45;&gt;RawNode__read_index -->
<g id="edge22" class="edge">
<title>Uuid__new_v4&#45;&gt;RawNode__read_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M465.54,-391.85C502.32,-385.88 546.19,-378.77 583.41,-372.73"/>
<polygon fill="green" stroke="green" points="584.4,-376.12 593.72,-371.06 583.28,-369.21 584.4,-376.12"/>
</g>
<!-- Uuid__new_v4&#45;&gt;ReadIndexRequest__with_command -->
<g id="edge16" class="edge">
<title>Uuid__new_v4&#45;&gt;ReadIndexRequest__with_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M465.54,-426.15C493.12,-433.81 524.69,-442.57 554.45,-450.82"/>
<polygon fill="green" stroke="green" points="553.89,-454.3 564.46,-453.6 555.76,-447.56 553.89,-454.3"/>
</g>
<!-- Lease__inspect__Suspect&#45;&gt;Peer__post_propose -->
<g id="edge20" class="edge">
<title>Lease__inspect__Suspect&#45;&gt;Peer__post_propose</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M490.04,-196.44C519.32,-190.42 550.91,-183.93 579.09,-178.15"/>
<polygon fill="green" stroke="green" points="579.81,-181.57 588.9,-176.13 578.4,-174.71 579.81,-181.57"/>
</g>
<!-- Lease__inspect__Suspect&#45;&gt;Peer__propose_normal -->
<g id="edge21" class="edge">
<title>Lease__inspect__Suspect&#45;&gt;Peer__propose_normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M490.04,-240.41C520.43,-247.2 553.3,-254.54 582.26,-261.01"/>
<polygon fill="green" stroke="green" points="581.81,-264.5 592.33,-263.26 583.34,-257.67 581.81,-264.5"/>
</g>
<!-- Peer__pending_reads__push_back&#45;&gt;Peer__pending_reads -->
<g id="edge18" class="edge">
<title>Peer__pending_reads__push_back&#45;&gt;Peer__pending_reads</title>
<path fill="none" stroke="#666666" d="M1027.19,-604.28C1035.63,-605.64 1044.24,-607.03 1052.83,-608.42"/>
<polygon fill="#666666" stroke="#666666" points="1052.46,-611.9 1062.89,-610.04 1053.58,-604.99 1052.46,-611.9"/>
</g>
<!-- ReadIndexRequest__with_command&#45;&gt;Peer__pending_reads__push_back -->
<g id="edge17" class="edge">
<title>ReadIndexRequest__with_command&#45;&gt;Peer__pending_reads__push_back</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M767.75,-522.33C788.94,-530.92 811.29,-539.97 832.49,-548.56"/>
<polygon fill="green" stroke="green" points="831.23,-551.83 841.81,-552.34 833.86,-545.34 831.23,-551.83"/>
</g>
</g>
</svg>
