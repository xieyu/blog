<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: peer_read_index_struct Pages: 1 -->
<svg width="1425pt" height="665pt"
 viewBox="0.00 0.00 1425.00 665.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 661)">
<title>peer_read_index_struct</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-661 1421,-661 1421,4 -4,4"/>
<!-- Peer -->
<g id="node1" class="node">
<title>Peer</title>
<path fill="none" stroke="#1c2123" d="M12,-328.5C12,-328.5 197,-328.5 197,-328.5 203,-328.5 209,-334.5 209,-340.5 209,-340.5 209,-400.5 209,-400.5 209,-406.5 203,-412.5 197,-412.5 197,-412.5 12,-412.5 12,-412.5 6,-412.5 0,-406.5 0,-400.5 0,-400.5 0,-340.5 0,-340.5 0,-334.5 6,-328.5 12,-328.5"/>
<text text-anchor="middle" x="104.5" y="-397.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<polyline fill="none" stroke="#1c2123" points="0,-389.5 209,-389.5 "/>
<text text-anchor="start" x="8" y="-374.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader_lease: Lease,</text>
<polyline fill="none" stroke="#1c2123" points="0,-366.5 209,-366.5 "/>
<text text-anchor="start" x="8" y="-351.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_reads: </text>
<text text-anchor="start" x="8" y="-336.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ReadIndexQueue&lt;EK::Snapshot&gt;,</text>
</g>
<!-- ReadIndexQueue -->
<g id="node2" class="node">
<title>ReadIndexQueue</title>
<path fill="none" stroke="#1c2123" d="M257,-294C257,-294 487,-294 487,-294 493,-294 499,-300 499,-306 499,-306 499,-435 499,-435 499,-441 493,-447 487,-447 487,-447 257,-447 257,-447 251,-447 245,-441 245,-435 245,-435 245,-306 245,-306 245,-300 251,-294 257,-294"/>
<text text-anchor="middle" x="372" y="-431.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexQueue</text>
<polyline fill="none" stroke="#1c2123" points="245,-424 499,-424 "/>
<text text-anchor="start" x="253" y="-408.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">reads: VecDeque&lt;ReadIndexRequest&lt;S&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="245,-401 499,-401 "/>
<text text-anchor="start" x="253" y="-385.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ready_cnt: usize,</text>
<polyline fill="none" stroke="#1c2123" points="245,-378 499,-378 "/>
<text text-anchor="start" x="253" y="-362.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handled_cnt: usize,</text>
<polyline fill="none" stroke="#1c2123" points="245,-355 499,-355 "/>
<text text-anchor="start" x="253" y="-339.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">// map[uuid] &#45;&gt; offset in `reads`.</text>
<text text-anchor="start" x="253" y="-324.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> contexts: HashMap&lt;Uuid, usize&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="245,-317 499,-317 "/>
<text text-anchor="start" x="253" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">retry_countdown: usize,</text>
</g>
<!-- Peer&#45;&gt;ReadIndexQueue -->
<g id="edge1" class="edge">
<title>Peer&#45;&gt;ReadIndexQueue</title>
<path fill="none" stroke="#666666" d="M209.29,-370.5C217.65,-370.5 226.18,-370.5 234.72,-370.5"/>
<polygon fill="#666666" stroke="#666666" points="234.75,-374 244.75,-370.5 234.75,-367 234.75,-374"/>
</g>
<!-- ReadIndexRequest -->
<g id="node3" class="node">
<title>ReadIndexRequest</title>
<path fill="none" stroke="#1c2123" d="M766,-263.5C766,-263.5 1047,-263.5 1047,-263.5 1053,-263.5 1059,-269.5 1059,-275.5 1059,-275.5 1059,-465.5 1059,-465.5 1059,-471.5 1053,-477.5 1047,-477.5 1047,-477.5 766,-477.5 766,-477.5 760,-477.5 754,-471.5 754,-465.5 754,-465.5 754,-275.5 754,-275.5 754,-269.5 760,-263.5 766,-263.5"/>
<text text-anchor="middle" x="906.5" y="-462.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexRequest</text>
<polyline fill="none" stroke="#1c2123" points="754,-454.5 1059,-454.5 "/>
<text text-anchor="start" x="762" y="-439.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub id: Uuid,</text>
<polyline fill="none" stroke="#1c2123" points="754,-431.5 1059,-431.5 "/>
<text text-anchor="start" x="762" y="-416.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub cmds: MustConsumeVec</text>
<text text-anchor="start" x="762" y="-401.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &lt;(RaftCmdRequest, Callback&lt;S&gt;, Option&lt;u64&gt;)&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="754,-393.5 1059,-393.5 "/>
<text text-anchor="start" x="762" y="-378.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub renew_lease_time: Timespec,</text>
<polyline fill="none" stroke="#1c2123" points="754,-370.5 1059,-370.5 "/>
<text text-anchor="start" x="762" y="-355.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub read_index: Option&lt;u64&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="754,-347.5 1059,-347.5 "/>
<text text-anchor="start" x="762" y="-332.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub addition_request: </text>
<text text-anchor="start" x="762" y="-317.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Option&lt;Box&lt;raft_cmdpb::ReadIndexRequest&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="754,-309.5 1059,-309.5 "/>
<text text-anchor="start" x="762" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub locked: Option&lt;Box&lt;LockInfo&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="754,-286.5 1059,-286.5 "/>
<text text-anchor="start" x="762" y="-271.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">in_contexts: bool,</text>
</g>
<!-- ReadIndexQueue&#45;&gt;ReadIndexRequest -->
<g id="edge2" class="edge">
<title>ReadIndexQueue&#45;&gt;ReadIndexRequest</title>
<path fill="none" stroke="#666666" d="M499.41,-381.63C511.43,-382.39 523.44,-383.04 535,-383.5 616.27,-386.76 636.72,-386.31 718,-383.5 726.38,-383.21 734.97,-382.85 743.63,-382.43"/>
<polygon fill="#666666" stroke="#666666" points="744.03,-385.91 753.84,-381.91 743.67,-378.92 744.03,-385.91"/>
</g>
<!-- contexts -->
<g id="node11" class="node">
<title>contexts</title>
<path fill="none" stroke="#1c2123" d="M547,-305C547,-305 706,-305 706,-305 712,-305 718,-311 718,-317 718,-317 718,-362 718,-362 718,-368 712,-374 706,-374 706,-374 547,-374 547,-374 541,-374 535,-368 535,-362 535,-362 535,-317 535,-317 535,-311 541,-305 547,-305"/>
<text text-anchor="middle" x="626.5" y="-358.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">contexts</text>
<polyline fill="none" stroke="#1c2123" points="535,-351 718,-351 "/>
<text text-anchor="start" x="543" y="-335.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">HashMap&lt;Uuid, usize&gt;</text>
<polyline fill="none" stroke="#1c2123" points="535,-328 718,-328 "/>
<text text-anchor="middle" x="626.5" y="-312.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">记录在uuid在队列中的位置</text>
</g>
<!-- ReadIndexQueue&#45;&gt;contexts -->
<g id="edge10" class="edge">
<title>ReadIndexQueue&#45;&gt;contexts</title>
<path fill="none" stroke="#666666" d="M499.25,-355C507.75,-353.96 516.25,-352.91 524.6,-351.89"/>
<polygon fill="#666666" stroke="#666666" points="525.2,-355.34 534.7,-350.65 524.35,-348.39 525.2,-355.34"/>
</g>
<!-- MustConsumeVec -->
<g id="node4" class="node">
<title>MustConsumeVec</title>
<path fill="none" stroke="#1c2123" d="M1127.5,-580.5C1127.5,-580.5 1256.5,-580.5 1256.5,-580.5 1262.5,-580.5 1268.5,-586.5 1268.5,-592.5 1268.5,-592.5 1268.5,-644.5 1268.5,-644.5 1268.5,-650.5 1262.5,-656.5 1256.5,-656.5 1256.5,-656.5 1127.5,-656.5 1127.5,-656.5 1121.5,-656.5 1115.5,-650.5 1115.5,-644.5 1115.5,-644.5 1115.5,-592.5 1115.5,-592.5 1115.5,-586.5 1121.5,-580.5 1127.5,-580.5"/>
<text text-anchor="middle" x="1192" y="-641.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">MustConsumeVec</text>
<polyline fill="none" stroke="#1c2123" points="1115.5,-633.5 1268.5,-633.5 "/>
<text text-anchor="start" x="1123.5" y="-618.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在drop时如果!is_empty</text>
<text text-anchor="start" x="1123.5" y="-603.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会safe_panic</text>
<text text-anchor="start" x="1123.5" y="-588.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> resource leak detected</text>
</g>
<!-- ReadIndexRequest&#45;&gt;MustConsumeVec -->
<g id="edge3" class="edge">
<title>ReadIndexRequest&#45;&gt;MustConsumeVec</title>
<path fill="none" stroke="#666666" d="M994.87,-477.54C1024.51,-509.87 1059.23,-543.83 1095,-570.5 1098.63,-573.2 1102.43,-575.83 1106.34,-578.36"/>
<polygon fill="#666666" stroke="#666666" points="1104.71,-581.47 1115.06,-583.76 1108.4,-575.52 1104.71,-581.47"/>
</g>
<!-- RaftCmdRequest -->
<g id="node5" class="node">
<title>RaftCmdRequest</title>
<path fill="none" stroke="#1c2123" d="M1235,-561.5C1235,-561.5 1149,-561.5 1149,-561.5 1143,-561.5 1137,-555.5 1137,-549.5 1137,-549.5 1137,-537.5 1137,-537.5 1137,-531.5 1143,-525.5 1149,-525.5 1149,-525.5 1235,-525.5 1235,-525.5 1241,-525.5 1247,-531.5 1247,-537.5 1247,-537.5 1247,-549.5 1247,-549.5 1247,-555.5 1241,-561.5 1235,-561.5"/>
<text text-anchor="middle" x="1192" y="-539.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCmdRequest</text>
</g>
<!-- ReadIndexRequest&#45;&gt;RaftCmdRequest -->
<g id="edge4" class="edge">
<title>ReadIndexRequest&#45;&gt;RaftCmdRequest</title>
<path fill="none" stroke="#666666" d="M1033.1,-477.66C1053.03,-491.65 1074.01,-504.81 1095,-515.5 1105.05,-520.62 1116.18,-524.94 1127.2,-528.55"/>
<polygon fill="#666666" stroke="#666666" points="1126.24,-531.91 1136.82,-531.53 1128.31,-525.22 1126.24,-531.91"/>
</g>
<!-- Callback -->
<g id="node6" class="node">
<title>Callback</title>
<path fill="none" stroke="#1c2123" d="M1125.5,-422.5C1125.5,-422.5 1258.5,-422.5 1258.5,-422.5 1264.5,-422.5 1270.5,-428.5 1270.5,-434.5 1270.5,-434.5 1270.5,-494.5 1270.5,-494.5 1270.5,-500.5 1264.5,-506.5 1258.5,-506.5 1258.5,-506.5 1125.5,-506.5 1125.5,-506.5 1119.5,-506.5 1113.5,-500.5 1113.5,-494.5 1113.5,-494.5 1113.5,-434.5 1113.5,-434.5 1113.5,-428.5 1119.5,-422.5 1125.5,-422.5"/>
<text text-anchor="middle" x="1192" y="-491.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Callback</text>
<polyline fill="none" stroke="#1c2123" points="1113.5,-483.5 1270.5,-483.5 "/>
<text text-anchor="start" x="1121.5" y="-468.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">None,</text>
<polyline fill="none" stroke="#1c2123" points="1113.5,-460.5 1270.5,-460.5 "/>
<text text-anchor="start" x="1121.5" y="-445.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Read(ReadCallback&lt;S&gt;),</text>
<text text-anchor="start" x="1121.5" y="-430.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Write </text>
</g>
<!-- ReadIndexRequest&#45;&gt;Callback -->
<g id="edge5" class="edge">
<title>ReadIndexRequest&#45;&gt;Callback</title>
<path fill="none" stroke="#666666" d="M1059.21,-420.8C1074.4,-425.84 1089.43,-430.82 1103.61,-435.53"/>
<polygon fill="#666666" stroke="#666666" points="1102.69,-438.91 1113.29,-438.73 1104.9,-432.26 1102.69,-438.91"/>
</g>
<!-- LockInfo -->
<g id="node7" class="node">
<title>LockInfo</title>
<path fill="none" stroke="#1c2123" d="M1107,-150C1107,-150 1277,-150 1277,-150 1283,-150 1289,-156 1289,-162 1289,-162 1289,-391 1289,-391 1289,-397 1283,-403 1277,-403 1277,-403 1107,-403 1107,-403 1101,-403 1095,-397 1095,-391 1095,-391 1095,-162 1095,-162 1095,-156 1101,-150 1107,-150"/>
<text text-anchor="middle" x="1192" y="-387.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockInfo</text>
<polyline fill="none" stroke="#1c2123" points="1095,-380 1289,-380 "/>
<text text-anchor="start" x="1103" y="-364.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">bytes primary_lock = 1;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-357 1289,-357 "/>
<text text-anchor="start" x="1103" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 lock_version = 2;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-334 1289,-334 "/>
<text text-anchor="start" x="1103" y="-318.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">bytes key = 3;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-311 1289,-311 "/>
<text text-anchor="start" x="1103" y="-295.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 lock_ttl = 4;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-288 1289,-288 "/>
<text text-anchor="start" x="1103" y="-272.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 txn_size = 5;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-265 1289,-265 "/>
<text text-anchor="start" x="1103" y="-249.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Op lock_type = 6;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-242 1289,-242 "/>
<text text-anchor="start" x="1103" y="-226.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 lock_for_update_ts = 7;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-219 1289,-219 "/>
<text text-anchor="start" x="1103" y="-203.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">bool use_async_commit = 8;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-196 1289,-196 "/>
<text text-anchor="start" x="1103" y="-180.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">uint64 min_commit_ts = 9;</text>
<polyline fill="none" stroke="#1c2123" points="1095,-173 1289,-173 "/>
<text text-anchor="start" x="1103" y="-157.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">repeated bytes secondaries = 10;</text>
</g>
<!-- ReadIndexRequest&#45;&gt;LockInfo -->
<g id="edge6" class="edge">
<title>ReadIndexRequest&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" d="M1059.21,-320.2C1068.01,-317.28 1076.76,-314.38 1085.32,-311.54"/>
<polygon fill="#666666" stroke="#666666" points="1086.51,-314.83 1094.9,-308.37 1084.3,-308.19 1086.51,-314.83"/>
</g>
<!-- Timespec -->
<g id="node8" class="node">
<title>Timespec</title>
<path fill="none" stroke="#1c2123" d="M1215,-131.5C1215,-131.5 1169,-131.5 1169,-131.5 1163,-131.5 1157,-125.5 1157,-119.5 1157,-119.5 1157,-107.5 1157,-107.5 1157,-101.5 1163,-95.5 1169,-95.5 1169,-95.5 1215,-95.5 1215,-95.5 1221,-95.5 1227,-101.5 1227,-107.5 1227,-107.5 1227,-119.5 1227,-119.5 1227,-125.5 1221,-131.5 1215,-131.5"/>
<text text-anchor="middle" x="1192" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Timespec</text>
</g>
<!-- ReadIndexRequest&#45;&gt;Timespec -->
<g id="edge7" class="edge">
<title>ReadIndexRequest&#45;&gt;Timespec</title>
<path fill="none" stroke="#666666" d="M973.37,-263.5C1005.21,-219.7 1046.97,-172 1095,-140.5 1110.49,-130.34 1129.8,-123.96 1147.04,-119.97"/>
<polygon fill="#666666" stroke="#666666" points="1147.84,-123.38 1156.9,-117.88 1146.39,-116.53 1147.84,-123.38"/>
</g>
<!-- Uuid -->
<g id="node9" class="node">
<title>Uuid</title>
<path fill="#feed9b" stroke="#f7e495" d="M1137,-0.5C1137,-0.5 1247,-0.5 1247,-0.5 1253,-0.5 1259,-6.5 1259,-12.5 1259,-12.5 1259,-64.5 1259,-64.5 1259,-70.5 1253,-76.5 1247,-76.5 1247,-76.5 1137,-76.5 1137,-76.5 1131,-76.5 1125,-70.5 1125,-64.5 1125,-64.5 1125,-12.5 1125,-12.5 1125,-6.5 1131,-0.5 1137,-0.5"/>
<text text-anchor="middle" x="1192" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Uuid</text>
<polyline fill="none" stroke="#f7e495" points="1125,-53.5 1259,-53.5 "/>
<text text-anchor="start" x="1133" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#40575d">传给raft group的</text>
<text text-anchor="start" x="1133" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> uuid,作为read index</text>
<text text-anchor="middle" x="1192" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 请求标识</text>
</g>
<!-- ReadIndexRequest&#45;&gt;Uuid -->
<g id="edge8" class="edge">
<title>ReadIndexRequest&#45;&gt;Uuid</title>
<path fill="none" stroke="#666666" d="M960.36,-263.38C993.01,-205.46 1039.3,-135.89 1095,-86.5 1101.31,-80.9 1108.4,-75.78 1115.78,-71.15"/>
<polygon fill="#666666" stroke="#666666" points="1117.75,-74.05 1124.56,-65.93 1114.17,-68.03 1117.75,-74.05"/>
</g>
<!-- ReadCallback -->
<g id="node10" class="node">
<title>ReadCallback</title>
<path fill="none" stroke="#1c2123" d="M1405,-482.5C1405,-482.5 1337,-482.5 1337,-482.5 1331,-482.5 1325,-476.5 1325,-470.5 1325,-470.5 1325,-458.5 1325,-458.5 1325,-452.5 1331,-446.5 1337,-446.5 1337,-446.5 1405,-446.5 1405,-446.5 1411,-446.5 1417,-452.5 1417,-458.5 1417,-458.5 1417,-470.5 1417,-470.5 1417,-476.5 1411,-482.5 1405,-482.5"/>
<text text-anchor="middle" x="1371" y="-460.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadCallback</text>
</g>
<!-- Callback&#45;&gt;ReadCallback -->
<g id="edge9" class="edge">
<title>Callback&#45;&gt;ReadCallback</title>
<path fill="none" stroke="#666666" d="M1270.63,-464.5C1285.44,-464.5 1300.65,-464.5 1314.59,-464.5"/>
<polygon fill="#666666" stroke="#666666" points="1314.97,-468 1324.97,-464.5 1314.97,-461 1314.97,-468"/>
</g>
<!-- contexts&#45;&gt;ReadIndexRequest -->
<g id="edge11" class="edge">
<title>contexts&#45;&gt;ReadIndexRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M718.14,-349.61C726.55,-350.54 735.22,-351.51 744.02,-352.49"/>
<polygon fill="green" stroke="green" points="743.67,-355.98 753.99,-353.61 744.44,-349.02 743.67,-355.98"/>
</g>
</g>
</svg>
