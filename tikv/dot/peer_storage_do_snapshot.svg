<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: peer_storage_do_snapshot Pages: 1 -->
<svg width="1510pt" height="684pt"
 viewBox="0.00 0.00 1510.00 683.94" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 679.94)">
<title>peer_storage_do_snapshot</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-679.94 1506,-679.94 1506,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_SnapManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M214,-537.23C214,-537.23 1004.5,-537.23 1004.5,-537.23 1010.5,-537.23 1016.5,-543.23 1016.5,-549.23 1016.5,-549.23 1016.5,-607.23 1016.5,-607.23 1016.5,-613.23 1010.5,-619.23 1004.5,-619.23 1004.5,-619.23 214,-619.23 214,-619.23 208,-619.23 202,-613.23 202,-607.23 202,-607.23 202,-549.23 202,-549.23 202,-543.23 208,-537.23 214,-537.23"/>
<text text-anchor="middle" x="609.25" y="-599.23" font-family="Times,serif" font-size="20.00">SnapManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_metadata</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M937,-112.23C937,-112.23 1265,-112.23 1265,-112.23 1271,-112.23 1277,-118.23 1277,-124.23 1277,-124.23 1277,-290.23 1277,-290.23 1277,-296.23 1271,-302.23 1265,-302.23 1265,-302.23 937,-302.23 937,-302.23 931,-302.23 925,-296.23 925,-290.23 925,-290.23 925,-124.23 925,-124.23 925,-118.23 931,-112.23 937,-112.23"/>
<text text-anchor="middle" x="1101" y="-282.23" font-family="Times,serif" font-size="20.00">metadata</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_snap_data</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M681.5,-321.23C681.5,-321.23 1250.5,-321.23 1250.5,-321.23 1256.5,-321.23 1262.5,-327.23 1262.5,-333.23 1262.5,-333.23 1262.5,-517.23 1262.5,-517.23 1262.5,-523.23 1256.5,-529.23 1250.5,-529.23 1250.5,-529.23 681.5,-529.23 681.5,-529.23 675.5,-529.23 669.5,-523.23 669.5,-517.23 669.5,-517.23 669.5,-333.23 669.5,-333.23 669.5,-327.23 675.5,-321.23 681.5,-321.23"/>
<text text-anchor="middle" x="966" y="-509.23" font-family="Times,serif" font-size="20.00">snap kv数据</text>
</g>
<!-- do_snapshot -->
<g id="node1" class="node">
<title>do_snapshot</title>
<path fill="none" stroke="#1c2123" d="M12,-202.73C12,-202.73 162,-202.73 162,-202.73 168,-202.73 174,-208.73 174,-214.73 174,-214.73 174,-251.73 174,-251.73 174,-257.73 168,-263.73 162,-263.73 162,-263.73 12,-263.73 12,-263.73 6,-263.73 0,-257.73 0,-251.73 0,-251.73 0,-214.73 0,-214.73 0,-208.73 6,-202.73 12,-202.73"/>
<text text-anchor="middle" x="87" y="-248.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">do_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="0,-240.73 174,-240.73 "/>
<text text-anchor="start" x="8" y="-225.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成snapshot metadata部分</text>
<text text-anchor="start" x="8" y="-210.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调动build 生成数据部分</text>
</g>
<!-- register -->
<g id="node2" class="node">
<title>register</title>
<path fill="none" stroke="#1c2123" d="M996.5,-581.23C996.5,-581.23 963.5,-581.23 963.5,-581.23 957.5,-581.23 951.5,-575.23 951.5,-569.23 951.5,-569.23 951.5,-557.23 951.5,-557.23 951.5,-551.23 957.5,-545.23 963.5,-545.23 963.5,-545.23 996.5,-545.23 996.5,-545.23 1002.5,-545.23 1008.5,-551.23 1008.5,-557.23 1008.5,-557.23 1008.5,-569.23 1008.5,-569.23 1008.5,-575.23 1002.5,-581.23 996.5,-581.23"/>
<text text-anchor="middle" x="980" y="-559.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">register</text>
</g>
<!-- do_snapshot&#45;&gt;register -->
<g id="edge4" class="edge">
<title>do_snapshot&#45;&gt;register</title>
<path fill="none" stroke="#666666" d="M87.04,-263.93C86.68,-335.14 96.95,-511.52 202,-590.23 433.14,-763.42 820.75,-628.22 941.76,-579.17"/>
<polygon fill="#666666" stroke="#666666" points="943.4,-582.28 951.32,-575.25 940.74,-575.8 943.4,-582.28"/>
</g>
<!-- get_snapshot_for_building -->
<g id="node3" class="node">
<title>get_snapshot_for_building</title>
<path fill="none" stroke="#1c2123" d="M359,-581.23C359,-581.23 222,-581.23 222,-581.23 216,-581.23 210,-575.23 210,-569.23 210,-569.23 210,-557.23 210,-557.23 210,-551.23 216,-545.23 222,-545.23 222,-545.23 359,-545.23 359,-545.23 365,-545.23 371,-551.23 371,-557.23 371,-557.23 371,-569.23 371,-569.23 371,-575.23 365,-581.23 359,-581.23"/>
<text text-anchor="middle" x="290.5" y="-559.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_snapshot_for_building</text>
</g>
<!-- do_snapshot&#45;&gt;get_snapshot_for_building -->
<g id="edge5" class="edge">
<title>do_snapshot&#45;&gt;get_snapshot_for_building</title>
<path fill="none" stroke="#666666" d="M106.78,-263.98C145.99,-328.2 236.02,-475.65 273.09,-536.36"/>
<polygon fill="#666666" stroke="#666666" points="270.17,-538.29 278.37,-545 276.14,-534.64 270.17,-538.29"/>
</g>
<!-- SnapKey_new -->
<g id="node8" class="node">
<title>SnapKey_new</title>
<path fill="none" stroke="#1c2123" d="M669,-204.23C669,-204.23 835,-204.23 835,-204.23 841,-204.23 847,-210.23 847,-216.23 847,-216.23 847,-260.23 847,-260.23 847,-266.23 841,-272.23 835,-272.23 835,-272.23 669,-272.23 669,-272.23 663,-272.23 657,-266.23 657,-260.23 657,-260.23 657,-216.23 657,-216.23 657,-210.23 663,-204.23 669,-204.23"/>
<text text-anchor="start" x="665" y="-257.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapKey::new(</text>
<text text-anchor="start" x="665" y="-242.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region_id,</text>
<text text-anchor="start" x="665" y="-227.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> last_applied_index_term</text>
<text text-anchor="start" x="665" y="-212.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_state.get_applied_index)</text>
</g>
<!-- do_snapshot&#45;&gt;SnapKey_new -->
<g id="edge6" class="edge">
<title>do_snapshot&#45;&gt;SnapKey_new</title>
<path fill="none" stroke="#666666" d="M174.17,-255.63C183.51,-257.46 192.92,-259.06 202,-260.23 386.7,-284.09 435.74,-284.27 621,-265.23 629.5,-264.36 638.26,-263.17 647.03,-261.78"/>
<polygon fill="#666666" stroke="#666666" points="647.63,-265.23 656.92,-260.13 646.48,-258.32 647.63,-265.23"/>
</g>
<!-- kv_snap_get_msg_cf_CF_RAFT -->
<g id="node9" class="node">
<title>kv_snap_get_msg_cf_CF_RAFT</title>
<path fill="none" stroke="#1c2123" d="M419,-148.73C419,-148.73 609,-148.73 609,-148.73 615,-148.73 621,-154.73 621,-160.73 621,-160.73 621,-189.73 621,-189.73 621,-195.73 615,-201.73 609,-201.73 609,-201.73 419,-201.73 419,-201.73 413,-201.73 407,-195.73 407,-189.73 407,-189.73 407,-160.73 407,-160.73 407,-154.73 413,-148.73 419,-148.73"/>
<text text-anchor="start" x="415" y="-186.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv_snap.get_msg_cf(CF_RAFT, ...)</text>
<text text-anchor="start" x="415" y="-171.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从kv_snap中读取</text>
<text text-anchor="start" x="415" y="-156.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> RaftApplyState</text>
</g>
<!-- do_snapshot&#45;&gt;kv_snap_get_msg_cf_CF_RAFT -->
<g id="edge7" class="edge">
<title>do_snapshot&#45;&gt;kv_snap_get_msg_cf_CF_RAFT</title>
<path fill="none" stroke="#666666" d="M174.27,-211.52C183.6,-209.56 192.97,-207.74 202,-206.23 265.99,-195.51 338.06,-188.04 396.7,-183.13"/>
<polygon fill="#666666" stroke="#666666" points="397.06,-186.61 406.74,-182.3 396.48,-179.63 397.06,-186.61"/>
</g>
<!-- apply_state_key -->
<g id="node10" class="node">
<title>apply_state_key</title>
<path fill="none" stroke="#1c2123" d="M330.5,-251.23C330.5,-251.23 250.5,-251.23 250.5,-251.23 244.5,-251.23 238.5,-245.23 238.5,-239.23 238.5,-239.23 238.5,-227.23 238.5,-227.23 238.5,-221.23 244.5,-215.23 250.5,-215.23 250.5,-215.23 330.5,-215.23 330.5,-215.23 336.5,-215.23 342.5,-221.23 342.5,-227.23 342.5,-227.23 342.5,-239.23 342.5,-239.23 342.5,-245.23 336.5,-251.23 330.5,-251.23"/>
<text text-anchor="middle" x="290.5" y="-229.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_state_key</text>
</g>
<!-- do_snapshot&#45;&gt;apply_state_key -->
<g id="edge8" class="edge">
<title>do_snapshot&#45;&gt;apply_state_key</title>
<path fill="none" stroke="#666666" d="M174.04,-233.23C192.2,-233.23 211.01,-233.23 228.04,-233.23"/>
<polygon fill="#666666" stroke="#666666" points="228.4,-236.73 238.4,-233.23 228.4,-229.73 228.4,-236.73"/>
</g>
<!-- region_state_key -->
<g id="node11" class="node">
<title>region_state_key</title>
<path fill="none" stroke="#1c2123" d="M333,-92.23C333,-92.23 248,-92.23 248,-92.23 242,-92.23 236,-86.23 236,-80.23 236,-80.23 236,-68.23 236,-68.23 236,-62.23 242,-56.23 248,-56.23 248,-56.23 333,-56.23 333,-56.23 339,-56.23 345,-62.23 345,-68.23 345,-68.23 345,-80.23 345,-80.23 345,-86.23 339,-92.23 333,-92.23"/>
<text text-anchor="middle" x="290.5" y="-70.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_state_key</text>
</g>
<!-- do_snapshot&#45;&gt;region_state_key -->
<g id="edge9" class="edge">
<title>do_snapshot&#45;&gt;region_state_key</title>
<path fill="none" stroke="#666666" d="M108.68,-202.64C129.33,-174.16 163.48,-132.3 202,-106.23 209.48,-101.17 217.85,-96.8 226.38,-93.05"/>
<polygon fill="#666666" stroke="#666666" points="227.74,-96.27 235.66,-89.22 225.08,-89.8 227.74,-96.27"/>
</g>
<!-- conf_state_from_region -->
<g id="node12" class="node">
<title>conf_state_from_region</title>
<path fill="none" stroke="#1c2123" d="M688.5,-43.73C688.5,-43.73 815.5,-43.73 815.5,-43.73 821.5,-43.73 827.5,-49.73 827.5,-55.73 827.5,-55.73 827.5,-92.73 827.5,-92.73 827.5,-98.73 821.5,-104.73 815.5,-104.73 815.5,-104.73 688.5,-104.73 688.5,-104.73 682.5,-104.73 676.5,-98.73 676.5,-92.73 676.5,-92.73 676.5,-55.73 676.5,-55.73 676.5,-49.73 682.5,-43.73 688.5,-43.73"/>
<text text-anchor="middle" x="752" y="-89.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">conf_state_from_region</text>
<polyline fill="none" stroke="#1c2123" points="676.5,-81.73 827.5,-81.73 "/>
<text text-anchor="start" x="684.5" y="-66.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">从region的peers信息中</text>
<text text-anchor="start" x="684.5" y="-51.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建ConfState</text>
</g>
<!-- do_snapshot&#45;&gt;conf_state_from_region -->
<g id="edge10" class="edge">
<title>do_snapshot&#45;&gt;conf_state_from_region</title>
<path fill="none" stroke="#666666" d="M96.45,-202.59C110.32,-158.96 142.52,-80.54 202,-47.23 348.44,34.77 552.78,-8.64 666.36,-43.85"/>
<polygon fill="#666666" stroke="#666666" points="665.46,-47.24 676.05,-46.91 667.57,-40.56 665.46,-47.24"/>
</g>
<!-- build -->
<g id="node13" class="node">
<title>build</title>
<path fill="none" stroke="#1c2123" d="M451.5,-393.23C451.5,-393.23 576.5,-393.23 576.5,-393.23 582.5,-393.23 588.5,-399.23 588.5,-405.23 588.5,-405.23 588.5,-465.23 588.5,-465.23 588.5,-471.23 582.5,-477.23 576.5,-477.23 576.5,-477.23 451.5,-477.23 451.5,-477.23 445.5,-477.23 439.5,-471.23 439.5,-465.23 439.5,-465.23 439.5,-405.23 439.5,-405.23 439.5,-399.23 445.5,-393.23 451.5,-393.23"/>
<text text-anchor="middle" x="514" y="-462.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">build</text>
<polyline fill="none" stroke="#1c2123" points="439.5,-454.23 588.5,-454.23 "/>
<text text-anchor="start" x="447.5" y="-439.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">store/snap.rs</text>
<polyline fill="none" stroke="#1c2123" points="439.5,-431.23 588.5,-431.23 "/>
<text text-anchor="start" x="447.5" y="-416.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成snapshot数据部分</text>
<text text-anchor="start" x="447.5" y="-401.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 应该是写到cf文件中</text>
</g>
<!-- do_snapshot&#45;&gt;build -->
<g id="edge11" class="edge">
<title>do_snapshot&#45;&gt;build</title>
<path fill="none" stroke="#666666" d="M139.03,-263.82C158.49,-275.09 181.04,-287.67 202,-298.23 277.81,-336.41 366.63,-374.94 429.9,-401.38"/>
<polygon fill="#666666" stroke="#666666" points="428.86,-404.73 439.43,-405.35 431.55,-398.27 428.86,-404.73"/>
</g>
<!-- get_applied_index -->
<g id="node14" class="node">
<title>get_applied_index</title>
<path fill="none" stroke="#1c2123" d="M798,-185.23C798,-185.23 706,-185.23 706,-185.23 700,-185.23 694,-179.23 694,-173.23 694,-173.23 694,-161.23 694,-161.23 694,-155.23 700,-149.23 706,-149.23 706,-149.23 798,-149.23 798,-149.23 804,-149.23 810,-155.23 810,-161.23 810,-161.23 810,-173.23 810,-173.23 810,-179.23 804,-185.23 798,-185.23"/>
<text text-anchor="middle" x="752" y="-163.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_applied_index</text>
</g>
<!-- do_snapshot&#45;&gt;get_applied_index -->
<g id="edge12" class="edge">
<title>do_snapshot&#45;&gt;get_applied_index</title>
<path fill="none" stroke="#666666" d="M148.22,-202.7C165.29,-194.89 184.11,-187.06 202,-181.23 379.95,-123.24 434.9,-119.41 621,-139.23 641.62,-141.43 663.78,-145.53 683.85,-149.93"/>
<polygon fill="#666666" stroke="#666666" points="683.3,-153.39 693.83,-152.18 684.84,-146.56 683.3,-153.39"/>
</g>
<!-- get_snapshot_for_building&#45;&gt;build -->
<g id="edge13" class="edge">
<title>get_snapshot_for_building&#45;&gt;build</title>
<path fill="none" stroke="#666666" d="M322.77,-545.16C350.92,-528.89 393.55,-504.26 431.33,-482.43"/>
<polygon fill="#666666" stroke="#666666" points="433.4,-485.27 440.31,-477.24 429.9,-479.21 433.4,-485.27"/>
</g>
<!-- set_index -->
<g id="node4" class="node">
<title>set_index</title>
<path fill="none" stroke="#1c2123" d="M1002,-210.23C1002,-210.23 958,-210.23 958,-210.23 952,-210.23 946,-204.23 946,-198.23 946,-198.23 946,-186.23 946,-186.23 946,-180.23 952,-174.23 958,-174.23 958,-174.23 1002,-174.23 1002,-174.23 1008,-174.23 1014,-180.23 1014,-186.23 1014,-186.23 1014,-198.23 1014,-198.23 1014,-204.23 1008,-210.23 1002,-210.23"/>
<text text-anchor="middle" x="980" y="-188.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_index</text>
</g>
<!-- metadata -->
<g id="node7" class="node">
<title>metadata</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1125,-141.73C1125,-141.73 1257,-141.73 1257,-141.73 1263,-141.73 1269,-147.73 1269,-153.73 1269,-153.73 1269,-244.73 1269,-244.73 1269,-250.73 1263,-256.73 1257,-256.73 1257,-256.73 1125,-256.73 1125,-256.73 1119,-256.73 1113,-250.73 1113,-244.73 1113,-244.73 1113,-153.73 1113,-153.73 1113,-147.73 1119,-141.73 1125,-141.73"/>
<text text-anchor="middle" x="1191" y="-241.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">metadata</text>
<polyline fill="none" stroke="#8a8898" points="1113,-233.73 1269,-233.73 "/>
<text text-anchor="start" x="1121" y="-218.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">SnapshotMetadata</text>
<polyline fill="none" stroke="#8a8898" points="1113,-210.73 1269,-210.73 "/>
<text text-anchor="start" x="1121" y="-195.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">ConfState conf_state = 1;</text>
<polyline fill="none" stroke="#8a8898" points="1113,-187.73 1269,-187.73 "/>
<text text-anchor="start" x="1121" y="-172.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 index = 2;</text>
<polyline fill="none" stroke="#8a8898" points="1113,-164.73 1269,-164.73 "/>
<text text-anchor="start" x="1121" y="-149.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 term = 3;</text>
</g>
<!-- set_index&#45;&gt;metadata -->
<g id="edge1" class="edge">
<title>set_index&#45;&gt;metadata</title>
<path fill="none" stroke="#666666" d="M1014.12,-193.34C1038,-194.14 1071.43,-195.26 1102.73,-196.31"/>
<polygon fill="#666666" stroke="#666666" points="1102.69,-199.81 1112.8,-196.64 1102.92,-192.81 1102.69,-199.81"/>
</g>
<!-- set_term -->
<g id="node5" class="node">
<title>set_term</title>
<path fill="none" stroke="#1c2123" d="M1000,-264.23C1000,-264.23 960,-264.23 960,-264.23 954,-264.23 948,-258.23 948,-252.23 948,-252.23 948,-240.23 948,-240.23 948,-234.23 954,-228.23 960,-228.23 960,-228.23 1000,-228.23 1000,-228.23 1006,-228.23 1012,-234.23 1012,-240.23 1012,-240.23 1012,-252.23 1012,-252.23 1012,-258.23 1006,-264.23 1000,-264.23"/>
<text text-anchor="middle" x="980" y="-242.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_term</text>
</g>
<!-- set_term&#45;&gt;metadata -->
<g id="edge2" class="edge">
<title>set_term&#45;&gt;metadata</title>
<path fill="none" stroke="#666666" d="M1012.29,-239.19C1036.33,-233.79 1070.77,-226.04 1102.94,-218.81"/>
<polygon fill="#666666" stroke="#666666" points="1103.85,-222.19 1112.84,-216.58 1102.31,-215.36 1103.85,-222.19"/>
</g>
<!-- set_conf_state -->
<g id="node6" class="node">
<title>set_conf_state</title>
<path fill="none" stroke="#1c2123" d="M1015,-156.23C1015,-156.23 945,-156.23 945,-156.23 939,-156.23 933,-150.23 933,-144.23 933,-144.23 933,-132.23 933,-132.23 933,-126.23 939,-120.23 945,-120.23 945,-120.23 1015,-120.23 1015,-120.23 1021,-120.23 1027,-126.23 1027,-132.23 1027,-132.23 1027,-144.23 1027,-144.23 1027,-150.23 1021,-156.23 1015,-156.23"/>
<text text-anchor="middle" x="980" y="-134.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_conf_state</text>
</g>
<!-- set_conf_state&#45;&gt;metadata -->
<g id="edge3" class="edge">
<title>set_conf_state&#45;&gt;metadata</title>
<path fill="none" stroke="#666666" d="M1027.44,-151.11C1043.19,-155.52 1060.88,-160.54 1077,-165.23 1085.52,-167.71 1094.4,-170.33 1103.26,-172.96"/>
<polygon fill="#666666" stroke="#666666" points="1102.27,-176.32 1112.86,-175.82 1104.27,-169.61 1102.27,-176.32"/>
</g>
<!-- snapshot -->
<g id="node19" class="node">
<title>snapshot</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1317,-236.73C1317,-236.73 1490,-236.73 1490,-236.73 1496,-236.73 1502,-242.73 1502,-248.73 1502,-248.73 1502,-293.73 1502,-293.73 1502,-299.73 1496,-305.73 1490,-305.73 1490,-305.73 1317,-305.73 1317,-305.73 1311,-305.73 1305,-299.73 1305,-293.73 1305,-293.73 1305,-248.73 1305,-248.73 1305,-242.73 1311,-236.73 1317,-236.73"/>
<text text-anchor="start" x="1313" y="-290.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">Snapshot</text>
<polyline fill="none" stroke="#8a8898" points="1305,-282.73 1502,-282.73 "/>
<text text-anchor="start" x="1313" y="-267.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">bytes data = 1;</text>
<polyline fill="none" stroke="#8a8898" points="1305,-259.73 1502,-259.73 "/>
<text text-anchor="start" x="1313" y="-244.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">SnapshotMetadata metadata = 2;</text>
</g>
<!-- metadata&#45;&gt;snapshot -->
<g id="edge29" class="edge">
<title>metadata&#45;&gt;snapshot</title>
<path fill="none" stroke="#666666" d="M1269.19,-225.63C1277.72,-228.55 1286.51,-231.56 1295.33,-234.57"/>
<polygon fill="#666666" stroke="#666666" points="1294.29,-237.92 1304.89,-237.84 1296.56,-231.29 1294.29,-237.92"/>
</g>
<!-- SnapKey_new&#45;&gt;register -->
<g id="edge26" class="edge">
<title>SnapKey_new&#45;&gt;register</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M806.85,-272.58C822.08,-284.88 837.17,-300.01 847,-317.23 895.23,-401.76 819.08,-459.84 883,-533.23 897.45,-549.82 920.94,-557.35 941.07,-560.72"/>
<polygon fill="green" stroke="green" points="940.84,-564.22 951.22,-562.12 941.8,-557.28 940.84,-564.22"/>
</g>
<!-- SnapKey_new&#45;&gt;set_index -->
<g id="edge27" class="edge">
<title>SnapKey_new&#45;&gt;set_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M847.21,-219.05C878.08,-212.77 910.87,-206.1 936.03,-200.98"/>
<polygon fill="green" stroke="green" points="936.86,-204.38 945.96,-198.95 935.47,-197.52 936.86,-204.38"/>
</g>
<!-- SnapKey_new&#45;&gt;set_term -->
<g id="edge28" class="edge">
<title>SnapKey_new&#45;&gt;set_term</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M847.21,-241.56C878.68,-242.68 912.16,-243.86 937.5,-244.76"/>
<polygon fill="green" stroke="green" points="937.71,-248.27 947.83,-245.13 937.96,-241.27 937.71,-248.27"/>
</g>
<!-- apply_state_key&#45;&gt;kv_snap_get_msg_cf_CF_RAFT -->
<g id="edge15" class="edge">
<title>apply_state_key&#45;&gt;kv_snap_get_msg_cf_CF_RAFT</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M342.59,-219.85C360.35,-215.2 381.03,-209.79 401.72,-204.37"/>
<polygon fill="green" stroke="green" points="402.76,-207.71 411.55,-201.79 400.99,-200.94 402.76,-207.71"/>
</g>
<!-- apply_state -->
<g id="node16" class="node">
<title>apply_state</title>
<path fill="none" stroke="#1c2123" d="M541,-256.23C541,-256.23 487,-256.23 487,-256.23 481,-256.23 475,-250.23 475,-244.23 475,-244.23 475,-232.23 475,-232.23 475,-226.23 481,-220.23 487,-220.23 487,-220.23 541,-220.23 541,-220.23 547,-220.23 553,-226.23 553,-232.23 553,-232.23 553,-244.23 553,-244.23 553,-250.23 547,-256.23 541,-256.23"/>
<text text-anchor="middle" x="514" y="-234.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_state</text>
</g>
<!-- apply_state_key&#45;&gt;apply_state -->
<g id="edge16" class="edge">
<title>apply_state_key&#45;&gt;apply_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M342.59,-234.38C379.34,-235.21 428.57,-236.32 464.67,-237.14"/>
<polygon fill="green" stroke="green" points="464.88,-240.64 474.95,-237.37 465.03,-233.65 464.88,-240.64"/>
</g>
<!-- region_state_key&#45;&gt;kv_snap_get_msg_cf_CF_RAFT -->
<g id="edge17" class="edge">
<title>region_state_key&#45;&gt;kv_snap_get_msg_cf_CF_RAFT</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M331.1,-92.29C362.76,-106.72 407.88,-127.29 445.25,-144.34"/>
<polygon fill="green" stroke="green" points="444.03,-147.63 454.58,-148.59 446.93,-141.26 444.03,-147.63"/>
</g>
<!-- region_state -->
<g id="node17" class="node">
<title>region_state</title>
<path fill="none" stroke="#1c2123" d="M543.5,-92.23C543.5,-92.23 484.5,-92.23 484.5,-92.23 478.5,-92.23 472.5,-86.23 472.5,-80.23 472.5,-80.23 472.5,-68.23 472.5,-68.23 472.5,-62.23 478.5,-56.23 484.5,-56.23 484.5,-56.23 543.5,-56.23 543.5,-56.23 549.5,-56.23 555.5,-62.23 555.5,-68.23 555.5,-68.23 555.5,-80.23 555.5,-80.23 555.5,-86.23 549.5,-92.23 543.5,-92.23"/>
<text text-anchor="middle" x="514" y="-70.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_state</text>
</g>
<!-- region_state_key&#45;&gt;region_state -->
<g id="edge18" class="edge">
<title>region_state_key&#45;&gt;region_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M345.12,-74.23C380.78,-74.23 427.32,-74.23 462.35,-74.23"/>
<polygon fill="green" stroke="green" points="462.37,-77.73 472.37,-74.23 462.37,-70.73 462.37,-77.73"/>
</g>
<!-- conf_state_from_region&#45;&gt;set_conf_state -->
<g id="edge21" class="edge">
<title>conf_state_from_region&#45;&gt;set_conf_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M827.63,-95.36C858.68,-104.16 894.12,-114.19 922.9,-122.34"/>
<polygon fill="green" stroke="green" points="922.21,-125.78 932.78,-125.14 924.11,-119.05 922.21,-125.78"/>
</g>
<!-- snap_data -->
<g id="node15" class="node">
<title>snap_data</title>
<path fill="none" stroke="#1c2123" d="M689.5,-329.73C689.5,-329.73 814.5,-329.73 814.5,-329.73 820.5,-329.73 826.5,-335.73 826.5,-341.73 826.5,-341.73 826.5,-478.73 826.5,-478.73 826.5,-484.73 820.5,-490.73 814.5,-490.73 814.5,-490.73 689.5,-490.73 689.5,-490.73 683.5,-490.73 677.5,-484.73 677.5,-478.73 677.5,-478.73 677.5,-341.73 677.5,-341.73 677.5,-335.73 683.5,-329.73 689.5,-329.73"/>
<text text-anchor="middle" x="752" y="-475.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_data</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-467.73 826.5,-467.73 "/>
<text text-anchor="start" x="685.5" y="-452.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftSnapshotData</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-444.73 826.5,-444.73 "/>
<text text-anchor="start" x="685.5" y="-429.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">Region</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-421.73 826.5,-421.73 "/>
<text text-anchor="start" x="685.5" y="-406.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">file_size: u64</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-398.73 826.5,-398.73 "/>
<text text-anchor="start" x="685.5" y="-383.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">data: repeated KeyValue</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-375.73 826.5,-375.73 "/>
<text text-anchor="start" x="685.5" y="-360.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">version: u64</text>
<polyline fill="none" stroke="#1c2123" points="677.5,-352.73 826.5,-352.73 "/>
<text text-anchor="start" x="685.5" y="-337.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">meta: SnapshotMeta</text>
</g>
<!-- build&#45;&gt;snap_data -->
<g id="edge14" class="edge">
<title>build&#45;&gt;snap_data</title>
<path fill="none" stroke="#666666" d="M588.7,-427.42C613.65,-424.78 641.7,-421.81 667.37,-419.09"/>
<polygon fill="#666666" stroke="#666666" points="667.88,-422.55 677.45,-418.02 667.14,-415.59 667.88,-422.55"/>
</g>
<!-- get_applied_index&#45;&gt;set_index -->
<g id="edge23" class="edge">
<title>get_applied_index&#45;&gt;set_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M810.03,-173.54C849.07,-177.86 900.03,-183.49 935.73,-187.44"/>
<polygon fill="green" stroke="green" points="935.51,-190.94 945.84,-188.56 936.28,-183.98 935.51,-190.94"/>
</g>
<!-- snap_data&#45;&gt;snapshot -->
<g id="edge30" class="edge">
<title>snap_data&#45;&gt;snapshot</title>
<path fill="none" stroke="#666666" d="M826.59,-382.83C844.84,-376.72 864.48,-370.74 883,-366.23 1055.11,-324.34 1103.82,-343.42 1277,-306.23 1282.81,-304.98 1288.75,-303.62 1294.73,-302.19"/>
<polygon fill="#666666" stroke="#666666" points="1295.94,-305.49 1304.81,-299.7 1294.27,-298.69 1295.94,-305.49"/>
</g>
<!-- SnapshotMeta -->
<g id="node20" class="node">
<title>SnapshotMeta</title>
<path fill="none" stroke="#1c2123" d="M895,-375.73C895,-375.73 1065,-375.73 1065,-375.73 1071,-375.73 1077,-381.73 1077,-387.73 1077,-387.73 1077,-432.73 1077,-432.73 1077,-438.73 1071,-444.73 1065,-444.73 1065,-444.73 895,-444.73 895,-444.73 889,-444.73 883,-438.73 883,-432.73 883,-432.73 883,-387.73 883,-387.73 883,-381.73 889,-375.73 895,-375.73"/>
<text text-anchor="middle" x="980" y="-429.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotMeta</text>
<polyline fill="none" stroke="#1c2123" points="883,-421.73 1077,-421.73 "/>
<text text-anchor="start" x="891" y="-406.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">cf_files repeated SnapshotCfFile</text>
<polyline fill="none" stroke="#1c2123" points="883,-398.73 1077,-398.73 "/>
<text text-anchor="start" x="891" y="-383.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">for_balance: bool</text>
</g>
<!-- snap_data&#45;&gt;SnapshotMeta -->
<g id="edge32" class="edge">
<title>snap_data&#45;&gt;SnapshotMeta</title>
<path fill="none" stroke="#666666" d="M826.69,-410.23C841.38,-410.23 857.08,-410.23 872.61,-410.23"/>
<polygon fill="#666666" stroke="#666666" points="872.78,-413.73 882.78,-410.23 872.78,-406.73 872.78,-413.73"/>
</g>
<!-- apply_state&#45;&gt;SnapKey_new -->
<g id="edge19" class="edge">
<title>apply_state&#45;&gt;SnapKey_new</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M553.18,-238.23C578.6,-238.23 613.32,-238.23 646.58,-238.23"/>
<polygon fill="green" stroke="green" points="646.85,-241.73 656.84,-238.23 646.84,-234.73 646.85,-241.73"/>
</g>
<!-- apply_state&#45;&gt;get_applied_index -->
<g id="edge22" class="edge">
<title>apply_state&#45;&gt;get_applied_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M553.23,-230.14C573.6,-225.41 598.93,-218.88 621,-211.23 637.54,-205.49 640.58,-201.3 657,-195.23 665.77,-191.99 675.11,-188.85 684.36,-185.92"/>
<polygon fill="green" stroke="green" points="685.43,-189.25 693.94,-182.94 683.36,-182.56 685.43,-189.25"/>
</g>
<!-- region_state&#45;&gt;conf_state_from_region -->
<g id="edge20" class="edge">
<title>region_state&#45;&gt;conf_state_from_region</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M555.57,-74.23C585.81,-74.23 628.19,-74.23 665.76,-74.23"/>
<polygon fill="green" stroke="green" points="666.21,-77.73 676.21,-74.23 666.21,-70.73 666.21,-77.73"/>
</g>
<!-- last_applied_index_term -->
<g id="node18" class="node">
<title>last_applied_index_term</title>
<path fill="none" stroke="#1c2123" d="M419,-312.73C419,-312.73 609,-312.73 609,-312.73 615,-312.73 621,-318.73 621,-324.73 621,-324.73 621,-361.73 621,-361.73 621,-367.73 615,-373.73 609,-373.73 609,-373.73 419,-373.73 419,-373.73 413,-373.73 407,-367.73 407,-361.73 407,-361.73 407,-324.73 407,-324.73 407,-318.73 413,-312.73 419,-312.73"/>
<text text-anchor="middle" x="514" y="-358.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">last_applied_index_term</text>
<polyline fill="none" stroke="#1c2123" points="407,-350.73 621,-350.73 "/>
<text text-anchor="start" x="415" y="-335.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">在ApplyFsm.handle_snapshot设置</text>
<text text-anchor="start" x="415" y="-320.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ApplyDelegate.applied_index_term</text>
</g>
<!-- last_applied_index_term&#45;&gt;set_term -->
<g id="edge25" class="edge">
<title>last_applied_index_term&#45;&gt;set_term</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M621.11,-323.79C717.18,-306.18 844.17,-282.88 847,-282.23 877.77,-275.22 912.16,-265.79 938.12,-258.34"/>
<polygon fill="green" stroke="green" points="939.35,-261.63 947.98,-255.49 937.4,-254.9 939.35,-261.63"/>
</g>
<!-- last_applied_index_term&#45;&gt;SnapKey_new -->
<g id="edge24" class="edge">
<title>last_applied_index_term&#45;&gt;SnapKey_new</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M587.83,-312.66C598.96,-307.89 610.31,-302.97 621,-298.23 636.58,-291.33 653.14,-283.82 669.03,-276.53"/>
<polygon fill="green" stroke="green" points="670.68,-279.62 678.3,-272.27 667.75,-273.26 670.68,-279.62"/>
</g>
<!-- SnapshotCfFile -->
<g id="node21" class="node">
<title>SnapshotCfFile</title>
<path fill="none" stroke="#1c2123" d="M1139.5,-372.23C1139.5,-372.23 1242.5,-372.23 1242.5,-372.23 1248.5,-372.23 1254.5,-378.23 1254.5,-384.23 1254.5,-384.23 1254.5,-436.23 1254.5,-436.23 1254.5,-442.23 1248.5,-448.23 1242.5,-448.23 1242.5,-448.23 1139.5,-448.23 1139.5,-448.23 1133.5,-448.23 1127.5,-442.23 1127.5,-436.23 1127.5,-436.23 1127.5,-384.23 1127.5,-384.23 1127.5,-378.23 1133.5,-372.23 1139.5,-372.23"/>
<text text-anchor="middle" x="1191" y="-433.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotCfFile</text>
<polyline fill="none" stroke="#1c2123" points="1127.5,-425.23 1254.5,-425.23 "/>
<text text-anchor="start" x="1135.5" y="-410.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub cf: string</text>
<text text-anchor="start" x="1135.5" y="-395.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pub size: u64</text>
<text text-anchor="start" x="1135.5" y="-380.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pub checksum: u32</text>
</g>
<!-- SnapshotMeta&#45;&gt;SnapshotCfFile -->
<g id="edge31" class="edge">
<title>SnapshotMeta&#45;&gt;SnapshotCfFile</title>
<path fill="none" stroke="#666666" d="M1077.24,-410.23C1090.68,-410.23 1104.31,-410.23 1117.22,-410.23"/>
<polygon fill="#666666" stroke="#666666" points="1117.4,-413.73 1127.4,-410.23 1117.4,-406.73 1117.4,-413.73"/>
</g>
</g>
</svg>
