<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: PeerStorage_Entries Pages: 1 -->
<svg width="928pt" height="410pt"
 viewBox="0.00 0.00 928.00 410.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 406)">
<title>PeerStorage_Entries</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-406 924,-406 924,4 -4,4"/>
<!-- PeerStorage_entries -->
<g id="node1" class="node">
<title>PeerStorage_entries</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M249,-273.5C249,-273.5 417,-273.5 417,-273.5 423,-273.5 429,-279.5 429,-285.5 429,-285.5 429,-307.5 429,-307.5 429,-313.5 423,-319.5 417,-319.5 417,-319.5 249,-319.5 249,-319.5 243,-319.5 237,-313.5 237,-307.5 237,-307.5 237,-285.5 237,-285.5 237,-279.5 243,-273.5 249,-273.5"/>
<text text-anchor="middle" x="333" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerStorage::entries</text>
<polyline fill="none" stroke="#8a8898" points="237,-296.5 429,-296.5 "/>
<text text-anchor="start" x="245" y="-281.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">取low,high范围内的log entries</text>
</g>
<!-- check_range -->
<g id="node2" class="node">
<title>check_range</title>
<path fill="none" stroke="#1c2123" d="M529,-325.5C529,-325.5 675,-325.5 675,-325.5 681,-325.5 687,-331.5 687,-337.5 687,-337.5 687,-389.5 687,-389.5 687,-395.5 681,-401.5 675,-401.5 675,-401.5 529,-401.5 529,-401.5 523,-401.5 517,-395.5 517,-389.5 517,-389.5 517,-337.5 517,-337.5 517,-331.5 523,-325.5 529,-325.5"/>
<text text-anchor="middle" x="602" y="-386.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage::check_range</text>
<polyline fill="none" stroke="#1c2123" points="517,-378.5 687,-378.5 "/>
<text text-anchor="start" x="525" y="-363.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查low,high 是否在</text>
<text text-anchor="start" x="525" y="-348.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> truncated_index, last_index</text>
<text text-anchor="start" x="525" y="-333.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 范围内</text>
</g>
<!-- PeerStorage_entries&#45;&gt;check_range -->
<g id="edge1" class="edge">
<title>PeerStorage_entries&#45;&gt;check_range</title>
<path fill="none" stroke="#666666" d="M425.89,-319.56C451.97,-326.1 480.41,-333.24 506.63,-339.82"/>
<polygon fill="#666666" stroke="#666666" points="506.02,-343.27 516.57,-342.31 507.72,-336.48 506.02,-343.27"/>
</g>
<!-- RaftEngine_fetch_entries_to -->
<g id="node3" class="node">
<title>RaftEngine_fetch_entries_to</title>
<path fill="none" stroke="#1c2123" d="M759,-228C759,-228 908,-228 908,-228 914,-228 920,-234 920,-240 920,-240 920,-277 920,-277 920,-283 914,-289 908,-289 908,-289 759,-289 759,-289 753,-289 747,-283 747,-277 747,-277 747,-240 747,-240 747,-234 753,-228 759,-228"/>
<text text-anchor="middle" x="833.5" y="-273.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftEngine::fetch_entries_to</text>
<polyline fill="none" stroke="#1c2123" points="747,-266 920,-266 "/>
<text text-anchor="start" x="755" y="-250.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从raft engine中取</text>
<text text-anchor="start" x="755" y="-235.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> [begin,end)的log entry</text>
</g>
<!-- PeerStorage_entries&#45;&gt;RaftEngine_fetch_entries_to -->
<g id="edge2" class="edge">
<title>PeerStorage_entries&#45;&gt;RaftEngine_fetch_entries_to</title>
<path fill="none" stroke="#666666" d="M429.11,-294.46C505.46,-292.16 615.34,-287.36 711,-277.5 719.32,-276.64 727.94,-275.6 736.57,-274.46"/>
<polygon fill="#666666" stroke="#666666" points="737.26,-277.89 746.69,-273.07 736.3,-270.96 737.26,-277.89"/>
</g>
<!-- EntryCache_fetch_entries_to -->
<g id="node4" class="node">
<title>EntryCache_fetch_entries_to</title>
<path fill="none" stroke="#1c2123" d="M526.5,-231.5C526.5,-231.5 677.5,-231.5 677.5,-231.5 683.5,-231.5 689.5,-237.5 689.5,-243.5 689.5,-243.5 689.5,-255.5 689.5,-255.5 689.5,-261.5 683.5,-267.5 677.5,-267.5 677.5,-267.5 526.5,-267.5 526.5,-267.5 520.5,-267.5 514.5,-261.5 514.5,-255.5 514.5,-255.5 514.5,-243.5 514.5,-243.5 514.5,-237.5 520.5,-231.5 526.5,-231.5"/>
<text text-anchor="middle" x="602" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">EntryCache::fetch_entries_to</text>
</g>
<!-- PeerStorage_entries&#45;&gt;EntryCache_fetch_entries_to -->
<g id="edge3" class="edge">
<title>PeerStorage_entries&#45;&gt;EntryCache_fetch_entries_to</title>
<path fill="none" stroke="#666666" d="M429.26,-279.73C453.61,-275.44 479.82,-270.83 504.24,-266.53"/>
<polygon fill="#666666" stroke="#666666" points="504.99,-269.96 514.23,-264.77 503.77,-263.06 504.99,-269.96"/>
</g>
<!-- EntryCache -->
<g id="node8" class="node">
<title>EntryCache</title>
<path fill="none" stroke="#1c2123" d="M765,-56C765,-56 902,-56 902,-56 908,-56 914,-62 914,-68 914,-68 914,-159 914,-159 914,-165 908,-171 902,-171 902,-171 765,-171 765,-171 759,-171 753,-165 753,-159 753,-159 753,-68 753,-68 753,-62 759,-56 765,-56"/>
<text text-anchor="middle" x="833.5" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">EntryCache</text>
<polyline fill="none" stroke="#1c2123" points="753,-148 914,-148 "/>
<text text-anchor="start" x="761" y="-132.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">cache: VecDeque&lt;Entry&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="753,-125 914,-125 "/>
<text text-anchor="start" x="761" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">hit: Cell&lt;i64&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="753,-102 914,-102 "/>
<text text-anchor="start" x="761" y="-86.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">miss: Cell&lt;i64&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="753,-79 914,-79 "/>
<text text-anchor="start" x="761" y="-63.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">mem_size_change: i64,</text>
</g>
<!-- EntryCache_fetch_entries_to&#45;&gt;EntryCache -->
<g id="edge7" class="edge">
<title>EntryCache_fetch_entries_to&#45;&gt;EntryCache</title>
<path fill="none" stroke="#666666" d="M688.47,-231.44C696.28,-228.58 703.91,-225.28 711,-221.5 732.35,-210.11 753.03,-194.23 771.09,-178.15"/>
<polygon fill="#666666" stroke="#666666" points="773.63,-180.58 778.67,-171.26 768.92,-175.4 773.63,-180.58"/>
</g>
<!-- PeerStorage_append -->
<g id="node5" class="node">
<title>PeerStorage_append</title>
<path fill="none" stroke="#1c2123" d="M254,-120C254,-120 412,-120 412,-120 418,-120 424,-126 424,-132 424,-132 424,-169 424,-169 424,-175 418,-181 412,-181 412,-181 254,-181 254,-181 248,-181 242,-175 242,-169 242,-169 242,-132 242,-132 242,-126 248,-120 254,-120"/>
<text text-anchor="middle" x="333" y="-165.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage::append</text>
<polyline fill="none" stroke="#1c2123" points="242,-158 424,-158 "/>
<text text-anchor="start" x="250" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将raft ready log entries</text>
<text text-anchor="start" x="250" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 写到raftengine 的write batch</text>
</g>
<!-- EntryCache_append -->
<g id="node6" class="node">
<title>EntryCache_append</title>
<path fill="none" stroke="#1c2123" d="M550.5,-95.5C550.5,-95.5 653.5,-95.5 653.5,-95.5 659.5,-95.5 665.5,-101.5 665.5,-107.5 665.5,-107.5 665.5,-119.5 665.5,-119.5 665.5,-125.5 659.5,-131.5 653.5,-131.5 653.5,-131.5 550.5,-131.5 550.5,-131.5 544.5,-131.5 538.5,-125.5 538.5,-119.5 538.5,-119.5 538.5,-107.5 538.5,-107.5 538.5,-101.5 544.5,-95.5 550.5,-95.5"/>
<text text-anchor="middle" x="602" y="-109.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">EntryCache::append</text>
</g>
<!-- PeerStorage_append&#45;&gt;EntryCache_append -->
<g id="edge4" class="edge">
<title>PeerStorage_append&#45;&gt;EntryCache_append</title>
<path fill="none" stroke="#666666" d="M424.02,-138.03C457.9,-133.33 495.97,-128.05 528.1,-123.6"/>
<polygon fill="#666666" stroke="#666666" points="528.89,-127.03 538.31,-122.19 527.92,-120.09 528.89,-127.03"/>
</g>
<!-- Raft_wb_mut_append -->
<g id="node10" class="node">
<title>Raft_wb_mut_append</title>
<path fill="none" stroke="#1c2123" d="M545.5,-151C545.5,-151 658.5,-151 658.5,-151 664.5,-151 670.5,-157 670.5,-163 670.5,-163 670.5,-200 670.5,-200 670.5,-206 664.5,-212 658.5,-212 658.5,-212 545.5,-212 545.5,-212 539.5,-212 533.5,-206 533.5,-200 533.5,-200 533.5,-163 533.5,-163 533.5,-157 539.5,-151 545.5,-151"/>
<text text-anchor="middle" x="602" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft_wb_mut_append</text>
<polyline fill="none" stroke="#1c2123" points="533.5,-189 670.5,-189 "/>
<text text-anchor="start" x="541.5" y="-173.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将raft日志append</text>
<text text-anchor="start" x="541.5" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 到write batch中</text>
</g>
<!-- PeerStorage_append&#45;&gt;Raft_wb_mut_append -->
<g id="edge9" class="edge">
<title>PeerStorage_append&#45;&gt;Raft_wb_mut_append</title>
<path fill="none" stroke="#666666" d="M424.02,-160.95C456.12,-164.68 491.99,-168.84 522.99,-172.44"/>
<polygon fill="#666666" stroke="#666666" points="522.97,-175.96 533.31,-173.64 523.78,-169.01 522.97,-175.96"/>
</g>
<!-- EntryCache_append&#45;&gt;EntryCache -->
<g id="edge8" class="edge">
<title>EntryCache_append&#45;&gt;EntryCache</title>
<path fill="none" stroke="#666666" d="M665.71,-113.5C689.38,-113.5 716.79,-113.5 742.47,-113.5"/>
<polygon fill="#666666" stroke="#666666" points="742.59,-117 752.59,-113.5 742.59,-110 742.59,-117"/>
</g>
<!-- RaftEngine_has_builtin_entry_cache -->
<g id="node7" class="node">
<title>RaftEngine_has_builtin_entry_cache</title>
<path fill="none" stroke="#1c2123" d="M505,-0.5C505,-0.5 699,-0.5 699,-0.5 705,-0.5 711,-6.5 711,-12.5 711,-12.5 711,-64.5 711,-64.5 711,-70.5 705,-76.5 699,-76.5 699,-76.5 505,-76.5 505,-76.5 499,-76.5 493,-70.5 493,-64.5 493,-64.5 493,-12.5 493,-12.5 493,-6.5 499,-0.5 505,-0.5"/>
<text text-anchor="start" x="501" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftEngine::has_builtin_entry_cache</text>
<polyline fill="none" stroke="#1c2123" points="493,-53.5 711,-53.5 "/>
<text text-anchor="start" x="501" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果raft engin自己有</text>
<text text-anchor="start" x="501" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entry cache就不用PeerStorage</text>
<text text-anchor="start" x="501" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的entry cache了</text>
</g>
<!-- RaftEngine_has_builtin_entry_cache&#45;&gt;EntryCache -->
<g id="edge5" class="edge">
<title>RaftEngine_has_builtin_entry_cache&#45;&gt;EntryCache</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M711.03,-73.8C721.8,-77.32 732.65,-80.87 743.2,-84.32"/>
<polygon fill="green" stroke="green" points="742.2,-87.67 752.79,-87.45 744.37,-81.02 742.2,-87.67"/>
</g>
<!-- PeerStorage_new -->
<g id="node9" class="node">
<title>PeerStorage_new</title>
<path fill="none" stroke="#1c2123" d="M221,-8C221,-8 445,-8 445,-8 451,-8 457,-14 457,-20 457,-20 457,-57 457,-57 457,-63 451,-69 445,-69 445,-69 221,-69 221,-69 215,-69 209,-63 209,-57 209,-57 209,-20 209,-20 209,-14 215,-8 221,-8"/>
<text text-anchor="middle" x="333" y="-53.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage::new</text>
<polyline fill="none" stroke="#1c2123" points="209,-46 457,-46 "/>
<text text-anchor="start" x="217" y="-30.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建时候，根据has_builtin_entry_cache</text>
<text text-anchor="start" x="217" y="-15.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来决定要不要使用EntryCache</text>
</g>
<!-- PeerStorage_new&#45;&gt;RaftEngine_has_builtin_entry_cache -->
<g id="edge6" class="edge">
<title>PeerStorage_new&#45;&gt;RaftEngine_has_builtin_entry_cache</title>
<path fill="none" stroke="#666666" d="M457.34,-38.5C465.79,-38.5 474.3,-38.5 482.72,-38.5"/>
<polygon fill="#666666" stroke="#666666" points="482.95,-42 492.95,-38.5 482.95,-35 482.95,-42"/>
</g>
<!-- Raft_wb_mut_append&#45;&gt;RaftEngine_fetch_entries_to -->
<g id="edge10" class="edge">
<title>Raft_wb_mut_append&#45;&gt;RaftEngine_fetch_entries_to</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M670.62,-204.19C691.44,-211.17 714.77,-219 737.1,-226.49"/>
<polygon fill="green" stroke="green" points="736,-229.81 746.59,-229.68 738.23,-223.18 736,-229.81"/>
</g>
<!-- PeerStorage_term -->
<g id="node11" class="node">
<title>PeerStorage_term</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M12,-251C12,-251 161,-251 161,-251 167,-251 173,-257 173,-263 173,-263 173,-330 173,-330 173,-336 167,-342 161,-342 161,-342 12,-342 12,-342 6,-342 0,-336 0,-330 0,-330 0,-263 0,-263 0,-257 6,-251 12,-251"/>
<text text-anchor="middle" x="86.5" y="-326.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerStorage::term</text>
<polyline fill="none" stroke="#8a8898" points="0,-319 173,-319 "/>
<text text-anchor="start" x="8" y="-303.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果idx == truncated_index</text>
<text text-anchor="start" x="8" y="-288.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 直接返回truncated_term</text>
<text text-anchor="start" x="8" y="-273.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 否则读取idx对应的entry</text>
<text text-anchor="start" x="8" y="-258.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 然后返回entry对应的term</text>
</g>
<!-- PeerStorage_term&#45;&gt;PeerStorage_entries -->
<g id="edge11" class="edge">
<title>PeerStorage_term&#45;&gt;PeerStorage_entries</title>
<path fill="none" stroke="#666666" d="M173.01,-296.5C190.36,-296.5 208.8,-296.5 226.74,-296.5"/>
<polygon fill="#666666" stroke="#666666" points="226.93,-300 236.93,-296.5 226.93,-293 226.93,-300"/>
</g>
</g>
</svg>
