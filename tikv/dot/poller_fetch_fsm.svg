<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: poller_fetch_fsm Pages: 1 -->
<svg width="900pt" height="384pt"
 viewBox="0.00 0.00 900.00 383.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 379.5)">
<title>poller_fetch_fsm</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-379.5 896,-379.5 896,4 -4,4"/>
<g id="clust3" class="cluster">
<title>cluster_PollHandler</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M703,-8C703,-8 872,-8 872,-8 878,-8 884,-14 884,-20 884,-20 884,-345 884,-345 884,-351 878,-357 872,-357 872,-357 703,-357 703,-357 697,-357 691,-351 691,-345 691,-345 691,-20 691,-20 691,-14 697,-8 703,-8"/>
<text text-anchor="middle" x="787.5" y="-337" font-family="Times,serif" font-size="20.00">PollHandler</text>
</g>
<!-- NormalChannel -->
<g id="node1" class="node">
<title>NormalChannel</title>
<path fill="none" stroke="#1c2123" d="M38.5,-145C38.5,-145 118.5,-145 118.5,-145 124.5,-145 130.5,-151 130.5,-157 130.5,-157 130.5,-363 130.5,-363 130.5,-369 124.5,-375 118.5,-375 118.5,-375 38.5,-375 38.5,-375 32.5,-375 26.5,-369 26.5,-363 26.5,-363 26.5,-157 26.5,-157 26.5,-151 32.5,-145 38.5,-145"/>
<text text-anchor="middle" x="78.5" y="-359.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">NormalChannel</text>
<polyline fill="none" stroke="#1c2123" points="26.5,-352 130.5,-352 "/>
<text text-anchor="middle" x="78.5" y="-336.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
<polyline fill="none" stroke="#1c2123" points="26.5,-329 130.5,-329 "/>
<text text-anchor="middle" x="43" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-283 59.5,-329 "/>
<text text-anchor="middle" x="95" y="-313.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">region1</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-306 130.5,-306 "/>
<text text-anchor="middle" x="95" y="-290.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="26.5,-283 130.5,-283 "/>
<text text-anchor="middle" x="43" y="-256.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-237 59.5,-283 "/>
<text text-anchor="middle" x="95" y="-267.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">region2</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-260 130.5,-260 "/>
<text text-anchor="middle" x="95" y="-244.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="26.5,-237 130.5,-237 "/>
<text text-anchor="middle" x="43" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-191 59.5,-237 "/>
<text text-anchor="middle" x="95" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">region3</text>
<polyline fill="none" stroke="#1c2123" points="59.5,-214 130.5,-214 "/>
<text text-anchor="middle" x="95" y="-198.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="26.5,-191 130.5,-191 "/>
<text text-anchor="middle" x="78.5" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
<polyline fill="none" stroke="#1c2123" points="26.5,-168 130.5,-168 "/>
<text text-anchor="middle" x="78.5" y="-152.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">...</text>
</g>
<!-- fetch_fsm -->
<g id="node3" class="node">
<title>fetch_fsm</title>
<path fill="none" stroke="#1c2123" d="M252,-275C252,-275 205,-275 205,-275 199,-275 193,-269 193,-263 193,-263 193,-251 193,-251 193,-245 199,-239 205,-239 205,-239 252,-239 252,-239 258,-239 264,-245 264,-251 264,-251 264,-263 264,-263 264,-269 258,-275 252,-275"/>
<text text-anchor="middle" x="228.5" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">fetch_fsm</text>
</g>
<!-- NormalChannel&#45;&gt;fetch_fsm -->
<g id="edge1" class="edge">
<title>NormalChannel&#45;&gt;fetch_fsm</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M130.85,-258.96C147.7,-258.62 166.28,-258.24 182.61,-257.91"/>
<polygon fill="green" stroke="green" points="183.05,-261.4 192.97,-257.7 182.91,-254.4 183.05,-261.4"/>
</g>
<!-- Batch -->
<g id="node2" class="node">
<title>Batch</title>
<path fill="none" stroke="#1c2123" d="M507,-147C507,-147 651,-147 651,-147 657,-147 663,-153 663,-159 663,-159 663,-227 663,-227 663,-233 657,-239 651,-239 651,-239 507,-239 507,-239 501,-239 495,-233 495,-227 495,-227 495,-159 495,-159 495,-153 501,-147 507,-147"/>
<text text-anchor="middle" x="579" y="-223.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Batch</text>
<polyline fill="none" stroke="#1c2123" points="495,-216 663,-216 "/>
<text text-anchor="start" x="503" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">normals: Vec&lt;Box&lt;N&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="495,-193 663,-193 "/>
<text text-anchor="start" x="503" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">timers: Vec&lt;Instant&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="495,-170 663,-170 "/>
<text text-anchor="start" x="503" y="-154.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">control: Option&lt;Box&lt;C&gt;&gt;,</text>
</g>
<!-- handle_control -->
<g id="node8" class="node">
<title>handle_control</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M729,-97C729,-97 846,-97 846,-97 852,-97 858,-103 858,-109 858,-109 858,-131 858,-131 858,-137 852,-143 846,-143 846,-143 729,-143 729,-143 723,-143 717,-137 717,-131 717,-131 717,-109 717,-109 717,-103 723,-97 729,-97"/>
<text text-anchor="middle" x="787.5" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">handle_control</text>
<polyline fill="none" stroke="#8a8898" points="717,-120 858,-120 "/>
<text text-anchor="middle" x="787.5" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">处理batch中的control</text>
</g>
<!-- Batch&#45;&gt;handle_control -->
<g id="edge12" class="edge">
<title>Batch:control&#45;&gt;handle_control</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M663,-158C673.65,-158 693.39,-152.77 714.01,-146.19"/>
<polygon fill="green" stroke="green" points="715.1,-149.52 723.52,-143.09 712.93,-142.87 715.1,-149.52"/>
</g>
<!-- handle_normal -->
<g id="node9" class="node">
<title>handle_normal</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M726,-162C726,-162 849,-162 849,-162 855,-162 861,-168 861,-174 861,-174 861,-226 861,-226 861,-232 855,-238 849,-238 849,-238 726,-238 726,-238 720,-238 714,-232 714,-226 714,-226 714,-174 714,-174 714,-168 720,-162 726,-162"/>
<text text-anchor="middle" x="787.5" y="-222.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">handle_normal</text>
<polyline fill="none" stroke="#8a8898" points="714,-215 861,-215 "/>
<text text-anchor="start" x="722" y="-199.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">处理batch中的normals</text>
<text text-anchor="start" x="722" y="-184.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> foreach normals</text>
<text text-anchor="start" x="722" y="-169.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 调用handle_normal</text>
</g>
<!-- Batch&#45;&gt;handle_normal -->
<g id="edge11" class="edge">
<title>Batch:normals&#45;&gt;handle_normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M663,-205C676.08,-205 689.94,-204.72 703.45,-204.28"/>
<polygon fill="green" stroke="green" points="703.83,-207.77 713.71,-203.93 703.59,-200.78 703.83,-207.77"/>
</g>
<!-- fsm_receiver_try_recv -->
<g id="node5" class="node">
<title>fsm_receiver_try_recv</title>
<path fill="none" stroke="#1c2123" d="M312,-226.5C312,-226.5 447,-226.5 447,-226.5 453,-226.5 459,-232.5 459,-238.5 459,-238.5 459,-275.5 459,-275.5 459,-281.5 453,-287.5 447,-287.5 447,-287.5 312,-287.5 312,-287.5 306,-287.5 300,-281.5 300,-275.5 300,-275.5 300,-238.5 300,-238.5 300,-232.5 306,-226.5 312,-226.5"/>
<text text-anchor="middle" x="379.5" y="-272.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">fsm_receiver.try_recv</text>
<polyline fill="none" stroke="#1c2123" points="300,-264.5 459,-264.5 "/>
<text text-anchor="start" x="308" y="-249.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">尝试nonblock地获取fsm</text>
<text text-anchor="middle" x="379.5" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后push到Batch；</text>
</g>
<!-- fetch_fsm&#45;&gt;fsm_receiver_try_recv -->
<g id="edge3" class="edge">
<title>fetch_fsm&#45;&gt;fsm_receiver_try_recv</title>
<path fill="none" stroke="#666666" d="M264.06,-257C271.93,-257 280.64,-257 289.65,-257"/>
<polygon fill="#666666" stroke="#666666" points="289.91,-260.5 299.91,-257 289.91,-253.5 289.91,-260.5"/>
</g>
<!-- fsm_receiver_recv -->
<g id="node6" class="node">
<title>fsm_receiver_recv</title>
<path fill="none" stroke="#1c2123" d="M321,-146.5C321,-146.5 438,-146.5 438,-146.5 444,-146.5 450,-152.5 450,-158.5 450,-158.5 450,-195.5 450,-195.5 450,-201.5 444,-207.5 438,-207.5 438,-207.5 321,-207.5 321,-207.5 315,-207.5 309,-201.5 309,-195.5 309,-195.5 309,-158.5 309,-158.5 309,-152.5 315,-146.5 321,-146.5"/>
<text text-anchor="middle" x="379.5" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">fsm_receiver.recv</text>
<polyline fill="none" stroke="#1c2123" points="309,-184.5 450,-184.5 "/>
<text text-anchor="start" x="317" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">try_recv读取fsm为空</text>
<text text-anchor="start" x="317" y="-154.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则blocked去获取fsm</text>
</g>
<!-- fetch_fsm&#45;&gt;fsm_receiver_recv -->
<g id="edge4" class="edge">
<title>fetch_fsm&#45;&gt;fsm_receiver_recv</title>
<path fill="none" stroke="#666666" d="M260.57,-238.98C272.79,-231.99 286.99,-224 300,-217 302.9,-215.44 305.86,-213.86 308.86,-212.28"/>
<polygon fill="#666666" stroke="#666666" points="310.7,-215.26 317.93,-207.52 307.45,-209.07 310.7,-215.26"/>
</g>
<!-- handler_pause -->
<g id="node7" class="node">
<title>handler_pause</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M711,-257.5C711,-257.5 864,-257.5 864,-257.5 870,-257.5 876,-263.5 876,-269.5 876,-269.5 876,-306.5 876,-306.5 876,-312.5 870,-318.5 864,-318.5 864,-318.5 711,-318.5 711,-318.5 705,-318.5 699,-312.5 699,-306.5 699,-306.5 699,-269.5 699,-269.5 699,-263.5 705,-257.5 711,-257.5"/>
<text text-anchor="middle" x="787.5" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pause</text>
<polyline fill="none" stroke="#8a8898" points="699,-295.5 876,-295.5 "/>
<text text-anchor="start" x="707" y="-280.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">在block之前先调用poller</text>
<text text-anchor="start" x="707" y="-265.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> pause, 通知poller要block了</text>
</g>
<!-- fetch_fsm&#45;&gt;handler_pause -->
<g id="edge5" class="edge">
<title>fetch_fsm&#45;&gt;handler_pause</title>
<path fill="none" stroke="#666666" d="M253.9,-275.01C266.89,-283.48 283.54,-292.65 300,-297 431.09,-331.6 589.02,-319.28 688.61,-305.27"/>
<polygon fill="#666666" stroke="#666666" points="689.27,-308.71 698.66,-303.82 688.27,-301.78 689.27,-308.71"/>
</g>
<!-- poll -->
<g id="node4" class="node">
<title>poll</title>
<path fill="none" stroke="#1c2123" d="M12,-34.5C12,-34.5 145,-34.5 145,-34.5 151,-34.5 157,-40.5 157,-46.5 157,-46.5 157,-113.5 157,-113.5 157,-119.5 151,-125.5 145,-125.5 145,-125.5 12,-125.5 12,-125.5 6,-125.5 0,-119.5 0,-113.5 0,-113.5 0,-46.5 0,-46.5 0,-40.5 6,-34.5 12,-34.5"/>
<text text-anchor="middle" x="78.5" y="-110.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll</text>
<polyline fill="none" stroke="#1c2123" points="0,-102.5 157,-102.5 "/>
<text text-anchor="start" x="8" y="-87.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从channel中读取fsm</text>
<text text-anchor="start" x="8" y="-72.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后调用PollHandler的</text>
<text text-anchor="start" x="8" y="-57.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_control</text>
<text text-anchor="start" x="8" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_normal</text>
</g>
<!-- poll&#45;&gt;fetch_fsm -->
<g id="edge2" class="edge">
<title>poll&#45;&gt;fetch_fsm</title>
<path fill="none" stroke="#666666" d="M147.77,-125.73C151.01,-128.73 154.11,-131.83 157,-135 183,-163.54 203.74,-203.27 215.82,-229.53"/>
<polygon fill="#666666" stroke="#666666" points="212.73,-231.2 220.02,-238.89 219.12,-228.33 212.73,-231.2"/>
</g>
<!-- poll&#45;&gt;handle_control -->
<g id="edge8" class="edge">
<title>poll&#45;&gt;handle_control</title>
<path fill="none" stroke="#666666" d="M157.03,-81.03C268.94,-83 482.17,-88.6 663,-104 677.18,-105.21 692.23,-106.85 706.76,-108.63"/>
<polygon fill="#666666" stroke="#666666" points="706.37,-112.11 716.73,-109.88 707.24,-105.16 706.37,-112.11"/>
</g>
<!-- poll&#45;&gt;handle_normal -->
<g id="edge9" class="edge">
<title>poll&#45;&gt;handle_normal</title>
<path fill="none" stroke="#666666" d="M157.03,-85.75C304.72,-96.98 615.93,-122.01 663,-137 676.66,-141.35 678.34,-146.28 691,-153 695.48,-155.38 700.09,-157.78 704.76,-160.19"/>
<polygon fill="#666666" stroke="#666666" points="703.28,-163.37 713.78,-164.8 706.47,-157.13 703.28,-163.37"/>
</g>
<!-- handler_end -->
<g id="node10" class="node">
<title>handler_end</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M734,-16.5C734,-16.5 841,-16.5 841,-16.5 847,-16.5 853,-22.5 853,-28.5 853,-28.5 853,-65.5 853,-65.5 853,-71.5 847,-77.5 841,-77.5 841,-77.5 734,-77.5 734,-77.5 728,-77.5 722,-71.5 722,-65.5 722,-65.5 722,-28.5 722,-28.5 722,-22.5 728,-16.5 734,-16.5"/>
<text text-anchor="middle" x="787.5" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">end</text>
<polyline fill="none" stroke="#8a8898" points="722,-54.5 853,-54.5 "/>
<text text-anchor="start" x="730" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">整个batch处理完毕</text>
<text text-anchor="start" x="730" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 调用handle_end</text>
</g>
<!-- poll&#45;&gt;handler_end -->
<g id="edge10" class="edge">
<title>poll&#45;&gt;handler_end</title>
<path fill="none" stroke="#666666" d="M157.18,-76.37C294.14,-69.98 576.79,-56.79 711.68,-50.49"/>
<polygon fill="#666666" stroke="#666666" points="712.09,-53.98 721.92,-50.01 711.77,-46.98 712.09,-53.98"/>
</g>
<!-- fsm_receiver_try_recv&#45;&gt;Batch -->
<g id="edge6" class="edge">
<title>fsm_receiver_try_recv&#45;&gt;Batch</title>
<path fill="none" stroke="#666666" d="M459.12,-231.52C467.64,-228.76 476.37,-225.93 485.04,-223.12"/>
<polygon fill="#666666" stroke="#666666" points="486.35,-226.38 494.79,-219.97 484.19,-219.72 486.35,-226.38"/>
</g>
<!-- fsm_receiver_recv&#45;&gt;Batch -->
<g id="edge7" class="edge">
<title>fsm_receiver_recv&#45;&gt;Batch</title>
<path fill="none" stroke="#666666" d="M450.13,-182.64C461.3,-183.55 473.01,-184.49 484.62,-185.44"/>
<polygon fill="#666666" stroke="#666666" points="484.54,-188.94 494.79,-186.26 485.1,-181.96 484.54,-188.94"/>
</g>
</g>
</svg>
