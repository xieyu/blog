<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: poller_poll Pages: 1 -->
<svg width="2017pt" height="676pt"
 viewBox="0.00 0.00 2017.00 676.10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 672.1)">
<title>poller_poll</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-672.1 2013,-672.1 2013,4 -4,4"/>
<!-- handle_control -->
<g id="node1" class="node">
<title>handle_control</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1178.5,-383.94C1178.5,-383.94 1401.5,-383.94 1401.5,-383.94 1407.5,-383.94 1413.5,-389.94 1413.5,-395.94 1413.5,-395.94 1413.5,-470.94 1413.5,-470.94 1413.5,-476.94 1407.5,-482.94 1401.5,-482.94 1401.5,-482.94 1178.5,-482.94 1178.5,-482.94 1172.5,-482.94 1166.5,-476.94 1166.5,-470.94 1166.5,-470.94 1166.5,-395.94 1166.5,-395.94 1166.5,-389.94 1172.5,-383.94 1178.5,-383.94"/>
<text text-anchor="middle" x="1290" y="-467.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">Hanlder::handle_control</text>
<polyline fill="none" stroke="#8a8898" points="1166.5,-459.94 1413.5,-459.94 "/>
<text text-anchor="start" x="1174.5" y="-444.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">对batch.control的fsm调用</text>
<text text-anchor="start" x="1174.5" y="-429.74" font-family="Times,serif" font-size="14.00" fill="#5d6179"> handle_control方法</text>
<polyline fill="none" stroke="#8a8898" points="1166.5,-421.94 1413.5,-421.94 "/>
<text text-anchor="start" x="1174.5" y="-406.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">每次handle_control会从fsm中最多取出</text>
<text text-anchor="start" x="1174.5" y="-391.74" font-family="Times,serif" font-size="14.00" fill="#5d6179"> messages_per_tick个消息处理</text>
</g>
<!-- reschedule_fsms -->
<g id="node6" class="node">
<title>reschedule_fsms</title>
<path fill="#feed9b" stroke="#f7e495" d="M1462,-262.44C1462,-262.44 1650,-262.44 1650,-262.44 1656,-262.44 1662,-268.44 1662,-274.44 1662,-274.44 1662,-364.44 1662,-364.44 1662,-370.44 1656,-376.44 1650,-376.44 1650,-376.44 1462,-376.44 1462,-376.44 1456,-376.44 1450,-370.44 1450,-364.44 1450,-364.44 1450,-274.44 1450,-274.44 1450,-268.44 1456,-262.44 1462,-262.44"/>
<text text-anchor="middle" x="1556" y="-361.24" font-family="Times,serif" font-size="14.00" fill="#40575d">reschedule_fsms</text>
<polyline fill="none" stroke="#f7e495" points="1450,-353.44 1662,-353.44 "/>
<text text-anchor="middle" x="1556" y="-338.24" font-family="Times,serif" font-size="14.00" fill="#40575d">Vec&lt;(u64, ReschedulePolicy)&gt;</text>
<polyline fill="none" stroke="#f7e495" points="1450,-330.44 1662,-330.44 "/>
<text text-anchor="start" x="1458" y="-315.24" font-family="Times,serif" font-size="14.00" fill="#40575d">根据handle_normal/handle_control</text>
<text text-anchor="start" x="1458" y="-300.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 返回expected message count</text>
<text text-anchor="start" x="1458" y="-285.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 和channel中的message count</text>
<text text-anchor="start" x="1458" y="-270.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 确定schedule policy</text>
</g>
<!-- handle_control&#45;&gt;reschedule_fsms -->
<g id="edge11" class="edge">
<title>handle_control&#45;&gt;reschedule_fsms</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1405.64,-383.94C1417.17,-378.96 1428.88,-373.9 1440.41,-368.92"/>
<polygon fill="green" stroke="green" points="1441.82,-372.13 1449.61,-364.95 1439.04,-365.7 1441.82,-372.13"/>
</g>
<!-- handle_normal -->
<g id="node2" class="node">
<title>handle_normal</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1178,-265.94C1178,-265.94 1402,-265.94 1402,-265.94 1408,-265.94 1414,-271.94 1414,-277.94 1414,-277.94 1414,-352.94 1414,-352.94 1414,-358.94 1408,-364.94 1402,-364.94 1402,-364.94 1178,-364.94 1178,-364.94 1172,-364.94 1166,-358.94 1166,-352.94 1166,-352.94 1166,-277.94 1166,-277.94 1166,-271.94 1172,-265.94 1178,-265.94"/>
<text text-anchor="middle" x="1290" y="-349.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">Handler::handle_normal</text>
<polyline fill="none" stroke="#8a8898" points="1166,-341.94 1414,-341.94 "/>
<text text-anchor="start" x="1174" y="-326.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">对于batch.normals中每个fsm </text>
<text text-anchor="start" x="1174" y="-311.74" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 调用handle_normal</text>
<polyline fill="none" stroke="#8a8898" points="1166,-303.94 1414,-303.94 "/>
<text text-anchor="start" x="1174" y="-288.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">每次handle_normal会从fsm中最多取出</text>
<text text-anchor="start" x="1174" y="-273.74" font-family="Times,serif" font-size="14.00" fill="#5d6179"> messages_per_tick个消息处理</text>
</g>
<!-- handle_normal&#45;&gt;reschedule_fsms -->
<g id="edge10" class="edge">
<title>handle_normal&#45;&gt;reschedule_fsms</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1414.11,-317.31C1422.62,-317.43 1431.17,-317.56 1439.63,-317.69"/>
<polygon fill="green" stroke="green" points="1439.85,-321.2 1449.9,-317.85 1439.96,-314.2 1439.85,-321.2"/>
</g>
<!-- begin -->
<g id="node3" class="node">
<title>begin</title>
<path fill="none" stroke="#1c2123" d="M339.5,-205.44C339.5,-205.44 309.5,-205.44 309.5,-205.44 303.5,-205.44 297.5,-199.44 297.5,-193.44 297.5,-193.44 297.5,-181.44 297.5,-181.44 297.5,-175.44 303.5,-169.44 309.5,-169.44 309.5,-169.44 339.5,-169.44 339.5,-169.44 345.5,-169.44 351.5,-175.44 351.5,-181.44 351.5,-181.44 351.5,-193.44 351.5,-193.44 351.5,-199.44 345.5,-205.44 339.5,-205.44"/>
<text text-anchor="middle" x="324.5" y="-183.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">begin</text>
</g>
<!-- end -->
<g id="node4" class="node">
<title>end</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M250,-104.44C250,-104.44 399,-104.44 399,-104.44 405,-104.44 411,-110.44 411,-116.44 411,-116.44 411,-138.44 411,-138.44 411,-144.44 405,-150.44 399,-150.44 399,-150.44 250,-150.44 250,-150.44 244,-150.44 238,-144.44 238,-138.44 238,-138.44 238,-116.44 238,-116.44 238,-110.44 244,-104.44 250,-104.44"/>
<text text-anchor="middle" x="324.5" y="-135.24" font-family="Times,serif" font-size="14.00" fill="#5d6179">Handler::end</text>
<polyline fill="none" stroke="#8a8898" points="238,-127.44 411,-127.44 "/>
<text text-anchor="middle" x="324.5" y="-112.24" font-family="Times,serif" font-size="14.00" fill="#5d6179">做数据清理，落盘等操作</text>
</g>
<!-- handle_pause -->
<g id="node5" class="node">
<title>handle_pause</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M557,-469.94C557,-469.94 721,-469.94 721,-469.94 727,-469.94 733,-475.94 733,-481.94 733,-481.94 733,-518.94 733,-518.94 733,-524.94 727,-530.94 721,-530.94 721,-530.94 557,-530.94 557,-530.94 551,-530.94 545,-524.94 545,-518.94 545,-518.94 545,-481.94 545,-481.94 545,-475.94 551,-469.94 557,-469.94"/>
<text text-anchor="middle" x="639" y="-515.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">Handler::pause</text>
<polyline fill="none" stroke="#8a8898" points="545,-507.94 733,-507.94 "/>
<text text-anchor="start" x="553" y="-492.74" font-family="Times,serif" font-size="14.00" fill="#5d6179">在batch system sleep 之前</text>
<text text-anchor="start" x="553" y="-477.74" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 做一些清理buffeer之类操作</text>
</g>
<!-- batch_release -->
<g id="node14" class="node">
<title>batch_release</title>
<path fill="none" stroke="#1c2123" d="M1800.5,-256.44C1800.5,-256.44 1734.5,-256.44 1734.5,-256.44 1728.5,-256.44 1722.5,-250.44 1722.5,-244.44 1722.5,-244.44 1722.5,-232.44 1722.5,-232.44 1722.5,-226.44 1728.5,-220.44 1734.5,-220.44 1734.5,-220.44 1800.5,-220.44 1800.5,-220.44 1806.5,-220.44 1812.5,-226.44 1812.5,-232.44 1812.5,-232.44 1812.5,-244.44 1812.5,-244.44 1812.5,-250.44 1806.5,-256.44 1800.5,-256.44"/>
<text text-anchor="middle" x="1767.5" y="-234.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">batch_release</text>
</g>
<!-- reschedule_fsms&#45;&gt;batch_release -->
<g id="edge22" class="edge">
<title>reschedule_fsms&#45;&gt;batch_release</title>
<path fill="none" stroke="#666666" d="M1662.06,-278.82C1679.73,-271.99 1697.39,-265.16 1713.02,-259.12"/>
<polygon fill="#666666" stroke="#666666" points="1714.41,-262.33 1722.48,-255.46 1711.89,-255.8 1714.41,-262.33"/>
</g>
<!-- batch_remove -->
<g id="node15" class="node">
<title>batch_remove</title>
<path fill="none" stroke="#1c2123" d="M1802.5,-202.44C1802.5,-202.44 1732.5,-202.44 1732.5,-202.44 1726.5,-202.44 1720.5,-196.44 1720.5,-190.44 1720.5,-190.44 1720.5,-178.44 1720.5,-178.44 1720.5,-172.44 1726.5,-166.44 1732.5,-166.44 1732.5,-166.44 1802.5,-166.44 1802.5,-166.44 1808.5,-166.44 1814.5,-172.44 1814.5,-178.44 1814.5,-178.44 1814.5,-190.44 1814.5,-190.44 1814.5,-196.44 1808.5,-202.44 1802.5,-202.44"/>
<text text-anchor="middle" x="1767.5" y="-180.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">batch_remove</text>
</g>
<!-- reschedule_fsms&#45;&gt;batch_remove -->
<g id="edge23" class="edge">
<title>reschedule_fsms&#45;&gt;batch_remove</title>
<path fill="none" stroke="#666666" d="M1623.55,-262.41C1646.23,-244.64 1672.37,-225.93 1698,-211.44 1702.16,-209.09 1706.57,-206.85 1711.06,-204.73"/>
<polygon fill="#666666" stroke="#666666" points="1712.65,-207.86 1720.36,-200.58 1709.8,-201.46 1712.65,-207.86"/>
</g>
<!-- batch_reschedule -->
<g id="node16" class="node">
<title>batch_reschedule</title>
<path fill="none" stroke="#1c2123" d="M1810.5,-310.44C1810.5,-310.44 1724.5,-310.44 1724.5,-310.44 1718.5,-310.44 1712.5,-304.44 1712.5,-298.44 1712.5,-298.44 1712.5,-286.44 1712.5,-286.44 1712.5,-280.44 1718.5,-274.44 1724.5,-274.44 1724.5,-274.44 1810.5,-274.44 1810.5,-274.44 1816.5,-274.44 1822.5,-280.44 1822.5,-286.44 1822.5,-286.44 1822.5,-298.44 1822.5,-298.44 1822.5,-304.44 1816.5,-310.44 1810.5,-310.44"/>
<text text-anchor="middle" x="1767.5" y="-288.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">batch_reschedule</text>
</g>
<!-- reschedule_fsms&#45;&gt;batch_reschedule -->
<g id="edge24" class="edge">
<title>reschedule_fsms&#45;&gt;batch_reschedule</title>
<path fill="none" stroke="#666666" d="M1662.06,-305.9C1675.83,-304.13 1689.6,-302.35 1702.41,-300.7"/>
<polygon fill="#666666" stroke="#666666" points="1702.99,-304.16 1712.46,-299.41 1702.09,-297.21 1702.99,-304.16"/>
</g>
<!-- batch_remove_control -->
<g id="node17" class="node">
<title>batch_remove_control</title>
<path fill="none" stroke="#1c2123" d="M1825,-418.44C1825,-418.44 1710,-418.44 1710,-418.44 1704,-418.44 1698,-412.44 1698,-406.44 1698,-406.44 1698,-394.44 1698,-394.44 1698,-388.44 1704,-382.44 1710,-382.44 1710,-382.44 1825,-382.44 1825,-382.44 1831,-382.44 1837,-388.44 1837,-394.44 1837,-394.44 1837,-406.44 1837,-406.44 1837,-412.44 1831,-418.44 1825,-418.44"/>
<text text-anchor="middle" x="1767.5" y="-396.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">batch_remove_control</text>
</g>
<!-- reschedule_fsms&#45;&gt;batch_remove_control -->
<g id="edge25" class="edge">
<title>reschedule_fsms&#45;&gt;batch_remove_control</title>
<path fill="none" stroke="#666666" d="M1662.06,-360.06C1678.72,-366.5 1695.38,-372.94 1710.34,-378.73"/>
<polygon fill="#666666" stroke="#666666" points="1709.31,-382.08 1719.9,-382.43 1711.84,-375.55 1709.31,-382.08"/>
</g>
<!-- batch_release_control -->
<g id="node18" class="node">
<title>batch_release_control</title>
<path fill="none" stroke="#1c2123" d="M1823,-364.44C1823,-364.44 1712,-364.44 1712,-364.44 1706,-364.44 1700,-358.44 1700,-352.44 1700,-352.44 1700,-340.44 1700,-340.44 1700,-334.44 1706,-328.44 1712,-328.44 1712,-328.44 1823,-328.44 1823,-328.44 1829,-328.44 1835,-334.44 1835,-340.44 1835,-340.44 1835,-352.44 1835,-352.44 1835,-358.44 1829,-364.44 1823,-364.44"/>
<text text-anchor="middle" x="1767.5" y="-342.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">batch_release_control</text>
</g>
<!-- reschedule_fsms&#45;&gt;batch_release_control -->
<g id="edge26" class="edge">
<title>reschedule_fsms&#45;&gt;batch_release_control</title>
<path fill="none" stroke="#666666" d="M1662.06,-332.98C1671.4,-334.18 1680.75,-335.39 1689.79,-336.55"/>
<polygon fill="#666666" stroke="#666666" points="1689.49,-340.04 1699.85,-337.85 1690.38,-333.1 1689.49,-340.04"/>
</g>
<!-- fetch_fsm -->
<g id="node7" class="node">
<title>fetch_fsm</title>
<path fill="none" stroke="#1c2123" d="M152,-330.94C152,-330.94 497,-330.94 497,-330.94 503,-330.94 509,-336.94 509,-342.94 509,-342.94 509,-417.94 509,-417.94 509,-423.94 503,-429.94 497,-429.94 497,-429.94 152,-429.94 152,-429.94 146,-429.94 140,-423.94 140,-417.94 140,-417.94 140,-342.94 140,-342.94 140,-336.94 146,-330.94 152,-330.94"/>
<text text-anchor="middle" x="324.5" y="-414.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">fetch_fsm</text>
<polyline fill="none" stroke="#1c2123" points="140,-406.94 509,-406.94 "/>
<text text-anchor="start" x="148" y="-391.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">从fcm_reciever中接收fsm</text>
<polyline fill="none" stroke="#1c2123" points="140,-383.94 509,-383.94 "/>
<text text-anchor="start" x="148" y="-368.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">先try_recv，非阻塞的获取</text>
<text text-anchor="start" x="148" y="-353.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果channel中没数据，且batch空， 则先调用handler.pause</text>
<text text-anchor="start" x="148" y="-338.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 通知handler batch system将会被阻塞了</text>
</g>
<!-- fetch_fsm&#45;&gt;handle_pause -->
<g id="edge1" class="edge">
<title>fetch_fsm&#45;&gt;handle_pause</title>
<path fill="none" stroke="#666666" d="M454.41,-429.94C486.12,-442.12 519.37,-454.89 548.74,-466.16"/>
<polygon fill="#666666" stroke="#666666" points="547.54,-469.45 558.13,-469.77 550.05,-462.92 547.54,-469.45"/>
</g>
<!-- fcm_reciever_try_recv -->
<g id="node8" class="node">
<title>fcm_reciever_try_recv</title>
<path fill="none" stroke="#1c2123" d="M575,-300.44C575,-300.44 703,-300.44 703,-300.44 709,-300.44 715,-306.44 715,-312.44 715,-312.44 715,-334.44 715,-334.44 715,-340.44 709,-346.44 703,-346.44 703,-346.44 575,-346.44 575,-346.44 569,-346.44 563,-340.44 563,-334.44 563,-334.44 563,-312.44 563,-312.44 563,-306.44 569,-300.44 575,-300.44"/>
<text text-anchor="middle" x="639" y="-331.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">fcm_reciever.try_recv</text>
<polyline fill="none" stroke="#1c2123" points="563,-323.44 715,-323.44 "/>
<text text-anchor="middle" x="639" y="-308.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">尝试非阻塞的获取fsm</text>
</g>
<!-- fetch_fsm&#45;&gt;fcm_reciever_try_recv -->
<g id="edge2" class="edge">
<title>fetch_fsm&#45;&gt;fcm_reciever_try_recv</title>
<path fill="none" stroke="#666666" d="M509.09,-346.95C524.27,-344.18 539.1,-341.48 552.97,-338.95"/>
<polygon fill="#666666" stroke="#666666" points="553.68,-342.38 562.89,-337.14 552.43,-335.49 553.68,-342.38"/>
</g>
<!-- fcm_reciever_recv -->
<g id="node9" class="node">
<title>fcm_reciever_recv</title>
<path fill="none" stroke="#1c2123" d="M589.5,-404.44C589.5,-404.44 688.5,-404.44 688.5,-404.44 694.5,-404.44 700.5,-410.44 700.5,-416.44 700.5,-416.44 700.5,-438.44 700.5,-438.44 700.5,-444.44 694.5,-450.44 688.5,-450.44 688.5,-450.44 589.5,-450.44 589.5,-450.44 583.5,-450.44 577.5,-444.44 577.5,-438.44 577.5,-438.44 577.5,-416.44 577.5,-416.44 577.5,-410.44 583.5,-404.44 589.5,-404.44"/>
<text text-anchor="middle" x="639" y="-435.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">fcm_reciever_recv</text>
<polyline fill="none" stroke="#1c2123" points="577.5,-427.44 700.5,-427.44 "/>
<text text-anchor="start" x="585.5" y="-412.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">阻塞直到获取fsm</text>
</g>
<!-- fetch_fsm&#45;&gt;fcm_reciever_recv -->
<g id="edge3" class="edge">
<title>fetch_fsm&#45;&gt;fcm_reciever_recv</title>
<path fill="none" stroke="#666666" d="M509.09,-408.05C529.64,-411.14 549.53,-414.13 567.29,-416.81"/>
<polygon fill="#666666" stroke="#666666" points="567.09,-420.31 577.5,-418.34 568.13,-413.39 567.09,-420.31"/>
</g>
<!-- batch_push -->
<g id="node12" class="node">
<title>batch_push</title>
<path fill="none" stroke="#1c2123" d="M781,-343.44C781,-343.44 863,-343.44 863,-343.44 869,-343.44 875,-349.44 875,-355.44 875,-355.44 875,-399.44 875,-399.44 875,-405.44 869,-411.44 863,-411.44 863,-411.44 781,-411.44 781,-411.44 775,-411.44 769,-405.44 769,-399.44 769,-399.44 769,-355.44 769,-355.44 769,-349.44 775,-343.44 781,-343.44"/>
<text text-anchor="start" x="777" y="-396.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">Batch.push</text>
<text text-anchor="start" x="777" y="-381.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 根据FsmTypes</text>
<text text-anchor="start" x="777" y="-366.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push到normals</text>
<text text-anchor="start" x="777" y="-351.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置control</text>
</g>
<!-- fetch_fsm&#45;&gt;batch_push -->
<g id="edge4" class="edge">
<title>fetch_fsm&#45;&gt;batch_push</title>
<path fill="none" stroke="#666666" d="M509.3,-379.33C597.09,-378.8 696.38,-378.2 758.83,-377.82"/>
<polygon fill="#666666" stroke="#666666" points="758.93,-381.32 768.91,-377.76 758.89,-374.32 758.93,-381.32"/>
</g>
<!-- fcm_reciever_try_recv&#45;&gt;batch_push -->
<g id="edge5" class="edge">
<title>fcm_reciever_try_recv&#45;&gt;batch_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M715.19,-345.87C729.87,-350.25 745.1,-354.8 759.28,-359.03"/>
<polygon fill="green" stroke="green" points="758.32,-362.39 768.91,-361.9 760.33,-355.69 758.32,-362.39"/>
</g>
<!-- fcm_reciever_recv&#45;&gt;batch_push -->
<g id="edge6" class="edge">
<title>fcm_reciever_recv&#45;&gt;batch_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M700.52,-410.72C719.34,-405.52 740.1,-399.79 759.02,-394.56"/>
<polygon fill="green" stroke="green" points="760.01,-397.92 768.72,-391.88 758.15,-391.17 760.01,-397.92"/>
</g>
<!-- batch -->
<g id="node10" class="node">
<title>batch</title>
<path fill="#feed9b" stroke="#f7e495" d="M923,-300.44C923,-300.44 1118,-300.44 1118,-300.44 1124,-300.44 1130,-306.44 1130,-312.44 1130,-312.44 1130,-448.44 1130,-448.44 1130,-454.44 1124,-460.44 1118,-460.44 1118,-460.44 923,-460.44 923,-460.44 917,-460.44 911,-454.44 911,-448.44 911,-448.44 911,-312.44 911,-312.44 911,-306.44 917,-300.44 923,-300.44"/>
<text text-anchor="middle" x="1020.5" y="-445.24" font-family="Times,serif" font-size="14.00" fill="#40575d">batch</text>
<polyline fill="none" stroke="#f7e495" points="911,-437.44 1130,-437.44 "/>
<text text-anchor="start" x="919" y="-422.24" font-family="Times,serif" font-size="14.00" fill="#40575d">normals: Vec&lt;Box&lt;N&gt;&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="911,-414.44 1130,-414.44 "/>
<text text-anchor="start" x="919" y="-399.24" font-family="Times,serif" font-size="14.00" fill="#40575d">timers: Vec&lt;Instant&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="911,-391.44 1130,-391.44 "/>
<text text-anchor="start" x="919" y="-376.24" font-family="Times,serif" font-size="14.00" fill="#40575d">control: Option&lt;Box&lt;C&gt;&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="911,-368.44 1130,-368.44 "/>
<text text-anchor="start" x="919" y="-353.24" font-family="Times,serif" font-size="14.00" fill="#40575d">timers用来统计 fsm在batch中时间</text>
<text text-anchor="start" x="919" y="-338.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 超过reschdule_duration的</text>
<text text-anchor="start" x="919" y="-323.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 需要重新调度</text>
<text text-anchor="start" x="919" y="-308.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 避免batch一直被hot region占用</text>
</g>
<!-- batch&#45;&gt;handle_control -->
<g id="edge8" class="edge">
<title>batch:control&#45;&gt;handle_control</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1130.1,-402.07C1138.74,-403.78 1147.52,-405.51 1156.29,-407.24"/>
<polygon fill="green" stroke="green" points="1155.69,-410.69 1166.18,-409.2 1157.05,-403.83 1155.69,-410.69"/>
</g>
<!-- batch&#45;&gt;handle_normal -->
<g id="edge9" class="edge">
<title>batch:normal&#45;&gt;handle_normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1130.1,-353.91C1138.63,-351.84 1147.3,-349.74 1155.97,-347.65"/>
<polygon fill="green" stroke="green" points="1156.84,-351.04 1165.74,-345.28 1155.2,-344.23 1156.84,-351.04"/>
</g>
<!-- batch2 -->
<g id="node11" class="node">
<title>batch2</title>
<path fill="#feed9b" stroke="#f7e495" d="M1885,-254.44C1885,-254.44 1997,-254.44 1997,-254.44 2003,-254.44 2009,-260.44 2009,-266.44 2009,-266.44 2009,-318.44 2009,-318.44 2009,-324.44 2003,-330.44 1997,-330.44 1997,-330.44 1885,-330.44 1885,-330.44 1879,-330.44 1873,-324.44 1873,-318.44 1873,-318.44 1873,-266.44 1873,-266.44 1873,-260.44 1879,-254.44 1885,-254.44"/>
<text text-anchor="middle" x="1941" y="-315.24" font-family="Times,serif" font-size="14.00" fill="#40575d">batch2</text>
<polyline fill="none" stroke="#f7e495" points="1873,-307.44 2009,-307.44 "/>
<text text-anchor="start" x="1881" y="-292.24" font-family="Times,serif" font-size="14.00" fill="#40575d">遍历reschedule_fsms</text>
<text text-anchor="start" x="1881" y="-277.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 清理之前的batchs</text>
<text text-anchor="start" x="1881" y="-262.24" font-family="Times,serif" font-size="14.00" fill="#40575d"> 进入下一轮迭代</text>
</g>
<!-- batch_push&#45;&gt;batch -->
<g id="edge7" class="edge">
<title>batch_push&#45;&gt;batch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M875.14,-378.24C883.24,-378.36 891.87,-378.49 900.74,-378.63"/>
<polygon fill="green" stroke="green" points="900.79,-382.13 910.84,-378.78 900.89,-375.13 900.79,-382.13"/>
</g>
<!-- poll -->
<g id="node13" class="node">
<title>poll</title>
<path fill="none" stroke="#1c2123" d="M67,-251.44C67,-251.44 37,-251.44 37,-251.44 31,-251.44 25,-245.44 25,-239.44 25,-239.44 25,-227.44 25,-227.44 25,-221.44 31,-215.44 37,-215.44 37,-215.44 67,-215.44 67,-215.44 73,-215.44 79,-221.44 79,-227.44 79,-227.44 79,-239.44 79,-239.44 79,-245.44 73,-251.44 67,-251.44"/>
<text text-anchor="middle" x="52" y="-229.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll</text>
</g>
<!-- poll&#45;&gt;handle_control -->
<g id="edge12" class="edge">
<title>poll&#45;&gt;handle_control</title>
<path fill="none" stroke="#666666" d="M79.26,-241.98C88.37,-246.19 97.83,-252.17 104,-260.44 152.54,-325.47 83.95,-380.76 140,-439.44 297.25,-604.08 410.33,-559.44 638,-559.44 638,-559.44 638,-559.44 823,-559.44 941.5,-559.44 1071.26,-521 1163.69,-486.59"/>
<polygon fill="#666666" stroke="#666666" points="1164.95,-489.85 1173.08,-483.06 1162.48,-483.3 1164.95,-489.85"/>
</g>
<!-- poll&#45;&gt;handle_normal -->
<g id="edge13" class="edge">
<title>poll&#45;&gt;handle_normal</title>
<path fill="none" stroke="#666666" d="M79.17,-238.43C96.39,-241.52 119.46,-245.3 140,-247.44 360.4,-270.41 416.41,-271.44 638,-271.44 638,-271.44 638,-271.44 823,-271.44 959.71,-271.44 994.1,-275.59 1130,-290.44 1138.48,-291.37 1147.19,-292.43 1155.97,-293.58"/>
<polygon fill="#666666" stroke="#666666" points="1155.52,-297.05 1165.89,-294.91 1156.45,-290.11 1155.52,-297.05"/>
</g>
<!-- poll&#45;&gt;begin -->
<g id="edge14" class="edge">
<title>poll&#45;&gt;begin</title>
<path fill="none" stroke="#666666" d="M79.43,-228.95C128.14,-220.66 232.12,-202.98 287.32,-193.59"/>
<polygon fill="#666666" stroke="#666666" points="288.09,-197.01 297.36,-191.89 286.92,-190.11 288.09,-197.01"/>
</g>
<!-- poll&#45;&gt;end -->
<g id="edge15" class="edge">
<title>poll&#45;&gt;end</title>
<path fill="none" stroke="#666666" d="M69.08,-215.35C85.26,-198.36 111.79,-173.65 140,-160.44 167.01,-147.79 198.34,-139.97 227.4,-135.15"/>
<polygon fill="#666666" stroke="#666666" points="228.22,-138.56 237.57,-133.56 227.15,-131.64 228.22,-138.56"/>
</g>
<!-- poll&#45;&gt;fetch_fsm -->
<g id="edge16" class="edge">
<title>poll&#45;&gt;fetch_fsm</title>
<path fill="none" stroke="#666666" d="M79.02,-246.45C87.14,-250.71 96.04,-255.6 104,-260.44 120.64,-270.57 123.32,-275.39 140,-285.44 163.12,-299.38 188.51,-313.33 212.83,-326.08"/>
<polygon fill="#666666" stroke="#666666" points="211.25,-329.21 221.74,-330.72 214.49,-323 211.25,-329.21"/>
</g>
<!-- poll&#45;&gt;batch_release -->
<g id="edge17" class="edge">
<title>poll&#45;&gt;batch_release</title>
<path fill="none" stroke="#666666" d="M58.19,-215.4C68.21,-184.32 93.44,-121.4 140,-94.44 235.84,-38.95 527.25,-75.44 638,-75.44 638,-75.44 638,-75.44 1291,-75.44 1334.41,-75.44 1597.53,-173.89 1712.65,-217.76"/>
<polygon fill="#666666" stroke="#666666" points="1711.74,-221.16 1722.33,-221.46 1714.23,-214.62 1711.74,-221.16"/>
</g>
<!-- poll&#45;&gt;batch_remove -->
<g id="edge18" class="edge">
<title>poll&#45;&gt;batch_remove</title>
<path fill="none" stroke="#666666" d="M55.99,-215.3C63.09,-178.66 84.72,-96.3 140,-60.44 325.88,60.15 416.43,-37.44 638,-37.44 638,-37.44 638,-37.44 1291,-37.44 1355.96,-37.44 1619.19,-102.77 1662,-120.44 1687.35,-130.91 1713.67,-147.06 1733.56,-160.52"/>
<polygon fill="#666666" stroke="#666666" points="1731.71,-163.51 1741.94,-166.3 1735.69,-157.74 1731.71,-163.51"/>
</g>
<!-- poll&#45;&gt;batch_reschedule -->
<g id="edge19" class="edge">
<title>poll&#45;&gt;batch_reschedule</title>
<path fill="none" stroke="#666666" d="M79.24,-233.44C161.57,-233.44 422.18,-233.44 638,-233.44 638,-233.44 638,-233.44 1291,-233.44 1456.1,-233.44 1500.47,-218.29 1662,-252.44 1664.82,-253.04 1687.51,-261.69 1711.02,-270.79"/>
<polygon fill="#666666" stroke="#666666" points="1709.8,-274.07 1720.39,-274.42 1712.33,-267.54 1709.8,-274.07"/>
</g>
<!-- poll&#45;&gt;batch_remove_control -->
<g id="edge20" class="edge">
<title>poll&#45;&gt;batch_remove_control</title>
<path fill="none" stroke="#666666" d="M79.12,-241.47C88.43,-245.64 98.08,-251.75 104,-260.44 144.17,-319.39 89.55,-529.01 140,-579.44 297.52,-736.9 415.27,-635.44 638,-635.44 638,-635.44 638,-635.44 1291,-635.44 1468.52,-635.44 1513.41,-584.57 1662,-487.44 1690.26,-468.97 1719.56,-443.98 1739.92,-425.53"/>
<polygon fill="#666666" stroke="#666666" points="1742.52,-427.89 1747.53,-418.55 1737.79,-422.73 1742.52,-427.89"/>
</g>
<!-- poll&#45;&gt;batch_release_control -->
<g id="edge21" class="edge">
<title>poll&#45;&gt;batch_release_control</title>
<path fill="none" stroke="#666666" d="M79.26,-241.67C88.47,-245.86 98.01,-251.91 104,-260.44 169.76,-354.12 60,-433.58 140,-515.44 296.78,-675.86 413.69,-597.44 638,-597.44 638,-597.44 638,-597.44 1291,-597.44 1497.48,-597.44 1511.13,-461.25 1698,-373.44 1701.54,-371.78 1705.22,-370.12 1708.94,-368.5"/>
<polygon fill="#666666" stroke="#666666" points="1710.42,-371.68 1718.26,-364.56 1707.69,-365.23 1710.42,-371.68"/>
</g>
<!-- batch_release&#45;&gt;batch2 -->
<g id="edge27" class="edge">
<title>batch_release&#45;&gt;batch2</title>
<path fill="none" stroke="#666666" d="M1812.67,-252.35C1828.16,-257.22 1846.04,-262.86 1863.41,-268.33"/>
<polygon fill="#666666" stroke="#666666" points="1862.4,-271.68 1872.99,-271.34 1864.51,-265 1862.4,-271.68"/>
</g>
<!-- batch_remove&#45;&gt;batch2 -->
<g id="edge28" class="edge">
<title>batch_remove&#45;&gt;batch2</title>
<path fill="none" stroke="#666666" d="M1814.69,-200.51C1822.32,-203.76 1830.02,-207.43 1837,-211.44 1854.98,-221.76 1873.21,-234.99 1889.23,-247.76"/>
<polygon fill="#666666" stroke="#666666" points="1887.42,-250.8 1897.4,-254.37 1891.83,-245.36 1887.42,-250.8"/>
</g>
<!-- batch_reschedule&#45;&gt;batch2 -->
<g id="edge29" class="edge">
<title>batch_reschedule&#45;&gt;batch2</title>
<path fill="none" stroke="#666666" d="M1822.76,-292.44C1835.43,-292.44 1849.17,-292.44 1862.62,-292.44"/>
<polygon fill="#666666" stroke="#666666" points="1862.83,-295.94 1872.83,-292.44 1862.83,-288.94 1862.83,-295.94"/>
</g>
<!-- batch_remove_control&#45;&gt;batch2 -->
<g id="edge30" class="edge">
<title>batch_remove_control&#45;&gt;batch2</title>
<path fill="none" stroke="#666666" d="M1819.41,-382.31C1825.47,-379.59 1831.46,-376.62 1837,-373.44 1854.98,-363.12 1873.21,-349.89 1889.23,-337.12"/>
<polygon fill="#666666" stroke="#666666" points="1891.83,-339.52 1897.4,-330.51 1887.42,-334.08 1891.83,-339.52"/>
</g>
<!-- batch_release_control&#45;&gt;batch2 -->
<g id="edge31" class="edge">
<title>batch_release_control&#45;&gt;batch2</title>
<path fill="none" stroke="#666666" d="M1826.08,-328.31C1837.91,-324.59 1850.54,-320.61 1862.92,-316.71"/>
<polygon fill="#666666" stroke="#666666" points="1864.29,-319.95 1872.78,-313.61 1862.19,-313.27 1864.29,-319.95"/>
</g>
<!-- NormalChannel -->
<g id="node19" class="node">
<title>NormalChannel</title>
<path fill="none" stroke="#1c2123" d="M12,-270.44C12,-270.44 92,-270.44 92,-270.44 98,-270.44 104,-276.44 104,-282.44 104,-282.44 104,-488.44 104,-488.44 104,-494.44 98,-500.44 92,-500.44 92,-500.44 12,-500.44 12,-500.44 6,-500.44 0,-494.44 0,-488.44 0,-488.44 0,-282.44 0,-282.44 0,-276.44 6,-270.44 12,-270.44"/>
<text text-anchor="middle" x="52" y="-485.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">NormalChannel</text>
<polyline fill="none" stroke="#1c2123" points="0,-477.44 104,-477.44 "/>
<text text-anchor="middle" x="52" y="-462.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
<polyline fill="none" stroke="#1c2123" points="0,-454.44 104,-454.44 "/>
<text text-anchor="middle" x="16.5" y="-427.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="33,-408.44 33,-454.44 "/>
<text text-anchor="middle" x="68.5" y="-439.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">region1</text>
<polyline fill="none" stroke="#1c2123" points="33,-431.44 104,-431.44 "/>
<text text-anchor="middle" x="68.5" y="-416.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="0,-408.44 104,-408.44 "/>
<text text-anchor="middle" x="16.5" y="-381.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="33,-362.44 33,-408.44 "/>
<text text-anchor="middle" x="68.5" y="-393.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">region2</text>
<polyline fill="none" stroke="#1c2123" points="33,-385.44 104,-385.44 "/>
<text text-anchor="middle" x="68.5" y="-370.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="0,-362.44 104,-362.44 "/>
<text text-anchor="middle" x="16.5" y="-335.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
<polyline fill="none" stroke="#1c2123" points="33,-316.44 33,-362.44 "/>
<text text-anchor="middle" x="68.5" y="-347.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">region3</text>
<polyline fill="none" stroke="#1c2123" points="33,-339.44 104,-339.44 "/>
<text text-anchor="middle" x="68.5" y="-324.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsm</text>
<polyline fill="none" stroke="#1c2123" points="0,-316.44 104,-316.44 "/>
<text text-anchor="middle" x="52" y="-301.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
<polyline fill="none" stroke="#1c2123" points="0,-293.44 104,-293.44 "/>
<text text-anchor="middle" x="52" y="-278.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">...</text>
</g>
<!-- NormalChannel&#45;&gt;fetch_fsm -->
<g id="edge32" class="edge">
<title>NormalChannel&#45;&gt;fetch_fsm</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M104.2,-384.49C112.18,-384.35 120.82,-384.19 129.88,-384.02"/>
<polygon fill="green" stroke="green" points="129.95,-387.52 139.88,-383.83 129.82,-380.52 129.95,-387.52"/>
</g>
</g>
</svg>
