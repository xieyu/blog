<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: prewrite_rollback Pages: 1 -->
<svg width="1182pt" height="121pt"
 viewBox="0.00 0.00 1182.00 121.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 117)">
<title>prewrite_rollback</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-117 1178,-117 1178,4 -4,4"/>
<!-- cmd_prewrite -->
<g id="node1" class="node">
<title>cmd_prewrite</title>
<path fill="none" stroke="#1c2123" d="M12,-28C12,-28 107,-28 107,-28 113,-28 119,-34 119,-40 119,-40 119,-52 119,-52 119,-58 113,-64 107,-64 107,-64 12,-64 12,-64 6,-64 0,-58 0,-52 0,-52 0,-40 0,-40 0,-34 6,-28 12,-28"/>
<text text-anchor="middle" x="59.5" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Prewriter::prewrite</text>
</g>
<!-- actions_prewrite -->
<g id="node2" class="node">
<title>actions_prewrite</title>
<path fill="none" stroke="#1c2123" d="M167,-28C167,-28 247,-28 247,-28 253,-28 259,-34 259,-40 259,-40 259,-52 259,-52 259,-58 253,-64 247,-64 247,-64 167,-64 167,-64 161,-64 155,-58 155,-52 155,-52 155,-40 155,-40 155,-34 161,-28 167,-28"/>
<text text-anchor="start" x="163" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actions/prewrite</text>
</g>
<!-- cmd_prewrite&#45;&gt;actions_prewrite -->
<g id="edge1" class="edge">
<title>cmd_prewrite&#45;&gt;actions_prewrite</title>
<path fill="none" stroke="#666666" d="M119.26,-46C127.67,-46 136.34,-46 144.8,-46"/>
<polygon fill="#666666" stroke="#666666" points="144.98,-49.5 154.98,-46 144.98,-42.5 144.98,-49.5"/>
</g>
<!-- check_for_newer_version -->
<g id="node6" class="node">
<title>check_for_newer_version</title>
<path fill="none" stroke="#1c2123" d="M307,-8C307,-8 502,-8 502,-8 508,-8 514,-14 514,-20 514,-20 514,-72 514,-72 514,-78 508,-84 502,-84 502,-84 307,-84 307,-84 301,-84 295,-78 295,-72 295,-72 295,-20 295,-20 295,-14 301,-8 307,-8"/>
<text text-anchor="middle" x="404.5" y="-68.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_for_newer_version</text>
<polyline fill="none" stroke="#1c2123" points="295,-61 514,-61 "/>
<text text-anchor="start" x="303" y="-45.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查key对应的write record</text>
<text text-anchor="start" x="303" y="-30.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 是否已经被更新的事务所write了</text>
<text text-anchor="start" x="303" y="-15.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者已经被rollback了</text>
</g>
<!-- actions_prewrite&#45;&gt;check_for_newer_version -->
<g id="edge4" class="edge">
<title>actions_prewrite&#45;&gt;check_for_newer_version</title>
<path fill="none" stroke="#666666" d="M259.11,-46C267.17,-46 275.77,-46 284.62,-46"/>
<polygon fill="#666666" stroke="#666666" points="284.7,-49.5 294.7,-46 284.7,-42.5 284.7,-49.5"/>
</g>
<!-- reader_seek_write -->
<g id="node3" class="node">
<title>reader_seek_write</title>
<path fill="none" stroke="#1c2123" d="M562,-43.5C562,-43.5 777,-43.5 777,-43.5 783,-43.5 789,-49.5 789,-55.5 789,-55.5 789,-100.5 789,-100.5 789,-106.5 783,-112.5 777,-112.5 777,-112.5 562,-112.5 562,-112.5 556,-112.5 550,-106.5 550,-100.5 550,-100.5 550,-55.5 550,-55.5 550,-49.5 556,-43.5 562,-43.5"/>
<text text-anchor="middle" x="669.5" y="-97.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccReader::seek_write</text>
<polyline fill="none" stroke="#1c2123" points="550,-89.5 789,-89.5 "/>
<text text-anchor="start" x="558" y="-74.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">seek_write(self.key, TimeStamp::max())</text>
<polyline fill="none" stroke="#1c2123" points="550,-66.5 789,-66.5 "/>
<text text-anchor="start" x="558" y="-51.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">读要prewrite key的 write record</text>
</g>
<!-- WriteType_Rollback -->
<g id="node4" class="node">
<title>WriteType_Rollback</title>
<path fill="none" stroke="#1c2123" d="M837,-0.5C837,-0.5 1001,-0.5 1001,-0.5 1007,-0.5 1013,-6.5 1013,-12.5 1013,-12.5 1013,-79.5 1013,-79.5 1013,-85.5 1007,-91.5 1001,-91.5 1001,-91.5 837,-91.5 837,-91.5 831,-91.5 825,-85.5 825,-79.5 825,-79.5 825,-12.5 825,-12.5 825,-6.5 831,-0.5 837,-0.5"/>
<text text-anchor="middle" x="919" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType_Rollback</text>
<polyline fill="none" stroke="#1c2123" points="825,-68.5 1013,-68.5 "/>
<text text-anchor="start" x="833" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果write_record的commit_ts</text>
<text text-anchor="start" x="833" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和当前事务start_ts一样，且</text>
<text text-anchor="start" x="833" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型为Rollback</text>
<text text-anchor="start" x="833" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 报write_conflict_error</text>
</g>
<!-- reader_seek_write&#45;&gt;WriteType_Rollback -->
<g id="edge2" class="edge">
<title>reader_seek_write&#45;&gt;WriteType_Rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M789.18,-62.66C797.64,-61.56 806.14,-60.46 814.51,-59.38"/>
<polygon fill="green" stroke="green" points="815.18,-62.82 824.65,-58.07 814.29,-55.88 815.18,-62.82"/>
</g>
<!-- write_conflict_error -->
<g id="node5" class="node">
<title>write_conflict_error</title>
<path fill="none" stroke="#1c2123" d="M1162,-64C1162,-64 1061,-64 1061,-64 1055,-64 1049,-58 1049,-52 1049,-52 1049,-40 1049,-40 1049,-34 1055,-28 1061,-28 1061,-28 1162,-28 1162,-28 1168,-28 1174,-34 1174,-40 1174,-40 1174,-52 1174,-52 1174,-58 1168,-64 1162,-64"/>
<text text-anchor="middle" x="1111.5" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_conflict_error</text>
</g>
<!-- WriteType_Rollback&#45;&gt;write_conflict_error -->
<g id="edge3" class="edge">
<title>WriteType_Rollback&#45;&gt;write_conflict_error</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1013.02,-46C1021.68,-46 1030.37,-46 1038.79,-46"/>
<polygon fill="green" stroke="green" points="1038.92,-49.5 1048.92,-46 1038.92,-42.5 1038.92,-49.5"/>
</g>
<!-- check_for_newer_version&#45;&gt;reader_seek_write -->
<g id="edge5" class="edge">
<title>check_for_newer_version&#45;&gt;reader_seek_write</title>
<path fill="none" stroke="#666666" d="M514.37,-59.25C522.8,-60.27 531.36,-61.31 539.9,-62.35"/>
<polygon fill="#666666" stroke="#666666" points="539.56,-65.84 549.91,-63.57 540.41,-58.89 539.56,-65.84"/>
</g>
<!-- check_for_newer_version&#45;&gt;WriteType_Rollback -->
<g id="edge6" class="edge">
<title>check_for_newer_version&#45;&gt;WriteType_Rollback</title>
<path fill="none" stroke="#666666" d="M514.32,-35.99C526.35,-35.17 538.43,-34.48 550,-34 656.13,-29.6 682.89,-29.08 789,-34 797.32,-34.39 805.93,-34.91 814.57,-35.53"/>
<polygon fill="#666666" stroke="#666666" points="814.48,-39.03 824.71,-36.29 815,-32.05 814.48,-39.03"/>
</g>
</g>
</svg>
