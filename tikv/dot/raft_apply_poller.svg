<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_apply_poller Pages: 1 -->
<svg width="794pt" height="582pt"
 viewBox="0.00 0.00 794.00 582.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 578)">
<title>raft_apply_poller</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-578 790,-578 790,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RaftPoller</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-378C20,-378 474.5,-378 474.5,-378 480.5,-378 486.5,-384 486.5,-390 486.5,-390 486.5,-554 486.5,-554 486.5,-560 480.5,-566 474.5,-566 474.5,-566 20,-566 20,-566 14,-566 8,-560 8,-554 8,-554 8,-390 8,-390 8,-384 14,-378 20,-378"/>
<text text-anchor="middle" x="247.25" y="-546" font-family="Times,serif" font-size="20.00">RaftPoller</text>
<text text-anchor="middle" x="247.25" y="-524" font-family="Times,serif" font-size="20.00">线程池</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_ApplyPoller</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-8C20,-8 465.5,-8 465.5,-8 471.5,-8 477.5,-14 477.5,-20 477.5,-20 477.5,-164 477.5,-164 477.5,-170 471.5,-176 465.5,-176 465.5,-176 20,-176 20,-176 14,-176 8,-170 8,-164 8,-164 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="242.75" y="-156" font-family="Times,serif" font-size="20.00">ApplyPoller</text>
<text text-anchor="middle" x="242.75" y="-134" font-family="Times,serif" font-size="20.00">线程池</text>
</g>
<!-- RaftPoller_poll -->
<g id="node1" class="node">
<title>RaftPoller_poll</title>
<path fill="none" stroke="#1c2123" d="M28,-436C28,-436 84,-436 84,-436 90,-436 96,-442 96,-448 96,-448 96,-470 96,-470 96,-476 90,-482 84,-482 84,-482 28,-482 28,-482 22,-482 16,-476 16,-470 16,-470 16,-448 16,-448 16,-442 22,-436 28,-436"/>
<text text-anchor="middle" x="56" y="-466.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll</text>
<polyline fill="none" stroke="#1c2123" points="16,-459 96,-459 "/>
<text text-anchor="middle" x="56" y="-443.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll主循环</text>
</g>
<!-- RaftPoller_handle_normal -->
<g id="node2" class="node">
<title>RaftPoller_handle_normal</title>
<path fill="none" stroke="#1c2123" d="M151,-386.5C151,-386.5 260,-386.5 260,-386.5 266,-386.5 272,-392.5 272,-398.5 272,-398.5 272,-473.5 272,-473.5 272,-479.5 266,-485.5 260,-485.5 260,-485.5 151,-485.5 151,-485.5 145,-485.5 139,-479.5 139,-473.5 139,-473.5 139,-398.5 139,-398.5 139,-392.5 145,-386.5 151,-386.5"/>
<text text-anchor="start" x="147" y="-470.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_normal</text>
<polyline fill="none" stroke="#1c2123" points="139,-462.5 272,-462.5 "/>
<text text-anchor="start" x="147" y="-447.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理消息，将修改</text>
<text text-anchor="start" x="147" y="-432.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 写入writeBatch</text>
<polyline fill="none" stroke="#1c2123" points="139,-424.5 272,-424.5 "/>
<text text-anchor="start" x="147" y="-409.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">通过ApplyRouter</text>
<text text-anchor="start" x="147" y="-394.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 让Apply router落盘</text>
</g>
<!-- RaftPoller_poll&#45;&gt;RaftPoller_handle_normal -->
<g id="edge1" class="edge">
<title>RaftPoller_poll&#45;&gt;RaftPoller_handle_normal</title>
<path fill="none" stroke="#666666" d="M96.14,-452.9C106.31,-451.31 117.61,-449.55 128.96,-447.78"/>
<polygon fill="#666666" stroke="#666666" points="129.59,-451.22 138.93,-446.22 128.51,-444.31 129.59,-451.22"/>
</g>
<!-- RaftPoller_end -->
<g id="node3" class="node">
<title>RaftPoller_end</title>
<path fill="none" stroke="#1c2123" d="M341.5,-426.5C341.5,-426.5 466.5,-426.5 466.5,-426.5 472.5,-426.5 478.5,-432.5 478.5,-438.5 478.5,-438.5 478.5,-475.5 478.5,-475.5 478.5,-481.5 472.5,-487.5 466.5,-487.5 466.5,-487.5 341.5,-487.5 341.5,-487.5 335.5,-487.5 329.5,-481.5 329.5,-475.5 329.5,-475.5 329.5,-438.5 329.5,-438.5 329.5,-432.5 335.5,-426.5 341.5,-426.5"/>
<text text-anchor="middle" x="404" y="-472.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">end</text>
<polyline fill="none" stroke="#1c2123" points="329.5,-464.5 478.5,-464.5 "/>
<text text-anchor="start" x="337.5" y="-449.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将write batch数据写入</text>
<text text-anchor="start" x="337.5" y="-434.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> kv engine和raft engine</text>
</g>
<!-- RaftPoller_poll&#45;&gt;RaftPoller_end -->
<g id="edge2" class="edge">
<title>RaftPoller_poll&#45;&gt;RaftPoller_end</title>
<path fill="none" stroke="#666666" d="M96.27,-481.9C107.45,-487.28 119.89,-492.24 132,-495 195.7,-509.5 214.39,-504.68 279,-495 292.35,-493 306.25,-489.85 319.7,-486.21"/>
<polygon fill="#666666" stroke="#666666" points="320.73,-489.55 329.41,-483.47 318.83,-482.81 320.73,-489.55"/>
</g>
<!-- RaftPoller_handle_normal&#45;&gt;RaftPoller_end -->
<g id="edge3" class="edge">
<title>RaftPoller_handle_normal&#45;&gt;RaftPoller_end</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M272.2,-443.02C287.21,-444.63 303.37,-446.35 319.02,-448.03"/>
<polygon fill="green" stroke="green" points="318.91,-451.53 329.23,-449.12 319.65,-444.57 318.91,-451.53"/>
</g>
<!-- TaskApply -->
<g id="node9" class="node">
<title>TaskApply</title>
<path fill="#feed9b" stroke="#f7e495" d="M327,-185C327,-185 481,-185 481,-185 487,-185 493,-191 493,-197 493,-197 493,-357 493,-357 493,-363 487,-369 481,-369 481,-369 327,-369 327,-369 321,-369 315,-363 315,-357 315,-357 315,-197 315,-197 315,-191 321,-185 327,-185"/>
<text text-anchor="middle" x="404" y="-353.8" font-family="Times,serif" font-size="14.00" fill="#40575d">TaskApply</text>
<polyline fill="none" stroke="#f7e495" points="315,-346 493,-346 "/>
<text text-anchor="start" x="323" y="-330.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub peer_id: u64,</text>
<polyline fill="none" stroke="#f7e495" points="315,-323 493,-323 "/>
<text text-anchor="start" x="323" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region_id: u64,</text>
<polyline fill="none" stroke="#f7e495" points="315,-300 493,-300 "/>
<text text-anchor="start" x="323" y="-284.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub term: u64,</text>
<polyline fill="none" stroke="#f7e495" points="315,-277 493,-277 "/>
<text text-anchor="start" x="323" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub entries: Vec&lt;Entry&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="315,-254 493,-254 "/>
<text text-anchor="start" x="323" y="-238.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub cbs: Vec&lt;Proposal&lt;S&gt;&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="315,-231 493,-231 "/>
<text text-anchor="start" x="323" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#40575d">entries_mem_size: i64,</text>
<polyline fill="none" stroke="#f7e495" points="315,-208 493,-208 "/>
<text text-anchor="start" x="323" y="-192.8" font-family="Times,serif" font-size="14.00" fill="#40575d">entries_count: i64,</text>
</g>
<!-- RaftPoller_handle_normal&#45;&gt;TaskApply -->
<g id="edge10" class="edge">
<title>RaftPoller_handle_normal&#45;&gt;TaskApply</title>
<path fill="none" stroke="#666666" d="M267.87,-386.35C280.29,-376.29 293.64,-365.49 306.93,-354.74"/>
<polygon fill="#666666" stroke="#666666" points="309.17,-357.42 314.74,-348.41 304.77,-351.98 309.17,-357.42"/>
</g>
<!-- RaftLogEngine -->
<g id="node4" class="node">
<title>RaftLogEngine</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M579.5,-419C579.5,-419 735.5,-419 735.5,-419 741.5,-419 747.5,-425 747.5,-431 747.5,-431 747.5,-483 747.5,-483 747.5,-489 741.5,-495 735.5,-495 735.5,-495 579.5,-495 579.5,-495 573.5,-495 567.5,-489 567.5,-483 567.5,-483 567.5,-431 567.5,-431 567.5,-425 573.5,-419 579.5,-419"/>
<text text-anchor="middle" x="657.5" y="-479.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftLogEngine</text>
<polyline fill="none" stroke="#8a8898" points="567.5,-472 747.5,-472 "/>
<text text-anchor="start" x="575.5" y="-456.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">存储raft log, raft state等</text>
<text text-anchor="start" x="575.5" y="-441.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 实现为RocksDbEngine或者</text>
<text text-anchor="start" x="575.5" y="-426.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> RaftLogEngine</text>
</g>
<!-- RaftPoller_end&#45;&gt;RaftLogEngine -->
<g id="edge4" class="edge">
<title>RaftPoller_end&#45;&gt;RaftLogEngine</title>
<path fill="none" stroke="#666666" d="M478.76,-457C503.2,-457 530.82,-457 556.87,-457"/>
<polygon fill="#666666" stroke="#666666" points="557.15,-460.5 567.15,-457 557.15,-453.5 557.15,-460.5"/>
</g>
<!-- KvEngine -->
<g id="node5" class="node">
<title>KvEngine</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M595,-292.5C595,-292.5 720,-292.5 720,-292.5 726,-292.5 732,-298.5 732,-304.5 732,-304.5 732,-341.5 732,-341.5 732,-347.5 726,-353.5 720,-353.5 720,-353.5 595,-353.5 595,-353.5 589,-353.5 583,-347.5 583,-341.5 583,-341.5 583,-304.5 583,-304.5 583,-298.5 589,-292.5 595,-292.5"/>
<text text-anchor="middle" x="657.5" y="-338.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">KvEngine</text>
<polyline fill="none" stroke="#8a8898" points="583,-330.5 732,-330.5 "/>
<text text-anchor="start" x="591" y="-315.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">存储KV</text>
<text text-anchor="start" x="591" y="-300.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 实现为RocksdbEngine</text>
</g>
<!-- RaftPoller_end&#45;&gt;KvEngine -->
<g id="edge5" class="edge">
<title>RaftPoller_end&#45;&gt;KvEngine</title>
<path fill="none" stroke="#666666" d="M465.23,-426.46C474.55,-421.66 484.05,-416.73 493,-412 525.77,-394.71 561.97,-375.05 591.97,-358.62"/>
<polygon fill="#666666" stroke="#666666" points="593.98,-361.51 601.07,-353.63 590.62,-355.37 593.98,-361.51"/>
</g>
<!-- ApplyPoller_end -->
<g id="node6" class="node">
<title>ApplyPoller_end</title>
<path fill="none" stroke="#1c2123" d="M350.5,-16.5C350.5,-16.5 457.5,-16.5 457.5,-16.5 463.5,-16.5 469.5,-22.5 469.5,-28.5 469.5,-28.5 469.5,-103.5 469.5,-103.5 469.5,-109.5 463.5,-115.5 457.5,-115.5 457.5,-115.5 350.5,-115.5 350.5,-115.5 344.5,-115.5 338.5,-109.5 338.5,-103.5 338.5,-103.5 338.5,-28.5 338.5,-28.5 338.5,-22.5 344.5,-16.5 350.5,-16.5"/>
<text text-anchor="middle" x="404" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">end</text>
<polyline fill="none" stroke="#1c2123" points="338.5,-92.5 469.5,-92.5 "/>
<text text-anchor="start" x="346.5" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将write batch写入</text>
<text text-anchor="start" x="346.5" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 底层rocksdb</text>
<polyline fill="none" stroke="#1c2123" points="338.5,-54.5 469.5,-54.5 "/>
<text text-anchor="start" x="346.5" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">然后向raftPoller</text>
<text text-anchor="start" x="346.5" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送ApplyRes消息</text>
</g>
<!-- ApplyPoller_end&#45;&gt;KvEngine -->
<g id="edge6" class="edge">
<title>ApplyPoller_end&#45;&gt;KvEngine</title>
<path fill="none" stroke="#666666" d="M453.49,-115.55C501.9,-165.02 575.24,-239.96 619.25,-284.94"/>
<polygon fill="#666666" stroke="#666666" points="616.82,-287.46 626.32,-292.16 621.83,-282.56 616.82,-287.46"/>
</g>
<!-- ApplyRes -->
<g id="node10" class="node">
<title>ApplyRes</title>
<path fill="#feed9b" stroke="#f7e495" d="M541,-43C541,-43 774,-43 774,-43 780,-43 786,-49 786,-55 786,-55 786,-169 786,-169 786,-175 780,-181 774,-181 774,-181 541,-181 541,-181 535,-181 529,-175 529,-169 529,-169 529,-55 529,-55 529,-49 535,-43 541,-43"/>
<text text-anchor="middle" x="657.5" y="-165.8" font-family="Times,serif" font-size="14.00" fill="#40575d">ApplyRes</text>
<polyline fill="none" stroke="#f7e495" points="529,-158 786,-158 "/>
<text text-anchor="start" x="537" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region_id: u64,</text>
<polyline fill="none" stroke="#f7e495" points="529,-135 786,-135 "/>
<text text-anchor="start" x="537" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub apply_state: RaftApplyState,</text>
<polyline fill="none" stroke="#f7e495" points="529,-112 786,-112 "/>
<text text-anchor="start" x="537" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub applied_index_term: u64,</text>
<polyline fill="none" stroke="#f7e495" points="529,-89 786,-89 "/>
<text text-anchor="start" x="537" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub exec_res: VecDeque&lt;ExecResult&lt;S&gt;&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="529,-66 786,-66 "/>
<text text-anchor="start" x="537" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub metrics: ApplyMetrics,</text>
</g>
<!-- ApplyPoller_end&#45;&gt;ApplyRes -->
<g id="edge12" class="edge">
<title>ApplyPoller_end&#45;&gt;ApplyRes</title>
<path fill="none" stroke="#666666" d="M469.77,-77.85C484.98,-80.63 501.75,-83.7 518.83,-86.82"/>
<polygon fill="#666666" stroke="#666666" points="518.44,-90.31 528.91,-88.66 519.7,-83.42 518.44,-90.31"/>
</g>
<!-- ApplyPoller_poll -->
<g id="node7" class="node">
<title>ApplyPoller_poll</title>
<path fill="none" stroke="#1c2123" d="M28,-39C28,-39 84,-39 84,-39 90,-39 96,-45 96,-51 96,-51 96,-73 96,-73 96,-79 90,-85 84,-85 84,-85 28,-85 28,-85 22,-85 16,-79 16,-73 16,-73 16,-51 16,-51 16,-45 22,-39 28,-39"/>
<text text-anchor="middle" x="56" y="-69.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll</text>
<polyline fill="none" stroke="#1c2123" points="16,-62 96,-62 "/>
<text text-anchor="middle" x="56" y="-46.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll主循环</text>
</g>
<!-- ApplyPoller_poll&#45;&gt;ApplyPoller_end -->
<g id="edge7" class="edge">
<title>ApplyPoller_poll&#45;&gt;ApplyPoller_end</title>
<path fill="none" stroke="#666666" d="M96.03,-51.42C107.53,-48.78 120.19,-46.32 132,-45 196.93,-37.73 213.9,-39.53 279,-45 295.04,-46.35 312.12,-48.66 328.31,-51.27"/>
<polygon fill="#666666" stroke="#666666" points="327.82,-54.74 338.26,-52.93 328.97,-47.83 327.82,-54.74"/>
</g>
<!-- ApplyPoller_handle_normal -->
<g id="node8" class="node">
<title>ApplyPoller_handle_normal</title>
<path fill="none" stroke="#1c2123" d="M144,-54.5C144,-54.5 267,-54.5 267,-54.5 273,-54.5 279,-60.5 279,-66.5 279,-66.5 279,-103.5 279,-103.5 279,-109.5 273,-115.5 267,-115.5 267,-115.5 144,-115.5 144,-115.5 138,-115.5 132,-109.5 132,-103.5 132,-103.5 132,-66.5 132,-66.5 132,-60.5 138,-54.5 144,-54.5"/>
<text text-anchor="middle" x="205.5" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_normal</text>
<polyline fill="none" stroke="#1c2123" points="132,-92.5 279,-92.5 "/>
<text text-anchor="start" x="140" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理msg, 将修改写入</text>
<text text-anchor="start" x="140" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write batch</text>
</g>
<!-- ApplyPoller_poll&#45;&gt;ApplyPoller_handle_normal -->
<g id="edge8" class="edge">
<title>ApplyPoller_poll&#45;&gt;ApplyPoller_handle_normal</title>
<path fill="none" stroke="#666666" d="M96.14,-68.1C104.14,-69.35 112.84,-70.71 121.72,-72.09"/>
<polygon fill="#666666" stroke="#666666" points="121.37,-75.58 131.79,-73.66 122.45,-68.66 121.37,-75.58"/>
</g>
<!-- ApplyPoller_handle_normal&#45;&gt;ApplyPoller_end -->
<g id="edge9" class="edge">
<title>ApplyPoller_handle_normal&#45;&gt;ApplyPoller_end</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M279.11,-77.98C295.07,-76.44 312.01,-74.8 328.06,-73.25"/>
<polygon fill="green" stroke="green" points="328.85,-76.69 338.47,-72.24 328.17,-69.72 328.85,-76.69"/>
</g>
<!-- TaskApply&#45;&gt;ApplyPoller_handle_normal -->
<g id="edge11" class="edge">
<title>TaskApply&#45;&gt;ApplyPoller_handle_normal</title>
<path fill="none" stroke="#666666" d="M314.67,-190.69C290.4,-166.98 265.32,-142.48 245.43,-123.04"/>
<polygon fill="#666666" stroke="#666666" points="247.67,-120.33 238.07,-115.85 242.78,-125.34 247.67,-120.33"/>
</g>
<!-- ApplyRes&#45;&gt;RaftPoller_handle_normal -->
<g id="edge13" class="edge">
<title>ApplyRes&#45;&gt;RaftPoller_handle_normal</title>
<path fill="none" stroke="#666666" d="M597.79,-181.35C574.33,-211.31 548.34,-247.57 529,-283 507.16,-323 527.73,-349.5 493,-379 484.9,-385.89 364.39,-408.22 282.27,-422.8"/>
<polygon fill="#666666" stroke="#666666" points="281.44,-419.4 272.21,-424.59 282.67,-426.29 281.44,-419.4"/>
</g>
</g>
</svg>
