<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: load_stream Pages: 1 -->
<svg width="1212pt" height="661pt"
 viewBox="0.00 0.00 1212.00 660.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 656.5)">
<title>load_stream</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-656.5 1208,-656.5 1208,4 -4,4"/>
<!-- tombstone_stores_contains -->
<g id="node1" class="node">
<title>tombstone_stores_contains</title>
<path fill="none" stroke="#1c2123" d="M131,-576C131,-576 355,-576 355,-576 361,-576 367,-582 367,-588 367,-588 367,-640 367,-640 367,-646 361,-652 355,-652 355,-652 131,-652 131,-652 125,-652 119,-646 119,-640 119,-640 119,-588 119,-588 119,-582 125,-576 131,-576"/>
<text text-anchor="middle" x="243" y="-636.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.tombstone_stores.contains(&amp;store_id)</text>
<polyline fill="none" stroke="#1c2123" points="119,-629 367,-629 "/>
<text text-anchor="start" x="127" y="-613.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果已经store_id已经在</text>
<text text-anchor="start" x="127" y="-598.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> tombstone_stores中</text>
<text text-anchor="start" x="127" y="-583.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 返回false</text>
</g>
<!-- pool_connections_entry_or_insert_with -->
<g id="node2" class="node">
<title>pool_connections_entry_or_insert_with</title>
<path fill="none" stroke="#1c2123" d="M148.5,-193C148.5,-193 337.5,-193 337.5,-193 343.5,-193 349.5,-199 349.5,-205 349.5,-205 349.5,-287 349.5,-287 349.5,-293 343.5,-299 337.5,-299 337.5,-299 148.5,-299 148.5,-299 142.5,-299 136.5,-293 136.5,-287 136.5,-287 136.5,-205 136.5,-205 136.5,-199 142.5,-193 148.5,-193"/>
<text text-anchor="start" x="144.5" y="-283.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pool.connections</text>
<text text-anchor="start" x="144.5" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .entry(store_id, conn_id)</text>
<text text-anchor="start" x="144.5" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .or_insert_with(</text>
<text text-anchor="start" x="144.5" y="-238.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建StreamBackEnd的闭包函数)</text>
<polyline fill="none" stroke="#1c2123" points="136.5,-231 349.5,-231 "/>
<text text-anchor="start" x="144.5" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从connections_map中获取</text>
<text text-anchor="start" x="144.5" y="-200.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者从创建一个</text>
</g>
<!-- lambda -->
<g id="node3" class="node">
<title>lambda</title>
<path fill="none" stroke="#1c2123" d="M415,-227C415,-227 525,-227 525,-227 531,-227 537,-233 537,-239 537,-239 537,-253 537,-253 537,-259 531,-265 525,-265 525,-265 415,-265 415,-265 409,-265 403,-259 403,-253 403,-253 403,-239 403,-239 403,-233 409,-227 415,-227"/>
<text text-anchor="start" x="411" y="-249.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建StreamBackEnd</text>
<text text-anchor="start" x="411" y="-234.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和启动异任务</text>
</g>
<!-- pool_connections_entry_or_insert_with&#45;&gt;lambda -->
<g id="edge1" class="edge">
<title>pool_connections_entry_or_insert_with&#45;&gt;lambda</title>
<path fill="none" stroke="#666666" d="M349.58,-246C364.05,-246 378.67,-246 392.48,-246"/>
<polygon fill="#666666" stroke="#666666" points="392.87,-249.5 402.87,-246 392.87,-242.5 392.87,-249.5"/>
</g>
<!-- start -->
<g id="node4" class="node">
<title>start</title>
<path fill="none" stroke="#1c2123" d="M587,-319C587,-319 735,-319 735,-319 741,-319 747,-325 747,-331 747,-331 747,-413 747,-413 747,-419 741,-425 735,-425 735,-425 587,-425 587,-425 581,-425 575,-419 575,-413 575,-413 575,-331 575,-331 575,-325 581,-319 587,-319"/>
<text text-anchor="middle" x="661" y="-409.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">start</text>
<polyline fill="none" stroke="#1c2123" points="575,-402 747,-402 "/>
<text text-anchor="start" x="583" y="-386.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">async 函数</text>
<text text-anchor="start" x="583" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.解析store的addr</text>
<text text-anchor="start" x="583" y="-356.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.创建和addr的conn</text>
<text text-anchor="start" x="583" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 3.创建batch_call异步任务</text>
<text text-anchor="start" x="583" y="-326.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 4.await batch_call</text>
</g>
<!-- lambda&#45;&gt;start -->
<g id="edge4" class="edge">
<title>lambda&#45;&gt;start</title>
<path fill="none" stroke="#666666" d="M499.71,-265.14C519.09,-278.06 545.8,-295.87 571.86,-313.24"/>
<polygon fill="#666666" stroke="#666666" points="570.03,-316.23 580.29,-318.86 573.91,-310.4 570.03,-316.23"/>
</g>
<!-- future_pool_spawn -->
<g id="node6" class="node">
<title>future_pool_spawn</title>
<path fill="none" stroke="#1c2123" d="M1079,-372.5C1079,-372.5 1192,-372.5 1192,-372.5 1198,-372.5 1204,-378.5 1204,-384.5 1204,-384.5 1204,-421.5 1204,-421.5 1204,-427.5 1198,-433.5 1192,-433.5 1192,-433.5 1079,-433.5 1079,-433.5 1073,-433.5 1067,-427.5 1067,-421.5 1067,-421.5 1067,-384.5 1067,-384.5 1067,-378.5 1073,-372.5 1079,-372.5"/>
<text text-anchor="middle" x="1135.5" y="-418.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">future_pool.spawn</text>
<polyline fill="none" stroke="#1c2123" points="1067,-410.5 1204,-410.5 "/>
<text text-anchor="start" x="1075" y="-395.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在future_pool中执行</text>
<text text-anchor="start" x="1075" y="-380.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 异步任务</text>
</g>
<!-- lambda&#45;&gt;future_pool_spawn -->
<g id="edge5" class="edge">
<title>lambda&#45;&gt;future_pool_spawn</title>
<path fill="none" stroke="#666666" d="M537.26,-264.5C549.08,-267.15 561.34,-269.49 573,-271 598.24,-274.27 1008.05,-268.01 1031,-279 1067.91,-296.66 1096.36,-334.47 1114.01,-363.72"/>
<polygon fill="#666666" stroke="#666666" points="1111.07,-365.63 1119.14,-372.5 1117.12,-362.1 1111.07,-365.63"/>
</g>
<!-- StreamBackEnd -->
<g id="node7" class="node">
<title>StreamBackEnd</title>
<path fill="none" stroke="#1c2123" d="M701.5,-182C701.5,-182 620.5,-182 620.5,-182 614.5,-182 608.5,-176 608.5,-170 608.5,-170 608.5,-158 608.5,-158 608.5,-152 614.5,-146 620.5,-146 620.5,-146 701.5,-146 701.5,-146 707.5,-146 713.5,-152 713.5,-158 713.5,-158 713.5,-170 713.5,-170 713.5,-176 707.5,-182 701.5,-182"/>
<text text-anchor="middle" x="661" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">StreamBackEnd</text>
</g>
<!-- lambda&#45;&gt;StreamBackEnd -->
<g id="edge6" class="edge">
<title>lambda&#45;&gt;StreamBackEnd</title>
<path fill="none" stroke="#666666" d="M502.83,-226.77C522.56,-215.37 548.7,-201.21 573,-191 581.16,-187.57 589.9,-184.35 598.59,-181.42"/>
<polygon fill="#666666" stroke="#666666" points="599.93,-184.66 608.34,-178.22 597.75,-178.01 599.93,-184.66"/>
</g>
<!-- queue_new -->
<g id="node8" class="node">
<title>queue_new</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M585,-200.5C585,-200.5 737,-200.5 737,-200.5 743,-200.5 749,-206.5 749,-212.5 749,-212.5 749,-249.5 749,-249.5 749,-255.5 743,-261.5 737,-261.5 737,-261.5 585,-261.5 585,-261.5 579,-261.5 573,-255.5 573,-249.5 573,-249.5 573,-212.5 573,-212.5 573,-206.5 579,-200.5 585,-200.5"/>
<text text-anchor="middle" x="661" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Queue::with_capacity</text>
<polyline fill="none" stroke="#8a8898" points="573,-238.5 749,-238.5 "/>
<text text-anchor="start" x="581" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">新创建的queue</text>
<text text-anchor="start" x="581" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 会插到LRUCache和pool中</text>
</g>
<!-- lambda&#45;&gt;queue_new -->
<g id="edge7" class="edge">
<title>lambda&#45;&gt;queue_new</title>
<path fill="none" stroke="#666666" d="M537.1,-240.75C545.37,-240.1 553.95,-239.42 562.56,-238.73"/>
<polygon fill="#666666" stroke="#666666" points="562.98,-242.21 572.67,-237.93 562.43,-235.23 562.98,-242.21"/>
</g>
<!-- RaftCall -->
<g id="node5" class="node">
<title>RaftCall</title>
<path fill="none" stroke="#1c2123" d="M797,-288C797,-288 1019,-288 1019,-288 1025,-288 1031,-294 1031,-300 1031,-300 1031,-506 1031,-506 1031,-512 1025,-518 1019,-518 1019,-518 797,-518 797,-518 791,-518 785,-512 785,-506 785,-506 785,-300 785,-300 785,-294 791,-288 797,-288"/>
<text text-anchor="middle" x="908" y="-502.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCall</text>
<polyline fill="none" stroke="#1c2123" points="785,-495 1031,-495 "/>
<text text-anchor="start" x="793" y="-479.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">sender: ClientCStreamSender&lt;M&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="785,-472 1031,-472 "/>
<text text-anchor="start" x="793" y="-456.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">receiver: ClientCStreamReceiver&lt;Done&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="785,-449 1031,-449 "/>
<text text-anchor="start" x="793" y="-433.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">queue: Arc&lt;Queue&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="785,-426 1031,-426 "/>
<text text-anchor="start" x="793" y="-410.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">buffer: B,</text>
<polyline fill="none" stroke="#1c2123" points="785,-403 1031,-403 "/>
<text text-anchor="start" x="793" y="-387.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">router: R,</text>
<polyline fill="none" stroke="#1c2123" points="785,-380 1031,-380 "/>
<text text-anchor="start" x="793" y="-364.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_scheduler: Scheduler&lt;SnapTask&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="785,-357 1031,-357 "/>
<text text-anchor="start" x="793" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lifetime: Option&lt;oneshot::Sender&lt;()&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="785,-334 1031,-334 "/>
<text text-anchor="start" x="793" y="-318.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">store_id: u64,</text>
<polyline fill="none" stroke="#1c2123" points="785,-311 1031,-311 "/>
<text text-anchor="start" x="793" y="-295.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">addr: String,</text>
</g>
<!-- start&#45;&gt;RaftCall -->
<g id="edge2" class="edge">
<title>start&#45;&gt;RaftCall</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M747,-382.76C755.93,-383.89 765.16,-385.05 774.46,-386.23"/>
<polygon fill="green" stroke="green" points="774.22,-389.73 784.58,-387.51 775.1,-382.78 774.22,-389.73"/>
</g>
<!-- RaftCall&#45;&gt;future_pool_spawn -->
<g id="edge3" class="edge">
<title>RaftCall&#45;&gt;future_pool_spawn</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1031.32,-403C1039.91,-403 1048.43,-403 1056.67,-403"/>
<polygon fill="green" stroke="green" points="1056.94,-406.5 1066.94,-403 1056.94,-399.5 1056.94,-406.5"/>
</g>
<!-- queue_new&#45;&gt;RaftCall -->
<g id="edge9" class="edge">
<title>queue_new&#45;&gt;RaftCall:queue</title>
<path fill="none" stroke="#666666" d="M704.89,-261.64C720.75,-274.9 737.63,-291.61 749,-310 778.08,-357.02 732.53,-428.09 774.93,-437.06"/>
<polygon fill="#666666" stroke="#666666" points="774.72,-440.55 785,-438 775.37,-433.58 774.72,-440.55"/>
</g>
<!-- LRUCache_insert -->
<g id="node9" class="node">
<title>LRUCache_insert</title>
<path fill="none" stroke="#1c2123" d="M953,-199C953,-199 863,-199 863,-199 857,-199 851,-193 851,-187 851,-187 851,-175 851,-175 851,-169 857,-163 863,-163 863,-163 953,-163 953,-163 959,-163 965,-169 965,-175 965,-175 965,-187 965,-187 965,-193 959,-199 953,-199"/>
<text text-anchor="middle" x="908" y="-177.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LRUCache_insert</text>
</g>
<!-- queue_new&#45;&gt;LRUCache_insert -->
<g id="edge8" class="edge">
<title>queue_new&#45;&gt;LRUCache_insert</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M749.07,-213.23C779.2,-207.08 812.47,-200.29 840.66,-194.54"/>
<polygon fill="green" stroke="green" points="841.71,-197.9 850.81,-192.47 840.31,-191.04 841.71,-197.9"/>
</g>
<!-- load_stream -->
<g id="node10" class="node">
<title>load_stream</title>
<path fill="none" stroke="#1c2123" d="M71,-223C71,-223 12,-223 12,-223 6,-223 0,-217 0,-211 0,-211 0,-199 0,-199 0,-193 6,-187 12,-187 12,-187 71,-187 71,-187 77,-187 83,-193 83,-199 83,-199 83,-211 83,-211 83,-217 77,-223 71,-223"/>
<text text-anchor="middle" x="41.5" y="-201.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">load_stream</text>
</g>
<!-- load_stream&#45;&gt;tombstone_stores_contains -->
<g id="edge10" class="edge">
<title>load_stream&#45;&gt;tombstone_stores_contains</title>
<path fill="none" stroke="#666666" d="M44.21,-223.13C50.65,-288.05 75.36,-507.88 119,-561 121.39,-563.91 123.97,-566.67 126.71,-569.27"/>
<polygon fill="#666666" stroke="#666666" points="124.45,-571.94 134.3,-575.83 129.02,-566.65 124.45,-571.94"/>
</g>
<!-- load_stream&#45;&gt;pool_connections_entry_or_insert_with -->
<g id="edge11" class="edge">
<title>load_stream&#45;&gt;pool_connections_entry_or_insert_with</title>
<path fill="none" stroke="#666666" d="M83.35,-213.4C96.16,-216.03 111,-219.08 126.34,-222.23"/>
<polygon fill="#666666" stroke="#666666" points="125.98,-225.73 136.48,-224.32 127.39,-218.87 125.98,-225.73"/>
</g>
<!-- load_stream&#45;&gt;start -->
<g id="edge12" class="edge">
<title>load_stream&#45;&gt;start</title>
<path fill="none" stroke="#666666" d="M50.25,-223.32C61.52,-247.46 84.89,-289.18 119,-309 257.89,-389.68 450.67,-391.03 564.66,-382.8"/>
<polygon fill="#666666" stroke="#666666" points="565.06,-386.28 574.77,-382.03 564.53,-379.3 565.06,-386.28"/>
</g>
<!-- load_stream&#45;&gt;future_pool_spawn -->
<g id="edge13" class="edge">
<title>load_stream&#45;&gt;future_pool_spawn</title>
<path fill="none" stroke="#666666" d="M47.6,-223.16C57.1,-254.19 80.15,-317.9 119,-358 242.02,-484.96 292.21,-547 469,-547 469,-547 469,-547 662,-547 826.22,-547 884.24,-601.69 1031,-528 1067.62,-509.61 1096.04,-471.77 1113.76,-442.51"/>
<polygon fill="#666666" stroke="#666666" points="1116.86,-444.13 1118.91,-433.74 1110.83,-440.59 1116.86,-444.13"/>
</g>
<!-- load_stream&#45;&gt;StreamBackEnd -->
<g id="edge14" class="edge">
<title>load_stream&#45;&gt;StreamBackEnd</title>
<path fill="none" stroke="#666666" d="M83.02,-192.01C94.53,-188.83 107.16,-185.82 119,-184 290.99,-157.58 497.17,-158.91 598.13,-161.68"/>
<polygon fill="#666666" stroke="#666666" points="598.06,-165.18 608.16,-161.96 598.26,-158.18 598.06,-165.18"/>
</g>
<!-- load_stream&#45;&gt;LRUCache_insert -->
<g id="edge15" class="edge">
<title>load_stream&#45;&gt;LRUCache_insert</title>
<path fill="none" stroke="#666666" d="M65.84,-186.79C80.3,-176.63 99.72,-164.86 119,-159 387.08,-77.57 471.41,-99.07 749,-137 781.7,-141.47 817.17,-150.91 846.21,-159.9"/>
<polygon fill="#666666" stroke="#666666" points="845.21,-163.26 855.8,-162.93 847.31,-156.58 845.21,-163.26"/>
</g>
<!-- pool_lock -->
<g id="node11" class="node">
<title>pool_lock</title>
<path fill="none" stroke="#1c2123" d="M266.5,-90C266.5,-90 219.5,-90 219.5,-90 213.5,-90 207.5,-84 207.5,-78 207.5,-78 207.5,-66 207.5,-66 207.5,-60 213.5,-54 219.5,-54 219.5,-54 266.5,-54 266.5,-54 272.5,-54 278.5,-60 278.5,-66 278.5,-66 278.5,-78 278.5,-78 278.5,-84 272.5,-90 266.5,-90"/>
<text text-anchor="middle" x="243" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pool_lock</text>
</g>
<!-- load_stream&#45;&gt;pool_lock -->
<g id="edge16" class="edge">
<title>load_stream&#45;&gt;pool_lock</title>
<path fill="none" stroke="#666666" d="M51.43,-186.7C63.54,-163.82 87.35,-125.13 119,-104 142.2,-88.51 172.49,-80.52 197.2,-76.39"/>
<polygon fill="#666666" stroke="#666666" points="198.05,-79.8 207.42,-74.85 197.01,-72.88 198.05,-79.8"/>
</g>
<!-- LRUCache_resize -->
<g id="node12" class="node">
<title>LRUCache_resize</title>
<path fill="none" stroke="#1c2123" d="M289,-36C289,-36 197,-36 197,-36 191,-36 185,-30 185,-24 185,-24 185,-12 185,-12 185,-6 191,0 197,0 197,0 289,0 289,0 295,0 301,-6 301,-12 301,-12 301,-24 301,-24 301,-30 295,-36 289,-36"/>
<text text-anchor="middle" x="243" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LRUCache_resize</text>
</g>
<!-- load_stream&#45;&gt;LRUCache_resize -->
<g id="edge17" class="edge">
<title>load_stream&#45;&gt;LRUCache_resize</title>
<path fill="none" stroke="#666666" d="M45.77,-186.89C52.81,-153.37 72.68,-81.73 119,-45 134.83,-32.45 155.25,-25.44 174.89,-21.61"/>
<polygon fill="#666666" stroke="#666666" points="175.48,-25.06 184.75,-19.93 174.31,-18.16 175.48,-25.06"/>
</g>
</g>
</svg>
