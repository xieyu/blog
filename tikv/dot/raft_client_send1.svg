<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_client_send_1 Pages: 1 -->
<svg width="1252pt" height="424pt"
 viewBox="0.00 0.00 1252.00 424.30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 420.3)">
<title>raft_client_send_1</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-420.3 1248,-420.3 1248,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_Loop</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M155,-40.3C155,-40.3 1224,-40.3 1224,-40.3 1230,-40.3 1236,-46.3 1236,-52.3 1236,-52.3 1236,-322.3 1236,-322.3 1236,-328.3 1230,-334.3 1224,-334.3 1224,-334.3 155,-334.3 155,-334.3 149,-334.3 143,-328.3 143,-322.3 143,-322.3 143,-52.3 143,-52.3 143,-46.3 149,-40.3 155,-40.3"/>
<text text-anchor="middle" x="689.5" y="-314.3" font-family="Times,serif" font-size="20.00">Loop</text>
<text text-anchor="middle" x="689.5" y="-292.3" font-family="Times,serif" font-size="20.00">直到消息push成功</text>
</g>
<!-- cacheKey -->
<g id="node1" class="node">
<title>cacheKey</title>
<path fill="none" stroke="#1c2123" d="M179,-174.8C179,-174.8 289,-174.8 289,-174.8 295,-174.8 301,-180.8 301,-186.8 301,-186.8 301,-261.8 301,-261.8 301,-267.8 295,-273.8 289,-273.8 289,-273.8 179,-273.8 179,-273.8 173,-273.8 167,-267.8 167,-261.8 167,-261.8 167,-186.8 167,-186.8 167,-180.8 173,-174.8 179,-174.8"/>
<text text-anchor="middle" x="234" y="-258.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">cacheKey</text>
<polyline fill="none" stroke="#1c2123" points="167,-250.8 301,-250.8 "/>
<text text-anchor="start" x="175" y="-235.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">store_id, conn_id</text>
<polyline fill="none" stroke="#1c2123" points="167,-227.8 301,-227.8 "/>
<text text-anchor="start" x="175" y="-212.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">conn_id为:</text>
<text text-anchor="start" x="175" y="-197.6" font-family="Times,serif" font-size="14.00" fill="#2f3638"> msg.region_id % </text>
<text text-anchor="start" x="175" y="-182.6" font-family="Times,serif" font-size="14.00" fill="#2f3638"> grpc_raft_conn_num</text>
</g>
<!-- LRUCache_get_mut -->
<g id="node3" class="node">
<title>LRUCache_get_mut</title>
<path fill="none" stroke="#1c2123" d="M365,-196.8C365,-196.8 478,-196.8 478,-196.8 484,-196.8 490,-202.8 490,-208.8 490,-208.8 490,-245.8 490,-245.8 490,-251.8 484,-257.8 478,-257.8 478,-257.8 365,-257.8 365,-257.8 359,-257.8 353,-251.8 353,-245.8 353,-245.8 353,-208.8 353,-208.8 353,-202.8 359,-196.8 365,-196.8"/>
<text text-anchor="middle" x="421.5" y="-242.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.LRUCache.get_mut</text>
<polyline fill="none" stroke="#1c2123" points="353,-234.8 490,-234.8 "/>
<text text-anchor="start" x="361" y="-219.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据cacheKey获取</text>
<text text-anchor="start" x="361" y="-204.6" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应的queue</text>
</g>
<!-- cacheKey&#45;&gt;LRUCache_get_mut -->
<g id="edge2" class="edge">
<title>cacheKey&#45;&gt;LRUCache_get_mut</title>
<path fill="none" stroke="#666666" d="M301.18,-225.37C314.53,-225.59 328.68,-225.82 342.4,-226.04"/>
<polygon fill="#666666" stroke="#666666" points="342.72,-229.54 352.78,-226.21 342.84,-222.54 342.72,-229.54"/>
</g>
<!-- send -->
<g id="node2" class="node">
<title>send</title>
<path fill="none" stroke="#1c2123" d="M12,-264.3C12,-264.3 103,-264.3 103,-264.3 109,-264.3 115,-270.3 115,-276.3 115,-276.3 115,-328.3 115,-328.3 115,-334.3 109,-340.3 103,-340.3 103,-340.3 12,-340.3 12,-340.3 6,-340.3 0,-334.3 0,-328.3 0,-328.3 0,-276.3 0,-276.3 0,-270.3 6,-264.3 12,-264.3"/>
<text text-anchor="middle" x="57.5" y="-325.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">send</text>
<polyline fill="none" stroke="#1c2123" points="0,-317.3 115,-317.3 "/>
<text text-anchor="start" x="8" y="-302.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">将消息push到</text>
<text text-anchor="start" x="8" y="-287.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> store_id, conn_id</text>
<text text-anchor="start" x="8" y="-272.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应的Queue中</text>
</g>
<!-- send&#45;&gt;cacheKey -->
<g id="edge1" class="edge">
<title>send&#45;&gt;cacheKey</title>
<path fill="none" stroke="#666666" d="M115.16,-276.98C128.71,-270.92 143.39,-264.36 157.63,-257.99"/>
<polygon fill="#666666" stroke="#666666" points="159.22,-261.12 166.92,-253.84 156.36,-254.73 159.22,-261.12"/>
</g>
<!-- send&#45;&gt;LRUCache_get_mut -->
<g id="edge3" class="edge">
<title>send&#45;&gt;LRUCache_get_mut</title>
<path fill="none" stroke="#666666" d="M115.17,-304.89C168.37,-305.76 249.63,-303.02 317,-283.3 333.32,-278.53 349.97,-270.94 365,-262.87"/>
<polygon fill="#666666" stroke="#666666" points="367.09,-265.71 374.14,-257.8 363.7,-259.59 367.09,-265.71"/>
</g>
<!-- load_stream -->
<g id="node4" class="node">
<title>load_stream</title>
<path fill="none" stroke="#1c2123" d="M163,-49.3C163,-49.3 305,-49.3 305,-49.3 311,-49.3 317,-55.3 317,-61.3 317,-61.3 317,-143.3 317,-143.3 317,-149.3 311,-155.3 305,-155.3 305,-155.3 163,-155.3 163,-155.3 157,-155.3 151,-149.3 151,-143.3 151,-143.3 151,-61.3 151,-61.3 151,-55.3 157,-49.3 163,-49.3"/>
<text text-anchor="middle" x="234" y="-140.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">load_stream</text>
<polyline fill="none" stroke="#1c2123" points="151,-132.3 317,-132.3 "/>
<text text-anchor="start" x="159" y="-117.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果从LRU中获取失败</text>
<text text-anchor="start" x="159" y="-102.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从ConnectionPool</text>
<text text-anchor="start" x="159" y="-87.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 中loadConnection</text>
<text text-anchor="start" x="159" y="-72.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者创建StreamBackEnd</text>
<text text-anchor="start" x="159" y="-57.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并插入LRUCache</text>
</g>
<!-- send&#45;&gt;load_stream -->
<g id="edge4" class="edge">
<title>send&#45;&gt;load_stream</title>
<path fill="none" stroke="#666666" d="M76.54,-264.29C91.61,-235.09 115.1,-194.87 143,-165.3 143.88,-164.37 144.78,-163.43 145.7,-162.51"/>
<polygon fill="#666666" stroke="#666666" points="148.17,-164.99 152.96,-155.54 143.32,-159.94 148.17,-164.99"/>
</g>
<!-- ErrDiscardReasonFull -->
<g id="node5" class="node">
<title>ErrDiscardReasonFull</title>
<path fill="none" stroke="#1c2123" d="M821,-253.3C821,-253.3 708,-253.3 708,-253.3 702,-253.3 696,-247.3 696,-241.3 696,-241.3 696,-229.3 696,-229.3 696,-223.3 702,-217.3 708,-217.3 708,-217.3 821,-217.3 821,-217.3 827,-217.3 833,-223.3 833,-229.3 833,-229.3 833,-241.3 833,-241.3 833,-247.3 827,-253.3 821,-253.3"/>
<text text-anchor="middle" x="764.5" y="-231.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrDiscardReasonFull</text>
</g>
<!-- send&#45;&gt;ErrDiscardReasonFull -->
<g id="edge5" class="edge">
<title>send&#45;&gt;ErrDiscardReasonFull</title>
<path fill="none" stroke="#666666" d="M115.42,-318.44C124.57,-320.46 134,-322.2 143,-323.3 372.61,-351.41 434.96,-316.85 660,-263.3 669.58,-261.02 679.61,-258.49 689.51,-255.91"/>
<polygon fill="#666666" stroke="#666666" points="690.56,-259.25 699.34,-253.32 688.77,-252.48 690.56,-259.25"/>
</g>
<!-- Queue_push -->
<g id="node6" class="node">
<title>Queue_push</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M538,-207.3C538,-207.3 648,-207.3 648,-207.3 654,-207.3 660,-213.3 660,-219.3 660,-219.3 660,-241.3 660,-241.3 660,-247.3 654,-253.3 648,-253.3 648,-253.3 538,-253.3 538,-253.3 532,-253.3 526,-247.3 526,-241.3 526,-241.3 526,-219.3 526,-219.3 526,-213.3 532,-207.3 538,-207.3"/>
<text text-anchor="middle" x="593" y="-238.1" font-family="Times,serif" font-size="14.00" fill="#5d6179">2.Queue_push</text>
<polyline fill="none" stroke="#8a8898" points="526,-230.3 660,-230.3 "/>
<text text-anchor="start" x="534" y="-215.1" font-family="Times,serif" font-size="14.00" fill="#5d6179">向Queue中push消息</text>
</g>
<!-- send&#45;&gt;Queue_push -->
<g id="edge6" class="edge">
<title>send&#45;&gt;Queue_push</title>
<path fill="none" stroke="#666666" d="M115.3,-306.12C124.55,-306.61 134.04,-307.04 143,-307.3 220.3,-309.59 240.17,-316.07 317,-307.3 395.41,-298.36 414.32,-289.69 490,-267.3 500.69,-264.14 511.88,-260.46 522.78,-256.68"/>
<polygon fill="#666666" stroke="#666666" points="524,-259.96 532.26,-253.34 521.67,-253.36 524,-259.96"/>
</g>
<!-- Queue_notify -->
<g id="node7" class="node">
<title>Queue_notify</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M881,-197.3C881,-197.3 1016,-197.3 1016,-197.3 1022,-197.3 1028,-203.3 1028,-209.3 1028,-209.3 1028,-261.3 1028,-261.3 1028,-267.3 1022,-273.3 1016,-273.3 1016,-273.3 881,-273.3 881,-273.3 875,-273.3 869,-267.3 869,-261.3 869,-261.3 869,-209.3 869,-209.3 869,-203.3 875,-197.3 881,-197.3"/>
<text text-anchor="middle" x="948.5" y="-258.1" font-family="Times,serif" font-size="14.00" fill="#5d6179">3.Queue_notify</text>
<polyline fill="none" stroke="#8a8898" points="869,-250.3 1028,-250.3 "/>
<text text-anchor="start" x="877" y="-235.1" font-family="Times,serif" font-size="14.00" fill="#5d6179">队列满了，使用waker</text>
<text text-anchor="start" x="877" y="-220.1" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 通知RaftCall</text>
<text text-anchor="start" x="877" y="-205.1" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 从队里中Pop,发送消息</text>
</g>
<!-- send&#45;&gt;Queue_notify -->
<g id="edge7" class="edge">
<title>send&#45;&gt;Queue_notify</title>
<path fill="none" stroke="#666666" d="M115.07,-331.96C184.88,-365.73 308.16,-416.3 420.5,-416.3 420.5,-416.3 420.5,-416.3 594,-416.3 713.18,-416.3 832.59,-333.78 897.57,-280.18"/>
<polygon fill="#666666" stroke="#666666" points="900.18,-282.56 905.61,-273.47 895.69,-277.19 900.18,-282.56"/>
</g>
<!-- need_flush_push -->
<g id="node8" class="node">
<title>need_flush_push</title>
<path fill="none" stroke="#1c2123" d="M1076,-139.3C1076,-139.3 1216,-139.3 1216,-139.3 1222,-139.3 1228,-145.3 1228,-151.3 1228,-151.3 1228,-203.3 1228,-203.3 1228,-209.3 1222,-215.3 1216,-215.3 1216,-215.3 1076,-215.3 1076,-215.3 1070,-215.3 1064,-209.3 1064,-203.3 1064,-203.3 1064,-151.3 1064,-151.3 1064,-145.3 1070,-139.3 1076,-139.3"/>
<text text-anchor="middle" x="1146" y="-200.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">need_flush_push</text>
<polyline fill="none" stroke="#1c2123" points="1064,-192.3 1228,-192.3 "/>
<text text-anchor="start" x="1072" y="-177.1" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftClient.need_flush.push</text>
<text text-anchor="start" x="1072" y="-162.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ((store_id, conn_id))</text>
<text text-anchor="start" x="1072" y="-147.1" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 标记这个queue需要flush</text>
</g>
<!-- send&#45;&gt;need_flush_push -->
<g id="edge8" class="edge">
<title>send&#45;&gt;need_flush_push</title>
<path fill="none" stroke="#666666" d="M58.39,-264.19C60.51,-205.58 74.01,-94.44 143,-40.3 240.28,36.04 296.85,-20.3 420.5,-20.3 420.5,-20.3 420.5,-20.3 765.5,-20.3 884.72,-20.3 1010.09,-87.28 1082.73,-133.74"/>
<polygon fill="#666666" stroke="#666666" points="1081.02,-136.8 1091.32,-139.3 1084.83,-130.93 1081.02,-136.8"/>
</g>
<!-- LRUCache_get_mut&#45;&gt;Queue_push -->
<g id="edge16" class="edge">
<title>LRUCache_get_mut&#45;&gt;Queue_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M490.47,-228.5C498.78,-228.65 507.32,-228.8 515.75,-228.95"/>
<polygon fill="green" stroke="green" points="515.89,-232.45 525.95,-229.13 516.01,-225.46 515.89,-232.45"/>
</g>
<!-- LRUCache -->
<g id="node10" class="node">
<title>LRUCache</title>
<path fill="#feed9b" stroke="#f7e495" d="M566.5,-149.3C566.5,-149.3 619.5,-149.3 619.5,-149.3 625.5,-149.3 631.5,-155.3 631.5,-161.3 631.5,-161.3 631.5,-173.3 631.5,-173.3 631.5,-179.3 625.5,-185.3 619.5,-185.3 619.5,-185.3 566.5,-185.3 566.5,-185.3 560.5,-185.3 554.5,-179.3 554.5,-173.3 554.5,-173.3 554.5,-161.3 554.5,-161.3 554.5,-155.3 560.5,-149.3 566.5,-149.3"/>
<text text-anchor="middle" x="593" y="-163.6" font-family="Times,serif" font-size="14.00" fill="#40575d">LRUCache</text>
</g>
<!-- LRUCache_get_mut&#45;&gt;LRUCache -->
<g id="edge14" class="edge">
<title>LRUCache_get_mut&#45;&gt;LRUCache</title>
<path fill="none" stroke="#666666" d="M490.47,-203.24C508.64,-196.81 527.88,-190 544.67,-184.06"/>
<polygon fill="#666666" stroke="#666666" points="545.99,-187.3 554.24,-180.67 543.65,-180.7 545.99,-187.3"/>
</g>
<!-- LRUCache_insert -->
<g id="node9" class="node">
<title>LRUCache_insert</title>
<path fill="none" stroke="#1c2123" d="M466.5,-145.3C466.5,-145.3 376.5,-145.3 376.5,-145.3 370.5,-145.3 364.5,-139.3 364.5,-133.3 364.5,-133.3 364.5,-121.3 364.5,-121.3 364.5,-115.3 370.5,-109.3 376.5,-109.3 376.5,-109.3 466.5,-109.3 466.5,-109.3 472.5,-109.3 478.5,-115.3 478.5,-121.3 478.5,-121.3 478.5,-133.3 478.5,-133.3 478.5,-139.3 472.5,-145.3 466.5,-145.3"/>
<text text-anchor="middle" x="421.5" y="-123.6" font-family="Times,serif" font-size="14.00" fill="#2f3638">LRUCache_insert</text>
</g>
<!-- load_stream&#45;&gt;LRUCache_insert -->
<g id="edge13" class="edge">
<title>load_stream&#45;&gt;LRUCache_insert</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M317.17,-113.38C329.67,-115.06 342.42,-116.78 354.51,-118.41"/>
<polygon fill="green" stroke="green" points="354.11,-121.89 364.48,-119.75 355.04,-114.95 354.11,-121.89"/>
</g>
<!-- ErrDiscardReasonFull&#45;&gt;Queue_notify -->
<g id="edge10" class="edge">
<title>ErrDiscardReasonFull&#45;&gt;Queue_notify</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M833.01,-235.3C841.37,-235.3 850.02,-235.3 858.64,-235.3"/>
<polygon fill="green" stroke="green" points="858.73,-238.8 868.73,-235.3 858.73,-231.8 858.73,-238.8"/>
</g>
<!-- Queue_push&#45;&gt;ErrDiscardReasonFull -->
<g id="edge9" class="edge">
<title>Queue_push&#45;&gt;ErrDiscardReasonFull</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M660.02,-232.25C668.5,-232.5 677.25,-232.76 685.9,-233.01"/>
<polygon fill="green" stroke="green" points="685.89,-236.51 695.99,-233.31 686.09,-229.52 685.89,-236.51"/>
</g>
<!-- Queue_push&#45;&gt;need_flush_push -->
<g id="edge11" class="edge">
<title>Queue_push&#45;&gt;need_flush_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M660.21,-215.04C672.09,-212.58 684.38,-210.22 696,-208.3 818.79,-188.01 962.6,-180.97 1053.74,-178.54"/>
<polygon fill="green" stroke="green" points="1053.85,-182.04 1063.76,-178.29 1053.67,-175.04 1053.85,-182.04"/>
</g>
<!-- Queue_notify&#45;&gt;need_flush_push -->
<g id="edge12" class="edge">
<title>Queue_notify&#45;&gt;need_flush_push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1028.17,-211.96C1036.73,-209.42 1045.49,-206.82 1054.18,-204.25"/>
<polygon fill="green" stroke="green" points="1055.35,-207.55 1063.94,-201.35 1053.35,-200.84 1055.35,-207.55"/>
</g>
<!-- LRUCache_insert&#45;&gt;LRUCache -->
<g id="edge15" class="edge">
<title>LRUCache_insert&#45;&gt;LRUCache</title>
<path fill="none" stroke="#666666" d="M478.94,-140.62C500.2,-145.64 524.14,-151.29 544.5,-156.09"/>
<polygon fill="#666666" stroke="#666666" points="543.94,-159.56 554.48,-158.45 545.55,-152.74 543.94,-159.56"/>
</g>
</g>
</svg>
