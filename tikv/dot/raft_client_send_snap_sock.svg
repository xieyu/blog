<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: send_snap_sock Pages: 1 -->
<svg width="2017pt" height="808pt"
 viewBox="0.00 0.00 2017.00 808.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 804.4)">
<title>send_snap_sock</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-804.4 2013,-804.4 2013,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_snap_manager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M989,-538.4C989,-538.4 1529,-538.4 1529,-538.4 1535,-538.4 1541,-544.4 1541,-550.4 1541,-550.4 1541,-780.4 1541,-780.4 1541,-786.4 1535,-792.4 1529,-792.4 1529,-792.4 989,-792.4 989,-792.4 983,-792.4 977,-786.4 977,-780.4 977,-780.4 977,-550.4 977,-550.4 977,-544.4 983,-538.4 989,-538.4"/>
<text text-anchor="middle" x="1259" y="-772.4" font-family="Times,serif" font-size="20.00">snap_manager</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_security_manager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M995.5,-28.4C995.5,-28.4 1132.5,-28.4 1132.5,-28.4 1138.5,-28.4 1144.5,-34.4 1144.5,-40.4 1144.5,-40.4 1144.5,-170.4 1144.5,-170.4 1144.5,-176.4 1138.5,-182.4 1132.5,-182.4 1132.5,-182.4 995.5,-182.4 995.5,-182.4 989.5,-182.4 983.5,-176.4 983.5,-170.4 983.5,-170.4 983.5,-40.4 983.5,-40.4 983.5,-34.4 989.5,-28.4 995.5,-28.4"/>
<text text-anchor="middle" x="1064" y="-162.4" font-family="Times,serif" font-size="20.00">security_manager</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_TiKV</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1200,-51.4C1200,-51.4 1341,-51.4 1341,-51.4 1347,-51.4 1353,-57.4 1353,-63.4 1353,-63.4 1353,-147.4 1353,-147.4 1353,-153.4 1347,-159.4 1341,-159.4 1341,-159.4 1200,-159.4 1200,-159.4 1194,-159.4 1188,-153.4 1188,-147.4 1188,-147.4 1188,-63.4 1188,-63.4 1188,-57.4 1194,-51.4 1200,-51.4"/>
<text text-anchor="middle" x="1270.5" y="-139.4" font-family="Times,serif" font-size="20.00">TiKV</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_SnapChunk</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1212.5,-390.4C1212.5,-390.4 1773,-390.4 1773,-390.4 1779,-390.4 1785,-396.4 1785,-402.4 1785,-402.4 1785,-518.4 1785,-518.4 1785,-524.4 1779,-530.4 1773,-530.4 1773,-530.4 1212.5,-530.4 1212.5,-530.4 1206.5,-530.4 1200.5,-524.4 1200.5,-518.4 1200.5,-518.4 1200.5,-402.4 1200.5,-402.4 1200.5,-396.4 1206.5,-390.4 1212.5,-390.4"/>
<text text-anchor="middle" x="1492.75" y="-510.4" font-family="Times,serif" font-size="20.00">SnapChunk</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_snap_worker</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M45,-190.4C45,-190.4 1989,-190.4 1989,-190.4 1995,-190.4 2001,-196.4 2001,-202.4 2001,-202.4 2001,-370.4 2001,-370.4 2001,-376.4 1995,-382.4 1989,-382.4 1989,-382.4 45,-382.4 45,-382.4 39,-382.4 33,-376.4 33,-370.4 33,-370.4 33,-202.4 33,-202.4 33,-196.4 39,-190.4 45,-190.4"/>
<text text-anchor="middle" x="1017" y="-362.4" font-family="Times,serif" font-size="20.00">server/snap.rs/Runner</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_RaftCall</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-68.4C20,-68.4 593,-68.4 593,-68.4 599,-68.4 605,-74.4 605,-80.4 605,-80.4 605,-170.4 605,-170.4 605,-176.4 599,-182.4 593,-182.4 593,-182.4 20,-182.4 20,-182.4 14,-182.4 8,-176.4 8,-170.4 8,-170.4 8,-80.4 8,-80.4 8,-74.4 14,-68.4 20,-68.4"/>
<text text-anchor="middle" x="306.5" y="-162.4" font-family="Times,serif" font-size="20.00">RaftCall</text>
</g>
<!-- register -->
<g id="node1" class="node">
<title>register</title>
<path fill="none" stroke="#1c2123" d="M1080.5,-648.4C1080.5,-648.4 1047.5,-648.4 1047.5,-648.4 1041.5,-648.4 1035.5,-642.4 1035.5,-636.4 1035.5,-636.4 1035.5,-624.4 1035.5,-624.4 1035.5,-618.4 1041.5,-612.4 1047.5,-612.4 1047.5,-612.4 1080.5,-612.4 1080.5,-612.4 1086.5,-612.4 1092.5,-618.4 1092.5,-624.4 1092.5,-624.4 1092.5,-636.4 1092.5,-636.4 1092.5,-642.4 1086.5,-648.4 1080.5,-648.4"/>
<text text-anchor="middle" x="1064" y="-626.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">register</text>
</g>
<!-- get_snapshot_for_sending -->
<g id="node2" class="node">
<title>get_snapshot_for_sending</title>
<path fill="none" stroke="#1c2123" d="M997,-547.4C997,-547.4 1131,-547.4 1131,-547.4 1137,-547.4 1143,-553.4 1143,-559.4 1143,-559.4 1143,-581.4 1143,-581.4 1143,-587.4 1137,-593.4 1131,-593.4 1131,-593.4 997,-593.4 997,-593.4 991,-593.4 985,-587.4 985,-581.4 985,-581.4 985,-559.4 985,-559.4 985,-553.4 991,-547.4 997,-547.4"/>
<text text-anchor="middle" x="1064" y="-578.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_snapshot_for_sending</text>
<polyline fill="none" stroke="#1c2123" points="985,-570.4 1143,-570.4 "/>
<text text-anchor="middle" x="1064" y="-555.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取要发送的snapshot</text>
</g>
<!-- Snap_new_for_sending -->
<g id="node3" class="node">
<title>Snap_new_for_sending</title>
<path fill="none" stroke="#1c2123" d="M1210,-592.4C1210,-592.4 1331,-592.4 1331,-592.4 1337,-592.4 1343,-598.4 1343,-604.4 1343,-604.4 1343,-616.4 1343,-616.4 1343,-622.4 1337,-628.4 1331,-628.4 1331,-628.4 1210,-628.4 1210,-628.4 1204,-628.4 1198,-622.4 1198,-616.4 1198,-616.4 1198,-604.4 1198,-604.4 1198,-598.4 1204,-592.4 1210,-592.4"/>
<text text-anchor="middle" x="1270.5" y="-606.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap::new_for_sending</text>
</g>
<!-- get_snapshot_for_sending&#45;&gt;Snap_new_for_sending -->
<g id="edge1" class="edge">
<title>get_snapshot_for_sending&#45;&gt;Snap_new_for_sending</title>
<path fill="none" stroke="#666666" d="M1143.19,-585.69C1157.75,-588.54 1173.01,-591.53 1187.68,-594.4"/>
<polygon fill="#666666" stroke="#666666" points="1187.25,-597.88 1197.73,-596.36 1188.59,-591.01 1187.25,-597.88"/>
</g>
<!-- Snap -->
<g id="node4" class="node">
<title>Snap</title>
<path fill="none" stroke="#1c2123" d="M1393,-546.9C1393,-546.9 1521,-546.9 1521,-546.9 1527,-546.9 1533,-552.9 1533,-558.9 1533,-558.9 1533,-741.9 1533,-741.9 1533,-747.9 1527,-753.9 1521,-753.9 1521,-753.9 1393,-753.9 1393,-753.9 1387,-753.9 1381,-747.9 1381,-741.9 1381,-741.9 1381,-558.9 1381,-558.9 1381,-552.9 1387,-546.9 1393,-546.9"/>
<text text-anchor="middle" x="1457" y="-738.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap</text>
<polyline fill="none" stroke="#1c2123" points="1381,-730.9 1533,-730.9 "/>
<text text-anchor="start" x="1389" y="-715.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">key: SnapKey,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-707.9 1533,-707.9 "/>
<text text-anchor="start" x="1389" y="-692.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">display_path: String,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-684.9 1533,-684.9 "/>
<text text-anchor="start" x="1389" y="-669.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">dir_path: PathBuf,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-661.9 1533,-661.9 "/>
<text text-anchor="start" x="1389" y="-646.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">cf_files: Vec&lt;CfFile&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-638.9 1533,-638.9 "/>
<text text-anchor="start" x="1389" y="-623.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">cf_index: usize,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-615.9 1533,-615.9 "/>
<text text-anchor="start" x="1389" y="-600.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">meta_file: MetaFile,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-592.9 1533,-592.9 "/>
<text text-anchor="start" x="1389" y="-577.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">hold_tmp_files: bool,</text>
<polyline fill="none" stroke="#1c2123" points="1381,-569.9 1533,-569.9 "/>
<text text-anchor="start" x="1389" y="-554.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">mgr: SnapManagerCore,</text>
</g>
<!-- Snap_new_for_sending&#45;&gt;Snap -->
<g id="edge2" class="edge">
<title>Snap_new_for_sending&#45;&gt;Snap</title>
<path fill="none" stroke="#666666" d="M1343.1,-625.92C1352.17,-627.89 1361.53,-629.92 1370.79,-631.92"/>
<polygon fill="#666666" stroke="#666666" points="1370.27,-635.39 1380.78,-634.09 1371.75,-628.55 1370.27,-635.39"/>
</g>
<!-- SnapChunk -->
<g id="node6" class="node">
<title>SnapChunk</title>
<path fill="none" stroke="#1c2123" d="M1581,-399.4C1581,-399.4 1765,-399.4 1765,-399.4 1771,-399.4 1777,-405.4 1777,-411.4 1777,-411.4 1777,-479.4 1777,-479.4 1777,-485.4 1771,-491.4 1765,-491.4 1765,-491.4 1581,-491.4 1581,-491.4 1575,-491.4 1569,-485.4 1569,-479.4 1569,-479.4 1569,-411.4 1569,-411.4 1569,-405.4 1575,-399.4 1581,-399.4"/>
<text text-anchor="middle" x="1673" y="-476.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapChunk</text>
<polyline fill="none" stroke="#1c2123" points="1569,-468.4 1777,-468.4 "/>
<text text-anchor="start" x="1577" y="-453.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">first: Option&lt;SnapshotChunk&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1569,-445.4 1777,-445.4 "/>
<text text-anchor="start" x="1577" y="-430.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap: Box&lt;dyn GenericSnapshot&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1569,-422.4 1777,-422.4 "/>
<text text-anchor="start" x="1577" y="-407.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">remain_bytes: usize,</text>
</g>
<!-- Snap&#45;&gt;SnapChunk -->
<g id="edge3" class="edge">
<title>Snap&#45;&gt;SnapChunk</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1533.15,-578.41C1560.55,-552.16 1591.02,-522.97 1616.42,-498.64"/>
<polygon fill="green" stroke="green" points="1618.99,-501.03 1623.79,-491.59 1614.14,-495.98 1618.99,-501.03"/>
</g>
<!-- connect -->
<g id="node5" class="node">
<title>connect</title>
<path fill="none" stroke="#1c2123" d="M1003.5,-37.4C1003.5,-37.4 1124.5,-37.4 1124.5,-37.4 1130.5,-37.4 1136.5,-43.4 1136.5,-49.4 1136.5,-49.4 1136.5,-131.4 1136.5,-131.4 1136.5,-137.4 1130.5,-143.4 1124.5,-143.4 1124.5,-143.4 1003.5,-143.4 1003.5,-143.4 997.5,-143.4 991.5,-137.4 991.5,-131.4 991.5,-131.4 991.5,-49.4 991.5,-49.4 991.5,-43.4 997.5,-37.4 1003.5,-37.4"/>
<text text-anchor="middle" x="1064" y="-128.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">connect</text>
<polyline fill="none" stroke="#1c2123" points="991.5,-120.4 1136.5,-120.4 "/>
<text text-anchor="start" x="999.5" y="-105.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建和store_id addr的</text>
<text text-anchor="start" x="999.5" y="-90.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> grcp connection</text>
<text text-anchor="start" x="999.5" y="-75.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 得到grpc channel</text>
<text text-anchor="start" x="999.5" y="-60.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后用grpc channel</text>
<text text-anchor="start" x="999.5" y="-45.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建tikv client</text>
</g>
<!-- snapshot -->
<g id="node7" class="node">
<title>snapshot</title>
<path fill="none" stroke="#1c2123" d="M1208,-59.9C1208,-59.9 1333,-59.9 1333,-59.9 1339,-59.9 1345,-65.9 1345,-71.9 1345,-71.9 1345,-108.9 1345,-108.9 1345,-114.9 1339,-120.9 1333,-120.9 1333,-120.9 1208,-120.9 1208,-120.9 1202,-120.9 1196,-114.9 1196,-108.9 1196,-108.9 1196,-71.9 1196,-71.9 1196,-65.9 1202,-59.9 1208,-59.9"/>
<text text-anchor="middle" x="1270.5" y="-105.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">snapshot</text>
<polyline fill="none" stroke="#1c2123" points="1196,-97.9 1345,-97.9 "/>
<text text-anchor="start" x="1204" y="-82.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用grpc snapshot接口</text>
<text text-anchor="start" x="1204" y="-67.7" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取sink和reciver</text>
</g>
<!-- connect&#45;&gt;snapshot -->
<g id="edge4" class="edge">
<title>connect&#45;&gt;snapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1136.52,-90.4C1152.45,-90.4 1169.48,-90.4 1185.85,-90.4"/>
<polygon fill="green" stroke="green" points="1185.94,-93.9 1195.94,-90.4 1185.94,-86.9 1185.94,-93.9"/>
</g>
<!-- send_all -->
<g id="node8" class="node">
<title>send_all</title>
<path fill="none" stroke="#1c2123" d="M1825,-260.4C1825,-260.4 1981,-260.4 1981,-260.4 1987,-260.4 1993,-266.4 1993,-272.4 1993,-272.4 1993,-324.4 1993,-324.4 1993,-330.4 1987,-336.4 1981,-336.4 1981,-336.4 1825,-336.4 1825,-336.4 1819,-336.4 1813,-330.4 1813,-324.4 1813,-324.4 1813,-272.4 1813,-272.4 1813,-266.4 1819,-260.4 1825,-260.4"/>
<text text-anchor="middle" x="1903" y="-321.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">sink.send_all(chunks)</text>
<polyline fill="none" stroke="#1c2123" points="1813,-313.4 1993,-313.4 "/>
<text text-anchor="start" x="1821" y="-298.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapChunk实现了stream tait</text>
<text text-anchor="start" x="1821" y="-283.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用它的poll_next</text>
<text text-anchor="start" x="1821" y="-268.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送所有数据到sink</text>
</g>
<!-- SnapChunk&#45;&gt;send_all -->
<g id="edge25" class="edge">
<title>SnapChunk&#45;&gt;send_all</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1763.76,-399.26C1771.03,-395.05 1778.19,-390.73 1785,-386.4 1805.83,-373.15 1827.69,-357.28 1846.81,-342.7"/>
<polygon fill="green" stroke="green" points="1849.03,-345.41 1854.82,-336.54 1844.76,-339.86 1849.03,-345.41"/>
</g>
<!-- snapshot&#45;&gt;send_all -->
<g id="edge5" class="edge">
<title>snapshot&#45;&gt;send_all</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1345.06,-114.67C1458.48,-152.08 1676.21,-223.91 1803.24,-265.82"/>
<polygon fill="green" stroke="green" points="1802.38,-269.22 1812.98,-269.03 1804.58,-262.57 1802.38,-269.22"/>
</g>
<!-- poll_next -->
<g id="node9" class="node">
<title>poll_next</title>
<path fill="none" stroke="#1c2123" d="M1220.5,-399.4C1220.5,-399.4 1320.5,-399.4 1320.5,-399.4 1326.5,-399.4 1332.5,-405.4 1332.5,-411.4 1332.5,-411.4 1332.5,-433.4 1332.5,-433.4 1332.5,-439.4 1326.5,-445.4 1320.5,-445.4 1320.5,-445.4 1220.5,-445.4 1220.5,-445.4 1214.5,-445.4 1208.5,-439.4 1208.5,-433.4 1208.5,-433.4 1208.5,-411.4 1208.5,-411.4 1208.5,-405.4 1214.5,-399.4 1220.5,-399.4"/>
<text text-anchor="middle" x="1270.5" y="-430.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">poll_next</text>
<polyline fill="none" stroke="#1c2123" points="1208.5,-422.4 1332.5,-422.4 "/>
<text text-anchor="start" x="1216.5" y="-407.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">实现了Stream trait</text>
</g>
<!-- read_exact -->
<g id="node10" class="node">
<title>read_exact</title>
<path fill="none" stroke="#1c2123" d="M1482.5,-440.4C1482.5,-440.4 1431.5,-440.4 1431.5,-440.4 1425.5,-440.4 1419.5,-434.4 1419.5,-428.4 1419.5,-428.4 1419.5,-416.4 1419.5,-416.4 1419.5,-410.4 1425.5,-404.4 1431.5,-404.4 1431.5,-404.4 1482.5,-404.4 1482.5,-404.4 1488.5,-404.4 1494.5,-410.4 1494.5,-416.4 1494.5,-416.4 1494.5,-428.4 1494.5,-428.4 1494.5,-434.4 1488.5,-440.4 1482.5,-440.4"/>
<text text-anchor="middle" x="1457" y="-418.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">read_exact</text>
</g>
<!-- poll_next&#45;&gt;read_exact -->
<g id="edge6" class="edge">
<title>poll_next&#45;&gt;read_exact</title>
<path fill="none" stroke="#666666" d="M1332.68,-422.4C1357.6,-422.4 1385.95,-422.4 1409.18,-422.4"/>
<polygon fill="#666666" stroke="#666666" points="1409.46,-425.9 1419.46,-422.4 1409.46,-418.9 1409.46,-425.9"/>
</g>
<!-- start -->
<g id="node11" class="node">
<title>start</title>
<path fill="none" stroke="#1c2123" d="M83,-306.4C83,-306.4 53,-306.4 53,-306.4 47,-306.4 41,-300.4 41,-294.4 41,-294.4 41,-282.4 41,-282.4 41,-276.4 47,-270.4 53,-270.4 53,-270.4 83,-270.4 83,-270.4 89,-270.4 95,-276.4 95,-282.4 95,-282.4 95,-294.4 95,-294.4 95,-300.4 89,-306.4 83,-306.4"/>
<text text-anchor="middle" x="68" y="-284.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">start</text>
</g>
<!-- unbounded -->
<g id="node12" class="node">
<title>unbounded</title>
<path fill="none" stroke="#1c2123" d="M259.5,-288.4C259.5,-288.4 206.5,-288.4 206.5,-288.4 200.5,-288.4 194.5,-282.4 194.5,-276.4 194.5,-276.4 194.5,-264.4 194.5,-264.4 194.5,-258.4 200.5,-252.4 206.5,-252.4 206.5,-252.4 259.5,-252.4 259.5,-252.4 265.5,-252.4 271.5,-258.4 271.5,-264.4 271.5,-264.4 271.5,-276.4 271.5,-276.4 271.5,-282.4 265.5,-288.4 259.5,-288.4"/>
<text text-anchor="middle" x="233" y="-266.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">unbounded</text>
</g>
<!-- start&#45;&gt;unbounded -->
<g id="edge7" class="edge">
<title>start&#45;&gt;unbounded</title>
<path fill="none" stroke="#666666" d="M95.19,-285.51C119.18,-282.86 155.27,-278.87 184.37,-275.66"/>
<polygon fill="#666666" stroke="#666666" points="184.78,-279.13 194.33,-274.56 184.01,-272.18 184.78,-279.13"/>
</g>
<!-- start_impl -->
<g id="node15" class="node">
<title>start_impl</title>
<path fill="none" stroke="#1c2123" d="M451,-233.4C451,-233.4 582,-233.4 582,-233.4 588,-233.4 594,-239.4 594,-245.4 594,-245.4 594,-297.4 594,-297.4 594,-303.4 588,-309.4 582,-309.4 582,-309.4 451,-309.4 451,-309.4 445,-309.4 439,-303.4 439,-297.4 439,-297.4 439,-245.4 439,-245.4 439,-239.4 445,-233.4 451,-233.4"/>
<text text-anchor="middle" x="516.5" y="-294.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_impl</text>
<polyline fill="none" stroke="#1c2123" points="439,-286.4 594,-286.4 "/>
<text text-anchor="start" x="447" y="-271.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">spawn 线程，在线程中</text>
<text text-anchor="start" x="447" y="-256.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 不断的去rx中获取task</text>
<text text-anchor="middle" x="516.5" y="-241.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用run执行task</text>
</g>
<!-- start&#45;&gt;start_impl -->
<g id="edge11" class="edge">
<title>start&#45;&gt;start_impl</title>
<path fill="none" stroke="#666666" d="M95.21,-291.82C112.45,-293.9 135.53,-296.34 156,-297.4 264.3,-302.99 292.22,-309.38 400,-297.4 409.4,-296.35 419.15,-294.84 428.83,-293.07"/>
<polygon fill="#666666" stroke="#666666" points="429.71,-296.47 438.86,-291.14 428.38,-289.59 429.71,-296.47"/>
</g>
<!-- tx -->
<g id="node13" class="node">
<title>tx</title>
<path fill="none" stroke="#1c2123" d="M388,-234.4C388,-234.4 358,-234.4 358,-234.4 352,-234.4 346,-228.4 346,-222.4 346,-222.4 346,-210.4 346,-210.4 346,-204.4 352,-198.4 358,-198.4 358,-198.4 388,-198.4 388,-198.4 394,-198.4 400,-204.4 400,-210.4 400,-210.4 400,-222.4 400,-222.4 400,-228.4 394,-234.4 388,-234.4"/>
<text text-anchor="middle" x="373" y="-212.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">tx</text>
</g>
<!-- unbounded&#45;&gt;tx -->
<g id="edge8" class="edge">
<title>unbounded&#45;&gt;tx</title>
<path fill="none" stroke="#666666" d="M271.71,-255.64C291.78,-247.79 316.33,-238.18 336.12,-230.44"/>
<polygon fill="#666666" stroke="#666666" points="337.66,-233.59 345.7,-226.69 335.11,-227.08 337.66,-233.59"/>
</g>
<!-- rx -->
<g id="node14" class="node">
<title>rx</title>
<path fill="none" stroke="#1c2123" d="M388,-288.4C388,-288.4 358,-288.4 358,-288.4 352,-288.4 346,-282.4 346,-276.4 346,-276.4 346,-264.4 346,-264.4 346,-258.4 352,-252.4 358,-252.4 358,-252.4 388,-252.4 388,-252.4 394,-252.4 400,-258.4 400,-264.4 400,-264.4 400,-276.4 400,-276.4 400,-282.4 394,-288.4 388,-288.4"/>
<text text-anchor="middle" x="373" y="-266.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">rx</text>
</g>
<!-- unbounded&#45;&gt;rx -->
<g id="edge9" class="edge">
<title>unbounded&#45;&gt;rx</title>
<path fill="none" stroke="#666666" d="M271.71,-270.4C291.6,-270.4 315.88,-270.4 335.58,-270.4"/>
<polygon fill="#666666" stroke="#666666" points="335.7,-273.9 345.7,-270.4 335.7,-266.9 335.7,-273.9"/>
</g>
<!-- tx&#45;&gt;start_impl -->
<g id="edge10" class="edge">
<title>tx&#45;&gt;start_impl</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M400.28,-226.62C408.88,-229.95 418.94,-233.87 429.48,-237.96"/>
<polygon fill="green" stroke="green" points="428.25,-241.24 438.84,-241.6 430.78,-234.72 428.25,-241.24"/>
</g>
<!-- run -->
<g id="node16" class="node">
<title>run</title>
<path fill="none" stroke="#1c2123" d="M675,-289.4C675,-289.4 645,-289.4 645,-289.4 639,-289.4 633,-283.4 633,-277.4 633,-277.4 633,-265.4 633,-265.4 633,-259.4 639,-253.4 645,-253.4 645,-253.4 675,-253.4 675,-253.4 681,-253.4 687,-259.4 687,-265.4 687,-265.4 687,-277.4 687,-277.4 687,-283.4 681,-289.4 675,-289.4"/>
<text text-anchor="middle" x="660" y="-267.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">run</text>
</g>
<!-- start_impl&#45;&gt;run -->
<g id="edge12" class="edge">
<title>start_impl&#45;&gt;run</title>
<path fill="none" stroke="#666666" d="M594.05,-271.4C603.96,-271.4 613.71,-271.4 622.53,-271.4"/>
<polygon fill="#666666" stroke="#666666" points="622.77,-274.9 632.77,-271.4 622.77,-267.9 622.77,-274.9"/>
</g>
<!-- send_snap -->
<g id="node17" class="node">
<title>send_snap</title>
<path fill="none" stroke="#1c2123" d="M735,-199.4C735,-199.4 920,-199.4 920,-199.4 926,-199.4 932,-205.4 932,-211.4 932,-211.4 932,-263.4 932,-263.4 932,-269.4 926,-275.4 920,-275.4 920,-275.4 735,-275.4 735,-275.4 729,-275.4 723,-269.4 723,-263.4 723,-263.4 723,-211.4 723,-211.4 723,-205.4 729,-199.4 735,-199.4"/>
<text text-anchor="middle" x="827.5" y="-260.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_snap</text>
<polyline fill="none" stroke="#1c2123" points="723,-252.4 932,-252.4 "/>
<text text-anchor="start" x="731" y="-237.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.创建grcp channel</text>
<text text-anchor="start" x="731" y="-222.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.调用snapshot获取sink和reciver</text>
<text text-anchor="start" x="731" y="-207.2" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 生成asycn send task</text>
</g>
<!-- run&#45;&gt;send_snap -->
<g id="edge13" class="edge">
<title>run&#45;&gt;send_snap</title>
<path fill="none" stroke="#666666" d="M687.22,-266.01C694.8,-264.45 703.59,-262.65 712.99,-260.72"/>
<polygon fill="#666666" stroke="#666666" points="713.9,-264.1 722.99,-258.66 712.49,-257.25 713.9,-264.1"/>
</g>
<!-- pool_spawn -->
<g id="node20" class="node">
<title>pool_spawn</title>
<path fill="none" stroke="#1c2123" d="M744.5,-294.4C744.5,-294.4 910.5,-294.4 910.5,-294.4 916.5,-294.4 922.5,-300.4 922.5,-306.4 922.5,-306.4 922.5,-328.4 922.5,-328.4 922.5,-334.4 916.5,-340.4 910.5,-340.4 910.5,-340.4 744.5,-340.4 744.5,-340.4 738.5,-340.4 732.5,-334.4 732.5,-328.4 732.5,-328.4 732.5,-306.4 732.5,-306.4 732.5,-300.4 738.5,-294.4 744.5,-294.4"/>
<text text-anchor="middle" x="827.5" y="-325.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">pool.spawn(send_task)</text>
<polyline fill="none" stroke="#1c2123" points="732.5,-317.4 922.5,-317.4 "/>
<text text-anchor="start" x="740.5" y="-302.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">在future pool中执行async task</text>
</g>
<!-- run&#45;&gt;pool_spawn -->
<g id="edge24" class="edge">
<title>run&#45;&gt;pool_spawn</title>
<path fill="none" stroke="#666666" d="M687.22,-278.69C700.1,-282.27 716.47,-286.82 733.44,-291.53"/>
<polygon fill="#666666" stroke="#666666" points="732.9,-295.01 743.47,-294.32 734.77,-288.27 732.9,-295.01"/>
</g>
<!-- send_snap&#45;&gt;register -->
<g id="edge14" class="edge">
<title>send_snap&#45;&gt;register</title>
<path fill="none" stroke="#666666" d="M923.45,-275.54C926.58,-278.58 929.45,-281.86 932,-285.4 1015.18,-400.78 876.01,-494.91 968,-603.4 981.98,-619.88 1005.22,-626.68 1025.21,-629.33"/>
<polygon fill="#666666" stroke="#666666" points="1025,-632.83 1035.31,-630.37 1025.72,-625.87 1025,-632.83"/>
</g>
<!-- send_snap&#45;&gt;get_snapshot_for_sending -->
<g id="edge15" class="edge">
<title>send_snap&#45;&gt;get_snapshot_for_sending</title>
<path fill="none" stroke="#666666" d="M923.18,-275.74C926.38,-278.73 929.34,-281.95 932,-285.4 987.89,-358.01 922.7,-408.75 968,-488.4 979.86,-509.26 999.1,-527.34 1017.17,-541.19"/>
<polygon fill="#666666" stroke="#666666" points="1015.24,-544.11 1025.36,-547.24 1019.4,-538.48 1015.24,-544.11"/>
</g>
<!-- send_snap&#45;&gt;connect -->
<g id="edge16" class="edge">
<title>send_snap&#45;&gt;connect</title>
<path fill="none" stroke="#666666" d="M889.19,-199.35C917.72,-181.47 952.13,-159.9 982.77,-140.69"/>
<polygon fill="#666666" stroke="#666666" points="984.7,-143.62 991.31,-135.34 980.98,-137.69 984.7,-143.62"/>
</g>
<!-- send_snap&#45;&gt;SnapChunk -->
<g id="edge17" class="edge">
<title>send_snap&#45;&gt;SnapChunk</title>
<path fill="none" stroke="#666666" d="M919.97,-275.43C924.22,-278.53 928.26,-281.85 932,-285.4 956.81,-308.93 943.19,-329.86 968,-353.4 1046.19,-427.57 1082.75,-432.19 1188,-455.4 1312.58,-482.87 1459.58,-474.25 1558.62,-462.68"/>
<polygon fill="#666666" stroke="#666666" points="1559.13,-466.14 1568.65,-461.48 1558.3,-459.19 1559.13,-466.14"/>
</g>
<!-- send_snap&#45;&gt;snapshot -->
<g id="edge18" class="edge">
<title>send_snap&#45;&gt;snapshot</title>
<path fill="none" stroke="#666666" d="M840.65,-199.26C859.06,-148.69 899.36,-61.49 968,-24.4 1043.07,16.17 1077.79,-1.54 1160,-24.4 1181.78,-30.45 1203.56,-42.14 1221.89,-54.01"/>
<polygon fill="#666666" stroke="#666666" points="1220.34,-57.18 1230.6,-59.83 1224.23,-51.36 1220.34,-57.18"/>
</g>
<!-- get_snapshot -->
<g id="node18" class="node">
<title>get_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1095.5,-234.4C1095.5,-234.4 1032.5,-234.4 1032.5,-234.4 1026.5,-234.4 1020.5,-228.4 1020.5,-222.4 1020.5,-222.4 1020.5,-210.4 1020.5,-210.4 1020.5,-204.4 1026.5,-198.4 1032.5,-198.4 1032.5,-198.4 1095.5,-198.4 1095.5,-198.4 1101.5,-198.4 1107.5,-204.4 1107.5,-210.4 1107.5,-210.4 1107.5,-222.4 1107.5,-222.4 1107.5,-228.4 1101.5,-234.4 1095.5,-234.4"/>
<text text-anchor="middle" x="1064" y="-212.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_snapshot</text>
</g>
<!-- send_snap&#45;&gt;get_snapshot -->
<g id="edge19" class="edge">
<title>send_snap&#45;&gt;get_snapshot</title>
<path fill="none" stroke="#666666" d="M932.04,-228.13C959.06,-225.71 987.07,-223.2 1010.22,-221.13"/>
<polygon fill="#666666" stroke="#666666" points="1010.84,-224.58 1020.49,-220.21 1010.22,-217.61 1010.84,-224.58"/>
</g>
<!-- async_task -->
<g id="node19" class="node">
<title>async_task</title>
<path fill="none" stroke="#1c2123" d="M980,-252.9C980,-252.9 1148,-252.9 1148,-252.9 1154,-252.9 1160,-258.9 1160,-264.9 1160,-264.9 1160,-331.9 1160,-331.9 1160,-337.9 1154,-343.9 1148,-343.9 1148,-343.9 980,-343.9 980,-343.9 974,-343.9 968,-337.9 968,-331.9 968,-331.9 968,-264.9 968,-264.9 968,-258.9 974,-252.9 980,-252.9"/>
<text text-anchor="middle" x="1064" y="-328.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_task</text>
<polyline fill="none" stroke="#1c2123" points="968,-320.9 1160,-320.9 "/>
<text text-anchor="start" x="976" y="-305.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_task</text>
<text text-anchor="start" x="976" y="-290.7" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.使用sink发送所有snap数据</text>
<text text-anchor="start" x="976" y="-275.7" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.sink.close</text>
<text text-anchor="start" x="976" y="-260.7" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 3.recive</text>
</g>
<!-- send_snap&#45;&gt;async_task -->
<g id="edge20" class="edge">
<title>send_snap&#45;&gt;async_task</title>
<path fill="none" stroke="#666666" d="M932.04,-264.33C940.68,-266.58 949.43,-268.86 958.09,-271.11"/>
<polygon fill="#666666" stroke="#666666" points="957.26,-274.51 967.82,-273.64 959.02,-267.73 957.26,-274.51"/>
</g>
<!-- async_task&#45;&gt;send_all -->
<g id="edge21" class="edge">
<title>async_task&#45;&gt;send_all</title>
<path fill="none" stroke="#666666" d="M1160.2,-298.4C1319.83,-298.4 1639.94,-298.4 1802.44,-298.4"/>
<polygon fill="#666666" stroke="#666666" points="1802.91,-301.9 1812.91,-298.4 1802.91,-294.9 1802.91,-301.9"/>
</g>
<!-- async_task&#45;&gt;poll_next -->
<g id="edge22" class="edge">
<title>async_task&#45;&gt;poll_next</title>
<path fill="none" stroke="#666666" d="M1123.43,-343.92C1143.34,-358.41 1166.11,-373.91 1188,-386.4 1193.08,-389.3 1198.43,-392.12 1203.87,-394.84"/>
<polygon fill="#666666" stroke="#666666" points="1202.55,-398.08 1213.07,-399.29 1205.6,-391.78 1202.55,-398.08"/>
</g>
<!-- pool_spawn&#45;&gt;async_task -->
<g id="edge23" class="edge">
<title>pool_spawn&#45;&gt;async_task</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M922.53,-309.78C934.06,-308.85 945.9,-307.89 957.59,-306.94"/>
<polygon fill="green" stroke="green" points="958.12,-310.41 967.8,-306.11 957.55,-303.43 958.12,-310.41"/>
</g>
<!-- send_snap_sock -->
<g id="node21" class="node">
<title>send_snap_sock</title>
<path fill="none" stroke="#1c2123" d="M108,-125.4C108,-125.4 28,-125.4 28,-125.4 22,-125.4 16,-119.4 16,-113.4 16,-113.4 16,-101.4 16,-101.4 16,-95.4 22,-89.4 28,-89.4 28,-89.4 108,-89.4 108,-89.4 114,-89.4 120,-95.4 120,-101.4 120,-101.4 120,-113.4 120,-113.4 120,-119.4 114,-125.4 108,-125.4"/>
<text text-anchor="middle" x="68" y="-103.7" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_snap_sock</text>
</g>
<!-- SnapTask_Send -->
<g id="node22" class="node">
<title>SnapTask_Send</title>
<path fill="none" stroke="#1c2123" d="M448,-87.4C448,-87.4 585,-87.4 585,-87.4 591,-87.4 597,-93.4 597,-99.4 597,-99.4 597,-121.4 597,-121.4 597,-127.4 591,-133.4 585,-133.4 585,-133.4 448,-133.4 448,-133.4 442,-133.4 436,-127.4 436,-121.4 436,-121.4 436,-99.4 436,-99.4 436,-93.4 442,-87.4 448,-87.4"/>
<text text-anchor="middle" x="516.5" y="-118.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapTask_Send</text>
<polyline fill="none" stroke="#1c2123" points="436,-110.4 597,-110.4 "/>
<text text-anchor="start" x="444" y="-95.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送SnapTask::Send任务</text>
</g>
<!-- send_snap_sock&#45;&gt;SnapTask_Send -->
<g id="edge26" class="edge">
<title>send_snap_sock&#45;&gt;SnapTask_Send</title>
<path fill="none" stroke="#666666" d="M120.22,-94.3C131.9,-91.85 144.32,-89.66 156,-88.4 247.59,-78.51 352.82,-87.29 425.66,-96.53"/>
<polygon fill="#666666" stroke="#666666" points="425.35,-100.02 435.72,-97.83 426.25,-93.07 425.35,-100.02"/>
</g>
<!-- snap_scheduler_schedule -->
<g id="node23" class="node">
<title>snap_scheduler_schedule</title>
<path fill="none" stroke="#1c2123" d="M168,-97.4C168,-97.4 298,-97.4 298,-97.4 304,-97.4 310,-103.4 310,-109.4 310,-109.4 310,-131.4 310,-131.4 310,-137.4 304,-143.4 298,-143.4 298,-143.4 168,-143.4 168,-143.4 162,-143.4 156,-137.4 156,-131.4 156,-131.4 156,-109.4 156,-109.4 156,-103.4 162,-97.4 168,-97.4"/>
<text text-anchor="middle" x="233" y="-128.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_scheduler_schedule</text>
<polyline fill="none" stroke="#1c2123" points="156,-120.4 310,-120.4 "/>
<text text-anchor="start" x="164" y="-105.2" font-family="Times,serif" font-size="14.00" fill="#2f3638">向tx发送Task</text>
</g>
<!-- send_snap_sock&#45;&gt;snap_scheduler_schedule -->
<g id="edge27" class="edge">
<title>send_snap_sock&#45;&gt;snap_scheduler_schedule</title>
<path fill="none" stroke="#666666" d="M120.13,-111.48C128.4,-112.14 137.17,-112.84 146,-113.54"/>
<polygon fill="#666666" stroke="#666666" points="145.74,-117.03 155.98,-114.34 146.29,-110.05 145.74,-117.03"/>
</g>
<!-- SnapTask_Send&#45;&gt;send_snap -->
<g id="edge29" class="edge">
<title>SnapTask_Send&#45;&gt;send_snap</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M573.82,-133.54C615.85,-150.82 674.44,-174.9 724.62,-195.53"/>
<polygon fill="green" stroke="green" points="723.31,-198.77 733.89,-199.33 725.97,-192.3 723.31,-198.77"/>
</g>
<!-- snap_scheduler_schedule&#45;&gt;tx -->
<g id="edge28" class="edge">
<title>snap_scheduler_schedule&#45;&gt;tx</title>
<path fill="none" stroke="#666666" d="M267.41,-143.64C288.58,-158.37 315.91,-177.38 337.32,-192.28"/>
<polygon fill="#666666" stroke="#666666" points="335.6,-195.34 345.8,-198.18 339.59,-189.59 335.6,-195.34"/>
</g>
</g>
</svg>
