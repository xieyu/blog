<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handle_heartbeat Pages: 1 -->
<svg width="1276pt" height="457pt"
 viewBox="0.00 0.00 1276.00 456.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 452.5)">
<title>handle_heartbeat</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-452.5 1272,-452.5 1272,4 -4,4"/>
<!-- RaftCore__step -->
<g id="node1" class="node">
<title>RaftCore__step</title>
<path fill="none" stroke="#1c2123" d="M12,-102.5C12,-102.5 196,-102.5 196,-102.5 202,-102.5 208,-108.5 208,-114.5 208,-114.5 208,-151.5 208,-151.5 208,-157.5 202,-163.5 196,-163.5 196,-163.5 12,-163.5 12,-163.5 6,-163.5 0,-157.5 0,-151.5 0,-151.5 0,-114.5 0,-114.5 0,-108.5 6,-102.5 12,-102.5"/>
<text text-anchor="middle" x="104" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step</text>
<polyline fill="none" stroke="#1c2123" points="0,-140.5 208,-140.5 "/>
<text text-anchor="start" x="8" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果收到了term比自己高的msg</text>
<text text-anchor="start" x="8" y="-110.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就成为它的follower</text>
</g>
<!-- RaftCore__step_candidate -->
<g id="node2" class="node">
<title>RaftCore__step_candidate</title>
<path fill="none" stroke="#1c2123" d="M392,-151C392,-151 256,-151 256,-151 250,-151 244,-145 244,-139 244,-139 244,-127 244,-127 244,-121 250,-115 256,-115 256,-115 392,-115 392,-115 398,-115 404,-121 404,-127 404,-127 404,-139 404,-139 404,-145 398,-151 392,-151"/>
<text text-anchor="middle" x="324" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_candidate</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_candidate -->
<g id="edge1" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_candidate</title>
<path fill="none" stroke="#666666" d="M208.25,-133C216.78,-133 225.36,-133 233.77,-133"/>
<polygon fill="#666666" stroke="#666666" points="233.94,-136.5 243.94,-133 233.94,-129.5 233.94,-136.5"/>
</g>
<!-- RaftCore__step_follower -->
<g id="node3" class="node">
<title>RaftCore__step_follower</title>
<path fill="none" stroke="#1c2123" d="M389,-212C389,-212 259,-212 259,-212 253,-212 247,-206 247,-200 247,-200 247,-188 247,-188 247,-182 253,-176 259,-176 259,-176 389,-176 389,-176 395,-176 401,-182 401,-188 401,-188 401,-200 401,-200 401,-206 395,-212 389,-212"/>
<text text-anchor="middle" x="324" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_follower</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_follower -->
<g id="edge2" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_follower</title>
<path fill="none" stroke="#666666" d="M208.25,-161.89C221.94,-165.72 235.74,-169.58 248.79,-173.24"/>
<polygon fill="#666666" stroke="#666666" points="248.05,-176.66 258.62,-175.99 249.93,-169.92 248.05,-176.66"/>
</g>
<!-- RaftCore__become_follower -->
<g id="node4" class="node">
<title>RaftCore__become_follower</title>
<path fill="none" stroke="#1c2123" d="M453,-24C453,-24 604,-24 604,-24 610,-24 616,-30 616,-36 616,-36 616,-88 616,-88 616,-94 610,-100 604,-100 604,-100 453,-100 453,-100 447,-100 441,-94 441,-88 441,-88 441,-36 441,-36 441,-30 447,-24 453,-24"/>
<text text-anchor="middle" x="528.5" y="-84.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__become_follower</text>
<polyline fill="none" stroke="#1c2123" points="441,-77 616,-77 "/>
<text text-anchor="start" x="449" y="-61.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader_id = m.from</text>
<text text-anchor="start" x="449" y="-46.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> self.term = m.term</text>
<text text-anchor="start" x="449" y="-31.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重置自己的vote信息</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__become_follower -->
<g id="edge3" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__become_follower</title>
<path fill="none" stroke="#666666" d="M208.15,-112.51C220.22,-110.25 232.38,-108.03 244,-106 306.01,-95.17 375.89,-84.31 430.76,-76.09"/>
<polygon fill="#666666" stroke="#666666" points="431.45,-79.52 440.82,-74.58 430.41,-72.6 431.45,-79.52"/>
</g>
<!-- RaftCore__step_candidate&#45;&gt;RaftCore__become_follower -->
<g id="edge4" class="edge">
<title>RaftCore__step_candidate&#45;&gt;RaftCore__become_follower</title>
<path fill="none" stroke="#666666" d="M376.36,-114.99C393.1,-109.12 412.27,-102.4 431.2,-95.76"/>
<polygon fill="#666666" stroke="#666666" points="432.49,-99.02 440.76,-92.41 430.17,-92.42 432.49,-99.02"/>
</g>
<!-- RaftCore__handle_heartbeat -->
<g id="node5" class="node">
<title>RaftCore__handle_heartbeat</title>
<path fill="none" stroke="#1c2123" d="M602.5,-212C602.5,-212 454.5,-212 454.5,-212 448.5,-212 442.5,-206 442.5,-200 442.5,-200 442.5,-188 442.5,-188 442.5,-182 448.5,-176 454.5,-176 454.5,-176 602.5,-176 602.5,-176 608.5,-176 614.5,-182 614.5,-188 614.5,-188 614.5,-200 614.5,-200 614.5,-206 608.5,-212 602.5,-212"/>
<text text-anchor="middle" x="528.5" y="-190.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_heartbeat</text>
</g>
<!-- RaftCore__step_candidate&#45;&gt;RaftCore__handle_heartbeat -->
<g id="edge5" class="edge">
<title>RaftCore__step_candidate&#45;&gt;RaftCore__handle_heartbeat</title>
<path fill="none" stroke="#666666" d="M384.93,-151.05C407.9,-157.97 434.28,-165.92 458.06,-173.08"/>
<polygon fill="#666666" stroke="#666666" points="457.13,-176.46 467.72,-175.99 459.15,-169.76 457.13,-176.46"/>
</g>
<!-- RaftCore__step_follower&#45;&gt;RaftCore__handle_heartbeat -->
<g id="edge6" class="edge">
<title>RaftCore__step_follower&#45;&gt;RaftCore__handle_heartbeat</title>
<path fill="none" stroke="#666666" d="M401.27,-194C411.36,-194 421.8,-194 432.16,-194"/>
<polygon fill="#666666" stroke="#666666" points="432.48,-197.5 442.48,-194 432.48,-190.5 432.48,-197.5"/>
</g>
<!-- RaftCore__election_elapsed -->
<g id="node6" class="node">
<title>RaftCore__election_elapsed</title>
<path fill="#feed9b" stroke="#f7e495" d="M1057.5,-402C1057.5,-402 1203.5,-402 1203.5,-402 1209.5,-402 1215.5,-408 1215.5,-414 1215.5,-414 1215.5,-436 1215.5,-436 1215.5,-442 1209.5,-448 1203.5,-448 1203.5,-448 1057.5,-448 1057.5,-448 1051.5,-448 1045.5,-442 1045.5,-436 1045.5,-436 1045.5,-414 1045.5,-414 1045.5,-408 1051.5,-402 1057.5,-402"/>
<text text-anchor="middle" x="1130.5" y="-432.8" font-family="Times,serif" font-size="14.00" fill="#40575d">RaftCore__election_elapsed</text>
<polyline fill="none" stroke="#f7e495" points="1045.5,-425 1215.5,-425 "/>
<text text-anchor="start" x="1053.5" y="-409.8" font-family="Times,serif" font-size="14.00" fill="#40575d">将election_elapse重置为0</text>
</g>
<!-- RaftCore__step_follower&#45;&gt;RaftCore__election_elapsed -->
<g id="edge7" class="edge">
<title>RaftCore__step_follower&#45;&gt;RaftCore__election_elapsed</title>
<path fill="none" stroke="#666666" d="M344.48,-212.15C392.42,-255.48 521.79,-364.43 653,-406 780.68,-446.45 937.28,-443.37 1035.25,-435.61"/>
<polygon fill="#666666" stroke="#666666" points="1035.75,-439.08 1045.43,-434.77 1035.18,-432.11 1035.75,-439.08"/>
</g>
<!-- RaftCore__reset -->
<g id="node11" class="node">
<title>RaftCore__reset</title>
<path fill="none" stroke="#1c2123" d="M739.5,-36C739.5,-36 870.5,-36 870.5,-36 876.5,-36 882.5,-42 882.5,-48 882.5,-48 882.5,-70 882.5,-70 882.5,-76 876.5,-82 870.5,-82 870.5,-82 739.5,-82 739.5,-82 733.5,-82 727.5,-76 727.5,-70 727.5,-70 727.5,-48 727.5,-48 727.5,-42 733.5,-36 739.5,-36"/>
<text text-anchor="middle" x="805" y="-66.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__reset</text>
<polyline fill="none" stroke="#1c2123" points="727.5,-59 882.5,-59 "/>
<text text-anchor="start" x="735.5" y="-43.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.vote = INVALID_ID</text>
</g>
<!-- RaftCore__become_follower&#45;&gt;RaftCore__reset -->
<g id="edge12" class="edge">
<title>RaftCore__become_follower&#45;&gt;RaftCore__reset</title>
<path fill="none" stroke="#666666" d="M616.35,-61.05C648.53,-60.7 684.99,-60.3 717.16,-59.95"/>
<polygon fill="#666666" stroke="#666666" points="717.48,-63.45 727.45,-59.84 717.41,-56.45 717.48,-63.45"/>
</g>
<!-- RaftLog__commit_to -->
<g id="node7" class="node">
<title>RaftLog__commit_to</title>
<path fill="none" stroke="#1c2123" d="M860.5,-397C860.5,-397 749.5,-397 749.5,-397 743.5,-397 737.5,-391 737.5,-385 737.5,-385 737.5,-373 737.5,-373 737.5,-367 743.5,-361 749.5,-361 749.5,-361 860.5,-361 860.5,-361 866.5,-361 872.5,-367 872.5,-373 872.5,-373 872.5,-385 872.5,-385 872.5,-391 866.5,-397 860.5,-397"/>
<text text-anchor="middle" x="805" y="-375.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__commit_to</text>
</g>
<!-- RaftCore__handle_heartbeat&#45;&gt;RaftLog__commit_to -->
<g id="edge8" class="edge">
<title>RaftCore__handle_heartbeat&#45;&gt;RaftLog__commit_to</title>
<path fill="none" stroke="#666666" d="M538.06,-212.22C554.9,-245.88 595.74,-317.51 653,-352 675.05,-365.28 701.99,-372.39 726.97,-376.08"/>
<polygon fill="#666666" stroke="#666666" points="726.79,-379.59 737.16,-377.42 727.71,-372.65 726.79,-379.59"/>
</g>
<!-- RaftCore__send_request_snapshot -->
<g id="node8" class="node">
<title>RaftCore__send_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M665,-251.5C665,-251.5 945,-251.5 945,-251.5 951,-251.5 957,-257.5 957,-263.5 957,-263.5 957,-330.5 957,-330.5 957,-336.5 951,-342.5 945,-342.5 945,-342.5 665,-342.5 665,-342.5 659,-342.5 653,-336.5 653,-330.5 653,-330.5 653,-263.5 653,-263.5 653,-257.5 659,-251.5 665,-251.5"/>
<text text-anchor="middle" x="805" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_request_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="653,-319.5 957,-319.5 "/>
<text text-anchor="start" x="661" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送MsgAppendResponse 消息</text>
<text text-anchor="start" x="661" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> m.reject = true</text>
<text text-anchor="start" x="661" y="-274.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> m.reject_hint = self.raft_log.last_index</text>
<text text-anchor="start" x="661" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> m.reuest_snapshot = self.pending_request_snapshot</text>
</g>
<!-- RaftCore__handle_heartbeat&#45;&gt;RaftCore__send_request_snapshot -->
<g id="edge9" class="edge">
<title>RaftCore__handle_heartbeat&#45;&gt;RaftCore__send_request_snapshot</title>
<path fill="none" stroke="#666666" d="M575.16,-212.01C598.41,-221.12 627.17,-232.28 653,-242 658.14,-243.93 663.38,-245.9 668.68,-247.87"/>
<polygon fill="#666666" stroke="#666666" points="667.68,-251.23 678.27,-251.44 670.12,-244.67 667.68,-251.23"/>
</g>
<!-- RaftCore__pending_request_snapshot -->
<g id="node9" class="node">
<title>RaftCore__pending_request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M904.5,-137C904.5,-137 705.5,-137 705.5,-137 699.5,-137 693.5,-131 693.5,-125 693.5,-125 693.5,-113 693.5,-113 693.5,-107 699.5,-101 705.5,-101 705.5,-101 904.5,-101 904.5,-101 910.5,-101 916.5,-107 916.5,-113 916.5,-113 916.5,-125 916.5,-125 916.5,-131 910.5,-137 904.5,-137"/>
<text text-anchor="middle" x="805" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__pending_request_snapshot</text>
</g>
<!-- RaftCore__handle_heartbeat&#45;&gt;RaftCore__pending_request_snapshot -->
<g id="edge10" class="edge">
<title>RaftCore__handle_heartbeat&#45;&gt;RaftCore__pending_request_snapshot</title>
<path fill="none" stroke="#666666" d="M585.39,-175.87C595.97,-172.15 606.88,-168.11 617,-164 633.39,-157.34 636.16,-152.44 653,-147 662.81,-143.83 673.09,-140.99 683.49,-138.43"/>
<polygon fill="#666666" stroke="#666666" points="684.56,-141.78 693.48,-136.07 682.95,-134.96 684.56,-141.78"/>
</g>
<!-- RaftCore__send -->
<g id="node10" class="node">
<title>RaftCore__send</title>
<path fill="none" stroke="#1c2123" d="M713,-156C713,-156 897,-156 897,-156 903,-156 909,-162 909,-168 909,-168 909,-220 909,-220 909,-226 903,-232 897,-232 897,-232 713,-232 713,-232 707,-232 701,-226 701,-220 701,-220 701,-168 701,-168 701,-162 707,-156 713,-156"/>
<text text-anchor="middle" x="805" y="-216.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send</text>
<polyline fill="none" stroke="#1c2123" points="701,-209 909,-209 "/>
<text text-anchor="start" x="709" y="-193.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送MsgHeartbeatResponse</text>
<text text-anchor="start" x="709" y="-178.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> context = m.take_context</text>
<text text-anchor="start" x="709" y="-163.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit = self.raft_log.committed</text>
</g>
<!-- RaftCore__handle_heartbeat&#45;&gt;RaftCore__send -->
<g id="edge11" class="edge">
<title>RaftCore__handle_heartbeat&#45;&gt;RaftCore__send</title>
<path fill="none" stroke="#666666" d="M614.85,-194C638.89,-194 665.41,-194 690.81,-194"/>
<polygon fill="#666666" stroke="#666666" points="690.85,-197.5 700.85,-194 690.85,-190.5 690.85,-197.5"/>
</g>
<!-- RaftLog__comitted -->
<g id="node14" class="node">
<title>RaftLog__comitted</title>
<path fill="#feed9b" stroke="#f7e495" d="M1079,-337C1079,-337 1182,-337 1182,-337 1188,-337 1194,-343 1194,-349 1194,-349 1194,-371 1194,-371 1194,-377 1188,-383 1182,-383 1182,-383 1079,-383 1079,-383 1073,-383 1067,-377 1067,-371 1067,-371 1067,-349 1067,-349 1067,-343 1073,-337 1079,-337"/>
<text text-anchor="middle" x="1130.5" y="-367.8" font-family="Times,serif" font-size="14.00" fill="#40575d">RaftLog__comitted</text>
<polyline fill="none" stroke="#f7e495" points="1067,-360 1194,-360 "/>
<text text-anchor="start" x="1075" y="-344.8" font-family="Times,serif" font-size="14.00" fill="#40575d">设置comitted index</text>
</g>
<!-- RaftLog__commit_to&#45;&gt;RaftLog__comitted -->
<g id="edge16" class="edge">
<title>RaftLog__commit_to&#45;&gt;RaftLog__comitted</title>
<path fill="none" stroke="#666666" d="M872.64,-375.09C926.27,-371.94 1001.53,-367.52 1056.73,-364.27"/>
<polygon fill="#666666" stroke="#666666" points="1057.02,-367.76 1066.79,-363.68 1056.61,-360.78 1057.02,-367.76"/>
</g>
<!-- RaftCore__reset&#45;&gt;RaftCore__election_elapsed -->
<g id="edge13" class="edge">
<title>RaftCore__reset&#45;&gt;RaftCore__election_elapsed</title>
<path fill="none" stroke="#666666" d="M882.64,-58.24C909.8,-62.02 938.24,-71.34 957,-92 1047.58,-191.74 903.17,-292.58 993,-393 1004.15,-405.47 1019.16,-413.55 1035.14,-418.7"/>
<polygon fill="#666666" stroke="#666666" points="1034.62,-422.19 1045.19,-421.54 1036.52,-415.45 1034.62,-422.19"/>
</g>
<!-- RaftCore__hearbeat_elapsed -->
<g id="node12" class="node">
<title>RaftCore__hearbeat_elapsed</title>
<path fill="none" stroke="#1c2123" d="M1205,-36C1205,-36 1056,-36 1056,-36 1050,-36 1044,-30 1044,-24 1044,-24 1044,-12 1044,-12 1044,-6 1050,0 1056,0 1056,0 1205,0 1205,0 1211,0 1217,-6 1217,-12 1217,-12 1217,-24 1217,-24 1217,-30 1211,-36 1205,-36"/>
<text text-anchor="middle" x="1130.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__hearbeat_elapsed</text>
</g>
<!-- RaftCore__reset&#45;&gt;RaftCore__hearbeat_elapsed -->
<g id="edge14" class="edge">
<title>RaftCore__reset&#45;&gt;RaftCore__hearbeat_elapsed</title>
<path fill="none" stroke="#666666" d="M882.66,-49.28C927.93,-43.55 985.62,-36.23 1033.85,-30.12"/>
<polygon fill="#666666" stroke="#666666" points="1034.51,-33.57 1043.99,-28.84 1033.63,-26.62 1034.51,-33.57"/>
</g>
<!-- RaftCore__reset_randomized_election_timeout -->
<g id="node13" class="node">
<title>RaftCore__reset_randomized_election_timeout</title>
<path fill="none" stroke="#1c2123" d="M1005,-54.5C1005,-54.5 1256,-54.5 1256,-54.5 1262,-54.5 1268,-60.5 1268,-66.5 1268,-66.5 1268,-133.5 1268,-133.5 1268,-139.5 1262,-145.5 1256,-145.5 1256,-145.5 1005,-145.5 1005,-145.5 999,-145.5 993,-139.5 993,-133.5 993,-133.5 993,-66.5 993,-66.5 993,-60.5 999,-54.5 1005,-54.5"/>
<text text-anchor="middle" x="1130.5" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__reset_randomized_election_timeout</text>
<polyline fill="none" stroke="#1c2123" points="993,-122.5 1268,-122.5 "/>
<text text-anchor="start" x="1001" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">randomized_election_timeout为</text>
<text text-anchor="start" x="1001" y="-92.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> min_election_timeout 和</text>
<text text-anchor="start" x="1001" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> max_election_timeout</text>
<text text-anchor="start" x="1001" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 之间的随机值</text>
</g>
<!-- RaftCore__reset&#45;&gt;RaftCore__reset_randomized_election_timeout -->
<g id="edge15" class="edge">
<title>RaftCore__reset&#45;&gt;RaftCore__reset_randomized_election_timeout</title>
<path fill="none" stroke="#666666" d="M882.66,-68.72C912.68,-72.52 948.16,-77.02 982.72,-81.4"/>
<polygon fill="#666666" stroke="#666666" points="982.56,-84.9 992.92,-82.69 983.44,-77.96 982.56,-84.9"/>
</g>
<!-- RawNode__request_snapshot -->
<g id="node15" class="node">
<title>RawNode__request_snapshot</title>
<path fill="none" stroke="#1c2123" d="M605,-155C605,-155 452,-155 452,-155 446,-155 440,-149 440,-143 440,-143 440,-131 440,-131 440,-125 446,-119 452,-119 452,-119 605,-119 605,-119 611,-119 617,-125 617,-131 617,-131 617,-143 617,-143 617,-149 611,-155 605,-155"/>
<text text-anchor="middle" x="528.5" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode__request_snapshot</text>
</g>
<!-- RawNode__request_snapshot&#45;&gt;RaftCore__pending_request_snapshot -->
<g id="edge17" class="edge">
<title>RawNode__request_snapshot&#45;&gt;RaftCore__pending_request_snapshot</title>
<path fill="none" stroke="#666666" d="M617.11,-131.26C638.06,-129.88 660.8,-128.39 682.97,-126.94"/>
<polygon fill="#666666" stroke="#666666" points="683.35,-130.42 693.1,-126.27 682.89,-123.43 683.35,-130.42"/>
</g>
</g>
</svg>
