<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_handle_append_response Pages: 1 -->
<svg width="1049pt" height="541pt"
 viewBox="0.00 0.00 1049.00 541.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 537)">
<title>raft_handle_append_response</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-537 1045,-537 1045,4 -4,4"/>
<!-- RaftCore__handle_append_response -->
<g id="node1" class="node">
<title>RaftCore__handle_append_response</title>
<path fill="none" stroke="#1c2123" d="M203,-334C203,-334 12,-334 12,-334 6,-334 0,-328 0,-322 0,-322 0,-310 0,-310 0,-304 6,-298 12,-298 12,-298 203,-298 203,-298 209,-298 215,-304 215,-310 215,-310 215,-322 215,-322 215,-328 209,-334 203,-334"/>
<text text-anchor="middle" x="107.5" y="-312.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_append_response</text>
</g>
<!-- Progress__update_committed -->
<g id="node2" class="node">
<title>Progress__update_committed</title>
<path fill="none" stroke="#1c2123" d="M444.5,-533C444.5,-533 289.5,-533 289.5,-533 283.5,-533 277.5,-527 277.5,-521 277.5,-521 277.5,-509 277.5,-509 277.5,-503 283.5,-497 289.5,-497 289.5,-497 444.5,-497 444.5,-497 450.5,-497 456.5,-503 456.5,-509 456.5,-509 456.5,-521 456.5,-521 456.5,-527 450.5,-533 444.5,-533"/>
<text text-anchor="middle" x="367" y="-511.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__update_committed</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__update_committed -->
<g id="edge1" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__update_committed</title>
<path fill="none" stroke="#666666" d="M118.12,-334.13C137.94,-369.63 186.89,-448.27 251,-488 256.32,-491.3 262.01,-494.19 267.89,-496.73"/>
<polygon fill="#666666" stroke="#666666" points="266.7,-500.02 277.29,-500.44 269.27,-493.51 266.7,-500.02"/>
</g>
<!-- Progress__maybe_decr_to -->
<g id="node3" class="node">
<title>Progress__maybe_decr_to</title>
<path fill="none" stroke="#1c2123" d="M298.5,-417.5C298.5,-417.5 435.5,-417.5 435.5,-417.5 441.5,-417.5 447.5,-423.5 447.5,-429.5 447.5,-429.5 447.5,-466.5 447.5,-466.5 447.5,-472.5 441.5,-478.5 435.5,-478.5 435.5,-478.5 298.5,-478.5 298.5,-478.5 292.5,-478.5 286.5,-472.5 286.5,-466.5 286.5,-466.5 286.5,-429.5 286.5,-429.5 286.5,-423.5 292.5,-417.5 298.5,-417.5"/>
<text text-anchor="middle" x="367" y="-463.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__maybe_decr_to</text>
<polyline fill="none" stroke="#1c2123" points="286.5,-455.5 447.5,-455.5 "/>
<text text-anchor="start" x="294.5" y="-440.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">重新调整发送给</text>
<text text-anchor="start" x="294.5" y="-425.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower的next_idx</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__maybe_decr_to -->
<g id="edge2" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__maybe_decr_to</title>
<path fill="none" stroke="#666666" d="M135.01,-334.13C163.04,-352.83 208.94,-382.13 251,-403 259.34,-407.14 268.16,-411.17 277.05,-415"/>
<polygon fill="#666666" stroke="#666666" points="275.76,-418.26 286.33,-418.93 278.49,-411.81 275.76,-418.26"/>
</g>
<!-- RaftCore__send_append -->
<g id="node4" class="node">
<title>RaftCore__send_append</title>
<path fill="none" stroke="#1c2123" d="M969,-350C969,-350 843,-350 843,-350 837,-350 831,-344 831,-338 831,-338 831,-326 831,-326 831,-320 837,-314 843,-314 843,-314 969,-314 969,-314 975,-314 981,-320 981,-326 981,-326 981,-338 981,-338 981,-344 975,-350 969,-350"/>
<text text-anchor="middle" x="906" y="-328.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_append</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__send_append -->
<g id="edge3" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__send_append</title>
<path fill="none" stroke="#666666" d="M194.26,-334.02C315.05,-356.98 542.12,-391.29 735,-370 766.6,-366.51 800.91,-359.48 830.38,-352.41"/>
<polygon fill="#666666" stroke="#666666" points="831.29,-355.78 840.18,-350.01 829.63,-348.99 831.29,-355.78"/>
</g>
<!-- Progress__maybe_update -->
<g id="node5" class="node">
<title>Progress__maybe_update</title>
<path fill="none" stroke="#1c2123" d="M287,-120.5C287,-120.5 447,-120.5 447,-120.5 453,-120.5 459,-126.5 459,-132.5 459,-132.5 459,-169.5 459,-169.5 459,-175.5 453,-181.5 447,-181.5 447,-181.5 287,-181.5 287,-181.5 281,-181.5 275,-175.5 275,-169.5 275,-169.5 275,-132.5 275,-132.5 275,-126.5 281,-120.5 287,-120.5"/>
<text text-anchor="middle" x="367" y="-166.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__maybe_update</text>
<polyline fill="none" stroke="#1c2123" points="275,-158.5 459,-158.5 "/>
<text text-anchor="start" x="283" y="-143.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用AppendRespMsg的index</text>
<text text-anchor="start" x="283" y="-128.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新Progress__matched</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__maybe_update -->
<g id="edge4" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__maybe_update</title>
<path fill="none" stroke="#666666" d="M125.25,-297.58C150.3,-271 200.05,-221.81 251,-192 255.69,-189.26 260.59,-186.65 265.62,-184.19"/>
<polygon fill="#666666" stroke="#666666" points="267.21,-187.31 274.78,-179.9 264.24,-180.97 267.21,-187.31"/>
</g>
<!-- RaftCore__maybe_commit -->
<g id="node6" class="node">
<title>RaftCore__maybe_commit</title>
<path fill="none" stroke="#1c2123" d="M288,-266C288,-266 446,-266 446,-266 452,-266 458,-272 458,-278 458,-278 458,-300 458,-300 458,-306 452,-312 446,-312 446,-312 288,-312 288,-312 282,-312 276,-306 276,-300 276,-300 276,-278 276,-278 276,-272 282,-266 288,-266"/>
<text text-anchor="middle" x="367" y="-296.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__maybe_commit</text>
<polyline fill="none" stroke="#1c2123" points="276,-289 458,-289 "/>
<text text-anchor="start" x="284" y="-273.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">计算可以commit的log index</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_commit -->
<g id="edge5" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_commit</title>
<path fill="none" stroke="#666666" d="M215.09,-304.82C231.82,-303.07 249.07,-301.26 265.65,-299.52"/>
<polygon fill="#666666" stroke="#666666" points="266.29,-302.97 275.88,-298.45 265.56,-296.01 266.29,-302.97"/>
</g>
<!-- RaftCore__should_bcast_commit -->
<g id="node7" class="node">
<title>RaftCore__should_bcast_commit</title>
<path fill="none" stroke="#1c2123" d="M715,-361C715,-361 539,-361 539,-361 533,-361 527,-355 527,-349 527,-349 527,-337 527,-337 527,-331 533,-325 539,-325 539,-325 715,-325 715,-325 721,-325 727,-331 727,-337 727,-337 727,-349 727,-349 727,-355 721,-361 715,-361"/>
<text text-anchor="middle" x="627" y="-339.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__should_bcast_commit</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__should_bcast_commit -->
<g id="edge6" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__should_bcast_commit</title>
<path fill="none" stroke="#666666" d="M215.1,-321.56C303.28,-326.16 428.01,-332.67 516.88,-337.31"/>
<polygon fill="#666666" stroke="#666666" points="516.82,-340.81 526.99,-337.83 517.19,-333.82 516.82,-340.81"/>
</g>
<!-- RaftCore__maybe_send_append -->
<g id="node8" class="node">
<title>RaftCore__maybe_send_append</title>
<path fill="none" stroke="#1c2123" d="M263,-55C263,-55 471,-55 471,-55 477,-55 483,-61 483,-67 483,-67 483,-89 483,-89 483,-95 477,-101 471,-101 471,-101 263,-101 263,-101 257,-101 251,-95 251,-89 251,-89 251,-67 251,-67 251,-61 257,-55 263,-55"/>
<text text-anchor="middle" x="367" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__maybe_send_append</text>
<polyline fill="none" stroke="#1c2123" points="251,-78 483,-78 "/>
<text text-anchor="start" x="259" y="-62.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送多个inflight appendmsg给follwer</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_send_append -->
<g id="edge7" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_send_append</title>
<path fill="none" stroke="#666666" d="M115.99,-297.81C133.43,-257.72 180.69,-161.34 251,-111 253.41,-109.27 255.92,-107.63 258.49,-106.08"/>
<polygon fill="#666666" stroke="#666666" points="260.43,-109.01 267.5,-101.12 257.05,-102.88 260.43,-109.01"/>
</g>
<!-- RaftCore__send_timeout_now -->
<g id="node9" class="node">
<title>RaftCore__send_timeout_now</title>
<path fill="none" stroke="#1c2123" d="M446.5,-36C446.5,-36 287.5,-36 287.5,-36 281.5,-36 275.5,-30 275.5,-24 275.5,-24 275.5,-12 275.5,-12 275.5,-6 281.5,0 287.5,0 287.5,0 446.5,0 446.5,0 452.5,0 458.5,-6 458.5,-12 458.5,-12 458.5,-24 458.5,-24 458.5,-30 452.5,-36 446.5,-36"/>
<text text-anchor="middle" x="367" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_timeout_now</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__send_timeout_now -->
<g id="edge8" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__send_timeout_now</title>
<path fill="none" stroke="#666666" d="M112.51,-297.77C124.33,-248.62 163.77,-112.51 251,-45 255.68,-41.38 260.76,-38.24 266.09,-35.5"/>
<polygon fill="#666666" stroke="#666666" points="267.66,-38.63 275.28,-31.28 264.74,-32.27 267.66,-38.63"/>
</g>
<!-- Progress__next_idx -->
<g id="node15" class="node">
<title>Progress__next_idx</title>
<path fill="none" stroke="#1c2123" d="M677,-466C677,-466 577,-466 577,-466 571,-466 565,-460 565,-454 565,-454 565,-442 565,-442 565,-436 571,-430 577,-430 577,-430 677,-430 677,-430 683,-430 689,-436 689,-442 689,-442 689,-454 689,-454 689,-460 683,-466 677,-466"/>
<text text-anchor="middle" x="627" y="-444.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__next_idx</text>
</g>
<!-- Progress__maybe_decr_to&#45;&gt;Progress__next_idx -->
<g id="edge17" class="edge">
<title>Progress__maybe_decr_to&#45;&gt;Progress__next_idx</title>
<path fill="none" stroke="#666666" d="M447.51,-448C481.73,-448 521.42,-448 554.67,-448"/>
<polygon fill="#666666" stroke="#666666" points="554.77,-451.5 564.77,-448 554.77,-444.5 554.77,-451.5"/>
</g>
<!-- Progress__matched -->
<g id="node14" class="node">
<title>Progress__matched</title>
<path fill="#feed9b" stroke="#f7e495" d="M569,-73.5C569,-73.5 685,-73.5 685,-73.5 691,-73.5 697,-79.5 697,-85.5 697,-85.5 697,-122.5 697,-122.5 697,-128.5 691,-134.5 685,-134.5 685,-134.5 569,-134.5 569,-134.5 563,-134.5 557,-128.5 557,-122.5 557,-122.5 557,-85.5 557,-85.5 557,-79.5 563,-73.5 569,-73.5"/>
<text text-anchor="middle" x="627" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Progress__matched</text>
<polyline fill="none" stroke="#f7e495" points="557,-111.5 697,-111.5 "/>
<text text-anchor="start" x="565" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#40575d">peer已经持久化存储</text>
<text text-anchor="start" x="565" y="-81.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 的日志index</text>
</g>
<!-- Progress__maybe_update&#45;&gt;Progress__matched -->
<g id="edge16" class="edge">
<title>Progress__maybe_update&#45;&gt;Progress__matched</title>
<path fill="none" stroke="#666666" d="M459.32,-134.36C487.86,-129.17 519.08,-123.48 546.72,-118.44"/>
<polygon fill="#666666" stroke="#666666" points="547.51,-121.86 556.72,-116.62 546.26,-114.97 547.51,-121.86"/>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftCore__should_bcast_commit -->
<g id="edge11" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftCore__should_bcast_commit</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M458.24,-307.89C481.38,-312.73 506.35,-317.96 529.78,-322.86"/>
<polygon fill="green" stroke="green" points="529.21,-326.32 539.72,-324.94 530.65,-319.47 529.21,-326.32"/>
</g>
<!-- RaftLog__maybe_commit -->
<g id="node10" class="node">
<title>RaftLog__maybe_commit</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M531,-153.5C531,-153.5 723,-153.5 723,-153.5 729,-153.5 735,-159.5 735,-165.5 735,-165.5 735,-202.5 735,-202.5 735,-208.5 729,-214.5 723,-214.5 723,-214.5 531,-214.5 531,-214.5 525,-214.5 519,-208.5 519,-202.5 519,-202.5 519,-165.5 519,-165.5 519,-159.5 525,-153.5 531,-153.5"/>
<text text-anchor="middle" x="627" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RraftLog__maybe_commit</text>
<polyline fill="none" stroke="#8a8898" points="519,-191.5 735,-191.5 "/>
<text text-anchor="start" x="527" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">只有当前leader自己term任期</text>
<text text-anchor="start" x="527" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 内的Log entry才能安全的commit</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftLog__maybe_commit -->
<g id="edge9" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftLog__maybe_commit</title>
<path fill="none" stroke="#666666" d="M458.13,-267.61C466.71,-264.49 475.13,-260.96 483,-257 501.11,-247.89 501.51,-239.24 519,-229 524.84,-225.58 530.99,-222.28 537.27,-219.13"/>
<polygon fill="#666666" stroke="#666666" points="539.08,-222.15 546.54,-214.63 536.02,-215.85 539.08,-222.15"/>
</g>
<!-- ProgressTracker__maximal_committed_index -->
<g id="node11" class="node">
<title>ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="#1c2123" d="M783,-153.5C783,-153.5 1029,-153.5 1029,-153.5 1035,-153.5 1041,-159.5 1041,-165.5 1041,-165.5 1041,-232.5 1041,-232.5 1041,-238.5 1035,-244.5 1029,-244.5 1029,-244.5 783,-244.5 783,-244.5 777,-244.5 771,-238.5 771,-232.5 771,-232.5 771,-165.5 771,-165.5 771,-159.5 777,-153.5 783,-153.5"/>
<text text-anchor="middle" x="906" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ProgressTracker__maximal_committed_index</text>
<polyline fill="none" stroke="#1c2123" points="771,-221.5 1041,-221.5 "/>
<text text-anchor="start" x="779" y="-206.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">计算已经复制到大部分</text>
<text text-anchor="start" x="779" y="-191.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> peer的log entry index</text>
<text text-anchor="start" x="779" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会使用所有的voters的Progress::matched</text>
<text text-anchor="start" x="779" y="-161.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来计算commit index</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;ProgressTracker__maximal_committed_index -->
<g id="edge10" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="#666666" d="M458.19,-272.64C478.2,-269.08 499.31,-265.37 519,-262 598.9,-248.34 688.23,-233.72 760.81,-222"/>
<polygon fill="#666666" stroke="#666666" points="761.62,-225.42 770.94,-220.37 760.51,-218.51 761.62,-225.42"/>
</g>
<!-- RaftCore__bcast_append -->
<g id="node12" class="node">
<title>RaftCore__bcast_append</title>
<path fill="none" stroke="#1c2123" d="M691.5,-307C691.5,-307 562.5,-307 562.5,-307 556.5,-307 550.5,-301 550.5,-295 550.5,-295 550.5,-283 550.5,-283 550.5,-277 556.5,-271 562.5,-271 562.5,-271 691.5,-271 691.5,-271 697.5,-271 703.5,-277 703.5,-283 703.5,-283 703.5,-295 703.5,-295 703.5,-301 697.5,-307 691.5,-307"/>
<text text-anchor="middle" x="627" y="-285.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__bcast_append</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftCore__bcast_append -->
<g id="edge12" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftCore__bcast_append</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M458.24,-289C484.79,-289 513.76,-289 540.04,-289"/>
<polygon fill="green" stroke="green" points="540.35,-292.5 550.35,-289 540.35,-285.5 540.35,-292.5"/>
</g>
<!-- RaftCore__bcast_append&#45;&gt;RaftCore__send_append -->
<g id="edge13" class="edge">
<title>RaftCore__bcast_append&#45;&gt;RaftCore__send_append</title>
<path fill="none" stroke="#666666" d="M703.69,-300.75C739.86,-306.36 783.27,-313.1 820.51,-318.88"/>
<polygon fill="#666666" stroke="#666666" points="820.42,-322.41 830.84,-320.49 821.49,-315.49 820.42,-322.41"/>
</g>
<!-- RaftCore__term -->
<g id="node13" class="node">
<title>RaftCore__term</title>
<path fill="#feed9b" stroke="#f7e495" d="M306,-201C306,-201 428,-201 428,-201 434,-201 440,-207 440,-213 440,-213 440,-235 440,-235 440,-241 434,-247 428,-247 428,-247 306,-247 306,-247 300,-247 294,-241 294,-235 294,-235 294,-213 294,-213 294,-207 300,-201 306,-201"/>
<text text-anchor="middle" x="367" y="-231.8" font-family="Times,serif" font-size="14.00" fill="#40575d">RaftCore__term</text>
<polyline fill="none" stroke="#f7e495" points="294,-224 440,-224 "/>
<text text-anchor="start" x="302" y="-208.8" font-family="Times,serif" font-size="14.00" fill="#40575d">当前leader的term任期</text>
</g>
<!-- RaftCore__term&#45;&gt;RaftLog__maybe_commit -->
<g id="edge14" class="edge">
<title>RaftCore__term&#45;&gt;RaftLog__maybe_commit</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M440.21,-212.8C461.47,-209.51 485.31,-205.81 508.63,-202.2"/>
<polygon fill="green" stroke="green" points="509.24,-205.64 518.58,-200.65 508.16,-198.73 509.24,-205.64"/>
</g>
<!-- Progress__matched&#45;&gt;ProgressTracker__maximal_committed_index -->
<g id="edge15" class="edge">
<title>Progress__matched&#45;&gt;ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M697.18,-127.73C717.16,-134.58 739.74,-142.32 762.46,-150.11"/>
<polygon fill="green" stroke="green" points="761.6,-153.52 772.2,-153.45 763.87,-146.9 761.6,-153.52"/>
</g>
</g>
</svg>
