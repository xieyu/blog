<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_hearbeat Pages: 1 -->
<svg width="1344pt" height="354pt"
 viewBox="0.00 0.00 1344.00 354.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 350)">
<title>raft_hearbeat</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-350 1340,-350 1340,4 -4,4"/>
<!-- RaftCore__bcast_hearbeat -->
<g id="node1" class="node">
<title>RaftCore__bcast_hearbeat</title>
<path fill="none" stroke="#1c2123" d="M325,-131C325,-131 189,-131 189,-131 183,-131 177,-125 177,-119 177,-119 177,-107 177,-107 177,-101 183,-95 189,-95 189,-95 325,-95 325,-95 331,-95 337,-101 337,-107 337,-107 337,-119 337,-119 337,-125 331,-131 325,-131"/>
<text text-anchor="middle" x="257" y="-109.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__bcast_hearbeat</text>
</g>
<!-- ReadOnly__last_pending_request_ctx -->
<g id="node2" class="node">
<title>ReadOnly__last_pending_request_ctx</title>
<path fill="none" stroke="#1c2123" d="M847,-68C847,-68 648,-68 648,-68 642,-68 636,-62 636,-56 636,-56 636,-44 636,-44 636,-38 642,-32 648,-32 648,-32 847,-32 847,-32 853,-32 859,-38 859,-44 859,-44 859,-56 859,-56 859,-62 853,-68 847,-68"/>
<text text-anchor="middle" x="747.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadOnly__last_pending_request_ctx</text>
</g>
<!-- RaftCore__bcast_hearbeat&#45;&gt;ReadOnly__last_pending_request_ctx -->
<g id="edge1" class="edge">
<title>RaftCore__bcast_hearbeat&#45;&gt;ReadOnly__last_pending_request_ctx</title>
<path fill="none" stroke="#666666" d="M337.03,-102.81C415.11,-92.74 535.6,-77.2 625.69,-65.58"/>
<polygon fill="#666666" stroke="#666666" points="626.22,-69.04 635.69,-64.29 625.33,-62.1 626.22,-69.04"/>
</g>
<!-- RaftCore__bcast_hearbeat_with_ctx -->
<g id="node3" class="node">
<title>RaftCore__bcast_hearbeat_with_ctx</title>
<path fill="none" stroke="#1c2123" d="M385,-117C385,-117 588,-117 588,-117 594,-117 600,-123 600,-129 600,-129 600,-181 600,-181 600,-187 594,-193 588,-193 588,-193 385,-193 385,-193 379,-193 373,-187 373,-181 373,-181 373,-129 373,-129 373,-123 379,-117 385,-117"/>
<text text-anchor="middle" x="486.5" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__bcast_hearbeat_with_ctx</text>
<polyline fill="none" stroke="#1c2123" points="373,-170 600,-170 "/>
<text text-anchor="start" x="381" y="-154.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历所有的prs</text>
<text text-anchor="start" x="381" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 给每个peers发送心跳</text>
<text text-anchor="start" x="381" y="-124.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 心跳信息中包含了committed index</text>
</g>
<!-- RaftCore__bcast_hearbeat&#45;&gt;RaftCore__bcast_hearbeat_with_ctx -->
<g id="edge2" class="edge">
<title>RaftCore__bcast_hearbeat&#45;&gt;RaftCore__bcast_hearbeat_with_ctx</title>
<path fill="none" stroke="#666666" d="M337.25,-127.63C345.63,-129.18 354.3,-130.78 363.03,-132.39"/>
<polygon fill="#666666" stroke="#666666" points="362.43,-135.84 372.9,-134.21 363.7,-128.96 362.43,-135.84"/>
</g>
<!-- Message -->
<g id="node10" class="node">
<title>Message</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1167,-0.5C1167,-0.5 1324,-0.5 1324,-0.5 1330,-0.5 1336,-6.5 1336,-12.5 1336,-12.5 1336,-333.5 1336,-333.5 1336,-339.5 1330,-345.5 1324,-345.5 1324,-345.5 1167,-345.5 1167,-345.5 1161,-345.5 1155,-339.5 1155,-333.5 1155,-333.5 1155,-12.5 1155,-12.5 1155,-6.5 1161,-0.5 1167,-0.5"/>
<text text-anchor="middle" x="1245.5" y="-330.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Message</text>
<polyline fill="none" stroke="#8a8898" points="1155,-322.5 1336,-322.5 "/>
<text text-anchor="start" x="1163" y="-307.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MessageType msg_type = 1;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-299.5 1336,-299.5 "/>
<text text-anchor="start" x="1163" y="-284.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 to = 2;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-276.5 1336,-276.5 "/>
<text text-anchor="start" x="1163" y="-261.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 from = 3;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-253.5 1336,-253.5 "/>
<text text-anchor="start" x="1163" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 term = 4;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-230.5 1336,-230.5 "/>
<text text-anchor="start" x="1163" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 log_term = 5;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-207.5 1336,-207.5 "/>
<text text-anchor="start" x="1163" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 index = 6;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-184.5 1336,-184.5 "/>
<text text-anchor="start" x="1163" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">repeated Entry entries = 7;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-161.5 1336,-161.5 "/>
<text text-anchor="start" x="1163" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 commit = 8;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-138.5 1336,-138.5 "/>
<text text-anchor="start" x="1163" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Snapshot snapshot = 9;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-115.5 1336,-115.5 "/>
<text text-anchor="start" x="1163" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 request_snapshot = 13;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-92.5 1336,-92.5 "/>
<text text-anchor="start" x="1163" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">bool reject = 10;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-69.5 1336,-69.5 "/>
<text text-anchor="start" x="1163" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 reject_hint = 11;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-46.5 1336,-46.5 "/>
<text text-anchor="start" x="1163" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">bytes context = 12;</text>
<polyline fill="none" stroke="#8a8898" points="1155,-23.5 1336,-23.5 "/>
<text text-anchor="start" x="1163" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 priority = 14;</text>
</g>
<!-- ReadOnly__last_pending_request_ctx&#45;&gt;Message -->
<g id="edge9" class="edge">
<title>ReadOnly__last_pending_request_ctx&#45;&gt;Message:context</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M859.31,-43.7C938.3,-39.74 1047.37,-35.3 1144.98,-35.02"/>
<polygon fill="green" stroke="green" points="1145.01,-38.52 1155,-35 1144.99,-31.52 1145.01,-38.52"/>
</g>
<!-- RaftCore__send_heartbeat -->
<g id="node4" class="node">
<title>RaftCore__send_heartbeat</title>
<path fill="none" stroke="#1c2123" d="M816,-177C816,-177 679,-177 679,-177 673,-177 667,-171 667,-165 667,-165 667,-153 667,-153 667,-147 673,-141 679,-141 679,-141 816,-141 816,-141 822,-141 828,-147 828,-153 828,-153 828,-165 828,-165 828,-171 822,-177 816,-177"/>
<text text-anchor="middle" x="747.5" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_heartbeat</text>
</g>
<!-- RaftCore__bcast_hearbeat_with_ctx&#45;&gt;RaftCore__send_heartbeat -->
<g id="edge3" class="edge">
<title>RaftCore__bcast_hearbeat_with_ctx&#45;&gt;RaftCore__send_heartbeat</title>
<path fill="none" stroke="#666666" d="M600.35,-156.74C619.12,-157.03 638.37,-157.33 656.49,-157.61"/>
<polygon fill="#666666" stroke="#666666" points="656.66,-161.11 666.71,-157.77 656.77,-154.11 656.66,-161.11"/>
</g>
<!-- Progress__mached -->
<g id="node5" class="node">
<title>Progress__mached</title>
<path fill="none" stroke="#1c2123" d="M907,-227.5C907,-227.5 1107,-227.5 1107,-227.5 1113,-227.5 1119,-233.5 1119,-239.5 1119,-239.5 1119,-276.5 1119,-276.5 1119,-282.5 1113,-288.5 1107,-288.5 1107,-288.5 907,-288.5 907,-288.5 901,-288.5 895,-282.5 895,-276.5 895,-276.5 895,-239.5 895,-239.5 895,-233.5 901,-227.5 907,-227.5"/>
<text text-anchor="middle" x="1007" y="-273.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__mached</text>
<polyline fill="none" stroke="#1c2123" points="895,-265.5 1119,-265.5 "/>
<text text-anchor="start" x="903" y="-250.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用min(pr.mached,raftlog.comitted)</text>
<text text-anchor="start" x="903" y="-235.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 作为commit index</text>
</g>
<!-- RaftCore__send_heartbeat&#45;&gt;Progress__mached -->
<g id="edge4" class="edge">
<title>RaftCore__send_heartbeat&#45;&gt;Progress__mached</title>
<path fill="none" stroke="#666666" d="M792.25,-177.11C821.28,-189.01 860.29,-204.76 895,-218 900.08,-219.94 905.31,-221.91 910.59,-223.87"/>
<polygon fill="#666666" stroke="#666666" points="909.54,-227.22 920.13,-227.41 911.98,-220.66 909.54,-227.22"/>
</g>
<!-- RaftLog__committed -->
<g id="node6" class="node">
<title>RaftLog__committed</title>
<path fill="none" stroke="#1c2123" d="M1062,-99C1062,-99 952,-99 952,-99 946,-99 940,-93 940,-87 940,-87 940,-75 940,-75 940,-69 946,-63 952,-63 952,-63 1062,-63 1062,-63 1068,-63 1074,-69 1074,-75 1074,-75 1074,-87 1074,-87 1074,-93 1068,-99 1062,-99"/>
<text text-anchor="middle" x="1007" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__committed</text>
</g>
<!-- RaftCore__send_heartbeat&#45;&gt;RaftLog__committed -->
<g id="edge5" class="edge">
<title>RaftCore__send_heartbeat&#45;&gt;RaftLog__committed</title>
<path fill="none" stroke="#666666" d="M796.62,-140.93C825.03,-130.6 861.81,-117.79 895,-108 906.29,-104.67 918.32,-101.43 930.13,-98.42"/>
<polygon fill="#666666" stroke="#666666" points="931.13,-101.78 939.98,-95.95 929.43,-94.99 931.13,-101.78"/>
</g>
<!-- RaftCore__send -->
<g id="node7" class="node">
<title>RaftCore__send</title>
<path fill="none" stroke="#1c2123" d="M953.5,-117.5C953.5,-117.5 1060.5,-117.5 1060.5,-117.5 1066.5,-117.5 1072.5,-123.5 1072.5,-129.5 1072.5,-129.5 1072.5,-196.5 1072.5,-196.5 1072.5,-202.5 1066.5,-208.5 1060.5,-208.5 1060.5,-208.5 953.5,-208.5 953.5,-208.5 947.5,-208.5 941.5,-202.5 941.5,-196.5 941.5,-196.5 941.5,-129.5 941.5,-129.5 941.5,-123.5 947.5,-117.5 953.5,-117.5"/>
<text text-anchor="middle" x="1007" y="-193.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send</text>
<polyline fill="none" stroke="#1c2123" points="941.5,-185.5 1072.5,-185.5 "/>
<text text-anchor="start" x="949.5" y="-170.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置消息的term</text>
<text text-anchor="start" x="949.5" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 为self.term</text>
<text text-anchor="start" x="949.5" y="-140.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后将消息append</text>
<text text-anchor="start" x="949.5" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 到Raft__msgs</text>
</g>
<!-- RaftCore__send_heartbeat&#45;&gt;RaftCore__send -->
<g id="edge6" class="edge">
<title>RaftCore__send_heartbeat&#45;&gt;RaftCore__send</title>
<path fill="none" stroke="#666666" d="M828.21,-160.24C861,-160.75 898.77,-161.33 931.05,-161.84"/>
<polygon fill="#666666" stroke="#666666" points="931.27,-165.34 941.32,-162 931.38,-158.34 931.27,-165.34"/>
</g>
<!-- Progress__mached&#45;&gt;Message -->
<g id="edge10" class="edge">
<title>Progress__mached&#45;&gt;Message:comitted</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1093.41,-227.43C1110.24,-221.41 1128.04,-215.04 1145.31,-208.86"/>
<polygon fill="green" stroke="green" points="1146.6,-212.11 1154.84,-205.45 1144.24,-205.52 1146.6,-212.11"/>
</g>
<!-- RaftLog__committed&#45;&gt;Message -->
<g id="edge11" class="edge">
<title>RaftLog__committed&#45;&gt;Message:comitted</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1074.22,-94.4C1089.15,-98.16 1104.78,-102.7 1119,-108 1127.76,-111.26 1136.69,-114.98 1145.56,-118.95"/>
<polygon fill="green" stroke="green" points="1144.21,-122.18 1154.76,-123.17 1147.13,-115.82 1144.21,-122.18"/>
</g>
<!-- RaftCore__step_leader -->
<g id="node8" class="node">
<title>RaftCore__step_leader</title>
<path fill="none" stroke="#1c2123" d="M129,-158C129,-158 12,-158 12,-158 6,-158 0,-152 0,-146 0,-146 0,-134 0,-134 0,-128 6,-122 12,-122 12,-122 129,-122 129,-122 135,-122 141,-128 141,-134 141,-134 141,-146 141,-146 141,-152 135,-158 129,-158"/>
<text text-anchor="middle" x="70.5" y="-136.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_leader</text>
</g>
<!-- RaftCore__step_leader&#45;&gt;RaftCore__bcast_hearbeat -->
<g id="edge7" class="edge">
<title>RaftCore__step_leader&#45;&gt;RaftCore__bcast_hearbeat</title>
<path fill="none" stroke="#666666" d="M141.25,-129.79C149.61,-128.57 158.24,-127.31 166.83,-126.05"/>
<polygon fill="#666666" stroke="#666666" points="167.49,-129.49 176.87,-124.58 166.47,-122.56 167.49,-129.49"/>
</g>
<!-- Raft__ping -->
<g id="node9" class="node">
<title>Raft__ping</title>
<path fill="none" stroke="#1c2123" d="M97,-104C97,-104 44,-104 44,-104 38,-104 32,-98 32,-92 32,-92 32,-80 32,-80 32,-74 38,-68 44,-68 44,-68 97,-68 97,-68 103,-68 109,-74 109,-80 109,-80 109,-92 109,-92 109,-98 103,-104 97,-104"/>
<text text-anchor="middle" x="70.5" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft__ping</text>
</g>
<!-- Raft__ping&#45;&gt;RaftCore__bcast_hearbeat -->
<g id="edge8" class="edge">
<title>Raft__ping&#45;&gt;RaftCore__bcast_hearbeat</title>
<path fill="none" stroke="#666666" d="M109.28,-91.53C126.04,-93.98 146.54,-96.98 166.84,-99.95"/>
<polygon fill="#666666" stroke="#666666" points="166.37,-103.42 176.77,-101.41 167.38,-96.49 166.37,-103.42"/>
</g>
</g>
</svg>
