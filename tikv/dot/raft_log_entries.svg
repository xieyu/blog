<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_log_entries Pages: 1 -->
<svg width="1422pt" height="246pt"
 viewBox="0.00 0.00 1422.00 246.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 242)">
<title>raft_log_entries</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-242 1418,-242 1418,4 -4,4"/>
<!-- Unstable__entries -->
<g id="node1" class="node">
<title>Unstable__entries</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1250,-88.5C1250,-88.5 1402,-88.5 1402,-88.5 1408,-88.5 1414,-94.5 1414,-100.5 1414,-100.5 1414,-137.5 1414,-137.5 1414,-143.5 1408,-149.5 1402,-149.5 1402,-149.5 1250,-149.5 1250,-149.5 1244,-149.5 1238,-143.5 1238,-137.5 1238,-137.5 1238,-100.5 1238,-100.5 1238,-94.5 1244,-88.5 1250,-88.5"/>
<text text-anchor="middle" x="1326" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Unstable__entries</text>
<polyline fill="none" stroke="#8a8898" points="1238,-126.5 1414,-126.5 "/>
<text text-anchor="start" x="1246" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">All entries that have </text>
<text text-anchor="start" x="1246" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> not yet been write to storage</text>
</g>
<!-- Unstable__truncate_and_append -->
<g id="node2" class="node">
<title>Unstable__truncate_and_append</title>
<path fill="none" stroke="#1c2123" d="M1190,-137C1190,-137 1020,-137 1020,-137 1014,-137 1008,-131 1008,-125 1008,-125 1008,-113 1008,-113 1008,-107 1014,-101 1020,-101 1020,-101 1190,-101 1190,-101 1196,-101 1202,-107 1202,-113 1202,-113 1202,-125 1202,-125 1202,-131 1196,-137 1190,-137"/>
<text text-anchor="middle" x="1105" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Unstable__truncate_and_append</text>
</g>
<!-- Unstable__truncate_and_append&#45;&gt;Unstable__entries -->
<g id="edge1" class="edge">
<title>Unstable__truncate_and_append&#45;&gt;Unstable__entries</title>
<path fill="none" stroke="#666666" d="M1202.06,-119C1210.65,-119 1219.35,-119 1227.95,-119"/>
<polygon fill="#666666" stroke="#666666" points="1227.98,-122.5 1237.98,-119 1227.98,-115.5 1227.98,-122.5"/>
</g>
<!-- RaftLog__append -->
<g id="node3" class="node">
<title>RaftLog__append</title>
<path fill="none" stroke="#1c2123" d="M960,-137C960,-137 870,-137 870,-137 864,-137 858,-131 858,-125 858,-125 858,-113 858,-113 858,-107 864,-101 870,-101 870,-101 960,-101 960,-101 966,-101 972,-107 972,-113 972,-113 972,-125 972,-125 972,-131 966,-137 960,-137"/>
<text text-anchor="middle" x="915" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__append</text>
</g>
<!-- RaftLog__append&#45;&gt;Unstable__truncate_and_append -->
<g id="edge2" class="edge">
<title>RaftLog__append&#45;&gt;Unstable__truncate_and_append</title>
<path fill="none" stroke="#666666" d="M972.15,-119C980.24,-119 988.78,-119 997.46,-119"/>
<polygon fill="#666666" stroke="#666666" points="997.7,-122.5 1007.7,-119 997.7,-115.5 997.7,-122.5"/>
</g>
<!-- RaftLog__maybe_append -->
<g id="node4" class="node">
<title>RaftLog__maybe_append</title>
<path fill="none" stroke="#1c2123" d="M642,-126.5C642,-126.5 810,-126.5 810,-126.5 816,-126.5 822,-132.5 822,-138.5 822,-138.5 822,-175.5 822,-175.5 822,-181.5 816,-187.5 810,-187.5 810,-187.5 642,-187.5 642,-187.5 636,-187.5 630,-181.5 630,-175.5 630,-175.5 630,-138.5 630,-138.5 630,-132.5 636,-126.5 642,-126.5"/>
<text text-anchor="middle" x="726" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__maybe_append</text>
<polyline fill="none" stroke="#1c2123" points="630,-164.5 822,-164.5 "/>
<text text-anchor="start" x="638" y="-149.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">会检查log entry的term和index</text>
<text text-anchor="start" x="638" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 是否match</text>
</g>
<!-- RaftLog__maybe_append&#45;&gt;RaftLog__append -->
<g id="edge3" class="edge">
<title>RaftLog__maybe_append&#45;&gt;RaftLog__append</title>
<path fill="none" stroke="#666666" d="M822.14,-137.67C830.87,-135.89 839.57,-134.12 847.95,-132.42"/>
<polygon fill="#666666" stroke="#666666" points="848.89,-135.8 858,-130.38 847.5,-128.94 848.89,-135.8"/>
</g>
<!-- RaftCore__handle_append_entries -->
<g id="node5" class="node">
<title>RaftCore__handle_append_entries</title>
<path fill="none" stroke="#1c2123" d="M394,-120.5C394,-120.5 582,-120.5 582,-120.5 588,-120.5 594,-126.5 594,-132.5 594,-132.5 594,-199.5 594,-199.5 594,-205.5 588,-211.5 582,-211.5 582,-211.5 394,-211.5 394,-211.5 388,-211.5 382,-205.5 382,-199.5 382,-199.5 382,-132.5 382,-132.5 382,-126.5 388,-120.5 394,-120.5"/>
<text text-anchor="middle" x="488" y="-196.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_append_entries</text>
<polyline fill="none" stroke="#1c2123" points="382,-188.5 594,-188.5 "/>
<text text-anchor="start" x="390" y="-173.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理leader发来的MsgAppend</text>
<text text-anchor="start" x="390" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会比较log entry的term和index</text>
<text text-anchor="start" x="390" y="-143.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果和自己的不match就会reject</text>
<text text-anchor="start" x="390" y="-128.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 让leader重新发送</text>
</g>
<!-- RaftCore__handle_append_entries&#45;&gt;RaftLog__maybe_append -->
<g id="edge4" class="edge">
<title>RaftCore__handle_append_entries&#45;&gt;RaftLog__maybe_append</title>
<path fill="none" stroke="#666666" d="M594.23,-161.99C602.62,-161.67 611.1,-161.34 619.49,-161.02"/>
<polygon fill="#666666" stroke="#666666" points="619.81,-164.51 629.67,-160.64 619.54,-157.52 619.81,-164.51"/>
</g>
<!-- RaftCore__step_follower -->
<g id="node6" class="node">
<title>RaftCore__step_follower</title>
<path fill="none" stroke="#1c2123" d="M306.5,-238C306.5,-238 176.5,-238 176.5,-238 170.5,-238 164.5,-232 164.5,-226 164.5,-226 164.5,-214 164.5,-214 164.5,-208 170.5,-202 176.5,-202 176.5,-202 306.5,-202 306.5,-202 312.5,-202 318.5,-208 318.5,-214 318.5,-214 318.5,-226 318.5,-226 318.5,-232 312.5,-238 306.5,-238"/>
<text text-anchor="middle" x="241.5" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_follower</text>
</g>
<!-- RaftCore__step_follower&#45;&gt;RaftCore__handle_append_entries -->
<g id="edge5" class="edge">
<title>RaftCore__step_follower&#45;&gt;RaftCore__handle_append_entries</title>
<path fill="none" stroke="#666666" d="M318.52,-203.21C335.51,-199.46 353.9,-195.4 372.08,-191.38"/>
<polygon fill="#666666" stroke="#666666" points="372.83,-194.8 381.84,-189.22 371.32,-187.96 372.83,-194.8"/>
</g>
<!-- RaftCore__step_candidate -->
<g id="node7" class="node">
<title>RaftCore__step_candidate</title>
<path fill="none" stroke="#1c2123" d="M309.5,-184C309.5,-184 173.5,-184 173.5,-184 167.5,-184 161.5,-178 161.5,-172 161.5,-172 161.5,-160 161.5,-160 161.5,-154 167.5,-148 173.5,-148 173.5,-148 309.5,-148 309.5,-148 315.5,-148 321.5,-154 321.5,-160 321.5,-160 321.5,-172 321.5,-172 321.5,-178 315.5,-184 309.5,-184"/>
<text text-anchor="middle" x="241.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_candidate</text>
</g>
<!-- RaftCore__step_candidate&#45;&gt;RaftCore__handle_append_entries -->
<g id="edge6" class="edge">
<title>RaftCore__step_candidate&#45;&gt;RaftCore__handle_append_entries</title>
<path fill="none" stroke="#666666" d="M321.54,-166C337.64,-166 354.88,-166 371.94,-166"/>
<polygon fill="#666666" stroke="#666666" points="371.95,-169.5 381.95,-166 371.95,-162.5 371.95,-169.5"/>
</g>
<!-- RaftCore__step_leader -->
<g id="node8" class="node">
<title>RaftCore__step_leader</title>
<path fill="none" stroke="#1c2123" d="M149,-0.5C149,-0.5 334,-0.5 334,-0.5 340,-0.5 346,-6.5 346,-12.5 346,-12.5 346,-117.5 346,-117.5 346,-123.5 340,-129.5 334,-129.5 334,-129.5 149,-129.5 149,-129.5 143,-129.5 137,-123.5 137,-117.5 137,-117.5 137,-12.5 137,-12.5 137,-6.5 143,-0.5 149,-0.5"/>
<text text-anchor="middle" x="241.5" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_leader</text>
<polyline fill="none" stroke="#1c2123" points="137,-106.5 346,-106.5 "/>
<text text-anchor="start" x="145" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理RawNode的propose 调用</text>
<text text-anchor="start" x="145" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 处理MsgPropose类型的log entry</text>
<text text-anchor="start" x="145" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 直接append到leader自己</text>
<text text-anchor="start" x="145" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的log entry上</text>
<polyline fill="none" stroke="#1c2123" points="137,-38.5 346,-38.5 "/>
<text text-anchor="start" x="145" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">并向所有的peers发送</text>
<text text-anchor="start" x="145" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MsgAppend消息</text>
</g>
<!-- RaftCore__append_entry -->
<g id="node9" class="node">
<title>RaftCore__append_entry</title>
<path fill="none" stroke="#1c2123" d="M790.5,-100C790.5,-100 661.5,-100 661.5,-100 655.5,-100 649.5,-94 649.5,-88 649.5,-88 649.5,-76 649.5,-76 649.5,-70 655.5,-64 661.5,-64 661.5,-64 790.5,-64 790.5,-64 796.5,-64 802.5,-70 802.5,-76 802.5,-76 802.5,-88 802.5,-88 802.5,-94 796.5,-100 790.5,-100"/>
<text text-anchor="middle" x="726" y="-78.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__append_entry</text>
</g>
<!-- RaftCore__step_leader&#45;&gt;RaftCore__append_entry -->
<g id="edge7" class="edge">
<title>RaftCore__step_leader&#45;&gt;RaftCore__append_entry</title>
<path fill="none" stroke="#666666" d="M346.01,-68.65C433.46,-71.73 557.23,-76.09 639.24,-78.98"/>
<polygon fill="#666666" stroke="#666666" points="639.16,-82.48 649.28,-79.33 639.41,-75.48 639.16,-82.48"/>
</g>
<!-- RaftCore__append_entry&#45;&gt;RaftLog__append -->
<g id="edge8" class="edge">
<title>RaftCore__append_entry&#45;&gt;RaftLog__append</title>
<path fill="none" stroke="#666666" d="M802.52,-96.94C817.51,-99.91 833.14,-103 847.79,-105.9"/>
<polygon fill="#666666" stroke="#666666" points="847.27,-109.36 857.76,-107.87 848.63,-102.5 847.27,-109.36"/>
</g>
<!-- RaftCore__step -->
<g id="node10" class="node">
<title>RaftCore__step</title>
<path fill="none" stroke="#1c2123" d="M89,-184C89,-184 12,-184 12,-184 6,-184 0,-178 0,-172 0,-172 0,-160 0,-160 0,-154 6,-148 12,-148 12,-148 89,-148 89,-148 95,-148 101,-154 101,-160 101,-160 101,-172 101,-172 101,-178 95,-184 89,-184"/>
<text text-anchor="middle" x="50.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_follower -->
<g id="edge9" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_follower</title>
<path fill="none" stroke="#666666" d="M101.1,-182.13C112.84,-185.82 125.33,-189.64 137,-193 144.34,-195.11 151.99,-197.25 159.67,-199.34"/>
<polygon fill="#666666" stroke="#666666" points="158.82,-202.73 169.38,-201.96 160.64,-195.97 158.82,-202.73"/>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_candidate -->
<g id="edge10" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_candidate</title>
<path fill="none" stroke="#666666" d="M101.16,-166C116.52,-166 133.93,-166 151.12,-166"/>
<polygon fill="#666666" stroke="#666666" points="151.2,-169.5 161.2,-166 151.2,-162.5 151.2,-169.5"/>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_leader -->
<g id="edge11" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_leader</title>
<path fill="none" stroke="#666666" d="M85.29,-147.94C97.63,-141.35 112.36,-133.48 127.76,-125.25"/>
<polygon fill="#666666" stroke="#666666" points="129.73,-128.17 136.9,-120.37 126.43,-121.99 129.73,-128.17"/>
</g>
</g>
</svg>
