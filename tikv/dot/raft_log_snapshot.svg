<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_log_snapshot Pages: 1 -->
<svg width="1605pt" height="265pt"
 viewBox="0.00 0.00 1605.00 264.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 260.5)">
<title>raft_log_snapshot</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-260.5 1601,-260.5 1601,4 -4,4"/>
<!-- Unstable__snapshot -->
<g id="node1" class="node">
<title>Unstable__snapshot</title>
<path fill="none" stroke="#1c2123" d="M1416,-120C1416,-120 1585,-120 1585,-120 1591,-120 1597,-126 1597,-132 1597,-132 1597,-154 1597,-154 1597,-160 1591,-166 1585,-166 1585,-166 1416,-166 1416,-166 1410,-166 1404,-160 1404,-154 1404,-154 1404,-132 1404,-132 1404,-126 1410,-120 1416,-120"/>
<text text-anchor="middle" x="1500.5" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Unstable__snapshot</text>
<polyline fill="none" stroke="#1c2123" points="1404,-143 1597,-143 "/>
<text text-anchor="start" x="1412" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">The incoming unstable snapshot</text>
</g>
<!-- Unstable__unstable_snapshot -->
<g id="node2" class="node">
<title>Unstable__unstable_snapshot</title>
<path fill="none" stroke="#1c2123" d="M902.5,-235C902.5,-235 749.5,-235 749.5,-235 743.5,-235 737.5,-229 737.5,-223 737.5,-223 737.5,-211 737.5,-211 737.5,-205 743.5,-199 749.5,-199 749.5,-199 902.5,-199 902.5,-199 908.5,-199 914.5,-205 914.5,-211 914.5,-211 914.5,-223 914.5,-223 914.5,-229 908.5,-235 902.5,-235"/>
<text text-anchor="middle" x="826" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Unstable__unstable_snapshot</text>
</g>
<!-- Unstable__unstable_snapshot&#45;&gt;Unstable__snapshot -->
<g id="edge1" class="edge">
<title>Unstable__unstable_snapshot&#45;&gt;Unstable__snapshot</title>
<path fill="none" stroke="#666666" d="M914.81,-222.75C1022.8,-227.73 1211.06,-229.61 1368,-196 1393.91,-190.45 1421.29,-180.19 1444.32,-170.17"/>
<polygon fill="#666666" stroke="#666666" points="1445.85,-173.32 1453.57,-166.06 1443.01,-166.92 1445.85,-173.32"/>
</g>
<!-- RawNode__ready -->
<g id="node3" class="node">
<title>RawNode__ready</title>
<path fill="none" stroke="#1c2123" d="M12,-180C12,-180 175,-180 175,-180 181,-180 187,-186 187,-192 187,-192 187,-244 187,-244 187,-250 181,-256 175,-256 175,-256 12,-256 12,-256 6,-256 0,-250 0,-244 0,-244 0,-192 0,-192 0,-186 6,-180 12,-180"/>
<text text-anchor="middle" x="93.5" y="-240.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode__ready</text>
<polyline fill="none" stroke="#1c2123" points="0,-233 187,-233 "/>
<text text-anchor="start" x="8" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">在follower节点上会</text>
<text text-anchor="start" x="8" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 收到这个snapshot</text>
<text text-anchor="start" x="8" y="-187.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 应用负责apply 这个snapshot</text>
</g>
<!-- RawNode__ready&#45;&gt;Unstable__unstable_snapshot -->
<g id="edge2" class="edge">
<title>RawNode__ready&#45;&gt;Unstable__unstable_snapshot</title>
<path fill="none" stroke="#666666" d="M187.02,-217.87C325.51,-217.68 585.53,-217.33 727.1,-217.13"/>
<polygon fill="#666666" stroke="#666666" points="727.5,-220.63 737.5,-217.12 727.49,-213.63 727.5,-220.63"/>
</g>
<!-- RaftCore__maybe_send_append -->
<g id="node4" class="node">
<title>RaftCore__maybe_send_append</title>
<path fill="none" stroke="#1c2123" d="M911,-174C911,-174 741,-174 741,-174 735,-174 729,-168 729,-162 729,-162 729,-150 729,-150 729,-144 735,-138 741,-138 741,-138 911,-138 911,-138 917,-138 923,-144 923,-150 923,-150 923,-162 923,-162 923,-168 917,-174 911,-174"/>
<text text-anchor="middle" x="826" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__maybe_send_append</text>
</g>
<!-- RaftCore__prepare_send_snapshot -->
<g id="node5" class="node">
<title>RaftCore__prepare_send_snapshot</title>
<path fill="none" stroke="#1c2123" d="M971,-133C971,-133 1153,-133 1153,-133 1159,-133 1165,-139 1165,-145 1165,-145 1165,-167 1165,-167 1165,-173 1159,-179 1153,-179 1153,-179 971,-179 971,-179 965,-179 959,-173 959,-167 959,-167 959,-145 959,-145 959,-139 965,-133 971,-133"/>
<text text-anchor="middle" x="1062" y="-163.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__prepare_send_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="959,-156 1165,-156 "/>
<text text-anchor="start" x="967" y="-140.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备发送MsgSnapshot给peer</text>
</g>
<!-- RaftCore__maybe_send_append&#45;&gt;RaftCore__prepare_send_snapshot -->
<g id="edge3" class="edge">
<title>RaftCore__maybe_send_append&#45;&gt;RaftCore__prepare_send_snapshot</title>
<path fill="none" stroke="#666666" d="M923.19,-156C931.62,-156 940.19,-156 948.73,-156"/>
<polygon fill="#666666" stroke="#666666" points="948.73,-159.5 958.73,-156 948.73,-152.5 948.73,-159.5"/>
</g>
<!-- RaftLog__snapshot -->
<g id="node6" class="node">
<title>RaftLog__snapshot</title>
<path fill="none" stroke="#1c2123" d="M1226,-125.5C1226,-125.5 1343,-125.5 1343,-125.5 1349,-125.5 1355,-131.5 1355,-137.5 1355,-137.5 1355,-174.5 1355,-174.5 1355,-180.5 1349,-186.5 1343,-186.5 1343,-186.5 1226,-186.5 1226,-186.5 1220,-186.5 1214,-180.5 1214,-174.5 1214,-174.5 1214,-137.5 1214,-137.5 1214,-131.5 1220,-125.5 1226,-125.5"/>
<text text-anchor="middle" x="1284.5" y="-171.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__snapshot</text>
<polyline fill="none" stroke="#1c2123" points="1214,-163.5 1355,-163.5 "/>
<text text-anchor="start" x="1222" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用Storage::snapshot</text>
<text text-anchor="start" x="1222" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 生成snapshot</text>
</g>
<!-- RaftCore__prepare_send_snapshot&#45;&gt;RaftLog__snapshot -->
<g id="edge4" class="edge">
<title>RaftCore__prepare_send_snapshot&#45;&gt;RaftLog__snapshot</title>
<path fill="none" stroke="#666666" d="M1165.18,-156C1178.03,-156 1191.03,-156 1203.47,-156"/>
<polygon fill="#666666" stroke="#666666" points="1203.77,-159.5 1213.77,-156 1203.77,-152.5 1203.77,-159.5"/>
</g>
<!-- RaftCore__step_leader -->
<g id="node7" class="node">
<title>RaftCore__step_leader</title>
<path fill="none" stroke="#1c2123" d="M235,-108.5C235,-108.5 423,-108.5 423,-108.5 429,-108.5 435,-114.5 435,-120.5 435,-120.5 435,-157.5 435,-157.5 435,-163.5 429,-169.5 423,-169.5 423,-169.5 235,-169.5 235,-169.5 229,-169.5 223,-163.5 223,-157.5 223,-157.5 223,-120.5 223,-120.5 223,-114.5 229,-108.5 235,-108.5"/>
<text text-anchor="middle" x="329" y="-154.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_leader</text>
<polyline fill="none" stroke="#1c2123" points="223,-146.5 435,-146.5 "/>
<text text-anchor="start" x="231" y="-131.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader节点生成snapshot</text>
<text text-anchor="start" x="231" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后发送MsgSnapshot给follower</text>
</g>
<!-- RaftCore__handle_append_response -->
<g id="node12" class="node">
<title>RaftCore__handle_append_response</title>
<path fill="none" stroke="#1c2123" d="M677.5,-190C677.5,-190 486.5,-190 486.5,-190 480.5,-190 474.5,-184 474.5,-178 474.5,-178 474.5,-166 474.5,-166 474.5,-160 480.5,-154 486.5,-154 486.5,-154 677.5,-154 677.5,-154 683.5,-154 689.5,-160 689.5,-166 689.5,-166 689.5,-178 689.5,-178 689.5,-184 683.5,-190 677.5,-190"/>
<text text-anchor="middle" x="582" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_append_response</text>
</g>
<!-- RaftCore__step_leader&#45;&gt;RaftCore__handle_append_response -->
<g id="edge8" class="edge">
<title>RaftCore__step_leader&#45;&gt;RaftCore__handle_append_response</title>
<path fill="none" stroke="#666666" d="M435.36,-152.85C444.91,-154.11 454.63,-155.39 464.28,-156.65"/>
<polygon fill="#666666" stroke="#666666" points="463.93,-160.14 474.3,-157.97 464.84,-153.2 463.93,-160.14"/>
</g>
<!-- RaftCore__handle_hearbeat_response -->
<g id="node13" class="node">
<title>RaftCore__handle_hearbeat_response</title>
<path fill="none" stroke="#1c2123" d="M681,-136C681,-136 483,-136 483,-136 477,-136 471,-130 471,-124 471,-124 471,-112 471,-112 471,-106 477,-100 483,-100 483,-100 681,-100 681,-100 687,-100 693,-106 693,-112 693,-112 693,-124 693,-124 693,-130 687,-136 681,-136"/>
<text text-anchor="middle" x="582" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_hearbeat_response</text>
</g>
<!-- RaftCore__step_leader&#45;&gt;RaftCore__handle_hearbeat_response -->
<g id="edge9" class="edge">
<title>RaftCore__step_leader&#45;&gt;RaftCore__handle_hearbeat_response</title>
<path fill="none" stroke="#666666" d="M435.36,-130.19C443.65,-129.49 452.07,-128.79 460.46,-128.08"/>
<polygon fill="#666666" stroke="#666666" points="461,-131.55 470.67,-127.23 460.41,-124.58 461,-131.55"/>
</g>
<!-- RaftCore__handle_snapshot -->
<g id="node8" class="node">
<title>RaftCore__handle_snapshot</title>
<path fill="none" stroke="#1c2123" d="M484.5,-5C484.5,-5 679.5,-5 679.5,-5 685.5,-5 691.5,-11 691.5,-17 691.5,-17 691.5,-69 691.5,-69 691.5,-75 685.5,-81 679.5,-81 679.5,-81 484.5,-81 484.5,-81 478.5,-81 472.5,-75 472.5,-69 472.5,-69 472.5,-17 472.5,-17 472.5,-11 478.5,-5 484.5,-5"/>
<text text-anchor="middle" x="582" y="-65.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="472.5,-58 691.5,-58 "/>
<text text-anchor="start" x="480.5" y="-42.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">follower节点收到MsgSnapshot</text>
<text text-anchor="start" x="480.5" y="-27.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将snapshot放在Unstable__snapshot</text>
<text text-anchor="start" x="480.5" y="-12.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 变量上</text>
</g>
<!-- RaftCore__restore -->
<g id="node14" class="node">
<title>RaftCore__restore</title>
<path fill="none" stroke="#1c2123" d="M872,-79C872,-79 780,-79 780,-79 774,-79 768,-73 768,-67 768,-67 768,-55 768,-55 768,-49 774,-43 780,-43 780,-43 872,-43 872,-43 878,-43 884,-49 884,-55 884,-55 884,-67 884,-67 884,-73 878,-79 872,-79"/>
<text text-anchor="middle" x="826" y="-57.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__restore</text>
</g>
<!-- RaftCore__handle_snapshot&#45;&gt;RaftCore__restore -->
<g id="edge14" class="edge">
<title>RaftCore__handle_snapshot&#45;&gt;RaftCore__restore</title>
<path fill="none" stroke="#666666" d="M691.61,-51.08C714.08,-52.75 737.12,-54.46 757.59,-55.99"/>
<polygon fill="#666666" stroke="#666666" points="757.51,-59.49 767.74,-56.74 758.02,-52.51 757.51,-59.49"/>
</g>
<!-- RaftCore__step -->
<g id="node9" class="node">
<title>RaftCore__step</title>
<path fill="none" stroke="#1c2123" d="M132,-90C132,-90 55,-90 55,-90 49,-90 43,-84 43,-78 43,-78 43,-66 43,-66 43,-60 49,-54 55,-54 55,-54 132,-54 132,-54 138,-54 144,-60 144,-66 144,-66 144,-78 144,-78 144,-84 138,-90 132,-90"/>
<text text-anchor="middle" x="93.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_leader -->
<g id="edge5" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_leader</title>
<path fill="none" stroke="#666666" d="M144.02,-86.21C164.35,-92.04 188.8,-99.06 213.14,-106.04"/>
<polygon fill="#666666" stroke="#666666" points="212.24,-109.43 222.82,-108.82 214.17,-102.7 212.24,-109.43"/>
</g>
<!-- RaftCore__step_candidate -->
<g id="node10" class="node">
<title>RaftCore__step_candidate</title>
<path fill="none" stroke="#1c2123" d="M397,-90C397,-90 261,-90 261,-90 255,-90 249,-84 249,-78 249,-78 249,-66 249,-66 249,-60 255,-54 261,-54 261,-54 397,-54 397,-54 403,-54 409,-60 409,-66 409,-66 409,-78 409,-78 409,-84 403,-90 397,-90"/>
<text text-anchor="middle" x="329" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_candidate</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_candidate -->
<g id="edge6" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_candidate</title>
<path fill="none" stroke="#666666" d="M144.02,-72C171.44,-72 206.37,-72 238.41,-72"/>
<polygon fill="#666666" stroke="#666666" points="238.69,-75.5 248.69,-72 238.69,-68.5 238.69,-75.5"/>
</g>
<!-- RaftCore__step_follower -->
<g id="node11" class="node">
<title>RaftCore__step_follower</title>
<path fill="none" stroke="#1c2123" d="M394,-36C394,-36 264,-36 264,-36 258,-36 252,-30 252,-24 252,-24 252,-12 252,-12 252,-6 258,0 264,0 264,0 394,0 394,0 400,0 406,-6 406,-12 406,-12 406,-24 406,-24 406,-30 400,-36 394,-36"/>
<text text-anchor="middle" x="329" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__step_follower</text>
</g>
<!-- RaftCore__step&#45;&gt;RaftCore__step_follower -->
<g id="edge7" class="edge">
<title>RaftCore__step&#45;&gt;RaftCore__step_follower</title>
<path fill="none" stroke="#666666" d="M144.02,-60.55C172.41,-53.98 208.84,-45.56 241.79,-37.94"/>
<polygon fill="#666666" stroke="#666666" points="242.93,-41.27 251.89,-35.6 241.36,-34.45 242.93,-41.27"/>
</g>
<!-- RaftCore__step_candidate&#45;&gt;RaftCore__handle_snapshot -->
<g id="edge12" class="edge">
<title>RaftCore__step_candidate&#45;&gt;RaftCore__handle_snapshot</title>
<path fill="none" stroke="#666666" d="M409.07,-62.86C426.05,-60.9 444.34,-58.79 462.44,-56.7"/>
<polygon fill="#666666" stroke="#666666" points="462.94,-60.16 472.47,-55.54 462.13,-53.21 462.94,-60.16"/>
</g>
<!-- RaftCore__step_follower&#45;&gt;RaftCore__handle_snapshot -->
<g id="edge13" class="edge">
<title>RaftCore__step_follower&#45;&gt;RaftCore__handle_snapshot</title>
<path fill="none" stroke="#666666" d="M406.33,-25.6C423.94,-27.36 443.07,-29.26 462.01,-31.15"/>
<polygon fill="#666666" stroke="#666666" points="461.9,-34.65 472.2,-32.16 462.59,-27.69 461.9,-34.65"/>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_send_append -->
<g id="edge10" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_send_append</title>
<path fill="none" stroke="#666666" d="M689.85,-164.94C699.33,-164.31 708.94,-163.67 718.42,-163.05"/>
<polygon fill="#666666" stroke="#666666" points="718.9,-166.52 728.65,-162.37 718.44,-159.54 718.9,-166.52"/>
</g>
<!-- RaftCore__handle_hearbeat_response&#45;&gt;RaftCore__maybe_send_append -->
<g id="edge11" class="edge">
<title>RaftCore__handle_hearbeat_response&#45;&gt;RaftCore__maybe_send_append</title>
<path fill="none" stroke="#666666" d="M693.02,-135.28C701.64,-136.63 710.33,-137.99 718.92,-139.34"/>
<polygon fill="#666666" stroke="#666666" points="718.52,-142.82 728.94,-140.92 719.61,-135.91 718.52,-142.82"/>
</g>
<!-- RaftLog__restore -->
<g id="node15" class="node">
<title>RaftLog__restore</title>
<path fill="none" stroke="#1c2123" d="M1106,-88C1106,-88 1018,-88 1018,-88 1012,-88 1006,-82 1006,-76 1006,-76 1006,-64 1006,-64 1006,-58 1012,-52 1018,-52 1018,-52 1106,-52 1106,-52 1112,-52 1118,-58 1118,-64 1118,-64 1118,-76 1118,-76 1118,-82 1112,-88 1106,-88"/>
<text text-anchor="middle" x="1062" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog__restore</text>
</g>
<!-- RaftCore__restore&#45;&gt;RaftLog__restore -->
<g id="edge15" class="edge">
<title>RaftCore__restore&#45;&gt;RaftLog__restore</title>
<path fill="none" stroke="#666666" d="M884.24,-63.2C917.99,-64.5 960.79,-66.15 995.83,-67.49"/>
<polygon fill="#666666" stroke="#666666" points="995.83,-71 1005.96,-67.88 996.1,-64 995.83,-71"/>
</g>
<!-- Unstable__restore -->
<g id="node16" class="node">
<title>Unstable__restore</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1213,-43.5C1213,-43.5 1356,-43.5 1356,-43.5 1362,-43.5 1368,-49.5 1368,-55.5 1368,-55.5 1368,-92.5 1368,-92.5 1368,-98.5 1362,-104.5 1356,-104.5 1356,-104.5 1213,-104.5 1213,-104.5 1207,-104.5 1201,-98.5 1201,-92.5 1201,-92.5 1201,-55.5 1201,-55.5 1201,-49.5 1207,-43.5 1213,-43.5"/>
<text text-anchor="middle" x="1284.5" y="-89.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Unstable__restore</text>
<polyline fill="none" stroke="#8a8898" points="1201,-81.5 1368,-81.5 "/>
<text text-anchor="start" x="1209" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">将snapshot设置为message</text>
<text text-anchor="start" x="1209" y="-51.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 中收到的snapsot</text>
</g>
<!-- RaftLog__restore&#45;&gt;Unstable__restore -->
<g id="edge16" class="edge">
<title>RaftLog__restore&#45;&gt;Unstable__restore</title>
<path fill="none" stroke="#666666" d="M1118.07,-71C1140.05,-71.4 1165.96,-71.87 1190.68,-72.32"/>
<polygon fill="#666666" stroke="#666666" points="1190.75,-75.82 1200.81,-72.5 1190.88,-68.82 1190.75,-75.82"/>
</g>
<!-- Unstable__restore&#45;&gt;Unstable__snapshot -->
<g id="edge17" class="edge">
<title>Unstable__restore&#45;&gt;Unstable__snapshot</title>
<path fill="none" stroke="#666666" d="M1368.24,-100.68C1384.76,-106 1402.09,-111.59 1418.54,-116.9"/>
<polygon fill="#666666" stroke="#666666" points="1417.53,-120.25 1428.12,-119.99 1419.68,-113.59 1417.53,-120.25"/>
</g>
</g>
</svg>
