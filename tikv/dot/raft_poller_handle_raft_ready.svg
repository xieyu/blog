<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: raft_poller_handle_raft_ready Pages: 1 -->
<svg width="2117pt" height="626pt"
 viewBox="0.00 0.00 2117.00 626.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 622)">
<title>raft_poller_handle_raft_ready</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-622 2113,-622 2113,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RaftEngine</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M331,-362C331,-362 455,-362 455,-362 461,-362 467,-368 467,-374 467,-374 467,-432 467,-432 467,-438 461,-444 455,-444 455,-444 331,-444 331,-444 325,-444 319,-438 319,-432 319,-432 319,-374 319,-374 319,-368 325,-362 331,-362"/>
<text text-anchor="middle" x="393" y="-424" font-family="Times,serif" font-size="20.00">RaftEngine</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_WriteBatch</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M352,-272C352,-272 435,-272 435,-272 441,-272 447,-278 447,-284 447,-284 447,-342 447,-342 447,-348 441,-354 435,-354 435,-354 352,-354 352,-354 346,-354 340,-348 340,-342 340,-342 340,-284 340,-284 340,-278 346,-272 352,-272"/>
<text text-anchor="middle" x="393.5" y="-334" font-family="Times,serif" font-size="20.00">WriteBatch</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_PeerStorage</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1258,-8C1258,-8 2089,-8 2089,-8 2095,-8 2101,-14 2101,-20 2101,-20 2101,-482 2101,-482 2101,-488 2095,-494 2089,-494 2089,-494 1258,-494 1258,-494 1252,-494 1246,-488 1246,-482 1246,-482 1246,-20 1246,-20 1246,-14 1252,-8 1258,-8"/>
<text text-anchor="middle" x="1673.5" y="-474" font-family="Times,serif" font-size="20.00">PeerStorage</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_Peer</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1011,-502C1011,-502 1494.5,-502 1494.5,-502 1500.5,-502 1506.5,-508 1506.5,-514 1506.5,-514 1506.5,-598 1506.5,-598 1506.5,-604 1500.5,-610 1494.5,-610 1494.5,-610 1011,-610 1011,-610 1005,-610 999,-604 999,-598 999,-598 999,-514 999,-514 999,-508 1005,-502 1011,-502"/>
<text text-anchor="middle" x="1252.75" y="-590" font-family="Times,serif" font-size="20.00">Peer</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_PeerFsmDelegate</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M762,-205C762,-205 1214,-205 1214,-205 1220,-205 1226,-211 1226,-217 1226,-217 1226,-425 1226,-425 1226,-431 1220,-437 1214,-437 1214,-437 762,-437 762,-437 756,-437 750,-431 750,-425 750,-425 750,-217 750,-217 750,-211 756,-205 762,-205"/>
<text text-anchor="middle" x="988" y="-417" font-family="Times,serif" font-size="20.00">PeerFsmDelegate</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_PollContext</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M499,-293C499,-293 718,-293 718,-293 724,-293 730,-299 730,-305 730,-305 730,-421 730,-421 730,-427 724,-433 718,-433 718,-433 499,-433 499,-433 493,-433 487,-427 487,-421 487,-421 487,-305 487,-305 487,-299 493,-293 499,-293"/>
<text text-anchor="middle" x="608.5" y="-413" font-family="Times,serif" font-size="20.00">ollContext</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_RaftPoller</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-259C20,-259 287,-259 287,-259 293,-259 299,-265 299,-271 299,-271 299,-355 299,-355 299,-361 293,-367 287,-367 287,-367 20,-367 20,-367 14,-367 8,-361 8,-355 8,-355 8,-271 8,-271 8,-265 14,-259 20,-259"/>
<text text-anchor="middle" x="153.5" y="-347" font-family="Times,serif" font-size="20.00">RaftPoller</text>
</g>
<!-- consume_and_shrink -->
<g id="node1" class="node">
<title>consume_and_shrink</title>
<path fill="none" stroke="#1c2123" d="M447,-406C447,-406 339,-406 339,-406 333,-406 327,-400 327,-394 327,-394 327,-382 327,-382 327,-376 333,-370 339,-370 339,-370 447,-370 447,-370 453,-370 459,-376 459,-382 459,-382 459,-394 459,-394 459,-400 453,-406 447,-406"/>
<text text-anchor="middle" x="393" y="-384.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">consume_and_shrink</text>
</g>
<!-- PollContext -->
<g id="node18" class="node">
<title>PollContext</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M507,-302C507,-302 710,-302 710,-302 716,-302 722,-308 722,-314 722,-314 722,-382 722,-382 722,-388 716,-394 710,-394 710,-394 507,-394 507,-394 501,-394 495,-388 495,-382 495,-382 495,-314 495,-314 495,-308 501,-302 507,-302"/>
<text text-anchor="middle" x="608.5" y="-378.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">PollContext</text>
<polyline fill="none" stroke="#60b5ac" points="495,-371 722,-371 "/>
<text text-anchor="start" x="503" y="-355.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub kv_wb: EK::WriteBatch,</text>
<polyline fill="none" stroke="#60b5ac" points="495,-348 722,-348 "/>
<text text-anchor="start" x="503" y="-332.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub raft_wb: ER::LogBatch,</text>
<polyline fill="none" stroke="#60b5ac" points="495,-325 722,-325 "/>
<text text-anchor="start" x="503" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub ready_res: Vec&lt;CollectedReady&gt;,</text>
</g>
<!-- consume_and_shrink&#45;&gt;PollContext -->
<g id="edge21" class="edge">
<title>consume_and_shrink&#45;&gt;PollContext:raft_wb</title>
<path fill="none" stroke="#666666" d="M443.69,-369.97C451.68,-366.39 459.72,-362.38 467,-358 476.22,-352.45 478.01,-343.83 483.58,-339.2"/>
<polygon fill="#666666" stroke="#666666" points="485.06,-342.4 493.5,-336 482.91,-335.74 485.06,-342.4"/>
</g>
<!-- write_opt -->
<g id="node2" class="node">
<title>write_opt</title>
<path fill="none" stroke="#1c2123" d="M415,-316C415,-316 371,-316 371,-316 365,-316 359,-310 359,-304 359,-304 359,-292 359,-292 359,-286 365,-280 371,-280 371,-280 415,-280 415,-280 421,-280 427,-286 427,-292 427,-292 427,-304 427,-304 427,-310 421,-316 415,-316"/>
<text text-anchor="middle" x="393" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_opt</text>
</g>
<!-- write_opt&#45;&gt;PollContext -->
<g id="edge20" class="edge">
<title>write_opt&#45;&gt;PollContext:kv_wb</title>
<path fill="none" stroke="#666666" d="M410.38,-316.27C426.82,-332.7 453.87,-354.91 483.4,-359.25"/>
<polygon fill="#666666" stroke="#666666" points="483.27,-362.75 493.5,-360 483.79,-355.77 483.27,-362.75"/>
</g>
<!-- post_ready -->
<g id="node3" class="node">
<title>post_ready</title>
<path fill="none" stroke="#1c2123" d="M1266,-173.5C1266,-173.5 1540,-173.5 1540,-173.5 1546,-173.5 1552,-179.5 1552,-185.5 1552,-185.5 1552,-314.5 1552,-314.5 1552,-320.5 1546,-326.5 1540,-326.5 1540,-326.5 1266,-326.5 1266,-326.5 1260,-326.5 1254,-320.5 1254,-314.5 1254,-314.5 1254,-185.5 1254,-185.5 1254,-179.5 1260,-173.5 1266,-173.5"/>
<text text-anchor="middle" x="1403" y="-311.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">post_ready</text>
<polyline fill="none" stroke="#1c2123" points="1254,-303.5 1552,-303.5 "/>
<text text-anchor="start" x="1262" y="-288.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">update memory state after ready</text>
<text text-anchor="start" x="1262" y="-273.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> chages are flushed to disk successfully</text>
<polyline fill="none" stroke="#1c2123" points="1254,-265.5 1552,-265.5 "/>
<text text-anchor="start" x="1262" y="-250.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用invoke_ctx中的state\l 更新自己的成员变量</text>
<polyline fill="none" stroke="#1c2123" points="1254,-242.5 1552,-242.5 "/>
<text text-anchor="start" x="1262" y="-227.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.raft_state = ctx.raft_state;</text>
<polyline fill="none" stroke="#1c2123" points="1254,-219.5 1552,-219.5 "/>
<text text-anchor="start" x="1262" y="-204.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.apply_state = ctx.apply_state;</text>
<polyline fill="none" stroke="#1c2123" points="1254,-196.5 1552,-196.5 "/>
<text text-anchor="start" x="1262" y="-181.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.last_term = ctx.last_term;</text>
</g>
<!-- raft_state -->
<g id="node4" class="node">
<title>raft_state</title>
<path fill="none" stroke="#1c2123" d="M1747,-52C1747,-52 1704,-52 1704,-52 1698,-52 1692,-46 1692,-40 1692,-40 1692,-28 1692,-28 1692,-22 1698,-16 1704,-16 1704,-16 1747,-16 1747,-16 1753,-16 1759,-22 1759,-28 1759,-28 1759,-40 1759,-40 1759,-46 1753,-52 1747,-52"/>
<text text-anchor="middle" x="1725.5" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">raft_state</text>
</g>
<!-- post_ready&#45;&gt;raft_state -->
<g id="edge1" class="edge">
<title>post_ready&#45;&gt;raft_state</title>
<path fill="none" stroke="#666666" d="M1460.1,-173.14C1493,-133.63 1537.89,-88.19 1588,-61 1616.81,-45.37 1653.42,-38.73 1681.47,-35.93"/>
<polygon fill="#666666" stroke="#666666" points="1682.11,-39.39 1691.77,-35.04 1681.5,-32.41 1682.11,-39.39"/>
</g>
<!-- apply_state -->
<g id="node5" class="node">
<title>apply_state</title>
<path fill="none" stroke="#1c2123" d="M1752.5,-106C1752.5,-106 1698.5,-106 1698.5,-106 1692.5,-106 1686.5,-100 1686.5,-94 1686.5,-94 1686.5,-82 1686.5,-82 1686.5,-76 1692.5,-70 1698.5,-70 1698.5,-70 1752.5,-70 1752.5,-70 1758.5,-70 1764.5,-76 1764.5,-82 1764.5,-82 1764.5,-94 1764.5,-94 1764.5,-100 1758.5,-106 1752.5,-106"/>
<text text-anchor="middle" x="1725.5" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_state</text>
</g>
<!-- post_ready&#45;&gt;apply_state -->
<g id="edge2" class="edge">
<title>post_ready&#45;&gt;apply_state</title>
<path fill="none" stroke="#666666" d="M1492.24,-173.19C1521.12,-151.46 1554.45,-129.75 1588,-115 1615.94,-102.72 1649.56,-95.98 1676.44,-92.31"/>
<polygon fill="#666666" stroke="#666666" points="1676.9,-95.78 1686.38,-91.05 1676.02,-88.83 1676.9,-95.78"/>
</g>
<!-- last_term -->
<g id="node6" class="node">
<title>last_term</title>
<path fill="none" stroke="#1c2123" d="M1747.5,-160C1747.5,-160 1703.5,-160 1703.5,-160 1697.5,-160 1691.5,-154 1691.5,-148 1691.5,-148 1691.5,-136 1691.5,-136 1691.5,-130 1697.5,-124 1703.5,-124 1703.5,-124 1747.5,-124 1747.5,-124 1753.5,-124 1759.5,-130 1759.5,-136 1759.5,-136 1759.5,-148 1759.5,-148 1759.5,-154 1753.5,-160 1747.5,-160"/>
<text text-anchor="middle" x="1725.5" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">last_term</text>
</g>
<!-- post_ready&#45;&gt;last_term -->
<g id="edge3" class="edge">
<title>post_ready&#45;&gt;last_term</title>
<path fill="none" stroke="#666666" d="M1552.06,-181.52C1564.1,-176.97 1576.18,-172.72 1588,-169 1618.65,-159.35 1654.3,-152.44 1681.48,-148.03"/>
<polygon fill="#666666" stroke="#666666" points="1682.12,-151.47 1691.45,-146.46 1681.03,-144.55 1682.12,-151.47"/>
</g>
<!-- clear_extra_data -->
<g id="node7" class="node">
<title>clear_extra_data</title>
<path fill="none" stroke="#1c2123" d="M1766.5,-214C1766.5,-214 1684.5,-214 1684.5,-214 1678.5,-214 1672.5,-208 1672.5,-202 1672.5,-202 1672.5,-190 1672.5,-190 1672.5,-184 1678.5,-178 1684.5,-178 1684.5,-178 1766.5,-178 1766.5,-178 1772.5,-178 1778.5,-184 1778.5,-190 1778.5,-190 1778.5,-202 1778.5,-202 1778.5,-208 1772.5,-214 1766.5,-214"/>
<text text-anchor="middle" x="1725.5" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">clear_extra_data</text>
</g>
<!-- post_ready&#45;&gt;clear_extra_data -->
<g id="edge4" class="edge">
<title>post_ready&#45;&gt;clear_extra_data</title>
<path fill="none" stroke="#666666" d="M1552.05,-225.05C1590.98,-218.5 1630.87,-211.78 1662.46,-206.45"/>
<polygon fill="#666666" stroke="#666666" points="1663.14,-209.89 1672.42,-204.77 1661.98,-202.98 1663.14,-209.89"/>
</g>
<!-- is_initialized -->
<g id="node8" class="node">
<title>is_initialized</title>
<path fill="none" stroke="#1c2123" d="M1756.5,-268C1756.5,-268 1694.5,-268 1694.5,-268 1688.5,-268 1682.5,-262 1682.5,-256 1682.5,-256 1682.5,-244 1682.5,-244 1682.5,-238 1688.5,-232 1694.5,-232 1694.5,-232 1756.5,-232 1756.5,-232 1762.5,-232 1768.5,-238 1768.5,-244 1768.5,-244 1768.5,-256 1768.5,-256 1768.5,-262 1762.5,-268 1756.5,-268"/>
<text text-anchor="middle" x="1725.5" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_initialized</text>
</g>
<!-- post_ready&#45;&gt;is_initialized -->
<g id="edge5" class="edge">
<title>post_ready&#45;&gt;is_initialized</title>
<path fill="none" stroke="#666666" d="M1552.05,-250C1594.97,-250 1639.07,-250 1671.92,-250"/>
<polygon fill="#666666" stroke="#666666" points="1672.18,-253.5 1682.18,-250 1672.18,-246.5 1672.18,-253.5"/>
</g>
<!-- schedule_applying_snapshot -->
<g id="node9" class="node">
<title>schedule_applying_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1799.5,-322C1799.5,-322 1651.5,-322 1651.5,-322 1645.5,-322 1639.5,-316 1639.5,-310 1639.5,-310 1639.5,-298 1639.5,-298 1639.5,-292 1645.5,-286 1651.5,-286 1651.5,-286 1799.5,-286 1799.5,-286 1805.5,-286 1811.5,-292 1811.5,-298 1811.5,-298 1811.5,-310 1811.5,-310 1811.5,-316 1805.5,-322 1799.5,-322"/>
<text text-anchor="middle" x="1725.5" y="-300.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">schedule_applying_snapshot</text>
</g>
<!-- post_ready&#45;&gt;schedule_applying_snapshot -->
<g id="edge6" class="edge">
<title>post_ready&#45;&gt;schedule_applying_snapshot</title>
<path fill="none" stroke="#666666" d="M1552.05,-274.95C1578.29,-279.37 1604.97,-283.86 1629.24,-287.95"/>
<polygon fill="#666666" stroke="#666666" points="1628.69,-291.41 1639.13,-289.62 1629.86,-284.5 1628.69,-291.41"/>
</g>
<!-- ApplySnapResult -->
<g id="node10" class="node">
<title>ApplySnapResult</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M1600,-340.5C1600,-340.5 1851,-340.5 1851,-340.5 1857,-340.5 1863,-346.5 1863,-352.5 1863,-352.5 1863,-443.5 1863,-443.5 1863,-449.5 1857,-455.5 1851,-455.5 1851,-455.5 1600,-455.5 1600,-455.5 1594,-455.5 1588,-449.5 1588,-443.5 1588,-443.5 1588,-352.5 1588,-352.5 1588,-346.5 1594,-340.5 1600,-340.5"/>
<text text-anchor="start" x="1596" y="-440.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果ctx.snap_region不为None</text>
<polyline fill="none" stroke="#60b5ac" points="1588,-432.5 1863,-432.5 "/>
<text text-anchor="start" x="1596" y="-417.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">ApplySnapResult</text>
<polyline fill="none" stroke="#60b5ac" points="1588,-409.5 1863,-409.5 "/>
<text text-anchor="start" x="1596" y="-394.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub prev_region: metapb::Region,</text>
<polyline fill="none" stroke="#60b5ac" points="1588,-386.5 1863,-386.5 "/>
<text text-anchor="start" x="1596" y="-371.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub region: metapb::Region,</text>
<polyline fill="none" stroke="#60b5ac" points="1588,-363.5 1863,-363.5 "/>
<text text-anchor="start" x="1596" y="-348.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub destroyed_regions: Vec&lt;metapb::Region&gt;,</text>
</g>
<!-- post_ready&#45;&gt;ApplySnapResult -->
<g id="edge7" class="edge">
<title>post_ready&#45;&gt;ApplySnapResult</title>
<path fill="none" stroke="#666666" d="M1552.05,-318.37C1564.86,-324.28 1577.76,-330.24 1590.44,-336.1"/>
<polygon fill="#666666" stroke="#666666" points="1589.09,-339.32 1599.63,-340.34 1592.02,-332.97 1589.09,-339.32"/>
</g>
<!-- set_snap_state -->
<g id="node11" class="node">
<title>set_snap_state</title>
<path fill="none" stroke="#1c2123" d="M2031.5,-292C2031.5,-292 1960.5,-292 1960.5,-292 1954.5,-292 1948.5,-286 1948.5,-280 1948.5,-280 1948.5,-268 1948.5,-268 1948.5,-262 1954.5,-256 1960.5,-256 1960.5,-256 2031.5,-256 2031.5,-256 2037.5,-256 2043.5,-262 2043.5,-268 2043.5,-268 2043.5,-280 2043.5,-280 2043.5,-286 2037.5,-292 2031.5,-292"/>
<text text-anchor="middle" x="1996" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_snap_state</text>
</g>
<!-- schedule_applying_snapshot&#45;&gt;set_snap_state -->
<g id="edge8" class="edge">
<title>schedule_applying_snapshot&#45;&gt;set_snap_state</title>
<path fill="none" stroke="#666666" d="M1811.82,-294.47C1853.09,-289.86 1901.5,-284.45 1938.19,-280.35"/>
<polygon fill="#666666" stroke="#666666" points="1938.66,-283.82 1948.21,-279.23 1937.88,-276.86 1938.66,-283.82"/>
</g>
<!-- region_sched_schedule -->
<g id="node12" class="node">
<title>region_sched_schedule</title>
<path fill="none" stroke="#1c2123" d="M1911,-311C1911,-311 2081,-311 2081,-311 2087,-311 2093,-317 2093,-323 2093,-323 2093,-345 2093,-345 2093,-351 2087,-357 2081,-357 2081,-357 1911,-357 1911,-357 1905,-357 1899,-351 1899,-345 1899,-345 1899,-323 1899,-323 1899,-317 1905,-311 1911,-311"/>
<text text-anchor="middle" x="1996" y="-341.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.region_sched.schedule(task)</text>
<polyline fill="none" stroke="#1c2123" points="1899,-334 2093,-334 "/>
<text text-anchor="start" x="1907" y="-318.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RegionTask::Apply(...)</text>
</g>
<!-- schedule_applying_snapshot&#45;&gt;region_sched_schedule -->
<g id="edge9" class="edge">
<title>schedule_applying_snapshot&#45;&gt;region_sched_schedule</title>
<path fill="none" stroke="#666666" d="M1811.82,-313.53C1836.23,-316.26 1863.12,-319.27 1888.62,-322.11"/>
<polygon fill="#666666" stroke="#666666" points="1888.36,-325.61 1898.69,-323.24 1889.14,-318.65 1888.36,-325.61"/>
</g>
<!-- peer_post_raft_ready_append -->
<g id="node13" class="node">
<title>peer_post_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M1019,-511C1019,-511 1142,-511 1142,-511 1148,-511 1154,-517 1154,-523 1154,-523 1154,-535 1154,-535 1154,-541 1148,-547 1142,-547 1142,-547 1019,-547 1019,-547 1013,-547 1007,-541 1007,-535 1007,-535 1007,-523 1007,-523 1007,-517 1013,-511 1019,-511"/>
<text text-anchor="middle" x="1080.5" y="-525.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">post_raft_ready_append</text>
</g>
<!-- peer_post_raft_ready_append&#45;&gt;post_ready -->
<g id="edge10" class="edge">
<title>peer_post_raft_ready_append&#45;&gt;post_ready</title>
<path fill="none" stroke="#666666" d="M1117.17,-510.92C1147.59,-494.68 1191.7,-469.12 1226,-441 1264.42,-409.51 1302.37,-369.75 1333.13,-334.67"/>
<polygon fill="#666666" stroke="#666666" points="1336.06,-336.64 1339.99,-326.8 1330.78,-332.04 1336.06,-336.64"/>
</g>
<!-- activate -->
<g id="node14" class="node">
<title>activate</title>
<path fill="none" stroke="#1c2123" d="M1319.5,-510.5C1319.5,-510.5 1486.5,-510.5 1486.5,-510.5 1492.5,-510.5 1498.5,-516.5 1498.5,-522.5 1498.5,-522.5 1498.5,-559.5 1498.5,-559.5 1498.5,-565.5 1492.5,-571.5 1486.5,-571.5 1486.5,-571.5 1319.5,-571.5 1319.5,-571.5 1313.5,-571.5 1307.5,-565.5 1307.5,-559.5 1307.5,-559.5 1307.5,-522.5 1307.5,-522.5 1307.5,-516.5 1313.5,-510.5 1319.5,-510.5"/>
<text text-anchor="middle" x="1403" y="-556.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">activate</text>
<polyline fill="none" stroke="#1c2123" points="1307.5,-548.5 1498.5,-548.5 "/>
<text text-anchor="start" x="1315.5" y="-533.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Register self to apply_scheduler</text>
<text text-anchor="start" x="1315.5" y="-518.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> so that peer is then usable</text>
</g>
<!-- peer_post_raft_ready_append&#45;&gt;activate -->
<g id="edge11" class="edge">
<title>peer_post_raft_ready_append&#45;&gt;activate</title>
<path fill="none" stroke="#666666" d="M1154.23,-531.72C1196.47,-533.3 1250.41,-535.32 1297.18,-537.08"/>
<polygon fill="#666666" stroke="#666666" points="1297.22,-540.58 1307.35,-537.46 1297.49,-533.58 1297.22,-540.58"/>
</g>
<!-- post_raft_ready_append -->
<g id="node15" class="node">
<title>post_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M894,-270C894,-270 771,-270 771,-270 765,-270 759,-264 759,-258 759,-258 759,-246 759,-246 759,-240 765,-234 771,-234 771,-234 894,-234 894,-234 900,-234 906,-240 906,-246 906,-246 906,-258 906,-258 906,-264 900,-270 894,-270"/>
<text text-anchor="middle" x="832.5" y="-248.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">post_raft_ready_append</text>
</g>
<!-- post_raft_ready_append&#45;&gt;peer_post_raft_ready_append -->
<g id="edge12" class="edge">
<title>post_raft_ready_append&#45;&gt;peer_post_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M895.58,-270.03C899.81,-272.88 903.69,-276.18 907,-280 954.98,-335.44 901.05,-380.86 943,-441 963.31,-470.11 996.64,-491.87 1025.29,-506.47"/>
<polygon fill="#666666" stroke="#666666" points="1023.89,-509.68 1034.4,-510.96 1026.98,-503.4 1023.89,-509.68"/>
</g>
<!-- CollectedReady -->
<g id="node16" class="node">
<title>CollectedReady</title>
<path fill="none" stroke="#1c2123" d="M770,-289C770,-289 895,-289 895,-289 901,-289 907,-295 907,-301 907,-301 907,-369 907,-369 907,-375 901,-381 895,-381 895,-381 770,-381 770,-381 764,-381 758,-375 758,-369 758,-369 758,-301 758,-301 758,-295 764,-289 770,-289"/>
<text text-anchor="middle" x="832.5" y="-365.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CollectedReady</text>
<polyline fill="none" stroke="#1c2123" points="758,-358 907,-358 "/>
<text text-anchor="start" x="766" y="-342.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub batch_offset: usize,</text>
<polyline fill="none" stroke="#1c2123" points="758,-335 907,-335 "/>
<text text-anchor="start" x="766" y="-319.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub ctx: InvokeContext,</text>
<polyline fill="none" stroke="#1c2123" points="758,-312 907,-312 "/>
<text text-anchor="start" x="766" y="-296.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub ready: Ready,</text>
</g>
<!-- InvokeContext -->
<g id="node17" class="node">
<title>InvokeContext</title>
<path fill="#feed9b" stroke="#f7e495" d="M955,-214C955,-214 1206,-214 1206,-214 1212,-214 1218,-220 1218,-226 1218,-226 1218,-386 1218,-386 1218,-392 1212,-398 1206,-398 1206,-398 955,-398 955,-398 949,-398 943,-392 943,-386 943,-386 943,-226 943,-226 943,-220 949,-214 955,-214"/>
<text text-anchor="middle" x="1080.5" y="-382.8" font-family="Times,serif" font-size="14.00" fill="#40575d">InvokeContext</text>
<polyline fill="none" stroke="#f7e495" points="943,-375 1218,-375 "/>
<text text-anchor="start" x="951" y="-359.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region_id: u64,</text>
<polyline fill="none" stroke="#f7e495" points="943,-352 1218,-352 "/>
<text text-anchor="start" x="951" y="-336.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub raft_state: RaftLocalState,</text>
<polyline fill="none" stroke="#f7e495" points="943,-329 1218,-329 "/>
<text text-anchor="start" x="951" y="-313.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub apply_state: RaftApplyState,</text>
<polyline fill="none" stroke="#f7e495" points="943,-306 1218,-306 "/>
<text text-anchor="start" x="951" y="-290.8" font-family="Times,serif" font-size="14.00" fill="#40575d">last_term: u64,</text>
<polyline fill="none" stroke="#f7e495" points="943,-283 1218,-283 "/>
<text text-anchor="start" x="951" y="-267.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub has_new_entries: bool,</text>
<polyline fill="none" stroke="#f7e495" points="943,-260 1218,-260 "/>
<text text-anchor="start" x="951" y="-244.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub snap_region: Option&lt;Region&gt;,</text>
<polyline fill="none" stroke="#f7e495" points="943,-237 1218,-237 "/>
<text text-anchor="start" x="951" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub destroyed_regions: Vec&lt;metapb::Region&gt;,</text>
</g>
<!-- CollectedReady&#45;&gt;InvokeContext -->
<g id="edge13" class="edge">
<title>CollectedReady:invoke_ctx&#45;&gt;InvokeContext</title>
<path fill="none" stroke="#666666" d="M907,-323C915.33,-323 923.87,-322.8 932.48,-322.45"/>
<polygon fill="#666666" stroke="#666666" points="932.8,-325.94 942.62,-321.96 932.46,-318.94 932.8,-325.94"/>
</g>
<!-- InvokeContext&#45;&gt;post_ready -->
<g id="edge14" class="edge">
<title>InvokeContext&#45;&gt;post_ready</title>
<path fill="none" stroke="#666666" d="M1218.35,-282.09C1226.79,-280.61 1235.31,-279.12 1243.83,-277.64"/>
<polygon fill="#666666" stroke="#666666" points="1244.58,-281.06 1253.82,-275.89 1243.37,-274.16 1244.58,-281.06"/>
</g>
<!-- PollContext&#45;&gt;post_raft_ready_append -->
<g id="edge19" class="edge">
<title>PollContext:ready&#45;&gt;post_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M723.5,-313C742.31,-313 734.61,-290.82 750,-280 752.69,-278.11 755.52,-276.33 758.45,-274.67"/>
<polygon fill="#666666" stroke="#666666" points="760.19,-277.71 767.48,-270.02 756.98,-271.49 760.19,-277.71"/>
</g>
<!-- PollContext&#45;&gt;CollectedReady -->
<g id="edge15" class="edge">
<title>PollContext:ready&#45;&gt;CollectedReady</title>
<path fill="none" stroke="#666666" d="M723.5,-313C731.46,-313 739.68,-313.58 747.87,-314.55"/>
<polygon fill="#666666" stroke="#666666" points="747.45,-318.03 757.83,-315.92 748.4,-311.09 747.45,-318.03"/>
</g>
<!-- handle_raft_ready -->
<g id="node19" class="node">
<title>handle_raft_ready</title>
<path fill="none" stroke="#1c2123" d="M28,-267.5C28,-267.5 279,-267.5 279,-267.5 285,-267.5 291,-273.5 291,-279.5 291,-279.5 291,-316.5 291,-316.5 291,-322.5 285,-328.5 279,-328.5 279,-328.5 28,-328.5 28,-328.5 22,-328.5 16,-322.5 16,-316.5 16,-316.5 16,-279.5 16,-279.5 16,-273.5 22,-267.5 28,-267.5"/>
<text text-anchor="middle" x="153.5" y="-313.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_raft_ready</text>
<polyline fill="none" stroke="#1c2123" points="16,-305.5 291,-305.5 "/>
<text text-anchor="start" x="24" y="-290.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.将kv_wb, raft_wb数据写入rocksdb中</text>
<text text-anchor="start" x="24" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.遍历ready_res 回调post_raft_ready_append</text>
</g>
<!-- handle_raft_ready&#45;&gt;consume_and_shrink -->
<g id="edge16" class="edge">
<title>handle_raft_ready&#45;&gt;consume_and_shrink</title>
<path fill="none" stroke="#666666" d="M235.24,-328.6C268,-341.01 305.08,-355.06 334.95,-366.38"/>
<polygon fill="#666666" stroke="#666666" points="333.79,-369.68 344.38,-369.95 336.27,-363.14 333.79,-369.68"/>
</g>
<!-- handle_raft_ready&#45;&gt;write_opt -->
<g id="edge17" class="edge">
<title>handle_raft_ready&#45;&gt;write_opt</title>
<path fill="none" stroke="#666666" d="M291.28,-298C311.92,-298 331.81,-298 348.39,-298"/>
<polygon fill="#666666" stroke="#666666" points="348.78,-301.5 358.78,-298 348.78,-294.5 348.78,-301.5"/>
</g>
<!-- handle_raft_ready&#45;&gt;post_raft_ready_append -->
<g id="edge18" class="edge">
<title>handle_raft_ready&#45;&gt;post_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M291.16,-271.48C300.56,-270.15 309.91,-268.97 319,-268 469.84,-251.98 646.94,-250.2 748.51,-250.8"/>
<polygon fill="#666666" stroke="#666666" points="748.68,-254.3 758.7,-250.87 748.73,-247.3 748.68,-254.3"/>
</g>
</g>
</svg>
