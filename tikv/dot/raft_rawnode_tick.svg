<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_storage Pages: 1 -->
<svg width="853pt" height="501pt"
 viewBox="0.00 0.00 853.00 500.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 496.5)">
<title>raft_storage</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-496.5 849,-496.5 849,4 -4,4"/>
<!-- RawNode_tick -->
<g id="node1" class="node">
<title>RawNode_tick</title>
<path fill="none" stroke="#1c2123" d="M12,-328C12,-328 183,-328 183,-328 189,-328 195,-334 195,-340 195,-340 195,-377 195,-377 195,-383 189,-389 183,-389 183,-389 12,-389 12,-389 6,-389 0,-383 0,-377 0,-377 0,-340 0,-340 0,-334 6,-328 12,-328"/>
<text text-anchor="middle" x="97.5" y="-373.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_tick</text>
<polyline fill="none" stroke="#1c2123" points="0,-366 195,-366 "/>
<text text-anchor="start" x="8" y="-350.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Tick advance the internal logical</text>
<text text-anchor="start" x="8" y="-335.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> clock by a single tick</text>
</g>
<!-- RaftCore_tick -->
<g id="node2" class="node">
<title>RaftCore_tick</title>
<path fill="none" stroke="#1c2123" d="M243,-309C243,-309 434,-309 434,-309 440,-309 446,-315 446,-321 446,-321 446,-396 446,-396 446,-402 440,-408 434,-408 434,-408 243,-408 243,-408 237,-408 231,-402 231,-396 231,-396 231,-321 231,-321 231,-315 237,-309 243,-309"/>
<text text-anchor="middle" x="338.5" y="-392.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_tick</text>
<polyline fill="none" stroke="#1c2123" points="231,-385 446,-385 "/>
<text text-anchor="start" x="239" y="-369.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是leader就调用 tick_heartbeat</text>
<polyline fill="none" stroke="#1c2123" points="231,-362 446,-362 "/>
<text text-anchor="start" x="239" y="-346.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是Follower,PreCandidate,</text>
<text text-anchor="start" x="239" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Candidate,就调用</text>
<text text-anchor="start" x="239" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> tick_election</text>
</g>
<!-- RawNode_tick&#45;&gt;RaftCore_tick -->
<g id="edge2" class="edge">
<title>RawNode_tick&#45;&gt;RaftCore_tick</title>
<path fill="none" stroke="#666666" d="M195.02,-358.5C203.5,-358.5 212.13,-358.5 220.74,-358.5"/>
<polygon fill="#666666" stroke="#666666" points="220.84,-362 230.84,-358.5 220.84,-355 220.84,-362"/>
</g>
<!-- RaftCore_tick_election -->
<g id="node3" class="node">
<title>RaftCore_tick_election</title>
<path fill="none" stroke="#1c2123" d="M505.5,-393C505.5,-393 663.5,-393 663.5,-393 669.5,-393 675.5,-399 675.5,-405 675.5,-405 675.5,-480 675.5,-480 675.5,-486 669.5,-492 663.5,-492 663.5,-492 505.5,-492 505.5,-492 499.5,-492 493.5,-486 493.5,-480 493.5,-480 493.5,-405 493.5,-405 493.5,-399 499.5,-393 505.5,-393"/>
<text text-anchor="middle" x="584.5" y="-476.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_tick_election</text>
<polyline fill="none" stroke="#1c2123" points="493.5,-469 675.5,-469 "/>
<text text-anchor="start" x="501.5" y="-453.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Follower, PreCandidate</text>
<text text-anchor="start" x="501.5" y="-438.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Candidate 角色</text>
<polyline fill="none" stroke="#1c2123" points="493.5,-431 675.5,-431 "/>
<text text-anchor="start" x="501.5" y="-415.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Run by follwers and cndidates</text>
<text text-anchor="start" x="501.5" y="-400.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> after self.election_timeout</text>
</g>
<!-- RaftCore_tick&#45;&gt;RaftCore_tick_election -->
<g id="edge3" class="edge">
<title>RaftCore_tick&#45;&gt;RaftCore_tick_election</title>
<path fill="none" stroke="#666666" d="M446.17,-395.22C458.74,-399.55 471.53,-403.95 483.99,-408.24"/>
<polygon fill="#666666" stroke="#666666" points="482.86,-411.55 493.45,-411.5 485.13,-404.93 482.86,-411.55"/>
</g>
<!-- RaftCore_tick_heartbeat -->
<g id="node7" class="node">
<title>RaftCore_tick_heartbeat</title>
<path fill="none" stroke="#1c2123" d="M522,-297.5C522,-297.5 647,-297.5 647,-297.5 653,-297.5 659,-303.5 659,-309.5 659,-309.5 659,-361.5 659,-361.5 659,-367.5 653,-373.5 647,-373.5 647,-373.5 522,-373.5 522,-373.5 516,-373.5 510,-367.5 510,-361.5 510,-361.5 510,-309.5 510,-309.5 510,-303.5 516,-297.5 522,-297.5"/>
<text text-anchor="middle" x="584.5" y="-358.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_tick_heartbeat</text>
<polyline fill="none" stroke="#1c2123" points="510,-350.5 659,-350.5 "/>
<text text-anchor="start" x="518" y="-335.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">State::Role leader</text>
<text text-anchor="start" x="518" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送heartbeat</text>
<text text-anchor="start" x="518" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 给follower和candidate</text>
</g>
<!-- RaftCore_tick&#45;&gt;RaftCore_tick_heartbeat -->
<g id="edge4" class="edge">
<title>RaftCore_tick&#45;&gt;RaftCore_tick_heartbeat</title>
<path fill="none" stroke="#666666" d="M446.17,-348.45C464.18,-346.75 482.64,-345.01 499.95,-343.38"/>
<polygon fill="#666666" stroke="#666666" points="500.37,-346.85 510,-342.43 499.71,-339.88 500.37,-346.85"/>
</g>
<!-- RaftCore_step -->
<g id="node6" class="node">
<title>RaftCore_step</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M735,-219C735,-219 833,-219 833,-219 839,-219 845,-225 845,-231 845,-231 845,-268 845,-268 845,-274 839,-280 833,-280 833,-280 735,-280 735,-280 729,-280 723,-274 723,-268 723,-268 723,-231 723,-231 723,-225 729,-219 735,-219"/>
<text text-anchor="middle" x="784" y="-264.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_step</text>
<polyline fill="none" stroke="#8a8898" points="723,-257 845,-257 "/>
<text text-anchor="start" x="731" y="-241.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Steps the raft along</text>
<text text-anchor="start" x="731" y="-226.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> via a message</text>
</g>
<!-- RaftCore_tick_election&#45;&gt;RaftCore_step -->
<g id="edge5" class="edge">
<title>RaftCore_tick_election&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M675.57,-393.07C679.55,-389.98 683.38,-386.79 687,-383.5 717.19,-356.05 743.53,-317.62 760.94,-288.94"/>
<polygon fill="#666666" stroke="#666666" points="764.16,-290.39 766.27,-280 758.15,-286.8 764.16,-290.39"/>
</g>
<!-- RawNode_propose -->
<g id="node4" class="node">
<title>RawNode_propose</title>
<path fill="none" stroke="#1c2123" d="M13.5,-260.5C13.5,-260.5 181.5,-260.5 181.5,-260.5 187.5,-260.5 193.5,-266.5 193.5,-272.5 193.5,-272.5 193.5,-294.5 193.5,-294.5 193.5,-300.5 187.5,-306.5 181.5,-306.5 181.5,-306.5 13.5,-306.5 13.5,-306.5 7.5,-306.5 1.5,-300.5 1.5,-294.5 1.5,-294.5 1.5,-272.5 1.5,-272.5 1.5,-266.5 7.5,-260.5 13.5,-260.5"/>
<text text-anchor="middle" x="97.5" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_propose</text>
<polyline fill="none" stroke="#1c2123" points="1.5,-283.5 193.5,-283.5 "/>
<text text-anchor="start" x="9.5" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">应用propose data to the raft log</text>
</g>
<!-- RawNode_propose&#45;&gt;RaftCore_step -->
<g id="edge7" class="edge">
<title>RawNode_propose&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M193.68,-278.77C333.02,-271.85 589.38,-259.12 712.87,-252.98"/>
<polygon fill="#666666" stroke="#666666" points="713.15,-256.47 722.97,-252.48 712.81,-249.48 713.15,-256.47"/>
</g>
<!-- RawNode_step -->
<g id="node5" class="node">
<title>RawNode_step</title>
<path fill="none" stroke="#1c2123" d="M25.5,-195.5C25.5,-195.5 169.5,-195.5 169.5,-195.5 175.5,-195.5 181.5,-201.5 181.5,-207.5 181.5,-207.5 181.5,-229.5 181.5,-229.5 181.5,-235.5 175.5,-241.5 169.5,-241.5 169.5,-241.5 25.5,-241.5 25.5,-241.5 19.5,-241.5 13.5,-235.5 13.5,-229.5 13.5,-229.5 13.5,-207.5 13.5,-207.5 13.5,-201.5 19.5,-195.5 25.5,-195.5"/>
<text text-anchor="middle" x="97.5" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_step</text>
<polyline fill="none" stroke="#1c2123" points="13.5,-218.5 181.5,-218.5 "/>
<text text-anchor="start" x="21.5" y="-203.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理其他peer发来的消息</text>
</g>
<!-- RawNode_step&#45;&gt;RaftCore_step -->
<g id="edge1" class="edge">
<title>RawNode_step&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M181.75,-222.27C317.91,-228.44 585.76,-240.57 712.87,-246.32"/>
<polygon fill="#666666" stroke="#666666" points="712.74,-249.82 722.88,-246.78 713.05,-242.83 712.74,-249.82"/>
</g>
<!-- RaftCore_tick_heartbeat&#45;&gt;RaftCore_step -->
<g id="edge6" class="edge">
<title>RaftCore_tick_heartbeat&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M659.04,-303.48C676.81,-295.74 695.74,-287.5 713.33,-279.84"/>
<polygon fill="#666666" stroke="#666666" points="715.17,-282.85 722.94,-275.65 712.37,-276.44 715.17,-282.85"/>
</g>
<!-- RawNode_propose_conf_change -->
<g id="node8" class="node">
<title>RawNode_propose_conf_change</title>
<path fill="none" stroke="#1c2123" d="M498.5,-95.5C498.5,-95.5 670.5,-95.5 670.5,-95.5 676.5,-95.5 682.5,-101.5 682.5,-107.5 682.5,-107.5 682.5,-189.5 682.5,-189.5 682.5,-195.5 676.5,-201.5 670.5,-201.5 670.5,-201.5 498.5,-201.5 498.5,-201.5 492.5,-201.5 486.5,-195.5 486.5,-189.5 486.5,-189.5 486.5,-107.5 486.5,-107.5 486.5,-101.5 492.5,-95.5 498.5,-95.5"/>
<text text-anchor="middle" x="584.5" y="-186.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_propose_conf_change</text>
<polyline fill="none" stroke="#1c2123" points="486.5,-178.5 682.5,-178.5 "/>
<text text-anchor="start" x="494.5" y="-163.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">conf change</text>
<text text-anchor="start" x="494.5" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建MessagePropose</text>
<text text-anchor="start" x="494.5" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> log entry类型为</text>
<text text-anchor="start" x="494.5" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> EntryConfChange</text>
<text text-anchor="start" x="494.5" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> EntryConfChangeV2</text>
</g>
<!-- RawNode_propose_conf_change&#45;&gt;RaftCore_step -->
<g id="edge8" class="edge">
<title>RawNode_propose_conf_change&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M682.51,-198.11C693.12,-203.54 703.75,-208.97 713.92,-214.17"/>
<polygon fill="#666666" stroke="#666666" points="712.62,-217.44 723.12,-218.88 715.81,-211.21 712.62,-217.44"/>
</g>
<!-- RawNode_read_index -->
<g id="node9" class="node">
<title>RawNode_read_index</title>
<path fill="none" stroke="#1c2123" d="M494,-0.5C494,-0.5 675,-0.5 675,-0.5 681,-0.5 687,-6.5 687,-12.5 687,-12.5 687,-64.5 687,-64.5 687,-70.5 681,-76.5 675,-76.5 675,-76.5 494,-76.5 494,-76.5 488,-76.5 482,-70.5 482,-64.5 482,-64.5 482,-12.5 482,-12.5 482,-6.5 488,-0.5 494,-0.5"/>
<text text-anchor="middle" x="584.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_read_index</text>
<polyline fill="none" stroke="#1c2123" points="482,-53.5 687,-53.5 "/>
<text text-anchor="start" x="490" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">request a read state</text>
<text text-anchor="start" x="490" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> The read state will be set in ready</text>
<text text-anchor="start" x="490" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MessageType::MsgReadIndex</text>
</g>
<!-- RawNode_read_index&#45;&gt;RaftCore_step -->
<g id="edge9" class="edge">
<title>RawNode_read_index&#45;&gt;RaftCore_step</title>
<path fill="none" stroke="#666666" d="M675.99,-76.62C679.86,-79.41 683.55,-82.37 687,-85.5 725,-120.02 752.27,-173.16 767.82,-209.54"/>
<polygon fill="#666666" stroke="#666666" points="764.63,-210.98 771.7,-218.86 771.09,-208.28 764.63,-210.98"/>
</g>
</g>
</svg>
