<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_storage_entries Pages: 1 -->
<svg width="1489pt" height="699pt"
 viewBox="0.00 0.00 1489.00 699.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 695)">
<title>raft_storage_entries</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-695 1485,-695 1485,4 -4,4"/>
<!-- RaftLog_entries -->
<g id="node1" class="node">
<title>RaftLog_entries</title>
<path fill="none" stroke="#1c2123" d="M1012.5,-113C1012.5,-113 1150.5,-113 1150.5,-113 1156.5,-113 1162.5,-119 1162.5,-125 1162.5,-125 1162.5,-162 1162.5,-162 1162.5,-168 1156.5,-174 1150.5,-174 1150.5,-174 1012.5,-174 1012.5,-174 1006.5,-174 1000.5,-168 1000.5,-162 1000.5,-162 1000.5,-125 1000.5,-125 1000.5,-119 1006.5,-113 1012.5,-113"/>
<text text-anchor="middle" x="1081.5" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_entries</text>
<polyline fill="none" stroke="#1c2123" points="1000.5,-151 1162.5,-151 "/>
<text text-anchor="start" x="1008.5" y="-135.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备要发送给follower的</text>
<text text-anchor="start" x="1008.5" y="-120.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entries</text>
</g>
<!-- RaftLog_slice -->
<g id="node2" class="node">
<title>RaftLog_slice</title>
<path fill="none" stroke="#1c2123" d="M1309.5,-239.5C1309.5,-239.5 1240.5,-239.5 1240.5,-239.5 1234.5,-239.5 1228.5,-233.5 1228.5,-227.5 1228.5,-227.5 1228.5,-215.5 1228.5,-215.5 1228.5,-209.5 1234.5,-203.5 1240.5,-203.5 1240.5,-203.5 1309.5,-203.5 1309.5,-203.5 1315.5,-203.5 1321.5,-209.5 1321.5,-215.5 1321.5,-215.5 1321.5,-227.5 1321.5,-227.5 1321.5,-233.5 1315.5,-239.5 1309.5,-239.5"/>
<text text-anchor="middle" x="1275" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_slice</text>
</g>
<!-- RaftLog_entries&#45;&gt;RaftLog_slice -->
<g id="edge1" class="edge">
<title>RaftLog_entries&#45;&gt;RaftLog_slice</title>
<path fill="none" stroke="#666666" d="M1157.64,-174.1C1178.62,-182.65 1200.99,-191.76 1220.45,-199.69"/>
<polygon fill="#666666" stroke="#666666" points="1219.17,-202.94 1229.75,-203.48 1221.81,-196.46 1219.17,-202.94"/>
</g>
<!-- Storage_entries -->
<g id="node3" class="node">
<title>Storage_entries</title>
<path fill="none" stroke="#1c2123" d="M1463.5,-239.5C1463.5,-239.5 1386.5,-239.5 1386.5,-239.5 1380.5,-239.5 1374.5,-233.5 1374.5,-227.5 1374.5,-227.5 1374.5,-215.5 1374.5,-215.5 1374.5,-209.5 1380.5,-203.5 1386.5,-203.5 1386.5,-203.5 1463.5,-203.5 1463.5,-203.5 1469.5,-203.5 1475.5,-209.5 1475.5,-215.5 1475.5,-215.5 1475.5,-227.5 1475.5,-227.5 1475.5,-233.5 1469.5,-239.5 1463.5,-239.5"/>
<text text-anchor="middle" x="1425" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Storage_entries</text>
</g>
<!-- RaftLog_slice&#45;&gt;Storage_entries -->
<g id="edge2" class="edge">
<title>RaftLog_slice&#45;&gt;Storage_entries</title>
<path fill="none" stroke="#666666" d="M1321.61,-221.5C1335.08,-221.5 1350.02,-221.5 1364.23,-221.5"/>
<polygon fill="#666666" stroke="#666666" points="1364.42,-225 1374.42,-221.5 1364.42,-218 1364.42,-225"/>
</g>
<!-- RaftLog_maybe_append -->
<g id="node4" class="node">
<title>RaftLog_maybe_append</title>
<path fill="none" stroke="#1c2123" d="M733.5,-278C733.5,-278 895.5,-278 895.5,-278 901.5,-278 907.5,-284 907.5,-290 907.5,-290 907.5,-357 907.5,-357 907.5,-363 901.5,-369 895.5,-369 895.5,-369 733.5,-369 733.5,-369 727.5,-369 721.5,-363 721.5,-357 721.5,-357 721.5,-290 721.5,-290 721.5,-284 727.5,-278 733.5,-278"/>
<text text-anchor="middle" x="814.5" y="-353.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_maybe_append</text>
<polyline fill="none" stroke="#1c2123" points="721.5,-346 907.5,-346 "/>
<text text-anchor="start" x="729.5" y="-330.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">找到conflict index</text>
<text text-anchor="start" x="729.5" y="-315.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> start = (conflic_idx &#45; (idx +1))</text>
<text text-anchor="start" x="729.5" y="-300.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将start之后的log entries </text>
<text text-anchor="start" x="729.5" y="-285.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 用新的覆盖掉</text>
</g>
<!-- RaftLog_find_conflict -->
<g id="node5" class="node">
<title>RaftLog_find_conflict</title>
<path fill="none" stroke="#1c2123" d="M1138,-341.5C1138,-341.5 1025,-341.5 1025,-341.5 1019,-341.5 1013,-335.5 1013,-329.5 1013,-329.5 1013,-317.5 1013,-317.5 1013,-311.5 1019,-305.5 1025,-305.5 1025,-305.5 1138,-305.5 1138,-305.5 1144,-305.5 1150,-311.5 1150,-317.5 1150,-317.5 1150,-329.5 1150,-329.5 1150,-335.5 1144,-341.5 1138,-341.5"/>
<text text-anchor="middle" x="1081.5" y="-319.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_find_conflict</text>
</g>
<!-- RaftLog_maybe_append&#45;&gt;RaftLog_find_conflict -->
<g id="edge3" class="edge">
<title>RaftLog_maybe_append&#45;&gt;RaftLog_find_conflict</title>
<path fill="none" stroke="#666666" d="M907.81,-323.5C938.68,-323.5 972.76,-323.5 1002.43,-323.5"/>
<polygon fill="#666666" stroke="#666666" points="1002.73,-327 1012.73,-323.5 1002.73,-320 1002.73,-327"/>
</g>
<!-- RaftCore_handle_append_entries -->
<g id="node6" class="node">
<title>RaftCore_handle_append_entries</title>
<path fill="none" stroke="#1c2123" d="M456,-298C456,-298 629,-298 629,-298 635,-298 641,-304 641,-310 641,-310 641,-347 641,-347 641,-353 635,-359 629,-359 629,-359 456,-359 456,-359 450,-359 444,-353 444,-347 444,-347 444,-310 444,-310 444,-304 450,-298 456,-298"/>
<text text-anchor="middle" x="542.5" y="-343.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_append_entries</text>
<polyline fill="none" stroke="#1c2123" points="444,-336 641,-336 "/>
<text text-anchor="start" x="452" y="-320.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理leader发送的</text>
<text text-anchor="start" x="452" y="-305.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MsgAppend消息</text>
</g>
<!-- RaftCore_handle_append_entries&#45;&gt;RaftLog_maybe_append -->
<g id="edge4" class="edge">
<title>RaftCore_handle_append_entries&#45;&gt;RaftLog_maybe_append</title>
<path fill="none" stroke="#666666" d="M641.36,-326.69C664.1,-326.27 688.37,-325.82 711.29,-325.39"/>
<polygon fill="#666666" stroke="#666666" points="711.44,-328.89 721.37,-325.21 711.31,-321.89 711.44,-328.89"/>
</g>
<!-- RaftLog_next_entries_since -->
<g id="node7" class="node">
<title>RaftLog_next_entries_since</title>
<path fill="none" stroke="#1c2123" d="M1154,-468.5C1154,-468.5 1009,-468.5 1009,-468.5 1003,-468.5 997,-462.5 997,-456.5 997,-456.5 997,-444.5 997,-444.5 997,-438.5 1003,-432.5 1009,-432.5 1009,-432.5 1154,-432.5 1154,-432.5 1160,-432.5 1166,-438.5 1166,-444.5 1166,-444.5 1166,-456.5 1166,-456.5 1166,-462.5 1160,-468.5 1154,-468.5"/>
<text text-anchor="middle" x="1081.5" y="-446.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_next_entries_since</text>
</g>
<!-- RaftLog_next_entries_since&#45;&gt;RaftLog_slice -->
<g id="edge5" class="edge">
<title>RaftLog_next_entries_since&#45;&gt;RaftLog_slice</title>
<path fill="none" stroke="#666666" d="M1102.29,-432.15C1122.85,-412.7 1155.53,-380.66 1181,-350.5 1209.49,-316.77 1238.67,-274.84 1256.57,-248.12"/>
<polygon fill="#666666" stroke="#666666" points="1259.56,-249.94 1262.19,-239.67 1253.74,-246.06 1259.56,-249.94"/>
</g>
<!-- RaftCore_hup -->
<g id="node8" class="node">
<title>RaftCore_hup</title>
<path fill="none" stroke="#1c2123" d="M483,-202.5C483,-202.5 602,-202.5 602,-202.5 608,-202.5 614,-208.5 614,-214.5 614,-214.5 614,-266.5 614,-266.5 614,-272.5 608,-278.5 602,-278.5 602,-278.5 483,-278.5 483,-278.5 477,-278.5 471,-272.5 471,-266.5 471,-266.5 471,-214.5 471,-214.5 471,-208.5 477,-202.5 483,-202.5"/>
<text text-anchor="middle" x="542.5" y="-263.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_hup</text>
<polyline fill="none" stroke="#1c2123" points="471,-255.5 614,-255.5 "/>
<text text-anchor="start" x="479" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">收到MsgTimeoutNow</text>
<text text-anchor="start" x="479" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者MsgHup</text>
<text text-anchor="start" x="479" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发起竞选</text>
</g>
<!-- RaftCore_hup&#45;&gt;RaftLog_slice -->
<g id="edge6" class="edge">
<title>RaftCore_hup&#45;&gt;RaftLog_slice</title>
<path fill="none" stroke="#666666" d="M614.21,-238.66C759.06,-234.89 1086.92,-226.37 1218.15,-222.95"/>
<polygon fill="#666666" stroke="#666666" points="1218.47,-226.45 1228.38,-222.69 1218.29,-219.45 1218.47,-226.45"/>
</g>
<!-- RaftCore_maybe_commit_by_vote -->
<g id="node9" class="node">
<title>RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="#1c2123" d="M450,-122C450,-122 635,-122 635,-122 641,-122 647,-128 647,-134 647,-134 647,-171 647,-171 647,-177 641,-183 635,-183 635,-183 450,-183 450,-183 444,-183 438,-177 438,-171 438,-171 438,-134 438,-134 438,-128 444,-122 450,-122"/>
<text text-anchor="middle" x="542.5" y="-167.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_maybe_commit_by_vote</text>
<polyline fill="none" stroke="#1c2123" points="438,-160 647,-160 "/>
<text text-anchor="start" x="446" y="-144.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commits the logs using</text>
<text text-anchor="start" x="446" y="-129.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit info in vote message</text>
</g>
<!-- RaftCore_maybe_commit_by_vote&#45;&gt;RaftLog_slice -->
<g id="edge7" class="edge">
<title>RaftCore_maybe_commit_by_vote&#45;&gt;RaftLog_slice</title>
<path fill="none" stroke="#666666" d="M647.39,-162.31C804.12,-177.12 1095.7,-204.66 1217.87,-216.2"/>
<polygon fill="#666666" stroke="#666666" points="1217.82,-219.71 1228.11,-217.17 1218.48,-212.74 1217.82,-219.71"/>
</g>
<!-- RaftCore_step -->
<g id="node10" class="node">
<title>RaftCore_step</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M12,-172C12,-172 164,-172 164,-172 170,-172 176,-178 176,-184 176,-184 176,-221 176,-221 176,-227 170,-233 164,-233 164,-233 12,-233 12,-233 6,-233 0,-227 0,-221 0,-221 0,-184 0,-184 0,-178 6,-172 12,-172"/>
<text text-anchor="middle" x="88" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_step</text>
<polyline fill="none" stroke="#8a8898" points="0,-210 176,-210 "/>
<text text-anchor="start" x="8" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">raft along via a message</text>
<text text-anchor="start" x="8" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 处理raft从peer收到的消息</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_hup -->
<g id="edge8" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_hup</title>
<path fill="none" stroke="red" d="M176.31,-212.88C188.29,-214.18 200.44,-215.42 212,-216.5 296.74,-224.41 393.94,-231.21 460.69,-235.53"/>
<polygon fill="red" stroke="red" points="460.52,-239.03 470.73,-236.18 460.97,-232.04 460.52,-239.03"/>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_maybe_commit_by_vote -->
<g id="edge9" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="red" d="M176.04,-200.39C239.03,-198.03 326.09,-193.03 402,-182.5 410.47,-181.33 419.19,-179.92 427.94,-178.37"/>
<polygon fill="red" stroke="red" points="428.61,-181.81 437.82,-176.57 427.35,-174.92 428.61,-181.81"/>
</g>
<!-- RaftCore_step_leader -->
<g id="node11" class="node">
<title>RaftCore_step_leader</title>
<path fill="none" stroke="#1c2123" d="M252,-48.5C252,-48.5 362,-48.5 362,-48.5 368,-48.5 374,-54.5 374,-60.5 374,-60.5 374,-82.5 374,-82.5 374,-88.5 368,-94.5 362,-94.5 362,-94.5 252,-94.5 252,-94.5 246,-94.5 240,-88.5 240,-82.5 240,-82.5 240,-60.5 240,-60.5 240,-54.5 246,-48.5 252,-48.5"/>
<text text-anchor="middle" x="307" y="-79.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_leader</text>
<polyline fill="none" stroke="#1c2123" points="240,-71.5 374,-71.5 "/>
<text text-anchor="start" x="248" y="-56.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role为leader</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_leader -->
<g id="edge10" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_leader</title>
<path fill="none" stroke="red" d="M129.83,-171.99C153.3,-155.05 183.67,-134.1 212,-117.5 222.76,-111.2 234.51,-104.96 245.95,-99.22"/>
<polygon fill="red" stroke="red" points="247.61,-102.3 255.02,-94.73 244.51,-96.03 247.61,-102.3"/>
</g>
<!-- RaftCore_step_candidate -->
<g id="node12" class="node">
<title>RaftCore_step_candidate</title>
<path fill="none" stroke="#1c2123" d="M242.5,-127.5C242.5,-127.5 371.5,-127.5 371.5,-127.5 377.5,-127.5 383.5,-133.5 383.5,-139.5 383.5,-139.5 383.5,-161.5 383.5,-161.5 383.5,-167.5 377.5,-173.5 371.5,-173.5 371.5,-173.5 242.5,-173.5 242.5,-173.5 236.5,-173.5 230.5,-167.5 230.5,-161.5 230.5,-161.5 230.5,-139.5 230.5,-139.5 230.5,-133.5 236.5,-127.5 242.5,-127.5"/>
<text text-anchor="middle" x="307" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_candidate</text>
<polyline fill="none" stroke="#1c2123" points="230.5,-150.5 383.5,-150.5 "/>
<text text-anchor="start" x="238.5" y="-135.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role 为candiate</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_candidate -->
<g id="edge11" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_candidate</title>
<path fill="none" stroke="red" d="M176.01,-181.65C190.57,-178.16 205.67,-174.54 220.21,-171.06"/>
<polygon fill="red" stroke="red" points="221.25,-174.41 230.16,-168.67 219.62,-167.6 221.25,-174.41"/>
</g>
<!-- RaftCore_step_follower -->
<g id="node13" class="node">
<title>RaftCore_step_follower</title>
<path fill="none" stroke="#1c2123" d="M245.5,-287.5C245.5,-287.5 368.5,-287.5 368.5,-287.5 374.5,-287.5 380.5,-293.5 380.5,-299.5 380.5,-299.5 380.5,-321.5 380.5,-321.5 380.5,-327.5 374.5,-333.5 368.5,-333.5 368.5,-333.5 245.5,-333.5 245.5,-333.5 239.5,-333.5 233.5,-327.5 233.5,-321.5 233.5,-321.5 233.5,-299.5 233.5,-299.5 233.5,-293.5 239.5,-287.5 245.5,-287.5"/>
<text text-anchor="middle" x="307" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_follower</text>
<polyline fill="none" stroke="#1c2123" points="233.5,-310.5 380.5,-310.5 "/>
<text text-anchor="middle" x="307" y="-295.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role为follower</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_follower -->
<g id="edge12" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_follower</title>
<path fill="none" stroke="red" d="M150.31,-233.02C181.78,-248.67 219.81,-267.6 250.41,-282.83"/>
<polygon fill="red" stroke="red" points="249.14,-286.11 259.65,-287.43 252.26,-279.84 249.14,-286.11"/>
</g>
<!-- RaftCore_handle_append_response -->
<g id="node14" class="node">
<title>RaftCore_handle_append_response</title>
<path fill="none" stroke="#1c2123" d="M450,-12C450,-12 635,-12 635,-12 641,-12 647,-18 647,-24 647,-24 647,-91 647,-91 647,-97 641,-103 635,-103 635,-103 450,-103 450,-103 444,-103 438,-97 438,-91 438,-91 438,-24 438,-24 438,-18 444,-12 450,-12"/>
<text text-anchor="middle" x="542.5" y="-87.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_append_response</text>
<polyline fill="none" stroke="#1c2123" points="438,-80 647,-80 "/>
<text text-anchor="start" x="446" y="-64.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理follower返回的append resp</text>
<text text-anchor="start" x="446" y="-49.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.更新peer的ProcessTracker</text>
<text text-anchor="start" x="446" y="-34.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.更新完follower的控制信息后</text>
<text text-anchor="start" x="446" y="-19.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送多个append给follower</text>
</g>
<!-- RaftCore_step_leader&#45;&gt;RaftCore_handle_append_response -->
<g id="edge13" class="edge">
<title>RaftCore_step_leader&#45;&gt;RaftCore_handle_append_response</title>
<path fill="none" stroke="#666666" d="M374.29,-67.53C391.01,-66.52 409.44,-65.42 427.78,-64.32"/>
<polygon fill="#666666" stroke="#666666" points="428.17,-67.8 437.94,-63.71 427.75,-60.81 428.17,-67.8"/>
</g>
<!-- RaftCore_step_candidate&#45;&gt;RaftCore_maybe_commit_by_vote -->
<g id="edge17" class="edge">
<title>RaftCore_step_candidate&#45;&gt;RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="blue" d="M383.81,-151.15C397.77,-151.27 412.62,-151.4 427.41,-151.52"/>
<polygon fill="blue" stroke="blue" points="427.61,-155.02 437.63,-151.61 427.67,-148.02 427.61,-155.02"/>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_handle_append_entries -->
<g id="edge14" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_handle_append_entries</title>
<path fill="none" stroke="#666666" d="M380.6,-316.1C397.28,-317.38 415.36,-318.78 433.18,-320.15"/>
<polygon fill="#666666" stroke="#666666" points="433.39,-323.68 443.63,-320.96 433.93,-316.7 433.39,-323.68"/>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_hup -->
<g id="edge15" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_hup</title>
<path fill="none" stroke="#666666" d="M380.6,-288.74C406.12,-281.08 434.95,-272.44 461.08,-264.61"/>
<polygon fill="#666666" stroke="#666666" points="462.37,-267.88 470.94,-261.65 460.36,-261.17 462.37,-267.88"/>
</g>
<!-- RaftCore_handle_snapshot -->
<g id="node17" class="node">
<title>RaftCore_handle_snapshot</title>
<path fill="none" stroke="#1c2123" d="M456,-378.5C456,-378.5 629,-378.5 629,-378.5 635,-378.5 641,-384.5 641,-390.5 641,-390.5 641,-412.5 641,-412.5 641,-418.5 635,-424.5 629,-424.5 629,-424.5 456,-424.5 456,-424.5 450,-424.5 444,-418.5 444,-412.5 444,-412.5 444,-390.5 444,-390.5 444,-384.5 450,-378.5 456,-378.5"/>
<text text-anchor="middle" x="542.5" y="-409.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="444,-401.5 641,-401.5 "/>
<text text-anchor="start" x="452" y="-386.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理leader发送的snapshot消息</text>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_handle_snapshot -->
<g id="edge16" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_handle_snapshot</title>
<path fill="none" stroke="#666666" d="M356.23,-333.55C380.5,-344.76 410.52,-358.03 438,-368.5 443.9,-370.75 450.02,-372.97 456.22,-375.14"/>
<polygon fill="#666666" stroke="#666666" points="455.38,-378.56 465.98,-378.5 457.66,-371.94 455.38,-378.56"/>
</g>
<!-- RaftCore_maybe_send_append -->
<g id="node15" class="node">
<title>RaftCore_maybe_send_append</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M731,-0.5C731,-0.5 898,-0.5 898,-0.5 904,-0.5 910,-6.5 910,-12.5 910,-12.5 910,-102.5 910,-102.5 910,-108.5 904,-114.5 898,-114.5 898,-114.5 731,-114.5 731,-114.5 725,-114.5 719,-108.5 719,-102.5 719,-102.5 719,-12.5 719,-12.5 719,-6.5 725,-0.5 731,-0.5"/>
<text text-anchor="middle" x="814.5" y="-99.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_maybe_send_append</text>
<polyline fill="none" stroke="#8a8898" points="719,-91.5 910,-91.5 "/>
<text text-anchor="start" x="727" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Sends an append RPC with new</text>
<text text-anchor="start" x="727" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> entries to the given peer</text>
<polyline fill="none" stroke="#8a8898" points="719,-53.5 910,-53.5 "/>
<text text-anchor="start" x="727" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">根据follower落后的情况</text>
<text text-anchor="start" x="727" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 可能发送entries</text>
<text text-anchor="start" x="727" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 也可能发送snapshot</text>
</g>
<!-- RaftCore_handle_append_response&#45;&gt;RaftCore_maybe_send_append -->
<g id="edge22" class="edge">
<title>RaftCore_handle_append_response&#45;&gt;RaftCore_maybe_send_append</title>
<path fill="none" stroke="#666666" d="M647.12,-57.5C667.22,-57.5 688.3,-57.5 708.45,-57.5"/>
<polygon fill="#666666" stroke="#666666" points="708.57,-61 718.57,-57.5 708.57,-54 708.57,-61"/>
</g>
<!-- RaftCore_maybe_send_append&#45;&gt;RaftLog_entries -->
<g id="edge20" class="edge">
<title>RaftCore_maybe_send_append&#45;&gt;RaftLog_entries</title>
<path fill="none" stroke="#666666" d="M910.05,-88.18C936.28,-96.7 964.67,-105.91 990.63,-114.33"/>
<polygon fill="#666666" stroke="#666666" points="989.85,-117.76 1000.44,-117.52 992.01,-111.1 989.85,-117.76"/>
</g>
<!-- RaftCore_prepare_send_snapshot -->
<g id="node16" class="node">
<title>RaftCore_prepare_send_snapshot</title>
<path fill="none" stroke="#1c2123" d="M994,-3C994,-3 1169,-3 1169,-3 1175,-3 1181,-9 1181,-15 1181,-15 1181,-82 1181,-82 1181,-88 1175,-94 1169,-94 1169,-94 994,-94 994,-94 988,-94 982,-88 982,-82 982,-82 982,-15 982,-15 982,-9 988,-3 994,-3"/>
<text text-anchor="middle" x="1081.5" y="-78.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_prepare_send_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="982,-71 1181,-71 "/>
<text text-anchor="start" x="990" y="-55.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备发送snapshot</text>
<text text-anchor="start" x="990" y="-40.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建snapshot</text>
<text text-anchor="start" x="990" y="-25.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后更新follower的</text>
<text text-anchor="start" x="990" y="-10.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> progressTracker</text>
</g>
<!-- RaftCore_maybe_send_append&#45;&gt;RaftCore_prepare_send_snapshot -->
<g id="edge21" class="edge">
<title>RaftCore_maybe_send_append&#45;&gt;RaftCore_prepare_send_snapshot</title>
<path fill="none" stroke="#666666" d="M910.05,-54.29C930.1,-53.61 951.43,-52.88 971.95,-52.19"/>
<polygon fill="#666666" stroke="#666666" points="972.08,-55.68 981.96,-51.85 971.85,-48.69 972.08,-55.68"/>
</g>
<!-- RaftLog_snapshot -->
<g id="node18" class="node">
<title>RaftLog_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1321,-66.5C1321,-66.5 1229,-66.5 1229,-66.5 1223,-66.5 1217,-60.5 1217,-54.5 1217,-54.5 1217,-42.5 1217,-42.5 1217,-36.5 1223,-30.5 1229,-30.5 1229,-30.5 1321,-30.5 1321,-30.5 1327,-30.5 1333,-36.5 1333,-42.5 1333,-42.5 1333,-54.5 1333,-54.5 1333,-60.5 1327,-66.5 1321,-66.5"/>
<text text-anchor="middle" x="1275" y="-44.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_snapshot</text>
</g>
<!-- RaftCore_prepare_send_snapshot&#45;&gt;RaftLog_snapshot -->
<g id="edge19" class="edge">
<title>RaftCore_prepare_send_snapshot&#45;&gt;RaftLog_snapshot</title>
<path fill="none" stroke="#666666" d="M1181.05,-48.5C1189.79,-48.5 1198.48,-48.5 1206.86,-48.5"/>
<polygon fill="#666666" stroke="#666666" points="1206.9,-52 1216.9,-48.5 1206.9,-45 1206.9,-52"/>
</g>
<!-- RaftCore_restore -->
<g id="node20" class="node">
<title>RaftCore_restore</title>
<path fill="none" stroke="#1c2123" d="M857.5,-423.5C857.5,-423.5 771.5,-423.5 771.5,-423.5 765.5,-423.5 759.5,-417.5 759.5,-411.5 759.5,-411.5 759.5,-399.5 759.5,-399.5 759.5,-393.5 765.5,-387.5 771.5,-387.5 771.5,-387.5 857.5,-387.5 857.5,-387.5 863.5,-387.5 869.5,-393.5 869.5,-399.5 869.5,-399.5 869.5,-411.5 869.5,-411.5 869.5,-417.5 863.5,-423.5 857.5,-423.5"/>
<text text-anchor="middle" x="814.5" y="-401.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_restore</text>
</g>
<!-- RaftCore_handle_snapshot&#45;&gt;RaftCore_restore -->
<g id="edge23" class="edge">
<title>RaftCore_handle_snapshot&#45;&gt;RaftCore_restore</title>
<path fill="none" stroke="#666666" d="M641.36,-402.95C677.17,-403.48 716.77,-404.07 748.95,-404.54"/>
<polygon fill="#666666" stroke="#666666" points="749.07,-408.05 759.12,-404.69 749.17,-401.05 749.07,-408.05"/>
</g>
<!-- Storage_snapshot -->
<g id="node19" class="node">
<title>Storage_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1469,-66.5C1469,-66.5 1381,-66.5 1381,-66.5 1375,-66.5 1369,-60.5 1369,-54.5 1369,-54.5 1369,-42.5 1369,-42.5 1369,-36.5 1375,-30.5 1381,-30.5 1381,-30.5 1469,-30.5 1469,-30.5 1475,-30.5 1481,-36.5 1481,-42.5 1481,-42.5 1481,-54.5 1481,-54.5 1481,-60.5 1475,-66.5 1469,-66.5"/>
<text text-anchor="middle" x="1425" y="-44.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Storage_snapshot</text>
</g>
<!-- RaftLog_snapshot&#45;&gt;Storage_snapshot -->
<g id="edge18" class="edge">
<title>RaftLog_snapshot&#45;&gt;Storage_snapshot</title>
<path fill="none" stroke="#666666" d="M1333.22,-48.5C1341.55,-48.5 1350.17,-48.5 1358.65,-48.5"/>
<polygon fill="#666666" stroke="#666666" points="1358.88,-52 1368.88,-48.5 1358.88,-45 1358.88,-52"/>
</g>
<!-- RawNode_advance_append -->
<g id="node21" class="node">
<title>RawNode_advance_append</title>
<path fill="none" stroke="#1c2123" d="M455.5,-614.5C455.5,-614.5 629.5,-614.5 629.5,-614.5 635.5,-614.5 641.5,-620.5 641.5,-626.5 641.5,-626.5 641.5,-678.5 641.5,-678.5 641.5,-684.5 635.5,-690.5 629.5,-690.5 629.5,-690.5 455.5,-690.5 455.5,-690.5 449.5,-690.5 443.5,-684.5 443.5,-678.5 443.5,-678.5 443.5,-626.5 443.5,-626.5 443.5,-620.5 449.5,-614.5 455.5,-614.5"/>
<text text-anchor="middle" x="542.5" y="-675.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_advance_append</text>
<polyline fill="none" stroke="#1c2123" points="443.5,-667.5 641.5,-667.5 "/>
<text text-anchor="start" x="451.5" y="-652.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Returns LightReady that</text>
<text text-anchor="start" x="451.5" y="-637.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> contains commit index</text>
<text text-anchor="start" x="451.5" y="-622.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> committed entries and messages</text>
</g>
<!-- RawNode_gen_light_ready -->
<g id="node22" class="node">
<title>RawNode_gen_light_ready</title>
<path fill="#feed9b" stroke="#f7e495" d="M695,-462.5C695,-462.5 934,-462.5 934,-462.5 940,-462.5 946,-468.5 946,-474.5 946,-474.5 946,-564.5 946,-564.5 946,-570.5 940,-576.5 934,-576.5 934,-576.5 695,-576.5 695,-576.5 689,-576.5 683,-570.5 683,-564.5 683,-564.5 683,-474.5 683,-474.5 683,-468.5 689,-462.5 695,-462.5"/>
<text text-anchor="middle" x="814.5" y="-561.3" font-family="Times,serif" font-size="14.00" fill="#40575d">RawNode_gen_light_ready</text>
<polyline fill="none" stroke="#f7e495" points="683,-553.5 946,-553.5 "/>
<text text-anchor="start" x="691" y="-538.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Generates a LightReady</text>
<text text-anchor="start" x="691" y="-523.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> that has the committed entries </text>
<text text-anchor="start" x="691" y="-508.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> and messages but no commit index</text>
<text text-anchor="start" x="691" y="-493.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 获取从commit_since_index后的log entries</text>
<polyline fill="none" stroke="#f7e495" points="683,-485.5 946,-485.5 "/>
<text text-anchor="start" x="691" y="-470.3" font-family="Times,serif" font-size="14.00" fill="#40575d">更新RawNode的commit_since_index变量</text>
</g>
<!-- RawNode_advance_append&#45;&gt;RawNode_gen_light_ready -->
<g id="edge24" class="edge">
<title>RawNode_advance_append&#45;&gt;RawNode_gen_light_ready</title>
<path fill="none" stroke="#666666" d="M628.39,-614.37C634.7,-611.41 640.96,-608.43 647,-605.5 662.93,-597.77 679.61,-589.45 696.01,-581.12"/>
<polygon fill="#666666" stroke="#666666" points="697.76,-584.16 705.08,-576.5 694.58,-577.92 697.76,-584.16"/>
</g>
<!-- RawNode_gen_light_ready&#45;&gt;RaftLog_next_entries_since -->
<g id="edge27" class="edge">
<title>RawNode_gen_light_ready&#45;&gt;RaftLog_next_entries_since</title>
<path fill="none" stroke="#666666" d="M946.06,-485.51C964.84,-480.61 983.68,-475.71 1001.06,-471.18"/>
<polygon fill="#666666" stroke="#666666" points="1002.31,-474.47 1011.11,-468.57 1000.55,-467.7 1002.31,-474.47"/>
</g>
<!-- RawNode_advance -->
<g id="node23" class="node">
<title>RawNode_advance</title>
<path fill="none" stroke="#1c2123" d="M224,-614.5C224,-614.5 390,-614.5 390,-614.5 396,-614.5 402,-620.5 402,-626.5 402,-626.5 402,-678.5 402,-678.5 402,-684.5 396,-690.5 390,-690.5 390,-690.5 224,-690.5 224,-690.5 218,-690.5 212,-684.5 212,-678.5 212,-678.5 212,-626.5 212,-626.5 212,-620.5 218,-614.5 224,-614.5"/>
<text text-anchor="middle" x="307" y="-675.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_advance(Ready)</text>
<polyline fill="none" stroke="#1c2123" points="212,-667.5 402,-667.5 "/>
<text text-anchor="start" x="220" y="-652.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">advance the ready </text>
<text text-anchor="start" x="220" y="-637.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> after full procssing it</text>
<text text-anchor="start" x="220" y="-622.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> applied = commit_since_index</text>
</g>
<!-- RawNode_advance&#45;&gt;RawNode_advance_append -->
<g id="edge25" class="edge">
<title>RawNode_advance&#45;&gt;RawNode_advance_append</title>
<path fill="none" stroke="#666666" d="M402.3,-652.5C412.46,-652.5 422.85,-652.5 433.16,-652.5"/>
<polygon fill="#666666" stroke="#666666" points="433.42,-656 443.42,-652.5 433.42,-649 433.42,-656"/>
</g>
<!-- RawNode_ready -->
<g id="node24" class="node">
<title>RawNode_ready</title>
<path fill="none" stroke="#1c2123" d="M458,-443.5C458,-443.5 627,-443.5 627,-443.5 633,-443.5 639,-449.5 639,-455.5 639,-455.5 639,-583.5 639,-583.5 639,-589.5 633,-595.5 627,-595.5 627,-595.5 458,-595.5 458,-595.5 452,-595.5 446,-589.5 446,-583.5 446,-583.5 446,-455.5 446,-455.5 446,-449.5 452,-443.5 458,-443.5"/>
<text text-anchor="middle" x="542.5" y="-580.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RawNode_ready</text>
<polyline fill="none" stroke="#1c2123" points="446,-572.5 639,-572.5 "/>
<text text-anchor="start" x="454" y="-557.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Returns the outstanding worker</text>
<text text-anchor="start" x="454" y="-542.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> that application needs to handle</text>
<polyline fill="none" stroke="#1c2123" points="446,-534.5 639,-534.5 "/>
<text text-anchor="start" x="454" y="-519.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">返回Ready</text>
<polyline fill="none" stroke="#1c2123" points="446,-511.5 639,-511.5 "/>
<text text-anchor="start" x="454" y="-496.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.需要发送的Raft Message</text>
<text text-anchor="start" x="454" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.需要持久化的log entries</text>
<text text-anchor="start" x="454" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 3.需要apply 的snapshot</text>
<text text-anchor="start" x="454" y="-451.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 4.需要保存的hardstate</text>
</g>
<!-- RawNode_ready&#45;&gt;RawNode_gen_light_ready -->
<g id="edge26" class="edge">
<title>RawNode_ready&#45;&gt;RawNode_gen_light_ready</title>
<path fill="none" stroke="#666666" d="M639.07,-519.5C649.87,-519.5 661.04,-519.5 672.27,-519.5"/>
<polygon fill="#666666" stroke="#666666" points="672.59,-523 682.59,-519.5 672.59,-516 672.59,-523"/>
</g>
</g>
</svg>
