<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_storage Pages: 1 -->
<svg width="1750pt" height="746pt"
 viewBox="0.00 0.00 1750.00 745.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 741.5)">
<title>raft_storage</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-741.5 1746,-741.5 1746,4 -4,4"/>
<!-- RaftLog_term -->
<g id="node1" class="node">
<title>RaftLog_term</title>
<path fill="none" stroke="#1c2123" d="M1516,-230.5C1516,-230.5 1604,-230.5 1604,-230.5 1610,-230.5 1616,-236.5 1616,-242.5 1616,-242.5 1616,-279.5 1616,-279.5 1616,-285.5 1610,-291.5 1604,-291.5 1604,-291.5 1516,-291.5 1516,-291.5 1510,-291.5 1504,-285.5 1504,-279.5 1504,-279.5 1504,-242.5 1504,-242.5 1504,-236.5 1510,-230.5 1516,-230.5"/>
<text text-anchor="middle" x="1560" y="-276.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_term</text>
<polyline fill="none" stroke="#1c2123" points="1504,-268.5 1616,-268.5 "/>
<text text-anchor="start" x="1512" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取给定idx log</text>
<text text-anchor="start" x="1512" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entry的term</text>
</g>
<!-- Storage_term -->
<g id="node2" class="node">
<title>Storage_term</title>
<path fill="none" stroke="#1c2123" d="M1730,-279C1730,-279 1664,-279 1664,-279 1658,-279 1652,-273 1652,-267 1652,-267 1652,-255 1652,-255 1652,-249 1658,-243 1664,-243 1664,-243 1730,-243 1730,-243 1736,-243 1742,-249 1742,-255 1742,-255 1742,-267 1742,-267 1742,-273 1736,-279 1730,-279"/>
<text text-anchor="middle" x="1697" y="-257.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Storage_term</text>
</g>
<!-- RaftLog_term&#45;&gt;Storage_term -->
<g id="edge1" class="edge">
<title>RaftLog_term&#45;&gt;Storage_term</title>
<path fill="none" stroke="#666666" d="M1616.3,-261C1624.69,-261 1633.33,-261 1641.7,-261"/>
<polygon fill="#666666" stroke="#666666" points="1641.72,-264.5 1651.72,-261 1641.72,-257.5 1641.72,-264.5"/>
</g>
<!-- RaftLog_last_term -->
<g id="node3" class="node">
<title>RaftLog_last_term</title>
<path fill="none" stroke="#1c2123" d="M1267,-303C1267,-303 1434,-303 1434,-303 1440,-303 1446,-309 1446,-315 1446,-315 1446,-337 1446,-337 1446,-343 1440,-349 1434,-349 1434,-349 1267,-349 1267,-349 1261,-349 1255,-343 1255,-337 1255,-337 1255,-315 1255,-315 1255,-309 1261,-303 1267,-303"/>
<text text-anchor="middle" x="1350.5" y="-333.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_last_term</text>
<polyline fill="none" stroke="#1c2123" points="1255,-326 1446,-326 "/>
<text text-anchor="start" x="1263" y="-310.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">自己最后一个log entry的term</text>
</g>
<!-- RaftLog_last_term&#45;&gt;RaftLog_term -->
<g id="edge2" class="edge">
<title>RaftLog_last_term&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M1435.37,-302.92C1446.38,-299.69 1457.48,-296.34 1468,-293 1476.56,-290.29 1485.52,-287.31 1494.35,-284.29"/>
<polygon fill="#666666" stroke="#666666" points="1495.53,-287.58 1503.84,-281.01 1493.25,-280.97 1495.53,-287.58"/>
</g>
<!-- RaftLog_commit_info -->
<g id="node4" class="node">
<title>RaftLog_commit_info</title>
<path fill="none" stroke="#1c2123" d="M1276,-238C1276,-238 1425,-238 1425,-238 1431,-238 1437,-244 1437,-250 1437,-250 1437,-272 1437,-272 1437,-278 1431,-284 1425,-284 1425,-284 1276,-284 1276,-284 1270,-284 1264,-278 1264,-272 1264,-272 1264,-250 1264,-250 1264,-244 1270,-238 1276,-238"/>
<text text-anchor="middle" x="1350.5" y="-268.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_commit_info</text>
<polyline fill="none" stroke="#1c2123" points="1264,-261 1437,-261 "/>
<text text-anchor="start" x="1272" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">返回committed和它的term</text>
</g>
<!-- RaftLog_commit_info&#45;&gt;RaftLog_term -->
<g id="edge3" class="edge">
<title>RaftLog_commit_info&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M1437.1,-261C1456.04,-261 1475.81,-261 1493.78,-261"/>
<polygon fill="#666666" stroke="#666666" points="1493.85,-264.5 1503.85,-261 1493.85,-257.5 1493.85,-264.5"/>
</g>
<!-- RaftLog_maybe_persist -->
<g id="node5" class="node">
<title>RaftLog_maybe_persist</title>
<path fill="#feed9b" stroke="#f7e495" d="M261.5,-8C261.5,-8 389.5,-8 389.5,-8 395.5,-8 401.5,-14 401.5,-20 401.5,-20 401.5,-42 401.5,-42 401.5,-48 395.5,-54 389.5,-54 389.5,-54 261.5,-54 261.5,-54 255.5,-54 249.5,-48 249.5,-42 249.5,-42 249.5,-20 249.5,-20 249.5,-14 255.5,-8 261.5,-8"/>
<text text-anchor="middle" x="325.5" y="-38.8" font-family="Times,serif" font-size="14.00" fill="#40575d">RaftLog_maybe_persist</text>
<polyline fill="none" stroke="#f7e495" points="249.5,-31 401.5,-31 "/>
<text text-anchor="start" x="257.5" y="-15.8" font-family="Times,serif" font-size="14.00" fill="#40575d">更新RaftLog的persisted</text>
</g>
<!-- RaftLog_maybe_persist&#45;&gt;RaftLog_term -->
<g id="edge4" class="edge">
<title>RaftLog_maybe_persist&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M401.72,-31C493.15,-31 652.15,-31 788.5,-31 788.5,-31 788.5,-31 1065.5,-31 1244.63,-31 1320.78,50.05 1468,-52 1523.72,-90.62 1545.62,-171.15 1554.01,-220.2"/>
<polygon fill="#666666" stroke="#666666" points="1550.56,-220.84 1555.6,-230.16 1557.48,-219.73 1550.56,-220.84"/>
</g>
<!-- RaftLog_maybe_commit -->
<g id="node6" class="node">
<title>RaftLog_maybe_commit</title>
<path fill="none" stroke="#1c2123" d="M695,-59.5C695,-59.5 884,-59.5 884,-59.5 890,-59.5 896,-65.5 896,-71.5 896,-71.5 896,-108.5 896,-108.5 896,-114.5 890,-120.5 884,-120.5 884,-120.5 695,-120.5 695,-120.5 689,-120.5 683,-114.5 683,-108.5 683,-108.5 683,-71.5 683,-71.5 683,-65.5 689,-59.5 695,-59.5"/>
<text text-anchor="middle" x="789.5" y="-105.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_maybe_commit</text>
<polyline fill="none" stroke="#1c2123" points="683,-97.5 896,-97.5 "/>
<text text-anchor="start" x="691" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Attempts to commit the idx</text>
<text text-anchor="start" x="691" y="-67.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> and term and returns whether it did</text>
</g>
<!-- RaftLog_maybe_commit&#45;&gt;RaftLog_term -->
<g id="edge5" class="edge">
<title>RaftLog_maybe_commit&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M896.25,-67.77C1037.02,-44.05 1289,-22.6 1468,-126 1504.38,-147.01 1529.19,-189.13 1543.6,-220.76"/>
<polygon fill="#666666" stroke="#666666" points="1540.52,-222.46 1547.74,-230.21 1546.93,-219.65 1540.52,-222.46"/>
</g>
<!-- RaftLog_maybe_append -->
<g id="node7" class="node">
<title>RaftLog_maybe_append</title>
<path fill="none" stroke="#1c2123" d="M708.5,-193.5C708.5,-193.5 870.5,-193.5 870.5,-193.5 876.5,-193.5 882.5,-199.5 882.5,-205.5 882.5,-205.5 882.5,-272.5 882.5,-272.5 882.5,-278.5 876.5,-284.5 870.5,-284.5 870.5,-284.5 708.5,-284.5 708.5,-284.5 702.5,-284.5 696.5,-278.5 696.5,-272.5 696.5,-272.5 696.5,-205.5 696.5,-205.5 696.5,-199.5 702.5,-193.5 708.5,-193.5"/>
<text text-anchor="middle" x="789.5" y="-269.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_maybe_append</text>
<polyline fill="none" stroke="#1c2123" points="696.5,-261.5 882.5,-261.5 "/>
<text text-anchor="start" x="704.5" y="-246.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">找到conflict index</text>
<text text-anchor="start" x="704.5" y="-231.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> start = (conflic_idx &#45; (idx +1))</text>
<text text-anchor="start" x="704.5" y="-216.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将start之后的log entries </text>
<text text-anchor="start" x="704.5" y="-201.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 用新的覆盖掉</text>
</g>
<!-- RaftLog_find_conflict -->
<g id="node8" class="node">
<title>RaftLog_find_conflict</title>
<path fill="none" stroke="#1c2123" d="M973.5,-117C973.5,-117 1155.5,-117 1155.5,-117 1161.5,-117 1167.5,-123 1167.5,-129 1167.5,-129 1167.5,-181 1167.5,-181 1167.5,-187 1161.5,-193 1155.5,-193 1155.5,-193 973.5,-193 973.5,-193 967.5,-193 961.5,-187 961.5,-181 961.5,-181 961.5,-129 961.5,-129 961.5,-123 967.5,-117 973.5,-117"/>
<text text-anchor="middle" x="1064.5" y="-177.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_find_conflict</text>
<polyline fill="none" stroke="#1c2123" points="961.5,-170 1167.5,-170 "/>
<text text-anchor="start" x="969.5" y="-154.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">寻找第一个和leader的log entries</text>
<text text-anchor="start" x="969.5" y="-139.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> conflict的log</text>
<text text-anchor="start" x="969.5" y="-124.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 比较每个log entrie的term</text>
</g>
<!-- RaftLog_maybe_append&#45;&gt;RaftLog_find_conflict -->
<g id="edge6" class="edge">
<title>RaftLog_maybe_append&#45;&gt;RaftLog_find_conflict</title>
<path fill="none" stroke="#666666" d="M882.54,-210.68C904.62,-203.89 928.44,-196.56 951.32,-189.52"/>
<polygon fill="#666666" stroke="#666666" points="952.53,-192.81 961.06,-186.52 950.47,-186.12 952.53,-192.81"/>
</g>
<!-- RaftLog_match_term -->
<g id="node9" class="node">
<title>RaftLog_match_term</title>
<path fill="none" stroke="#1c2123" d="M1278.5,-135.5C1278.5,-135.5 1422.5,-135.5 1422.5,-135.5 1428.5,-135.5 1434.5,-141.5 1434.5,-147.5 1434.5,-147.5 1434.5,-184.5 1434.5,-184.5 1434.5,-190.5 1428.5,-196.5 1422.5,-196.5 1422.5,-196.5 1278.5,-196.5 1278.5,-196.5 1272.5,-196.5 1266.5,-190.5 1266.5,-184.5 1266.5,-184.5 1266.5,-147.5 1266.5,-147.5 1266.5,-141.5 1272.5,-135.5 1278.5,-135.5"/>
<text text-anchor="middle" x="1350.5" y="-181.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_match_term</text>
<polyline fill="none" stroke="#1c2123" points="1266.5,-173.5 1434.5,-173.5 "/>
<text text-anchor="start" x="1274.5" y="-158.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">比较term(idx)时候是否和</text>
<text text-anchor="start" x="1274.5" y="-143.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 给定的值match</text>
</g>
<!-- RaftLog_find_conflict&#45;&gt;RaftLog_match_term -->
<g id="edge7" class="edge">
<title>RaftLog_find_conflict&#45;&gt;RaftLog_match_term</title>
<path fill="none" stroke="#666666" d="M1167.63,-158.96C1196.52,-160.07 1227.81,-161.29 1256.16,-162.38"/>
<polygon fill="#666666" stroke="#666666" points="1256.33,-165.89 1266.46,-162.78 1256.6,-158.9 1256.33,-165.89"/>
</g>
<!-- RaftLog_match_term&#45;&gt;RaftLog_term -->
<g id="edge8" class="edge">
<title>RaftLog_match_term&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M1418.3,-196.58C1442.77,-207.79 1470.41,-220.44 1494.67,-231.55"/>
<polygon fill="#666666" stroke="#666666" points="1493.23,-234.74 1503.78,-235.72 1496.15,-228.37 1493.23,-234.74"/>
</g>
<!-- RaftLog_is_up_to_date -->
<g id="node10" class="node">
<title>RaftLog_is_up_to_date</title>
<path fill="none" stroke="#1c2123" d="M973.5,-352.5C973.5,-352.5 1155.5,-352.5 1155.5,-352.5 1161.5,-352.5 1167.5,-358.5 1167.5,-364.5 1167.5,-364.5 1167.5,-431.5 1167.5,-431.5 1167.5,-437.5 1161.5,-443.5 1155.5,-443.5 1155.5,-443.5 973.5,-443.5 973.5,-443.5 967.5,-443.5 961.5,-437.5 961.5,-431.5 961.5,-431.5 961.5,-364.5 961.5,-364.5 961.5,-358.5 967.5,-352.5 973.5,-352.5"/>
<text text-anchor="middle" x="1064.5" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_is_up_to_date</text>
<polyline fill="none" stroke="#1c2123" points="961.5,-420.5 1167.5,-420.5 "/>
<text text-anchor="start" x="969.5" y="-405.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">收到投票消息</text>
<text text-anchor="start" x="969.5" y="-390.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查发起投票的candidate</text>
<text text-anchor="start" x="969.5" y="-375.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和自己的last term和last index比</text>
<text text-anchor="start" x="969.5" y="-360.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 是否足够新</text>
</g>
<!-- RaftLog_is_up_to_date&#45;&gt;RaftLog_last_term -->
<g id="edge9" class="edge">
<title>RaftLog_is_up_to_date&#45;&gt;RaftLog_last_term</title>
<path fill="none" stroke="#666666" d="M1167.63,-372.11C1194,-365.42 1222.36,-358.23 1248.66,-351.56"/>
<polygon fill="#666666" stroke="#666666" points="1249.8,-354.89 1258.64,-349.04 1248.08,-348.1 1249.8,-354.89"/>
</g>
<!-- RaftCore_handle_append_entries -->
<g id="node11" class="node">
<title>RaftCore_handle_append_entries</title>
<path fill="none" stroke="#1c2123" d="M456,-206.5C456,-206.5 629,-206.5 629,-206.5 635,-206.5 641,-212.5 641,-218.5 641,-218.5 641,-255.5 641,-255.5 641,-261.5 635,-267.5 629,-267.5 629,-267.5 456,-267.5 456,-267.5 450,-267.5 444,-261.5 444,-255.5 444,-255.5 444,-218.5 444,-218.5 444,-212.5 450,-206.5 456,-206.5"/>
<text text-anchor="middle" x="542.5" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_append_entries</text>
<polyline fill="none" stroke="#1c2123" points="444,-244.5 641,-244.5 "/>
<text text-anchor="start" x="452" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理leader发送的</text>
<text text-anchor="start" x="452" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> MsgAppend消息</text>
</g>
<!-- RaftCore_handle_append_entries&#45;&gt;RaftLog_maybe_append -->
<g id="edge10" class="edge">
<title>RaftCore_handle_append_entries&#45;&gt;RaftLog_maybe_append</title>
<path fill="none" stroke="#666666" d="M641.03,-237.8C655.89,-237.92 671.25,-238.04 686.21,-238.16"/>
<polygon fill="#666666" stroke="#666666" points="686.45,-241.67 696.48,-238.25 686.51,-234.67 686.45,-241.67"/>
</g>
<!-- RaftCore_campaign -->
<g id="node12" class="node">
<title>RaftCore_campaign</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M944,-212.5C944,-212.5 1185,-212.5 1185,-212.5 1191,-212.5 1197,-218.5 1197,-224.5 1197,-224.5 1197,-321.5 1197,-321.5 1197,-327.5 1191,-333.5 1185,-333.5 1185,-333.5 944,-333.5 944,-333.5 938,-333.5 932,-327.5 932,-321.5 932,-321.5 932,-224.5 932,-224.5 932,-218.5 938,-212.5 944,-212.5"/>
<text text-anchor="middle" x="1064.5" y="-318.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_campaign</text>
<polyline fill="none" stroke="#8a8898" points="932,-310.5 1197,-310.5 "/>
<text text-anchor="start" x="940" y="-295.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">发起投票，会带上自己的</text>
<text text-anchor="start" x="940" y="-280.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> last index 和last_term</text>
<text text-anchor="start" x="940" y="-265.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> committed 和committed term</text>
<text text-anchor="start" x="940" y="-250.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 如果state为CAMPAIGN_PRE_ELECTION</text>
<text text-anchor="start" x="940" y="-235.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 则become_pre_candidate</text>
<text text-anchor="start" x="940" y="-220.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 否则become candidate</text>
</g>
<!-- RaftCore_campaign&#45;&gt;RaftLog_last_term -->
<g id="edge11" class="edge">
<title>RaftCore_campaign&#45;&gt;RaftLog_last_term</title>
<path fill="none" stroke="green" d="M1197.11,-297.56C1213.06,-300.54 1229.18,-303.55 1244.67,-306.44"/>
<polygon fill="green" stroke="green" points="1244.28,-309.92 1254.75,-308.32 1245.56,-303.04 1244.28,-309.92"/>
</g>
<!-- RaftCore_campaign&#45;&gt;RaftLog_commit_info -->
<g id="edge12" class="edge">
<title>RaftCore_campaign&#45;&gt;RaftLog_commit_info</title>
<path fill="none" stroke="green" d="M1197.11,-267.44C1216.12,-266.64 1235.38,-265.82 1253.51,-265.06"/>
<polygon fill="green" stroke="green" points="1253.91,-268.54 1263.76,-264.62 1253.62,-261.55 1253.91,-268.54"/>
</g>
<!-- RaftCore_commit_to_current_term -->
<g id="node13" class="node">
<title>RaftCore_commit_to_current_term</title>
<path fill="none" stroke="#1c2123" d="M1245,-691C1245,-691 1456,-691 1456,-691 1462,-691 1468,-697 1468,-703 1468,-703 1468,-725 1468,-725 1468,-731 1462,-737 1456,-737 1456,-737 1245,-737 1245,-737 1239,-737 1233,-731 1233,-725 1233,-725 1233,-703 1233,-703 1233,-697 1239,-691 1245,-691"/>
<text text-anchor="middle" x="1350.5" y="-721.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_commit_to_current_term</text>
<polyline fill="none" stroke="#1c2123" points="1233,-714 1468,-714 "/>
<text text-anchor="middle" x="1350.5" y="-698.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">checks if logs are committed to its term</text>
</g>
<!-- RaftCore_commit_to_current_term&#45;&gt;RaftLog_term -->
<g id="edge13" class="edge">
<title>RaftCore_commit_to_current_term&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M1449.8,-690.96C1456.53,-686.78 1462.72,-681.84 1468,-676 1517.87,-620.91 1545.61,-395.47 1555.16,-301.95"/>
<polygon fill="#666666" stroke="#666666" points="1558.67,-302.04 1556.19,-291.74 1551.7,-301.34 1558.67,-302.04"/>
</g>
<!-- RaftCore_hup -->
<g id="node14" class="node">
<title>RaftCore_hup</title>
<path fill="none" stroke="#1c2123" d="M483,-287C483,-287 602,-287 602,-287 608,-287 614,-293 614,-299 614,-299 614,-351 614,-351 614,-357 608,-363 602,-363 602,-363 483,-363 483,-363 477,-363 471,-357 471,-351 471,-351 471,-299 471,-299 471,-293 477,-287 483,-287"/>
<text text-anchor="middle" x="542.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_hup</text>
<polyline fill="none" stroke="#1c2123" points="471,-340 614,-340 "/>
<text text-anchor="start" x="479" y="-324.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">收到MsgTimeoutNow</text>
<text text-anchor="start" x="479" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 或者MsgHup</text>
<text text-anchor="start" x="479" y="-294.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发起竞选</text>
</g>
<!-- RaftCore_hup&#45;&gt;RaftCore_campaign -->
<g id="edge14" class="edge">
<title>RaftCore_hup&#45;&gt;RaftCore_campaign</title>
<path fill="none" stroke="#666666" d="M614.13,-319.56C685.35,-313.9 798.41,-304.4 896,-294 904.47,-293.1 913.17,-292.13 921.95,-291.12"/>
<polygon fill="#666666" stroke="#666666" points="922.36,-294.6 931.89,-289.97 921.55,-287.64 922.36,-294.6"/>
</g>
<!-- RaftCore_maybe_commit_by_vote -->
<g id="node15" class="node">
<title>RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="#1c2123" d="M450,-60.5C450,-60.5 635,-60.5 635,-60.5 641,-60.5 647,-66.5 647,-72.5 647,-72.5 647,-109.5 647,-109.5 647,-115.5 641,-121.5 635,-121.5 635,-121.5 450,-121.5 450,-121.5 444,-121.5 438,-115.5 438,-109.5 438,-109.5 438,-72.5 438,-72.5 438,-66.5 444,-60.5 450,-60.5"/>
<text text-anchor="middle" x="542.5" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_maybe_commit_by_vote</text>
<polyline fill="none" stroke="#1c2123" points="438,-98.5 647,-98.5 "/>
<text text-anchor="start" x="446" y="-83.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commits the logs using</text>
<text text-anchor="start" x="446" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit info in vote message</text>
</g>
<!-- RaftCore_maybe_commit_by_vote&#45;&gt;RaftLog_maybe_commit -->
<g id="edge15" class="edge">
<title>RaftCore_maybe_commit_by_vote&#45;&gt;RaftLog_maybe_commit</title>
<path fill="none" stroke="#666666" d="M647.05,-90.58C655.59,-90.54 664.26,-90.51 672.88,-90.47"/>
<polygon fill="#666666" stroke="#666666" points="672.98,-93.97 682.97,-90.43 672.96,-86.97 672.98,-93.97"/>
</g>
<!-- RaftCore_step -->
<g id="node16" class="node">
<title>RaftCore_step</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M30.5,-250.5C30.5,-250.5 182.5,-250.5 182.5,-250.5 188.5,-250.5 194.5,-256.5 194.5,-262.5 194.5,-262.5 194.5,-299.5 194.5,-299.5 194.5,-305.5 188.5,-311.5 182.5,-311.5 182.5,-311.5 30.5,-311.5 30.5,-311.5 24.5,-311.5 18.5,-305.5 18.5,-299.5 18.5,-299.5 18.5,-262.5 18.5,-262.5 18.5,-256.5 24.5,-250.5 30.5,-250.5"/>
<text text-anchor="middle" x="106.5" y="-296.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_step</text>
<polyline fill="none" stroke="#8a8898" points="18.5,-288.5 194.5,-288.5 "/>
<text text-anchor="start" x="26.5" y="-273.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">raft along via a message</text>
<text text-anchor="start" x="26.5" y="-258.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 处理raft从peer收到的消息</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftLog_is_up_to_date -->
<g id="edge16" class="edge">
<title>RaftCore_step&#45;&gt;RaftLog_is_up_to_date</title>
<path fill="none" stroke="red" d="M194.65,-311.23C260.59,-332.63 353.86,-359.79 438,-373 615.84,-400.92 825.41,-403.18 951.19,-401.29"/>
<polygon fill="red" stroke="red" points="951.28,-404.79 961.23,-401.13 951.17,-397.79 951.28,-404.79"/>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_hup -->
<g id="edge17" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_hup</title>
<path fill="none" stroke="red" d="M194.54,-289.82C272.22,-297.7 385.07,-309.14 460.76,-316.81"/>
<polygon fill="red" stroke="red" points="460.42,-320.3 470.73,-317.82 461.13,-313.33 460.42,-320.3"/>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_maybe_commit_by_vote -->
<g id="edge18" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="red" d="M169.58,-250.49C194.2,-238.57 222.83,-224.92 249,-213 316.39,-182.29 334.16,-176.71 402,-147 418.04,-139.98 421.83,-137.71 438,-131 442.49,-129.14 447.1,-127.25 451.76,-125.37"/>
<polygon fill="red" stroke="red" points="453.41,-128.48 461.39,-121.51 450.8,-121.98 453.41,-128.48"/>
</g>
<!-- RaftCore_step_leader -->
<g id="node17" class="node">
<title>RaftCore_step_leader</title>
<path fill="none" stroke="#1c2123" d="M270.5,-565C270.5,-565 380.5,-565 380.5,-565 386.5,-565 392.5,-571 392.5,-577 392.5,-577 392.5,-599 392.5,-599 392.5,-605 386.5,-611 380.5,-611 380.5,-611 270.5,-611 270.5,-611 264.5,-611 258.5,-605 258.5,-599 258.5,-599 258.5,-577 258.5,-577 258.5,-571 264.5,-565 270.5,-565"/>
<text text-anchor="middle" x="325.5" y="-595.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_leader</text>
<polyline fill="none" stroke="#1c2123" points="258.5,-588 392.5,-588 "/>
<text text-anchor="start" x="266.5" y="-572.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role为leader</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_leader -->
<g id="edge19" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_leader</title>
<path fill="none" stroke="red" d="M129.1,-311.56C170.48,-370.1 260.53,-497.51 302.35,-556.66"/>
<polygon fill="red" stroke="red" points="299.52,-558.73 308.15,-564.87 305.24,-554.69 299.52,-558.73"/>
</g>
<!-- RaftCore_step_candidate -->
<g id="node18" class="node">
<title>RaftCore_step_candidate</title>
<path fill="none" stroke="#1c2123" d="M261,-92C261,-92 390,-92 390,-92 396,-92 402,-98 402,-104 402,-104 402,-126 402,-126 402,-132 396,-138 390,-138 390,-138 261,-138 261,-138 255,-138 249,-132 249,-126 249,-126 249,-104 249,-104 249,-98 255,-92 261,-92"/>
<text text-anchor="middle" x="325.5" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_candidate</text>
<polyline fill="none" stroke="#1c2123" points="249,-115 402,-115 "/>
<text text-anchor="start" x="257" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role 为candiate</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_candidate -->
<g id="edge20" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_candidate</title>
<path fill="none" stroke="red" d="M146.36,-250.41C174.68,-228.21 214.06,-197.53 249,-171 260.61,-162.18 273.31,-152.7 284.92,-144.09"/>
<polygon fill="red" stroke="red" points="287.2,-146.76 293.16,-138 283.04,-141.14 287.2,-146.76"/>
</g>
<!-- RaftCore_step_follower -->
<g id="node19" class="node">
<title>RaftCore_step_follower</title>
<path fill="none" stroke="#1c2123" d="M264,-223C264,-223 387,-223 387,-223 393,-223 399,-229 399,-235 399,-235 399,-257 399,-257 399,-263 393,-269 387,-269 387,-269 264,-269 264,-269 258,-269 252,-263 252,-257 252,-257 252,-235 252,-235 252,-229 258,-223 264,-223"/>
<text text-anchor="middle" x="325.5" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_step_follower</text>
<polyline fill="none" stroke="#1c2123" points="252,-246 399,-246 "/>
<text text-anchor="middle" x="325.5" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Raft role为follower</text>
</g>
<!-- RaftCore_step&#45;&gt;RaftCore_step_follower -->
<g id="edge21" class="edge">
<title>RaftCore_step&#45;&gt;RaftCore_step_follower</title>
<path fill="none" stroke="red" d="M194.51,-266.97C210.08,-264.45 226.27,-261.84 241.72,-259.35"/>
<polygon fill="red" stroke="red" points="242.44,-262.78 251.75,-257.73 241.32,-255.87 242.44,-262.78"/>
</g>
<!-- RaftCore_step_leader&#45;&gt;RaftCore_commit_to_current_term -->
<g id="edge22" class="edge">
<title>RaftCore_step_leader&#45;&gt;RaftCore_commit_to_current_term</title>
<path fill="none" stroke="#666666" d="M364.28,-611.14C385.22,-622.79 412.19,-635.91 438,-643 710.14,-717.73 1043.94,-722.9 1222.48,-719.09"/>
<polygon fill="#666666" stroke="#666666" points="1222.78,-722.59 1232.7,-718.86 1222.62,-715.59 1222.78,-722.59"/>
</g>
<!-- RaftCore_handle_append_response -->
<g id="node20" class="node">
<title>RaftCore_handle_append_response</title>
<path fill="none" stroke="#1c2123" d="M450,-542.5C450,-542.5 635,-542.5 635,-542.5 641,-542.5 647,-548.5 647,-554.5 647,-554.5 647,-621.5 647,-621.5 647,-627.5 641,-633.5 635,-633.5 635,-633.5 450,-633.5 450,-633.5 444,-633.5 438,-627.5 438,-621.5 438,-621.5 438,-554.5 438,-554.5 438,-548.5 444,-542.5 450,-542.5"/>
<text text-anchor="middle" x="542.5" y="-618.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_append_response</text>
<polyline fill="none" stroke="#1c2123" points="438,-610.5 647,-610.5 "/>
<text text-anchor="start" x="446" y="-595.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理follower返回的append resp</text>
<text text-anchor="start" x="446" y="-580.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.更新peer的ProcessTracker</text>
<text text-anchor="start" x="446" y="-565.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.更新完follower的控制信息后</text>
<text text-anchor="start" x="446" y="-550.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送多个append给follower</text>
</g>
<!-- RaftCore_step_leader&#45;&gt;RaftCore_handle_append_response -->
<g id="edge23" class="edge">
<title>RaftCore_step_leader&#45;&gt;RaftCore_handle_append_response</title>
<path fill="none" stroke="#666666" d="M392.76,-588C403.94,-588 415.83,-588 427.81,-588"/>
<polygon fill="#666666" stroke="#666666" points="427.89,-591.5 437.89,-588 427.89,-584.5 427.89,-591.5"/>
</g>
<!-- RaftCore_step_candidate&#45;&gt;RaftCore_maybe_commit_by_vote -->
<g id="edge27" class="edge">
<title>RaftCore_step_candidate&#45;&gt;RaftCore_maybe_commit_by_vote</title>
<path fill="none" stroke="blue" d="M402.3,-106.54C410.56,-105.62 419.08,-104.66 427.67,-103.71"/>
<polygon fill="blue" stroke="blue" points="428.21,-107.17 437.76,-102.58 427.43,-100.21 428.21,-107.17"/>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_handle_append_entries -->
<g id="edge24" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_handle_append_entries</title>
<path fill="none" stroke="#666666" d="M399.29,-242.95C410.31,-242.49 421.88,-242.01 433.46,-241.52"/>
<polygon fill="#666666" stroke="#666666" points="433.78,-245.01 443.62,-241.1 433.49,-238.02 433.78,-245.01"/>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_hup -->
<g id="edge25" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_hup</title>
<path fill="none" stroke="#666666" d="M389.26,-269.06C411.71,-277.31 437.31,-286.72 461.04,-295.44"/>
<polygon fill="#666666" stroke="#666666" points="460.13,-298.83 470.73,-298.99 462.55,-292.26 460.13,-298.83"/>
</g>
<!-- RaftCore_handle_snapshot -->
<g id="node24" class="node">
<title>RaftCore_handle_snapshot</title>
<path fill="none" stroke="#1c2123" d="M456,-141C456,-141 629,-141 629,-141 635,-141 641,-147 641,-153 641,-153 641,-175 641,-175 641,-181 635,-187 629,-187 629,-187 456,-187 456,-187 450,-187 444,-181 444,-175 444,-175 444,-153 444,-153 444,-147 450,-141 456,-141"/>
<text text-anchor="middle" x="542.5" y="-171.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_handle_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="444,-164 641,-164 "/>
<text text-anchor="start" x="452" y="-148.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理leader发送的snapshot消息</text>
</g>
<!-- RaftCore_step_follower&#45;&gt;RaftCore_handle_snapshot -->
<g id="edge26" class="edge">
<title>RaftCore_step_follower&#45;&gt;RaftCore_handle_snapshot</title>
<path fill="none" stroke="#666666" d="M375.99,-222.91C395.17,-214.32 417.43,-204.77 438,-197 443.9,-194.77 450.03,-192.56 456.23,-190.4"/>
<polygon fill="#666666" stroke="#666666" points="457.67,-193.6 466,-187.05 455.4,-186.98 457.67,-193.6"/>
</g>
<!-- RaftCore_maybe_send_append -->
<g id="node21" class="node">
<title>RaftCore_maybe_send_append</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M706,-531C706,-531 873,-531 873,-531 879,-531 885,-537 885,-543 885,-543 885,-633 885,-633 885,-639 879,-645 873,-645 873,-645 706,-645 706,-645 700,-645 694,-639 694,-633 694,-633 694,-543 694,-543 694,-537 700,-531 706,-531"/>
<text text-anchor="middle" x="789.5" y="-629.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore_maybe_send_append</text>
<polyline fill="none" stroke="#8a8898" points="694,-622 885,-622 "/>
<text text-anchor="start" x="702" y="-606.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Sends an append RPC with new</text>
<text text-anchor="start" x="702" y="-591.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> entries to the given peer</text>
<polyline fill="none" stroke="#8a8898" points="694,-584 885,-584 "/>
<text text-anchor="start" x="702" y="-568.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">根据follower落后的情况</text>
<text text-anchor="start" x="702" y="-553.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 可能发送entries</text>
<text text-anchor="start" x="702" y="-538.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 也可能发送snapshot</text>
</g>
<!-- RaftCore_handle_append_response&#45;&gt;RaftCore_maybe_send_append -->
<g id="edge31" class="edge">
<title>RaftCore_handle_append_response&#45;&gt;RaftCore_maybe_send_append</title>
<path fill="none" stroke="#666666" d="M647.05,-588C659.19,-588 671.58,-588 683.74,-588"/>
<polygon fill="#666666" stroke="#666666" points="683.89,-591.5 693.89,-588 683.89,-584.5 683.89,-591.5"/>
</g>
<!-- RaftCore_maybe_send_append&#45;&gt;RaftLog_term -->
<g id="edge28" class="edge">
<title>RaftCore_maybe_send_append&#45;&gt;RaftLog_term</title>
<path fill="none" stroke="#666666" d="M885.38,-630.36C900.69,-635.59 916.59,-640.11 932,-643 1047.76,-664.71 1088.72,-689.34 1197,-643 1362.97,-571.96 1488.4,-383.01 1536.99,-300.49"/>
<polygon fill="#666666" stroke="#666666" points="1540.12,-302.07 1542.13,-291.67 1534.07,-298.55 1540.12,-302.07"/>
</g>
<!-- RaftCore_prepare_send_snapshot -->
<g id="node22" class="node">
<title>RaftCore_prepare_send_snapshot</title>
<path fill="none" stroke="#1c2123" d="M977,-542.5C977,-542.5 1152,-542.5 1152,-542.5 1158,-542.5 1164,-548.5 1164,-554.5 1164,-554.5 1164,-621.5 1164,-621.5 1164,-627.5 1158,-633.5 1152,-633.5 1152,-633.5 977,-633.5 977,-633.5 971,-633.5 965,-627.5 965,-621.5 965,-621.5 965,-554.5 965,-554.5 965,-548.5 971,-542.5 977,-542.5"/>
<text text-anchor="middle" x="1064.5" y="-618.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_prepare_send_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="965,-610.5 1164,-610.5 "/>
<text text-anchor="start" x="973" y="-595.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备发送snapshot</text>
<text text-anchor="start" x="973" y="-580.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建snapshot</text>
<text text-anchor="start" x="973" y="-565.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后更新follower的</text>
<text text-anchor="start" x="973" y="-550.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> progressTracker</text>
</g>
<!-- RaftCore_maybe_send_append&#45;&gt;RaftCore_prepare_send_snapshot -->
<g id="edge29" class="edge">
<title>RaftCore_maybe_send_append&#45;&gt;RaftCore_prepare_send_snapshot</title>
<path fill="none" stroke="#666666" d="M885.22,-588C907.62,-588 931.68,-588 954.66,-588"/>
<polygon fill="#666666" stroke="#666666" points="954.78,-591.5 964.78,-588 954.78,-584.5 954.78,-591.5"/>
</g>
<!-- RaftLog_entries -->
<g id="node23" class="node">
<title>RaftLog_entries</title>
<path fill="none" stroke="#1c2123" d="M995.5,-462.5C995.5,-462.5 1133.5,-462.5 1133.5,-462.5 1139.5,-462.5 1145.5,-468.5 1145.5,-474.5 1145.5,-474.5 1145.5,-511.5 1145.5,-511.5 1145.5,-517.5 1139.5,-523.5 1133.5,-523.5 1133.5,-523.5 995.5,-523.5 995.5,-523.5 989.5,-523.5 983.5,-517.5 983.5,-511.5 983.5,-511.5 983.5,-474.5 983.5,-474.5 983.5,-468.5 989.5,-462.5 995.5,-462.5"/>
<text text-anchor="middle" x="1064.5" y="-508.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftLog_entries</text>
<polyline fill="none" stroke="#1c2123" points="983.5,-500.5 1145.5,-500.5 "/>
<text text-anchor="start" x="991.5" y="-485.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">准备要发送给follower的</text>
<text text-anchor="start" x="991.5" y="-470.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> entries</text>
</g>
<!-- RaftCore_maybe_send_append&#45;&gt;RaftLog_entries -->
<g id="edge30" class="edge">
<title>RaftCore_maybe_send_append&#45;&gt;RaftLog_entries</title>
<path fill="none" stroke="#666666" d="M885.28,-550.03C900.82,-544.13 916.81,-538.26 932,-533 945.38,-528.37 959.61,-523.74 973.59,-519.36"/>
<polygon fill="#666666" stroke="#666666" points="974.71,-522.68 983.22,-516.37 972.63,-515.99 974.71,-522.68"/>
</g>
<!-- RaftCore_restore -->
<g id="node25" class="node">
<title>RaftCore_restore</title>
<path fill="none" stroke="#1c2123" d="M832.5,-175C832.5,-175 746.5,-175 746.5,-175 740.5,-175 734.5,-169 734.5,-163 734.5,-163 734.5,-151 734.5,-151 734.5,-145 740.5,-139 746.5,-139 746.5,-139 832.5,-139 832.5,-139 838.5,-139 844.5,-145 844.5,-151 844.5,-151 844.5,-163 844.5,-163 844.5,-169 838.5,-175 832.5,-175"/>
<text text-anchor="middle" x="789.5" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_restore</text>
</g>
<!-- RaftCore_handle_snapshot&#45;&gt;RaftCore_restore -->
<g id="edge32" class="edge">
<title>RaftCore_handle_snapshot&#45;&gt;RaftCore_restore</title>
<path fill="none" stroke="#666666" d="M641.03,-161.21C668.95,-160.42 698.67,-159.57 724.06,-158.84"/>
<polygon fill="#666666" stroke="#666666" points="724.39,-162.33 734.29,-158.55 724.19,-155.34 724.39,-162.33"/>
</g>
<!-- RaftCore_on_persist_entries -->
<g id="node26" class="node">
<title>RaftCore_on_persist_entries</title>
<path fill="none" stroke="#1c2123" d="M12,-0.5C12,-0.5 201,-0.5 201,-0.5 207,-0.5 213,-6.5 213,-12.5 213,-12.5 213,-49.5 213,-49.5 213,-55.5 207,-61.5 201,-61.5 201,-61.5 12,-61.5 12,-61.5 6,-61.5 0,-55.5 0,-49.5 0,-49.5 0,-12.5 0,-12.5 0,-6.5 6,-0.5 12,-0.5"/>
<text text-anchor="middle" x="106.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore_on_persist_entries</text>
<polyline fill="none" stroke="#1c2123" points="0,-38.5 213,-38.5 "/>
<text text-anchor="start" x="8" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Notifies that the raft logs</text>
<text text-anchor="start" x="8" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> or the snapshot have been persisted</text>
</g>
<!-- RaftCore_on_persist_entries&#45;&gt;RaftLog_maybe_persist -->
<g id="edge33" class="edge">
<title>RaftCore_on_persist_entries&#45;&gt;RaftLog_maybe_persist</title>
<path fill="none" stroke="#666666" d="M213.14,-31C221.8,-31 230.48,-31 238.97,-31"/>
<polygon fill="#666666" stroke="#666666" points="239.21,-34.5 249.21,-31 239.21,-27.5 239.21,-34.5"/>
</g>
</g>
</svg>
