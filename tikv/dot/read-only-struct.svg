<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: read_only_struct Pages: 1 -->
<svg width="1099pt" height="359pt"
 viewBox="0.00 0.00 1099.00 358.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 354.5)">
<title>read_only_struct</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-354.5 1095,-354.5 1095,4 -4,4"/>
<!-- RaftCore -->
<g id="node1" class="node">
<title>RaftCore</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M12,-100.5C12,-100.5 188,-100.5 188,-100.5 194,-100.5 200,-106.5 200,-112.5 200,-112.5 200,-180.5 200,-180.5 200,-186.5 194,-192.5 188,-192.5 188,-192.5 12,-192.5 12,-192.5 6,-192.5 0,-186.5 0,-180.5 0,-180.5 0,-112.5 0,-112.5 0,-106.5 6,-100.5 12,-100.5"/>
<text text-anchor="middle" x="100" y="-177.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftCore</text>
<polyline fill="none" stroke="#60b5ac" points="0,-169.5 200,-169.5 "/>
<text text-anchor="start" x="8" y="-154.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">...</text>
<polyline fill="none" stroke="#60b5ac" points="0,-146.5 200,-146.5 "/>
<text text-anchor="start" x="8" y="-131.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub read_states: Vec&lt;ReadState&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="0,-123.5 200,-123.5 "/>
<text text-anchor="start" x="8" y="-108.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub read_only: ReadOnly</text>
</g>
<!-- ReadState -->
<g id="node2" class="node">
<title>ReadState</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M356,-162C356,-162 493,-162 493,-162 499,-162 505,-168 505,-174 505,-174 505,-219 505,-219 505,-225 499,-231 493,-231 493,-231 356,-231 356,-231 350,-231 344,-225 344,-219 344,-219 344,-174 344,-174 344,-168 350,-162 356,-162"/>
<text text-anchor="middle" x="424.5" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReadState</text>
<polyline fill="none" stroke="#60b5ac" points="344,-208 505,-208 "/>
<text text-anchor="start" x="352" y="-192.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub index: u64</text>
<polyline fill="none" stroke="#60b5ac" points="344,-185 505,-185 "/>
<text text-anchor="start" x="352" y="-169.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub request_ctx: Vec&lt;u8&gt;</text>
</g>
<!-- RaftCore&#45;&gt;ReadState -->
<g id="edge1" class="edge">
<title>RaftCore&#45;&gt;ReadState</title>
<path fill="none" stroke="#666666" d="M200.39,-161.91C242.97,-168.51 292.32,-176.16 333.77,-182.59"/>
<polygon fill="#666666" stroke="#666666" points="333.43,-186.08 343.85,-184.15 334.5,-179.16 333.43,-186.08"/>
</g>
<!-- ReadOnly -->
<g id="node3" class="node">
<title>ReadOnly</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M248,-50.5C248,-50.5 601,-50.5 601,-50.5 607,-50.5 613,-56.5 613,-62.5 613,-62.5 613,-130.5 613,-130.5 613,-136.5 607,-142.5 601,-142.5 601,-142.5 248,-142.5 248,-142.5 242,-142.5 236,-136.5 236,-130.5 236,-130.5 236,-62.5 236,-62.5 236,-56.5 242,-50.5 248,-50.5"/>
<text text-anchor="middle" x="424.5" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReadOnly</text>
<polyline fill="none" stroke="#60b5ac" points="236,-119.5 613,-119.5 "/>
<text text-anchor="start" x="244" y="-104.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub option: ReadOnlyOption</text>
<polyline fill="none" stroke="#60b5ac" points="236,-96.5 613,-96.5 "/>
<text text-anchor="start" x="244" y="-81.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub pending_read_index: HashMap&lt;Vec&lt;u8&gt;, ReadIndexStatus&gt;</text>
<polyline fill="none" stroke="#60b5ac" points="236,-73.5 613,-73.5 "/>
<text text-anchor="start" x="244" y="-58.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub read_index_queue: VecDeque&lt;Vec&lt;u8&gt;&gt;</text>
</g>
<!-- RaftCore&#45;&gt;ReadOnly -->
<g id="edge2" class="edge">
<title>RaftCore&#45;&gt;ReadOnly</title>
<path fill="none" stroke="#666666" d="M200.39,-131.09C208.57,-129.82 217,-128.51 225.58,-127.19"/>
<polygon fill="#666666" stroke="#666666" points="226.37,-130.61 235.71,-125.61 225.29,-123.69 226.37,-130.61"/>
</g>
<!-- ReadOnlyOption -->
<g id="node4" class="node">
<title>ReadOnlyOption</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M683.5,-122C683.5,-122 768.5,-122 768.5,-122 774.5,-122 780.5,-128 780.5,-134 780.5,-134 780.5,-179 780.5,-179 780.5,-185 774.5,-191 768.5,-191 768.5,-191 683.5,-191 683.5,-191 677.5,-191 671.5,-185 671.5,-179 671.5,-179 671.5,-134 671.5,-134 671.5,-128 677.5,-122 683.5,-122"/>
<text text-anchor="middle" x="726" y="-175.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReadOnlyOption</text>
<polyline fill="none" stroke="#60b5ac" points="671.5,-168 780.5,-168 "/>
<text text-anchor="start" x="679.5" y="-152.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Safe</text>
<polyline fill="none" stroke="#60b5ac" points="671.5,-145 780.5,-145 "/>
<text text-anchor="start" x="679.5" y="-129.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LeaseBased</text>
</g>
<!-- ReadOnly&#45;&gt;ReadOnlyOption -->
<g id="edge3" class="edge">
<title>ReadOnly&#45;&gt;ReadOnlyOption</title>
<path fill="none" stroke="#666666" d="M613.05,-134.07C630.2,-137.51 646.63,-140.8 661.38,-143.76"/>
<polygon fill="#666666" stroke="#666666" points="660.82,-147.21 671.31,-145.74 662.19,-140.35 660.82,-147.21"/>
</g>
<!-- ReadIndexStatus -->
<g id="node5" class="node">
<title>ReadIndexStatus</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M661,-0.5C661,-0.5 791,-0.5 791,-0.5 797,-0.5 803,-6.5 803,-12.5 803,-12.5 803,-80.5 803,-80.5 803,-86.5 797,-92.5 791,-92.5 791,-92.5 661,-92.5 661,-92.5 655,-92.5 649,-86.5 649,-80.5 649,-80.5 649,-12.5 649,-12.5 649,-6.5 655,-0.5 661,-0.5"/>
<text text-anchor="middle" x="726" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReadIndexStatus</text>
<polyline fill="none" stroke="#60b5ac" points="649,-69.5 803,-69.5 "/>
<text text-anchor="start" x="657" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub req: Message</text>
<polyline fill="none" stroke="#60b5ac" points="649,-46.5 803,-46.5 "/>
<text text-anchor="start" x="657" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub index: u64</text>
<polyline fill="none" stroke="#60b5ac" points="649,-23.5 803,-23.5 "/>
<text text-anchor="start" x="657" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub acks: HashSet&lt;u64&gt;</text>
</g>
<!-- ReadOnly&#45;&gt;ReadIndexStatus -->
<g id="edge4" class="edge">
<title>ReadOnly&#45;&gt;ReadIndexStatus</title>
<path fill="none" stroke="#666666" d="M613.05,-65.19C621.85,-63.72 630.46,-62.28 638.76,-60.9"/>
<polygon fill="#666666" stroke="#666666" points="639.42,-64.34 648.71,-59.24 638.27,-57.43 639.42,-64.34"/>
</g>
<!-- Safe -->
<g id="node6" class="node">
<title>Safe</title>
<path fill="#feed9b" stroke="#f7e495" d="M864.5,-259C864.5,-259 1065.5,-259 1065.5,-259 1071.5,-259 1077.5,-265 1077.5,-271 1077.5,-271 1077.5,-338 1077.5,-338 1077.5,-344 1071.5,-350 1065.5,-350 1065.5,-350 864.5,-350 864.5,-350 858.5,-350 852.5,-344 852.5,-338 852.5,-338 852.5,-271 852.5,-271 852.5,-265 858.5,-259 864.5,-259"/>
<text text-anchor="middle" x="965" y="-334.8" font-family="Times,serif" font-size="14.00" fill="#40575d">Safe</text>
<polyline fill="none" stroke="#f7e495" points="852.5,-327 1077.5,-327 "/>
<text text-anchor="start" x="860.5" y="-311.8" font-family="Times,serif" font-size="14.00" fill="#40575d">Safe guarantees the linearizability</text>
<text text-anchor="start" x="860.5" y="-296.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> of the read only request by</text>
<text text-anchor="start" x="860.5" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> communicating with the quorum.</text>
<text text-anchor="start" x="860.5" y="-266.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> It is the default and suggested option.</text>
</g>
<!-- ReadOnlyOption&#45;&gt;Safe -->
<g id="edge5" class="edge">
<title>ReadOnlyOption&#45;&gt;Safe</title>
<path fill="none" stroke="#666666" d="M763.36,-191.13C784.36,-209.96 811.91,-232.75 839,-249.5 841.46,-251.02 843.96,-252.52 846.51,-254"/>
<polygon fill="#666666" stroke="#666666" points="844.87,-257.09 855.3,-258.94 848.3,-250.99 844.87,-257.09"/>
</g>
<!-- LeaseBased -->
<g id="node7" class="node">
<title>LeaseBased</title>
<path fill="#feed9b" stroke="#f7e495" d="M851,-73.5C851,-73.5 1079,-73.5 1079,-73.5 1085,-73.5 1091,-79.5 1091,-85.5 1091,-85.5 1091,-227.5 1091,-227.5 1091,-233.5 1085,-239.5 1079,-239.5 1079,-239.5 851,-239.5 851,-239.5 845,-239.5 839,-233.5 839,-227.5 839,-227.5 839,-85.5 839,-85.5 839,-79.5 845,-73.5 851,-73.5"/>
<text text-anchor="middle" x="965" y="-224.3" font-family="Times,serif" font-size="14.00" fill="#40575d">LeaseBased</text>
<polyline fill="none" stroke="#f7e495" points="839,-216.5 1091,-216.5 "/>
<text text-anchor="start" x="847" y="-201.3" font-family="Times,serif" font-size="14.00" fill="#40575d">LeaseBased ensures linearizability</text>
<text text-anchor="start" x="847" y="-186.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> of the read only request by</text>
<text text-anchor="start" x="847" y="-171.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> relying on the leader lease.</text>
<text text-anchor="start" x="847" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> It can be affected by clock drift.</text>
<text text-anchor="start" x="847" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> If the clock drift is unbounded,</text>
<text text-anchor="start" x="847" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> leader might keep the lease longer than it</text>
<text text-anchor="start" x="847" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> should (clock can move backward/pause</text>
<text text-anchor="start" x="847" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> without any bound). ReadIndex is not safe</text>
<text text-anchor="start" x="847" y="-81.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> in that case.</text>
</g>
<!-- ReadOnlyOption&#45;&gt;LeaseBased -->
<g id="edge6" class="edge">
<title>ReadOnlyOption&#45;&gt;LeaseBased</title>
<path fill="none" stroke="#666666" d="M780.78,-156.5C795.39,-156.5 811.9,-156.5 828.87,-156.5"/>
<polygon fill="#666666" stroke="#666666" points="828.91,-160 838.91,-156.5 828.91,-153 828.91,-160"/>
</g>
<!-- Message -->
<g id="node8" class="node">
<title>Message</title>
<path fill="none" stroke="#1c2123" d="M985.5,-54.5C985.5,-54.5 944.5,-54.5 944.5,-54.5 938.5,-54.5 932.5,-48.5 932.5,-42.5 932.5,-42.5 932.5,-30.5 932.5,-30.5 932.5,-24.5 938.5,-18.5 944.5,-18.5 944.5,-18.5 985.5,-18.5 985.5,-18.5 991.5,-18.5 997.5,-24.5 997.5,-30.5 997.5,-30.5 997.5,-42.5 997.5,-42.5 997.5,-48.5 991.5,-54.5 985.5,-54.5"/>
<text text-anchor="middle" x="965" y="-32.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Message</text>
</g>
<!-- ReadIndexStatus&#45;&gt;Message -->
<g id="edge7" class="edge">
<title>ReadIndexStatus&#45;&gt;Message</title>
<path fill="none" stroke="#666666" d="M803.29,-43.28C842.73,-41.62 889.35,-39.65 922.19,-38.26"/>
<polygon fill="#666666" stroke="#666666" points="922.5,-41.75 932.34,-37.84 922.2,-34.76 922.5,-41.75"/>
</g>
</g>
</svg>
