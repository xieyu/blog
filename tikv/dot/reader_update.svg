<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: readers Pages: 1 -->
<svg width="1965pt" height="477pt"
 viewBox="0.00 0.00 1965.00 477.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 473)">
<title>readers</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-473 1961,-473 1961,4 -4,4"/>
<!-- Progress -->
<g id="node1" class="node">
<title>Progress</title>
<path fill="none" stroke="#1c2123" d="M1368,-125C1368,-125 1517,-125 1517,-125 1523,-125 1529,-131 1529,-137 1529,-137 1529,-228 1529,-228 1529,-234 1523,-240 1517,-240 1517,-240 1368,-240 1368,-240 1362,-240 1356,-234 1356,-228 1356,-228 1356,-137 1356,-137 1356,-131 1362,-125 1368,-125"/>
<text text-anchor="middle" x="1442.5" y="-224.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress</text>
<polyline fill="none" stroke="#1c2123" points="1356,-217 1529,-217 "/>
<text text-anchor="start" x="1364" y="-201.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Region(metapb::Region),</text>
<polyline fill="none" stroke="#1c2123" points="1356,-194 1529,-194 "/>
<text text-anchor="start" x="1364" y="-178.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Term(u64),</text>
<polyline fill="none" stroke="#1c2123" points="1356,-171 1529,-171 "/>
<text text-anchor="start" x="1364" y="-155.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">AppliedIndexTerm(u64),</text>
<polyline fill="none" stroke="#1c2123" points="1356,-148 1529,-148 "/>
<text text-anchor="start" x="1364" y="-132.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaderLease(RemoteLease),</text>
</g>
<!-- ReaderDelegate__update -->
<g id="node5" class="node">
<title>ReaderDelegate__update</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1577,-180C1577,-180 1716,-180 1716,-180 1722,-180 1728,-186 1728,-192 1728,-192 1728,-259 1728,-259 1728,-265 1722,-271 1716,-271 1716,-271 1577,-271 1577,-271 1571,-271 1565,-265 1565,-259 1565,-259 1565,-192 1565,-192 1565,-186 1571,-180 1577,-180"/>
<text text-anchor="start" x="1573" y="-255.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ReaderDelegate</text>
<text text-anchor="start" x="1573" y="-240.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> update</text>
<polyline fill="none" stroke="#8a8898" points="1565,-233 1728,-233 "/>
<text text-anchor="start" x="1573" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.更新自己的track ver</text>
<text text-anchor="start" x="1573" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.根据Progress更新自己</text>
<text text-anchor="start" x="1573" y="-187.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的成员变量</text>
</g>
<!-- Progress&#45;&gt;ReaderDelegate__update -->
<g id="edge15" class="edge">
<title>Progress&#45;&gt;ReaderDelegate__update</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1529.17,-200.74C1537.67,-202.55 1546.32,-204.39 1554.87,-206.21"/>
<polygon fill="green" stroke="green" points="1554.33,-209.67 1564.84,-208.33 1555.79,-202.83 1554.33,-209.67"/>
</g>
<!-- Peer__set_region -->
<g id="node2" class="node">
<title>Peer__set_region</title>
<path fill="none" stroke="#1c2123" d="M746,-392.5C746,-392.5 843,-392.5 843,-392.5 849,-392.5 855,-398.5 855,-404.5 855,-404.5 855,-456.5 855,-456.5 855,-462.5 849,-468.5 843,-468.5 843,-468.5 746,-468.5 746,-468.5 740,-468.5 734,-462.5 734,-456.5 734,-456.5 734,-404.5 734,-404.5 734,-398.5 740,-392.5 746,-392.5"/>
<text text-anchor="start" x="742" y="-453.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="742" y="-438.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_region</text>
<polyline fill="none" stroke="#1c2123" points="734,-430.5 855,-430.5 "/>
<text text-anchor="start" x="742" y="-415.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新ReadDelegate</text>
<text text-anchor="start" x="742" y="-400.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的region</text>
</g>
<!-- Peer__maybe_update_read_progress -->
<g id="node3" class="node">
<title>Peer__maybe_update_read_progress</title>
<path fill="none" stroke="#1c2123" d="M965,-280.5C965,-280.5 1123,-280.5 1123,-280.5 1129,-280.5 1135,-286.5 1135,-292.5 1135,-292.5 1135,-344.5 1135,-344.5 1135,-350.5 1129,-356.5 1123,-356.5 1123,-356.5 965,-356.5 965,-356.5 959,-356.5 953,-350.5 953,-344.5 953,-344.5 953,-292.5 953,-292.5 953,-286.5 959,-280.5 965,-280.5"/>
<text text-anchor="start" x="961" y="-341.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="961" y="-326.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> maybe_update_read_progress</text>
<polyline fill="none" stroke="#1c2123" points="953,-318.5 1135,-318.5 "/>
<text text-anchor="start" x="961" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果在pending_remove阶段</text>
<text text-anchor="start" x="961" y="-288.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就不用更新ReadDelegate了</text>
</g>
<!-- Peer__set_region&#45;&gt;Peer__maybe_update_read_progress -->
<g id="edge1" class="edge">
<title>Peer__set_region&#45;&gt;Peer__maybe_update_read_progress</title>
<path fill="none" stroke="#666666" d="M855.04,-408.93C874.93,-401.33 897.1,-392.45 917,-383.5 932.06,-376.73 947.88,-369.04 963.02,-361.38"/>
<polygon fill="#666666" stroke="#666666" points="965.03,-364.29 972.35,-356.63 961.85,-358.05 965.03,-364.29"/>
</g>
<!-- ReadProgress -->
<g id="node4" class="node">
<title>ReadProgress</title>
<path fill="none" stroke="#1c2123" d="M1077.5,-448.5C1077.5,-448.5 1010.5,-448.5 1010.5,-448.5 1004.5,-448.5 998.5,-442.5 998.5,-436.5 998.5,-436.5 998.5,-424.5 998.5,-424.5 998.5,-418.5 1004.5,-412.5 1010.5,-412.5 1010.5,-412.5 1077.5,-412.5 1077.5,-412.5 1083.5,-412.5 1089.5,-418.5 1089.5,-424.5 1089.5,-424.5 1089.5,-436.5 1089.5,-436.5 1089.5,-442.5 1083.5,-448.5 1077.5,-448.5"/>
<text text-anchor="middle" x="1044" y="-426.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadProgress</text>
</g>
<!-- Peer__set_region&#45;&gt;ReadProgress -->
<g id="edge2" class="edge">
<title>Peer__set_region&#45;&gt;ReadProgress</title>
<path fill="none" stroke="#666666" d="M855.1,-430.5C895.54,-430.5 948.61,-430.5 988.04,-430.5"/>
<polygon fill="#666666" stroke="#666666" points="988.26,-434 998.26,-430.5 988.26,-427 988.26,-434"/>
</g>
<!-- Peer__maybe_update_read_progress&#45;&gt;ReaderDelegate__update -->
<g id="edge3" class="edge">
<title>Peer__maybe_update_read_progress&#45;&gt;ReaderDelegate__update</title>
<path fill="none" stroke="#666666" d="M1135.36,-307.31C1232.78,-294.85 1392.28,-273.3 1529,-249.5 1537.43,-248.03 1546.17,-246.41 1554.92,-244.73"/>
<polygon fill="#666666" stroke="#666666" points="1555.63,-248.15 1564.78,-242.8 1554.29,-241.28 1555.63,-248.15"/>
</g>
<!-- ReaderDelegate__fresh_valid_ts -->
<g id="node6" class="node">
<title>ReaderDelegate__fresh_valid_ts</title>
<path fill="none" stroke="#1c2123" d="M1945,-270.5C1945,-270.5 1776,-270.5 1776,-270.5 1770,-270.5 1764,-264.5 1764,-258.5 1764,-258.5 1764,-246.5 1764,-246.5 1764,-240.5 1770,-234.5 1776,-234.5 1776,-234.5 1945,-234.5 1945,-234.5 1951,-234.5 1957,-240.5 1957,-246.5 1957,-246.5 1957,-258.5 1957,-258.5 1957,-264.5 1951,-270.5 1945,-270.5"/>
<text text-anchor="middle" x="1860.5" y="-248.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReaderDelegate__fresh_valid_ts</text>
</g>
<!-- ReaderDelegate__update&#45;&gt;ReaderDelegate__fresh_valid_ts -->
<g id="edge4" class="edge">
<title>ReaderDelegate__update&#45;&gt;ReaderDelegate__fresh_valid_ts</title>
<path fill="none" stroke="#666666" d="M1728.25,-235.78C1736.58,-236.84 1745.13,-237.93 1753.67,-239.02"/>
<polygon fill="#666666" stroke="#666666" points="1753.33,-242.51 1763.69,-240.3 1754.21,-235.56 1753.33,-242.51"/>
</g>
<!-- TrackVer__inc -->
<g id="node7" class="node">
<title>TrackVer__inc</title>
<path fill="none" stroke="#1c2123" d="M1897,-216.5C1897,-216.5 1824,-216.5 1824,-216.5 1818,-216.5 1812,-210.5 1812,-204.5 1812,-204.5 1812,-192.5 1812,-192.5 1812,-186.5 1818,-180.5 1824,-180.5 1824,-180.5 1897,-180.5 1897,-180.5 1903,-180.5 1909,-186.5 1909,-192.5 1909,-192.5 1909,-204.5 1909,-204.5 1909,-210.5 1903,-216.5 1897,-216.5"/>
<text text-anchor="middle" x="1860.5" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TrackVer__inc</text>
</g>
<!-- ReaderDelegate__update&#45;&gt;TrackVer__inc -->
<g id="edge5" class="edge">
<title>ReaderDelegate__update&#45;&gt;TrackVer__inc</title>
<path fill="none" stroke="#666666" d="M1728.25,-215.22C1752.71,-212.1 1779.07,-208.74 1801.7,-205.86"/>
<polygon fill="#666666" stroke="#666666" points="1802.34,-209.31 1811.82,-204.57 1801.45,-202.36 1802.34,-209.31"/>
</g>
<!-- Peer__maybe_renew_leader_lease -->
<g id="node8" class="node">
<title>Peer__maybe_renew_leader_lease</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M684,-130C684,-130 905,-130 905,-130 911,-130 917,-136 917,-142 917,-142 917,-247 917,-247 917,-253 911,-259 905,-259 905,-259 684,-259 684,-259 678,-259 672,-253 672,-247 672,-247 672,-142 672,-142 672,-136 678,-130 684,-130"/>
<text text-anchor="start" x="680" y="-243.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Peer</text>
<text text-anchor="start" x="680" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> maybe_renew_leader_lease</text>
<polyline fill="none" stroke="#8a8898" points="672,-221 917,-221 "/>
<text text-anchor="start" x="680" y="-205.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">try to renew leader lease</text>
<polyline fill="none" stroke="#8a8898" points="672,-198 917,-198 "/>
<text text-anchor="start" x="680" y="-182.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.如果正在spliting/merging则不会更新</text>
<text text-anchor="start" x="680" y="-167.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.如果自己是leader且</text>
<text text-anchor="start" x="680" y="-152.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> read_progress不为None</text>
<text text-anchor="start" x="680" y="-137.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 则尝试更新read_progress</text>
</g>
<!-- Peer__maybe_renew_leader_lease&#45;&gt;Peer__maybe_update_read_progress -->
<g id="edge6" class="edge">
<title>Peer__maybe_renew_leader_lease&#45;&gt;Peer__maybe_update_read_progress</title>
<path fill="none" stroke="#666666" d="M917.07,-255.41C930.88,-262.33 944.72,-269.26 957.91,-275.87"/>
<polygon fill="#666666" stroke="#666666" points="956.43,-279.04 966.93,-280.39 959.56,-272.78 956.43,-279.04"/>
</g>
<!-- Lease__renew -->
<g id="node9" class="node">
<title>Lease__renew</title>
<path fill="none" stroke="#1c2123" d="M1001,-200C1001,-200 1087,-200 1087,-200 1093,-200 1099,-206 1099,-212 1099,-212 1099,-249 1099,-249 1099,-255 1093,-261 1087,-261 1087,-261 1001,-261 1001,-261 995,-261 989,-255 989,-249 989,-249 989,-212 989,-212 989,-206 995,-200 1001,-200"/>
<text text-anchor="start" x="997" y="-245.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease</text>
<text text-anchor="start" x="997" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> renew</text>
<polyline fill="none" stroke="#1c2123" points="989,-223 1099,-223 "/>
<text text-anchor="start" x="997" y="-207.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用ts更新lease</text>
</g>
<!-- Peer__maybe_renew_leader_lease&#45;&gt;Lease__renew -->
<g id="edge7" class="edge">
<title>Peer__maybe_renew_leader_lease&#45;&gt;Lease__renew</title>
<path fill="none" stroke="#666666" d="M917.07,-212.18C938.42,-215.29 959.85,-218.41 978.83,-221.17"/>
<polygon fill="#666666" stroke="#666666" points="978.41,-224.64 988.81,-222.62 979.42,-217.72 978.41,-224.64"/>
</g>
<!-- LeaderLease__maybe_new_remote_lease -->
<g id="node19" class="node">
<title>LeaderLease__maybe_new_remote_lease</title>
<path fill="none" stroke="#1c2123" d="M968,-104.5C968,-104.5 1120,-104.5 1120,-104.5 1126,-104.5 1132,-110.5 1132,-116.5 1132,-116.5 1132,-168.5 1132,-168.5 1132,-174.5 1126,-180.5 1120,-180.5 1120,-180.5 968,-180.5 968,-180.5 962,-180.5 956,-174.5 956,-168.5 956,-168.5 956,-116.5 956,-116.5 956,-110.5 962,-104.5 968,-104.5"/>
<text text-anchor="start" x="964" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LeaderLease</text>
<text text-anchor="start" x="964" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> maybe_new_remote_lease</text>
<polyline fill="none" stroke="#1c2123" points="956,-142.5 1132,-142.5 "/>
<text text-anchor="start" x="964" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Return a new `RemoteLease`</text>
<text text-anchor="start" x="964" y="-112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> if there is none</text>
</g>
<!-- Peer__maybe_renew_leader_lease&#45;&gt;LeaderLease__maybe_new_remote_lease -->
<g id="edge20" class="edge">
<title>Peer__maybe_renew_leader_lease&#45;&gt;LeaderLease__maybe_new_remote_lease</title>
<path fill="none" stroke="#666666" d="M917.07,-168.96C926.78,-166.92 936.51,-164.87 946.01,-162.88"/>
<polygon fill="#666666" stroke="#666666" points="946.76,-166.3 955.83,-160.81 945.32,-159.45 946.76,-166.3"/>
</g>
<!-- RemoteLease__renew -->
<g id="node18" class="node">
<title>RemoteLease__renew</title>
<path fill="none" stroke="#1c2123" d="M1184.5,-207C1184.5,-207 1306.5,-207 1306.5,-207 1312.5,-207 1318.5,-213 1318.5,-219 1318.5,-219 1318.5,-256 1318.5,-256 1318.5,-262 1312.5,-268 1306.5,-268 1306.5,-268 1184.5,-268 1184.5,-268 1178.5,-268 1172.5,-262 1172.5,-256 1172.5,-256 1172.5,-219 1172.5,-219 1172.5,-213 1178.5,-207 1184.5,-207"/>
<text text-anchor="start" x="1180.5" y="-252.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RemoteLease</text>
<text text-anchor="start" x="1180.5" y="-237.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> renew</text>
<polyline fill="none" stroke="#1c2123" points="1172.5,-230 1318.5,-230 "/>
<text text-anchor="start" x="1180.5" y="-214.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用ts刷新leader lease</text>
</g>
<!-- Lease__renew&#45;&gt;RemoteLease__renew -->
<g id="edge19" class="edge">
<title>Lease__renew&#45;&gt;RemoteLease__renew</title>
<path fill="none" stroke="#666666" d="M1099.25,-232.4C1118.67,-233.09 1141.03,-233.87 1162.28,-234.62"/>
<polygon fill="#666666" stroke="#666666" points="1162.17,-238.11 1172.28,-234.97 1162.41,-231.12 1162.17,-238.11"/>
</g>
<!-- Peer__apply_reads -->
<g id="node10" class="node">
<title>Peer__apply_reads</title>
<path fill="none" stroke="#1c2123" d="M416,-247.5C416,-247.5 624,-247.5 624,-247.5 630,-247.5 636,-253.5 636,-259.5 636,-259.5 636,-341.5 636,-341.5 636,-347.5 630,-353.5 624,-353.5 624,-353.5 416,-353.5 416,-353.5 410,-353.5 404,-347.5 404,-341.5 404,-341.5 404,-259.5 404,-259.5 404,-253.5 410,-247.5 416,-247.5"/>
<text text-anchor="start" x="412" y="-338.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="412" y="-323.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_reads</text>
<polyline fill="none" stroke="#1c2123" points="404,-315.5 636,-315.5 "/>
<text text-anchor="start" x="412" y="-300.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.处理ready中的read_states</text>
<text text-anchor="start" x="412" y="-285.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.如果是leader</text>
<text text-anchor="start" x="412" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 使用pending_reads中的last_ready</text>
<text text-anchor="start" x="412" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的renew_lease_time 更新leader_lease</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge8" class="edge">
<title>Peer__apply_reads&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M636.17,-255.7C644.81,-252.34 653.57,-248.93 662.3,-245.54"/>
<polygon fill="#666666" stroke="#666666" points="663.7,-248.75 671.75,-241.86 661.16,-242.22 663.7,-248.75"/>
</g>
<!-- Peer__pending_reads -->
<g id="node16" class="node">
<title>Peer__pending_reads</title>
<path fill="#feed9b" stroke="#f7e495" d="M757,-335.5C757,-335.5 832,-335.5 832,-335.5 838,-335.5 844,-341.5 844,-347.5 844,-347.5 844,-361.5 844,-361.5 844,-367.5 838,-373.5 832,-373.5 832,-373.5 757,-373.5 757,-373.5 751,-373.5 745,-367.5 745,-361.5 745,-361.5 745,-347.5 745,-347.5 745,-341.5 751,-335.5 757,-335.5"/>
<text text-anchor="start" x="753" y="-358.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Peer</text>
<text text-anchor="start" x="753" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_reads</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Peer__pending_reads -->
<g id="edge17" class="edge">
<title>Peer__apply_reads&#45;&gt;Peer__pending_reads</title>
<path fill="none" stroke="#666666" d="M636.17,-323.32C670.21,-330.07 706.06,-337.17 734.92,-342.89"/>
<polygon fill="#666666" stroke="#666666" points="734.33,-346.34 744.82,-344.85 735.69,-339.48 734.33,-346.34"/>
</g>
<!-- Lease__inspect -->
<g id="node17" class="node">
<title>Lease__inspect</title>
<path fill="none" stroke="#1c2123" d="M777,-278.5C777,-278.5 812,-278.5 812,-278.5 818,-278.5 824,-284.5 824,-290.5 824,-290.5 824,-304.5 824,-304.5 824,-310.5 818,-316.5 812,-316.5 812,-316.5 777,-316.5 777,-316.5 771,-316.5 765,-310.5 765,-304.5 765,-304.5 765,-290.5 765,-290.5 765,-284.5 771,-278.5 777,-278.5"/>
<text text-anchor="start" x="773" y="-301.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lease</text>
<text text-anchor="start" x="773" y="-286.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> inspect</text>
</g>
<!-- Peer__apply_reads&#45;&gt;Lease__inspect -->
<g id="edge18" class="edge">
<title>Peer__apply_reads&#45;&gt;Lease__inspect</title>
<path fill="none" stroke="#666666" d="M636.17,-299.23C678.4,-298.77 723.4,-298.27 754.4,-297.93"/>
<polygon fill="#666666" stroke="#666666" points="754.8,-301.43 764.76,-297.82 754.72,-294.43 754.8,-301.43"/>
</g>
<!-- Peer__handle_raft_comitted_entries -->
<g id="node11" class="node">
<title>Peer__handle_raft_comitted_entries</title>
<path fill="none" stroke="#1c2123" d="M442.5,-57.5C442.5,-57.5 597.5,-57.5 597.5,-57.5 603.5,-57.5 609.5,-63.5 609.5,-69.5 609.5,-69.5 609.5,-121.5 609.5,-121.5 609.5,-127.5 603.5,-133.5 597.5,-133.5 597.5,-133.5 442.5,-133.5 442.5,-133.5 436.5,-133.5 430.5,-127.5 430.5,-121.5 430.5,-121.5 430.5,-69.5 430.5,-69.5 430.5,-63.5 436.5,-57.5 442.5,-57.5"/>
<text text-anchor="start" x="438.5" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="438.5" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_comitted_entries</text>
<polyline fill="none" stroke="#1c2123" points="430.5,-95.5 609.5,-95.5 "/>
<text text-anchor="start" x="438.5" y="-80.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">跟据write propose时间</text>
<text text-anchor="start" x="438.5" y="-65.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新leader lease</text>
</g>
<!-- Peer__handle_raft_comitted_entries&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge9" class="edge">
<title>Peer__handle_raft_comitted_entries&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M609.85,-127.78C626.49,-133.83 644.21,-140.26 661.83,-146.66"/>
<polygon fill="#666666" stroke="#666666" points="661.01,-150.09 671.6,-150.21 663.4,-143.51 661.01,-150.09"/>
</g>
<!-- ProposalQueue__find_propose_time -->
<g id="node21" class="node">
<title>ProposalQueue__find_propose_time</title>
<path fill="none" stroke="#1c2123" d="M715,-20C715,-20 874,-20 874,-20 880,-20 886,-26 886,-32 886,-32 886,-99 886,-99 886,-105 880,-111 874,-111 874,-111 715,-111 715,-111 709,-111 703,-105 703,-99 703,-99 703,-32 703,-32 703,-26 709,-20 715,-20"/>
<text text-anchor="start" x="711" y="-95.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ProposalQueue</text>
<text text-anchor="start" x="711" y="-80.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> find_propose_time</text>
<polyline fill="none" stroke="#1c2123" points="703,-73 886,-73 "/>
<text text-anchor="start" x="711" y="-57.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">找到log entry的proposal time</text>
<text text-anchor="start" x="711" y="-42.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 根据他来更新刷新</text>
<text text-anchor="middle" x="794.5" y="-27.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 自己的leader lease</text>
</g>
<!-- Peer__handle_raft_comitted_entries&#45;&gt;ProposalQueue__find_propose_time -->
<g id="edge23" class="edge">
<title>Peer__handle_raft_comitted_entries&#45;&gt;ProposalQueue__find_propose_time</title>
<path fill="none" stroke="#666666" d="M609.85,-85.72C636.29,-82.81 665.46,-79.6 692.61,-76.61"/>
<polygon fill="#666666" stroke="#666666" points="693.35,-80.05 702.9,-75.47 692.58,-73.09 693.35,-80.05"/>
</g>
<!-- Peer__on_role_changed -->
<g id="node12" class="node">
<title>Peer__on_role_changed</title>
<path fill="none" stroke="#1c2123" d="M450,-152.5C450,-152.5 590,-152.5 590,-152.5 596,-152.5 602,-158.5 602,-164.5 602,-164.5 602,-216.5 602,-216.5 602,-222.5 596,-228.5 590,-228.5 590,-228.5 450,-228.5 450,-228.5 444,-228.5 438,-222.5 438,-216.5 438,-216.5 438,-164.5 438,-164.5 438,-158.5 444,-152.5 450,-152.5"/>
<text text-anchor="start" x="446" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="446" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_role_changed</text>
<polyline fill="none" stroke="#1c2123" points="438,-190.5 602,-190.5 "/>
<text text-anchor="start" x="446" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果自己刚成为leader也</text>
<text text-anchor="start" x="446" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 刷新leader lease</text>
</g>
<!-- Peer__on_role_changed&#45;&gt;Peer__maybe_renew_leader_lease -->
<g id="edge10" class="edge">
<title>Peer__on_role_changed&#45;&gt;Peer__maybe_renew_leader_lease</title>
<path fill="none" stroke="#666666" d="M602.02,-191.69C620.9,-191.97 641.47,-192.27 661.91,-192.57"/>
<polygon fill="#666666" stroke="#666666" points="661.87,-196.07 671.93,-192.72 661.98,-189.07 661.87,-196.07"/>
</g>
<!-- Peer__handle_raft_ready_append -->
<g id="node13" class="node">
<title>Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M216,-112C216,-112 356,-112 356,-112 362,-112 368,-118 368,-124 368,-124 368,-161 368,-161 368,-167 362,-173 356,-173 356,-173 216,-173 216,-173 210,-173 204,-167 204,-161 204,-161 204,-124 204,-124 204,-118 210,-112 216,-112"/>
<text text-anchor="start" x="212" y="-157.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="212" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_ready_append</text>
<polyline fill="none" stroke="#1c2123" points="204,-135 368,-135 "/>
<text text-anchor="start" x="212" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.调用raft_group.ready()</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__apply_reads -->
<g id="edge11" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__apply_reads</title>
<path fill="none" stroke="#666666" d="M321.31,-173.12C343.98,-192.65 374.79,-217.87 404,-237.5 406.19,-238.97 408.42,-240.44 410.68,-241.9"/>
<polygon fill="#666666" stroke="#666666" points="409.19,-245.1 419.52,-247.5 412.94,-239.19 409.19,-245.1"/>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__handle_raft_comitted_entries -->
<g id="edge12" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__handle_raft_comitted_entries</title>
<path fill="none" stroke="#666666" d="M368.14,-126.06C384.96,-122.65 402.86,-119.03 420.24,-115.51"/>
<polygon fill="#666666" stroke="#666666" points="421.28,-118.87 430.39,-113.45 419.9,-112.01 421.28,-118.87"/>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed -->
<g id="edge13" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed</title>
<path fill="none" stroke="#666666" d="M368.14,-159.29C387.48,-163.29 408.24,-167.58 427.99,-171.67"/>
<polygon fill="#666666" stroke="#666666" points="427.4,-175.12 437.9,-173.72 428.82,-168.27 427.4,-175.12"/>
</g>
<!-- RawNode__ready -->
<g id="node15" class="node">
<title>RawNode__ready</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M496.5,-0.5C496.5,-0.5 543.5,-0.5 543.5,-0.5 549.5,-0.5 555.5,-6.5 555.5,-12.5 555.5,-12.5 555.5,-26.5 555.5,-26.5 555.5,-32.5 549.5,-38.5 543.5,-38.5 543.5,-38.5 496.5,-38.5 496.5,-38.5 490.5,-38.5 484.5,-32.5 484.5,-26.5 484.5,-26.5 484.5,-12.5 484.5,-12.5 484.5,-6.5 490.5,-0.5 496.5,-0.5"/>
<text text-anchor="start" x="492.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RawNode</text>
<text text-anchor="start" x="492.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> ready</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;RawNode__ready -->
<g id="edge16" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;RawNode__ready</title>
<path fill="none" stroke="#666666" d="M317.08,-111.69C339.27,-90.66 371.18,-63.78 404,-47.5 425.93,-36.62 452.35,-29.81 474.34,-25.63"/>
<polygon fill="#666666" stroke="#666666" points="475.19,-29.03 484.42,-23.83 473.96,-22.14 475.19,-29.03"/>
</g>
<!-- PeerFsmDelegate__collect_ready -->
<g id="node14" class="node">
<title>PeerFsmDelegate__collect_ready</title>
<path fill="none" stroke="#1c2123" d="M12,-104.5C12,-104.5 156,-104.5 156,-104.5 162,-104.5 168,-110.5 168,-116.5 168,-116.5 168,-168.5 168,-168.5 168,-174.5 162,-180.5 156,-180.5 156,-180.5 12,-180.5 12,-180.5 6,-180.5 0,-174.5 0,-168.5 0,-168.5 0,-116.5 0,-116.5 0,-110.5 6,-104.5 12,-104.5"/>
<text text-anchor="start" x="8" y="-165.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="8" y="-150.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> collect_ready</text>
<polyline fill="none" stroke="#1c2123" points="0,-142.5 168,-142.5 "/>
<text text-anchor="start" x="8" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用raftgroup.ready</text>
<text text-anchor="start" x="8" y="-112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后处理 它返回的ready</text>
</g>
<!-- PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append -->
<g id="edge14" class="edge">
<title>PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M168.08,-142.5C176.57,-142.5 185.22,-142.5 193.78,-142.5"/>
<polygon fill="#666666" stroke="#666666" points="193.79,-146 203.79,-142.5 193.79,-139 193.79,-146"/>
</g>
<!-- RemoteLease -->
<g id="node20" class="node">
<title>RemoteLease</title>
<path fill="none" stroke="#1c2123" d="M1183,-97C1183,-97 1308,-97 1308,-97 1314,-97 1320,-103 1320,-109 1320,-109 1320,-176 1320,-176 1320,-182 1314,-188 1308,-188 1308,-188 1183,-188 1183,-188 1177,-188 1171,-182 1171,-176 1171,-176 1171,-109 1171,-109 1171,-103 1177,-97 1183,-97"/>
<text text-anchor="middle" x="1245.5" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RemoteLease</text>
<polyline fill="none" stroke="#1c2123" points="1171,-165 1320,-165 "/>
<text text-anchor="start" x="1179" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">新建一个RemoteLease</text>
<text text-anchor="start" x="1179" y="-134.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后返回它的clone</text>
<text text-anchor="start" x="1179" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在后面ReaderDelegate</text>
<text text-anchor="start" x="1179" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> update时会使用它</text>
</g>
<!-- LeaderLease__maybe_new_remote_lease&#45;&gt;RemoteLease -->
<g id="edge21" class="edge">
<title>LeaderLease__maybe_new_remote_lease&#45;&gt;RemoteLease</title>
<path fill="none" stroke="#666666" d="M1132.21,-142.5C1141.68,-142.5 1151.31,-142.5 1160.74,-142.5"/>
<polygon fill="#666666" stroke="#666666" points="1160.87,-146 1170.87,-142.5 1160.87,-139 1160.87,-146"/>
</g>
<!-- RemoteLease&#45;&gt;Progress -->
<g id="edge22" class="edge">
<title>RemoteLease&#45;&gt;Progress</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1320.22,-157.62C1328.59,-159.34 1337.21,-161.11 1345.82,-162.87"/>
<polygon fill="green" stroke="green" points="1345.39,-166.36 1355.89,-164.94 1346.8,-159.5 1345.39,-166.36"/>
</g>
</g>
</svg>
