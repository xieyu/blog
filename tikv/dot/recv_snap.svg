<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: recv_snap Pages: 1 -->
<svg width="1260pt" height="325pt"
 viewBox="0.00 0.00 1260.00 324.94" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 320.94)">
<title>recv_snap</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-320.94 1256,-320.94 1256,4 -4,4"/>
<g id="clust4" class="cluster">
<title>cluster_Loop</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M602.5,-184.94C602.5,-184.94 1221,-184.94 1221,-184.94 1227,-184.94 1233,-190.94 1233,-196.94 1233,-196.94 1233,-296.94 1233,-296.94 1233,-302.94 1227,-308.94 1221,-308.94 1221,-308.94 602.5,-308.94 602.5,-308.94 596.5,-308.94 590.5,-302.94 590.5,-296.94 590.5,-296.94 590.5,-196.94 590.5,-196.94 590.5,-190.94 596.5,-184.94 602.5,-184.94"/>
<text text-anchor="middle" x="911.75" y="-288.94" font-family="Times,serif" font-size="20.00">Loop</text>
</g>
<!-- recv_snap -->
<g id="node1" class="node">
<title>recv_snap</title>
<path fill="none" stroke="#1c2123" d="M331,-169.94C331,-169.94 284,-169.94 284,-169.94 278,-169.94 272,-163.94 272,-157.94 272,-157.94 272,-145.94 272,-145.94 272,-139.94 278,-133.94 284,-133.94 284,-133.94 331,-133.94 331,-133.94 337,-133.94 343,-139.94 343,-145.94 343,-145.94 343,-157.94 343,-157.94 343,-163.94 337,-169.94 331,-169.94"/>
<text text-anchor="middle" x="307.5" y="-148.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">recv_snap</text>
</g>
<!-- stream_next_await_transpose -->
<g id="node2" class="node">
<title>stream_next_await_transpose</title>
<path fill="none" stroke="#1c2123" d="M391,-113.94C391,-113.94 490,-113.94 490,-113.94 496,-113.94 502,-119.94 502,-125.94 502,-125.94 502,-177.94 502,-177.94 502,-183.94 496,-189.94 490,-189.94 490,-189.94 391,-189.94 391,-189.94 385,-189.94 379,-183.94 379,-177.94 379,-177.94 379,-125.94 379,-125.94 379,-119.94 385,-113.94 391,-113.94"/>
<text text-anchor="start" x="387" y="-174.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. stream.next()</text>
<text text-anchor="middle" x="440.5" y="-159.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .await.transpose()?</text>
<polyline fill="none" stroke="#1c2123" points="379,-151.94 502,-151.94 "/>
<text text-anchor="start" x="387" y="-136.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取第一包中的</text>
<text text-anchor="start" x="387" y="-121.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 元信息</text>
</g>
<!-- recv_snap&#45;&gt;stream_next_await_transpose -->
<g id="edge1" class="edge">
<title>recv_snap&#45;&gt;stream_next_await_transpose</title>
<path fill="none" stroke="#666666" d="M343.26,-151.94C351.25,-151.94 360.02,-151.94 368.92,-151.94"/>
<polygon fill="#666666" stroke="#666666" points="368.99,-155.44 378.99,-151.94 368.99,-148.44 368.99,-155.44"/>
</g>
<!-- RecvSnapContext_new -->
<g id="node3" class="node">
<title>RecvSnapContext_new</title>
<path fill="none" stroke="#1c2123" d="M550,-23.44C550,-23.44 780,-23.44 780,-23.44 786,-23.44 792,-29.44 792,-35.44 792,-35.44 792,-164.44 792,-164.44 792,-170.44 786,-176.44 780,-176.44 780,-176.44 550,-176.44 550,-176.44 544,-176.44 538,-170.44 538,-164.44 538,-164.44 538,-35.44 538,-35.44 538,-29.44 544,-23.44 550,-23.44"/>
<text text-anchor="middle" x="665" y="-161.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. RecvSnapContext::new</text>
<polyline fill="none" stroke="#1c2123" points="538,-153.44 792,-153.44 "/>
<text text-anchor="start" x="546" y="-138.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">key: SnapKey,</text>
<polyline fill="none" stroke="#1c2123" points="538,-130.44 792,-130.44 "/>
<text text-anchor="start" x="546" y="-115.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">file: Option&lt;Box&lt;dyn GenericSnapshot&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="538,-107.44 792,-107.44 "/>
<text text-anchor="start" x="546" y="-92.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">raft_msg: RaftMessage,</text>
<polyline fill="none" stroke="#1c2123" points="538,-84.44 792,-84.44 "/>
<text text-anchor="start" x="546" y="-69.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">_with_io_type: WithIOType,</text>
<polyline fill="none" stroke="#1c2123" points="538,-61.44 792,-61.44 "/>
<text text-anchor="start" x="546" y="-46.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用header中的元信息</text>
<text text-anchor="start" x="546" y="-31.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 创建RecvSnapContext</text>
</g>
<!-- recv_snap&#45;&gt;RecvSnapContext_new -->
<g id="edge2" class="edge">
<title>recv_snap&#45;&gt;RecvSnapContext_new</title>
<path fill="none" stroke="#666666" d="M328.38,-133.69C341.65,-122.78 360.08,-109.91 379,-103.94 426.03,-89.08 479.63,-85.19 527.57,-85.97"/>
<polygon fill="#666666" stroke="#666666" points="527.63,-89.47 537.7,-86.21 527.79,-82.48 527.63,-89.47"/>
</g>
<!-- stream_next_await -->
<g id="node4" class="node">
<title>stream_next_await</title>
<path fill="none" stroke="#1c2123" d="M610.5,-195.94C610.5,-195.94 719.5,-195.94 719.5,-195.94 725.5,-195.94 731.5,-201.94 731.5,-207.94 731.5,-207.94 731.5,-229.94 731.5,-229.94 731.5,-235.94 725.5,-241.94 719.5,-241.94 719.5,-241.94 610.5,-241.94 610.5,-241.94 604.5,-241.94 598.5,-235.94 598.5,-229.94 598.5,-229.94 598.5,-207.94 598.5,-207.94 598.5,-201.94 604.5,-195.94 610.5,-195.94"/>
<text text-anchor="middle" x="665" y="-226.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">3.stream.next().await</text>
<polyline fill="none" stroke="#1c2123" points="598.5,-218.94 731.5,-218.94 "/>
<text text-anchor="middle" x="665" y="-203.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取snap数据</text>
</g>
<!-- recv_snap&#45;&gt;stream_next_await -->
<g id="edge3" class="edge">
<title>recv_snap&#45;&gt;stream_next_await</title>
<path fill="none" stroke="#666666" d="M328.79,-170.08C342.08,-180.81 360.38,-193.51 379,-199.94 446.99,-223.39 529.43,-226.37 588.11,-224.54"/>
<polygon fill="#666666" stroke="#666666" points="588.55,-228.03 598.42,-224.16 588.29,-221.03 588.55,-228.03"/>
</g>
<!-- Context_file_write_all -->
<g id="node5" class="node">
<title>Context_file_write_all</title>
<path fill="none" stroke="#1c2123" d="M1073,-193.94C1073,-193.94 1213,-193.94 1213,-193.94 1219,-193.94 1225,-199.94 1225,-205.94 1225,-205.94 1225,-257.94 1225,-257.94 1225,-263.94 1219,-269.94 1213,-269.94 1213,-269.94 1073,-269.94 1073,-269.94 1067,-269.94 1061,-263.94 1061,-257.94 1061,-257.94 1061,-205.94 1061,-205.94 1061,-199.94 1067,-193.94 1073,-193.94"/>
<text text-anchor="middle" x="1143" y="-254.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">4. Context_file_write_all</text>
<polyline fill="none" stroke="#1c2123" points="1061,-246.94 1225,-246.94 "/>
<text text-anchor="start" x="1069" y="-231.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">GenericSnapshot_write_all</text>
<text text-anchor="start" x="1069" y="-216.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将数据写入</text>
<text text-anchor="start" x="1069" y="-201.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 磁盘文件</text>
</g>
<!-- recv_snap&#45;&gt;Context_file_write_all -->
<g id="edge4" class="edge">
<title>recv_snap&#45;&gt;Context_file_write_all</title>
<path fill="none" stroke="#666666" d="M320.76,-170.13C333.29,-187.18 354.38,-211.95 379,-224.94 442.39,-258.39 466.58,-245.91 538,-251.94 719.33,-267.22 932.21,-252.61 1050.65,-241.6"/>
<polygon fill="#666666" stroke="#666666" points="1051.13,-245.07 1060.76,-240.65 1050.47,-238.1 1051.13,-245.07"/>
</g>
<!-- Context_finsih -->
<g id="node6" class="node">
<title>Context_finsih</title>
<path fill="none" stroke="#1c2123" d="M846,-10.44C846,-10.44 980,-10.44 980,-10.44 986,-10.44 992,-16.44 992,-22.44 992,-22.44 992,-59.44 992,-59.44 992,-65.44 986,-71.44 980,-71.44 980,-71.44 846,-71.44 846,-71.44 840,-71.44 834,-65.44 834,-59.44 834,-59.44 834,-22.44 834,-22.44 834,-16.44 840,-10.44 846,-10.44"/>
<text text-anchor="middle" x="913" y="-56.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">5.RecvSnapContext.finish</text>
<polyline fill="none" stroke="#1c2123" points="834,-48.44 992,-48.44 "/>
<text text-anchor="start" x="842" y="-33.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">向raft store router</text>
<text text-anchor="middle" x="913" y="-18.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送raftMessage</text>
</g>
<!-- recv_snap&#45;&gt;Context_finsih -->
<g id="edge5" class="edge">
<title>recv_snap&#45;&gt;Context_finsih</title>
<path fill="none" stroke="#666666" d="M323.52,-133.92C336.87,-118.78 357.54,-97.37 379,-82.94 442.92,-39.95 462.57,-29.6 538,-13.94 648.53,9.01 679.8,-1.47 792,-13.94 802.48,-15.1 813.38,-16.82 824.16,-18.84"/>
<polygon fill="#666666" stroke="#666666" points="823.51,-22.28 833.99,-20.77 824.86,-15.41 823.51,-22.28"/>
</g>
<!-- stream_next_await_transpose&#45;&gt;RecvSnapContext_new -->
<g id="edge10" class="edge">
<title>stream_next_await_transpose&#45;&gt;RecvSnapContext_new</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M502.01,-137.8C510.23,-135.87 518.92,-133.84 527.84,-131.76"/>
<polygon fill="green" stroke="green" points="528.65,-135.16 537.59,-129.48 527.06,-128.35 528.65,-135.16"/>
</g>
<!-- RecvSnapContext_new&#45;&gt;Context_finsih -->
<g id="edge6" class="edge">
<title>RecvSnapContext_new&#45;&gt;Context_finsih</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M792.24,-69.66C802.97,-67.09 813.67,-64.52 824,-62.04"/>
<polygon fill="green" stroke="green" points="824.88,-65.43 833.79,-59.69 823.25,-58.62 824.88,-65.43"/>
</g>
<!-- SnapManager_get_snapshot_for_receiving -->
<g id="node7" class="node">
<title>SnapManager_get_snapshot_for_receiving</title>
<path fill="none" stroke="#1c2123" d="M840,-108.94C840,-108.94 986,-108.94 986,-108.94 992,-108.94 998,-114.94 998,-120.94 998,-120.94 998,-134.94 998,-134.94 998,-140.94 992,-146.94 986,-146.94 986,-146.94 840,-146.94 840,-146.94 834,-146.94 828,-140.94 828,-134.94 828,-134.94 828,-120.94 828,-120.94 828,-114.94 834,-108.94 840,-108.94"/>
<text text-anchor="start" x="836" y="-131.74" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManager</text>
<text text-anchor="start" x="836" y="-116.74" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_snapshot_for_receiving</text>
</g>
<!-- RecvSnapContext_new&#45;&gt;SnapManager_get_snapshot_for_receiving -->
<g id="edge7" class="edge">
<title>RecvSnapContext_new&#45;&gt;SnapManager_get_snapshot_for_receiving</title>
<path fill="none" stroke="#666666" d="M792.24,-114.31C800.8,-115.28 809.33,-116.25 817.68,-117.2"/>
<polygon fill="#666666" stroke="#666666" points="817.42,-120.69 827.76,-118.35 818.22,-113.74 817.42,-120.69"/>
</g>
<!-- stream_next_await&#45;&gt;Context_file_write_all -->
<g id="edge9" class="edge">
<title>stream_next_await&#45;&gt;Context_file_write_all</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M731.69,-220.73C814.49,-222.99 957.27,-226.89 1050.66,-229.44"/>
<polygon fill="green" stroke="green" points="1050.58,-232.94 1060.67,-229.71 1050.77,-225.94 1050.58,-232.94"/>
</g>
<!-- RaftStoreRouter_send_raft_msg -->
<g id="node8" class="node">
<title>RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#1c2123" d="M1046,-14.44C1046,-14.44 1240,-14.44 1240,-14.44 1246,-14.44 1252,-20.44 1252,-26.44 1252,-26.44 1252,-55.44 1252,-55.44 1252,-61.44 1246,-67.44 1240,-67.44 1240,-67.44 1046,-67.44 1046,-67.44 1040,-67.44 1034,-61.44 1034,-55.44 1034,-55.44 1034,-26.44 1034,-26.44 1034,-20.44 1040,-14.44 1046,-14.44"/>
<text text-anchor="start" x="1042" y="-52.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">6.RaftStoreRouter</text>
<text text-anchor="start" x="1042" y="-37.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_msg 将RaftMessage转发</text>
<text text-anchor="start" x="1042" y="-22.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 给对应的PeerFsm</text>
</g>
<!-- Context_finsih&#45;&gt;RaftStoreRouter_send_raft_msg -->
<g id="edge11" class="edge">
<title>Context_finsih&#45;&gt;RaftStoreRouter_send_raft_msg</title>
<path fill="none" stroke="#666666" d="M992.15,-40.94C1002.31,-40.94 1012.89,-40.94 1023.52,-40.94"/>
<polygon fill="#666666" stroke="#666666" points="1023.72,-44.44 1033.72,-40.94 1023.72,-37.44 1023.72,-44.44"/>
</g>
<!-- SnapManager_get_snapshot_for_receiving&#45;&gt;Context_file_write_all -->
<g id="edge8" class="edge">
<title>SnapManager_get_snapshot_for_receiving&#45;&gt;Context_file_write_all</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M955.82,-147.01C982.61,-159.23 1018.44,-175.58 1051.51,-190.66"/>
<polygon fill="green" stroke="green" points="1050.2,-193.91 1060.75,-194.88 1053.11,-187.54 1050.2,-193.91"/>
</g>
<!-- KvService_snapshot -->
<g id="node9" class="node">
<title>KvService_snapshot</title>
<path fill="none" stroke="#1c2123" d="M12,-106.44C12,-106.44 120,-106.44 120,-106.44 126,-106.44 132,-112.44 132,-118.44 132,-118.44 132,-185.44 132,-185.44 132,-191.44 126,-197.44 120,-197.44 120,-197.44 12,-197.44 12,-197.44 6,-197.44 0,-191.44 0,-185.44 0,-185.44 0,-118.44 0,-118.44 0,-112.44 6,-106.44 12,-106.44"/>
<text text-anchor="start" x="8" y="-182.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">KvService</text>
<text text-anchor="start" x="8" y="-167.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snapshot</text>
<polyline fill="none" stroke="#1c2123" points="0,-159.44 132,-159.44 "/>
<text text-anchor="start" x="8" y="-144.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">GRPC snapshot接口</text>
<text text-anchor="start" x="8" y="-129.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送recv task到</text>
<text text-anchor="start" x="8" y="-114.24" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snap&#45;handler worker</text>
</g>
<!-- scheduler -->
<g id="node10" class="node">
<title>scheduler</title>
<path fill="none" stroke="#1c2123" d="M224,-169.94C224,-169.94 180,-169.94 180,-169.94 174,-169.94 168,-163.94 168,-157.94 168,-157.94 168,-145.94 168,-145.94 168,-139.94 174,-133.94 180,-133.94 180,-133.94 224,-133.94 224,-133.94 230,-133.94 236,-139.94 236,-145.94 236,-145.94 236,-157.94 236,-157.94 236,-163.94 230,-169.94 224,-169.94"/>
<text text-anchor="middle" x="202" y="-148.24" font-family="Times,serif" font-size="14.00" fill="#2f3638">scheduler</text>
</g>
<!-- KvService_snapshot&#45;&gt;scheduler -->
<g id="edge12" class="edge">
<title>KvService_snapshot&#45;&gt;scheduler</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M132.04,-151.94C140.76,-151.94 149.52,-151.94 157.74,-151.94"/>
<polygon fill="green" stroke="green" points="157.81,-155.44 167.81,-151.94 157.81,-148.44 157.81,-155.44"/>
</g>
<!-- scheduler&#45;&gt;recv_snap -->
<g id="edge13" class="edge">
<title>scheduler&#45;&gt;recv_snap</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M236.03,-151.94C244.28,-151.94 253.26,-151.94 261.97,-151.94"/>
<polygon fill="green" stroke="green" points="262,-155.44 272,-151.94 262,-148.44 262,-155.44"/>
</g>
</g>
</svg>
