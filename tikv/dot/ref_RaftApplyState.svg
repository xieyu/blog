<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_apply_state Pages: 1 -->
<svg width="1476pt" height="350pt"
 viewBox="0.00 0.00 1476.00 350.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 346)">
<title>raft_apply_state</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-346 1472,-346 1472,4 -4,4"/>
<!-- RaftApplyState -->
<g id="node1" class="node">
<title>RaftApplyState</title>
<path fill="none" stroke="#1c2123" d="M1083,-119C1083,-119 1298,-119 1298,-119 1304,-119 1310,-125 1310,-131 1310,-131 1310,-222 1310,-222 1310,-228 1304,-234 1298,-234 1298,-234 1083,-234 1083,-234 1077,-234 1071,-228 1071,-222 1071,-222 1071,-131 1071,-131 1071,-125 1077,-119 1083,-119"/>
<text text-anchor="middle" x="1190.5" y="-218.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftApplyState</text>
<polyline fill="none" stroke="#1c2123" points="1071,-211 1310,-211 "/>
<text text-anchor="start" x="1079" y="-195.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub applied_index: u64,</text>
<polyline fill="none" stroke="#1c2123" points="1071,-188 1310,-188 "/>
<text text-anchor="start" x="1079" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub commit_index: u64,</text>
<polyline fill="none" stroke="#1c2123" points="1071,-165 1310,-165 "/>
<text text-anchor="start" x="1079" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub commit_term: u64,</text>
<polyline fill="none" stroke="#1c2123" points="1071,-142 1310,-142 "/>
<text text-anchor="start" x="1079" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub truncated_state: RaftTruncatedState,</text>
</g>
<!-- RaftTruncatedState -->
<g id="node3" class="node">
<title>RaftTruncatedState</title>
<path fill="none" stroke="#1c2123" d="M1456,-194.5C1456,-194.5 1358,-194.5 1358,-194.5 1352,-194.5 1346,-188.5 1346,-182.5 1346,-182.5 1346,-170.5 1346,-170.5 1346,-164.5 1352,-158.5 1358,-158.5 1358,-158.5 1456,-158.5 1456,-158.5 1462,-158.5 1468,-164.5 1468,-170.5 1468,-170.5 1468,-182.5 1468,-182.5 1468,-188.5 1462,-194.5 1456,-194.5"/>
<text text-anchor="middle" x="1407" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftTruncatedState</text>
</g>
<!-- RaftApplyState&#45;&gt;RaftTruncatedState -->
<g id="edge2" class="edge">
<title>RaftApplyState&#45;&gt;RaftTruncatedState</title>
<path fill="none" stroke="#666666" d="M1310.04,-176.5C1318.86,-176.5 1327.57,-176.5 1335.94,-176.5"/>
<polygon fill="#666666" stroke="#666666" points="1335.96,-180 1345.96,-176.5 1335.96,-173 1335.96,-180"/>
</g>
<!-- ApplyRes -->
<g id="node2" class="node">
<title>ApplyRes</title>
<path fill="none" stroke="#1c2123" d="M12,-203.5C12,-203.5 245,-203.5 245,-203.5 251,-203.5 257,-209.5 257,-215.5 257,-215.5 257,-329.5 257,-329.5 257,-335.5 251,-341.5 245,-341.5 245,-341.5 12,-341.5 12,-341.5 6,-341.5 0,-335.5 0,-329.5 0,-329.5 0,-215.5 0,-215.5 0,-209.5 6,-203.5 12,-203.5"/>
<text text-anchor="middle" x="128.5" y="-326.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyRes</text>
<polyline fill="none" stroke="#1c2123" points="0,-318.5 257,-318.5 "/>
<text text-anchor="start" x="8" y="-303.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub region_id: u64,</text>
<polyline fill="none" stroke="#1c2123" points="0,-295.5 257,-295.5 "/>
<text text-anchor="start" x="8" y="-280.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub apply_state: RaftApplyState,</text>
<polyline fill="none" stroke="#1c2123" points="0,-272.5 257,-272.5 "/>
<text text-anchor="start" x="8" y="-257.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub applied_index_term: u64,</text>
<polyline fill="none" stroke="#1c2123" points="0,-249.5 257,-249.5 "/>
<text text-anchor="start" x="8" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub exec_res: VecDeque&lt;ExecResult&lt;S&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="0,-226.5 257,-226.5 "/>
<text text-anchor="start" x="8" y="-211.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub metrics: ApplyMetrics,</text>
</g>
<!-- ApplyRes&#45;&gt;RaftApplyState -->
<g id="edge1" class="edge">
<title>ApplyRes&#45;&gt;RaftApplyState</title>
<path fill="none" stroke="#666666" d="M257.02,-288.34C434.76,-306.26 765.52,-324.39 1035,-252.5 1048.85,-248.81 1062.92,-243.83 1076.66,-238.18"/>
<polygon fill="#666666" stroke="#666666" points="1078.27,-241.3 1086.11,-234.17 1075.54,-234.86 1078.27,-241.3"/>
</g>
<!-- RaftPoller -->
<g id="node8" class="node">
<title>RaftPoller</title>
<path fill="none" stroke="#1c2123" d="M305,-138C305,-138 498,-138 498,-138 504,-138 510,-144 510,-150 510,-150 510,-187 510,-187 510,-193 504,-199 498,-199 498,-199 305,-199 305,-199 299,-199 293,-193 293,-187 293,-187 293,-150 293,-150 293,-144 299,-138 305,-138"/>
<text text-anchor="middle" x="401.5" y="-183.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftPoller</text>
<polyline fill="none" stroke="#1c2123" points="293,-176 510,-176 "/>
<text text-anchor="start" x="301" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送ApplyMsg给ApplyPoller</text>
<text text-anchor="start" x="301" y="-145.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后等待处理它发ApplyRes过来</text>
</g>
<!-- ApplyRes&#45;&gt;RaftPoller -->
<g id="edge13" class="edge">
<title>ApplyRes&#45;&gt;RaftPoller</title>
<path fill="none" stroke="#666666" d="M257.06,-223.55C275.37,-216.52 293.86,-209.42 311.21,-202.77"/>
<polygon fill="#666666" stroke="#666666" points="312.64,-205.97 320.72,-199.12 310.13,-199.43 312.64,-205.97"/>
</g>
<!-- ApplyFsmDelegate -->
<g id="node4" class="node">
<title>ApplyFsmDelegate</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M558,-149.5C558,-149.5 821,-149.5 821,-149.5 827,-149.5 833,-155.5 833,-161.5 833,-161.5 833,-243.5 833,-243.5 833,-249.5 827,-255.5 821,-255.5 821,-255.5 558,-255.5 558,-255.5 552,-255.5 546,-249.5 546,-243.5 546,-243.5 546,-161.5 546,-161.5 546,-155.5 552,-149.5 558,-149.5"/>
<text text-anchor="middle" x="689.5" y="-240.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">ApplyFsmDelegate</text>
<polyline fill="none" stroke="#8a8898" points="546,-232.5 833,-232.5 "/>
<text text-anchor="start" x="554" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.将commited entries写入write batch</text>
<text text-anchor="start" x="554" y="-202.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.更新磁盘kv中的apply_state</text>
<text text-anchor="start" x="554" y="-187.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 3.更新内存中的apply_state</text>
<text text-anchor="start" x="554" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 4.将apply_state放入ApplyRes传递给RaftPoller</text>
<text text-anchor="start" x="554" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 在apply_raft_cmd</text>
</g>
<!-- ApplyFsmDelegate&#45;&gt;RaftApplyState -->
<g id="edge3" class="edge">
<title>ApplyFsmDelegate&#45;&gt;RaftApplyState</title>
<path fill="none" stroke="#666666" d="M833.32,-233.85C895.61,-242.98 969.27,-247.62 1035,-235.5 1043.62,-233.91 1052.37,-231.86 1061.12,-229.49"/>
<polygon fill="#666666" stroke="#666666" points="1062.32,-232.78 1070.97,-226.67 1060.4,-226.05 1062.32,-232.78"/>
</g>
<!-- ApplyFsmDelegate&#45;&gt;ApplyRes -->
<g id="edge6" class="edge">
<title>ApplyFsmDelegate&#45;&gt;ApplyRes</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M545.77,-220.37C460.11,-231.1 351.7,-244.68 266.99,-255.28"/>
<polygon fill="green" stroke="green" points="266.53,-251.81 257.05,-256.53 267.4,-258.76 266.53,-251.81"/>
</g>
<!-- kv_wb -->
<g id="node10" class="node">
<title>kv_wb</title>
<path fill="none" stroke="#1c2123" d="M881,-135C881,-135 1023,-135 1023,-135 1029,-135 1035,-141 1035,-147 1035,-147 1035,-214 1035,-214 1035,-220 1029,-226 1023,-226 1023,-226 881,-226 881,-226 875,-226 869,-220 869,-214 869,-214 869,-147 869,-147 869,-141 875,-135 881,-135"/>
<text text-anchor="middle" x="952" y="-210.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv_wb</text>
<polyline fill="none" stroke="#1c2123" points="869,-203 1035,-203 "/>
<text text-anchor="start" x="877" y="-187.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将数据写入kv write batch</text>
<text text-anchor="start" x="877" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在apply poller end时</text>
<text text-anchor="start" x="877" y="-157.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会将write batch写入</text>
<text text-anchor="start" x="877" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rocks engine</text>
</g>
<!-- ApplyFsmDelegate&#45;&gt;kv_wb -->
<g id="edge11" class="edge">
<title>ApplyFsmDelegate&#45;&gt;kv_wb</title>
<path fill="none" stroke="#666666" d="M833.33,-190.44C841.92,-189.71 850.44,-188.99 858.73,-188.29"/>
<polygon fill="#666666" stroke="#666666" points="859.06,-191.78 868.73,-187.45 858.47,-184.8 859.06,-191.78"/>
</g>
<!-- PeerStorage -->
<g id="node5" class="node">
<title>PeerStorage</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M660.5,-75.5C660.5,-75.5 718.5,-75.5 718.5,-75.5 724.5,-75.5 730.5,-81.5 730.5,-87.5 730.5,-87.5 730.5,-109.5 730.5,-109.5 730.5,-115.5 724.5,-121.5 718.5,-121.5 718.5,-121.5 660.5,-121.5 660.5,-121.5 654.5,-121.5 648.5,-115.5 648.5,-109.5 648.5,-109.5 648.5,-87.5 648.5,-87.5 648.5,-81.5 654.5,-75.5 660.5,-75.5"/>
<text text-anchor="middle" x="689.5" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerStorage</text>
<polyline fill="none" stroke="#8a8898" points="648.5,-98.5 730.5,-98.5 "/>
<text text-anchor="middle" x="689.5" y="-83.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> </text>
</g>
<!-- PeerStorage&#45;&gt;RaftApplyState -->
<g id="edge4" class="edge">
<title>PeerStorage&#45;&gt;RaftApplyState</title>
<path fill="none" stroke="#666666" d="M730.55,-85.97C795.89,-67.58 928.78,-38.82 1035,-71.5 1063.28,-80.2 1091.03,-96.04 1115.03,-112.82"/>
<polygon fill="#666666" stroke="#666666" points="1113.19,-115.81 1123.36,-118.78 1117.27,-110.12 1113.19,-115.81"/>
</g>
<!-- InvokeContext -->
<g id="node6" class="node">
<title>InvokeContext</title>
<path fill="none" stroke="#1c2123" d="M988.5,-116.5C988.5,-116.5 915.5,-116.5 915.5,-116.5 909.5,-116.5 903.5,-110.5 903.5,-104.5 903.5,-104.5 903.5,-92.5 903.5,-92.5 903.5,-86.5 909.5,-80.5 915.5,-80.5 915.5,-80.5 988.5,-80.5 988.5,-80.5 994.5,-80.5 1000.5,-86.5 1000.5,-92.5 1000.5,-92.5 1000.5,-104.5 1000.5,-104.5 1000.5,-110.5 994.5,-116.5 988.5,-116.5"/>
<text text-anchor="middle" x="952" y="-94.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
</g>
<!-- PeerStorage&#45;&gt;InvokeContext -->
<g id="edge7" class="edge">
<title>PeerStorage&#45;&gt;InvokeContext</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M730.63,-98.5C774.07,-98.5 843.73,-98.5 893.09,-98.5"/>
<polygon fill="green" stroke="green" points="893.3,-102 903.3,-98.5 893.3,-95 893.3,-102"/>
</g>
<!-- InvokeContext&#45;&gt;RaftApplyState -->
<g id="edge5" class="edge">
<title>InvokeContext&#45;&gt;RaftApplyState</title>
<path fill="none" stroke="#666666" d="M1000.7,-114.2C1011.95,-117.9 1023.9,-121.84 1035,-125.5 1043.57,-128.33 1052.41,-131.24 1061.31,-134.18"/>
<polygon fill="#666666" stroke="#666666" points="1060.4,-137.56 1070.99,-137.37 1062.59,-130.91 1060.4,-137.56"/>
</g>
<!-- ApplyPoller -->
<g id="node7" class="node">
<title>ApplyPoller</title>
<path fill="none" stroke="#1c2123" d="M320,-66C320,-66 483,-66 483,-66 489,-66 495,-72 495,-78 495,-78 495,-107 495,-107 495,-113 489,-119 483,-119 483,-119 320,-119 320,-119 314,-119 308,-113 308,-107 308,-107 308,-78 308,-78 308,-72 314,-66 320,-66"/>
<text text-anchor="start" x="316" y="-103.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyPoller</text>
<text text-anchor="start" x="316" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 处理完Apply task后</text>
<text text-anchor="start" x="316" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送ApplyRes回给RaftPoller</text>
</g>
<!-- ApplyPoller&#45;&gt;ApplyFsmDelegate -->
<g id="edge8" class="edge">
<title>ApplyPoller&#45;&gt;ApplyFsmDelegate</title>
<path fill="none" stroke="#666666" d="M483.72,-119.03C492.62,-122.13 501.52,-125.33 510,-128.5 524.3,-133.85 539.17,-139.64 553.94,-145.54"/>
<polygon fill="#666666" stroke="#666666" points="553.04,-148.95 563.62,-149.43 555.65,-142.46 553.04,-148.95"/>
</g>
<!-- RaftPoller&#45;&gt;PeerStorage -->
<g id="edge12" class="edge">
<title>RaftPoller&#45;&gt;PeerStorage</title>
<path fill="none" stroke="#666666" d="M510.22,-142.14C554.17,-131.38 602.87,-119.46 638.25,-110.8"/>
<polygon fill="#666666" stroke="#666666" points="639.44,-114.11 648.32,-108.33 637.78,-107.31 639.44,-114.11"/>
</g>
<!-- ApplyTask -->
<g id="node9" class="node">
<title>ApplyTask</title>
<path fill="none" stroke="#1c2123" d="M51.5,-0.5C51.5,-0.5 205.5,-0.5 205.5,-0.5 211.5,-0.5 217.5,-6.5 217.5,-12.5 217.5,-12.5 217.5,-172.5 217.5,-172.5 217.5,-178.5 211.5,-184.5 205.5,-184.5 205.5,-184.5 51.5,-184.5 51.5,-184.5 45.5,-184.5 39.5,-178.5 39.5,-172.5 39.5,-172.5 39.5,-12.5 39.5,-12.5 39.5,-6.5 45.5,-0.5 51.5,-0.5"/>
<text text-anchor="middle" x="128.5" y="-169.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Apply</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-161.5 217.5,-161.5 "/>
<text text-anchor="start" x="47.5" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub peer_id: u64,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-138.5 217.5,-138.5 "/>
<text text-anchor="start" x="47.5" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub region_id: u64,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-115.5 217.5,-115.5 "/>
<text text-anchor="start" x="47.5" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub term: u64,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-92.5 217.5,-92.5 "/>
<text text-anchor="start" x="47.5" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub entries: Vec&lt;Entry&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-69.5 217.5,-69.5 "/>
<text text-anchor="start" x="47.5" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub cbs: Vec&lt;Proposal&lt;S&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-46.5 217.5,-46.5 "/>
<text text-anchor="start" x="47.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">entries_mem_size: i64,</text>
<polyline fill="none" stroke="#1c2123" points="39.5,-23.5 217.5,-23.5 "/>
<text text-anchor="start" x="47.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">entries_count: i64,</text>
</g>
<!-- RaftPoller&#45;&gt;ApplyTask -->
<g id="edge9" class="edge">
<title>RaftPoller&#45;&gt;ApplyTask</title>
<path fill="none" stroke="#666666" d="M292.86,-138.31C271.29,-132.26 248.73,-125.94 227.51,-119.99"/>
<polygon fill="#666666" stroke="#666666" points="228.43,-116.61 217.86,-117.28 226.54,-123.35 228.43,-116.61"/>
</g>
<!-- ApplyTask&#45;&gt;ApplyPoller -->
<g id="edge10" class="edge">
<title>ApplyTask&#45;&gt;ApplyPoller</title>
<path fill="none" stroke="#666666" d="M217.86,-92.5C243.22,-92.5 271.1,-92.5 297.28,-92.5"/>
<polygon fill="#666666" stroke="#666666" points="297.6,-96 307.6,-92.5 297.6,-89 297.6,-96"/>
</g>
</g>
</svg>
