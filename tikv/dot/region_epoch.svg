<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: region_epoch Pages: 1 -->
<svg width="1149pt" height="895pt"
 viewBox="0.00 0.00 1149.00 895.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 891)">
<title>region_epoch</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-891 1145,-891 1145,4 -4,4"/>
<!-- PeerFsmDelegate__handle_msgs -->
<g id="node1" class="node">
<title>PeerFsmDelegate__handle_msgs</title>
<path fill="none" stroke="#1c2123" d="M12,-412C12,-412 101,-412 101,-412 107,-412 113,-418 113,-424 113,-424 113,-476 113,-476 113,-482 107,-488 101,-488 101,-488 12,-488 12,-488 6,-488 0,-482 0,-476 0,-476 0,-424 0,-424 0,-418 6,-412 12,-412"/>
<text text-anchor="start" x="8" y="-472.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="8" y="-457.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_msgs</text>
<polyline fill="none" stroke="#1c2123" points="0,-450 113,-450 "/>
<text text-anchor="start" x="8" y="-434.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理PeerFsm</text>
<text text-anchor="start" x="8" y="-419.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 收到的消息</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command -->
<g id="node2" class="node">
<title>PeerFsmDelegate__propose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M161,-291C161,-291 319,-291 319,-291 325,-291 331,-297 331,-303 331,-303 331,-355 331,-355 331,-361 325,-367 319,-367 319,-367 161,-367 161,-367 155,-367 149,-361 149,-355 149,-355 149,-303 149,-303 149,-297 155,-291 161,-291"/>
<text text-anchor="start" x="157" y="-351.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="157" y="-336.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="149,-329 331,-329 "/>
<text text-anchor="start" x="157" y="-313.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理上层应用通过raftrouter</text>
<text text-anchor="start" x="157" y="-298.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发来的RaftCmdRequest</text>
</g>
<!-- PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__propose_raft_command -->
<g id="edge1" class="edge">
<title>PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__propose_raft_command</title>
<path fill="none" stroke="#666666" d="M113.44,-412.71C132.48,-400.01 153.94,-385.7 173.66,-372.56"/>
<polygon fill="#666666" stroke="#666666" points="175.62,-375.46 182,-367 171.73,-369.64 175.62,-375.46"/>
</g>
<!-- PeerFsmDelegate__on_raft_message -->
<g id="node3" class="node">
<title>PeerFsmDelegate__on_raft_message</title>
<path fill="none" stroke="#1c2123" d="M171.5,-506C171.5,-506 308.5,-506 308.5,-506 314.5,-506 320.5,-512 320.5,-518 320.5,-518 320.5,-570 320.5,-570 320.5,-576 314.5,-582 308.5,-582 308.5,-582 171.5,-582 171.5,-582 165.5,-582 159.5,-576 159.5,-570 159.5,-570 159.5,-518 159.5,-518 159.5,-512 165.5,-506 171.5,-506"/>
<text text-anchor="start" x="167.5" y="-566.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="167.5" y="-551.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_raft_message</text>
<polyline fill="none" stroke="#1c2123" points="159.5,-544 320.5,-544 "/>
<text text-anchor="start" x="167.5" y="-528.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理raft group中</text>
<text text-anchor="start" x="167.5" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 其他peer发来的message</text>
</g>
<!-- PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_raft_message -->
<g id="edge2" class="edge">
<title>PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_raft_message</title>
<path fill="none" stroke="#666666" d="M113.44,-478.97C127.07,-486.03 141.93,-493.73 156.51,-501.28"/>
<polygon fill="#666666" stroke="#666666" points="155.04,-504.46 165.53,-505.95 158.26,-498.24 155.04,-504.46"/>
</g>
<!-- PeerFsmDelegate__pre_prose_raft_command -->
<g id="node4" class="node">
<title>PeerFsmDelegate__pre_prose_raft_command</title>
<path fill="none" stroke="#1c2123" d="M424.5,-392.5C424.5,-392.5 561.5,-392.5 561.5,-392.5 567.5,-392.5 573.5,-398.5 573.5,-404.5 573.5,-404.5 573.5,-441.5 573.5,-441.5 573.5,-447.5 567.5,-453.5 561.5,-453.5 561.5,-453.5 424.5,-453.5 424.5,-453.5 418.5,-453.5 412.5,-447.5 412.5,-441.5 412.5,-441.5 412.5,-404.5 412.5,-404.5 412.5,-398.5 418.5,-392.5 424.5,-392.5"/>
<text text-anchor="start" x="420.5" y="-438.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="420.5" y="-423.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pre_prose_raft_command</text>
<polyline fill="none" stroke="#1c2123" points="412.5,-415.5 573.5,-415.5 "/>
<text text-anchor="start" x="420.5" y="-400.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对raftcmd 做一些检查</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;PeerFsmDelegate__pre_prose_raft_command -->
<g id="edge3" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;PeerFsmDelegate__pre_prose_raft_command</title>
<path fill="none" stroke="#666666" d="M326.98,-367.13C340.29,-372.67 353.96,-378.13 367,-383 378.45,-387.28 390.6,-391.52 402.64,-395.55"/>
<polygon fill="#666666" stroke="#666666" points="401.67,-398.91 412.26,-398.73 403.87,-392.27 401.67,-398.91"/>
</g>
<!-- Callback__invoke_with_response_Err -->
<g id="node5" class="node">
<title>Callback__invoke_with_response_Err</title>
<path fill="none" stroke="#1c2123" d="M593,-374C593,-374 393,-374 393,-374 387,-374 381,-368 381,-362 381,-362 381,-350 381,-350 381,-344 387,-338 393,-338 393,-338 593,-338 593,-338 599,-338 605,-344 605,-350 605,-350 605,-362 605,-362 605,-368 599,-374 593,-374"/>
<text text-anchor="middle" x="493" y="-352.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Callback__invoke_with_response_Err</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;Callback__invoke_with_response_Err -->
<g id="edge4" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;Callback__invoke_with_response_Err</title>
<path fill="none" stroke="#666666" d="M331.26,-338.71C344.03,-340.08 357.33,-341.51 370.56,-342.94"/>
<polygon fill="#666666" stroke="#666666" points="370.35,-346.43 380.66,-344.02 371.1,-339.47 370.35,-346.43"/>
</g>
<!-- bind_term -->
<g id="node6" class="node">
<title>bind_term</title>
<path fill="none" stroke="#1c2123" d="M517.5,-320C517.5,-320 468.5,-320 468.5,-320 462.5,-320 456.5,-314 456.5,-308 456.5,-308 456.5,-296 456.5,-296 456.5,-290 462.5,-284 468.5,-284 468.5,-284 517.5,-284 517.5,-284 523.5,-284 529.5,-290 529.5,-296 529.5,-296 529.5,-308 529.5,-308 529.5,-314 523.5,-320 517.5,-320"/>
<text text-anchor="middle" x="493" y="-298.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">bind_term</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;bind_term -->
<g id="edge5" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;bind_term</title>
<path fill="none" stroke="#666666" d="M331.26,-319.29C370.32,-315.09 414.34,-310.35 446.42,-306.9"/>
<polygon fill="#666666" stroke="#666666" points="446.83,-310.38 456.4,-305.83 446.08,-303.42 446.83,-310.38"/>
</g>
<!-- Peer__propose -->
<g id="node7" class="node">
<title>Peer__propose</title>
<path fill="none" stroke="#1c2123" d="M419.5,-189C419.5,-189 566.5,-189 566.5,-189 572.5,-189 578.5,-195 578.5,-201 578.5,-201 578.5,-253 578.5,-253 578.5,-259 572.5,-265 566.5,-265 566.5,-265 419.5,-265 419.5,-265 413.5,-265 407.5,-259 407.5,-253 407.5,-253 407.5,-201 407.5,-201 407.5,-195 413.5,-189 419.5,-189"/>
<text text-anchor="start" x="415.5" y="-249.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="415.5" y="-234.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose</text>
<polyline fill="none" stroke="#1c2123" points="407.5,-227 578.5,-227 "/>
<text text-anchor="start" x="415.5" y="-211.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将RaftCmdRequest propose</text>
<text text-anchor="start" x="415.5" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 到raft group</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;Peer__propose -->
<g id="edge6" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;Peer__propose</title>
<path fill="none" stroke="#666666" d="M328.6,-290.95C341.44,-285.52 354.54,-280.06 367,-275 376.98,-270.95 387.44,-266.79 397.87,-262.7"/>
<polygon fill="#666666" stroke="#666666" points="399.4,-265.86 407.44,-258.97 396.85,-259.34 399.4,-265.86"/>
</g>
<!-- PeerFsmDelegate__check_merge_proposal -->
<g id="node8" class="node">
<title>PeerFsmDelegate__check_merge_proposal</title>
<path fill="none" stroke="#1c2123" d="M607,-170C607,-170 379,-170 379,-170 373,-170 367,-164 367,-158 367,-158 367,-146 367,-146 367,-140 373,-134 379,-134 379,-134 607,-134 607,-134 613,-134 619,-140 619,-146 619,-146 619,-158 619,-158 619,-164 613,-170 607,-170"/>
<text text-anchor="middle" x="493" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate__check_merge_proposal</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;PeerFsmDelegate__check_merge_proposal -->
<g id="edge7" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;PeerFsmDelegate__check_merge_proposal</title>
<path fill="none" stroke="#666666" d="M262.86,-290.75C284.71,-256.1 321.56,-206.39 367,-179 369.8,-177.31 372.7,-175.72 375.67,-174.24"/>
<polygon fill="#666666" stroke="#666666" points="377.14,-177.41 384.77,-170.07 374.22,-171.05 377.14,-177.41"/>
</g>
<!-- Peer__pending_remove -->
<g id="node9" class="node">
<title>Peer__pending_remove</title>
<path fill="none" stroke="#1c2123" d="M554,-116C554,-116 432,-116 432,-116 426,-116 420,-110 420,-104 420,-104 420,-92 420,-92 420,-86 426,-80 432,-80 432,-80 554,-80 554,-80 560,-80 566,-86 566,-92 566,-92 566,-104 566,-104 566,-110 560,-116 554,-116"/>
<text text-anchor="middle" x="493" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__pending_remove</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;Peer__pending_remove -->
<g id="edge8" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;Peer__pending_remove</title>
<path fill="none" stroke="#666666" d="M253.91,-290.87C271.75,-244.2 308.52,-166.32 367,-125 379.64,-116.07 394.67,-110 409.85,-105.89"/>
<polygon fill="#666666" stroke="#666666" points="410.93,-109.23 419.82,-103.47 409.28,-102.43 410.93,-109.23"/>
</g>
<!-- notify_req_region_removed -->
<g id="node10" class="node">
<title>notify_req_region_removed</title>
<path fill="none" stroke="#1c2123" d="M565.5,-508C565.5,-508 420.5,-508 420.5,-508 414.5,-508 408.5,-502 408.5,-496 408.5,-496 408.5,-484 408.5,-484 408.5,-478 414.5,-472 420.5,-472 420.5,-472 565.5,-472 565.5,-472 571.5,-472 577.5,-478 577.5,-484 577.5,-484 577.5,-496 577.5,-496 577.5,-502 571.5,-508 565.5,-508"/>
<text text-anchor="middle" x="493" y="-486.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify_req_region_removed</text>
</g>
<!-- PeerFsmDelegate__propose_raft_command&#45;&gt;notify_req_region_removed -->
<g id="edge9" class="edge">
<title>PeerFsmDelegate__propose_raft_command&#45;&gt;notify_req_region_removed</title>
<path fill="none" stroke="#666666" d="M266.7,-367.08C289.45,-397.76 325.44,-439.51 367,-463 376.79,-468.53 387.6,-472.94 398.65,-476.44"/>
<polygon fill="#666666" stroke="#666666" points="397.81,-479.84 408.39,-479.29 399.78,-473.12 397.81,-479.84"/>
</g>
<!-- PeerFsmDelegate__check_msg -->
<g id="node16" class="node">
<title>PeerFsmDelegate__check_msg</title>
<path fill="none" stroke="#1c2123" d="M444,-581C444,-581 542,-581 542,-581 548,-581 554,-587 554,-593 554,-593 554,-645 554,-645 554,-651 548,-657 542,-657 542,-657 444,-657 444,-657 438,-657 432,-651 432,-645 432,-645 432,-593 432,-593 432,-587 438,-581 444,-581"/>
<text text-anchor="start" x="440" y="-641.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="440" y="-626.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_msg</text>
<polyline fill="none" stroke="#1c2123" points="432,-619 554,-619 "/>
<text text-anchor="start" x="440" y="-603.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查消息的region</text>
<text text-anchor="start" x="440" y="-588.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> epoch</text>
</g>
<!-- PeerFsmDelegate__on_raft_message&#45;&gt;PeerFsmDelegate__check_msg -->
<g id="edge15" class="edge">
<title>PeerFsmDelegate__on_raft_message&#45;&gt;PeerFsmDelegate__check_msg</title>
<path fill="none" stroke="#666666" d="M320.76,-567.83C353.42,-577.59 390.85,-588.78 422.38,-598.2"/>
<polygon fill="#666666" stroke="#666666" points="421.38,-601.55 431.96,-601.06 423.38,-594.84 421.38,-601.55"/>
</g>
<!-- Peer__step -->
<g id="node17" class="node">
<title>Peer__step</title>
<path fill="none" stroke="#1c2123" d="M519,-562C519,-562 467,-562 467,-562 461,-562 455,-556 455,-550 455,-550 455,-538 455,-538 455,-532 461,-526 467,-526 467,-526 519,-526 519,-526 525,-526 531,-532 531,-538 531,-538 531,-550 531,-550 531,-556 525,-562 519,-562"/>
<text text-anchor="middle" x="493" y="-540.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer__step</text>
</g>
<!-- PeerFsmDelegate__on_raft_message&#45;&gt;Peer__step -->
<g id="edge16" class="edge">
<title>PeerFsmDelegate__on_raft_message&#45;&gt;Peer__step</title>
<path fill="none" stroke="#666666" d="M320.76,-544C361.48,-544 409.64,-544 444.5,-544"/>
<polygon fill="#666666" stroke="#666666" points="444.87,-547.5 454.87,-544 444.87,-540.5 444.87,-547.5"/>
</g>
<!-- Error__RegionNotIntialized -->
<g id="node11" class="node">
<title>Error__RegionNotIntialized</title>
<path fill="none" stroke="#1c2123" d="M812,-441C812,-441 667,-441 667,-441 661,-441 655,-435 655,-429 655,-429 655,-417 655,-417 655,-411 661,-405 667,-405 667,-405 812,-405 812,-405 818,-405 824,-411 824,-417 824,-417 824,-429 824,-429 824,-435 818,-441 812,-441"/>
<text text-anchor="middle" x="739.5" y="-419.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Error__RegionNotIntialized</text>
</g>
<!-- PeerFsmDelegate__pre_prose_raft_command&#45;&gt;Error__RegionNotIntialized -->
<g id="edge10" class="edge">
<title>PeerFsmDelegate__pre_prose_raft_command&#45;&gt;Error__RegionNotIntialized</title>
<path fill="none" stroke="#666666" d="M573.72,-423C596.3,-423 621.09,-423 644.43,-423"/>
<polygon fill="#666666" stroke="#666666" points="644.68,-426.5 654.68,-423 644.68,-419.5 644.68,-426.5"/>
</g>
<!-- Error__Other -->
<g id="node12" class="node">
<title>Error__Other</title>
<path fill="none" stroke="#1c2123" d="M772,-387C772,-387 707,-387 707,-387 701,-387 695,-381 695,-375 695,-375 695,-363 695,-363 695,-357 701,-351 707,-351 707,-351 772,-351 772,-351 778,-351 784,-357 784,-363 784,-363 784,-375 784,-375 784,-381 778,-387 772,-387"/>
<text text-anchor="middle" x="739.5" y="-365.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Error__Other</text>
</g>
<!-- PeerFsmDelegate__pre_prose_raft_command&#45;&gt;Error__Other -->
<g id="edge11" class="edge">
<title>PeerFsmDelegate__pre_prose_raft_command&#45;&gt;Error__Other</title>
<path fill="none" stroke="#666666" d="M573.72,-405.39C610.22,-397.33 652.49,-388 685.09,-380.8"/>
<polygon fill="#666666" stroke="#666666" points="685.86,-384.21 694.87,-378.64 684.35,-377.37 685.86,-384.21"/>
</g>
<!-- check_term -->
<g id="node13" class="node">
<title>check_term</title>
<path fill="none" stroke="#1c2123" d="M767.5,-495C767.5,-495 711.5,-495 711.5,-495 705.5,-495 699.5,-489 699.5,-483 699.5,-483 699.5,-471 699.5,-471 699.5,-465 705.5,-459 711.5,-459 711.5,-459 767.5,-459 767.5,-459 773.5,-459 779.5,-465 779.5,-471 779.5,-471 779.5,-483 779.5,-483 779.5,-489 773.5,-495 767.5,-495"/>
<text text-anchor="middle" x="739.5" y="-473.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_term</text>
</g>
<!-- PeerFsmDelegate__pre_prose_raft_command&#45;&gt;check_term -->
<g id="edge12" class="edge">
<title>PeerFsmDelegate__pre_prose_raft_command&#45;&gt;check_term</title>
<path fill="none" stroke="#666666" d="M573.72,-440.61C611.86,-449.03 656.31,-458.85 689.42,-466.16"/>
<polygon fill="#666666" stroke="#666666" points="688.8,-469.61 699.32,-468.35 690.31,-462.77 688.8,-469.61"/>
</g>
<!-- check_region_epoch -->
<g id="node14" class="node">
<title>check_region_epoch</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M687.5,-136.5C687.5,-136.5 791.5,-136.5 791.5,-136.5 797.5,-136.5 803.5,-142.5 803.5,-148.5 803.5,-148.5 803.5,-185.5 803.5,-185.5 803.5,-191.5 797.5,-197.5 791.5,-197.5 791.5,-197.5 687.5,-197.5 687.5,-197.5 681.5,-197.5 675.5,-191.5 675.5,-185.5 675.5,-185.5 675.5,-148.5 675.5,-148.5 675.5,-142.5 681.5,-136.5 687.5,-136.5"/>
<text text-anchor="middle" x="739.5" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_region_epoch</text>
<polyline fill="none" stroke="#8a8898" points="675.5,-174.5 803.5,-174.5 "/>
<text text-anchor="start" x="683.5" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">检查region epoch</text>
<text text-anchor="start" x="683.5" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 是否match</text>
</g>
<!-- PeerFsmDelegate__pre_prose_raft_command&#45;&gt;check_region_epoch -->
<g id="edge13" class="edge">
<title>PeerFsmDelegate__pre_prose_raft_command&#45;&gt;check_region_epoch</title>
<path fill="none" stroke="#666666" d="M573.62,-407.44C589.81,-401.66 605.88,-393.77 619,-383 648.74,-358.57 695.57,-262.1 720.87,-206.7"/>
<polygon fill="#666666" stroke="#666666" points="724.09,-208.07 725.04,-197.52 717.72,-205.17 724.09,-208.07"/>
</g>
<!-- Error__EpochNotMatch -->
<g id="node15" class="node">
<title>Error__EpochNotMatch</title>
<path fill="none" stroke="#1c2123" d="M872,-136.5C872,-136.5 991,-136.5 991,-136.5 997,-136.5 1003,-142.5 1003,-148.5 1003,-148.5 1003,-185.5 1003,-185.5 1003,-191.5 997,-197.5 991,-197.5 991,-197.5 872,-197.5 872,-197.5 866,-197.5 860,-191.5 860,-185.5 860,-185.5 860,-148.5 860,-148.5 860,-142.5 866,-136.5 872,-136.5"/>
<text text-anchor="middle" x="931.5" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Error::EpochNotMatch</text>
<polyline fill="none" stroke="#1c2123" points="860,-174.5 1003,-174.5 "/>
<text text-anchor="start" x="868" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果不match</text>
<text text-anchor="start" x="868" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 返回错误</text>
</g>
<!-- check_region_epoch&#45;&gt;Error__EpochNotMatch -->
<g id="edge14" class="edge">
<title>check_region_epoch&#45;&gt;Error__EpochNotMatch</title>
<path fill="none" stroke="#666666" d="M803.5,-167C818.3,-167 834.27,-167 849.73,-167"/>
<polygon fill="#666666" stroke="#666666" points="849.79,-170.5 859.79,-167 849.79,-163.5 849.79,-170.5"/>
</g>
<!-- is_epoch_stale -->
<g id="node18" class="node">
<title>is_epoch_stale</title>
<path fill="none" stroke="#1c2123" d="M674.5,-671C674.5,-671 804.5,-671 804.5,-671 810.5,-671 816.5,-677 816.5,-683 816.5,-683 816.5,-735 816.5,-735 816.5,-741 810.5,-747 804.5,-747 804.5,-747 674.5,-747 674.5,-747 668.5,-747 662.5,-741 662.5,-735 662.5,-735 662.5,-683 662.5,-683 662.5,-677 668.5,-671 674.5,-671"/>
<text text-anchor="middle" x="739.5" y="-731.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_epoch_stale</text>
<polyline fill="none" stroke="#1c2123" points="662.5,-724 816.5,-724 "/>
<text text-anchor="start" x="670.5" y="-708.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果version 或者</text>
<text text-anchor="start" x="670.5" y="-693.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> conf_ver有一个小的话</text>
<text text-anchor="start" x="670.5" y="-678.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就算是stale msg</text>
</g>
<!-- PeerFsmDelegate__check_msg&#45;&gt;is_epoch_stale -->
<g id="edge17" class="edge">
<title>PeerFsmDelegate__check_msg&#45;&gt;is_epoch_stale</title>
<path fill="none" stroke="#666666" d="M554.12,-641.13C583.85,-652.07 620.26,-665.47 652.84,-677.47"/>
<polygon fill="#666666" stroke="#666666" points="651.77,-680.81 662.37,-680.98 654.19,-674.24 651.77,-680.81"/>
</g>
<!-- PollContext__handle_stale_msg -->
<g id="node19" class="node">
<title>PollContext__handle_stale_msg</title>
<path fill="none" stroke="#1c2123" d="M876.5,-589C876.5,-589 986.5,-589 986.5,-589 992.5,-589 998.5,-595 998.5,-601 998.5,-601 998.5,-683 998.5,-683 998.5,-689 992.5,-695 986.5,-695 986.5,-695 876.5,-695 876.5,-695 870.5,-695 864.5,-689 864.5,-683 864.5,-683 864.5,-601 864.5,-601 864.5,-595 870.5,-589 876.5,-589"/>
<text text-anchor="start" x="872.5" y="-679.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PollContext</text>
<text text-anchor="start" x="872.5" y="-664.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_stale_msg</text>
<polyline fill="none" stroke="#1c2123" points="864.5,-657 998.5,-657 "/>
<text text-anchor="start" x="872.5" y="-641.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">一般是ignore it</text>
<text text-anchor="start" x="872.5" y="-626.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果是neet_gc</text>
<text text-anchor="start" x="872.5" y="-611.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会发送个消息回去</text>
<text text-anchor="middle" x="931.5" y="-596.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 带上当前的epoch</text>
</g>
<!-- PeerFsmDelegate__check_msg&#45;&gt;PollContext__handle_stale_msg -->
<g id="edge18" class="edge">
<title>PeerFsmDelegate__check_msg&#45;&gt;PollContext__handle_stale_msg</title>
<path fill="none" stroke="#666666" d="M554.24,-622.17C632.44,-626.29 769,-633.49 854.32,-637.99"/>
<polygon fill="#666666" stroke="#666666" points="854.3,-641.49 864.47,-638.52 854.67,-634.5 854.3,-641.49"/>
</g>
<!-- need_gc_msg -->
<g id="node20" class="node">
<title>need_gc_msg</title>
<path fill="none" stroke="#1c2123" d="M965.5,-570C965.5,-570 897.5,-570 897.5,-570 891.5,-570 885.5,-564 885.5,-558 885.5,-558 885.5,-546 885.5,-546 885.5,-540 891.5,-534 897.5,-534 897.5,-534 965.5,-534 965.5,-534 971.5,-534 977.5,-540 977.5,-546 977.5,-546 977.5,-558 977.5,-558 977.5,-564 971.5,-570 965.5,-570"/>
<text text-anchor="middle" x="931.5" y="-548.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">need_gc_msg</text>
</g>
<!-- PeerFsmDelegate__check_msg&#45;&gt;need_gc_msg -->
<g id="edge19" class="edge">
<title>PeerFsmDelegate__check_msg&#45;&gt;need_gc_msg</title>
<path fill="none" stroke="#666666" d="M554.12,-615.99C620.66,-611.89 730.81,-602.77 824,-584 840.93,-580.59 859.03,-575.66 875.41,-570.68"/>
<polygon fill="#666666" stroke="#666666" points="876.85,-573.9 885.37,-567.59 874.78,-567.21 876.85,-573.9"/>
</g>
<!-- is_vote_msg -->
<g id="node21" class="node">
<title>is_vote_msg</title>
<path fill="none" stroke="#1c2123" d="M688,-529C688,-529 791,-529 791,-529 797,-529 803,-535 803,-541 803,-541 803,-563 803,-563 803,-569 797,-575 791,-575 791,-575 688,-575 688,-575 682,-575 676,-569 676,-563 676,-563 676,-541 676,-541 676,-535 682,-529 688,-529"/>
<text text-anchor="middle" x="739.5" y="-559.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_vote_msg</text>
<polyline fill="none" stroke="#1c2123" points="676,-552 803,-552 "/>
<text text-anchor="start" x="684" y="-536.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是投票request</text>
</g>
<!-- PeerFsmDelegate__check_msg&#45;&gt;is_vote_msg -->
<g id="edge20" class="edge">
<title>PeerFsmDelegate__check_msg&#45;&gt;is_vote_msg</title>
<path fill="none" stroke="#666666" d="M554.12,-602.52C587.86,-593.28 630.18,-581.68 665.77,-571.93"/>
<polygon fill="#666666" stroke="#666666" points="666.9,-575.25 675.62,-569.23 665.05,-568.5 666.9,-575.25"/>
</g>
<!-- PollContext__trans__send -->
<g id="node22" class="node">
<title>PollContext__trans__send</title>
<path fill="none" stroke="#1c2123" d="M1051,-514C1051,-514 1129,-514 1129,-514 1135,-514 1141,-520 1141,-526 1141,-526 1141,-578 1141,-578 1141,-584 1135,-590 1129,-590 1129,-590 1051,-590 1051,-590 1045,-590 1039,-584 1039,-578 1039,-578 1039,-526 1039,-526 1039,-520 1045,-514 1051,-514"/>
<text text-anchor="start" x="1047" y="-574.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PollContext</text>
<text text-anchor="start" x="1047" y="-559.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> trans</text>
<text text-anchor="start" x="1047" y="-544.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send</text>
<polyline fill="none" stroke="#1c2123" points="1039,-537 1141,-537 "/>
<text text-anchor="start" x="1047" y="-521.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送消息回去</text>
</g>
<!-- PollContext__handle_stale_msg&#45;&gt;PollContext__trans__send -->
<g id="edge22" class="edge">
<title>PollContext__handle_stale_msg&#45;&gt;PollContext__trans__send</title>
<path fill="none" stroke="#666666" d="M998.87,-603.83C1009.18,-597.9 1019.77,-591.81 1029.91,-585.98"/>
<polygon fill="#666666" stroke="#666666" points="1031.75,-588.96 1038.67,-580.94 1028.26,-582.89 1031.75,-588.96"/>
</g>
<!-- need_gc_msg&#45;&gt;PollContext__trans__send -->
<g id="edge21" class="edge">
<title>need_gc_msg&#45;&gt;PollContext__trans__send</title>
<path fill="none" stroke="#666666" d="M977.77,-545.81C993.62,-545.24 1011.67,-545.1 1028.56,-545.41"/>
<polygon fill="#666666" stroke="#666666" points="1028.82,-548.91 1038.9,-545.65 1028.98,-541.92 1028.82,-548.91"/>
</g>
<!-- need_gc_msg&#45;&gt;PollContext__trans__send -->
<g id="edge29" class="edge">
<title>need_gc_msg&#45;&gt;PollContext__trans__send</title>
<path fill="none" stroke="#666666" d="M977.77,-558.19C993.62,-558.76 1011.67,-558.9 1028.56,-558.59"/>
<polygon fill="#666666" stroke="#666666" points="1028.98,-562.08 1038.9,-558.35 1028.82,-555.09 1028.98,-562.08"/>
</g>
<!-- is_vote_msg&#45;&gt;need_gc_msg -->
<g id="edge28" class="edge">
<title>is_vote_msg&#45;&gt;need_gc_msg</title>
<path fill="none" stroke="#666666" d="M803.24,-552C826.49,-552 852.66,-552 875.19,-552"/>
<polygon fill="#666666" stroke="#666666" points="875.27,-555.5 885.27,-552 875.27,-548.5 875.27,-555.5"/>
</g>
<!-- Peer__send_raft_message -->
<g id="node23" class="node">
<title>Peer__send_raft_message</title>
<path fill="none" stroke="#1c2123" d="M165.5,-787.5C165.5,-787.5 314.5,-787.5 314.5,-787.5 320.5,-787.5 326.5,-793.5 326.5,-799.5 326.5,-799.5 326.5,-874.5 326.5,-874.5 326.5,-880.5 320.5,-886.5 314.5,-886.5 314.5,-886.5 165.5,-886.5 165.5,-886.5 159.5,-886.5 153.5,-880.5 153.5,-874.5 153.5,-874.5 153.5,-799.5 153.5,-799.5 153.5,-793.5 159.5,-787.5 165.5,-787.5"/>
<text text-anchor="start" x="161.5" y="-871.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="161.5" y="-856.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> send_raft_message</text>
<polyline fill="none" stroke="#1c2123" points="153.5,-848.5 326.5,-848.5 "/>
<text text-anchor="start" x="161.5" y="-833.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送ready中要发</text>
<text text-anchor="start" x="161.5" y="-818.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 送的raft message</text>
<polyline fill="none" stroke="#1c2123" points="153.5,-810.5 326.5,-810.5 "/>
<text text-anchor="start" x="161.5" y="-795.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">会将region epoch信息带上</text>
</g>
<!-- Peer__prepare_raft_message -->
<g id="node24" class="node">
<title>Peer__prepare_raft_message</title>
<path fill="none" stroke="#1c2123" d="M435,-799C435,-799 551,-799 551,-799 557,-799 563,-805 563,-811 563,-811 563,-863 563,-863 563,-869 557,-875 551,-875 551,-875 435,-875 435,-875 429,-875 423,-869 423,-863 423,-863 423,-811 423,-811 423,-805 429,-799 435,-799"/>
<text text-anchor="start" x="431" y="-859.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="431" y="-844.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> prepare_raft_message</text>
<polyline fill="none" stroke="#1c2123" points="423,-837 563,-837 "/>
<text text-anchor="start" x="431" y="-821.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置raft message的</text>
<text text-anchor="start" x="431" y="-806.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region epoch</text>
</g>
<!-- Peer__send_raft_message&#45;&gt;Peer__prepare_raft_message -->
<g id="edge23" class="edge">
<title>Peer__send_raft_message&#45;&gt;Peer__prepare_raft_message</title>
<path fill="none" stroke="#666666" d="M326.68,-837C354.51,-837 385.25,-837 412.61,-837"/>
<polygon fill="#666666" stroke="#666666" points="412.91,-840.5 422.91,-837 412.91,-833.5 412.91,-840.5"/>
</g>
<!-- set_region_epoch -->
<g id="node25" class="node">
<title>set_region_epoch</title>
<path fill="none" stroke="#1c2123" d="M887.5,-806.5C887.5,-806.5 975.5,-806.5 975.5,-806.5 981.5,-806.5 987.5,-812.5 987.5,-818.5 987.5,-818.5 987.5,-855.5 987.5,-855.5 987.5,-861.5 981.5,-867.5 975.5,-867.5 975.5,-867.5 887.5,-867.5 887.5,-867.5 881.5,-867.5 875.5,-861.5 875.5,-855.5 875.5,-855.5 875.5,-818.5 875.5,-818.5 875.5,-812.5 881.5,-806.5 887.5,-806.5"/>
<text text-anchor="middle" x="931.5" y="-852.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_region_epoch</text>
<polyline fill="none" stroke="#1c2123" points="875.5,-844.5 987.5,-844.5 "/>
<text text-anchor="start" x="883.5" y="-829.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置message的</text>
<text text-anchor="start" x="883.5" y="-814.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region epoch</text>
</g>
<!-- Peer__prepare_raft_message&#45;&gt;set_region_epoch -->
<g id="edge24" class="edge">
<title>Peer__prepare_raft_message&#45;&gt;set_region_epoch</title>
<path fill="none" stroke="#666666" d="M563.26,-844.35C591.65,-847.01 624.87,-849.69 655,-851 730.04,-854.26 749.05,-855.91 824,-851 837.35,-850.13 851.57,-848.64 865.14,-846.96"/>
<polygon fill="#666666" stroke="#666666" points="865.89,-850.39 875.36,-845.64 864.99,-843.45 865.89,-850.39"/>
</g>
<!-- Peer__region__get_region_epoch -->
<g id="node26" class="node">
<title>Peer__region__get_region_epoch</title>
<path fill="none" stroke="#1c2123" d="M693,-766C693,-766 786,-766 786,-766 792,-766 798,-772 798,-778 798,-778 798,-830 798,-830 798,-836 792,-842 786,-842 786,-842 693,-842 693,-842 687,-842 681,-836 681,-830 681,-830 681,-778 681,-778 681,-772 687,-766 693,-766"/>
<text text-anchor="start" x="689" y="-826.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="689" y="-811.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region</text>
<text text-anchor="start" x="689" y="-796.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_region_epoch</text>
<polyline fill="none" stroke="#1c2123" points="681,-789 798,-789 "/>
<text text-anchor="start" x="689" y="-773.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取region epoch</text>
</g>
<!-- Peer__prepare_raft_message&#45;&gt;Peer__region__get_region_epoch -->
<g id="edge25" class="edge">
<title>Peer__prepare_raft_message&#45;&gt;Peer__region__get_region_epoch</title>
<path fill="none" stroke="#666666" d="M563.08,-827.68C596.74,-823.13 637.08,-817.69 670.58,-813.17"/>
<polygon fill="#666666" stroke="#666666" points="671.3,-816.6 680.74,-811.8 670.36,-809.66 671.3,-816.6"/>
</g>
<!-- Peer__region__get_region_epoch&#45;&gt;set_region_epoch -->
<g id="edge27" class="edge">
<title>Peer__region__get_region_epoch&#45;&gt;set_region_epoch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M798.02,-813.99C819.33,-817.69 843.64,-821.91 865.57,-825.72"/>
<polygon fill="green" stroke="green" points="865,-829.18 875.45,-827.44 866.2,-822.28 865,-829.18"/>
</g>
<!-- PeerFsmDelegate__collect_ready -->
<g id="node27" class="node">
<title>PeerFsmDelegate__collect_ready</title>
<path fill="none" stroke="#1c2123" d="M12,-806.5C12,-806.5 101,-806.5 101,-806.5 107,-806.5 113,-812.5 113,-818.5 113,-818.5 113,-855.5 113,-855.5 113,-861.5 107,-867.5 101,-867.5 101,-867.5 12,-867.5 12,-867.5 6,-867.5 0,-861.5 0,-855.5 0,-855.5 0,-818.5 0,-818.5 0,-812.5 6,-806.5 12,-806.5"/>
<text text-anchor="start" x="8" y="-852.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="8" y="-837.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> collect_ready</text>
<polyline fill="none" stroke="#1c2123" points="0,-829.5 113,-829.5 "/>
<text text-anchor="start" x="8" y="-814.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">收集raft ready</text>
</g>
<!-- PeerFsmDelegate__collect_ready&#45;&gt;Peer__send_raft_message -->
<g id="edge26" class="edge">
<title>PeerFsmDelegate__collect_ready&#45;&gt;Peer__send_raft_message</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M113.44,-837C122.89,-837 132.94,-837 143.07,-837"/>
<polygon fill="green" stroke="green" points="143.21,-840.5 153.21,-837 143.21,-833.5 143.21,-840.5"/>
</g>
<!-- ApplyDelegate__exec_raft_cmd -->
<g id="node28" class="node">
<title>ApplyDelegate__exec_raft_cmd</title>
<path fill="none" stroke="#1c2123" d="M454.5,-0.5C454.5,-0.5 531.5,-0.5 531.5,-0.5 537.5,-0.5 543.5,-6.5 543.5,-12.5 543.5,-12.5 543.5,-49.5 543.5,-49.5 543.5,-55.5 537.5,-61.5 531.5,-61.5 531.5,-61.5 454.5,-61.5 454.5,-61.5 448.5,-61.5 442.5,-55.5 442.5,-49.5 442.5,-49.5 442.5,-12.5 442.5,-12.5 442.5,-6.5 448.5,-0.5 454.5,-0.5"/>
<text text-anchor="start" x="450.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="450.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> exec_raft_cmd</text>
<polyline fill="none" stroke="#1c2123" points="442.5,-23.5 543.5,-23.5 "/>
<text text-anchor="start" x="450.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">执行raft cmd</text>
</g>
<!-- ApplyDelegate__exec_raft_cmd&#45;&gt;check_region_epoch -->
<g id="edge30" class="edge">
<title>ApplyDelegate__exec_raft_cmd&#45;&gt;check_region_epoch</title>
<path fill="none" stroke="#666666" d="M543.77,-42.41C567.39,-48.94 595.52,-58.38 619,-71 648.15,-86.67 677.17,-109.76 699.31,-129.37"/>
<polygon fill="#666666" stroke="#666666" points="697.07,-132.06 706.85,-136.15 701.75,-126.86 697.07,-132.06"/>
</g>
<!-- ApplyFsm__handle_apply -->
<g id="node29" class="node">
<title>ApplyFsm__handle_apply</title>
<path fill="none" stroke="#1c2123" d="M171.5,-0.5C171.5,-0.5 308.5,-0.5 308.5,-0.5 314.5,-0.5 320.5,-6.5 320.5,-12.5 320.5,-12.5 320.5,-49.5 320.5,-49.5 320.5,-55.5 314.5,-61.5 308.5,-61.5 308.5,-61.5 171.5,-61.5 171.5,-61.5 165.5,-61.5 159.5,-55.5 159.5,-49.5 159.5,-49.5 159.5,-12.5 159.5,-12.5 159.5,-6.5 165.5,-0.5 171.5,-0.5"/>
<text text-anchor="middle" x="240" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyFsm__handle_apply</text>
<polyline fill="none" stroke="#1c2123" points="159.5,-38.5 320.5,-38.5 "/>
<text text-anchor="start" x="167.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理peerFsm发来的</text>
<text text-anchor="start" x="167.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> committed log entry</text>
</g>
<!-- ApplyFsm__handle_apply&#45;&gt;ApplyDelegate__exec_raft_cmd -->
<g id="edge31" class="edge">
<title>ApplyFsm__handle_apply&#45;&gt;ApplyDelegate__exec_raft_cmd</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M320.76,-31C356.93,-31 398.96,-31 432.34,-31"/>
<polygon fill="green" stroke="green" points="432.4,-34.5 442.4,-31 432.4,-27.5 432.4,-34.5"/>
</g>
</g>
</svg>
