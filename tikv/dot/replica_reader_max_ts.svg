<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: replica_reader_max_ts Pages: 1 -->
<svg width="1318pt" height="280pt"
 viewBox="0.00 0.00 1318.00 279.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 275.5)">
<title>replica_reader_max_ts</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-275.5 1314,-275.5 1314,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ReplicaReadLockChecker</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M432,-8C432,-8 1083,-8 1083,-8 1089,-8 1095,-14 1095,-20 1095,-20 1095,-174 1095,-174 1095,-180 1089,-186 1083,-186 1083,-186 432,-186 432,-186 426,-186 420,-180 420,-174 420,-174 420,-20 420,-20 420,-14 426,-8 432,-8"/>
<text text-anchor="middle" x="757.5" y="-166" font-family="Times,serif" font-size="20.00">ReplicaReadLockChecker</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_ConcurrencyManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M1127,-68C1127,-68 1294,-68 1294,-68 1300,-68 1306,-74 1306,-80 1306,-80 1306,-204 1306,-204 1306,-210 1300,-216 1294,-216 1294,-216 1127,-216 1127,-216 1121,-216 1115,-210 1115,-204 1115,-204 1115,-80 1115,-80 1115,-74 1121,-68 1127,-68"/>
<text text-anchor="middle" x="1210.5" y="-196" font-family="Times,serif" font-size="20.00">ConcurrencyManager</text>
</g>
<!-- read_index -->
<g id="node1" class="node">
<title>read_index</title>
<path fill="none" stroke="#1c2123" d="M12,-202.5C12,-202.5 126,-202.5 126,-202.5 132,-202.5 138,-208.5 138,-214.5 138,-214.5 138,-251.5 138,-251.5 138,-257.5 132,-263.5 126,-263.5 126,-263.5 12,-263.5 12,-263.5 6,-263.5 0,-257.5 0,-251.5 0,-251.5 0,-214.5 0,-214.5 0,-208.5 6,-202.5 12,-202.5"/>
<text text-anchor="middle" x="69" y="-248.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">read_index</text>
<polyline fill="none" stroke="#1c2123" points="0,-240.5 138,-240.5 "/>
<text text-anchor="start" x="8" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">leader处理follower的</text>
<text text-anchor="start" x="8" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> read index 请求</text>
</g>
<!-- send_command -->
<g id="node2" class="node">
<title>send_command</title>
<path fill="none" stroke="#1c2123" d="M265,-251C265,-251 186,-251 186,-251 180,-251 174,-245 174,-239 174,-239 174,-227 174,-227 174,-221 180,-215 186,-215 186,-215 265,-215 265,-215 271,-215 277,-221 277,-227 277,-227 277,-239 277,-239 277,-245 271,-251 265,-251"/>
<text text-anchor="middle" x="225.5" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_command</text>
</g>
<!-- read_index&#45;&gt;send_command -->
<g id="edge1" class="edge">
<title>read_index&#45;&gt;send_command</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M138.22,-233C146.72,-233 155.37,-233 163.76,-233"/>
<polygon fill="green" stroke="green" points="163.82,-236.5 173.82,-233 163.82,-229.5 163.82,-236.5"/>
</g>
<!-- peer_step -->
<g id="node3" class="node">
<title>peer_step</title>
<path fill="none" stroke="#1c2123" d="M325,-195C325,-195 588,-195 588,-195 594,-195 600,-201 600,-207 600,-207 600,-259 600,-259 600,-265 594,-271 588,-271 588,-271 325,-271 325,-271 319,-271 313,-265 313,-259 313,-259 313,-207 313,-207 313,-201 319,-195 325,-195"/>
<text text-anchor="middle" x="456.5" y="-255.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">peer::step</text>
<polyline fill="none" stroke="#1c2123" points="313,-248 600,-248 "/>
<text text-anchor="start" x="321" y="-232.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">step the raft message</text>
<text text-anchor="start" x="321" y="-217.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果消息类型为MessageType::MsgReadIndex</text>
<text text-anchor="start" x="321" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用ctx.coprocessor_host.on_step_read_index</text>
</g>
<!-- send_command&#45;&gt;peer_step -->
<g id="edge2" class="edge">
<title>send_command&#45;&gt;peer_step</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M277.04,-233C284.98,-233 293.53,-233 302.43,-233"/>
<polygon fill="green" stroke="green" points="302.61,-236.5 312.61,-233 302.61,-229.5 302.61,-236.5"/>
</g>
<!-- on_step_read_index -->
<g id="node10" class="node">
<title>on_step_read_index</title>
<path fill="none" stroke="#1c2123" d="M775,-230C775,-230 674,-230 674,-230 668,-230 662,-224 662,-218 662,-218 662,-206 662,-206 662,-200 668,-194 674,-194 674,-194 775,-194 775,-194 781,-194 787,-200 787,-206 787,-206 787,-218 787,-218 787,-224 781,-230 775,-230"/>
<text text-anchor="middle" x="724.5" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_step_read_index</text>
</g>
<!-- peer_step&#45;&gt;on_step_read_index -->
<g id="edge8" class="edge">
<title>peer_step&#45;&gt;on_step_read_index</title>
<path fill="none" stroke="#666666" d="M600.23,-221.73C618.03,-220.33 635.59,-218.94 651.63,-217.67"/>
<polygon fill="#666666" stroke="#666666" points="652.25,-221.14 661.94,-216.86 651.7,-214.16 652.25,-221.14"/>
</g>
<!-- register -->
<g id="node4" class="node">
<title>register</title>
<path fill="none" stroke="#1c2123" d="M473,-107C473,-107 440,-107 440,-107 434,-107 428,-101 428,-95 428,-95 428,-83 428,-83 428,-77 434,-71 440,-71 440,-71 473,-71 473,-71 479,-71 485,-77 485,-83 485,-83 485,-95 485,-95 485,-101 479,-107 473,-107"/>
<text text-anchor="middle" x="456.5" y="-85.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">register</text>
</g>
<!-- register_read_index_observer -->
<g id="node5" class="node">
<title>register_read_index_observer</title>
<path fill="none" stroke="#1c2123" d="M648,-66C648,-66 801,-66 801,-66 807,-66 813,-72 813,-78 813,-78 813,-100 813,-100 813,-106 807,-112 801,-112 801,-112 648,-112 648,-112 642,-112 636,-106 636,-100 636,-100 636,-78 636,-78 636,-72 642,-66 648,-66"/>
<text text-anchor="middle" x="724.5" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">register_read_index_observer</text>
<polyline fill="none" stroke="#1c2123" points="636,-89 813,-89 "/>
<text text-anchor="middle" x="724.5" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">注册observer回调函数</text>
</g>
<!-- register&#45;&gt;register_read_index_observer -->
<g id="edge3" class="edge">
<title>register&#45;&gt;register_read_index_observer</title>
<path fill="none" stroke="#666666" d="M485.46,-89C518.6,-89 575.6,-89 625.52,-89"/>
<polygon fill="#666666" stroke="#666666" points="625.73,-92.5 635.73,-89 625.73,-85.5 625.73,-92.5"/>
</g>
<!-- read_index_observers -->
<g id="node6" class="node">
<title>read_index_observers</title>
<path fill="#feed9b" stroke="#f7e495" d="M861,-17C861,-17 1075,-17 1075,-17 1081,-17 1087,-23 1087,-29 1087,-29 1087,-81 1087,-81 1087,-87 1081,-93 1075,-93 1075,-93 861,-93 861,-93 855,-93 849,-87 849,-81 849,-81 849,-29 849,-29 849,-23 855,-17 861,-17"/>
<text text-anchor="start" x="857" y="-77.8" font-family="Times,serif" font-size="14.00" fill="#40575d">read_index_observers</text>
<polyline fill="none" stroke="#f7e495" points="849,-70 1087,-70 "/>
<text text-anchor="start" x="857" y="-54.8" font-family="Times,serif" font-size="14.00" fill="#40575d">pub struct Registry{</text>
<text text-anchor="start" x="857" y="-39.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> Vec&lt;Entry&lt;BoxReadIndexObserver&gt;&gt;,</text>
<text text-anchor="start" x="857" y="-24.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> }</text>
</g>
<!-- register_read_index_observer&#45;&gt;read_index_observers -->
<g id="edge4" class="edge">
<title>register_read_index_observer&#45;&gt;read_index_observers</title>
<path fill="none" stroke="#666666" d="M813.03,-76.68C821.37,-75.5 829.95,-74.3 838.57,-73.08"/>
<polygon fill="#666666" stroke="#666666" points="839.3,-76.51 848.71,-71.65 838.32,-69.58 839.3,-76.51"/>
</g>
<!-- on_step -->
<g id="node7" class="node">
<title>on_step</title>
<path fill="none" stroke="#1c2123" d="M985.5,-148C985.5,-148 950.5,-148 950.5,-148 944.5,-148 938.5,-142 938.5,-136 938.5,-136 938.5,-124 938.5,-124 938.5,-118 944.5,-112 950.5,-112 950.5,-112 985.5,-112 985.5,-112 991.5,-112 997.5,-118 997.5,-124 997.5,-124 997.5,-136 997.5,-136 997.5,-142 991.5,-148 985.5,-148"/>
<text text-anchor="middle" x="968" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_step</text>
</g>
<!-- register_read_index_observer&#45;&gt;on_step -->
<g id="edge10" class="edge">
<title>register_read_index_observer&#45;&gt;on_step</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M813.03,-103.86C852.56,-110.57 897.25,-118.16 928.26,-123.42"/>
<polygon fill="green" stroke="green" points="927.78,-126.89 938.23,-125.12 928.95,-119.99 927.78,-126.89"/>
</g>
<!-- update_max_ts -->
<g id="node8" class="node">
<title>update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M1247.5,-178C1247.5,-178 1172.5,-178 1172.5,-178 1166.5,-178 1160.5,-172 1160.5,-166 1160.5,-166 1160.5,-154 1160.5,-154 1160.5,-148 1166.5,-142 1172.5,-142 1172.5,-142 1247.5,-142 1247.5,-142 1253.5,-142 1259.5,-148 1259.5,-154 1259.5,-154 1259.5,-166 1259.5,-166 1259.5,-172 1253.5,-178 1247.5,-178"/>
<text text-anchor="middle" x="1210" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_max_ts</text>
</g>
<!-- on_step&#45;&gt;update_max_ts -->
<g id="edge6" class="edge">
<title>on_step&#45;&gt;update_max_ts</title>
<path fill="none" stroke="#666666" d="M997.95,-133.62C1035.54,-138.32 1102.06,-146.63 1150.4,-152.67"/>
<polygon fill="#666666" stroke="#666666" points="1150.06,-156.16 1160.42,-153.93 1150.93,-149.21 1150.06,-156.16"/>
</g>
<!-- read_range_check -->
<g id="node9" class="node">
<title>read_range_check</title>
<path fill="none" stroke="#1c2123" d="M1138,-77C1138,-77 1282,-77 1282,-77 1288,-77 1294,-83 1294,-89 1294,-89 1294,-111 1294,-111 1294,-117 1288,-123 1282,-123 1282,-123 1138,-123 1138,-123 1132,-123 1126,-117 1126,-111 1126,-111 1126,-89 1126,-89 1126,-83 1132,-77 1138,-77"/>
<text text-anchor="middle" x="1210" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">read_range_check</text>
<polyline fill="none" stroke="#1c2123" points="1126,-100 1294,-100 "/>
<text text-anchor="start" x="1134" y="-84.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">这个地方check的原因是?</text>
</g>
<!-- on_step&#45;&gt;read_range_check -->
<g id="edge7" class="edge">
<title>on_step&#45;&gt;read_range_check</title>
<path fill="none" stroke="#666666" d="M997.95,-126.38C1027.15,-122.73 1073.8,-116.9 1115.83,-111.65"/>
<polygon fill="#666666" stroke="#666666" points="1116.35,-115.11 1125.83,-110.4 1115.48,-108.16 1116.35,-115.11"/>
</g>
<!-- on_step_read_index&#45;&gt;read_index_observers -->
<g id="edge9" class="edge">
<title>on_step_read_index&#45;&gt;read_index_observers</title>
<path fill="none" stroke="#666666" d="M787.43,-204.18C796.73,-200.91 805.65,-196.35 813,-190 844.67,-162.65 819.32,-132.5 849,-103 850.1,-101.9 851.23,-100.83 852.39,-99.78"/>
<polygon fill="#666666" stroke="#666666" points="854.89,-102.26 860.38,-93.2 850.44,-96.86 854.89,-102.26"/>
</g>
<!-- on_step_read_index&#45;&gt;on_step -->
<g id="edge5" class="edge">
<title>on_step_read_index&#45;&gt;on_step</title>
<path fill="none" stroke="#666666" d="M787.44,-197.45C796.07,-195.13 804.79,-192.62 813,-190 853.21,-177.17 898.05,-159.28 928.92,-146.37"/>
<polygon fill="#666666" stroke="#666666" points="930.58,-149.48 938.44,-142.37 927.86,-143.02 930.58,-149.48"/>
</g>
</g>
</svg>
