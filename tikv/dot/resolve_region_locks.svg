<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: resolve_region_locks Pages: 1 -->
<svg width="896pt" height="206pt"
 viewBox="0.00 0.00 896.00 205.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 201.5)">
<title>resolve_region_locks</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-201.5 892,-201.5 892,4 -4,4"/>
<!-- resolveRegionLocks -->
<g id="node1" class="node">
<title>resolveRegionLocks</title>
<path fill="none" stroke="#1c2123" d="M12,-110.5C12,-110.5 198,-110.5 198,-110.5 204,-110.5 210,-116.5 210,-122.5 210,-122.5 210,-159.5 210,-159.5 210,-165.5 204,-171.5 198,-171.5 198,-171.5 12,-171.5 12,-171.5 6,-171.5 0,-165.5 0,-159.5 0,-159.5 0,-122.5 0,-122.5 0,-116.5 6,-110.5 12,-110.5"/>
<text text-anchor="middle" x="105" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolveRegionLocks</text>
<polyline fill="none" stroke="#1c2123" points="0,-148.5 210,-148.5 "/>
<text text-anchor="start" x="8" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolve all keys int the same region</text>
<text text-anchor="start" x="8" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> at same time</text>
</g>
<!-- CmdResolveLock -->
<g id="node2" class="node">
<title>CmdResolveLock</title>
<path fill="none" stroke="#1c2123" d="M359,-128.5C359,-128.5 527,-128.5 527,-128.5 533,-128.5 539,-134.5 539,-140.5 539,-140.5 539,-177.5 539,-177.5 539,-183.5 533,-189.5 527,-189.5 527,-189.5 359,-189.5 359,-189.5 353,-189.5 347,-183.5 347,-177.5 347,-177.5 347,-140.5 347,-140.5 347,-134.5 353,-128.5 359,-128.5"/>
<text text-anchor="middle" x="443" y="-174.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdResolveLock</text>
<polyline fill="none" stroke="#1c2123" points="347,-166.5 539,-166.5 "/>
<text text-anchor="start" x="355" y="-151.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Tikv 层根据TxStatus 清理lock</text>
<text text-anchor="start" x="355" y="-136.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit或者cleanup</text>
</g>
<!-- resolveRegionLocks&#45;&gt;CmdResolveLock -->
<g id="edge1" class="edge">
<title>resolveRegionLocks&#45;&gt;CmdResolveLock</title>
<path fill="none" stroke="#666666" d="M210.08,-161.68C222.15,-163.45 234.32,-164.97 246,-166 274.78,-168.55 282.12,-166.77 311,-166 319.35,-165.78 327.99,-165.47 336.67,-165.12"/>
<polygon fill="#666666" stroke="#666666" points="337.02,-168.61 346.86,-164.68 336.72,-161.61 337.02,-168.61"/>
</g>
<!-- SendReq -->
<g id="node3" class="node">
<title>SendReq</title>
<path fill="none" stroke="#1c2123" d="M299,-157C299,-157 258,-157 258,-157 252,-157 246,-151 246,-145 246,-145 246,-133 246,-133 246,-127 252,-121 258,-121 258,-121 299,-121 299,-121 305,-121 311,-127 311,-133 311,-133 311,-145 311,-145 311,-151 305,-157 299,-157"/>
<text text-anchor="middle" x="278.5" y="-135.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SendReq</text>
</g>
<!-- resolveRegionLocks&#45;&gt;SendReq -->
<g id="edge2" class="edge">
<title>resolveRegionLocks&#45;&gt;SendReq</title>
<path fill="none" stroke="#666666" d="M210.21,-139.78C219.18,-139.68 227.87,-139.58 235.86,-139.49"/>
<polygon fill="#666666" stroke="#666666" points="235.97,-142.98 245.93,-139.37 235.89,-135.99 235.97,-142.98"/>
</g>
<!-- resolveRegionLocks_recurisve -->
<g id="node4" class="node">
<title>resolveRegionLocks_recurisve</title>
<path fill="none" stroke="#1c2123" d="M15,-0.5C15,-0.5 195,-0.5 195,-0.5 201,-0.5 207,-6.5 207,-12.5 207,-12.5 207,-79.5 207,-79.5 207,-85.5 201,-91.5 195,-91.5 195,-91.5 15,-91.5 15,-91.5 9,-91.5 3,-85.5 3,-79.5 3,-79.5 3,-12.5 3,-12.5 3,-6.5 9,-0.5 15,-0.5"/>
<text text-anchor="middle" x="105" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolveRegionLocks</text>
<polyline fill="none" stroke="#1c2123" points="3,-68.5 207,-68.5 "/>
<text text-anchor="start" x="11" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">递归的调用自己</text>
<text text-anchor="start" x="11" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Recursion will terminate because</text>
<text text-anchor="start" x="11" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> the resolve request succeeds </text>
<text text-anchor="start" x="11" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> or the Backoffer reaches its limit.</text>
</g>
<!-- GroupKeysByRegion -->
<g id="node5" class="node">
<title>GroupKeysByRegion</title>
<path fill="none" stroke="#1c2123" d="M763,-69C763,-69 876,-69 876,-69 882,-69 888,-75 888,-81 888,-81 888,-103 888,-103 888,-109 882,-115 876,-115 876,-115 763,-115 763,-115 757,-115 751,-109 751,-103 751,-103 751,-81 751,-81 751,-75 757,-69 763,-69"/>
<text text-anchor="middle" x="819.5" y="-99.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">GroupKeysByRegion</text>
<polyline fill="none" stroke="#1c2123" points="751,-92 888,-92 "/>
<text text-anchor="start" x="759" y="-76.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">重新按照region分组</text>
</g>
<!-- resolveRegionLocks&#45;&gt;GroupKeysByRegion -->
<g id="edge4" class="edge">
<title>resolveRegionLocks&#45;&gt;GroupKeysByRegion</title>
<path fill="none" stroke="#666666" d="M210.03,-117.42C222.11,-115.29 234.29,-113.41 246,-112 421.95,-90.86 630.32,-89.46 740.74,-90.56"/>
<polygon fill="#666666" stroke="#666666" points="740.76,-94.06 750.79,-90.67 740.83,-87.06 740.76,-94.06"/>
</g>
<!-- regionErr -->
<g id="node6" class="node">
<title>regionErr</title>
<path fill="none" stroke="#1c2123" d="M587,-121C587,-121 703,-121 703,-121 709,-121 715,-127 715,-133 715,-133 715,-185 715,-185 715,-191 709,-197 703,-197 703,-197 587,-197 587,-197 581,-197 575,-191 575,-185 575,-185 575,-133 575,-133 575,-127 581,-121 587,-121"/>
<text text-anchor="middle" x="645" y="-181.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">regionErr</text>
<polyline fill="none" stroke="#1c2123" points="575,-174 715,-174 "/>
<text text-anchor="start" x="583" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Tikv返回regionErr</text>
<text text-anchor="start" x="583" y="-143.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 再此期间region可能</text>
<text text-anchor="start" x="583" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> merge或者split了</text>
</g>
<!-- CmdResolveLock&#45;&gt;regionErr -->
<g id="edge5" class="edge">
<title>CmdResolveLock&#45;&gt;regionErr</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M539.02,-159C547.62,-159 556.27,-159 564.71,-159"/>
<polygon fill="green" stroke="green" points="564.89,-162.5 574.89,-159 564.89,-155.5 564.89,-162.5"/>
</g>
<!-- SendReq&#45;&gt;CmdResolveLock -->
<g id="edge7" class="edge">
<title>SendReq&#45;&gt;CmdResolveLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M311.22,-142.9C318.95,-143.86 327.65,-144.93 336.8,-146.05"/>
<polygon fill="green" stroke="green" points="336.52,-149.54 346.87,-147.29 337.37,-142.6 336.52,-149.54"/>
</g>
<!-- GroupKeysByRegion&#45;&gt;resolveRegionLocks_recurisve -->
<g id="edge8" class="edge">
<title>GroupKeysByRegion&#45;&gt;resolveRegionLocks_recurisve</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M750.95,-82.05C738.99,-80.52 726.64,-79.09 715,-78 541.6,-61.74 339.58,-53.17 217.33,-49.11"/>
<polygon fill="green" stroke="green" points="217.32,-45.61 207.21,-48.78 217.09,-52.61 217.32,-45.61"/>
</g>
<!-- regionErr&#45;&gt;GroupKeysByRegion -->
<g id="edge6" class="edge">
<title>regionErr&#45;&gt;GroupKeysByRegion</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M715.17,-132.13C726.52,-127.73 738.28,-123.16 749.62,-118.75"/>
<polygon fill="green" stroke="green" points="750.98,-121.98 759.04,-115.1 748.45,-115.45 750.98,-121.98"/>
</g>
</g>
</svg>
