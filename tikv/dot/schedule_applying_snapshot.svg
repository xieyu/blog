<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: schedule_applying_snapshot Pages: 1 -->
<svg width="1102pt" height="477pt"
 viewBox="0.00 0.00 1102.00 476.73" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 472.73)">
<title>schedule_applying_snapshot</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-472.73 1098,-472.73 1098,4 -4,4"/>
<!-- PeerStorage_handle_raft_ready -->
<g id="node1" class="node">
<title>PeerStorage_handle_raft_ready</title>
<path fill="none" stroke="#1c2123" d="M12,-148.73C12,-148.73 176,-148.73 176,-148.73 182,-148.73 188,-154.73 188,-160.73 188,-160.73 188,-227.73 188,-227.73 188,-233.73 182,-239.73 176,-239.73 176,-239.73 12,-239.73 12,-239.73 6,-239.73 0,-233.73 0,-227.73 0,-227.73 0,-160.73 0,-160.73 0,-154.73 6,-148.73 12,-148.73"/>
<text text-anchor="start" x="8" y="-224.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage</text>
<text text-anchor="start" x="8" y="-209.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_ready</text>
<polyline fill="none" stroke="#1c2123" points="0,-201.73 188,-201.73 "/>
<text text-anchor="start" x="8" y="-186.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">将raft ready中的snapshot信息</text>
<text text-anchor="start" x="8" y="-171.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 放到InvokeContext中，</text>
<text text-anchor="start" x="8" y="-156.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后写入write batch</text>
</g>
<!-- PeerStorage_apply_snapshot -->
<g id="node2" class="node">
<title>PeerStorage_apply_snapshot</title>
<path fill="none" stroke="#1c2123" d="M236,-156.23C236,-156.23 398,-156.23 398,-156.23 404,-156.23 410,-162.23 410,-168.23 410,-168.23 410,-220.23 410,-220.23 410,-226.23 404,-232.23 398,-232.23 398,-232.23 236,-232.23 236,-232.23 230,-232.23 224,-226.23 224,-220.23 224,-220.23 224,-168.23 224,-168.23 224,-162.23 230,-156.23 236,-156.23"/>
<text text-anchor="start" x="232" y="-217.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage</text>
<text text-anchor="start" x="232" y="-202.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="224,-194.23 410,-194.23 "/>
<text text-anchor="start" x="232" y="-179.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">将snapshot的last_index, term</text>
<text text-anchor="start" x="232" y="-164.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等信息放到InvokeContext中</text>
</g>
<!-- PeerStorage_handle_raft_ready&#45;&gt;PeerStorage_apply_snapshot -->
<g id="edge1" class="edge">
<title>PeerStorage_handle_raft_ready&#45;&gt;PeerStorage_apply_snapshot</title>
<path fill="none" stroke="#666666" d="M188.08,-194.23C196.47,-194.23 204.99,-194.23 213.46,-194.23"/>
<polygon fill="#666666" stroke="#666666" points="213.73,-197.73 223.73,-194.23 213.73,-190.73 213.73,-197.73"/>
</g>
<!-- InvokeContext_save_apply_state_to -->
<g id="node3" class="node">
<title>InvokeContext_save_apply_state_to</title>
<path fill="none" stroke="#1c2123" d="M728.5,-132.23C728.5,-132.23 847.5,-132.23 847.5,-132.23 853.5,-132.23 859.5,-138.23 859.5,-144.23 859.5,-144.23 859.5,-196.23 859.5,-196.23 859.5,-202.23 853.5,-208.23 847.5,-208.23 847.5,-208.23 728.5,-208.23 728.5,-208.23 722.5,-208.23 716.5,-202.23 716.5,-196.23 716.5,-196.23 716.5,-144.23 716.5,-144.23 716.5,-138.23 722.5,-132.23 728.5,-132.23"/>
<text text-anchor="start" x="724.5" y="-193.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
<text text-anchor="start" x="724.5" y="-178.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> save_apply_state_to</text>
<polyline fill="none" stroke="#1c2123" points="716.5,-170.23 859.5,-170.23 "/>
<text text-anchor="start" x="724.5" y="-155.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">保存RaftApplyState到</text>
<text text-anchor="start" x="724.5" y="-140.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write batch</text>
</g>
<!-- PeerStorage_handle_raft_ready&#45;&gt;InvokeContext_save_apply_state_to -->
<g id="edge2" class="edge">
<title>PeerStorage_handle_raft_ready&#45;&gt;InvokeContext_save_apply_state_to</title>
<path fill="none" stroke="#666666" d="M188.05,-236.41C301.06,-281.46 496.05,-339.18 653,-282.23 689.84,-268.86 723.63,-240.45 748.07,-215.58"/>
<polygon fill="#666666" stroke="#666666" points="750.62,-217.98 755.03,-208.34 745.57,-213.13 750.62,-217.98"/>
</g>
<!-- InvokeContext_save_raft_state_to -->
<g id="node4" class="node">
<title>InvokeContext_save_raft_state_to</title>
<path fill="none" stroke="#1c2123" d="M730,-4.23C730,-4.23 846,-4.23 846,-4.23 852,-4.23 858,-10.23 858,-16.23 858,-16.23 858,-68.23 858,-68.23 858,-74.23 852,-80.23 846,-80.23 846,-80.23 730,-80.23 730,-80.23 724,-80.23 718,-74.23 718,-68.23 718,-68.23 718,-16.23 718,-16.23 718,-10.23 724,-4.23 730,-4.23"/>
<text text-anchor="start" x="726" y="-65.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
<text text-anchor="start" x="726" y="-50.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> save_raft_state_to</text>
<polyline fill="none" stroke="#1c2123" points="718,-42.23 858,-42.23 "/>
<text text-anchor="start" x="726" y="-27.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">保存RaftLocalState到</text>
<text text-anchor="start" x="726" y="-12.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write batch</text>
</g>
<!-- PeerStorage_handle_raft_ready&#45;&gt;InvokeContext_save_raft_state_to -->
<g id="edge3" class="edge">
<title>PeerStorage_handle_raft_ready&#45;&gt;InvokeContext_save_raft_state_to</title>
<path fill="none" stroke="#666666" d="M159.11,-148.63C226.72,-103.56 338.2,-37.64 446,-11.23 533.91,10.31 637.88,-4.74 707.7,-20.47"/>
<polygon fill="#666666" stroke="#666666" points="707.22,-23.95 717.75,-22.79 708.8,-17.13 707.22,-23.95"/>
</g>
<!-- InvokeContext_snap_region -->
<g id="node5" class="node">
<title>InvokeContext_snap_region</title>
<path fill="none" stroke="#1c2123" d="M458,-329.73C458,-329.73 641,-329.73 641,-329.73 647,-329.73 653,-335.73 653,-341.73 653,-341.73 653,-408.73 653,-408.73 653,-414.73 647,-420.73 641,-420.73 641,-420.73 458,-420.73 458,-420.73 452,-420.73 446,-414.73 446,-408.73 446,-408.73 446,-341.73 446,-341.73 446,-335.73 452,-329.73 458,-329.73"/>
<text text-anchor="start" x="454" y="-405.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
<text text-anchor="start" x="454" y="-390.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snap_region</text>
<polyline fill="none" stroke="#1c2123" points="446,-382.73 653,-382.73 "/>
<text text-anchor="start" x="454" y="-367.53" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap信息保存在InvokeContext中</text>
<text text-anchor="start" x="454" y="-352.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> post_ready会使用该snap_region</text>
<text text-anchor="start" x="454" y="-337.53" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 信息</text>
</g>
<!-- PeerStorage_apply_snapshot&#45;&gt;InvokeContext_snap_region -->
<g id="edge4" class="edge">
<title>PeerStorage_apply_snapshot&#45;&gt;InvokeContext_snap_region</title>
<path fill="none" stroke="#666666" d="M366.6,-232.39C400.12,-258.72 445.11,-294.04 481.96,-322.98"/>
<polygon fill="#666666" stroke="#666666" points="480.14,-326 490.17,-329.42 484.46,-320.49 480.14,-326"/>
</g>
<!-- write_peer_state_Applying -->
<g id="node6" class="node">
<title>write_peer_state_Applying</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M496.5,-211.73C496.5,-211.73 602.5,-211.73 602.5,-211.73 608.5,-211.73 614.5,-217.73 614.5,-223.73 614.5,-223.73 614.5,-260.73 614.5,-260.73 614.5,-266.73 608.5,-272.73 602.5,-272.73 602.5,-272.73 496.5,-272.73 496.5,-272.73 490.5,-272.73 484.5,-266.73 484.5,-260.73 484.5,-260.73 484.5,-223.73 484.5,-223.73 484.5,-217.73 490.5,-211.73 496.5,-211.73"/>
<text text-anchor="middle" x="549.5" y="-257.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">write_peer_state</text>
<polyline fill="none" stroke="#8a8898" points="484.5,-249.73 614.5,-249.73 "/>
<text text-anchor="start" x="492.5" y="-234.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">将peer状态设置为</text>
<text text-anchor="start" x="492.5" y="-219.53" font-family="Times,serif" font-size="14.00" fill="#5d6179"> PeerState::Applying</text>
</g>
<!-- PeerStorage_apply_snapshot&#45;&gt;write_peer_state_Applying -->
<g id="edge5" class="edge">
<title>PeerStorage_apply_snapshot&#45;&gt;write_peer_state_Applying</title>
<path fill="none" stroke="#666666" d="M410.09,-213.41C431.43,-217.85 453.87,-222.52 474.33,-226.78"/>
<polygon fill="#666666" stroke="#666666" points="473.69,-230.23 484.2,-228.84 475.12,-223.37 473.69,-230.23"/>
</g>
<!-- InvokeContext_apply_state -->
<g id="node7" class="node">
<title>InvokeContext_apply_state</title>
<path fill="none" stroke="#1c2123" d="M485.5,-116.23C485.5,-116.23 613.5,-116.23 613.5,-116.23 619.5,-116.23 625.5,-122.23 625.5,-128.23 625.5,-128.23 625.5,-180.23 625.5,-180.23 625.5,-186.23 619.5,-192.23 613.5,-192.23 613.5,-192.23 485.5,-192.23 485.5,-192.23 479.5,-192.23 473.5,-186.23 473.5,-180.23 473.5,-180.23 473.5,-128.23 473.5,-128.23 473.5,-122.23 479.5,-116.23 485.5,-116.23"/>
<text text-anchor="start" x="481.5" y="-177.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
<text text-anchor="start" x="481.5" y="-162.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> apply_state</text>
<polyline fill="none" stroke="#1c2123" points="473.5,-154.23 625.5,-154.23 "/>
<text text-anchor="start" x="481.5" y="-139.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用snapshot meta信息</text>
<text text-anchor="start" x="481.5" y="-124.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新apply state</text>
</g>
<!-- PeerStorage_apply_snapshot&#45;&gt;InvokeContext_apply_state -->
<g id="edge6" class="edge">
<title>PeerStorage_apply_snapshot&#45;&gt;InvokeContext_apply_state</title>
<path fill="none" stroke="#666666" d="M410.09,-178.25C427.6,-175.21 445.85,-172.04 463.13,-169.04"/>
<polygon fill="#666666" stroke="#666666" points="463.93,-172.46 473.19,-167.3 462.74,-165.56 463.93,-172.46"/>
</g>
<!-- InvokeContext_raft_state -->
<g id="node8" class="node">
<title>InvokeContext_raft_state</title>
<path fill="none" stroke="#1c2123" d="M485.5,-21.23C485.5,-21.23 613.5,-21.23 613.5,-21.23 619.5,-21.23 625.5,-27.23 625.5,-33.23 625.5,-33.23 625.5,-85.23 625.5,-85.23 625.5,-91.23 619.5,-97.23 613.5,-97.23 613.5,-97.23 485.5,-97.23 485.5,-97.23 479.5,-97.23 473.5,-91.23 473.5,-85.23 473.5,-85.23 473.5,-33.23 473.5,-33.23 473.5,-27.23 479.5,-21.23 485.5,-21.23"/>
<text text-anchor="start" x="481.5" y="-82.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvokeContext</text>
<text text-anchor="start" x="481.5" y="-67.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> raft_state</text>
<polyline fill="none" stroke="#1c2123" points="473.5,-59.23 625.5,-59.23 "/>
<text text-anchor="start" x="481.5" y="-44.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用snapshot meta信息</text>
<text text-anchor="start" x="481.5" y="-29.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新raft state</text>
</g>
<!-- PeerStorage_apply_snapshot&#45;&gt;InvokeContext_raft_state -->
<g id="edge7" class="edge">
<title>PeerStorage_apply_snapshot&#45;&gt;InvokeContext_raft_state</title>
<path fill="none" stroke="#666666" d="M369,-156.17C391.95,-139.84 419.73,-121.13 446,-106.23 451.83,-102.92 457.94,-99.65 464.15,-96.48"/>
<polygon fill="#666666" stroke="#666666" points="465.92,-99.51 473.29,-91.9 462.78,-93.25 465.92,-99.51"/>
</g>
<!-- PeerStorage_schedule_applying_snapshot -->
<g id="node10" class="node">
<title>PeerStorage_schedule_applying_snapshot</title>
<path fill="none" stroke="#1c2123" d="M701,-374.23C701,-374.23 875,-374.23 875,-374.23 881,-374.23 887,-380.23 887,-386.23 887,-386.23 887,-438.23 887,-438.23 887,-444.23 881,-450.23 875,-450.23 875,-450.23 701,-450.23 701,-450.23 695,-450.23 689,-444.23 689,-438.23 689,-438.23 689,-386.23 689,-386.23 689,-380.23 695,-374.23 701,-374.23"/>
<text text-anchor="start" x="697" y="-435.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage</text>
<text text-anchor="start" x="697" y="-420.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> schedule_applying_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="689,-412.23 887,-412.23 "/>
<text text-anchor="start" x="697" y="-397.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送RegionTask::Apply 任务给</text>
<text text-anchor="start" x="697" y="-382.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snap generator线程池</text>
</g>
<!-- InvokeContext_snap_region&#45;&gt;PeerStorage_schedule_applying_snapshot -->
<g id="edge12" class="edge">
<title>InvokeContext_snap_region&#45;&gt;PeerStorage_schedule_applying_snapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M653.2,-391.3C661.71,-392.63 670.33,-393.98 678.88,-395.31"/>
<polygon fill="green" stroke="green" points="678.46,-398.79 688.88,-396.88 679.54,-391.87 678.46,-398.79"/>
</g>
<!-- InvokeContext_apply_state&#45;&gt;InvokeContext_save_apply_state_to -->
<g id="edge8" class="edge">
<title>InvokeContext_apply_state&#45;&gt;InvokeContext_save_apply_state_to</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M625.66,-159.31C651.33,-161.05 680.14,-163 706.23,-164.76"/>
<polygon fill="green" stroke="green" points="706.25,-168.27 716.47,-165.46 706.73,-161.29 706.25,-168.27"/>
</g>
<!-- InvokeContext_raft_state&#45;&gt;InvokeContext_save_raft_state_to -->
<g id="edge9" class="edge">
<title>InvokeContext_raft_state&#45;&gt;InvokeContext_save_raft_state_to</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M625.66,-53.83C651.8,-51.95 681.2,-49.83 707.67,-47.93"/>
<polygon fill="green" stroke="green" points="707.94,-51.42 717.66,-47.21 707.44,-44.44 707.94,-51.42"/>
</g>
<!-- PeerStorage_post_ready -->
<g id="node9" class="node">
<title>PeerStorage_post_ready</title>
<path fill="none" stroke="#1c2123" d="M46,-392.23C46,-392.23 142,-392.23 142,-392.23 148,-392.23 154,-398.23 154,-404.23 154,-404.23 154,-456.23 154,-456.23 154,-462.23 148,-468.23 142,-468.23 142,-468.23 46,-468.23 46,-468.23 40,-468.23 34,-462.23 34,-456.23 34,-456.23 34,-404.23 34,-404.23 34,-398.23 40,-392.23 46,-392.23"/>
<text text-anchor="start" x="42" y="-453.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerStorage</text>
<text text-anchor="start" x="42" y="-438.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> post_ready</text>
<polyline fill="none" stroke="#1c2123" points="34,-430.23 154,-430.23 "/>
<text text-anchor="start" x="42" y="-415.03" font-family="Times,serif" font-size="14.00" fill="#2f3638">write batch中数据</text>
<text text-anchor="start" x="42" y="-400.03" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 已写入磁盘中</text>
</g>
<!-- PeerStorage_post_ready&#45;&gt;InvokeContext_snap_region -->
<g id="edge10" class="edge">
<title>PeerStorage_post_ready&#45;&gt;InvokeContext_snap_region</title>
<path fill="none" stroke="#666666" d="M154.29,-423.04C225.49,-414.4 346.47,-399.73 435.67,-388.91"/>
<polygon fill="#666666" stroke="#666666" points="436.34,-392.36 445.84,-387.68 435.49,-385.41 436.34,-392.36"/>
</g>
<!-- PeerStorage_post_ready&#45;&gt;PeerStorage_schedule_applying_snapshot -->
<g id="edge11" class="edge">
<title>PeerStorage_post_ready&#45;&gt;PeerStorage_schedule_applying_snapshot</title>
<path fill="none" stroke="#666666" d="M154.14,-432.82C256.1,-436.7 471.52,-442.36 653,-430.23 661.33,-429.67 669.94,-428.92 678.58,-428.04"/>
<polygon fill="#666666" stroke="#666666" points="679.15,-431.5 688.72,-426.96 678.41,-424.54 679.15,-431.5"/>
</g>
<!-- PeerStorage_set_snap_state -->
<g id="node11" class="node">
<title>PeerStorage_set_snap_state</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M935,-366.73C935,-366.73 1082,-366.73 1082,-366.73 1088,-366.73 1094,-372.73 1094,-378.73 1094,-378.73 1094,-445.73 1094,-445.73 1094,-451.73 1088,-457.73 1082,-457.73 1082,-457.73 935,-457.73 935,-457.73 929,-457.73 923,-451.73 923,-445.73 923,-445.73 923,-378.73 923,-378.73 923,-372.73 929,-366.73 935,-366.73"/>
<text text-anchor="start" x="931" y="-442.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">PeerStorage</text>
<text text-anchor="start" x="931" y="-427.53" font-family="Times,serif" font-size="14.00" fill="#5d6179"> set_snap_state</text>
<polyline fill="none" stroke="#8a8898" points="923,-419.73 1094,-419.73 "/>
<text text-anchor="start" x="931" y="-404.53" font-family="Times,serif" font-size="14.00" fill="#5d6179">设置status为</text>
<text text-anchor="start" x="931" y="-389.53" font-family="Times,serif" font-size="14.00" fill="#5d6179"> SnapState::Applying(</text>
<text text-anchor="start" x="931" y="-374.53" font-family="Times,serif" font-size="14.00" fill="#5d6179"> JOB_STATUS_PENDING)</text>
</g>
<!-- PeerStorage_schedule_applying_snapshot&#45;&gt;PeerStorage_set_snap_state -->
<g id="edge13" class="edge">
<title>PeerStorage_schedule_applying_snapshot&#45;&gt;PeerStorage_set_snap_state</title>
<path fill="none" stroke="#666666" d="M887.07,-412.23C895.53,-412.23 904.09,-412.23 912.54,-412.23"/>
<polygon fill="#666666" stroke="#666666" points="912.77,-415.73 922.77,-412.23 912.77,-408.73 912.77,-415.73"/>
</g>
</g>
</svg>
