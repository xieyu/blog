<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: scheduler_execute Pages: 1 -->
<svg width="1288pt" height="250pt"
 viewBox="0.00 0.00 1288.00 250.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 246)">
<title>scheduler_execute</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-246 1284,-246 1284,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_Scheduler</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-8C20,-8 1260,-8 1260,-8 1266,-8 1272,-14 1272,-20 1272,-20 1272,-222 1272,-222 1272,-228 1266,-234 1260,-234 1260,-234 20,-234 20,-234 14,-234 8,-228 8,-222 8,-222 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="640" y="-214" font-family="Times,serif" font-size="20.00">Scheduler</text>
</g>
<!-- execute -->
<g id="node1" class="node">
<title>execute</title>
<path fill="none" stroke="#1c2123" d="M247,-51.5C247,-51.5 424,-51.5 424,-51.5 430,-51.5 436,-57.5 436,-63.5 436,-63.5 436,-100.5 436,-100.5 436,-106.5 430,-112.5 424,-112.5 424,-112.5 247,-112.5 247,-112.5 241,-112.5 235,-106.5 235,-100.5 235,-100.5 235,-63.5 235,-63.5 235,-57.5 241,-51.5 247,-51.5"/>
<text text-anchor="middle" x="335.5" y="-97.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">execute</text>
<polyline fill="none" stroke="#1c2123" points="235,-89.5 436,-89.5 "/>
<text text-anchor="start" x="243" y="-74.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从store engine异步获取snapshot</text>
<text text-anchor="start" x="243" y="-59.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后在shed pool中执行Task</text>
</g>
<!-- with_tls_engine -->
<g id="node3" class="node">
<title>with_tls_engine</title>
<path fill="none" stroke="#1c2123" d="M572,-65C572,-65 493,-65 493,-65 487,-65 481,-59 481,-53 481,-53 481,-41 481,-41 481,-35 487,-29 493,-29 493,-29 572,-29 572,-29 578,-29 584,-35 584,-41 584,-41 584,-53 584,-53 584,-59 578,-65 572,-65"/>
<text text-anchor="middle" x="532.5" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">with_tls_engine</text>
</g>
<!-- execute&#45;&gt;with_tls_engine -->
<g id="edge2" class="edge">
<title>execute&#45;&gt;with_tls_engine</title>
<path fill="none" stroke="#666666" d="M436.28,-64.09C448.12,-61.97 459.91,-59.85 470.96,-57.87"/>
<polygon fill="#666666" stroke="#666666" points="471.66,-61.3 480.88,-56.09 470.42,-54.41 471.66,-61.3"/>
</g>
<!-- async_snapshot -->
<g id="node4" class="node">
<title>async_snapshot</title>
<path fill="none" stroke="#1c2123" d="M484,-83.5C484,-83.5 581,-83.5 581,-83.5 587,-83.5 593,-89.5 593,-95.5 593,-95.5 593,-132.5 593,-132.5 593,-138.5 587,-144.5 581,-144.5 581,-144.5 484,-144.5 484,-144.5 478,-144.5 472,-138.5 472,-132.5 472,-132.5 472,-95.5 472,-95.5 472,-89.5 478,-83.5 484,-83.5"/>
<text text-anchor="middle" x="532.5" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="472,-121.5 593,-121.5 "/>
<text text-anchor="start" x="480" y="-106.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">异步获取snapshot</text>
<text text-anchor="start" x="480" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后回调</text>
</g>
<!-- execute&#45;&gt;async_snapshot -->
<g id="edge3" class="edge">
<title>execute&#45;&gt;async_snapshot</title>
<path fill="none" stroke="#666666" d="M436.28,-98.37C444.95,-99.8 453.58,-101.21 461.92,-102.58"/>
<polygon fill="#666666" stroke="#666666" points="461.49,-106.06 471.93,-104.22 462.62,-99.15 461.49,-106.06"/>
</g>
<!-- Task -->
<g id="node2" class="node">
<title>Task</title>
<path fill="#79d8ce" stroke="#60b5ac" d="M28,-36C28,-36 187,-36 187,-36 193,-36 199,-42 199,-48 199,-48 199,-116 199,-116 199,-122 193,-128 187,-128 187,-128 28,-128 28,-128 22,-128 16,-122 16,-116 16,-116 16,-48 16,-48 16,-42 22,-36 28,-36"/>
<text text-anchor="middle" x="107.5" y="-112.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">Task</text>
<polyline fill="none" stroke="#60b5ac" points="16,-105 199,-105 "/>
<text text-anchor="start" x="24" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(super) cid: u64,</text>
<polyline fill="none" stroke="#60b5ac" points="16,-82 199,-82 "/>
<text text-anchor="start" x="24" y="-66.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(super) cmd: Command,</text>
<polyline fill="none" stroke="#60b5ac" points="16,-59 199,-59 "/>
<text text-anchor="start" x="24" y="-43.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">pub(super) extra_op: ExtraOp,</text>
</g>
<!-- Task&#45;&gt;execute -->
<g id="edge1" class="edge">
<title>Task&#45;&gt;execute</title>
<path fill="none" stroke="#666666" d="M199.12,-82C207.59,-82 216.24,-82 224.86,-82"/>
<polygon fill="#666666" stroke="#666666" points="224.96,-85.5 234.96,-82 224.96,-78.5 224.96,-85.5"/>
</g>
<!-- finish_with_err -->
<g id="node5" class="node">
<title>finish_with_err</title>
<path fill="none" stroke="#1c2123" d="M898,-16.5C898,-16.5 1079,-16.5 1079,-16.5 1085,-16.5 1091,-22.5 1091,-28.5 1091,-28.5 1091,-65.5 1091,-65.5 1091,-71.5 1085,-77.5 1079,-77.5 1079,-77.5 898,-77.5 898,-77.5 892,-77.5 886,-71.5 886,-65.5 886,-65.5 886,-28.5 886,-28.5 886,-22.5 892,-16.5 898,-16.5"/>
<text text-anchor="middle" x="988.5" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">finish_with_err</text>
<polyline fill="none" stroke="#1c2123" points="886,-54.5 1091,-54.5 "/>
<text text-anchor="start" x="894" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果async_snapshot 返回了错误</text>
<text text-anchor="middle" x="988.5" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用finish_with_err;</text>
</g>
<!-- async_snapshot&#45;&gt;finish_with_err -->
<g id="edge6" class="edge">
<title>async_snapshot&#45;&gt;finish_with_err</title>
<path fill="none" stroke="#666666" d="M579.03,-83.5C583.75,-80.3 588.48,-77.09 593,-74 609.08,-63.01 610.43,-54.87 629,-49 708.77,-23.77 803.62,-24.49 875.71,-30.86"/>
<polygon fill="#666666" stroke="#666666" points="875.45,-34.35 885.73,-31.79 876.1,-27.38 875.45,-34.35"/>
</g>
<!-- cb -->
<g id="node8" class="node">
<title>cb</title>
<path fill="none" stroke="#1c2123" d="M641,-58.5C641,-58.5 838,-58.5 838,-58.5 844,-58.5 850,-64.5 850,-70.5 850,-70.5 850,-183.5 850,-183.5 850,-189.5 844,-195.5 838,-195.5 838,-195.5 641,-195.5 641,-195.5 635,-195.5 629,-189.5 629,-183.5 629,-183.5 629,-70.5 629,-70.5 629,-64.5 635,-58.5 641,-58.5"/>
<text text-anchor="middle" x="739.5" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cb</text>
<polyline fill="none" stroke="#1c2123" points="629,-172.5 850,-172.5 "/>
<text text-anchor="start" x="637" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_snapshot的回调</text>
<text text-anchor="start" x="637" y="-142.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果获得了snapshot</text>
<text text-anchor="start" x="637" y="-127.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则调用process_by_worker</text>
<polyline fill="none" stroke="#1c2123" points="629,-119.5 850,-119.5 "/>
<text text-anchor="start" x="637" y="-104.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果返回了错误，</text>
<text text-anchor="start" x="637" y="-89.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在sched_pool中调用finish_with_err</text>
<polyline fill="none" stroke="#1c2123" points="629,-81.5 850,-81.5 "/>
<text text-anchor="middle" x="739.5" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
</g>
<!-- async_snapshot&#45;&gt;cb -->
<g id="edge7" class="edge">
<title>async_snapshot&#45;&gt;cb</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M593.07,-117.78C601.32,-118.3 610.01,-118.85 618.89,-119.41"/>
<polygon fill="green" stroke="green" points="618.77,-122.91 628.97,-120.05 619.21,-115.93 618.77,-122.91"/>
</g>
<!-- cb_execute -->
<g id="node6" class="node">
<title>cb_execute</title>
<path fill="none" stroke="#1c2123" d="M1139,-16.5C1139,-16.5 1252,-16.5 1252,-16.5 1258,-16.5 1264,-22.5 1264,-28.5 1264,-28.5 1264,-65.5 1264,-65.5 1264,-71.5 1258,-77.5 1252,-77.5 1252,-77.5 1139,-77.5 1139,-77.5 1133,-77.5 1127,-71.5 1127,-65.5 1127,-65.5 1127,-28.5 1127,-28.5 1127,-22.5 1133,-16.5 1139,-16.5"/>
<text text-anchor="middle" x="1195.5" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cb_execute</text>
<polyline fill="none" stroke="#1c2123" points="1127,-54.5 1264,-54.5 "/>
<text text-anchor="start" x="1135" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用callbac参数为</text>
<text text-anchor="start" x="1135" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ProcessResult::Failed</text>
</g>
<!-- finish_with_err&#45;&gt;cb_execute -->
<g id="edge4" class="edge">
<title>finish_with_err&#45;&gt;cb_execute</title>
<path fill="none" stroke="#666666" d="M1091.1,-47C1099.69,-47 1108.29,-47 1116.65,-47"/>
<polygon fill="#666666" stroke="#666666" points="1116.72,-50.5 1126.72,-47 1116.72,-43.5 1116.72,-50.5"/>
</g>
<!-- release_lock -->
<g id="node7" class="node">
<title>release_lock</title>
<path fill="none" stroke="#1c2123" d="M1225.5,-132C1225.5,-132 1165.5,-132 1165.5,-132 1159.5,-132 1153.5,-126 1153.5,-120 1153.5,-120 1153.5,-108 1153.5,-108 1153.5,-102 1159.5,-96 1165.5,-96 1165.5,-96 1225.5,-96 1225.5,-96 1231.5,-96 1237.5,-102 1237.5,-108 1237.5,-108 1237.5,-120 1237.5,-120 1237.5,-126 1231.5,-132 1225.5,-132"/>
<text text-anchor="middle" x="1195.5" y="-110.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">release_lock</text>
</g>
<!-- finish_with_err&#45;&gt;release_lock -->
<g id="edge5" class="edge">
<title>finish_with_err&#45;&gt;release_lock</title>
<path fill="none" stroke="#666666" d="M1083,-77.56C1103.95,-84.4 1125.4,-91.42 1143.82,-97.44"/>
<polygon fill="#666666" stroke="#666666" points="1142.84,-100.8 1153.44,-100.58 1145.02,-94.15 1142.84,-100.8"/>
</g>
<!-- cb&#45;&gt;finish_with_err -->
<g id="edge8" class="edge">
<title>cb&#45;&gt;finish_with_err</title>
<path fill="none" stroke="#666666" d="M850.28,-91.44C861.34,-87.86 872.55,-84.23 883.55,-80.67"/>
<polygon fill="#666666" stroke="#666666" points="884.71,-83.97 893.15,-77.56 882.55,-77.31 884.71,-83.97"/>
</g>
<!-- process_by_worker -->
<g id="node9" class="node">
<title>process_by_worker</title>
<path fill="none" stroke="#1c2123" d="M905,-96.5C905,-96.5 1072,-96.5 1072,-96.5 1078,-96.5 1084,-102.5 1084,-108.5 1084,-108.5 1084,-183.5 1084,-183.5 1084,-189.5 1078,-195.5 1072,-195.5 1072,-195.5 905,-195.5 905,-195.5 899,-195.5 893,-189.5 893,-183.5 893,-183.5 893,-108.5 893,-108.5 893,-102.5 899,-96.5 905,-96.5"/>
<text text-anchor="middle" x="988.5" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_by_worker</text>
<polyline fill="none" stroke="#1c2123" points="893,-172.5 1084,-172.5 "/>
<text text-anchor="start" x="901" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Delivers a command </text>
<text text-anchor="start" x="901" y="-142.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> to worker thread for processing</text>
<polyline fill="none" stroke="#1c2123" points="893,-134.5 1084,-134.5 "/>
<text text-anchor="start" x="901" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在线程池执行cmd</text>
<text text-anchor="start" x="901" y="-104.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> cmd会使用snapshot</text>
</g>
<!-- cb&#45;&gt;process_by_worker -->
<g id="edge9" class="edge">
<title>cb&#45;&gt;process_by_worker</title>
<path fill="none" stroke="#666666" d="M850.28,-135.44C861.02,-136.27 871.9,-137.11 882.59,-137.93"/>
<polygon fill="#666666" stroke="#666666" points="882.53,-141.44 892.77,-138.71 883.07,-134.46 882.53,-141.44"/>
</g>
</g>
</svg>
