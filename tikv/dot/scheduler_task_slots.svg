<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: task_slots Pages: 1 -->
<svg width="1228pt" height="290pt"
 viewBox="0.00 0.00 1228.00 289.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 285.5)">
<title>task_slots</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-285.5 1224,-285.5 1224,4 -4,4"/>
<!-- SchedulerInner_task_slots -->
<g id="node1" class="node">
<title>SchedulerInner_task_slots</title>
<path fill="none" stroke="#f7e495" d="M549.5,-163.5C549.5,-163.5 685.5,-163.5 685.5,-163.5 691.5,-163.5 697.5,-169.5 697.5,-175.5 697.5,-175.5 697.5,-197.5 697.5,-197.5 697.5,-203.5 691.5,-209.5 685.5,-209.5 685.5,-209.5 549.5,-209.5 549.5,-209.5 543.5,-209.5 537.5,-203.5 537.5,-197.5 537.5,-197.5 537.5,-175.5 537.5,-175.5 537.5,-169.5 543.5,-163.5 549.5,-163.5"/>
<text text-anchor="middle" x="617.5" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#40575d">SchedulerInner::task_slots</text>
<polyline fill="none" stroke="#f7e495" points="537.5,-186.5 697.5,-186.5 "/>
<text text-anchor="start" x="545.5" y="-171.3" font-family="Times,serif" font-size="14.00" fill="#40575d">获取cid对应的task_slots</text>
</g>
<!-- TaskContext -->
<g id="node2" class="node">
<title>TaskContext</title>
<path fill="none" stroke="#1c2123" d="M816.5,-74C816.5,-74 976.5,-74 976.5,-74 982.5,-74 988.5,-80 988.5,-86 988.5,-86 988.5,-269 988.5,-269 988.5,-275 982.5,-281 976.5,-281 976.5,-281 816.5,-281 816.5,-281 810.5,-281 804.5,-275 804.5,-269 804.5,-269 804.5,-86 804.5,-86 804.5,-80 810.5,-74 816.5,-74"/>
<text text-anchor="middle" x="896.5" y="-265.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TaskContext</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-258 988.5,-258 "/>
<text text-anchor="start" x="812.5" y="-242.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">task: Option&lt;Task&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-235 988.5,-235 "/>
<text text-anchor="start" x="812.5" y="-219.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock: Lock,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-212 988.5,-212 "/>
<text text-anchor="start" x="812.5" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">cb: Option&lt;StorageCallback&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-189 988.5,-189 "/>
<text text-anchor="start" x="812.5" y="-173.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pr: Option&lt;ProcessResult&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-166 988.5,-166 "/>
<text text-anchor="start" x="812.5" y="-150.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_bytes: usize,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-143 988.5,-143 "/>
<text text-anchor="start" x="812.5" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">tag: metrics::CommandKind,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-120 988.5,-120 "/>
<text text-anchor="start" x="812.5" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">latch_timer: Instant,</text>
<polyline fill="none" stroke="#1c2123" points="804.5,-97 988.5,-97 "/>
<text text-anchor="start" x="812.5" y="-81.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">_cmd_timer: CmdTimer,</text>
</g>
<!-- SchedulerInner_task_slots&#45;&gt;TaskContext -->
<g id="edge1" class="edge">
<title>SchedulerInner_task_slots&#45;&gt;TaskContext</title>
<path fill="none" stroke="#666666" d="M697.51,-183.93C727.52,-182.96 762.13,-181.83 793.94,-180.8"/>
<polygon fill="#666666" stroke="#666666" points="794.28,-184.29 804.16,-180.47 794.06,-177.29 794.28,-184.29"/>
</g>
<!-- Task -->
<g id="node3" class="node">
<title>Task</title>
<path fill="none" stroke="#1c2123" d="M1049,-131.5C1049,-131.5 1208,-131.5 1208,-131.5 1214,-131.5 1220,-137.5 1220,-143.5 1220,-143.5 1220,-211.5 1220,-211.5 1220,-217.5 1214,-223.5 1208,-223.5 1208,-223.5 1049,-223.5 1049,-223.5 1043,-223.5 1037,-217.5 1037,-211.5 1037,-211.5 1037,-143.5 1037,-143.5 1037,-137.5 1043,-131.5 1049,-131.5"/>
<text text-anchor="middle" x="1128.5" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Task</text>
<polyline fill="none" stroke="#1c2123" points="1037,-200.5 1220,-200.5 "/>
<text text-anchor="start" x="1045" y="-185.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub(super) cid: u64,</text>
<polyline fill="none" stroke="#1c2123" points="1037,-177.5 1220,-177.5 "/>
<text text-anchor="start" x="1045" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub(super) cmd: Command,</text>
<polyline fill="none" stroke="#1c2123" points="1037,-154.5 1220,-154.5 "/>
<text text-anchor="start" x="1045" y="-139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub(super) extra_op: ExtraOp,</text>
</g>
<!-- TaskContext&#45;&gt;Task -->
<g id="edge2" class="edge">
<title>TaskContext&#45;&gt;Task</title>
<path fill="none" stroke="#666666" d="M988.73,-177.5C1001.2,-177.5 1014.06,-177.5 1026.69,-177.5"/>
<polygon fill="#666666" stroke="#666666" points="1026.75,-181 1036.75,-177.5 1026.75,-174 1026.75,-181"/>
</g>
<!-- SchedulerInner_get_task_slot -->
<g id="node4" class="node">
<title>SchedulerInner_get_task_slot</title>
<path fill="none" stroke="#1c2123" d="M417.5,-204.5C417.5,-204.5 264.5,-204.5 264.5,-204.5 258.5,-204.5 252.5,-198.5 252.5,-192.5 252.5,-192.5 252.5,-180.5 252.5,-180.5 252.5,-174.5 258.5,-168.5 264.5,-168.5 264.5,-168.5 417.5,-168.5 417.5,-168.5 423.5,-168.5 429.5,-174.5 429.5,-180.5 429.5,-180.5 429.5,-192.5 429.5,-192.5 429.5,-198.5 423.5,-204.5 417.5,-204.5"/>
<text text-anchor="middle" x="341" y="-182.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SchedulerInner_get_task_slot</text>
</g>
<!-- SchedulerInner_get_task_slot&#45;&gt;SchedulerInner_task_slots -->
<g id="edge3" class="edge">
<title>SchedulerInner_get_task_slot&#45;&gt;SchedulerInner_task_slots</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M429.61,-186.5C460.76,-186.5 495.85,-186.5 527.14,-186.5"/>
<polygon fill="green" stroke="green" points="527.16,-190 537.16,-186.5 527.16,-183 527.16,-190"/>
</g>
<!-- id_index -->
<g id="node5" class="node">
<title>id_index</title>
<path fill="none" stroke="#1c2123" d="M491,-75C491,-75 744,-75 744,-75 750,-75 756,-81 756,-87 756,-87 756,-132 756,-132 756,-138 750,-144 744,-144 744,-144 491,-144 491,-144 485,-144 479,-138 479,-132 479,-132 479,-87 479,-87 479,-81 485,-75 491,-75"/>
<text text-anchor="middle" x="617.5" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">id_index</text>
<polyline fill="none" stroke="#1c2123" points="479,-121 756,-121 "/>
<text text-anchor="start" x="487" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">cid as usize % TASKS_SLOTS_NUM</text>
<polyline fill="none" stroke="#1c2123" points="479,-98 756,-98 "/>
<text text-anchor="start" x="487" y="-82.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">const TASKS_SLOTS_NUM: usize = 1 &lt;&lt; 12;</text>
</g>
<!-- SchedulerInner_get_task_slot&#45;&gt;id_index -->
<g id="edge4" class="edge">
<title>SchedulerInner_get_task_slot&#45;&gt;id_index</title>
<path fill="none" stroke="#666666" d="M407.21,-168.47C419.12,-165.16 431.43,-161.74 443,-158.5 456.47,-154.73 470.52,-150.78 484.55,-146.84"/>
<polygon fill="#666666" stroke="#666666" points="485.57,-150.19 494.24,-144.11 483.67,-143.45 485.57,-150.19"/>
</g>
<!-- Scheduler_schedule_command -->
<g id="node6" class="node">
<title>Scheduler_schedule_command</title>
<path fill="none" stroke="#1c2123" d="M12,-35.5C12,-35.5 191,-35.5 191,-35.5 197,-35.5 203,-41.5 203,-47.5 203,-47.5 203,-167.5 203,-167.5 203,-173.5 197,-179.5 191,-179.5 191,-179.5 12,-179.5 12,-179.5 6,-179.5 0,-173.5 0,-167.5 0,-167.5 0,-47.5 0,-47.5 0,-41.5 6,-35.5 12,-35.5"/>
<text text-anchor="middle" x="101.5" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Scheduler::schedule_command</text>
<polyline fill="none" stroke="#1c2123" points="0,-156.5 203,-156.5 "/>
<text text-anchor="start" x="8" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">(cmd, callback)</text>
<text text-anchor="start" x="8" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> callback为执行完cmd后的回调</text>
<polyline fill="none" stroke="#1c2123" points="0,-118.5 203,-118.5 "/>
<text text-anchor="start" x="8" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">1.生成新的cid</text>
<text text-anchor="start" x="8" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.创建新的task_context</text>
<text text-anchor="start" x="8" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并插入到task_slots中</text>
<text text-anchor="start" x="8" y="-58.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 3.获取latches</text>
<text text-anchor="start" x="8" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 4.执行task</text>
</g>
<!-- Scheduler_schedule_command&#45;&gt;SchedulerInner_get_task_slot -->
<g id="edge5" class="edge">
<title>Scheduler_schedule_command&#45;&gt;SchedulerInner_get_task_slot</title>
<path fill="none" stroke="#666666" d="M203.16,-146.23C215.18,-150.53 227.33,-154.71 239,-158.5 246.42,-160.91 254.19,-163.3 261.99,-165.61"/>
<polygon fill="#666666" stroke="#666666" points="261.27,-169.04 271.85,-168.48 263.23,-162.32 261.27,-169.04"/>
</g>
<!-- SchedulerInner_gen_id -->
<g id="node7" class="node">
<title>SchedulerInner_gen_id</title>
<path fill="none" stroke="#1c2123" d="M281.5,-65.5C281.5,-65.5 400.5,-65.5 400.5,-65.5 406.5,-65.5 412.5,-71.5 412.5,-77.5 412.5,-77.5 412.5,-137.5 412.5,-137.5 412.5,-143.5 406.5,-149.5 400.5,-149.5 400.5,-149.5 281.5,-149.5 281.5,-149.5 275.5,-149.5 269.5,-143.5 269.5,-137.5 269.5,-137.5 269.5,-77.5 269.5,-77.5 269.5,-71.5 275.5,-65.5 281.5,-65.5"/>
<text text-anchor="middle" x="341" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SchedulerInner::gen_id</text>
<polyline fill="none" stroke="#1c2123" points="269.5,-126.5 412.5,-126.5 "/>
<text text-anchor="start" x="277.5" y="-111.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成cmd唯一的id</text>
<polyline fill="none" stroke="#1c2123" points="269.5,-103.5 412.5,-103.5 "/>
<text text-anchor="start" x="277.5" y="-88.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">由atomic id_alloc</text>
<text text-anchor="start" x="277.5" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 单调递增生成</text>
</g>
<!-- Scheduler_schedule_command&#45;&gt;SchedulerInner_gen_id -->
<g id="edge6" class="edge">
<title>Scheduler_schedule_command&#45;&gt;SchedulerInner_gen_id</title>
<path fill="none" stroke="#666666" d="M203.22,-107.5C221.91,-107.5 241.21,-107.5 259.2,-107.5"/>
<polygon fill="#666666" stroke="#666666" points="259.35,-111 269.35,-107.5 259.35,-104 259.35,-111"/>
</g>
<!-- SchedulerInner_new_task_context -->
<g id="node8" class="node">
<title>SchedulerInner_new_task_context</title>
<path fill="none" stroke="#1c2123" d="M251,-0.5C251,-0.5 431,-0.5 431,-0.5 437,-0.5 443,-6.5 443,-12.5 443,-12.5 443,-34.5 443,-34.5 443,-40.5 437,-46.5 431,-46.5 431,-46.5 251,-46.5 251,-46.5 245,-46.5 239,-40.5 239,-34.5 239,-34.5 239,-12.5 239,-12.5 239,-6.5 245,-0.5 251,-0.5"/>
<text text-anchor="middle" x="341" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SchedulerInner::new_task_context</text>
<polyline fill="none" stroke="#1c2123" points="239,-23.5 443,-23.5 "/>
<text text-anchor="start" x="247" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">(Task::new(cid, cmd), callback)</text>
</g>
<!-- Scheduler_schedule_command&#45;&gt;SchedulerInner_new_task_context -->
<g id="edge7" class="edge">
<title>Scheduler_schedule_command&#45;&gt;SchedulerInner_new_task_context</title>
<path fill="none" stroke="#666666" d="M203.27,-68.37C215.27,-63.93 227.39,-59.55 239,-55.5 244.51,-53.58 250.2,-51.64 255.95,-49.73"/>
<polygon fill="#666666" stroke="#666666" points="257.25,-52.98 265.65,-46.52 255.06,-46.34 257.25,-52.98"/>
</g>
<!-- TaskContext_new -->
<g id="node9" class="node">
<title>TaskContext_new</title>
<path fill="none" stroke="#1c2123" d="M571.5,-12.5C571.5,-12.5 663.5,-12.5 663.5,-12.5 669.5,-12.5 675.5,-18.5 675.5,-24.5 675.5,-24.5 675.5,-36.5 675.5,-36.5 675.5,-42.5 669.5,-48.5 663.5,-48.5 663.5,-48.5 571.5,-48.5 571.5,-48.5 565.5,-48.5 559.5,-42.5 559.5,-36.5 559.5,-36.5 559.5,-24.5 559.5,-24.5 559.5,-18.5 565.5,-12.5 571.5,-12.5"/>
<text text-anchor="middle" x="617.5" y="-26.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TaskContext::new</text>
</g>
<!-- SchedulerInner_new_task_context&#45;&gt;TaskContext_new -->
<g id="edge8" class="edge">
<title>SchedulerInner_new_task_context&#45;&gt;TaskContext_new</title>
<path fill="none" stroke="#666666" d="M443.04,-26.08C478.36,-26.98 517.11,-27.97 549.02,-28.78"/>
<polygon fill="#666666" stroke="#666666" points="549.04,-32.28 559.12,-29.04 549.22,-25.28 549.04,-32.28"/>
</g>
<!-- TaskContext_new&#45;&gt;TaskContext -->
<g id="edge9" class="edge">
<title>TaskContext_new&#45;&gt;TaskContext</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M675.63,-39.36C701.12,-44.72 730.98,-53.02 756,-65.5 769.56,-72.27 783.03,-80.53 795.93,-89.46"/>
<polygon fill="green" stroke="green" points="794.15,-92.49 804.33,-95.42 798.2,-86.78 794.15,-92.49"/>
</g>
<!-- Command_gen_lock -->
<g id="node10" class="node">
<title>Command_gen_lock</title>
<path fill="none" stroke="#1c2123" d="M804,-7.5C804,-7.5 989,-7.5 989,-7.5 995,-7.5 1001,-13.5 1001,-19.5 1001,-19.5 1001,-41.5 1001,-41.5 1001,-47.5 995,-53.5 989,-53.5 989,-53.5 804,-53.5 804,-53.5 798,-53.5 792,-47.5 792,-41.5 792,-41.5 792,-19.5 792,-19.5 792,-13.5 798,-7.5 804,-7.5"/>
<text text-anchor="middle" x="896.5" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Command::gen_lock</text>
<polyline fill="none" stroke="#1c2123" points="792,-30.5 1001,-30.5 "/>
<text text-anchor="start" x="800" y="-15.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成command需要的Latch::Lock</text>
</g>
<!-- TaskContext_new&#45;&gt;Command_gen_lock -->
<g id="edge10" class="edge">
<title>TaskContext_new&#45;&gt;Command_gen_lock</title>
<path fill="none" stroke="#666666" d="M675.56,-30.5C706.18,-30.5 745.03,-30.5 781.53,-30.5"/>
<polygon fill="#666666" stroke="#666666" points="781.76,-34 791.76,-30.5 781.76,-27 781.76,-34"/>
</g>
</g>
</svg>
