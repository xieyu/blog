<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: send_snap Pages: 1 -->
<svg width="1761pt" height="620pt"
 viewBox="0.00 0.00 1761.00 620.22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 616.22)">
<title>send_snap</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-616.22 1757,-616.22 1757,4 -4,4"/>
<!-- send_snap -->
<g id="node1" class="node">
<title>send_snap</title>
<path fill="none" stroke="#1c2123" d="M12,-301.75C12,-301.75 101,-301.75 101,-301.75 107,-301.75 113,-307.75 113,-313.75 113,-313.75 113,-350.75 113,-350.75 113,-356.75 107,-362.75 101,-362.75 101,-362.75 12,-362.75 12,-362.75 6,-362.75 0,-356.75 0,-350.75 0,-350.75 0,-313.75 0,-313.75 0,-307.75 6,-301.75 12,-301.75"/>
<text text-anchor="middle" x="56.5" y="-347.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">send_snap</text>
<polyline fill="none" stroke="#1c2123" points="0,-339.75 113,-339.75 "/>
<text text-anchor="start" x="8" y="-324.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成发送snap的</text>
<text text-anchor="start" x="8" y="-309.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> async task</text>
</g>
<!-- RaftMessage_get_message_get_snapshot -->
<g id="node2" class="node">
<title>RaftMessage_get_message_get_snapshot</title>
<path fill="none" stroke="#1c2123" d="M200.5,-506.75C200.5,-506.75 271.5,-506.75 271.5,-506.75 277.5,-506.75 283.5,-512.75 283.5,-518.75 283.5,-518.75 283.5,-547.75 283.5,-547.75 283.5,-553.75 277.5,-559.75 271.5,-559.75 271.5,-559.75 200.5,-559.75 200.5,-559.75 194.5,-559.75 188.5,-553.75 188.5,-547.75 188.5,-547.75 188.5,-518.75 188.5,-518.75 188.5,-512.75 194.5,-506.75 200.5,-506.75"/>
<text text-anchor="start" x="196.5" y="-544.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftMessage</text>
<text text-anchor="start" x="196.5" y="-529.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .get_message</text>
<text text-anchor="start" x="196.5" y="-514.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .get_snapshot</text>
</g>
<!-- send_snap&#45;&gt;RaftMessage_get_message_get_snapshot -->
<g id="edge1" class="edge">
<title>send_snap&#45;&gt;RaftMessage_get_message_get_snapshot</title>
<path fill="none" stroke="#666666" d="M68.88,-362.8C83.09,-397.45 110.32,-453.87 149,-490.25 157.74,-498.47 168.35,-505.46 179.09,-511.27"/>
<polygon fill="#666666" stroke="#666666" points="177.61,-514.44 188.11,-515.87 180.79,-508.21 177.61,-514.44"/>
</g>
<!-- SnapKey_from_snap -->
<g id="node3" class="node">
<title>SnapKey_from_snap</title>
<path fill="none" stroke="#1c2123" d="M602,-470.75C602,-470.75 675,-470.75 675,-470.75 681,-470.75 687,-476.75 687,-482.75 687,-482.75 687,-549.75 687,-549.75 687,-555.75 681,-561.75 675,-561.75 675,-561.75 602,-561.75 602,-561.75 596,-561.75 590,-555.75 590,-549.75 590,-549.75 590,-482.75 590,-482.75 590,-476.75 596,-470.75 602,-470.75"/>
<text text-anchor="start" x="598" y="-546.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapKey</text>
<text text-anchor="start" x="598" y="-531.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> ::from_snap</text>
<polyline fill="none" stroke="#1c2123" points="590,-523.75 687,-523.75 "/>
<text text-anchor="start" x="598" y="-508.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用region_id</text>
<text text-anchor="start" x="598" y="-493.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> term, index</text>
<text text-anchor="start" x="598" y="-478.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 作为key</text>
</g>
<!-- send_snap&#45;&gt;SnapKey_from_snap -->
<g id="edge2" class="edge">
<title>send_snap&#45;&gt;SnapKey_from_snap</title>
<path fill="none" stroke="#666666" d="M71.78,-362.82C86.76,-391.14 113.12,-431.86 149,-452.25 295.25,-535.33 358.67,-470.24 525,-495.25 542.82,-497.92 562.14,-501.34 579.65,-504.64"/>
<polygon fill="#666666" stroke="#666666" points="579.25,-508.12 589.73,-506.56 580.56,-501.25 579.25,-508.12"/>
</g>
<!-- SnapManager_register_SnapEntry_Sending -->
<g id="node4" class="node">
<title>SnapManager_register_SnapEntry_Sending</title>
<path fill="none" stroke="#1c2123" d="M969,-531.75C969,-531.75 1161,-531.75 1161,-531.75 1167,-531.75 1173,-537.75 1173,-543.75 1173,-543.75 1173,-580.75 1173,-580.75 1173,-586.75 1167,-592.75 1161,-592.75 1161,-592.75 969,-592.75 969,-592.75 963,-592.75 957,-586.75 957,-580.75 957,-580.75 957,-543.75 957,-543.75 957,-537.75 963,-531.75 969,-531.75"/>
<text text-anchor="start" x="965" y="-577.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManager</text>
<text text-anchor="start" x="965" y="-562.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> register(&amp;key, SnapEntry::Sending)</text>
<polyline fill="none" stroke="#1c2123" points="957,-554.75 1173,-554.75 "/>
<text text-anchor="start" x="965" y="-539.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">注册Snapkey对应状态为Sending</text>
</g>
<!-- send_snap&#45;&gt;SnapManager_register_SnapEntry_Sending -->
<g id="edge3" class="edge">
<title>send_snap&#45;&gt;SnapManager_register_SnapEntry_Sending</title>
<path fill="none" stroke="#666666" d="M59.4,-362.99C64.42,-414.99 82.68,-519.47 149,-569.25 253.17,-647.44 310.75,-594.25 441,-594.25 441,-594.25 441,-594.25 639.5,-594.25 743.65,-594.25 861.77,-584.55 946.92,-575.83"/>
<polygon fill="#666666" stroke="#666666" points="947.29,-579.31 956.87,-574.8 946.57,-572.35 947.29,-579.31"/>
</g>
<!-- SnapManager_get_snapshot_for_sending -->
<g id="node5" class="node">
<title>SnapManager_get_snapshot_for_sending</title>
<path fill="none" stroke="#1c2123" d="M996,-402.25C996,-402.25 1134,-402.25 1134,-402.25 1140,-402.25 1146,-408.25 1146,-414.25 1146,-414.25 1146,-466.25 1146,-466.25 1146,-472.25 1140,-478.25 1134,-478.25 1134,-478.25 996,-478.25 996,-478.25 990,-478.25 984,-472.25 984,-466.25 984,-466.25 984,-414.25 984,-414.25 984,-408.25 990,-402.25 996,-402.25"/>
<text text-anchor="start" x="992" y="-463.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManager</text>
<text text-anchor="middle" x="1065" y="-448.05" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_snapshot_for_sending</text>
<polyline fill="none" stroke="#1c2123" points="984,-440.25 1146,-440.25 "/>
<text text-anchor="start" x="992" y="-425.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据SnapKey</text>
<text text-anchor="start" x="992" y="-410.05" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取要发送的snapshot</text>
</g>
<!-- send_snap&#45;&gt;SnapManager_get_snapshot_for_sending -->
<g id="edge4" class="edge">
<title>send_snap&#45;&gt;SnapManager_get_snapshot_for_sending</title>
<path fill="none" stroke="#666666" d="M105.5,-362.8C119.14,-370.42 134.29,-377.92 149,-383.25 273.17,-428.2 308.94,-438.25 441,-438.25 441,-438.25 441,-438.25 639.5,-438.25 754.76,-438.25 887.62,-438.99 973.56,-439.57"/>
<polygon fill="#666666" stroke="#666666" points="973.78,-443.07 983.8,-439.64 973.83,-436.07 973.78,-443.07"/>
</g>
<!-- SecurityManager_connect -->
<g id="node6" class="node">
<title>SecurityManager_connect</title>
<path fill="none" stroke="#1c2123" d="M161,-272.75C161,-272.75 311,-272.75 311,-272.75 317,-272.75 323,-278.75 323,-284.75 323,-284.75 323,-321.75 323,-321.75 323,-327.75 317,-333.75 311,-333.75 311,-333.75 161,-333.75 161,-333.75 155,-333.75 149,-327.75 149,-321.75 149,-321.75 149,-284.75 149,-284.75 149,-278.75 155,-272.75 161,-272.75"/>
<text text-anchor="middle" x="236" y="-318.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">1. SecurityManager::connect</text>
<polyline fill="none" stroke="#1c2123" points="149,-310.75 323,-310.75 "/>
<text text-anchor="start" x="157" y="-295.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">建立和store addr</text>
<text text-anchor="start" x="157" y="-280.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的Gpc连接</text>
</g>
<!-- send_snap&#45;&gt;SecurityManager_connect -->
<g id="edge5" class="edge">
<title>send_snap&#45;&gt;SecurityManager_connect</title>
<path fill="none" stroke="#666666" d="M113.18,-323.15C121.45,-321.8 130.17,-320.37 138.99,-318.93"/>
<polygon fill="#666666" stroke="#666666" points="139.66,-322.37 148.96,-317.3 138.53,-315.46 139.66,-322.37"/>
</g>
<!-- TikvClient_snapshot -->
<g id="node7" class="node">
<title>TikvClient_snapshot</title>
<path fill="none" stroke="#1c2123" d="M371,-273.25C371,-273.25 513,-273.25 513,-273.25 519,-273.25 525,-279.25 525,-285.25 525,-285.25 525,-337.25 525,-337.25 525,-343.25 519,-349.25 513,-349.25 513,-349.25 371,-349.25 371,-349.25 365,-349.25 359,-343.25 359,-337.25 359,-337.25 359,-285.25 359,-285.25 359,-279.25 365,-273.25 371,-273.25"/>
<text text-anchor="start" x="367" y="-334.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">2. TikvClient</text>
<text text-anchor="start" x="367" y="-319.05" font-family="Times,serif" font-size="14.00" fill="#2f3638"> snapshot</text>
<polyline fill="none" stroke="#1c2123" points="359,-311.25 525,-311.25 "/>
<text text-anchor="start" x="367" y="-296.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用grpc的snapshot接口</text>
<text text-anchor="start" x="367" y="-281.05" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取接口的sink和reciver</text>
</g>
<!-- send_snap&#45;&gt;TikvClient_snapshot -->
<g id="edge6" class="edge">
<title>send_snap&#45;&gt;TikvClient_snapshot</title>
<path fill="none" stroke="#666666" d="M113.05,-340C124.89,-341.35 137.34,-342.55 149,-343.25 226.19,-347.87 246.34,-353.46 323,-343.25 331.48,-342.12 340.22,-340.55 348.93,-338.71"/>
<polygon fill="#666666" stroke="#666666" points="349.72,-342.12 358.72,-336.52 348.2,-335.28 349.72,-342.12"/>
</g>
<!-- Sink_send_all_await -->
<g id="node8" class="node">
<title>Sink_send_all_await</title>
<path fill="none" stroke="#1c2123" d="M1616,-285.25C1616,-285.25 1741,-285.25 1741,-285.25 1747,-285.25 1753,-291.25 1753,-297.25 1753,-297.25 1753,-319.25 1753,-319.25 1753,-325.25 1747,-331.25 1741,-331.25 1741,-331.25 1616,-331.25 1616,-331.25 1610,-331.25 1604,-325.25 1604,-319.25 1604,-319.25 1604,-297.25 1604,-297.25 1604,-291.25 1610,-285.25 1616,-285.25"/>
<text text-anchor="middle" x="1678.5" y="-316.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">3. Sink.send_all.await?</text>
<polyline fill="none" stroke="#1c2123" points="1604,-308.25 1753,-308.25 "/>
<text text-anchor="middle" x="1678.5" y="-293.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用sink发送snap数据</text>
</g>
<!-- send_snap&#45;&gt;Sink_send_all_await -->
<g id="edge7" class="edge">
<title>send_snap&#45;&gt;Sink_send_all_await</title>
<path fill="none" stroke="#666666" d="M88.58,-301.55C105.11,-287.24 126.62,-271.56 149,-263.25 270.92,-217.97 310.95,-244.25 441,-244.25 441,-244.25 441,-244.25 1286,-244.25 1393.33,-244.25 1515.06,-267.96 1593.89,-286.52"/>
<polygon fill="#666666" stroke="#666666" points="1593.22,-289.96 1603.76,-288.87 1594.84,-283.15 1593.22,-289.96"/>
</g>
<!-- Sink_close_await -->
<g id="node9" class="node">
<title>Sink_close_await</title>
<path fill="none" stroke="#1c2123" d="M587,-341.75C587,-341.75 690,-341.75 690,-341.75 696,-341.75 702,-347.75 702,-353.75 702,-353.75 702,-390.75 702,-390.75 702,-396.75 696,-402.75 690,-402.75 690,-402.75 587,-402.75 587,-402.75 581,-402.75 575,-396.75 575,-390.75 575,-390.75 575,-353.75 575,-353.75 575,-347.75 581,-341.75 587,-341.75"/>
<text text-anchor="middle" x="638.5" y="-387.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">4.Sink.close.await</text>
<polyline fill="none" stroke="#1c2123" points="575,-379.75 702,-379.75 "/>
<text text-anchor="start" x="583" y="-364.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap数据发送完毕</text>
<text text-anchor="start" x="583" y="-349.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 关闭sink</text>
</g>
<!-- send_snap&#45;&gt;Sink_close_await -->
<g id="edge8" class="edge">
<title>send_snap&#45;&gt;Sink_close_await</title>
<path fill="none" stroke="#666666" d="M113.06,-351.88C124.79,-355.28 137.19,-358.33 149,-360.25 295.04,-383.93 468.81,-380.91 564.75,-376.58"/>
<polygon fill="#666666" stroke="#666666" points="565.1,-380.07 574.92,-376.11 564.77,-373.08 565.1,-380.07"/>
</g>
<!-- receiver_await -->
<g id="node10" class="node">
<title>receiver_await</title>
<path fill="none" stroke="#1c2123" d="M573,-131.25C573,-131.25 704,-131.25 704,-131.25 710,-131.25 716,-137.25 716,-143.25 716,-143.25 716,-165.25 716,-165.25 716,-171.25 710,-177.25 704,-177.25 704,-177.25 573,-177.25 573,-177.25 567,-177.25 561,-171.25 561,-165.25 561,-165.25 561,-143.25 561,-143.25 561,-137.25 567,-131.25 573,-131.25"/>
<text text-anchor="middle" x="638.5" y="-162.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">5. receiver.await</text>
<polyline fill="none" stroke="#1c2123" points="561,-154.25 716,-154.25 "/>
<text text-anchor="middle" x="638.5" y="-139.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">等待grpc服务返回结果</text>
</g>
<!-- send_snap&#45;&gt;receiver_await -->
<g id="edge9" class="edge">
<title>send_snap&#45;&gt;receiver_await</title>
<path fill="none" stroke="#666666" d="M68.1,-301.61C81.37,-268.38 107.53,-216.81 149,-192.25 273.13,-118.72 447.2,-125.94 550.55,-139.18"/>
<polygon fill="#666666" stroke="#666666" points="550.26,-142.68 560.64,-140.53 551.18,-135.74 550.26,-142.68"/>
</g>
<!-- drop_TikVClient -->
<g id="node11" class="node">
<title>drop_TikVClient</title>
<path fill="none" stroke="#1c2123" d="M792.5,-169.25C792.5,-169.25 880.5,-169.25 880.5,-169.25 886.5,-169.25 892.5,-175.25 892.5,-181.25 892.5,-181.25 892.5,-203.25 892.5,-203.25 892.5,-209.25 886.5,-215.25 880.5,-215.25 880.5,-215.25 792.5,-215.25 792.5,-215.25 786.5,-215.25 780.5,-209.25 780.5,-203.25 780.5,-203.25 780.5,-181.25 780.5,-181.25 780.5,-175.25 786.5,-169.25 792.5,-169.25"/>
<text text-anchor="middle" x="836.5" y="-200.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">drop(TikVClient)</text>
<polyline fill="none" stroke="#1c2123" points="780.5,-192.25 892.5,-192.25 "/>
<text text-anchor="middle" x="836.5" y="-177.05" font-family="Times,serif" font-size="14.00" fill="#2f3638">释放TikvClient</text>
</g>
<!-- send_snap&#45;&gt;drop_TikVClient -->
<g id="edge10" class="edge">
<title>send_snap&#45;&gt;drop_TikVClient</title>
<path fill="none" stroke="#666666" d="M75.34,-301.72C91.29,-277.62 117.04,-245.58 149,-230.25 257.38,-178.23 620.18,-184.54 769.96,-189.6"/>
<polygon fill="#666666" stroke="#666666" points="770.26,-193.11 780.37,-189.96 770.5,-186.11 770.26,-193.11"/>
</g>
<!-- SnapChunk_Snapshot_delete -->
<g id="node12" class="node">
<title>SnapChunk_Snapshot_delete</title>
<path fill="none" stroke="#1c2123" d="M764,-88.75C764,-88.75 909,-88.75 909,-88.75 915,-88.75 921,-94.75 921,-100.75 921,-100.75 921,-137.75 921,-137.75 921,-143.75 915,-149.75 909,-149.75 909,-149.75 764,-149.75 764,-149.75 758,-149.75 752,-143.75 752,-137.75 752,-137.75 752,-100.75 752,-100.75 752,-94.75 758,-88.75 764,-88.75"/>
<text text-anchor="middle" x="836.5" y="-134.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapChunk.Snapshot.delete</text>
<polyline fill="none" stroke="#1c2123" points="752,-126.75 921,-126.75 "/>
<text text-anchor="start" x="760" y="-111.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">删除已发送的snapshot</text>
<text text-anchor="start" x="760" y="-96.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 本地数据</text>
</g>
<!-- send_snap&#45;&gt;SnapChunk_Snapshot_delete -->
<g id="edge11" class="edge">
<title>send_snap&#45;&gt;SnapChunk_Snapshot_delete</title>
<path fill="none" stroke="#666666" d="M61.62,-301.73C69.55,-256.34 91.56,-172.34 149,-134.25 243.51,-71.56 576.75,-93.77 741.65,-109.31"/>
<polygon fill="#666666" stroke="#666666" points="741.5,-112.81 751.78,-110.27 742.16,-105.84 741.5,-112.81"/>
</g>
<!-- drop_deregister -->
<g id="node13" class="node">
<title>drop_deregister</title>
<path fill="none" stroke="#1c2123" d="M875,-70.25C875,-70.25 798,-70.25 798,-70.25 792,-70.25 786,-64.25 786,-58.25 786,-58.25 786,-46.25 786,-46.25 786,-40.25 792,-34.25 798,-34.25 798,-34.25 875,-34.25 875,-34.25 881,-34.25 887,-40.25 887,-46.25 887,-46.25 887,-58.25 887,-58.25 887,-64.25 881,-70.25 875,-70.25"/>
<text text-anchor="middle" x="836.5" y="-48.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">drop_deregister</text>
</g>
<!-- send_snap&#45;&gt;drop_deregister -->
<g id="edge12" class="edge">
<title>send_snap&#45;&gt;drop_deregister</title>
<path fill="none" stroke="#666666" d="M59.09,-301.35C63.64,-248.57 81.2,-141.93 149,-92.25 340.04,47.74 647.24,-5.21 775.85,-36.14"/>
<polygon fill="#666666" stroke="#666666" points="775.36,-39.62 785.9,-38.6 777.02,-32.82 775.36,-39.62"/>
</g>
<!-- RaftSnapshot -->
<g id="node14" class="node">
<title>RaftSnapshot</title>
<path fill="none" stroke="#1c2123" d="M371.5,-504.75C371.5,-504.75 512.5,-504.75 512.5,-504.75 518.5,-504.75 524.5,-510.75 524.5,-516.75 524.5,-516.75 524.5,-553.75 524.5,-553.75 524.5,-559.75 518.5,-565.75 512.5,-565.75 512.5,-565.75 371.5,-565.75 371.5,-565.75 365.5,-565.75 359.5,-559.75 359.5,-553.75 359.5,-553.75 359.5,-516.75 359.5,-516.75 359.5,-510.75 365.5,-504.75 371.5,-504.75"/>
<text text-anchor="middle" x="442" y="-550.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftSnapshot</text>
<polyline fill="none" stroke="#1c2123" points="359.5,-542.75 524.5,-542.75 "/>
<text text-anchor="start" x="367.5" y="-527.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">只包含一些元信息</text>
<text text-anchor="start" x="367.5" y="-512.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 数据由snapshot mgr管理</text>
</g>
<!-- RaftMessage_get_message_get_snapshot&#45;&gt;RaftSnapshot -->
<g id="edge17" class="edge">
<title>RaftMessage_get_message_get_snapshot&#45;&gt;RaftSnapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M283.55,-533.7C303.11,-533.89 326.59,-534.12 349.37,-534.35"/>
<polygon fill="green" stroke="green" points="349.39,-537.85 359.42,-534.45 349.45,-530.85 349.39,-537.85"/>
</g>
<!-- SnapKey -->
<g id="node16" class="node">
<title>SnapKey</title>
<path fill="#feed9b" stroke="#f7e495" d="M786.5,-470.25C786.5,-470.25 886.5,-470.25 886.5,-470.25 892.5,-470.25 898.5,-476.25 898.5,-482.25 898.5,-482.25 898.5,-550.25 898.5,-550.25 898.5,-556.25 892.5,-562.25 886.5,-562.25 886.5,-562.25 786.5,-562.25 786.5,-562.25 780.5,-562.25 774.5,-556.25 774.5,-550.25 774.5,-550.25 774.5,-482.25 774.5,-482.25 774.5,-476.25 780.5,-470.25 786.5,-470.25"/>
<text text-anchor="middle" x="836.5" y="-547.05" font-family="Times,serif" font-size="14.00" fill="#40575d">SnapKey</text>
<polyline fill="none" stroke="#f7e495" points="774.5,-539.25 898.5,-539.25 "/>
<text text-anchor="start" x="782.5" y="-524.05" font-family="Times,serif" font-size="14.00" fill="#40575d">pub region_id: u64,</text>
<polyline fill="none" stroke="#f7e495" points="774.5,-516.25 898.5,-516.25 "/>
<text text-anchor="start" x="782.5" y="-501.05" font-family="Times,serif" font-size="14.00" fill="#40575d">pub term: u64,</text>
<polyline fill="none" stroke="#f7e495" points="774.5,-493.25 898.5,-493.25 "/>
<text text-anchor="start" x="782.5" y="-478.05" font-family="Times,serif" font-size="14.00" fill="#40575d">pub idx: u64,</text>
</g>
<!-- SnapKey_from_snap&#45;&gt;SnapKey -->
<g id="edge19" class="edge">
<title>SnapKey_from_snap&#45;&gt;SnapKey</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M687.2,-516.25C710.3,-516.25 738.53,-516.25 764.13,-516.25"/>
<polygon fill="green" stroke="green" points="764.17,-519.75 774.17,-516.25 764.17,-512.75 764.17,-519.75"/>
</g>
<!-- Snap -->
<g id="node17" class="node">
<title>Snap</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1221,-336.75C1221,-336.75 1349,-336.75 1349,-336.75 1355,-336.75 1361,-342.75 1361,-348.75 1361,-348.75 1361,-531.75 1361,-531.75 1361,-537.75 1355,-543.75 1349,-543.75 1349,-543.75 1221,-543.75 1221,-543.75 1215,-543.75 1209,-537.75 1209,-531.75 1209,-531.75 1209,-348.75 1209,-348.75 1209,-342.75 1215,-336.75 1221,-336.75"/>
<text text-anchor="middle" x="1285" y="-528.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">Snap</text>
<polyline fill="none" stroke="#8a8898" points="1209,-520.75 1361,-520.75 "/>
<text text-anchor="start" x="1217" y="-505.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">key: SnapKey,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-497.75 1361,-497.75 "/>
<text text-anchor="start" x="1217" y="-482.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">display_path: String,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-474.75 1361,-474.75 "/>
<text text-anchor="start" x="1217" y="-459.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">dir_path: PathBuf,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-451.75 1361,-451.75 "/>
<text text-anchor="start" x="1217" y="-436.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">cf_files: Vec&lt;CfFile&gt;,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-428.75 1361,-428.75 "/>
<text text-anchor="start" x="1217" y="-413.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">cf_index: usize,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-405.75 1361,-405.75 "/>
<text text-anchor="start" x="1217" y="-390.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">meta_file: MetaFile,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-382.75 1361,-382.75 "/>
<text text-anchor="start" x="1217" y="-367.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">hold_tmp_files: bool,</text>
<polyline fill="none" stroke="#8a8898" points="1209,-359.75 1361,-359.75 "/>
<text text-anchor="start" x="1217" y="-344.55" font-family="Times,serif" font-size="14.00" fill="#5d6179">mgr: SnapManagerCore,</text>
</g>
<!-- SnapManager_get_snapshot_for_sending&#45;&gt;Snap -->
<g id="edge22" class="edge">
<title>SnapManager_get_snapshot_for_sending&#45;&gt;Snap</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1146.25,-440.25C1163.4,-440.25 1181.57,-440.25 1198.9,-440.25"/>
<polygon fill="green" stroke="green" points="1198.99,-443.75 1208.99,-440.25 1198.99,-436.75 1198.99,-443.75"/>
</g>
<!-- SecurityManager_connect&#45;&gt;TikvClient_snapshot -->
<g id="edge13" class="edge">
<title>SecurityManager_connect&#45;&gt;TikvClient_snapshot</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M323.22,-306.63C331.74,-306.96 340.41,-307.3 348.98,-307.64"/>
<polygon fill="green" stroke="green" points="348.86,-311.14 358.99,-308.03 349.14,-304.14 348.86,-311.14"/>
</g>
<!-- TikvClient_snapshot&#45;&gt;Sink_send_all_await -->
<g id="edge14" class="edge">
<title>TikvClient_snapshot&#45;&gt;Sink_send_all_await</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M525.32,-310.25C604.73,-309.38 728.34,-308.25 835.5,-308.25 835.5,-308.25 835.5,-308.25 1286,-308.25 1392.03,-308.25 1514.21,-308.25 1593.49,-308.25"/>
<polygon fill="green" stroke="green" points="1593.9,-311.75 1603.9,-308.25 1593.9,-304.75 1593.9,-311.75"/>
</g>
<!-- TikvClient_snapshot&#45;&gt;Sink_close_await -->
<g id="edge15" class="edge">
<title>TikvClient_snapshot&#45;&gt;Sink_close_await</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M525.2,-337.03C538.42,-341.17 552.02,-345.44 564.99,-349.51"/>
<polygon fill="green" stroke="green" points="564.18,-352.92 574.77,-352.57 566.28,-346.24 564.18,-352.92"/>
</g>
<!-- TikvClient_snapshot&#45;&gt;receiver_await -->
<g id="edge16" class="edge">
<title>TikvClient_snapshot&#45;&gt;receiver_await</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M490.08,-273.24C524.14,-245.75 569.5,-209.13 600.87,-183.81"/>
<polygon fill="green" stroke="green" points="603.34,-186.32 608.92,-177.31 598.95,-180.87 603.34,-186.32"/>
</g>
<!-- receiver_await&#45;&gt;drop_TikVClient -->
<g id="edge25" class="edge">
<title>receiver_await&#45;&gt;drop_TikVClient</title>
<path fill="none" stroke="#666666" d="M716.12,-169.1C734.07,-172.58 753.03,-176.26 770.42,-179.63"/>
<polygon fill="#666666" stroke="#666666" points="769.98,-183.11 780.46,-181.57 771.31,-176.24 769.98,-183.11"/>
</g>
<!-- receiver_await&#45;&gt;SnapChunk_Snapshot_delete -->
<g id="edge26" class="edge">
<title>receiver_await&#45;&gt;SnapChunk_Snapshot_delete</title>
<path fill="none" stroke="#666666" d="M716.12,-140.56C724.53,-139.06 733.16,-137.52 741.75,-135.99"/>
<polygon fill="#666666" stroke="#666666" points="742.57,-139.4 751.8,-134.19 741.34,-132.5 742.57,-139.4"/>
</g>
<!-- receiver_await&#45;&gt;drop_deregister -->
<g id="edge27" class="edge">
<title>receiver_await&#45;&gt;drop_deregister</title>
<path fill="none" stroke="#666666" d="M669.17,-131.16C691.1,-114.94 722.2,-93.65 752,-79.25 759.59,-75.58 767.8,-72.23 776.01,-69.24"/>
<polygon fill="#666666" stroke="#666666" points="777.32,-72.49 785.61,-65.9 775.01,-65.88 777.32,-72.49"/>
</g>
<!-- SnapManager_deregister -->
<g id="node18" class="node">
<title>SnapManager_deregister</title>
<path fill="none" stroke="#1c2123" d="M980,-21.75C980,-21.75 1150,-21.75 1150,-21.75 1156,-21.75 1162,-27.75 1162,-33.75 1162,-33.75 1162,-70.75 1162,-70.75 1162,-76.75 1156,-82.75 1150,-82.75 1150,-82.75 980,-82.75 980,-82.75 974,-82.75 968,-76.75 968,-70.75 968,-70.75 968,-33.75 968,-33.75 968,-27.75 974,-21.75 980,-21.75"/>
<text text-anchor="start" x="976" y="-67.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManager</text>
<text text-anchor="start" x="976" y="-52.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> deregister</text>
<polyline fill="none" stroke="#1c2123" points="968,-44.75 1162,-44.75 "/>
<text text-anchor="start" x="976" y="-29.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">去掉注册SnapKey对应的状态</text>
</g>
<!-- drop_deregister&#45;&gt;SnapManager_deregister -->
<g id="edge28" class="edge">
<title>drop_deregister&#45;&gt;SnapManager_deregister</title>
<path fill="none" stroke="#666666" d="M887.21,-52.25C908.04,-52.25 933.11,-52.25 957.74,-52.25"/>
<polygon fill="#666666" stroke="#666666" points="957.88,-55.75 967.88,-52.25 957.88,-48.75 957.88,-55.75"/>
</g>
<!-- RaftSnapshot&#45;&gt;SnapKey_from_snap -->
<g id="edge18" class="edge">
<title>RaftSnapshot&#45;&gt;SnapKey_from_snap</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M524.64,-527.27C543.24,-525.45 562.62,-523.56 579.96,-521.87"/>
<polygon fill="green" stroke="green" points="580.3,-525.35 589.92,-520.89 579.62,-518.38 580.3,-525.35"/>
</g>
<!-- SnapChunk -->
<g id="node15" class="node">
<title>SnapChunk</title>
<path fill="none" stroke="#1c2123" d="M1409,-365.75C1409,-365.75 1556,-365.75 1556,-365.75 1562,-365.75 1568,-371.75 1568,-377.75 1568,-377.75 1568,-444.75 1568,-444.75 1568,-450.75 1562,-456.75 1556,-456.75 1556,-456.75 1409,-456.75 1409,-456.75 1403,-456.75 1397,-450.75 1397,-444.75 1397,-444.75 1397,-377.75 1397,-377.75 1397,-371.75 1403,-365.75 1409,-365.75"/>
<text text-anchor="middle" x="1482.5" y="-441.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapChunk</text>
<polyline fill="none" stroke="#1c2123" points="1397,-433.75 1568,-433.75 "/>
<text text-anchor="start" x="1405" y="-418.55" font-family="Times,serif" font-size="14.00" fill="#2f3638">实现了stream接口</text>
<text text-anchor="start" x="1405" y="-403.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> sink.send_all</text>
<text text-anchor="start" x="1405" y="-388.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会调用它的poll_next方法</text>
<text text-anchor="start" x="1405" y="-373.55" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 读取要发送snap数据</text>
</g>
<!-- SnapChunk&#45;&gt;Sink_send_all_await -->
<g id="edge24" class="edge">
<title>SnapChunk&#45;&gt;Sink_send_all_await</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1568.03,-366.37C1587.42,-356.07 1607.48,-345.42 1625.06,-336.09"/>
<polygon fill="green" stroke="green" points="1626.81,-339.12 1634,-331.34 1623.53,-332.94 1626.81,-339.12"/>
</g>
<!-- SnapKey&#45;&gt;SnapManager_register_SnapEntry_Sending -->
<g id="edge20" class="edge">
<title>SnapKey&#45;&gt;SnapManager_register_SnapEntry_Sending</title>
<path fill="none" stroke="#666666" d="M898.79,-528.69C913.8,-531.74 930.36,-535.1 947.02,-538.49"/>
<polygon fill="#666666" stroke="#666666" points="946.34,-541.92 956.83,-540.48 947.73,-535.06 946.34,-541.92"/>
</g>
<!-- SnapKey&#45;&gt;SnapManager_get_snapshot_for_sending -->
<g id="edge21" class="edge">
<title>SnapKey&#45;&gt;SnapManager_get_snapshot_for_sending</title>
<path fill="none" stroke="#666666" d="M898.79,-495.68C922.03,-487.88 948.99,-478.84 974.3,-470.34"/>
<polygon fill="#666666" stroke="#666666" points="975.55,-473.62 983.92,-467.12 973.32,-466.98 975.55,-473.62"/>
</g>
<!-- Snap&#45;&gt;SnapChunk -->
<g id="edge23" class="edge">
<title>Snap&#45;&gt;SnapChunk</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1361.03,-429.12C1369.46,-427.87 1378.14,-426.58 1386.78,-425.3"/>
<polygon fill="green" stroke="green" points="1387.52,-428.73 1396.9,-423.8 1386.49,-421.8 1387.52,-428.73"/>
</g>
</g>
</svg>
