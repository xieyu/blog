<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: snapshot_data_build Pages: 1 -->
<svg width="1491pt" height="711pt"
 viewBox="0.00 0.00 1491.00 711.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 707)">
<title>snapshot_data_build</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-707 1487,-707 1487,4 -4,4"/>
<!-- Snap_build -->
<g id="node1" class="node">
<title>Snap_build</title>
<path fill="none" stroke="#1c2123" d="M66,-155.5C66,-155.5 12,-155.5 12,-155.5 6,-155.5 0,-149.5 0,-143.5 0,-143.5 0,-131.5 0,-131.5 0,-125.5 6,-119.5 12,-119.5 12,-119.5 66,-119.5 66,-119.5 72,-119.5 78,-125.5 78,-131.5 78,-131.5 78,-143.5 78,-143.5 78,-149.5 72,-155.5 66,-155.5"/>
<text text-anchor="middle" x="39" y="-133.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap_build</text>
</g>
<!-- Snap_do_build -->
<g id="node2" class="node">
<title>Snap_do_build</title>
<path fill="none" stroke="#1c2123" d="M126,-247.5C126,-247.5 252,-247.5 252,-247.5 258,-247.5 264,-253.5 264,-259.5 264,-259.5 264,-311.5 264,-311.5 264,-317.5 258,-323.5 252,-323.5 252,-323.5 126,-323.5 126,-323.5 120,-323.5 114,-317.5 114,-311.5 114,-311.5 114,-259.5 114,-259.5 114,-253.5 120,-247.5 126,-247.5"/>
<text text-anchor="start" x="122" y="-308.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap</text>
<text text-anchor="start" x="122" y="-293.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> do_build</text>
<polyline fill="none" stroke="#1c2123" points="114,-285.5 264,-285.5 "/>
<text text-anchor="start" x="122" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成Region的cf</text>
<text text-anchor="start" x="122" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> (default, lock, write)file</text>
</g>
<!-- Snap_build&#45;&gt;Snap_do_build -->
<g id="edge1" class="edge">
<title>Snap_build&#45;&gt;Snap_do_build</title>
<path fill="none" stroke="#666666" d="M58.15,-155.65C79.07,-176.57 114.23,-211.73 142.69,-240.19"/>
<polygon fill="#666666" stroke="#666666" points="140.22,-242.67 149.77,-247.27 145.17,-237.72 140.22,-242.67"/>
</g>
<!-- RaftSnapshotData -->
<g id="node3" class="node">
<title>RaftSnapshotData</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1323,-0.5C1323,-0.5 1471,-0.5 1471,-0.5 1477,-0.5 1483,-6.5 1483,-12.5 1483,-12.5 1483,-126.5 1483,-126.5 1483,-132.5 1477,-138.5 1471,-138.5 1471,-138.5 1323,-138.5 1323,-138.5 1317,-138.5 1311,-132.5 1311,-126.5 1311,-126.5 1311,-12.5 1311,-12.5 1311,-6.5 1317,-0.5 1323,-0.5"/>
<text text-anchor="middle" x="1397" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RaftSnapshotData</text>
<polyline fill="none" stroke="#8a8898" points="1311,-115.5 1483,-115.5 "/>
<text text-anchor="start" x="1319" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">metapb.Region region = 1;</text>
<polyline fill="none" stroke="#8a8898" points="1311,-92.5 1483,-92.5 "/>
<text text-anchor="start" x="1319" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 file_size = 2;</text>
<polyline fill="none" stroke="#8a8898" points="1311,-69.5 1483,-69.5 "/>
<text text-anchor="start" x="1319" y="-54.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">repeated KeyValue data = 3;</text>
<polyline fill="none" stroke="#8a8898" points="1311,-46.5 1483,-46.5 "/>
<text text-anchor="start" x="1319" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">uint64 version = 4;</text>
<polyline fill="none" stroke="#8a8898" points="1311,-23.5 1483,-23.5 "/>
<text text-anchor="start" x="1319" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">SnapshotMeta meta = 5;</text>
</g>
<!-- Snap_build&#45;&gt;RaftSnapshotData -->
<g id="edge2" class="edge">
<title>Snap_build&#45;&gt;RaftSnapshotData</title>
<path fill="none" stroke="#666666" d="M77.14,-119.45C142.44,-89.43 282.76,-32.5 408,-32.5 408,-32.5 408,-32.5 895,-32.5 1064.1,-32.5 1106.73,-34.82 1275,-51.5 1283.35,-52.33 1292.01,-53.33 1300.69,-54.43"/>
<polygon fill="#666666" stroke="#666666" points="1300.48,-57.94 1310.85,-55.77 1301.39,-50.99 1300.48,-57.94"/>
</g>
<!-- enc_start_key_region -->
<g id="node4" class="node">
<title>enc_start_key_region</title>
<path fill="none" stroke="#1c2123" d="M573,-618.5C573,-618.5 717,-618.5 717,-618.5 723,-618.5 729,-624.5 729,-630.5 729,-630.5 729,-690.5 729,-690.5 729,-696.5 723,-702.5 717,-702.5 717,-702.5 573,-702.5 573,-702.5 567,-702.5 561,-696.5 561,-690.5 561,-690.5 561,-630.5 561,-630.5 561,-624.5 567,-618.5 573,-618.5"/>
<text text-anchor="middle" x="645" y="-687.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">enc_start_key(region)</text>
<polyline fill="none" stroke="#1c2123" points="561,-679.5 729,-679.5 "/>
<text text-anchor="start" x="569" y="-664.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取region的start key</text>
<text text-anchor="start" x="569" y="-649.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> DATA_PREFIX_KEY: b&#39;z&#39;</text>
<polyline fill="none" stroke="#1c2123" points="561,-641.5 729,-641.5 "/>
<text text-anchor="start" x="569" y="-626.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">前缀为b&#39;z&#39;</text>
</g>
<!-- Snap_do_build&#45;&gt;enc_start_key_region -->
<g id="edge3" class="edge">
<title>Snap_do_build&#45;&gt;enc_start_key_region</title>
<path fill="none" stroke="#666666" d="M190.69,-323.5C194.16,-392.62 212.14,-538.48 300,-611.5 369.26,-669.07 474.74,-676.15 550.63,-672.06"/>
<polygon fill="#666666" stroke="#666666" points="550.9,-675.55 560.67,-671.45 550.47,-668.56 550.9,-675.55"/>
</g>
<!-- enc_end_key_region -->
<g id="node5" class="node">
<title>enc_end_key_region</title>
<path fill="none" stroke="#1c2123" d="M352.5,-555.5C352.5,-555.5 465.5,-555.5 465.5,-555.5 471.5,-555.5 477.5,-561.5 477.5,-567.5 477.5,-567.5 477.5,-589.5 477.5,-589.5 477.5,-595.5 471.5,-601.5 465.5,-601.5 465.5,-601.5 352.5,-601.5 352.5,-601.5 346.5,-601.5 340.5,-595.5 340.5,-589.5 340.5,-589.5 340.5,-567.5 340.5,-567.5 340.5,-561.5 346.5,-555.5 352.5,-555.5"/>
<text text-anchor="middle" x="409" y="-586.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">enc_end_key(region)</text>
<polyline fill="none" stroke="#1c2123" points="340.5,-578.5 477.5,-578.5 "/>
<text text-anchor="start" x="348.5" y="-563.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取region的end key</text>
</g>
<!-- Snap_do_build&#45;&gt;enc_end_key_region -->
<g id="edge4" class="edge">
<title>Snap_do_build&#45;&gt;enc_end_key_region</title>
<path fill="none" stroke="#666666" d="M198.04,-323.56C210.99,-376.36 241.2,-471.93 300,-530.5 308.95,-539.41 319.83,-546.81 331.21,-552.92"/>
<polygon fill="#666666" stroke="#666666" points="329.91,-556.18 340.41,-557.54 333.05,-549.92 329.91,-556.18"/>
</g>
<!-- SNAPSHOT_CFS_ENUM_PAIR -->
<g id="node6" class="node">
<title>SNAPSHOT_CFS_ENUM_PAIR</title>
<path fill="none" stroke="#1c2123" d="M312,-271C312,-271 506,-271 506,-271 512,-271 518,-277 518,-283 518,-283 518,-374 518,-374 518,-380 512,-386 506,-386 506,-386 312,-386 312,-386 306,-386 300,-380 300,-374 300,-374 300,-283 300,-283 300,-277 306,-271 312,-271"/>
<text text-anchor="middle" x="409" y="-370.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SNAPSHOT_CFS_ENUM_PAIR</text>
<polyline fill="none" stroke="#1c2123" points="300,-363 518,-363 "/>
<text text-anchor="start" x="308" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">(CfNames::default, CF_DEFAULT),</text>
<polyline fill="none" stroke="#1c2123" points="300,-340 518,-340 "/>
<text text-anchor="start" x="308" y="-324.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">(CfNames::lock, CF_LOCK),</text>
<polyline fill="none" stroke="#1c2123" points="300,-317 518,-317 "/>
<text text-anchor="start" x="308" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">(CfNames::write, CF_WRITE),</text>
<polyline fill="none" stroke="#1c2123" points="300,-294 518,-294 "/>
<text text-anchor="start" x="308" y="-278.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历上面的column faimly</text>
</g>
<!-- Snap_do_build&#45;&gt;SNAPSHOT_CFS_ENUM_PAIR -->
<g id="edge5" class="edge">
<title>Snap_do_build&#45;&gt;SNAPSHOT_CFS_ENUM_PAIR</title>
<path fill="none" stroke="#666666" d="M264.11,-300.12C272.45,-301.76 281.09,-303.47 289.82,-305.19"/>
<polygon fill="#666666" stroke="#666666" points="289.2,-308.63 299.69,-307.14 290.56,-301.77 289.2,-308.63"/>
</g>
<!-- Snap_switch_to_cf_file -->
<g id="node7" class="node">
<title>Snap_switch_to_cf_file</title>
<path fill="none" stroke="#1c2123" d="M584.5,-484.5C584.5,-484.5 705.5,-484.5 705.5,-484.5 711.5,-484.5 717.5,-490.5 717.5,-496.5 717.5,-496.5 717.5,-548.5 717.5,-548.5 717.5,-554.5 711.5,-560.5 705.5,-560.5 705.5,-560.5 584.5,-560.5 584.5,-560.5 578.5,-560.5 572.5,-554.5 572.5,-548.5 572.5,-548.5 572.5,-496.5 572.5,-496.5 572.5,-490.5 578.5,-484.5 584.5,-484.5"/>
<text text-anchor="middle" x="645" y="-545.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap::switch_to_cf_file</text>
<polyline fill="none" stroke="#1c2123" points="572.5,-537.5 717.5,-537.5 "/>
<text text-anchor="start" x="580.5" y="-522.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历self.cf_files </text>
<text text-anchor="start" x="580.5" y="-507.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 找到cf对应的index</text>
<text text-anchor="start" x="580.5" y="-492.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置self.cf_index</text>
</g>
<!-- Snap_do_build&#45;&gt;Snap_switch_to_cf_file -->
<g id="edge6" class="edge">
<title>Snap_do_build&#45;&gt;Snap_switch_to_cf_file</title>
<path fill="none" stroke="#666666" d="M200.18,-323.9C214.41,-369.4 244.91,-443.67 300,-480.5 377.63,-532.4 487.56,-536.81 562.1,-532.23"/>
<polygon fill="#666666" stroke="#666666" points="562.64,-535.7 572.38,-531.53 562.17,-528.72 562.64,-535.7"/>
</g>
<!-- snap_io_build_plain_cf_file -->
<g id="node8" class="node">
<title>snap_io_build_plain_cf_file</title>
<path fill="none" stroke="#1c2123" d="M566,-389.5C566,-389.5 724,-389.5 724,-389.5 730,-389.5 736,-395.5 736,-401.5 736,-401.5 736,-453.5 736,-453.5 736,-459.5 730,-465.5 724,-465.5 724,-465.5 566,-465.5 566,-465.5 560,-465.5 554,-459.5 554,-453.5 554,-453.5 554,-401.5 554,-401.5 554,-395.5 560,-389.5 566,-389.5"/>
<text text-anchor="middle" x="645" y="-450.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_io::build_plain_cf_file</text>
<polyline fill="none" stroke="#1c2123" points="554,-442.5 736,-442.5 "/>
<text text-anchor="start" x="562" y="-427.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将cf_file.cf 的</text>
<text text-anchor="start" x="562" y="-412.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> begin_key, end_key</text>
<text text-anchor="start" x="562" y="-397.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将数据写入cf_file.tmp_path</text>
</g>
<!-- Snap_do_build&#45;&gt;snap_io_build_plain_cf_file -->
<g id="edge7" class="edge">
<title>Snap_do_build&#45;&gt;snap_io_build_plain_cf_file</title>
<path fill="none" stroke="#666666" d="M202.63,-323.72C218.33,-364.26 249.4,-426.15 300,-453.5 374.6,-493.82 471.91,-481.59 543.99,-462.6"/>
<polygon fill="#666666" stroke="#666666" points="545.26,-465.88 553.99,-459.88 543.42,-459.13 545.26,-465.88"/>
</g>
<!-- snap_io_build_sst_cf_file -->
<g id="node9" class="node">
<title>snap_io_build_sst_cf_file</title>
<path fill="none" stroke="#1c2123" d="M566,-271C566,-271 724,-271 724,-271 730,-271 736,-277 736,-283 736,-283 736,-358 736,-358 736,-364 730,-370 724,-370 724,-370 566,-370 566,-370 560,-370 554,-364 554,-358 554,-358 554,-283 554,-283 554,-277 560,-271 566,-271"/>
<text text-anchor="middle" x="645" y="-354.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_io::build_sst_cf_file</text>
<polyline fill="none" stroke="#1c2123" points="554,-347 736,-347 "/>
<text text-anchor="start" x="562" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将cf_file.cf 的</text>
<text text-anchor="start" x="562" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> begin_key, end_key</text>
<text text-anchor="start" x="562" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将数据写入cf_file.tmp_path</text>
<polyline fill="none" stroke="#1c2123" points="554,-294 736,-294 "/>
<text text-anchor="start" x="562" y="-278.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建的是sst format</text>
</g>
<!-- Snap_do_build&#45;&gt;snap_io_build_sst_cf_file -->
<g id="edge8" class="edge">
<title>Snap_do_build&#45;&gt;snap_io_build_sst_cf_file</title>
<path fill="none" stroke="#666666" d="M264.2,-267.05C276.1,-264.74 288.34,-262.76 300,-261.5 396.33,-251.11 423.42,-240.45 518,-261.5 526.74,-263.45 535.6,-266.07 544.35,-269.12"/>
<polygon fill="#666666" stroke="#666666" points="543.2,-272.43 553.79,-272.6 545.62,-265.86 543.2,-272.43"/>
</g>
<!-- SnapManagerCore_rename_tmp_cf_file_for_send -->
<g id="node10" class="node">
<title>SnapManagerCore_rename_tmp_cf_file_for_send</title>
<path fill="none" stroke="#1c2123" d="M805.5,-271C805.5,-271 982.5,-271 982.5,-271 988.5,-271 994.5,-277 994.5,-283 994.5,-283 994.5,-358 994.5,-358 994.5,-364 988.5,-370 982.5,-370 982.5,-370 805.5,-370 805.5,-370 799.5,-370 793.5,-364 793.5,-358 793.5,-358 793.5,-283 793.5,-283 793.5,-277 799.5,-271 805.5,-271"/>
<text text-anchor="start" x="801.5" y="-354.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManagerCore</text>
<text text-anchor="start" x="801.5" y="-339.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rename_tmp_cf_file_for_send</text>
<polyline fill="none" stroke="#1c2123" points="793.5,-332 994.5,-332 "/>
<text text-anchor="start" x="801.5" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果cf.kv_count &gt;0</text>
<text text-anchor="start" x="801.5" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重命名cf.tmp_pah到cf_file.path</text>
<polyline fill="none" stroke="#1c2123" points="793.5,-294 994.5,-294 "/>
<text text-anchor="start" x="801.5" y="-278.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">设置cf file的checksum和size</text>
</g>
<!-- Snap_do_build&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send -->
<g id="edge9" class="edge">
<title>Snap_do_build&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send</title>
<path fill="none" stroke="#666666" d="M264.19,-254.59C275.99,-250.83 288.19,-247.58 300,-245.5 490.97,-211.86 546.61,-219.87 736,-261.5 751.66,-264.94 767.85,-269.63 783.61,-274.88"/>
<polygon fill="#666666" stroke="#666666" points="782.77,-278.29 793.37,-278.21 785.03,-271.66 782.77,-278.29"/>
</g>
<!-- delete_file_if_exist_cf_file_tmp_path -->
<g id="node11" class="node">
<title>delete_file_if_exist_cf_file_tmp_path</title>
<path fill="none" stroke="#1c2123" d="M793.5,-136C793.5,-136 994.5,-136 994.5,-136 1000.5,-136 1006.5,-142 1006.5,-148 1006.5,-148 1006.5,-185 1006.5,-185 1006.5,-191 1000.5,-197 994.5,-197 994.5,-197 793.5,-197 793.5,-197 787.5,-197 781.5,-191 781.5,-185 781.5,-185 781.5,-148 781.5,-148 781.5,-142 787.5,-136 793.5,-136"/>
<text text-anchor="middle" x="894" y="-181.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">delete_file_if_exist(cf_file.tmpe_path)</text>
<polyline fill="none" stroke="#1c2123" points="781.5,-174 1006.5,-174 "/>
<text text-anchor="start" x="789.5" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果cf_file.kv_count == 0</text>
<text text-anchor="start" x="789.5" y="-143.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 删除临时文件</text>
</g>
<!-- Snap_do_build&#45;&gt;delete_file_if_exist_cf_file_tmp_path -->
<g id="edge10" class="edge">
<title>Snap_do_build&#45;&gt;delete_file_if_exist_cf_file_tmp_path</title>
<path fill="none" stroke="#666666" d="M244.6,-247.48C261.63,-237.38 280.96,-227.59 300,-221.5 457.32,-171.16 649.23,-162.23 771.29,-162.63"/>
<polygon fill="#666666" stroke="#666666" points="771.4,-166.13 781.41,-162.68 771.43,-159.13 771.4,-166.13"/>
</g>
<!-- SnapManagerCore_encryption_key_manager -->
<g id="node12" class="node">
<title>SnapManagerCore_encryption_key_manager</title>
<path fill="none" stroke="#1c2123" d="M342,-405.5C342,-405.5 476,-405.5 476,-405.5 482,-405.5 488,-411.5 488,-417.5 488,-417.5 488,-431.5 488,-431.5 488,-437.5 482,-443.5 476,-443.5 476,-443.5 342,-443.5 342,-443.5 336,-443.5 330,-437.5 330,-431.5 330,-431.5 330,-417.5 330,-417.5 330,-411.5 336,-405.5 342,-405.5"/>
<text text-anchor="start" x="338" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapManagerCore</text>
<text text-anchor="start" x="338" y="-413.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> encryption_key_manager</text>
</g>
<!-- Snap_do_build&#45;&gt;SnapManagerCore_encryption_key_manager -->
<g id="edge11" class="edge">
<title>Snap_do_build&#45;&gt;SnapManagerCore_encryption_key_manager</title>
<path fill="none" stroke="#666666" d="M219.11,-323.5C239.35,-347.45 268.31,-377.19 300,-395.5 306.36,-399.17 313.19,-402.39 320.22,-405.21"/>
<polygon fill="#666666" stroke="#666666" points="319.32,-408.61 329.91,-408.82 321.76,-402.05 319.32,-408.61"/>
</g>
<!-- gen_snapshot_meta -->
<g id="node13" class="node">
<title>gen_snapshot_meta</title>
<path fill="none" stroke="#1c2123" d="M459,-100.5C459,-100.5 359,-100.5 359,-100.5 353,-100.5 347,-94.5 347,-88.5 347,-88.5 347,-76.5 347,-76.5 347,-70.5 353,-64.5 359,-64.5 359,-64.5 459,-64.5 459,-64.5 465,-64.5 471,-70.5 471,-76.5 471,-76.5 471,-88.5 471,-88.5 471,-94.5 465,-100.5 459,-100.5"/>
<text text-anchor="middle" x="409" y="-78.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">gen_snapshot_meta</text>
</g>
<!-- Snap_do_build&#45;&gt;gen_snapshot_meta -->
<g id="edge12" class="edge">
<title>Snap_do_build&#45;&gt;gen_snapshot_meta</title>
<path fill="none" stroke="#666666" d="M205.1,-247.15C222.36,-208.18 254.26,-148.82 300,-114.5 310.95,-106.28 323.99,-100.17 337.16,-95.62"/>
<polygon fill="#666666" stroke="#666666" points="338.26,-98.94 346.74,-92.58 336.15,-92.27 338.26,-98.94"/>
</g>
<!-- Snap_save_meta_file -->
<g id="node14" class="node">
<title>Snap_save_meta_file</title>
<path fill="none" stroke="#1c2123" d="M606,-99.5C606,-99.5 684,-99.5 684,-99.5 690,-99.5 696,-105.5 696,-111.5 696,-111.5 696,-125.5 696,-125.5 696,-131.5 690,-137.5 684,-137.5 684,-137.5 606,-137.5 606,-137.5 600,-137.5 594,-131.5 594,-125.5 594,-125.5 594,-111.5 594,-111.5 594,-105.5 600,-99.5 606,-99.5"/>
<text text-anchor="start" x="602" y="-122.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Snap</text>
<text text-anchor="start" x="602" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> save_meta_file</text>
</g>
<!-- Snap_do_build&#45;&gt;Snap_save_meta_file -->
<g id="edge13" class="edge">
<title>Snap_do_build&#45;&gt;Snap_save_meta_file</title>
<path fill="none" stroke="#666666" d="M210.18,-247.46C228.97,-216.21 260.06,-173.76 300,-152.5 347.72,-127.1 498.67,-120.61 583.9,-119"/>
<polygon fill="#666666" stroke="#666666" points="584.02,-122.49 593.96,-118.82 583.9,-115.5 584.02,-122.49"/>
</g>
<!-- kv_snap_scan_cf -->
<g id="node16" class="node">
<title>kv_snap_scan_cf</title>
<path fill="none" stroke="#1c2123" d="M784,-478C784,-478 1004,-478 1004,-478 1010,-478 1016,-484 1016,-490 1016,-490 1016,-527 1016,-527 1016,-533 1010,-539 1004,-539 1004,-539 784,-539 784,-539 778,-539 772,-533 772,-527 772,-527 772,-490 772,-490 772,-484 778,-478 784,-478"/>
<text text-anchor="middle" x="894" y="-523.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">kv_snap_scan_cf</text>
<polyline fill="none" stroke="#1c2123" points="772,-516 1016,-516 "/>
<text text-anchor="start" x="780" y="-500.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">扫描cf [start_key,end_key) range</text>
<text text-anchor="start" x="780" y="-485.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 内所有的key，将key,value写入sst_file</text>
</g>
<!-- enc_start_key_region&#45;&gt;kv_snap_scan_cf -->
<g id="edge18" class="edge">
<title>enc_start_key_region&#45;&gt;kv_snap_scan_cf</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M714.48,-618.36C752.12,-595.2 798.33,-566.76 834.31,-544.62"/>
<polygon fill="green" stroke="green" points="836.54,-547.35 843.22,-539.13 832.87,-541.39 836.54,-547.35"/>
</g>
<!-- enc_end_key_region&#45;&gt;kv_snap_scan_cf -->
<g id="edge19" class="edge">
<title>enc_end_key_region&#45;&gt;kv_snap_scan_cf</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M477.58,-583.67C544.05,-587.17 648.06,-588.36 736,-570.5 764.65,-564.68 794.81,-553.99 820.95,-543.1"/>
<polygon fill="green" stroke="green" points="822.56,-546.22 830.39,-539.08 819.82,-539.77 822.56,-546.22"/>
</g>
<!-- SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;Snap_switch_to_cf_file -->
<g id="edge24" class="edge">
<title>SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;Snap_switch_to_cf_file</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M509.2,-386.34C512.29,-389.29 515.24,-392.35 518,-395.5 543.69,-424.83 527.25,-447.14 554,-475.5 557.15,-478.84 560.58,-481.98 564.22,-484.93"/>
<polygon fill="green" stroke="green" points="562.36,-487.91 572.46,-491.11 566.55,-482.31 562.36,-487.91"/>
</g>
<!-- SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;snap_io_build_plain_cf_file -->
<g id="edge25" class="edge">
<title>SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;snap_io_build_plain_cf_file</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M518.1,-374.23C526.89,-377.95 535.75,-381.7 544.48,-385.4"/>
<polygon fill="green" stroke="green" points="543.32,-388.7 553.89,-389.38 546.04,-382.26 543.32,-388.7"/>
</g>
<!-- SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;snap_io_build_sst_cf_file -->
<g id="edge26" class="edge">
<title>SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;snap_io_build_sst_cf_file</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M518.1,-324.8C526.61,-324.51 535.19,-324.22 543.64,-323.93"/>
<polygon fill="green" stroke="green" points="544.02,-327.42 553.89,-323.58 543.78,-320.42 544.02,-327.42"/>
</g>
<!-- SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;delete_file_if_exist_cf_file_tmp_path -->
<g id="edge27" class="edge">
<title>SNAPSHOT_CFS_ENUM_PAIR&#45;&gt;delete_file_if_exist_cf_file_tmp_path</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M518.1,-275.93C530.1,-270.78 542.23,-265.85 554,-261.5 624.75,-235.33 706.07,-212.31 771.32,-195.49"/>
<polygon fill="green" stroke="green" points="772.43,-198.82 781.24,-192.95 770.69,-192.04 772.43,-198.82"/>
</g>
<!-- snap_io_build_plain_cf_file&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send -->
<g id="edge20" class="edge">
<title>snap_io_build_plain_cf_file&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M733.78,-389.47C750.04,-382.43 767.21,-374.99 784.01,-367.71"/>
<polygon fill="green" stroke="green" points="785.52,-370.88 793.3,-363.69 782.73,-364.45 785.52,-370.88"/>
</g>
<!-- snap_io_build_plain_cf_file&#45;&gt;kv_snap_scan_cf -->
<g id="edge30" class="edge">
<title>snap_io_build_plain_cf_file&#45;&gt;kv_snap_scan_cf</title>
<path fill="none" stroke="#666666" d="M736.22,-457.09C753.66,-462.81 772.06,-468.84 789.88,-474.68"/>
<polygon fill="#666666" stroke="#666666" points="789.11,-478.12 799.71,-477.91 791.3,-471.46 789.11,-478.12"/>
</g>
<!-- snap_io_build_sst_cf_file&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send -->
<g id="edge21" class="edge">
<title>snap_io_build_sst_cf_file&#45;&gt;SnapManagerCore_rename_tmp_cf_file_for_send</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M736.22,-320.5C751.48,-320.5 767.48,-320.5 783.17,-320.5"/>
<polygon fill="green" stroke="green" points="783.43,-324 793.43,-320.5 783.43,-317 783.43,-324"/>
</g>
<!-- snap_io_build_sst_cf_file&#45;&gt;kv_snap_scan_cf -->
<g id="edge28" class="edge">
<title>snap_io_build_sst_cf_file&#45;&gt;kv_snap_scan_cf</title>
<path fill="none" stroke="#666666" d="M722.98,-370.16C727.42,-373.27 731.79,-376.4 736,-379.5 775.96,-408.88 819.38,-444.9 850.4,-471.4"/>
<polygon fill="#666666" stroke="#666666" points="848.15,-474.07 858.02,-477.92 852.7,-468.76 848.15,-474.07"/>
</g>
<!-- create_sst_file_writer -->
<g id="node18" class="node">
<title>create_sst_file_writer</title>
<path fill="none" stroke="#1c2123" d="M948.5,-252.5C948.5,-252.5 839.5,-252.5 839.5,-252.5 833.5,-252.5 827.5,-246.5 827.5,-240.5 827.5,-240.5 827.5,-228.5 827.5,-228.5 827.5,-222.5 833.5,-216.5 839.5,-216.5 839.5,-216.5 948.5,-216.5 948.5,-216.5 954.5,-216.5 960.5,-222.5 960.5,-228.5 960.5,-228.5 960.5,-240.5 960.5,-240.5 960.5,-246.5 954.5,-252.5 948.5,-252.5"/>
<text text-anchor="middle" x="894" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">create_sst_file_writer</text>
</g>
<!-- snap_io_build_sst_cf_file&#45;&gt;create_sst_file_writer -->
<g id="edge29" class="edge">
<title>snap_io_build_sst_cf_file&#45;&gt;create_sst_file_writer</title>
<path fill="none" stroke="#666666" d="M736.22,-275.39C748.09,-270.3 760.23,-265.52 772,-261.5 786.45,-256.57 802.19,-252.3 817.39,-248.7"/>
<polygon fill="#666666" stroke="#666666" points="818.32,-252.08 827.28,-246.43 816.75,-245.25 818.32,-252.08"/>
</g>
<!-- SnapshotMeta -->
<g id="node15" class="node">
<title>SnapshotMeta</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1064,-61.5C1064,-61.5 1263,-61.5 1263,-61.5 1269,-61.5 1275,-67.5 1275,-73.5 1275,-73.5 1275,-141.5 1275,-141.5 1275,-147.5 1269,-153.5 1263,-153.5 1263,-153.5 1064,-153.5 1064,-153.5 1058,-153.5 1052,-147.5 1052,-141.5 1052,-141.5 1052,-73.5 1052,-73.5 1052,-67.5 1058,-61.5 1064,-61.5"/>
<text text-anchor="middle" x="1163.5" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">SnapshotMeta</text>
<polyline fill="none" stroke="#8a8898" points="1052,-130.5 1275,-130.5 "/>
<text text-anchor="start" x="1060" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">repeated SnapshotCFFile cf_files = 1;</text>
<polyline fill="none" stroke="#8a8898" points="1052,-107.5 1275,-107.5 "/>
<text text-anchor="start" x="1060" y="-92.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">bool for_balance = 2;</text>
<polyline fill="none" stroke="#8a8898" points="1052,-84.5 1275,-84.5 "/>
<text text-anchor="middle" x="1163.5" y="-69.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> </text>
</g>
<!-- SnapManagerCore_rename_tmp_cf_file_for_send&#45;&gt;SnapshotMeta -->
<g id="edge14" class="edge">
<title>SnapManagerCore_rename_tmp_cf_file_for_send&#45;&gt;SnapshotMeta</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M994.77,-275.5C1002.14,-271.08 1009.31,-266.4 1016,-261.5 1054.98,-232.96 1092.4,-193.34 1119.66,-161.44"/>
<polygon fill="green" stroke="green" points="1122.59,-163.4 1126.37,-153.5 1117.24,-158.88 1122.59,-163.4"/>
</g>
<!-- calc_checksum_and_size -->
<g id="node17" class="node">
<title>calc_checksum_and_size</title>
<path fill="none" stroke="#1c2123" d="M1086.5,-297.5C1086.5,-297.5 1240.5,-297.5 1240.5,-297.5 1246.5,-297.5 1252.5,-303.5 1252.5,-309.5 1252.5,-309.5 1252.5,-331.5 1252.5,-331.5 1252.5,-337.5 1246.5,-343.5 1240.5,-343.5 1240.5,-343.5 1086.5,-343.5 1086.5,-343.5 1080.5,-343.5 1074.5,-337.5 1074.5,-331.5 1074.5,-331.5 1074.5,-309.5 1074.5,-309.5 1074.5,-303.5 1080.5,-297.5 1086.5,-297.5"/>
<text text-anchor="middle" x="1163.5" y="-328.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">calc_checksum_and_size</text>
<polyline fill="none" stroke="#1c2123" points="1074.5,-320.5 1252.5,-320.5 "/>
<text text-anchor="start" x="1082.5" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">计算文件的checksum和size</text>
</g>
<!-- SnapManagerCore_rename_tmp_cf_file_for_send&#45;&gt;calc_checksum_and_size -->
<g id="edge22" class="edge">
<title>SnapManagerCore_rename_tmp_cf_file_for_send&#45;&gt;calc_checksum_and_size</title>
<path fill="none" stroke="#666666" d="M994.61,-320.5C1017.28,-320.5 1041.35,-320.5 1063.98,-320.5"/>
<polygon fill="#666666" stroke="#666666" points="1064.26,-324 1074.26,-320.5 1064.26,-317 1064.26,-324"/>
</g>
<!-- SnapManagerCore_encryption_key_manager&#45;&gt;snap_io_build_plain_cf_file -->
<g id="edge23" class="edge">
<title>SnapManagerCore_encryption_key_manager&#45;&gt;snap_io_build_plain_cf_file</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M488.24,-425.5C505.96,-425.73 525,-425.97 543.49,-426.21"/>
<polygon fill="green" stroke="green" points="543.65,-429.71 553.69,-426.34 543.74,-422.71 543.65,-429.71"/>
</g>
<!-- gen_snapshot_meta&#45;&gt;Snap_save_meta_file -->
<g id="edge17" class="edge">
<title>gen_snapshot_meta&#45;&gt;Snap_save_meta_file</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M471.18,-91.91C505.93,-97.26 549.27,-103.93 583.86,-109.25"/>
<polygon fill="green" stroke="green" points="583.41,-112.72 593.82,-110.78 584.47,-105.8 583.41,-112.72"/>
</g>
<!-- gen_snapshot_meta&#45;&gt;SnapshotMeta -->
<g id="edge15" class="edge">
<title>gen_snapshot_meta&#45;&gt;SnapshotMeta</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M471.3,-83.44C536.83,-84.53 643.77,-86.56 736,-89.5 839.03,-92.78 956.01,-97.81 1041.37,-101.72"/>
<polygon fill="green" stroke="green" points="1041.47,-105.23 1051.62,-102.19 1041.79,-98.23 1041.47,-105.23"/>
</g>
<!-- SnapshotMeta&#45;&gt;RaftSnapshotData -->
<g id="edge16" class="edge">
<title>SnapshotMeta&#45;&gt;RaftSnapshotData</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1275.16,-89.33C1283.77,-87.92 1292.41,-86.5 1300.9,-85.11"/>
<polygon fill="green" stroke="green" points="1301.49,-88.56 1310.79,-83.49 1300.36,-81.65 1301.49,-88.56"/>
</g>
</g>
</svg>
