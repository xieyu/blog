<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: source_region_rollback_merge Pages: 1 -->
<svg width="1148pt" height="439pt"
 viewBox="0.00 0.00 1148.00 439.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 435)">
<title>source_region_rollback_merge</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-435 1144,-435 1144,4 -4,4"/>
<!-- ApplyDelegate__exec_rollback_merge -->
<g id="node1" class="node">
<title>ApplyDelegate__exec_rollback_merge</title>
<path fill="none" stroke="#1c2123" d="M12,-293.5C12,-293.5 191,-293.5 191,-293.5 197,-293.5 203,-299.5 203,-305.5 203,-305.5 203,-357.5 203,-357.5 203,-363.5 197,-369.5 191,-369.5 191,-369.5 12,-369.5 12,-369.5 6,-369.5 0,-363.5 0,-357.5 0,-357.5 0,-305.5 0,-305.5 0,-299.5 6,-293.5 12,-293.5"/>
<text text-anchor="start" x="8" y="-354.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyDelegate</text>
<text text-anchor="start" x="8" y="-339.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> exec_rollback_merge</text>
<polyline fill="none" stroke="#1c2123" points="0,-331.5 203,-331.5 "/>
<text text-anchor="start" x="8" y="-316.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将状态修改为PeerState::Normal</text>
<text text-anchor="start" x="8" y="-301.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region epoch version +1</text>
</g>
<!-- region__mut_region_epoch__set_version -->
<g id="node2" class="node">
<title>region__mut_region_epoch__set_version</title>
<path fill="#feed9b" stroke="#f7e495" d="M251,-260.5C251,-260.5 349,-260.5 349,-260.5 355,-260.5 361,-266.5 361,-272.5 361,-272.5 361,-324.5 361,-324.5 361,-330.5 355,-336.5 349,-336.5 349,-336.5 251,-336.5 251,-336.5 245,-336.5 239,-330.5 239,-324.5 239,-324.5 239,-272.5 239,-272.5 239,-266.5 245,-260.5 251,-260.5"/>
<text text-anchor="start" x="247" y="-321.3" font-family="Times,serif" font-size="14.00" fill="#40575d">region</text>
<text text-anchor="start" x="247" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> mut_region_epoch</text>
<text text-anchor="start" x="247" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> set_version</text>
<polyline fill="none" stroke="#f7e495" points="239,-283.5 361,-283.5 "/>
<text text-anchor="start" x="247" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#40575d">version +1</text>
</g>
<!-- ApplyDelegate__exec_rollback_merge&#45;&gt;region__mut_region_epoch__set_version -->
<g id="edge1" class="edge">
<title>ApplyDelegate__exec_rollback_merge&#45;&gt;region__mut_region_epoch__set_version</title>
<path fill="none" stroke="#666666" d="M203.05,-314.61C211.78,-313.15 220.48,-311.69 228.89,-310.28"/>
<polygon fill="#666666" stroke="#666666" points="229.69,-313.69 238.97,-308.58 228.53,-306.79 229.69,-313.69"/>
</g>
<!-- PeerState__Normal -->
<g id="node3" class="node">
<title>PeerState__Normal</title>
<path fill="none" stroke="#1c2123" d="M253.5,-394.5C253.5,-394.5 346.5,-394.5 346.5,-394.5 352.5,-394.5 358.5,-400.5 358.5,-406.5 358.5,-406.5 358.5,-418.5 358.5,-418.5 358.5,-424.5 352.5,-430.5 346.5,-430.5 346.5,-430.5 253.5,-430.5 253.5,-430.5 247.5,-430.5 241.5,-424.5 241.5,-418.5 241.5,-418.5 241.5,-406.5 241.5,-406.5 241.5,-400.5 247.5,-394.5 253.5,-394.5"/>
<text text-anchor="middle" x="300" y="-408.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerState::Normal</text>
</g>
<!-- ApplyDelegate__exec_rollback_merge&#45;&gt;PeerState__Normal -->
<g id="edge2" class="edge">
<title>ApplyDelegate__exec_rollback_merge&#45;&gt;PeerState__Normal</title>
<path fill="none" stroke="#666666" d="M194.71,-369.51C212.21,-376.73 229.98,-384.05 245.76,-390.55"/>
<polygon fill="#666666" stroke="#666666" points="244.74,-393.92 255.32,-394.49 247.4,-387.45 244.74,-393.92"/>
</g>
<!-- write_peer_state -->
<g id="node4" class="node">
<title>write_peer_state</title>
<path fill="none" stroke="#1c2123" d="M491,-383.5C491,-383.5 409,-383.5 409,-383.5 403,-383.5 397,-377.5 397,-371.5 397,-371.5 397,-359.5 397,-359.5 397,-353.5 403,-347.5 409,-347.5 409,-347.5 491,-347.5 491,-347.5 497,-347.5 503,-353.5 503,-359.5 503,-359.5 503,-371.5 503,-371.5 503,-377.5 497,-383.5 491,-383.5"/>
<text text-anchor="middle" x="450" y="-361.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_peer_state</text>
</g>
<!-- ApplyDelegate__exec_rollback_merge&#45;&gt;write_peer_state -->
<g id="edge3" class="edge">
<title>ApplyDelegate__exec_rollback_merge&#45;&gt;write_peer_state</title>
<path fill="none" stroke="#666666" d="M203.11,-342.78C215.2,-344.07 227.38,-345.34 239,-346.5 288.63,-351.47 344.93,-356.53 386.73,-360.18"/>
<polygon fill="#666666" stroke="#666666" points="386.5,-363.67 396.76,-361.05 387.1,-356.7 386.5,-363.67"/>
</g>
<!-- ExecResult__RollbackMerge -->
<g id="node5" class="node">
<title>ExecResult__RollbackMerge</title>
<path fill="none" stroke="#1c2123" d="M409.5,-212.5C409.5,-212.5 490.5,-212.5 490.5,-212.5 496.5,-212.5 502.5,-218.5 502.5,-224.5 502.5,-224.5 502.5,-238.5 502.5,-238.5 502.5,-244.5 496.5,-250.5 490.5,-250.5 490.5,-250.5 409.5,-250.5 409.5,-250.5 403.5,-250.5 397.5,-244.5 397.5,-238.5 397.5,-238.5 397.5,-224.5 397.5,-224.5 397.5,-218.5 403.5,-212.5 409.5,-212.5"/>
<text text-anchor="start" x="405.5" y="-235.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ExecResult</text>
<text text-anchor="start" x="405.5" y="-220.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> RollbackMerge</text>
</g>
<!-- ApplyDelegate__exec_rollback_merge&#45;&gt;ExecResult__RollbackMerge -->
<g id="edge4" class="edge">
<title>ApplyDelegate__exec_rollback_merge&#45;&gt;ExecResult__RollbackMerge</title>
<path fill="none" stroke="#666666" d="M154.31,-293.31C178.77,-277.29 209.11,-260.17 239,-250.5 287.1,-234.94 344.43,-230.64 387.02,-229.98"/>
<polygon fill="#666666" stroke="#666666" points="387.27,-233.47 397.24,-229.88 387.21,-226.47 387.27,-233.47"/>
</g>
<!-- region__mut_region_epoch__set_version&#45;&gt;write_peer_state -->
<g id="edge10" class="edge">
<title>region__mut_region_epoch__set_version&#45;&gt;write_peer_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M361.2,-325.75C374.08,-331.58 387.54,-337.68 399.94,-343.29"/>
<polygon fill="green" stroke="green" points="398.64,-346.54 409.19,-347.48 401.53,-340.17 398.64,-346.54"/>
</g>
<!-- region__mut_region_epoch__set_version&#45;&gt;ExecResult__RollbackMerge -->
<g id="edge11" class="edge">
<title>region__mut_region_epoch__set_version&#45;&gt;ExecResult__RollbackMerge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M361.2,-271.25C373.32,-265.76 385.96,-260.04 397.74,-254.7"/>
<polygon fill="green" stroke="green" points="399.32,-257.83 406.99,-250.52 396.43,-251.46 399.32,-257.83"/>
</g>
<!-- StoreMeta__set_region -->
<g id="node7" class="node">
<title>StoreMeta__set_region</title>
<path fill="none" stroke="#1c2123" d="M782,-271.5C782,-271.5 893,-271.5 893,-271.5 899,-271.5 905,-277.5 905,-283.5 905,-283.5 905,-335.5 905,-335.5 905,-341.5 899,-347.5 893,-347.5 893,-347.5 782,-347.5 782,-347.5 776,-347.5 770,-341.5 770,-335.5 770,-335.5 770,-283.5 770,-283.5 770,-277.5 776,-271.5 782,-271.5"/>
<text text-anchor="start" x="778" y="-332.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">StoreMeta</text>
<text text-anchor="start" x="778" y="-317.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_region</text>
<polyline fill="none" stroke="#1c2123" points="770,-309.5 905,-309.5 "/>
<text text-anchor="start" x="778" y="-294.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新StoreMeta</text>
<text text-anchor="start" x="778" y="-279.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 和peer的region信息</text>
</g>
<!-- region__mut_region_epoch__set_version&#45;&gt;StoreMeta__set_region -->
<g id="edge12" class="edge">
<title>region__mut_region_epoch__set_version&#45;&gt;StoreMeta__set_region</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M361.13,-299.74C458.93,-301.74 652.33,-305.72 759.86,-307.93"/>
<polygon fill="green" stroke="green" points="759.92,-311.43 769.99,-308.13 760.06,-304.43 759.92,-311.43"/>
</g>
<!-- PeerState__Normal&#45;&gt;write_peer_state -->
<g id="edge9" class="edge">
<title>PeerState__Normal&#45;&gt;write_peer_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M357.8,-394.46C367.46,-391.4 377.53,-388.2 387.31,-385.09"/>
<polygon fill="green" stroke="green" points="388.49,-388.39 396.96,-382.03 386.37,-381.72 388.49,-388.39"/>
</g>
<!-- PeerFsmDelegate__on_ready_rollback_merge -->
<g id="node6" class="node">
<title>PeerFsmDelegate__on_ready_rollback_merge</title>
<path fill="none" stroke="#1c2123" d="M551,-202.5C551,-202.5 690,-202.5 690,-202.5 696,-202.5 702,-208.5 702,-214.5 702,-214.5 702,-228.5 702,-228.5 702,-234.5 696,-240.5 690,-240.5 690,-240.5 551,-240.5 551,-240.5 545,-240.5 539,-234.5 539,-228.5 539,-228.5 539,-214.5 539,-214.5 539,-208.5 545,-202.5 551,-202.5"/>
<text text-anchor="start" x="547" y="-225.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="547" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_ready_rollback_merge</text>
</g>
<!-- ExecResult__RollbackMerge&#45;&gt;PeerFsmDelegate__on_ready_rollback_merge -->
<g id="edge15" class="edge">
<title>ExecResult__RollbackMerge&#45;&gt;PeerFsmDelegate__on_ready_rollback_merge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M502.93,-228.42C511.22,-227.93 520,-227.4 528.88,-226.88"/>
<polygon fill="green" stroke="green" points="529.15,-230.37 538.92,-226.28 528.73,-223.38 529.15,-230.37"/>
</g>
<!-- PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;StoreMeta__set_region -->
<g id="edge5" class="edge">
<title>PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;StoreMeta__set_region</title>
<path fill="none" stroke="#666666" d="M668.15,-240.59C695.13,-251.64 729.72,-265.79 760.53,-278.4"/>
<polygon fill="#666666" stroke="#666666" points="759.37,-281.71 769.95,-282.26 762.02,-275.23 759.37,-281.71"/>
</g>
<!-- Peer__pending_merge_state -->
<g id="node8" class="node">
<title>Peer__pending_merge_state</title>
<path fill="#feed9b" stroke="#f7e495" d="M778.5,-191C778.5,-191 896.5,-191 896.5,-191 902.5,-191 908.5,-197 908.5,-203 908.5,-203 908.5,-240 908.5,-240 908.5,-246 902.5,-252 896.5,-252 896.5,-252 778.5,-252 778.5,-252 772.5,-252 766.5,-246 766.5,-240 766.5,-240 766.5,-203 766.5,-203 766.5,-197 772.5,-191 778.5,-191"/>
<text text-anchor="start" x="774.5" y="-236.8" font-family="Times,serif" font-size="14.00" fill="#40575d">Peer</text>
<text text-anchor="start" x="774.5" y="-221.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> pending_merge_state</text>
<polyline fill="none" stroke="#f7e495" points="766.5,-214 908.5,-214 "/>
<text text-anchor="start" x="774.5" y="-198.8" font-family="Times,serif" font-size="14.00" fill="#40575d">将该state设置为None</text>
</g>
<!-- PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__pending_merge_state -->
<g id="edge6" class="edge">
<title>PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__pending_merge_state</title>
<path fill="none" stroke="#666666" d="M702.17,-221.5C719.8,-221.5 738.46,-221.5 756.08,-221.5"/>
<polygon fill="#666666" stroke="#666666" points="756.32,-225 766.32,-221.5 756.32,-218 756.32,-225"/>
</g>
<!-- Peer__want_rollback_merge_peers__clear -->
<g id="node9" class="node">
<title>Peer__want_rollback_merge_peers__clear</title>
<path fill="none" stroke="#1c2123" d="M750,-95.5C750,-95.5 925,-95.5 925,-95.5 931,-95.5 937,-101.5 937,-107.5 937,-107.5 937,-159.5 937,-159.5 937,-165.5 931,-171.5 925,-171.5 925,-171.5 750,-171.5 750,-171.5 744,-171.5 738,-165.5 738,-159.5 738,-159.5 738,-107.5 738,-107.5 738,-101.5 744,-95.5 750,-95.5"/>
<text text-anchor="start" x="746" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="746" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> want_rollback_merge_peers</text>
<text text-anchor="start" x="746" y="-126.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> clear</text>
<polyline fill="none" stroke="#1c2123" points="738,-118.5 937,-118.5 "/>
<text text-anchor="start" x="746" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">清空want_rollback_merge_peers</text>
</g>
<!-- PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__want_rollback_merge_peers__clear -->
<g id="edge7" class="edge">
<title>PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__want_rollback_merge_peers__clear</title>
<path fill="none" stroke="#666666" d="M668.15,-202.41C687.58,-194.45 710.97,-184.88 734.04,-175.44"/>
<polygon fill="#666666" stroke="#666666" points="735.62,-178.57 743.55,-171.55 732.97,-172.09 735.62,-178.57"/>
</g>
<!-- Peer__heartbeat_pd -->
<g id="node10" class="node">
<title>Peer__heartbeat_pd</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M782.5,-0.5C782.5,-0.5 892.5,-0.5 892.5,-0.5 898.5,-0.5 904.5,-6.5 904.5,-12.5 904.5,-12.5 904.5,-64.5 904.5,-64.5 904.5,-70.5 898.5,-76.5 892.5,-76.5 892.5,-76.5 782.5,-76.5 782.5,-76.5 776.5,-76.5 770.5,-70.5 770.5,-64.5 770.5,-64.5 770.5,-12.5 770.5,-12.5 770.5,-6.5 776.5,-0.5 782.5,-0.5"/>
<text text-anchor="start" x="778.5" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Peer</text>
<text text-anchor="start" x="778.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> heartbeat_pd</text>
<polyline fill="none" stroke="#8a8898" points="770.5,-38.5 904.5,-38.5 "/>
<text text-anchor="start" x="778.5" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果是leader节点</text>
<text text-anchor="start" x="778.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 向pd上报当前信息</text>
</g>
<!-- PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__heartbeat_pd -->
<g id="edge8" class="edge">
<title>PeerFsmDelegate__on_ready_rollback_merge&#45;&gt;Peer__heartbeat_pd</title>
<path fill="none" stroke="#666666" d="M634.14,-202.13C653.59,-173.54 693.33,-119.73 738,-85.5 745.23,-79.96 753.23,-74.84 761.44,-70.18"/>
<polygon fill="#666666" stroke="#666666" points="763.29,-73.15 770.41,-65.3 759.95,-67 763.29,-73.15"/>
</g>
<!-- PeerFsmDelegate__on_check_merge -->
<g id="node11" class="node">
<title>PeerFsmDelegate__on_check_merge</title>
<path fill="none" stroke="#1c2123" d="M985,-231C985,-231 1128,-231 1128,-231 1134,-231 1140,-237 1140,-243 1140,-243 1140,-280 1140,-280 1140,-286 1134,-292 1128,-292 1128,-292 985,-292 985,-292 979,-292 973,-286 973,-280 973,-280 973,-243 973,-243 973,-237 979,-231 985,-231"/>
<text text-anchor="start" x="981" y="-276.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="981" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_check_merge</text>
<polyline fill="none" stroke="#1c2123" points="973,-254 1140,-254 "/>
<text text-anchor="start" x="981" y="-238.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">停止注册merge check tick</text>
</g>
<!-- Peer__pending_merge_state&#45;&gt;PeerFsmDelegate__on_check_merge -->
<g id="edge13" class="edge">
<title>Peer__pending_merge_state&#45;&gt;PeerFsmDelegate__on_check_merge</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M908.65,-234.43C925.89,-237.61 944.61,-241.06 962.74,-244.4"/>
<polygon fill="green" stroke="green" points="962.26,-247.87 972.73,-246.24 963.53,-240.99 962.26,-247.87"/>
</g>
<!-- Peer__propose_normal -->
<g id="node12" class="node">
<title>Peer__propose_normal</title>
<path fill="none" stroke="#1c2123" d="M1003,-151C1003,-151 1110,-151 1110,-151 1116,-151 1122,-157 1122,-163 1122,-163 1122,-200 1122,-200 1122,-206 1116,-212 1110,-212 1110,-212 1003,-212 1003,-212 997,-212 991,-206 991,-200 991,-200 991,-163 991,-163 991,-157 997,-151 1003,-151"/>
<text text-anchor="start" x="999" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="999" y="-181.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> propose_normal</text>
<polyline fill="none" stroke="#1c2123" points="991,-174 1122,-174 "/>
<text text-anchor="start" x="999" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">可以正常propose了</text>
</g>
<!-- Peer__pending_merge_state&#45;&gt;Peer__propose_normal -->
<g id="edge14" class="edge">
<title>Peer__pending_merge_state&#45;&gt;Peer__propose_normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M908.65,-208.57C931.73,-204.31 957.47,-199.57 980.87,-195.26"/>
<polygon fill="green" stroke="green" points="981.54,-198.69 990.74,-193.44 980.27,-191.81 981.54,-198.69"/>
</g>
</g>
</svg>
