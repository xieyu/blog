<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="995pt" height="366pt"
 viewBox="0.00 0.00 995.00 366.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 362)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-362 991,-362 991,4 -4,4"/>
<!-- LockResolver__getTxnStatusFromLock -->
<g id="node1" class="node">
<title>LockResolver__getTxnStatusFromLock</title>
<path fill="none" stroke="#1c2123" d="M12,-82C12,-82 137,-82 137,-82 143,-82 149,-88 149,-94 149,-94 149,-131 149,-131 149,-137 143,-143 137,-143 137,-143 12,-143 12,-143 6,-143 0,-137 0,-131 0,-131 0,-94 0,-94 0,-88 6,-82 12,-82"/>
<text text-anchor="start" x="8" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="8" y="-112.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> getTxnStatusFromLock</text>
<polyline fill="none" stroke="#1c2123" points="0,-105 149,-105 "/>
<text text-anchor="start" x="8" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据lock获取txn 状态</text>
</g>
<!-- TxnStatus -->
<g id="node2" class="node">
<title>TxnStatus</title>
<path fill="#bcffb9" stroke="#8a8898" d="M410,-96C410,-96 583,-96 583,-96 589,-96 595,-102 595,-108 595,-108 595,-199 595,-199 595,-205 589,-211 583,-211 583,-211 410,-211 410,-211 404,-211 398,-205 398,-199 398,-199 398,-108 398,-108 398,-102 404,-96 410,-96"/>
<text text-anchor="middle" x="496.5" y="-195.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<polyline fill="none" stroke="#8a8898" points="398,-188 595,-188 "/>
<text text-anchor="start" x="406" y="-172.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ttl uint64</text>
<polyline fill="none" stroke="#8a8898" points="398,-165 595,-165 "/>
<text text-anchor="start" x="406" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">commitTS uint64</text>
<polyline fill="none" stroke="#8a8898" points="398,-142 595,-142 "/>
<text text-anchor="start" x="406" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">action kvrpcpb.Action</text>
<polyline fill="none" stroke="#8a8898" points="398,-119 595,-119 "/>
<text text-anchor="start" x="406" y="-103.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">primaryLock *kvrpcpb.LockInfo</text>
</g>
<!-- LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus -->
<g id="edge1" class="edge">
<title>LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M149.19,-128.74C161.12,-130.95 173.37,-132.98 185,-134.5 252.08,-143.25 327.85,-147.98 387.74,-150.54"/>
<polygon fill="green" stroke="green" points="387.84,-154.05 397.98,-150.96 388.13,-147.05 387.84,-154.05"/>
</g>
<!-- LockResolver__getTxnStatus -->
<g id="node4" class="node">
<title>LockResolver__getTxnStatus</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M197,-18.5C197,-18.5 350,-18.5 350,-18.5 356,-18.5 362,-24.5 362,-30.5 362,-30.5 362,-112.5 362,-112.5 362,-118.5 356,-124.5 350,-124.5 350,-124.5 197,-124.5 197,-124.5 191,-124.5 185,-118.5 185,-112.5 185,-112.5 185,-30.5 185,-30.5 185,-24.5 191,-18.5 197,-18.5"/>
<text text-anchor="start" x="193" y="-109.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="193" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> getTxnStatus</text>
<polyline fill="none" stroke="#8a8898" points="185,-86.5 362,-86.5 "/>
<text text-anchor="start" x="193" y="-71.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">发送CheckTxnStatus请求到</text>
<text text-anchor="start" x="193" y="-56.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> lock.primary key所在的</text>
<text text-anchor="start" x="193" y="-41.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> region TiKV 服务</text>
<text text-anchor="start" x="193" y="-26.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 获取txn状态</text>
</g>
<!-- LockResolver__getTxnStatusFromLock&#45;&gt;LockResolver__getTxnStatus -->
<g id="edge3" class="edge">
<title>LockResolver__getTxnStatusFromLock&#45;&gt;LockResolver__getTxnStatus</title>
<path fill="none" stroke="#666666" d="M149.14,-97.17C157.63,-95.41 166.39,-93.58 175.14,-91.76"/>
<polygon fill="#666666" stroke="#666666" points="175.92,-95.18 185,-89.71 174.49,-88.32 175.92,-95.18"/>
</g>
<!-- TxnStatus__ttl -->
<g id="node3" class="node">
<title>TxnStatus__ttl</title>
<path fill="none" stroke="#1c2123" d="M685.5,-281.5C685.5,-281.5 753.5,-281.5 753.5,-281.5 759.5,-281.5 765.5,-287.5 765.5,-293.5 765.5,-293.5 765.5,-345.5 765.5,-345.5 765.5,-351.5 759.5,-357.5 753.5,-357.5 753.5,-357.5 685.5,-357.5 685.5,-357.5 679.5,-357.5 673.5,-351.5 673.5,-345.5 673.5,-345.5 673.5,-293.5 673.5,-293.5 673.5,-287.5 679.5,-281.5 685.5,-281.5"/>
<text text-anchor="start" x="681.5" y="-342.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus::ttl</text>
<polyline fill="none" stroke="#1c2123" points="673.5,-334.5 765.5,-334.5 "/>
<text text-anchor="start" x="681.5" y="-319.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务ttl为0</text>
<text text-anchor="start" x="681.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn过期了</text>
<text text-anchor="start" x="681.5" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 可以清理掉</text>
</g>
<!-- TxnStatus&#45;&gt;TxnStatus__ttl -->
<g id="edge2" class="edge">
<title>TxnStatus&#45;&gt;TxnStatus__ttl</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M556.95,-211.13C579.27,-231.37 605.44,-253.53 631,-271.5 641.4,-278.81 653.03,-285.88 664.33,-292.24"/>
<polygon fill="green" stroke="green" points="662.84,-295.41 673.28,-297.17 666.22,-289.28 662.84,-295.41"/>
</g>
<!-- LockResolver__saveResolved -->
<g id="node5" class="node">
<title>LockResolver__saveResolved</title>
<path fill="none" stroke="#1c2123" d="M656,-201C656,-201 783,-201 783,-201 789,-201 795,-207 795,-213 795,-213 795,-250 795,-250 795,-256 789,-262 783,-262 783,-262 656,-262 656,-262 650,-262 644,-256 644,-250 644,-250 644,-213 644,-213 644,-207 650,-201 656,-201"/>
<text text-anchor="start" x="652" y="-246.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="652" y="-231.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> saveResolved</text>
<polyline fill="none" stroke="#1c2123" points="644,-224 795,-224 "/>
<text text-anchor="start" x="652" y="-208.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">保存已经resolved的txn</text>
</g>
<!-- TxnStatus&#45;&gt;LockResolver__saveResolved -->
<g id="edge4" class="edge">
<title>TxnStatus&#45;&gt;LockResolver__saveResolved</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M595.08,-187.94C608.07,-192.52 621.3,-197.2 634.05,-201.69"/>
<polygon fill="green" stroke="green" points="633.09,-205.07 643.68,-205.09 635.42,-198.47 633.09,-205.07"/>
</g>
<!-- Action -->
<g id="node8" class="node">
<title>Action</title>
<path fill="none" stroke="#1c2123" d="M643,-121C643,-121 796,-121 796,-121 802,-121 808,-127 808,-133 808,-133 808,-170 808,-170 808,-176 802,-182 796,-182 796,-182 643,-182 643,-182 637,-182 631,-176 631,-170 631,-170 631,-133 631,-133 631,-127 637,-121 643,-121"/>
<text text-anchor="start" x="639" y="-166.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action</text>
<polyline fill="none" stroke="#1c2123" points="631,-159 808,-159 "/>
<text text-anchor="start" x="639" y="-143.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TikV在执行CheckTxnStatus</text>
<text text-anchor="start" x="639" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 时所执行的action</text>
</g>
<!-- TxnStatus&#45;&gt;Action -->
<g id="edge9" class="edge">
<title>TxnStatus&#45;&gt;Action</title>
<path fill="none" stroke="#666666" d="M595.08,-152.62C603.54,-152.54 612.11,-152.46 620.58,-152.39"/>
<polygon fill="#666666" stroke="#666666" points="620.88,-155.88 630.85,-152.29 620.82,-148.88 620.88,-155.88"/>
</g>
<!-- LockInfo -->
<g id="node9" class="node">
<title>LockInfo</title>
<path fill="none" stroke="#1c2123" d="M741,-102.5C741,-102.5 698,-102.5 698,-102.5 692,-102.5 686,-96.5 686,-90.5 686,-90.5 686,-78.5 686,-78.5 686,-72.5 692,-66.5 698,-66.5 698,-66.5 741,-66.5 741,-66.5 747,-66.5 753,-72.5 753,-78.5 753,-78.5 753,-90.5 753,-90.5 753,-96.5 747,-102.5 741,-102.5"/>
<text text-anchor="middle" x="719.5" y="-80.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockInfo</text>
</g>
<!-- TxnStatus&#45;&gt;LockInfo -->
<g id="edge10" class="edge">
<title>TxnStatus&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" d="M595.18,-122.7C607.24,-118.92 619.4,-115.11 631,-111.5 645.68,-106.93 661.75,-101.96 676.07,-97.54"/>
<polygon fill="#666666" stroke="#666666" points="677.14,-100.88 685.66,-94.59 675.07,-94.19 677.14,-100.88"/>
</g>
<!-- LockResolver__getTxnStatus&#45;&gt;TxnStatus -->
<g id="edge5" class="edge">
<title>LockResolver__getTxnStatus&#45;&gt;TxnStatus</title>
<path fill="none" stroke="#666666" d="M362.16,-104.03C370.75,-107.21 379.52,-110.47 388.27,-113.71"/>
<polygon fill="#666666" stroke="#666666" points="387.15,-117.03 397.75,-117.23 389.59,-110.47 387.15,-117.03"/>
</g>
<!-- LockResolver__getResolved -->
<g id="node6" class="node">
<title>LockResolver__getResolved</title>
<path fill="none" stroke="#1c2123" d="M429,-0.5C429,-0.5 564,-0.5 564,-0.5 570,-0.5 576,-6.5 576,-12.5 576,-12.5 576,-64.5 576,-64.5 576,-70.5 570,-76.5 564,-76.5 564,-76.5 429,-76.5 429,-76.5 423,-76.5 417,-70.5 417,-64.5 417,-64.5 417,-12.5 417,-12.5 417,-6.5 423,-0.5 429,-0.5"/>
<text text-anchor="start" x="425" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="425" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> getResolved</text>
<polyline fill="none" stroke="#1c2123" points="417,-38.5 576,-38.5 "/>
<text text-anchor="start" x="425" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">向TiKV发起请求之前</text>
<text text-anchor="start" x="425" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先看是否已经resolve了</text>
</g>
<!-- LockResolver__getTxnStatus&#45;&gt;LockResolver__getResolved -->
<g id="edge6" class="edge">
<title>LockResolver__getTxnStatus&#45;&gt;LockResolver__getResolved</title>
<path fill="none" stroke="#666666" d="M362.16,-58.41C376.85,-56.22 392.1,-53.94 406.81,-51.74"/>
<polygon fill="#666666" stroke="#666666" points="407.53,-55.18 416.9,-50.24 406.49,-48.25 407.53,-55.18"/>
</g>
<!-- LockResolver__mu__resolved -->
<g id="node7" class="node">
<title>LockResolver__mu__resolved</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M856,-89C856,-89 975,-89 975,-89 981,-89 987,-95 987,-101 987,-101 987,-168 987,-168 987,-174 981,-180 975,-180 975,-180 856,-180 856,-180 850,-180 844,-174 844,-168 844,-168 844,-101 844,-101 844,-95 850,-89 856,-89"/>
<text text-anchor="start" x="852" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="852" y="-149.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> mu.resolved</text>
<text text-anchor="start" x="852" y="-134.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> map[uint64]TxnStatus</text>
<polyline fill="none" stroke="#8a8898" points="844,-127 987,-127 "/>
<text text-anchor="start" x="852" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">记录已经resolved</text>
<text text-anchor="start" x="852" y="-96.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的txn</text>
</g>
<!-- LockResolver__saveResolved&#45;&gt;LockResolver__mu__resolved -->
<g id="edge7" class="edge">
<title>LockResolver__saveResolved&#45;&gt;LockResolver__mu__resolved</title>
<path fill="none" stroke="#666666" d="M788.53,-200.91C795.14,-197.78 801.71,-194.62 808,-191.5 816.74,-187.17 825.81,-182.53 834.82,-177.84"/>
<polygon fill="#666666" stroke="#666666" points="836.55,-180.88 843.79,-173.14 833.3,-174.68 836.55,-180.88"/>
</g>
<!-- LockResolver__getResolved&#45;&gt;LockResolver__mu__resolved -->
<g id="edge8" class="edge">
<title>LockResolver__getResolved&#45;&gt;LockResolver__mu__resolved</title>
<path fill="none" stroke="#666666" d="M576.15,-31.43C640.41,-28.43 732.61,-30.53 808,-57.5 824.52,-63.41 840.73,-72.72 855.32,-82.85"/>
<polygon fill="#666666" stroke="#666666" points="853.55,-85.89 863.71,-88.89 857.64,-80.21 853.55,-85.89"/>
</g>
</g>
</svg>
