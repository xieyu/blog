<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: doActionOnBatches Pages: 1 -->
<svg width="856pt" height="434pt"
 viewBox="0.00 0.00 856.00 433.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 429.5)">
<title>doActionOnBatches</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-429.5 852,-429.5 852,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_batchExecutor</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M179.5,-55.5C179.5,-55.5 828,-55.5 828,-55.5 834,-55.5 840,-61.5 840,-67.5 840,-67.5 840,-369.5 840,-369.5 840,-375.5 834,-381.5 828,-381.5 828,-381.5 179.5,-381.5 179.5,-381.5 173.5,-381.5 167.5,-375.5 167.5,-369.5 167.5,-369.5 167.5,-67.5 167.5,-67.5 167.5,-61.5 173.5,-55.5 179.5,-55.5"/>
<text text-anchor="middle" x="503.75" y="-361.5" font-family="Times,serif" font-size="20.00">batchExecutor</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_RateLimiter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M358,-63.5C358,-63.5 818,-63.5 818,-63.5 824,-63.5 830,-69.5 830,-75.5 830,-75.5 830,-165.5 830,-165.5 830,-171.5 824,-177.5 818,-177.5 818,-177.5 358,-177.5 358,-177.5 352,-177.5 346,-171.5 346,-165.5 346,-165.5 346,-75.5 346,-75.5 346,-69.5 352,-63.5 358,-63.5"/>
<text text-anchor="middle" x="588" y="-157.5" font-family="Times,serif" font-size="20.00">RateLimiter</text>
</g>
<!-- doActionOnBatches -->
<g id="node1" class="node">
<title>doActionOnBatches</title>
<path fill="none" stroke="#1c2123" d="M114,-302.5C114,-302.5 12,-302.5 12,-302.5 6,-302.5 0,-296.5 0,-290.5 0,-290.5 0,-278.5 0,-278.5 0,-272.5 6,-266.5 12,-266.5 12,-266.5 114,-266.5 114,-266.5 120,-266.5 126,-272.5 126,-278.5 126,-278.5 126,-290.5 126,-290.5 126,-296.5 120,-302.5 114,-302.5"/>
<text text-anchor="middle" x="63" y="-280.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnBatches</text>
</g>
<!-- handleSignleBatch -->
<g id="node2" class="node">
<title>handleSignleBatch</title>
<path fill="none" stroke="#1c2123" d="M282.5,-425.5C282.5,-425.5 187.5,-425.5 187.5,-425.5 181.5,-425.5 175.5,-419.5 175.5,-413.5 175.5,-413.5 175.5,-401.5 175.5,-401.5 175.5,-395.5 181.5,-389.5 187.5,-389.5 187.5,-389.5 282.5,-389.5 282.5,-389.5 288.5,-389.5 294.5,-395.5 294.5,-401.5 294.5,-401.5 294.5,-413.5 294.5,-413.5 294.5,-419.5 288.5,-425.5 282.5,-425.5"/>
<text text-anchor="middle" x="235" y="-403.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSignleBatch</text>
</g>
<!-- doActionOnBatches&#45;&gt;handleSignleBatch -->
<g id="edge1" class="edge">
<title>doActionOnBatches&#45;&gt;handleSignleBatch</title>
<path fill="none" stroke="#666666" d="M76.85,-302.52C93.86,-325.08 125.93,-363.46 162,-385.5 163.29,-386.29 164.61,-387.05 165.95,-387.79"/>
<polygon fill="#666666" stroke="#666666" points="164.62,-391.03 175.14,-392.28 167.7,-384.74 164.62,-391.03"/>
</g>
<!-- newBatchExecutor -->
<g id="node3" class="node">
<title>newBatchExecutor</title>
<path fill="none" stroke="#1c2123" d="M282.5,-329.5C282.5,-329.5 187.5,-329.5 187.5,-329.5 181.5,-329.5 175.5,-323.5 175.5,-317.5 175.5,-317.5 175.5,-305.5 175.5,-305.5 175.5,-299.5 181.5,-293.5 187.5,-293.5 187.5,-293.5 282.5,-293.5 282.5,-293.5 288.5,-293.5 294.5,-299.5 294.5,-305.5 294.5,-305.5 294.5,-317.5 294.5,-317.5 294.5,-323.5 288.5,-329.5 282.5,-329.5"/>
<text text-anchor="middle" x="235" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">newBatchExecutor</text>
</g>
<!-- doActionOnBatches&#45;&gt;newBatchExecutor -->
<g id="edge2" class="edge">
<title>doActionOnBatches&#45;&gt;newBatchExecutor</title>
<path fill="none" stroke="#666666" d="M126.34,-294.4C138.97,-296.41 152.33,-298.53 165.18,-300.57"/>
<polygon fill="#666666" stroke="#666666" points="164.92,-304.07 175.35,-302.18 166.02,-297.16 164.92,-304.07"/>
</g>
<!-- process -->
<g id="node4" class="node">
<title>process</title>
<path fill="none" stroke="#1c2123" d="M251.5,-275.5C251.5,-275.5 218.5,-275.5 218.5,-275.5 212.5,-275.5 206.5,-269.5 206.5,-263.5 206.5,-263.5 206.5,-251.5 206.5,-251.5 206.5,-245.5 212.5,-239.5 218.5,-239.5 218.5,-239.5 251.5,-239.5 251.5,-239.5 257.5,-239.5 263.5,-245.5 263.5,-251.5 263.5,-251.5 263.5,-263.5 263.5,-263.5 263.5,-269.5 257.5,-275.5 251.5,-275.5"/>
<text text-anchor="middle" x="235" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">process</text>
</g>
<!-- doActionOnBatches&#45;&gt;process -->
<g id="edge3" class="edge">
<title>doActionOnBatches&#45;&gt;process</title>
<path fill="none" stroke="#666666" d="M126.34,-274.6C149.85,-270.87 175.85,-266.74 196.41,-263.47"/>
<polygon fill="#666666" stroke="#666666" points="197,-266.92 206.33,-261.89 195.9,-260.01 197,-266.92"/>
</g>
<!-- CommitterConcurrency -->
<g id="node5" class="node">
<title>CommitterConcurrency</title>
<path fill="none" stroke="#1c2123" d="M174,-0.5C174,-0.5 296,-0.5 296,-0.5 302,-0.5 308,-6.5 308,-12.5 308,-12.5 308,-34.5 308,-34.5 308,-40.5 302,-46.5 296,-46.5 296,-46.5 174,-46.5 174,-46.5 168,-46.5 162,-40.5 162,-34.5 162,-34.5 162,-12.5 162,-12.5 162,-6.5 168,-0.5 174,-0.5"/>
<text text-anchor="middle" x="235" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitterConcurrency</text>
<polyline fill="none" stroke="#1c2123" points="162,-23.5 308,-23.5 "/>
<text text-anchor="middle" x="235" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">控制rateLimiter</text>
</g>
<!-- doActionOnBatches&#45;&gt;CommitterConcurrency -->
<g id="edge4" class="edge">
<title>doActionOnBatches&#45;&gt;CommitterConcurrency</title>
<path fill="none" stroke="#666666" d="M66.71,-266.35C73.8,-224.71 96.63,-121.11 160.37,-53.93"/>
<polygon fill="#666666" stroke="#666666" points="162.95,-56.3 167.5,-46.74 157.98,-51.38 162.95,-56.3"/>
</g>
<!-- startWorker -->
<g id="node6" class="node">
<title>startWorker</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M356,-225.5C356,-225.5 430,-225.5 430,-225.5 436,-225.5 442,-231.5 442,-237.5 442,-237.5 442,-249.5 442,-249.5 442,-255.5 436,-261.5 430,-261.5 430,-261.5 356,-261.5 356,-261.5 350,-261.5 344,-255.5 344,-249.5 344,-249.5 344,-237.5 344,-237.5 344,-231.5 350,-225.5 356,-225.5"/>
<text text-anchor="start" x="352" y="-239.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">go startWorker</text>
</g>
<!-- process&#45;&gt;startWorker -->
<g id="edge5" class="edge">
<title>process&#45;&gt;startWorker</title>
<path fill="none" stroke="#666666" d="M263.53,-255.03C282.97,-253.28 309.74,-250.88 333.81,-248.72"/>
<polygon fill="#666666" stroke="#666666" points="334.29,-252.19 343.94,-247.81 333.66,-245.22 334.29,-252.19"/>
</g>
<!-- wait_ch -->
<g id="node7" class="node">
<title>wait_ch</title>
<path fill="none" stroke="#1c2123" d="M507.5,-296.5C507.5,-296.5 608.5,-296.5 608.5,-296.5 614.5,-296.5 620.5,-302.5 620.5,-308.5 620.5,-308.5 620.5,-330.5 620.5,-330.5 620.5,-336.5 614.5,-342.5 608.5,-342.5 608.5,-342.5 507.5,-342.5 507.5,-342.5 501.5,-342.5 495.5,-336.5 495.5,-330.5 495.5,-330.5 495.5,-308.5 495.5,-308.5 495.5,-302.5 501.5,-296.5 507.5,-296.5"/>
<text text-anchor="middle" x="558" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wait ch</text>
<polyline fill="none" stroke="#1c2123" points="495.5,-319.5 620.5,-319.5 "/>
<text text-anchor="start" x="503.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">等待baches处理完</text>
</g>
<!-- process&#45;&gt;wait_ch -->
<g id="edge6" class="edge">
<title>process&#45;&gt;wait_ch</title>
<path fill="none" stroke="#666666" d="M263.65,-262.84C312.42,-272.26 415.2,-292.11 485.19,-305.63"/>
<polygon fill="#666666" stroke="#666666" points="484.78,-309.12 495.26,-307.58 486.11,-302.24 484.78,-309.12"/>
</g>
<!-- rateLimiter -->
<g id="node12" class="node">
<title>rateLimiter</title>
<path fill="none" stroke="#1c2123" d="M420,-107.5C420,-107.5 366,-107.5 366,-107.5 360,-107.5 354,-101.5 354,-95.5 354,-95.5 354,-83.5 354,-83.5 354,-77.5 360,-71.5 366,-71.5 366,-71.5 420,-71.5 420,-71.5 426,-71.5 432,-77.5 432,-83.5 432,-83.5 432,-95.5 432,-95.5 432,-101.5 426,-107.5 420,-107.5"/>
<text text-anchor="middle" x="393" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter</text>
</g>
<!-- CommitterConcurrency&#45;&gt;rateLimiter -->
<g id="edge12" class="edge">
<title>CommitterConcurrency&#45;&gt;rateLimiter</title>
<path fill="none" stroke="#666666" d="M296.21,-46.63C300.21,-48.26 304.17,-49.89 308,-51.5 319.88,-56.49 332.59,-62.1 344.44,-67.44"/>
<polygon fill="#666666" stroke="#666666" points="343.17,-70.71 353.72,-71.66 346.06,-64.34 343.17,-70.71"/>
</g>
<!-- startWorker&#45;&gt;wait_ch -->
<g id="edge9" class="edge">
<title>startWorker&#45;&gt;wait_ch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M428.03,-261.68C443.2,-269.58 461.36,-278.78 478,-286.5 482.13,-288.42 486.41,-290.35 490.73,-292.26"/>
<polygon fill="green" stroke="green" points="489.67,-295.62 500.24,-296.41 492.47,-289.2 489.67,-295.62"/>
</g>
<!-- rateLimiter_GetToken -->
<g id="node8" class="node">
<title>rateLimiter_GetToken</title>
<path fill="none" stroke="#1c2123" d="M496,-92.5C496,-92.5 620,-92.5 620,-92.5 626,-92.5 632,-98.5 632,-104.5 632,-104.5 632,-126.5 632,-126.5 632,-132.5 626,-138.5 620,-138.5 620,-138.5 496,-138.5 496,-138.5 490,-138.5 484,-132.5 484,-126.5 484,-126.5 484,-104.5 484,-104.5 484,-98.5 490,-92.5 496,-92.5"/>
<text text-anchor="middle" x="558" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter::GetToken</text>
<polyline fill="none" stroke="#1c2123" points="484,-115.5 632,-115.5 "/>
<text text-anchor="start" x="492" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">block一直等到有token</text>
</g>
<!-- startWorker&#45;&gt;rateLimiter_GetToken -->
<g id="edge7" class="edge">
<title>startWorker&#45;&gt;rateLimiter_GetToken</title>
<path fill="none" stroke="#666666" d="M408.52,-225.19C427.25,-201.69 459.07,-162.29 477.96,-144.98"/>
<polygon fill="#666666" stroke="#666666" points="480.3,-147.58 485.86,-138.56 475.89,-142.15 480.3,-147.58"/>
</g>
<!-- go_func -->
<g id="node9" class="node">
<title>go_func</title>
<path fill="#bcffb9" stroke="#8a8898" d="M490,-186C490,-186 626,-186 626,-186 632,-186 638,-192 638,-198 638,-198 638,-265 638,-265 638,-271 632,-277 626,-277 626,-277 490,-277 490,-277 484,-277 478,-271 478,-265 478,-265 478,-198 478,-198 478,-192 484,-186 490,-186"/>
<text text-anchor="start" x="486" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">go func {...}</text>
<polyline fill="none" stroke="#8a8898" points="478,-254 638,-254 "/>
<text text-anchor="start" x="486" y="-238.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">启动一个新的go routine</text>
<text text-anchor="start" x="486" y="-223.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 发送batches</text>
<text text-anchor="start" x="486" y="-208.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> go routine跑完后</text>
<text text-anchor="start" x="486" y="-193.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 调用PutToken归还token</text>
</g>
<!-- startWorker&#45;&gt;go_func -->
<g id="edge8" class="edge">
<title>startWorker&#45;&gt;go_func</title>
<path fill="none" stroke="#666666" d="M442.02,-239.96C450.21,-239.36 458.94,-238.72 467.8,-238.07"/>
<polygon fill="#666666" stroke="#666666" points="468.11,-241.55 477.83,-237.33 467.6,-234.57 468.11,-241.55"/>
</g>
<!-- rateLimiter_PutToken -->
<g id="node10" class="node">
<title>rateLimiter_PutToken</title>
<path fill="none" stroke="#1c2123" d="M696,-82.5C696,-82.5 810,-82.5 810,-82.5 816,-82.5 822,-88.5 822,-94.5 822,-94.5 822,-116.5 822,-116.5 822,-122.5 816,-128.5 810,-128.5 810,-128.5 696,-128.5 696,-128.5 690,-128.5 684,-122.5 684,-116.5 684,-116.5 684,-94.5 684,-94.5 684,-88.5 690,-82.5 696,-82.5"/>
<text text-anchor="middle" x="753" y="-113.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter::PutToken</text>
<polyline fill="none" stroke="#1c2123" points="684,-105.5 822,-105.5 "/>
<text text-anchor="middle" x="753" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">go routin归还token</text>
</g>
<!-- go_func&#45;&gt;rateLimiter_PutToken -->
<g id="edge10" class="edge">
<title>go_func&#45;&gt;rateLimiter_PutToken</title>
<path fill="none" stroke="#666666" d="M633.22,-185.74C634.85,-184.35 636.45,-182.93 638,-181.5 657.59,-163.41 652.55,-149.34 674,-133.5 674.39,-133.21 674.78,-132.93 675.18,-132.64"/>
<polygon fill="#666666" stroke="#666666" points="677.36,-135.41 683.92,-127.09 673.6,-129.5 677.36,-135.41"/>
</g>
<!-- action_handleSingleBatch -->
<g id="node11" class="node">
<title>action_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M820,-249.5C820,-249.5 686,-249.5 686,-249.5 680,-249.5 674,-243.5 674,-237.5 674,-237.5 674,-225.5 674,-225.5 674,-219.5 680,-213.5 686,-213.5 686,-213.5 820,-213.5 820,-213.5 826,-213.5 832,-219.5 832,-225.5 832,-225.5 832,-237.5 832,-237.5 832,-243.5 826,-249.5 820,-249.5"/>
<text text-anchor="middle" x="753" y="-227.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">action_handleSingleBatch</text>
</g>
<!-- go_func&#45;&gt;action_handleSingleBatch -->
<g id="edge11" class="edge">
<title>go_func&#45;&gt;action_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M638.06,-231.5C646.42,-231.5 654.96,-231.5 663.43,-231.5"/>
<polygon fill="#666666" stroke="#666666" points="663.69,-235 673.69,-231.5 663.69,-228 663.69,-235"/>
</g>
<!-- rateLimiter&#45;&gt;rateLimiter_GetToken -->
<g id="edge13" class="edge">
<title>rateLimiter&#45;&gt;rateLimiter_GetToken</title>
<path fill="none" stroke="#666666" d="M432.22,-95.6C444.75,-97.6 459.22,-99.9 473.76,-102.22"/>
<polygon fill="#666666" stroke="#666666" points="473.38,-105.71 483.81,-103.83 474.49,-98.79 473.38,-105.71"/>
</g>
<!-- rateLimiter&#45;&gt;rateLimiter_PutToken -->
<g id="edge14" class="edge">
<title>rateLimiter&#45;&gt;rateLimiter_PutToken</title>
<path fill="none" stroke="#666666" d="M432.02,-86.21C446.41,-85.11 462.95,-84.04 478,-83.5 549.07,-80.97 567.21,-76.73 638,-83.5 649.68,-84.62 661.94,-86.36 673.91,-88.39"/>
<polygon fill="#666666" stroke="#666666" points="673.43,-91.86 683.89,-90.16 674.65,-84.97 673.43,-91.86"/>
</g>
</g>
</svg>
