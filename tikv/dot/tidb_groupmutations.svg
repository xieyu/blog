<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: group_mutations Pages: 1 -->
<svg width="892pt" height="380pt"
 viewBox="0.00 0.00 892.00 379.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 375.5)">
<title>group_mutations</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-375.5 888,-375.5 888,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_TiKV</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M764,-173.5C764,-173.5 864,-173.5 864,-173.5 870,-173.5 876,-179.5 876,-185.5 876,-185.5 876,-243.5 876,-243.5 876,-249.5 870,-255.5 864,-255.5 864,-255.5 764,-255.5 764,-255.5 758,-255.5 752,-249.5 752,-243.5 752,-243.5 752,-185.5 752,-185.5 752,-179.5 758,-173.5 764,-173.5"/>
<text text-anchor="middle" x="814" y="-235.5" font-family="Times,serif" font-size="20.00">TiKV</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KVStore</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M264,-173.5C264,-173.5 698,-173.5 698,-173.5 704,-173.5 710,-179.5 710,-185.5 710,-185.5 710,-351.5 710,-351.5 710,-357.5 704,-363.5 698,-363.5 698,-363.5 264,-363.5 264,-363.5 258,-363.5 252,-357.5 252,-351.5 252,-351.5 252,-185.5 252,-185.5 252,-179.5 258,-173.5 264,-173.5"/>
<text text-anchor="middle" x="481" y="-343.5" font-family="Times,serif" font-size="20.00">KVStore</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_twoPhaseCommiter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-42.5C20,-42.5 220,-42.5 220,-42.5 226,-42.5 232,-48.5 232,-54.5 232,-54.5 232,-168.5 232,-168.5 232,-174.5 226,-180.5 220,-180.5 220,-180.5 20,-180.5 20,-180.5 14,-180.5 8,-174.5 8,-168.5 8,-168.5 8,-54.5 8,-54.5 8,-48.5 14,-42.5 20,-42.5"/>
<text text-anchor="middle" x="120" y="-160.5" font-family="Times,serif" font-size="20.00">twoPhaseCommiter</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_regionCache</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M281.5,-57.5C281.5,-57.5 720,-57.5 720,-57.5 726,-57.5 732,-63.5 732,-69.5 732,-69.5 732,-153.5 732,-153.5 732,-159.5 726,-165.5 720,-165.5 720,-165.5 281.5,-165.5 281.5,-165.5 275.5,-165.5 269.5,-159.5 269.5,-153.5 269.5,-153.5 269.5,-69.5 269.5,-69.5 269.5,-63.5 275.5,-57.5 281.5,-57.5"/>
<text text-anchor="middle" x="500.75" y="-145.5" font-family="Times,serif" font-size="20.00">regionCache</text>
</g>
<!-- CmdSplitRegion -->
<g id="node1" class="node">
<title>CmdSplitRegion</title>
<path fill="none" stroke="#1c2123" d="M856,-217.5C856,-217.5 772,-217.5 772,-217.5 766,-217.5 760,-211.5 760,-205.5 760,-205.5 760,-193.5 760,-193.5 760,-187.5 766,-181.5 772,-181.5 772,-181.5 856,-181.5 856,-181.5 862,-181.5 868,-187.5 868,-193.5 868,-193.5 868,-205.5 868,-205.5 868,-211.5 862,-217.5 856,-217.5"/>
<text text-anchor="middle" x="814" y="-195.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdSplitRegion</text>
</g>
<!-- preSplitRegion -->
<g id="node2" class="node">
<title>preSplitRegion</title>
<path fill="none" stroke="#1c2123" d="M272,-191.5C272,-191.5 479,-191.5 479,-191.5 485,-191.5 491,-197.5 491,-203.5 491,-203.5 491,-285.5 491,-285.5 491,-291.5 485,-297.5 479,-297.5 479,-297.5 272,-297.5 272,-297.5 266,-297.5 260,-291.5 260,-285.5 260,-285.5 260,-203.5 260,-203.5 260,-197.5 266,-191.5 272,-191.5"/>
<text text-anchor="middle" x="375.5" y="-282.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">preSplitRegion</text>
<polyline fill="none" stroke="#1c2123" points="260,-274.5 491,-274.5 "/>
<text text-anchor="start" x="268" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">avoid too much write workload</text>
<text text-anchor="start" x="268" y="-244.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> into a single region</text>
<text text-anchor="start" x="268" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> In the large transaction case</text>
<text text-anchor="start" x="268" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> this operation is import to avoid TiKV</text>
<text text-anchor="start" x="268" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> server is busy error</text>
</g>
<!-- SplitRegions -->
<g id="node3" class="node">
<title>SplitRegions</title>
<path fill="none" stroke="#1c2123" d="M656.5,-217.5C656.5,-217.5 594.5,-217.5 594.5,-217.5 588.5,-217.5 582.5,-211.5 582.5,-205.5 582.5,-205.5 582.5,-193.5 582.5,-193.5 582.5,-187.5 588.5,-181.5 594.5,-181.5 594.5,-181.5 656.5,-181.5 656.5,-181.5 662.5,-181.5 668.5,-187.5 668.5,-193.5 668.5,-193.5 668.5,-205.5 668.5,-205.5 668.5,-211.5 662.5,-217.5 656.5,-217.5"/>
<text text-anchor="middle" x="625.5" y="-195.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SplitRegions</text>
</g>
<!-- preSplitRegion&#45;&gt;SplitRegions -->
<g id="edge1" class="edge">
<title>preSplitRegion&#45;&gt;SplitRegions</title>
<path fill="none" stroke="#666666" d="M491.06,-223.71C519.6,-218.53 548.81,-213.23 572.6,-208.92"/>
<polygon fill="#666666" stroke="#666666" points="573.23,-212.36 582.44,-207.13 571.98,-205.47 573.23,-212.36"/>
</g>
<!-- WaitScatterRegionFinish -->
<g id="node4" class="node">
<title>WaitScatterRegionFinish</title>
<path fill="none" stroke="#1c2123" d="M690,-271.5C690,-271.5 561,-271.5 561,-271.5 555,-271.5 549,-265.5 549,-259.5 549,-259.5 549,-247.5 549,-247.5 549,-241.5 555,-235.5 561,-235.5 561,-235.5 690,-235.5 690,-235.5 696,-235.5 702,-241.5 702,-247.5 702,-247.5 702,-259.5 702,-259.5 702,-265.5 696,-271.5 690,-271.5"/>
<text text-anchor="middle" x="625.5" y="-249.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">WaitScatterRegionFinish</text>
</g>
<!-- preSplitRegion&#45;&gt;WaitScatterRegionFinish -->
<g id="edge2" class="edge">
<title>preSplitRegion&#45;&gt;WaitScatterRegionFinish</title>
<path fill="none" stroke="#666666" d="M491.06,-248.66C506.94,-249.23 523.03,-249.82 538.28,-250.37"/>
<polygon fill="#666666" stroke="#666666" points="538.56,-253.88 548.68,-250.75 538.82,-246.89 538.56,-253.88"/>
</g>
<!-- InvalidateCachedRegion -->
<g id="node5" class="node">
<title>InvalidateCachedRegion</title>
<path fill="none" stroke="#1c2123" d="M688.5,-325.5C688.5,-325.5 562.5,-325.5 562.5,-325.5 556.5,-325.5 550.5,-319.5 550.5,-313.5 550.5,-313.5 550.5,-301.5 550.5,-301.5 550.5,-295.5 556.5,-289.5 562.5,-289.5 562.5,-289.5 688.5,-289.5 688.5,-289.5 694.5,-289.5 700.5,-295.5 700.5,-301.5 700.5,-301.5 700.5,-313.5 700.5,-313.5 700.5,-319.5 694.5,-325.5 688.5,-325.5"/>
<text text-anchor="middle" x="625.5" y="-303.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">InvalidateCachedRegion</text>
</g>
<!-- preSplitRegion&#45;&gt;InvalidateCachedRegion -->
<g id="edge3" class="edge">
<title>preSplitRegion&#45;&gt;InvalidateCachedRegion</title>
<path fill="none" stroke="#666666" d="M491.06,-273.6C508.89,-278.13 526.97,-282.72 543.83,-287.01"/>
<polygon fill="#666666" stroke="#666666" points="543.06,-290.42 553.61,-289.49 544.78,-283.64 543.06,-290.42"/>
</g>
<!-- SplitRegions&#45;&gt;CmdSplitRegion -->
<g id="edge4" class="edge">
<title>SplitRegions&#45;&gt;CmdSplitRegion</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M668.82,-199.5C692.74,-199.5 723.11,-199.5 749.8,-199.5"/>
<polygon fill="green" stroke="green" points="749.83,-203 759.83,-199.5 749.83,-196 749.83,-203"/>
</g>
<!-- groupMutations -->
<g id="node6" class="node">
<title>groupMutations</title>
<path fill="none" stroke="#1c2123" d="M28,-51C28,-51 212,-51 212,-51 218,-51 224,-57 224,-63 224,-63 224,-130 224,-130 224,-136 218,-142 212,-142 212,-142 28,-142 28,-142 22,-142 16,-136 16,-130 16,-130 16,-63 16,-63 16,-57 22,-51 28,-51"/>
<text text-anchor="middle" x="120" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">groupMutations</text>
<polyline fill="none" stroke="#1c2123" points="16,-119 224,-119 "/>
<text text-anchor="start" x="24" y="-103.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">对于mutation做分组，然后检查</text>
<text text-anchor="start" x="24" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 每个group的mutaions个数</text>
<text text-anchor="start" x="24" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果超过阈值，则先对region</text>
<text text-anchor="start" x="24" y="-58.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 做split, 然后再重新分组</text>
</g>
<!-- groupMutations&#45;&gt;preSplitRegion -->
<g id="edge6" class="edge">
<title>groupMutations&#45;&gt;preSplitRegion</title>
<path fill="none" stroke="#666666" d="M199.13,-142.11C222.94,-156.02 249.46,-171.5 274.51,-186.12"/>
<polygon fill="#666666" stroke="#666666" points="272.9,-189.24 283.3,-191.26 276.43,-183.19 272.9,-189.24"/>
</g>
<!-- groupSortedMutationsByRegion -->
<g id="node7" class="node">
<title>groupSortedMutationsByRegion</title>
<path fill="none" stroke="#1c2123" d="M289.5,-66C289.5,-66 461.5,-66 461.5,-66 467.5,-66 473.5,-72 473.5,-78 473.5,-78 473.5,-115 473.5,-115 473.5,-121 467.5,-127 461.5,-127 461.5,-127 289.5,-127 289.5,-127 283.5,-127 277.5,-121 277.5,-115 277.5,-115 277.5,-78 277.5,-78 277.5,-72 283.5,-66 289.5,-66"/>
<text text-anchor="middle" x="375.5" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">groupSortedMutationsByRegion</text>
<polyline fill="none" stroke="#1c2123" points="277.5,-104 473.5,-104 "/>
<text text-anchor="start" x="285.5" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">mutations已经按照key做了sort</text>
<text text-anchor="start" x="285.5" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 所以遍历一次就行了</text>
</g>
<!-- groupMutations&#45;&gt;groupSortedMutationsByRegion -->
<g id="edge7" class="edge">
<title>groupMutations&#45;&gt;groupSortedMutationsByRegion</title>
<path fill="none" stroke="#666666" d="M224.11,-96.5C238.23,-96.5 252.75,-96.5 266.95,-96.5"/>
<polygon fill="#666666" stroke="#666666" points="267.22,-100 277.22,-96.5 267.22,-93 267.22,-100"/>
</g>
<!-- preSplitDetectThreshold -->
<g id="node9" class="node">
<title>preSplitDetectThreshold</title>
<path fill="#feed9b" stroke="#f7e495" d="M313,-0.5C313,-0.5 438,-0.5 438,-0.5 444,-0.5 450,-6.5 450,-12.5 450,-12.5 450,-34.5 450,-34.5 450,-40.5 444,-46.5 438,-46.5 438,-46.5 313,-46.5 313,-46.5 307,-46.5 301,-40.5 301,-34.5 301,-34.5 301,-12.5 301,-12.5 301,-6.5 307,-0.5 313,-0.5"/>
<text text-anchor="middle" x="375.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#40575d">preSplitDetectThreshold</text>
<polyline fill="none" stroke="#f7e495" points="301,-23.5 450,-23.5 "/>
<text text-anchor="start" x="309" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#40575d">全局变量值为100 000</text>
</g>
<!-- groupMutations&#45;&gt;preSplitDetectThreshold -->
<g id="edge8" class="edge">
<title>groupMutations&#45;&gt;preSplitDetectThreshold</title>
<path fill="none" stroke="#666666" d="M224.1,-61.84C233.51,-58.92 242.91,-56.1 252,-53.5 264.5,-49.92 277.79,-46.39 290.83,-43.08"/>
<polygon fill="#666666" stroke="#666666" points="291.89,-46.42 300.74,-40.59 290.18,-39.63 291.89,-46.42"/>
</g>
<!-- LocateKey -->
<g id="node8" class="node">
<title>LocateKey</title>
<path fill="none" stroke="#1c2123" d="M539,-66C539,-66 712,-66 712,-66 718,-66 724,-72 724,-78 724,-78 724,-115 724,-115 724,-121 718,-127 712,-127 712,-127 539,-127 539,-127 533,-127 527,-121 527,-115 527,-115 527,-78 527,-78 527,-72 533,-66 539,-66"/>
<text text-anchor="middle" x="625.5" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LocateKey</text>
<polyline fill="none" stroke="#1c2123" points="527,-104 724,-104 "/>
<text text-anchor="start" x="535" y="-88.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">searches for the region and range</text>
<text text-anchor="start" x="535" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> that key is located</text>
</g>
<!-- groupSortedMutationsByRegion&#45;&gt;LocateKey -->
<g id="edge5" class="edge">
<title>groupSortedMutationsByRegion&#45;&gt;LocateKey</title>
<path fill="none" stroke="#666666" d="M473.8,-96.5C487.78,-96.5 502.23,-96.5 516.4,-96.5"/>
<polygon fill="#666666" stroke="#666666" points="516.66,-100 526.66,-96.5 516.66,-93 516.66,-100"/>
</g>
</g>
</svg>
