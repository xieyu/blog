<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handle_error Pages: 1 -->
<svg width="710pt" height="626pt"
 viewBox="0.00 0.00 710.00 625.95" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 621.95)">
<title>handle_error</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-621.95 706,-621.95 706,4 -4,4"/>
<!-- amendPessimisticLock -->
<g id="node1" class="node">
<title>amendPessimisticLock</title>
<path fill="none" stroke="#1c2123" d="M131,-590.95C131,-590.95 12,-590.95 12,-590.95 6,-590.95 0,-584.95 0,-578.95 0,-578.95 0,-566.95 0,-566.95 0,-560.95 6,-554.95 12,-554.95 12,-554.95 131,-554.95 131,-554.95 137,-554.95 143,-560.95 143,-566.95 143,-566.95 143,-578.95 143,-578.95 143,-584.95 137,-590.95 131,-590.95"/>
<text text-anchor="middle" x="71.5" y="-569.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">amendPessimisticLock</text>
</g>
<!-- pessimisticLockMutations -->
<g id="node2" class="node">
<title>pessimisticLockMutations</title>
<path fill="none" stroke="#1c2123" d="M400,-563.95C400,-563.95 263,-563.95 263,-563.95 257,-563.95 251,-557.95 251,-551.95 251,-551.95 251,-539.95 251,-539.95 251,-533.95 257,-527.95 263,-527.95 263,-527.95 400,-527.95 400,-527.95 406,-527.95 412,-533.95 412,-539.95 412,-539.95 412,-551.95 412,-551.95 412,-557.95 406,-563.95 400,-563.95"/>
<text text-anchor="middle" x="331.5" y="-542.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">pessimisticLockMutations</text>
</g>
<!-- amendPessimisticLock&#45;&gt;pessimisticLockMutations -->
<g id="edge1" class="edge">
<title>amendPessimisticLock&#45;&gt;pessimisticLockMutations</title>
<path fill="none" stroke="#666666" d="M143.34,-565.53C173.36,-562.39 208.69,-558.7 240.52,-555.36"/>
<polygon fill="#666666" stroke="#666666" points="241.14,-558.82 250.72,-554.3 240.41,-551.86 241.14,-558.82"/>
</g>
<!-- ErrWriteConflict -->
<g id="node3" class="node">
<title>ErrWriteConflict</title>
<path fill="none" stroke="#1c2123" d="M373.5,-617.95C373.5,-617.95 289.5,-617.95 289.5,-617.95 283.5,-617.95 277.5,-611.95 277.5,-605.95 277.5,-605.95 277.5,-593.95 277.5,-593.95 277.5,-587.95 283.5,-581.95 289.5,-581.95 289.5,-581.95 373.5,-581.95 373.5,-581.95 379.5,-581.95 385.5,-587.95 385.5,-593.95 385.5,-593.95 385.5,-605.95 385.5,-605.95 385.5,-611.95 379.5,-617.95 373.5,-617.95"/>
<text text-anchor="middle" x="331.5" y="-596.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrWriteConflict</text>
</g>
<!-- amendPessimisticLock&#45;&gt;ErrWriteConflict -->
<g id="edge2" class="edge">
<title>amendPessimisticLock&#45;&gt;ErrWriteConflict</title>
<path fill="none" stroke="#666666" d="M143.34,-580.36C182.07,-584.41 229.64,-589.39 267.13,-593.32"/>
<polygon fill="#666666" stroke="#666666" points="267.11,-596.83 277.42,-594.39 267.83,-589.87 267.11,-596.83"/>
</g>
<!-- LockKeys -->
<g id="node4" class="node">
<title>LockKeys</title>
<path fill="none" stroke="#1c2123" d="M95.5,-275.95C95.5,-275.95 47.5,-275.95 47.5,-275.95 41.5,-275.95 35.5,-269.95 35.5,-263.95 35.5,-263.95 35.5,-251.95 35.5,-251.95 35.5,-245.95 41.5,-239.95 47.5,-239.95 47.5,-239.95 95.5,-239.95 95.5,-239.95 101.5,-239.95 107.5,-245.95 107.5,-251.95 107.5,-251.95 107.5,-263.95 107.5,-263.95 107.5,-269.95 101.5,-275.95 95.5,-275.95"/>
<text text-anchor="middle" x="71.5" y="-254.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockKeys</text>
</g>
<!-- LockKeys&#45;&gt;pessimisticLockMutations -->
<g id="edge3" class="edge">
<title>LockKeys&#45;&gt;pessimisticLockMutations</title>
<path fill="none" stroke="#666666" d="M74.05,-275.97C79.21,-323.92 100.22,-455.26 179,-518.95 196.39,-533 218.59,-540.76 240.61,-544.82"/>
<polygon fill="#666666" stroke="#666666" points="240.27,-548.31 250.7,-546.44 241.38,-541.4 240.27,-548.31"/>
</g>
<!-- asyncPessimisticRollback -->
<g id="node5" class="node">
<title>asyncPessimisticRollback</title>
<path fill="none" stroke="#1c2123" d="M251,-402.95C251,-402.95 412,-402.95 412,-402.95 418,-402.95 424,-408.95 424,-414.95 424,-414.95 424,-496.95 424,-496.95 424,-502.95 418,-508.95 412,-508.95 412,-508.95 251,-508.95 251,-508.95 245,-508.95 239,-502.95 239,-496.95 239,-496.95 239,-414.95 239,-414.95 239,-408.95 245,-402.95 251,-402.95"/>
<text text-anchor="middle" x="331.5" y="-493.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">asyncPessimisticRollback</text>
<polyline fill="none" stroke="#1c2123" points="239,-485.95 424,-485.95 "/>
<text text-anchor="start" x="247" y="-470.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">在一个goroutine中调用</text>
<text text-anchor="start" x="247" y="-455.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pessimisticRollbackMutations</text>
<text text-anchor="start" x="247" y="-440.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 返回了一个wg(wait_group)</text>
<text text-anchor="start" x="247" y="-425.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 在goroutine结束时候</text>
<text text-anchor="start" x="247" y="-410.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会调用wg.done</text>
</g>
<!-- LockKeys&#45;&gt;asyncPessimisticRollback -->
<g id="edge4" class="edge">
<title>LockKeys&#45;&gt;asyncPessimisticRollback</title>
<path fill="none" stroke="#666666" d="M82.65,-276.1C99.36,-304.55 135.22,-359.77 179,-392.95 194.18,-404.45 211.76,-414.24 229.45,-422.43"/>
<polygon fill="#666666" stroke="#666666" points="228.15,-425.68 238.7,-426.56 231,-419.29 228.15,-425.68"/>
</g>
<!-- HashPresumeKeyNotExists -->
<g id="node6" class="node">
<title>HashPresumeKeyNotExists</title>
<path fill="none" stroke="#1c2123" d="M403,-383.95C403,-383.95 260,-383.95 260,-383.95 254,-383.95 248,-377.95 248,-371.95 248,-371.95 248,-359.95 248,-359.95 248,-353.95 254,-347.95 260,-347.95 260,-347.95 403,-347.95 403,-347.95 409,-347.95 415,-353.95 415,-359.95 415,-359.95 415,-371.95 415,-371.95 415,-377.95 409,-383.95 403,-383.95"/>
<text text-anchor="middle" x="331.5" y="-362.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">HashPresumeKeyNotExists</text>
</g>
<!-- LockKeys&#45;&gt;HashPresumeKeyNotExists -->
<g id="edge5" class="edge">
<title>LockKeys&#45;&gt;HashPresumeKeyNotExists</title>
<path fill="none" stroke="#666666" d="M90.72,-276.23C110.63,-295.06 144.32,-323.74 179,-338.95 197.31,-346.98 217.87,-352.62 237.79,-356.59"/>
<polygon fill="#666666" stroke="#666666" points="237.35,-360.07 247.82,-358.46 238.63,-353.18 237.35,-360.07"/>
</g>
<!-- UnmarkPresumeKeyNotExists -->
<g id="node7" class="node">
<title>UnmarkPresumeKeyNotExists</title>
<path fill="none" stroke="#1c2123" d="M412,-329.95C412,-329.95 251,-329.95 251,-329.95 245,-329.95 239,-323.95 239,-317.95 239,-317.95 239,-305.95 239,-305.95 239,-299.95 245,-293.95 251,-293.95 251,-293.95 412,-293.95 412,-293.95 418,-293.95 424,-299.95 424,-305.95 424,-305.95 424,-317.95 424,-317.95 424,-323.95 418,-329.95 412,-329.95"/>
<text text-anchor="middle" x="331.5" y="-308.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">UnmarkPresumeKeyNotExists</text>
</g>
<!-- LockKeys&#45;&gt;UnmarkPresumeKeyNotExists -->
<g id="edge6" class="edge">
<title>LockKeys&#45;&gt;UnmarkPresumeKeyNotExists</title>
<path fill="none" stroke="#666666" d="M107.85,-267.59C128.51,-273.05 155.13,-279.8 179,-284.95 195,-288.4 212.03,-291.74 228.67,-294.84"/>
<polygon fill="#666666" stroke="#666666" points="228.49,-298.36 238.96,-296.73 229.76,-291.48 228.49,-298.36"/>
</g>
<!-- IsErrWriteConflict -->
<g id="node8" class="node">
<title>IsErrWriteConflict</title>
<path fill="none" stroke="#1c2123" d="M378.5,-275.95C378.5,-275.95 284.5,-275.95 284.5,-275.95 278.5,-275.95 272.5,-269.95 272.5,-263.95 272.5,-263.95 272.5,-251.95 272.5,-251.95 272.5,-245.95 278.5,-239.95 284.5,-239.95 284.5,-239.95 378.5,-239.95 378.5,-239.95 384.5,-239.95 390.5,-245.95 390.5,-251.95 390.5,-251.95 390.5,-263.95 390.5,-263.95 390.5,-269.95 384.5,-275.95 378.5,-275.95"/>
<text text-anchor="middle" x="331.5" y="-254.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">IsErrWriteConflict</text>
</g>
<!-- LockKeys&#45;&gt;IsErrWriteConflict -->
<g id="edge7" class="edge">
<title>LockKeys&#45;&gt;IsErrWriteConflict</title>
<path fill="none" stroke="#666666" d="M107.56,-257.95C147.13,-257.95 212.46,-257.95 262.2,-257.95"/>
<polygon fill="#666666" stroke="#666666" points="262.24,-261.45 272.24,-257.95 262.24,-254.45 262.24,-261.45"/>
</g>
<!-- IsErrKeyExist -->
<g id="node9" class="node">
<title>IsErrKeyExist</title>
<path fill="none" stroke="#1c2123" d="M366.5,-221.95C366.5,-221.95 296.5,-221.95 296.5,-221.95 290.5,-221.95 284.5,-215.95 284.5,-209.95 284.5,-209.95 284.5,-197.95 284.5,-197.95 284.5,-191.95 290.5,-185.95 296.5,-185.95 296.5,-185.95 366.5,-185.95 366.5,-185.95 372.5,-185.95 378.5,-191.95 378.5,-197.95 378.5,-197.95 378.5,-209.95 378.5,-209.95 378.5,-215.95 372.5,-221.95 366.5,-221.95"/>
<text text-anchor="middle" x="331.5" y="-200.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">IsErrKeyExist</text>
</g>
<!-- LockKeys&#45;&gt;IsErrKeyExist -->
<g id="edge8" class="edge">
<title>LockKeys&#45;&gt;IsErrKeyExist</title>
<path fill="none" stroke="#666666" d="M107.85,-248.31C128.51,-242.84 155.13,-236.09 179,-230.95 210.28,-224.2 245.46,-217.86 274.04,-213.02"/>
<polygon fill="#666666" stroke="#666666" points="274.97,-216.41 284.25,-211.3 273.81,-209.51 274.97,-216.41"/>
</g>
<!-- ErrDeadlock -->
<g id="node10" class="node">
<title>ErrDeadlock</title>
<path fill="none" stroke="#1c2123" d="M191,-52.95C191,-52.95 472,-52.95 472,-52.95 478,-52.95 484,-58.95 484,-64.95 484,-64.95 484,-116.95 484,-116.95 484,-122.95 478,-128.95 472,-128.95 472,-128.95 191,-128.95 191,-128.95 185,-128.95 179,-122.95 179,-116.95 179,-116.95 179,-64.95 179,-64.95 179,-58.95 185,-52.95 191,-52.95"/>
<text text-anchor="middle" x="331.5" y="-113.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrDeadlock</text>
<polyline fill="none" stroke="#1c2123" points="179,-105.95 484,-105.95 "/>
<text text-anchor="start" x="187" y="-90.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是死锁，调用wg_wait</text>
<text text-anchor="start" x="187" y="-75.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等待asyncPessimisticRollback完成 然后sleep 5ms</text>
<text text-anchor="start" x="187" y="-60.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等待其他事务获取lock</text>
</g>
<!-- LockKeys&#45;&gt;ErrDeadlock -->
<g id="edge9" class="edge">
<title>LockKeys&#45;&gt;ErrDeadlock</title>
<path fill="none" stroke="#666666" d="M85.2,-239.56C103.31,-214.61 138.85,-170.14 179,-143.95 184.65,-140.27 190.58,-136.81 196.69,-133.56"/>
<polygon fill="#666666" stroke="#666666" points="198.43,-136.6 205.76,-128.96 195.26,-130.36 198.43,-136.6"/>
</g>
<!-- wg_wait -->
<g id="node11" class="node">
<title>wg_wait</title>
<path fill="none" stroke="#1c2123" d="M544,-134.95C544,-134.95 678,-134.95 678,-134.95 684,-134.95 690,-140.95 690,-146.95 690,-146.95 690,-168.95 690,-168.95 690,-174.95 684,-180.95 678,-180.95 678,-180.95 544,-180.95 544,-180.95 538,-180.95 532,-174.95 532,-168.95 532,-168.95 532,-146.95 532,-146.95 532,-140.95 538,-134.95 544,-134.95"/>
<text text-anchor="middle" x="611" y="-165.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">wg_wait</text>
<polyline fill="none" stroke="#1c2123" points="532,-157.95 690,-157.95 "/>
<text text-anchor="start" x="540" y="-142.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">等待go routine执行结束</text>
</g>
<!-- LockKeys&#45;&gt;wg_wait -->
<g id="edge10" class="edge">
<title>LockKeys&#45;&gt;wg_wait</title>
<path fill="none" stroke="#666666" d="M89.29,-239.82C108.72,-220.23 142.74,-190.07 179,-176.95 291.92,-136.1 432.44,-138.96 521.71,-146.81"/>
<polygon fill="#666666" stroke="#666666" points="521.52,-150.3 531.8,-147.73 522.16,-143.33 521.52,-150.3"/>
</g>
<!-- sleep_5_ms -->
<g id="node12" class="node">
<title>sleep_5_ms</title>
<path fill="none" stroke="#1c2123" d="M544,-12.95C544,-12.95 678,-12.95 678,-12.95 684,-12.95 690,-18.95 690,-24.95 690,-24.95 690,-76.95 690,-76.95 690,-82.95 684,-88.95 678,-88.95 678,-88.95 544,-88.95 544,-88.95 538,-88.95 532,-82.95 532,-76.95 532,-76.95 532,-24.95 532,-24.95 532,-18.95 538,-12.95 544,-12.95"/>
<text text-anchor="middle" x="611" y="-73.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">sleep_5_ms</text>
<polyline fill="none" stroke="#1c2123" points="532,-65.95 690,-65.95 "/>
<text text-anchor="start" x="540" y="-50.75" font-family="Times,serif" font-size="14.00" fill="#2f3638">sleep 5ms</text>
<text text-anchor="start" x="540" y="-35.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 等待其他事务获取lock</text>
<text text-anchor="start" x="540" y="-20.75" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后在重试</text>
</g>
<!-- LockKeys&#45;&gt;sleep_5_ms -->
<g id="edge11" class="edge">
<title>LockKeys&#45;&gt;sleep_5_ms</title>
<path fill="none" stroke="#666666" d="M75.07,-239.85C82.28,-196.6 107.15,-87.54 179,-42.95 282.69,21.4 429.15,0.53 521.82,-23.11"/>
<polygon fill="#666666" stroke="#666666" points="521.17,-26.55 531.73,-25.7 522.94,-19.78 521.17,-26.55"/>
</g>
<!-- asyncPessimisticRollback&#45;&gt;wg_wait -->
<g id="edge12" class="edge">
<title>asyncPessimisticRollback&#45;&gt;wg_wait</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M424.13,-429.6C445.46,-420.44 466.9,-408.44 484,-392.95 546.57,-336.23 583.95,-241.01 600.27,-190.96"/>
<polygon fill="green" stroke="green" points="603.65,-191.88 603.34,-181.29 596.98,-189.76 603.65,-191.88"/>
</g>
<!-- pessimisticRollbackMutations -->
<g id="node13" class="node">
<title>pessimisticRollbackMutations</title>
<path fill="none" stroke="#1c2123" d="M690,-473.95C690,-473.95 532,-473.95 532,-473.95 526,-473.95 520,-467.95 520,-461.95 520,-461.95 520,-449.95 520,-449.95 520,-443.95 526,-437.95 532,-437.95 532,-437.95 690,-437.95 690,-437.95 696,-437.95 702,-443.95 702,-449.95 702,-449.95 702,-461.95 702,-461.95 702,-467.95 696,-473.95 690,-473.95"/>
<text text-anchor="middle" x="611" y="-452.25" font-family="Times,serif" font-size="14.00" fill="#2f3638">pessimisticRollbackMutations</text>
</g>
<!-- asyncPessimisticRollback&#45;&gt;pessimisticRollbackMutations -->
<g id="edge15" class="edge">
<title>asyncPessimisticRollback&#45;&gt;pessimisticRollbackMutations</title>
<path fill="none" stroke="#666666" d="M424.13,-455.95C451.55,-455.95 481.75,-455.95 509.7,-455.95"/>
<polygon fill="#666666" stroke="#666666" points="509.88,-459.45 519.88,-455.95 509.88,-452.45 509.88,-459.45"/>
</g>
<!-- ErrDeadlock&#45;&gt;wg_wait -->
<g id="edge13" class="edge">
<title>ErrDeadlock&#45;&gt;wg_wait</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M484.24,-127.58C497.09,-130.69 509.79,-133.75 521.9,-136.68"/>
<polygon fill="green" stroke="green" points="521.37,-140.15 531.92,-139.1 523.02,-133.35 521.37,-140.15"/>
</g>
<!-- ErrDeadlock&#45;&gt;sleep_5_ms -->
<g id="edge14" class="edge">
<title>ErrDeadlock&#45;&gt;sleep_5_ms</title>
<path fill="none" stroke="#666666" d="M484.24,-69.08C497.09,-67.22 509.79,-65.39 521.9,-63.65"/>
<polygon fill="#666666" stroke="#666666" points="522.52,-67.09 531.92,-62.2 521.52,-60.17 522.52,-67.09"/>
</g>
</g>
</svg>
