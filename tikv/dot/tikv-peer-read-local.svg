<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: read_local Pages: 1 -->
<svg width="1266pt" height="669pt"
 viewBox="0.00 0.00 1266.00 669.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 665)">
<title>read_local</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-665 1262,-665 1262,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_RaftKV</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M697,-494C697,-494 1238,-494 1238,-494 1244,-494 1250,-500 1250,-506 1250,-506 1250,-641 1250,-641 1250,-647 1244,-653 1238,-653 1238,-653 697,-653 697,-653 691,-653 685,-647 685,-641 685,-641 685,-506 685,-506 685,-500 691,-494 697,-494"/>
<text text-anchor="middle" x="967.5" y="-633" font-family="Times,serif" font-size="20.00">RaftKV</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_PeerStorage</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M343,-8C343,-8 432,-8 432,-8 438,-8 444,-14 444,-20 444,-20 444,-78 444,-78 444,-84 438,-90 432,-90 432,-90 343,-90 343,-90 337,-90 331,-84 331,-78 331,-78 331,-20 331,-20 331,-14 337,-8 343,-8"/>
<text text-anchor="middle" x="387.5" y="-70" font-family="Times,serif" font-size="20.00">PeerStorage</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_PollContext</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M345,-98C345,-98 900,-98 900,-98 906,-98 912,-104 912,-110 912,-110 912,-352 912,-352 912,-358 906,-364 900,-364 900,-364 345,-364 345,-364 339,-364 333,-358 333,-352 333,-352 333,-110 333,-110 333,-104 339,-98 345,-98"/>
<text text-anchor="middle" x="622.5" y="-344" font-family="Times,serif" font-size="20.00">PollContext</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_Peer</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-372C20,-372 1038,-372 1038,-372 1044,-372 1050,-378 1050,-384 1050,-384 1050,-474 1050,-474 1050,-480 1044,-486 1038,-486 1038,-486 20,-486 20,-486 14,-486 8,-480 8,-474 8,-474 8,-384 8,-384 8,-378 14,-372 20,-372"/>
<text text-anchor="middle" x="529" y="-466" font-family="Times,serif" font-size="20.00">Peer</text>
</g>
<!-- async_snapshot -->
<g id="node1" class="node">
<title>async_snapshot</title>
<path fill="none" stroke="#1c2123" d="M705,-535C705,-535 844,-535 844,-535 850,-535 856,-541 856,-547 856,-547 856,-569 856,-569 856,-575 850,-581 844,-581 844,-581 705,-581 705,-581 699,-581 693,-575 693,-569 693,-569 693,-547 693,-547 693,-541 699,-535 705,-535"/>
<text text-anchor="middle" x="774.5" y="-565.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="693,-558 856,-558 "/>
<text text-anchor="start" x="701" y="-542.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送CmdType::Snap请求</text>
</g>
<!-- exec_snapshot -->
<g id="node2" class="node">
<title>exec_snapshot</title>
<path fill="none" stroke="#1c2123" d="M1026.5,-576C1026.5,-576 955.5,-576 955.5,-576 949.5,-576 943.5,-570 943.5,-564 943.5,-564 943.5,-552 943.5,-552 943.5,-546 949.5,-540 955.5,-540 955.5,-540 1026.5,-540 1026.5,-540 1032.5,-540 1038.5,-546 1038.5,-552 1038.5,-552 1038.5,-564 1038.5,-564 1038.5,-570 1032.5,-576 1026.5,-576"/>
<text text-anchor="middle" x="991" y="-554.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">exec_snapshot</text>
</g>
<!-- async_snapshot&#45;&gt;exec_snapshot -->
<g id="edge1" class="edge">
<title>async_snapshot&#45;&gt;exec_snapshot</title>
<path fill="none" stroke="#666666" d="M856.29,-558C881.84,-558 909.53,-558 933.05,-558"/>
<polygon fill="#666666" stroke="#666666" points="933.19,-561.5 943.19,-558 933.19,-554.5 933.19,-561.5"/>
</g>
<!-- router_read -->
<g id="node3" class="node">
<title>router_read</title>
<path fill="none" stroke="#1c2123" d="M1118.5,-568C1118.5,-568 1201.5,-568 1201.5,-568 1207.5,-568 1213.5,-574 1213.5,-580 1213.5,-580 1213.5,-602 1213.5,-602 1213.5,-608 1207.5,-614 1201.5,-614 1201.5,-614 1118.5,-614 1118.5,-614 1112.5,-614 1106.5,-608 1106.5,-602 1106.5,-602 1106.5,-580 1106.5,-580 1106.5,-574 1112.5,-568 1118.5,-568"/>
<text text-anchor="middle" x="1160" y="-598.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">self.router.read</text>
<polyline fill="none" stroke="#1c2123" points="1106.5,-591 1213.5,-591 "/>
<text text-anchor="middle" x="1160" y="-575.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送cmd到Raft</text>
</g>
<!-- exec_snapshot&#45;&gt;router_read -->
<g id="edge2" class="edge">
<title>exec_snapshot&#45;&gt;router_read</title>
<path fill="none" stroke="#666666" d="M1038.52,-567.19C1056.44,-570.73 1077.2,-574.84 1096.39,-578.63"/>
<polygon fill="#666666" stroke="#666666" points="1095.77,-582.07 1106.26,-580.58 1097.13,-575.21 1095.77,-582.07"/>
</g>
<!-- StoreCallback_Read -->
<g id="node4" class="node">
<title>StoreCallback_Read</title>
<path fill="none" stroke="#1c2123" d="M1090,-503C1090,-503 1230,-503 1230,-503 1236,-503 1242,-509 1242,-515 1242,-515 1242,-537 1242,-537 1242,-543 1236,-549 1230,-549 1230,-549 1090,-549 1090,-549 1084,-549 1078,-543 1078,-537 1078,-537 1078,-515 1078,-515 1078,-509 1084,-503 1090,-503"/>
<text text-anchor="middle" x="1160" y="-533.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">StoreCallback::Read</text>
<polyline fill="none" stroke="#1c2123" points="1078,-526 1242,-526 "/>
<text text-anchor="middle" x="1160" y="-510.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Read ready后的回调函数</text>
</g>
<!-- exec_snapshot&#45;&gt;StoreCallback_Read -->
<g id="edge3" class="edge">
<title>exec_snapshot&#45;&gt;StoreCallback_Read</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1038.52,-549.09C1047.71,-547.32 1057.65,-545.42 1067.75,-543.49"/>
<polygon fill="green" stroke="green" points="1068.71,-546.87 1077.87,-541.55 1067.39,-539.99 1068.71,-546.87"/>
</g>
<!-- get_snapshot -->
<g id="node5" class="node">
<title>get_snapshot</title>
<path fill="none" stroke="#1c2123" d="M678,-202.5C678,-202.5 871,-202.5 871,-202.5 877,-202.5 883,-208.5 883,-214.5 883,-214.5 883,-259.5 883,-259.5 883,-265.5 877,-271.5 871,-271.5 871,-271.5 678,-271.5 678,-271.5 672,-271.5 666,-265.5 666,-259.5 666,-259.5 666,-214.5 666,-214.5 666,-208.5 672,-202.5 678,-202.5"/>
<text text-anchor="middle" x="774.5" y="-256.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_snapshot</text>
<polyline fill="none" stroke="#1c2123" points="666,-248.5 883,-248.5 "/>
<text text-anchor="middle" x="774.5" y="-233.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Arc::new(self.engines.kv.snapshot())</text>
<polyline fill="none" stroke="#1c2123" points="666,-225.5 883,-225.5 "/>
<text text-anchor="start" x="674" y="-210.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取当前kv的snapshot</text>
</g>
<!-- invoke_read -->
<g id="node6" class="node">
<title>invoke_read</title>
<path fill="none" stroke="#1c2123" d="M952,-391C952,-391 1030,-391 1030,-391 1036,-391 1042,-397 1042,-403 1042,-403 1042,-425 1042,-425 1042,-431 1036,-437 1030,-437 1030,-437 952,-437 952,-437 946,-437 940,-431 940,-425 940,-425 940,-403 940,-403 940,-397 946,-391 952,-391"/>
<text text-anchor="middle" x="991" y="-421.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">invoke_read</text>
<polyline fill="none" stroke="#1c2123" points="940,-414 1042,-414 "/>
<text text-anchor="middle" x="991" y="-398.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用回调函数</text>
</g>
<!-- get_snapshot&#45;&gt;invoke_read -->
<g id="edge4" class="edge">
<title>get_snapshot&#45;&gt;invoke_read</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M883.02,-263.11C893.38,-268.08 903.26,-273.99 912,-281 944.64,-307.19 966.5,-350.99 978.58,-381.12"/>
<polygon fill="green" stroke="green" points="975.44,-382.7 982.3,-390.78 981.97,-380.19 975.44,-382.7"/>
</g>
<!-- invoke_read&#45;&gt;StoreCallback_Read -->
<g id="edge18" class="edge">
<title>invoke_read&#45;&gt;StoreCallback_Read</title>
<path fill="none" stroke="#666666" d="M1026.6,-437.21C1052.58,-454.63 1088.3,-478.58 1116.09,-497.22"/>
<polygon fill="#666666" stroke="#666666" points="1114.19,-500.16 1124.44,-502.82 1118.09,-494.35 1114.19,-500.16"/>
</g>
<!-- commit_index -->
<g id="node7" class="node">
<title>commit_index</title>
<path fill="none" stroke="#1c2123" d="M423,-52C423,-52 351,-52 351,-52 345,-52 339,-46 339,-40 339,-40 339,-28 339,-28 339,-22 345,-16 351,-16 351,-16 423,-16 423,-16 429,-16 435,-22 435,-28 435,-28 435,-40 435,-40 435,-46 429,-52 423,-52"/>
<text text-anchor="middle" x="387" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit_index</text>
</g>
<!-- CmdType_ReadIndex -->
<g id="node11" class="node">
<title>CmdType_ReadIndex</title>
<path fill="none" stroke="#1c2123" d="M597,-163C597,-163 484,-163 484,-163 478,-163 472,-157 472,-151 472,-151 472,-139 472,-139 472,-133 478,-127 484,-127 484,-127 597,-127 597,-127 603,-127 609,-133 609,-139 609,-139 609,-151 609,-151 609,-157 603,-163 597,-163"/>
<text text-anchor="middle" x="540.5" y="-141.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdType_ReadIndex</text>
</g>
<!-- commit_index&#45;&gt;CmdType_ReadIndex -->
<g id="edge12" class="edge">
<title>commit_index&#45;&gt;CmdType_ReadIndex</title>
<path fill="none" stroke="#666666" d="M412.68,-52.08C438.21,-70.79 478.23,-100.11 506.47,-120.8"/>
<polygon fill="#666666" stroke="#666666" points="504.7,-123.84 514.83,-126.93 508.83,-118.19 504.7,-123.84"/>
</g>
<!-- execute -->
<g id="node8" class="node">
<title>execute</title>
<path fill="none" stroke="#1c2123" d="M353,-248C353,-248 421,-248 421,-248 427,-248 433,-254 433,-260 433,-260 433,-282 433,-282 433,-288 427,-294 421,-294 421,-294 353,-294 353,-294 347,-294 341,-288 341,-282 341,-282 341,-260 341,-260 341,-254 347,-248 353,-248"/>
<text text-anchor="middle" x="387" y="-278.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">execute</text>
<polyline fill="none" stroke="#1c2123" points="341,-271 433,-271 "/>
<text text-anchor="middle" x="387" y="-255.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成response</text>
</g>
<!-- CmdType_Get -->
<g id="node9" class="node">
<title>CmdType_Get</title>
<path fill="none" stroke="#1c2123" d="M577.5,-321C577.5,-321 503.5,-321 503.5,-321 497.5,-321 491.5,-315 491.5,-309 491.5,-309 491.5,-297 491.5,-297 491.5,-291 497.5,-285 503.5,-285 503.5,-285 577.5,-285 577.5,-285 583.5,-285 589.5,-291 589.5,-297 589.5,-297 589.5,-309 589.5,-309 589.5,-315 583.5,-321 577.5,-321"/>
<text text-anchor="middle" x="540.5" y="-299.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdType_Get</text>
</g>
<!-- execute&#45;&gt;CmdType_Get -->
<g id="edge5" class="edge">
<title>execute&#45;&gt;CmdType_Get</title>
<path fill="none" stroke="#666666" d="M433.04,-280.51C448.29,-283.73 465.52,-287.37 481.62,-290.77"/>
<polygon fill="#666666" stroke="#666666" points="480.96,-294.21 491.46,-292.85 482.4,-287.36 480.96,-294.21"/>
</g>
<!-- CmdType_Snap -->
<g id="node10" class="node">
<title>CmdType_Snap</title>
<path fill="none" stroke="#1c2123" d="M581,-259C581,-259 500,-259 500,-259 494,-259 488,-253 488,-247 488,-247 488,-235 488,-235 488,-229 494,-223 500,-223 500,-223 581,-223 581,-223 587,-223 593,-229 593,-235 593,-235 593,-247 593,-247 593,-253 587,-259 581,-259"/>
<text text-anchor="middle" x="540.5" y="-237.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CmdType_Snap</text>
</g>
<!-- execute&#45;&gt;CmdType_Snap -->
<g id="edge6" class="edge">
<title>execute&#45;&gt;CmdType_Snap</title>
<path fill="none" stroke="#666666" d="M433.04,-262.08C447.08,-259.3 462.8,-256.19 477.77,-253.22"/>
<polygon fill="#666666" stroke="#666666" points="478.85,-256.58 487.98,-251.2 477.49,-249.71 478.85,-256.58"/>
</g>
<!-- execute&#45;&gt;CmdType_ReadIndex -->
<g id="edge7" class="edge">
<title>execute&#45;&gt;CmdType_ReadIndex</title>
<path fill="none" stroke="#666666" d="M415.79,-247.89C442.42,-225.74 482.48,-192.42 509.75,-169.74"/>
<polygon fill="#666666" stroke="#666666" points="512.32,-172.15 517.77,-163.07 507.85,-166.77 512.32,-172.15"/>
</g>
<!-- get_value -->
<g id="node12" class="node">
<title>get_value</title>
<path fill="none" stroke="#1c2123" d="M797,-326C797,-326 752,-326 752,-326 746,-326 740,-320 740,-314 740,-314 740,-302 740,-302 740,-296 746,-290 752,-290 752,-290 797,-290 797,-290 803,-290 809,-296 809,-302 809,-302 809,-314 809,-314 809,-320 803,-326 797,-326"/>
<text text-anchor="middle" x="774.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_value</text>
</g>
<!-- CmdType_Get&#45;&gt;get_value -->
<g id="edge8" class="edge">
<title>CmdType_Get&#45;&gt;get_value</title>
<path fill="none" stroke="#666666" d="M589.57,-304.04C630.75,-304.92 689.57,-306.19 729.52,-307.05"/>
<polygon fill="#666666" stroke="#666666" points="729.68,-310.56 739.75,-307.27 729.83,-303.56 729.68,-310.56"/>
</g>
<!-- CmdType_Snap&#45;&gt;get_snapshot -->
<g id="edge9" class="edge">
<title>CmdType_Snap&#45;&gt;get_snapshot</title>
<path fill="none" stroke="#666666" d="M593.28,-240.11C611.92,-239.79 633.8,-239.41 655.76,-239.03"/>
<polygon fill="#666666" stroke="#666666" points="655.91,-242.53 665.85,-238.86 655.79,-235.53 655.91,-242.53"/>
</g>
<!-- set_read_index -->
<g id="node13" class="node">
<title>set_read_index</title>
<path fill="none" stroke="#1c2123" d="M657,-107C657,-107 892,-107 892,-107 898,-107 904,-113 904,-119 904,-119 904,-171 904,-171 904,-177 898,-183 892,-183 892,-183 657,-183 657,-183 651,-183 645,-177 645,-171 645,-171 645,-119 645,-119 645,-113 651,-107 657,-107"/>
<text text-anchor="middle" x="774.5" y="-167.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">set_read_index</text>
<polyline fill="none" stroke="#1c2123" points="645,-160 904,-160 "/>
<text text-anchor="start" x="653" y="-144.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">let mut res = ReadIndexResponse::default();</text>
<text text-anchor="start" x="653" y="-129.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> res.set_read_index(read_index);</text>
<text text-anchor="start" x="653" y="-114.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> resp.set_read_index(res);</text>
</g>
<!-- CmdType_ReadIndex&#45;&gt;set_read_index -->
<g id="edge10" class="edge">
<title>CmdType_ReadIndex&#45;&gt;set_read_index</title>
<path fill="none" stroke="#666666" d="M609.23,-145C617.3,-145 625.76,-145 634.39,-145"/>
<polygon fill="#666666" stroke="#666666" points="634.59,-148.5 644.59,-145 634.59,-141.5 634.59,-148.5"/>
</g>
<!-- propose -->
<g id="node14" class="node">
<title>propose</title>
<path fill="none" stroke="#1c2123" d="M63,-422C63,-422 28,-422 28,-422 22,-422 16,-416 16,-410 16,-410 16,-398 16,-398 16,-392 22,-386 28,-386 28,-386 63,-386 63,-386 69,-386 75,-392 75,-398 75,-398 75,-410 75,-410 75,-416 69,-422 63,-422"/>
<text text-anchor="middle" x="45.5" y="-400.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">propose</text>
</g>
<!-- read_local -->
<g id="node15" class="node">
<title>read_local</title>
<path fill="none" stroke="#1c2123" d="M172,-422C172,-422 123,-422 123,-422 117,-422 111,-416 111,-410 111,-410 111,-398 111,-398 111,-392 117,-386 123,-386 123,-386 172,-386 172,-386 178,-386 184,-392 184,-398 184,-398 184,-410 184,-410 184,-416 178,-422 172,-422"/>
<text text-anchor="middle" x="147.5" y="-400.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">read_local</text>
</g>
<!-- propose&#45;&gt;read_local -->
<g id="edge11" class="edge">
<title>propose&#45;&gt;read_local</title>
<path fill="none" stroke="#666666" d="M75.16,-404C83.12,-404 91.97,-404 100.66,-404"/>
<polygon fill="#666666" stroke="#666666" points="100.72,-407.5 110.72,-404 100.72,-400.5 100.72,-407.5"/>
</g>
<!-- read_local&#45;&gt;invoke_read -->
<g id="edge13" class="edge">
<title>read_local&#45;&gt;invoke_read</title>
<path fill="none" stroke="#666666" d="M181.02,-422.11C192.93,-427.9 206.74,-433.67 220,-437 291.68,-455.02 312.09,-447 386,-447 386,-447 386,-447 541.5,-447 680.86,-447 843.92,-430.96 929.88,-421.24"/>
<polygon fill="#666666" stroke="#666666" points="930.44,-424.7 939.98,-420.09 929.65,-417.75 930.44,-424.7"/>
</g>
<!-- read_local&#45;&gt;commit_index -->
<g id="edge14" class="edge">
<title>read_local&#45;&gt;commit_index</title>
<path fill="none" stroke="#666666" d="M157.55,-385.7C182.24,-336.47 254.11,-197.92 331,-94 339.84,-82.05 350.7,-69.79 360.43,-59.49"/>
<polygon fill="#666666" stroke="#666666" points="363.19,-61.67 367.6,-52.04 358.14,-56.82 363.19,-61.67"/>
</g>
<!-- handle_read -->
<g id="node16" class="node">
<title>handle_read</title>
<path fill="none" stroke="#1c2123" d="M232,-381C232,-381 291,-381 291,-381 297,-381 303,-387 303,-393 303,-393 303,-415 303,-415 303,-421 297,-427 291,-427 291,-427 232,-427 232,-427 226,-427 220,-421 220,-415 220,-415 220,-393 220,-393 220,-387 226,-381 232,-381"/>
<text text-anchor="middle" x="261.5" y="-411.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_read</text>
<polyline fill="none" stroke="#1c2123" points="220,-404 303,-404 "/>
<text text-anchor="middle" x="261.5" y="-388.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成resp</text>
</g>
<!-- read_local&#45;&gt;handle_read -->
<g id="edge15" class="edge">
<title>read_local&#45;&gt;handle_read</title>
<path fill="none" stroke="#666666" d="M184.25,-404C192.26,-404 200.91,-404 209.4,-404"/>
<polygon fill="#666666" stroke="#666666" points="209.64,-407.5 219.64,-404 209.64,-400.5 209.64,-407.5"/>
</g>
<!-- handle_read&#45;&gt;invoke_read -->
<g id="edge17" class="edge">
<title>handle_read&#45;&gt;invoke_read</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M303.17,-404.56C424.61,-406.23 785.08,-411.18 929.33,-413.17"/>
<polygon fill="green" stroke="green" points="929.7,-416.67 939.74,-413.31 929.79,-409.67 929.7,-416.67"/>
</g>
<!-- handle_read&#45;&gt;execute -->
<g id="edge16" class="edge">
<title>handle_read&#45;&gt;execute</title>
<path fill="none" stroke="#666666" d="M284.01,-380.83C304.34,-358.94 334.98,-325.95 357.36,-301.84"/>
<polygon fill="#666666" stroke="#666666" points="360.08,-304.06 364.32,-294.35 354.95,-299.29 360.08,-304.06"/>
</g>
</g>
</svg>
