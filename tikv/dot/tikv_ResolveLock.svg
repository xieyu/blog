<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1381pt" height="308pt"
 viewBox="0.00 0.00 1381.00 307.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 303.5)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-303.5 1377,-303.5 1377,4 -4,4"/>
<!-- ResolveLock__process_write -->
<g id="node1" class="node">
<title>ResolveLock__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-165.5C12,-165.5 173,-165.5 173,-165.5 179,-165.5 185,-171.5 185,-177.5 185,-177.5 185,-237.5 185,-237.5 185,-243.5 179,-249.5 173,-249.5 173,-249.5 12,-249.5 12,-249.5 6,-249.5 0,-243.5 0,-237.5 0,-237.5 0,-177.5 0,-177.5 0,-171.5 6,-165.5 12,-165.5"/>
<text text-anchor="start" x="8" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLock</text>
<text text-anchor="start" x="8" y="-219.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-211.5 185,-211.5 "/>
<polyline fill="none" stroke="#1c2123" points="0,-211.5 185,-211.5 "/>
<text text-anchor="start" x="8" y="-196.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">scan_key: Option&lt;Key&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="0,-188.5 185,-188.5 "/>
<text text-anchor="start" x="8" y="-173.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key_locks: Vec&lt;(Key, Lock)&gt;,</text>
</g>
<!-- TxnStatus__Get -->
<g id="node2" class="node">
<title>TxnStatus__Get</title>
<path fill="none" stroke="#1c2123" d="M389,-104C389,-104 519,-104 519,-104 525,-104 531,-110 531,-116 531,-116 531,-183 531,-183 531,-189 525,-195 519,-195 519,-195 389,-195 389,-195 383,-195 377,-189 377,-183 377,-183 377,-116 377,-116 377,-110 383,-104 389,-104"/>
<text text-anchor="start" x="385" y="-179.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus</text>
<text text-anchor="start" x="385" y="-164.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Get</text>
<polyline fill="none" stroke="#1c2123" points="377,-157 531,-157 "/>
<text text-anchor="start" x="385" y="-141.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用Lock.ts</text>
<text text-anchor="start" x="385" y="-126.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从txn_status map</text>
<text text-anchor="start" x="385" y="-111.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取事务的 commit_ts</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;TxnStatus__Get -->
<g id="edge1" class="edge">
<title>ResolveLock__process_write&#45;&gt;TxnStatus__Get</title>
<path fill="none" stroke="#666666" d="M185.11,-182.94C197.13,-180.18 209.32,-177.61 221,-175.5 268.92,-166.84 322.96,-160.58 366.82,-156.38"/>
<polygon fill="#666666" stroke="#666666" points="367.25,-159.86 376.87,-155.44 366.59,-152.89 367.25,-159.86"/>
</g>
<!-- cleanup -->
<g id="node3" class="node">
<title>cleanup</title>
<path fill="none" stroke="#1c2123" d="M737,-70C737,-70 868,-70 868,-70 874,-70 880,-76 880,-82 880,-82 880,-119 880,-119 880,-125 874,-131 868,-131 868,-131 737,-131 737,-131 731,-131 725,-125 725,-119 725,-119 725,-82 725,-82 725,-76 731,-70 737,-70"/>
<text text-anchor="start" x="733" y="-115.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleaup</text>
<polyline fill="none" stroke="#1c2123" points="725,-108 880,-108 "/>
<text text-anchor="start" x="733" y="-92.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果commit_ts.is_zero()</text>
<text text-anchor="start" x="733" y="-77.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则cleaup txn</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;cleanup -->
<g id="edge2" class="edge">
<title>ResolveLock__process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M185.31,-168.99C197.29,-164.07 209.43,-159.13 221,-154.5 289.97,-126.91 303.96,-108.06 377,-94.5 444.29,-82 462.56,-93.74 531,-94.5 592.45,-95.18 661.73,-96.73 714.79,-98.09"/>
<polygon fill="#666666" stroke="#666666" points="714.76,-101.59 724.85,-98.35 714.94,-94.59 714.76,-101.59"/>
</g>
<!-- commit -->
<g id="node4" class="node">
<title>commit</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M947.5,-190.5C947.5,-190.5 1073.5,-190.5 1073.5,-190.5 1079.5,-190.5 1085.5,-196.5 1085.5,-202.5 1085.5,-202.5 1085.5,-254.5 1085.5,-254.5 1085.5,-260.5 1079.5,-266.5 1073.5,-266.5 1073.5,-266.5 947.5,-266.5 947.5,-266.5 941.5,-266.5 935.5,-260.5 935.5,-254.5 935.5,-254.5 935.5,-202.5 935.5,-202.5 935.5,-196.5 941.5,-190.5 947.5,-190.5"/>
<text text-anchor="start" x="943.5" y="-251.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit</text>
<polyline fill="none" stroke="#8a8898" points="935.5,-243.5 1085.5,-243.5 "/>
<text text-anchor="start" x="943.5" y="-228.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">提交事务</text>
<text text-anchor="start" x="943.5" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 如果事务的commit_ts</text>
<text text-anchor="start" x="943.5" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> &gt;0就提交事务</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;commit -->
<g id="edge3" class="edge">
<title>ResolveLock__process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M185.04,-233.1C197.07,-235.9 209.29,-238.47 221,-240.5 323.01,-258.2 349.47,-261.5 453,-261.5 453,-261.5 453,-261.5 629,-261.5 731.17,-261.5 848.19,-249.55 925.17,-240.03"/>
<polygon fill="#666666" stroke="#666666" points="925.81,-243.47 935.3,-238.76 924.94,-236.53 925.81,-243.47"/>
</g>
<!-- ReleasedLocks__wakeup -->
<g id="node5" class="node">
<title>ReleasedLocks__wakeup</title>
<path fill="none" stroke="#1c2123" d="M1287,-244.5C1287,-244.5 1361,-244.5 1361,-244.5 1367,-244.5 1373,-250.5 1373,-256.5 1373,-256.5 1373,-270.5 1373,-270.5 1373,-276.5 1367,-282.5 1361,-282.5 1361,-282.5 1287,-282.5 1287,-282.5 1281,-282.5 1275,-276.5 1275,-270.5 1275,-270.5 1275,-256.5 1275,-256.5 1275,-250.5 1281,-244.5 1287,-244.5"/>
<text text-anchor="start" x="1283" y="-267.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1283" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> wakeup</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge4" class="edge">
<title>ResolveLock__process_write&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="#666666" d="M183.37,-249.54C195.84,-254.41 208.61,-258.9 221,-262.5 321.27,-291.63 348.59,-299.5 453,-299.5 453,-299.5 453,-299.5 1011.5,-299.5 1100.33,-299.5 1202.47,-284.88 1264.86,-274.27"/>
<polygon fill="#666666" stroke="#666666" points="1265.65,-277.69 1274.91,-272.54 1264.46,-270.79 1265.65,-277.69"/>
</g>
<!-- current_lock_ts -->
<g id="node6" class="node">
<title>current_lock_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M233,-184.5C233,-184.5 329,-184.5 329,-184.5 335,-184.5 341,-190.5 341,-196.5 341,-196.5 341,-218.5 341,-218.5 341,-224.5 335,-230.5 329,-230.5 329,-230.5 233,-230.5 233,-230.5 227,-230.5 221,-224.5 221,-218.5 221,-218.5 221,-196.5 221,-196.5 221,-190.5 227,-184.5 233,-184.5"/>
<text text-anchor="start" x="229" y="-215.3" font-family="Times,serif" font-size="14.00" fill="#40575d">current_lock.ts</text>
<polyline fill="none" stroke="#f7e495" points="221,-207.5 341,-207.5 "/>
<text text-anchor="start" x="229" y="-192.3" font-family="Times,serif" font-size="14.00" fill="#40575d">当前遍历lock的ts</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;current_lock_ts -->
<g id="edge5" class="edge">
<title>ResolveLock__process_write&#45;&gt;current_lock_ts</title>
<path fill="none" stroke="#666666" d="M185.11,-207.5C193.76,-207.5 202.42,-207.5 210.8,-207.5"/>
<polygon fill="#666666" stroke="#666666" points="210.87,-211 220.87,-207.5 210.87,-204 210.87,-211"/>
</g>
<!-- commit_ts -->
<g id="node7" class="node">
<title>commit_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M579,-130.5C579,-130.5 677,-130.5 677,-130.5 683,-130.5 689,-136.5 689,-142.5 689,-142.5 689,-156.5 689,-156.5 689,-162.5 683,-168.5 677,-168.5 677,-168.5 579,-168.5 579,-168.5 573,-168.5 567,-162.5 567,-156.5 567,-156.5 567,-142.5 567,-142.5 567,-136.5 573,-130.5 579,-130.5"/>
<text text-anchor="start" x="575" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#40575d">commit_ts</text>
<text text-anchor="start" x="575" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 事务的commit_ts</text>
</g>
<!-- TxnStatus__Get&#45;&gt;commit_ts -->
<g id="edge6" class="edge">
<title>TxnStatus__Get&#45;&gt;commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M531.19,-149.5C539.69,-149.5 548.32,-149.5 556.73,-149.5"/>
<polygon fill="green" stroke="green" points="556.87,-153 566.87,-149.5 556.87,-146 556.87,-153"/>
</g>
<!-- rollback_lock -->
<g id="node8" class="node">
<title>rollback_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M955.5,-95.5C955.5,-95.5 1065.5,-95.5 1065.5,-95.5 1071.5,-95.5 1077.5,-101.5 1077.5,-107.5 1077.5,-107.5 1077.5,-159.5 1077.5,-159.5 1077.5,-165.5 1071.5,-171.5 1065.5,-171.5 1065.5,-171.5 955.5,-171.5 955.5,-171.5 949.5,-171.5 943.5,-165.5 943.5,-159.5 943.5,-159.5 943.5,-107.5 943.5,-107.5 943.5,-101.5 949.5,-95.5 955.5,-95.5"/>
<text text-anchor="start" x="951.5" y="-156.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">rollback_lock</text>
<polyline fill="none" stroke="#8a8898" points="943.5,-148.5 1077.5,-148.5 "/>
<text text-anchor="start" x="951.5" y="-133.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">回滚事务</text>
<text text-anchor="start" x="951.5" y="-118.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 如果lock_type为Put</text>
<text text-anchor="start" x="951.5" y="-103.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 需要delete_value</text>
</g>
<!-- cleanup&#45;&gt;rollback_lock -->
<g id="edge11" class="edge">
<title>cleanup&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M880.21,-112.79C897.51,-115.56 915.88,-118.5 933.18,-121.27"/>
<polygon fill="#666666" stroke="#666666" points="932.79,-124.76 943.22,-122.88 933.9,-117.84 932.79,-124.76"/>
</g>
<!-- check_txn_status_missing_lock -->
<g id="node9" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M928,-0.5C928,-0.5 1093,-0.5 1093,-0.5 1099,-0.5 1105,-6.5 1105,-12.5 1105,-12.5 1105,-64.5 1105,-64.5 1105,-70.5 1099,-76.5 1093,-76.5 1093,-76.5 928,-76.5 928,-76.5 922,-76.5 916,-70.5 916,-64.5 916,-64.5 916,-12.5 916,-12.5 916,-6.5 922,-0.5 928,-0.5"/>
<text text-anchor="start" x="924" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_missing_lock</text>
<polyline fill="none" stroke="#8a8898" points="916,-53.5 1105,-53.5 "/>
<text text-anchor="start" x="924" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock不存在</text>
<text text-anchor="start" x="924" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 或者Lock已经</text>
<text text-anchor="start" x="924" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 被其他事务所持有</text>
</g>
<!-- cleanup&#45;&gt;check_txn_status_missing_lock -->
<g id="edge12" class="edge">
<title>cleanup&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="#666666" d="M880.21,-77.41C888.6,-74.89 897.25,-72.29 905.9,-69.68"/>
<polygon fill="#666666" stroke="#666666" points="907.08,-72.98 915.65,-66.75 905.07,-66.28 907.08,-72.98"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node10" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1153,-209.5C1153,-209.5 1227,-209.5 1227,-209.5 1233,-209.5 1239,-215.5 1239,-221.5 1239,-221.5 1239,-235.5 1239,-235.5 1239,-241.5 1233,-247.5 1227,-247.5 1227,-247.5 1153,-247.5 1153,-247.5 1147,-247.5 1141,-241.5 1141,-235.5 1141,-235.5 1141,-221.5 1141,-221.5 1141,-215.5 1147,-209.5 1153,-209.5"/>
<text text-anchor="start" x="1149" y="-232.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1149" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push</text>
</g>
<!-- commit&#45;&gt;ReleasedLocks__push -->
<g id="edge13" class="edge">
<title>commit&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1085.75,-228.5C1100.73,-228.5 1116.28,-228.5 1130.63,-228.5"/>
<polygon fill="green" stroke="green" points="1130.83,-232 1140.83,-228.5 1130.83,-225 1130.83,-232"/>
</g>
<!-- current_lock_ts&#45;&gt;TxnStatus__Get -->
<g id="edge10" class="edge">
<title>current_lock_ts&#45;&gt;TxnStatus__Get</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M341.33,-187.38C349.76,-184.52 358.56,-181.53 367.37,-178.54"/>
<polygon fill="green" stroke="green" points="368.56,-181.83 376.91,-175.31 366.32,-175.21 368.56,-181.83"/>
</g>
<!-- current_lock_ts&#45;&gt;commit -->
<g id="edge9" class="edge">
<title>current_lock_ts&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M341.23,-209.21C470.15,-212.93 776.54,-221.78 925.42,-226.07"/>
<polygon fill="#666666" stroke="#666666" points="925.33,-229.57 935.43,-226.36 925.53,-222.57 925.33,-229.57"/>
</g>
<!-- commit_ts&#45;&gt;cleanup -->
<g id="edge7" class="edge">
<title>commit_ts&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M689.33,-132.36C697.66,-130 706.35,-127.53 715.04,-125.06"/>
<polygon fill="#666666" stroke="#666666" points="716.16,-128.38 724.83,-122.28 714.25,-121.65 716.16,-128.38"/>
</g>
<!-- commit_ts&#45;&gt;commit -->
<g id="edge8" class="edge">
<title>commit_ts&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M689.29,-162.02C753.04,-175.25 854.06,-196.23 925.57,-211.08"/>
<polygon fill="#666666" stroke="#666666" points="924.96,-214.52 935.46,-213.13 926.38,-207.67 924.96,-214.52"/>
</g>
<!-- rollback_lock&#45;&gt;ReleasedLocks__push -->
<g id="edge14" class="edge">
<title>rollback_lock&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1077.55,-167.03C1086.8,-171.84 1096.16,-176.76 1105,-181.5 1118.64,-188.81 1133.41,-196.99 1146.7,-204.44"/>
<polygon fill="green" stroke="green" points="1145.2,-207.62 1155.63,-209.47 1148.63,-201.52 1145.2,-207.62"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge15" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="#666666" d="M1239.03,-241.23C1247.49,-243.48 1256.38,-245.84 1265.08,-248.14"/>
<polygon fill="#666666" stroke="#666666" points="1264.22,-251.54 1274.79,-250.72 1266.02,-244.77 1264.22,-251.54"/>
</g>
</g>
</svg>
