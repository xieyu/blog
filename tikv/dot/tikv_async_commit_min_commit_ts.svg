<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: tikv_min_commit_ts Pages: 1 -->
<svg width="1219pt" height="206pt"
 viewBox="0.00 0.00 1219.00 206.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 202)">
<title>tikv_min_commit_ts</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-202 1215,-202 1215,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ConcurrencyManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M855,-8C855,-8 1037,-8 1037,-8 1043,-8 1049,-14 1049,-20 1049,-20 1049,-158 1049,-158 1049,-164 1043,-170 1037,-170 1037,-170 855,-170 855,-170 849,-170 843,-164 843,-158 843,-158 843,-20 843,-20 843,-14 849,-8 855,-8"/>
<text text-anchor="middle" x="946" y="-150" font-family="Times,serif" font-size="20.00">ConcurrencyManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_PrewriteMutation</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M500,-12C500,-12 811,-12 811,-12 817,-12 823,-18 823,-24 823,-24 823,-124 823,-124 823,-130 817,-136 811,-136 811,-136 500,-136 500,-136 494,-136 488,-130 488,-124 488,-124 488,-24 488,-24 488,-18 494,-12 500,-12"/>
<text text-anchor="middle" x="655.5" y="-116" font-family="Times,serif" font-size="20.00">PrewriteMutation</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_PreWriter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-12C20,-12 358,-12 358,-12 364,-12 370,-18 370,-24 370,-24 370,-178 370,-178 370,-184 364,-190 358,-190 358,-190 20,-190 20,-190 14,-190 8,-184 8,-178 8,-178 8,-24 8,-24 8,-18 14,-12 20,-12"/>
<text text-anchor="middle" x="189" y="-170" font-family="Times,serif" font-size="20.00">PreWriter</text>
</g>
<!-- max_ts -->
<g id="node1" class="node">
<title>max_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M863,-70.5C863,-70.5 1029,-70.5 1029,-70.5 1035,-70.5 1041,-76.5 1041,-82.5 1041,-82.5 1041,-119.5 1041,-119.5 1041,-125.5 1035,-131.5 1029,-131.5 1029,-131.5 863,-131.5 863,-131.5 857,-131.5 851,-125.5 851,-119.5 851,-119.5 851,-82.5 851,-82.5 851,-76.5 857,-70.5 863,-70.5"/>
<text text-anchor="middle" x="946" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#40575d">max_ts</text>
<polyline fill="none" stroke="#f7e495" points="851,-108.5 1041,-108.5 "/>
<text text-anchor="start" x="859" y="-93.3" font-family="Times,serif" font-size="14.00" fill="#40575d">每次TiDB的读操作都会更新</text>
<text text-anchor="start" x="859" y="-78.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> TiKV上的max_ts</text>
</g>
<!-- final_min_commit_ts -->
<g id="node3" class="node">
<title>final_min_commit_ts</title>
<path fill="none" stroke="#1c2123" d="M1199,-119C1199,-119 1089,-119 1089,-119 1083,-119 1077,-113 1077,-107 1077,-107 1077,-95 1077,-95 1077,-89 1083,-83 1089,-83 1089,-83 1199,-83 1199,-83 1205,-83 1211,-89 1211,-95 1211,-95 1211,-107 1211,-107 1211,-113 1205,-119 1199,-119"/>
<text text-anchor="middle" x="1144" y="-97.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">final_min_commit_ts</text>
</g>
<!-- max_ts&#45;&gt;final_min_commit_ts -->
<g id="edge1" class="edge">
<title>max_ts&#45;&gt;final_min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1041.27,-101C1049.84,-101 1058.46,-101 1066.85,-101"/>
<polygon fill="green" stroke="green" points="1066.95,-104.5 1076.95,-101 1066.95,-97.5 1066.95,-104.5"/>
</g>
<!-- lock_key -->
<g id="node2" class="node">
<title>lock_key</title>
<path fill="none" stroke="#1c2123" d="M967,-52C967,-52 925,-52 925,-52 919,-52 913,-46 913,-40 913,-40 913,-28 913,-28 913,-22 919,-16 925,-16 925,-16 967,-16 967,-16 973,-16 979,-22 979,-28 979,-28 979,-40 979,-40 979,-46 973,-52 967,-52"/>
<text text-anchor="middle" x="946" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock_key</text>
</g>
<!-- async_commit_timestamps -->
<g id="node4" class="node">
<title>async_commit_timestamps</title>
<path fill="none" stroke="#1c2123" d="M618,-21C618,-21 803,-21 803,-21 809,-21 815,-27 815,-33 815,-33 815,-85 815,-85 815,-91 809,-97 803,-97 803,-97 618,-97 618,-97 612,-97 606,-91 606,-85 606,-85 606,-33 606,-33 606,-27 612,-21 618,-21"/>
<text text-anchor="middle" x="710.5" y="-81.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_commit_timestamps</text>
<polyline fill="none" stroke="#1c2123" points="606,-74 815,-74 "/>
<text text-anchor="start" x="614" y="-58.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用start_ts, forUpdateTS</text>
<text text-anchor="start" x="614" y="-43.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> lock.min_commit_ts, max_ts</text>
<text text-anchor="start" x="614" y="-28.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 最大值作为final_min_commit_ts</text>
</g>
<!-- async_commit_timestamps&#45;&gt;max_ts -->
<g id="edge7" class="edge">
<title>async_commit_timestamps&#45;&gt;max_ts</title>
<path fill="none" stroke="#666666" d="M815.28,-77.67C823.77,-79.19 832.35,-80.74 840.85,-82.27"/>
<polygon fill="#666666" stroke="#666666" points="840.3,-85.72 850.77,-84.05 841.54,-78.84 840.3,-85.72"/>
</g>
<!-- async_commit_timestamps&#45;&gt;lock_key -->
<g id="edge8" class="edge">
<title>async_commit_timestamps&#45;&gt;lock_key</title>
<path fill="none" stroke="#666666" d="M815.28,-47.89C846.18,-44.58 878.32,-41.14 902.87,-38.51"/>
<polygon fill="#666666" stroke="#666666" points="903.34,-41.98 912.91,-37.44 902.59,-35.02 903.34,-41.98"/>
</g>
<!-- write_lock -->
<g id="node5" class="node">
<title>write_lock</title>
<path fill="none" stroke="#1c2123" d="M558,-77C558,-77 508,-77 508,-77 502,-77 496,-71 496,-65 496,-65 496,-53 496,-53 496,-47 502,-41 508,-41 508,-41 558,-41 558,-41 564,-41 570,-47 570,-53 570,-53 570,-65 570,-65 570,-71 564,-77 558,-77"/>
<text text-anchor="middle" x="533" y="-55.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_lock</text>
</g>
<!-- write_lock&#45;&gt;async_commit_timestamps -->
<g id="edge2" class="edge">
<title>write_lock&#45;&gt;async_commit_timestamps</title>
<path fill="none" stroke="#666666" d="M570.36,-59C578.1,-59 586.65,-59 595.6,-59"/>
<polygon fill="#666666" stroke="#666666" points="595.86,-62.5 605.86,-59 595.86,-55.5 595.86,-62.5"/>
</g>
<!-- prewrite -->
<g id="node6" class="node">
<title>prewrite</title>
<path fill="none" stroke="#1c2123" d="M448,-77C448,-77 410,-77 410,-77 404,-77 398,-71 398,-65 398,-65 398,-53 398,-53 398,-47 404,-41 410,-41 410,-41 448,-41 448,-41 454,-41 460,-47 460,-53 460,-53 460,-65 460,-65 460,-71 454,-77 448,-77"/>
<text text-anchor="middle" x="429" y="-55.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewrite</text>
</g>
<!-- prewrite&#45;&gt;write_lock -->
<g id="edge3" class="edge">
<title>prewrite&#45;&gt;write_lock</title>
<path fill="none" stroke="#666666" d="M460.05,-59C468.08,-59 476.94,-59 485.62,-59"/>
<polygon fill="#666666" stroke="#666666" points="485.67,-62.5 495.67,-59 485.67,-55.5 485.67,-62.5"/>
</g>
<!-- PreWriter_prewrite -->
<g id="node7" class="node">
<title>PreWriter_prewrite</title>
<path fill="none" stroke="#1c2123" d="M156,-21C156,-21 350,-21 350,-21 356,-21 362,-27 362,-33 362,-33 362,-85 362,-85 362,-91 356,-97 350,-97 350,-97 156,-97 156,-97 150,-97 144,-91 144,-85 144,-85 144,-33 144,-33 144,-27 150,-21 156,-21"/>
<text text-anchor="middle" x="253" y="-81.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewrite</text>
<polyline fill="none" stroke="#1c2123" points="144,-74 362,-74 "/>
<text text-anchor="start" x="152" y="-58.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历所有的mutation</text>
<text text-anchor="start" x="152" y="-43.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用prewrite</text>
<text text-anchor="start" x="152" y="-28.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 取最大的ts为final_min_commit_ts</text>
</g>
<!-- PreWriter_prewrite&#45;&gt;prewrite -->
<g id="edge4" class="edge">
<title>PreWriter_prewrite&#45;&gt;prewrite</title>
<path fill="none" stroke="#666666" d="M362.22,-59C371.15,-59 379.77,-59 387.65,-59"/>
<polygon fill="#666666" stroke="#666666" points="387.92,-62.5 397.92,-59 387.92,-55.5 387.92,-62.5"/>
</g>
<!-- process_write -->
<g id="node8" class="node">
<title>process_write</title>
<path fill="none" stroke="#1c2123" d="M96,-114C96,-114 28,-114 28,-114 22,-114 16,-108 16,-102 16,-102 16,-90 16,-90 16,-84 22,-78 28,-78 28,-78 96,-78 96,-78 102,-78 108,-84 108,-90 108,-90 108,-102 108,-102 108,-108 102,-114 96,-114"/>
<text text-anchor="middle" x="62" y="-92.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">process_write</text>
</g>
<!-- process_write&#45;&gt;PreWriter_prewrite -->
<g id="edge5" class="edge">
<title>process_write&#45;&gt;PreWriter_prewrite</title>
<path fill="none" stroke="#666666" d="M108.27,-87.14C116.29,-85.57 124.97,-83.87 133.95,-82.11"/>
<polygon fill="#666666" stroke="#666666" points="134.65,-85.54 143.79,-80.18 133.31,-78.67 134.65,-85.54"/>
</g>
<!-- write_result -->
<g id="node9" class="node">
<title>write_result</title>
<path fill="none" stroke="#1c2123" d="M281.5,-152C281.5,-152 224.5,-152 224.5,-152 218.5,-152 212.5,-146 212.5,-140 212.5,-140 212.5,-128 212.5,-128 212.5,-122 218.5,-116 224.5,-116 224.5,-116 281.5,-116 281.5,-116 287.5,-116 293.5,-122 293.5,-128 293.5,-128 293.5,-140 293.5,-140 293.5,-146 287.5,-152 281.5,-152"/>
<text text-anchor="middle" x="253" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write_result</text>
</g>
<!-- process_write&#45;&gt;write_result -->
<g id="edge6" class="edge">
<title>process_write&#45;&gt;write_result</title>
<path fill="none" stroke="#666666" d="M108.27,-105.1C136.6,-110.8 173.12,-118.14 202.26,-124"/>
<polygon fill="#666666" stroke="#666666" points="201.74,-127.46 212.23,-126 203.12,-120.6 201.74,-127.46"/>
</g>
</g>
</svg>
