<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: tikv_prewrite2 Pages: 1 -->
<svg width="1278pt" height="573pt"
 viewBox="0.00 0.00 1278.00 573.08" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 569.08)">
<title>tikv_prewrite2</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-569.08 1274,-569.08 1274,4 -4,4"/>
<!-- prewrite -->
<g id="node1" class="node">
<title>prewrite</title>
<path fill="none" stroke="#1c2123" d="M12,-206.5C12,-206.5 122,-206.5 122,-206.5 128,-206.5 134,-212.5 134,-218.5 134,-218.5 134,-285.5 134,-285.5 134,-291.5 128,-297.5 122,-297.5 122,-297.5 12,-297.5 12,-297.5 6,-297.5 0,-291.5 0,-285.5 0,-285.5 0,-218.5 0,-218.5 0,-212.5 6,-206.5 12,-206.5"/>
<text text-anchor="middle" x="67" y="-282.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewrite</text>
<polyline fill="none" stroke="#1c2123" points="0,-274.5 134,-274.5 "/>
<text text-anchor="start" x="8" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewrite a single</text>
<text text-anchor="start" x="8" y="-244.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mutation</text>
<text text-anchor="start" x="8" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> by create and storing</text>
<text text-anchor="start" x="8" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> a locak and value</text>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node2" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M182,-248C182,-248 273,-248 273,-248 279,-248 285,-254 285,-260 285,-260 285,-312 285,-312 285,-318 279,-324 273,-324 273,-324 182,-324 182,-324 176,-324 170,-318 170,-312 170,-312 170,-260 170,-260 170,-254 176,-248 182,-248"/>
<text text-anchor="start" x="178" y="-308.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="178" y="-293.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="170,-286 285,-286 "/>
<text text-anchor="start" x="178" y="-270.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用MvccReader</text>
<text text-anchor="start" x="178" y="-255.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
</g>
<!-- prewrite&#45;&gt;SnapshotReader__load_lock -->
<g id="edge1" class="edge">
<title>prewrite&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M134.3,-266.22C142.62,-268.01 151.14,-269.83 159.47,-271.62"/>
<polygon fill="#666666" stroke="#666666" points="159.01,-275.1 169.52,-273.78 160.48,-268.26 159.01,-275.1"/>
</g>
<!-- PrewriteMutation__check_lock -->
<g id="node3" class="node">
<title>PrewriteMutation__check_lock</title>
<path fill="none" stroke="#1c2123" d="M508.5,-129C508.5,-129 657.5,-129 657.5,-129 663.5,-129 669.5,-135 669.5,-141 669.5,-141 669.5,-193 669.5,-193 669.5,-199 663.5,-205 657.5,-205 657.5,-205 508.5,-205 508.5,-205 502.5,-205 496.5,-199 496.5,-193 496.5,-193 496.5,-141 496.5,-141 496.5,-135 502.5,-129 508.5,-129"/>
<text text-anchor="start" x="504.5" y="-189.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PrewriteMutation</text>
<text text-anchor="start" x="504.5" y="-174.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_lock</text>
<polyline fill="none" stroke="#1c2123" points="496.5,-167 669.5,-167 "/>
<text text-anchor="start" x="504.5" y="-151.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock.ts == txn_props.start_ts</text>
<text text-anchor="start" x="504.5" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查lock_type是否一致</text>
</g>
<!-- prewrite&#45;&gt;PrewriteMutation__check_lock -->
<g id="edge2" class="edge">
<title>prewrite&#45;&gt;PrewriteMutation__check_lock</title>
<path fill="none" stroke="#666666" d="M134.08,-227.08C145.92,-223.26 158.23,-219.7 170,-217 276.79,-192.48 402.09,-179.45 486.22,-172.91"/>
<polygon fill="#666666" stroke="#666666" points="486.57,-176.39 496.27,-172.14 486.04,-169.41 486.57,-176.39"/>
</g>
<!-- amend_pessimistic_lock -->
<g id="node4" class="node">
<title>amend_pessimistic_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M506,-247.5C506,-247.5 660,-247.5 660,-247.5 666,-247.5 672,-253.5 672,-259.5 672,-259.5 672,-356.5 672,-356.5 672,-362.5 666,-368.5 660,-368.5 660,-368.5 506,-368.5 506,-368.5 500,-368.5 494,-362.5 494,-356.5 494,-356.5 494,-259.5 494,-259.5 494,-253.5 500,-247.5 506,-247.5"/>
<text text-anchor="middle" x="583" y="-353.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">amend_pessimistic_lock</text>
<polyline fill="none" stroke="#8a8898" points="494,-345.5 672,-345.5 "/>
<text text-anchor="start" x="502" y="-330.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">对于悲观锁做一些check</text>
<text text-anchor="start" x="502" y="-315.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 没问题的话</text>
<text text-anchor="start" x="502" y="-300.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 就继续执行后续write_lock</text>
<text text-anchor="start" x="502" y="-285.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 检查write</text>
<text text-anchor="start" x="502" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 是否有commit_ts &gt;</text>
<text text-anchor="start" x="502" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> = reader.start_ts</text>
</g>
<!-- prewrite&#45;&gt;amend_pessimistic_lock -->
<g id="edge3" class="edge">
<title>prewrite&#45;&gt;amend_pessimistic_lock</title>
<path fill="none" stroke="#666666" d="M134.14,-238.17C212.77,-224.32 347.26,-208.9 458,-238 466.87,-240.33 475.77,-243.45 484.51,-247.09"/>
<polygon fill="#666666" stroke="#666666" points="483.35,-250.41 493.91,-251.23 486.17,-244 483.35,-250.41"/>
</g>
<!-- PrewriteMutation__write_lock -->
<g id="node5" class="node">
<title>PrewriteMutation__write_lock</title>
<path fill="none" stroke="#1c2123" d="M779,-404.5C779,-404.5 868,-404.5 868,-404.5 874,-404.5 880,-410.5 880,-416.5 880,-416.5 880,-453.5 880,-453.5 880,-459.5 874,-465.5 868,-465.5 868,-465.5 779,-465.5 779,-465.5 773,-465.5 767,-459.5 767,-453.5 767,-453.5 767,-416.5 767,-416.5 767,-410.5 773,-404.5 779,-404.5"/>
<text text-anchor="start" x="775" y="-450.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PrewriteMutation</text>
<text text-anchor="start" x="775" y="-435.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write_lock</text>
<polyline fill="none" stroke="#1c2123" points="767,-427.5 880,-427.5 "/>
<text text-anchor="start" x="775" y="-412.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">写入lock</text>
</g>
<!-- prewrite&#45;&gt;PrewriteMutation__write_lock -->
<g id="edge4" class="edge">
<title>prewrite&#45;&gt;PrewriteMutation__write_lock</title>
<path fill="none" stroke="#666666" d="M118.63,-297.88C166.68,-337.93 242.97,-392.86 321,-414 472.71,-455.09 659.59,-448.71 756.77,-441.34"/>
<polygon fill="#666666" stroke="#666666" points="757.05,-444.83 766.74,-440.56 756.5,-437.86 757.05,-444.83"/>
</g>
<!-- LockStatus__None -->
<g id="node18" class="node">
<title>LockStatus__None</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M333,-328C333,-328 446,-328 446,-328 452,-328 458,-334 458,-340 458,-340 458,-392 458,-392 458,-398 452,-404 446,-404 446,-404 333,-404 333,-404 327,-404 321,-398 321,-392 321,-392 321,-340 321,-340 321,-334 327,-328 333,-328"/>
<text text-anchor="start" x="329" y="-388.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockStatus</text>
<text text-anchor="start" x="329" y="-373.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> None</text>
<polyline fill="none" stroke="#8a8898" points="321,-366 458,-366 "/>
<text text-anchor="start" x="329" y="-350.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">key上没有lock</text>
<text text-anchor="start" x="329" y="-335.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> prewrite可以去加锁</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;LockStatus__None -->
<g id="edge17" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;LockStatus__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M285.36,-314.43C293.89,-318.7 302.81,-323.16 311.68,-327.59"/>
<polygon fill="green" stroke="green" points="310.37,-330.85 320.88,-332.19 313.5,-324.59 310.37,-330.85"/>
</g>
<!-- LockStatus__Some -->
<g id="node19" class="node">
<title>LockStatus__Some</title>
<path fill="none" stroke="#1c2123" d="M357.5,-247.5C357.5,-247.5 421.5,-247.5 421.5,-247.5 427.5,-247.5 433.5,-253.5 433.5,-259.5 433.5,-259.5 433.5,-296.5 433.5,-296.5 433.5,-302.5 427.5,-308.5 421.5,-308.5 421.5,-308.5 357.5,-308.5 357.5,-308.5 351.5,-308.5 345.5,-302.5 345.5,-296.5 345.5,-296.5 345.5,-259.5 345.5,-259.5 345.5,-253.5 351.5,-247.5 357.5,-247.5"/>
<text text-anchor="start" x="353.5" y="-293.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockStatus</text>
<text text-anchor="start" x="353.5" y="-278.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Some</text>
<polyline fill="none" stroke="#1c2123" points="345.5,-270.5 433.5,-270.5 "/>
<text text-anchor="start" x="353.5" y="-255.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">key上有lock</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;LockStatus__Some -->
<g id="edge19" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;LockStatus__Some</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M285.36,-283.16C301.57,-282.35 319.17,-281.47 335.16,-280.67"/>
<polygon fill="green" stroke="green" points="335.59,-284.15 345.41,-280.15 335.24,-277.16 335.59,-284.15"/>
</g>
<!-- ErrorInner__PessimisticLockNotFound -->
<g id="node12" class="node">
<title>ErrorInner__PessimisticLockNotFound</title>
<path fill="none" stroke="#1c2123" d="M927,-290C927,-290 720,-290 720,-290 714,-290 708,-284 708,-278 708,-278 708,-266 708,-266 708,-260 714,-254 720,-254 720,-254 927,-254 927,-254 933,-254 939,-260 939,-266 939,-266 939,-278 939,-278 939,-284 933,-290 927,-290"/>
<text text-anchor="middle" x="823.5" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrorInner__PessimisticLockNotFound</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;ErrorInner__PessimisticLockNotFound -->
<g id="edge11" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;ErrorInner__PessimisticLockNotFound</title>
<path fill="none" stroke="#666666" d="M635.91,-205.03C657.36,-219.28 683.02,-234.54 708,-245 713,-247.1 718.2,-249.05 723.5,-250.86"/>
<polygon fill="#666666" stroke="#666666" points="722.53,-254.23 733.13,-253.98 724.69,-247.57 722.53,-254.23"/>
</g>
<!-- ErrorInner__KeyIsLocked -->
<g id="node13" class="node">
<title>ErrorInner__KeyIsLocked</title>
<path fill="none" stroke="#1c2123" d="M891.5,-36C891.5,-36 755.5,-36 755.5,-36 749.5,-36 743.5,-30 743.5,-24 743.5,-24 743.5,-12 743.5,-12 743.5,-6 749.5,0 755.5,0 755.5,0 891.5,0 891.5,0 897.5,0 903.5,-6 903.5,-12 903.5,-12 903.5,-24 903.5,-24 903.5,-30 897.5,-36 891.5,-36"/>
<text text-anchor="middle" x="823.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrorInner__KeyIsLocked</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;ErrorInner__KeyIsLocked -->
<g id="edge12" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;ErrorInner__KeyIsLocked</title>
<path fill="none" stroke="#666666" d="M613.05,-128.87C635.93,-101.49 670.19,-65.87 708,-45 716.01,-40.58 724.72,-36.88 733.65,-33.78"/>
<polygon fill="#666666" stroke="#666666" points="734.94,-37.04 743.39,-30.65 732.8,-30.38 734.94,-37.04"/>
</g>
<!-- ErrorInner__LockTypeNotMatched -->
<g id="node14" class="node">
<title>ErrorInner__LockTypeNotMatched</title>
<path fill="none" stroke="#1c2123" d="M917,-236C917,-236 730,-236 730,-236 724,-236 718,-230 718,-224 718,-224 718,-212 718,-212 718,-206 724,-200 730,-200 730,-200 917,-200 917,-200 923,-200 929,-206 929,-212 929,-212 929,-224 929,-224 929,-230 923,-236 917,-236"/>
<text text-anchor="middle" x="823.5" y="-214.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrorInner__LockTypeNotMatched</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;ErrorInner__LockTypeNotMatched -->
<g id="edge13" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;ErrorInner__LockTypeNotMatched</title>
<path fill="none" stroke="#666666" d="M669.77,-185.34C688.76,-189.4 708.98,-193.73 728.29,-197.85"/>
<polygon fill="#666666" stroke="#666666" points="727.78,-201.32 738.29,-199.99 729.25,-194.48 727.78,-201.32"/>
</g>
<!-- LockStatus__Locked -->
<g id="node15" class="node">
<title>LockStatus__Locked</title>
<path fill="none" stroke="#1c2123" d="M877,-182C877,-182 770,-182 770,-182 764,-182 758,-176 758,-170 758,-170 758,-158 758,-158 758,-152 764,-146 770,-146 770,-146 877,-146 877,-146 883,-146 889,-152 889,-158 889,-158 889,-170 889,-170 889,-176 883,-182 877,-182"/>
<text text-anchor="middle" x="823.5" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockStatus__Locked</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;LockStatus__Locked -->
<g id="edge14" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;LockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M669.77,-165.92C695.24,-165.6 722.93,-165.25 747.64,-164.94"/>
<polygon fill="#666666" stroke="#666666" points="747.72,-168.44 757.68,-164.82 747.64,-161.44 747.72,-168.44"/>
</g>
<!-- Lock__use_async_commit -->
<g id="node16" class="node">
<title>Lock__use_async_commit</title>
<path fill="none" stroke="#1c2123" d="M893,-90C893,-90 754,-90 754,-90 748,-90 742,-84 742,-78 742,-78 742,-66 742,-66 742,-60 748,-54 754,-54 754,-54 893,-54 893,-54 899,-54 905,-60 905,-66 905,-66 905,-78 905,-78 905,-84 899,-90 893,-90"/>
<text text-anchor="middle" x="823.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__use_async_commit</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;Lock__use_async_commit -->
<g id="edge15" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;Lock__use_async_commit</title>
<path fill="none" stroke="#666666" d="M653.06,-128.88C670.67,-120.01 689.77,-111.1 708,-104 718.16,-100.04 729,-96.36 739.82,-93"/>
<polygon fill="#666666" stroke="#666666" points="741.15,-96.25 749.71,-90.01 739.13,-89.55 741.15,-96.25"/>
</g>
<!-- Lock__min_commit_ts -->
<g id="node17" class="node">
<title>Lock__min_commit_ts</title>
<path fill="none" stroke="#1c2123" d="M1128,-113C1128,-113 1007,-113 1007,-113 1001,-113 995,-107 995,-101 995,-101 995,-89 995,-89 995,-83 1001,-77 1007,-77 1007,-77 1128,-77 1128,-77 1134,-77 1140,-83 1140,-89 1140,-89 1140,-101 1140,-101 1140,-107 1134,-113 1128,-113"/>
<text text-anchor="middle" x="1067.5" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__min_commit_ts</text>
</g>
<!-- PrewriteMutation__check_lock&#45;&gt;Lock__min_commit_ts -->
<g id="edge16" class="edge">
<title>PrewriteMutation__check_lock&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="#666666" d="M669.77,-144.83C682.53,-141.94 695.57,-139.22 708,-137 802.26,-120.14 911.73,-108.44 984.66,-101.75"/>
<polygon fill="#666666" stroke="#666666" points="985.06,-105.23 994.71,-100.84 984.43,-98.26 985.06,-105.23"/>
</g>
<!-- amend_pessimistic_lock&#45;&gt;PrewriteMutation__write_lock -->
<g id="edge25" class="edge">
<title>amend_pessimistic_lock&#45;&gt;PrewriteMutation__write_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M663.69,-368.67C678.02,-378.18 693.14,-387.38 708,-395 723.43,-402.91 740.78,-409.87 757.21,-415.68"/>
<polygon fill="green" stroke="green" points="756.17,-419.02 766.76,-418.96 758.44,-412.4 756.17,-419.02"/>
</g>
<!-- amend_pessimistic_lock&#45;&gt;ErrorInner__PessimisticLockNotFound -->
<g id="edge22" class="edge">
<title>amend_pessimistic_lock&#45;&gt;ErrorInner__PessimisticLockNotFound</title>
<path fill="none" stroke="#666666" d="M672.13,-294.7C680.52,-293.43 689.14,-292.13 697.79,-290.82"/>
<polygon fill="#666666" stroke="#666666" points="698.59,-294.24 707.95,-289.29 697.54,-287.32 698.59,-294.24"/>
</g>
<!-- SnapshotReader__seek_write -->
<g id="node20" class="node">
<title>SnapshotReader__seek_write</title>
<path fill="none" stroke="#1c2123" d="M778,-309C778,-309 869,-309 869,-309 875,-309 881,-315 881,-321 881,-321 881,-373 881,-373 881,-379 875,-385 869,-385 869,-385 778,-385 778,-385 772,-385 766,-379 766,-373 766,-373 766,-321 766,-321 766,-315 772,-309 778,-309"/>
<text text-anchor="start" x="774" y="-369.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="774" y="-354.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
<polyline fill="none" stroke="#1c2123" points="766,-347 881,-347 "/>
<text text-anchor="start" x="774" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">调用MvccReader</text>
<text text-anchor="start" x="774" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
</g>
<!-- amend_pessimistic_lock&#45;&gt;SnapshotReader__seek_write -->
<g id="edge23" class="edge">
<title>amend_pessimistic_lock&#45;&gt;SnapshotReader__seek_write</title>
<path fill="none" stroke="#666666" d="M672.13,-322.41C699.78,-326.93 729.82,-331.85 755.74,-336.08"/>
<polygon fill="#666666" stroke="#666666" points="755.39,-339.57 765.82,-337.73 756.52,-332.66 755.39,-339.57"/>
</g>
<!-- Lock__new -->
<g id="node6" class="node">
<title>Lock__new</title>
<path fill="none" stroke="#1c2123" d="M1095.5,-426C1095.5,-426 1039.5,-426 1039.5,-426 1033.5,-426 1027.5,-420 1027.5,-414 1027.5,-414 1027.5,-402 1027.5,-402 1027.5,-396 1033.5,-390 1039.5,-390 1039.5,-390 1095.5,-390 1095.5,-390 1101.5,-390 1107.5,-396 1107.5,-402 1107.5,-402 1107.5,-414 1107.5,-414 1107.5,-420 1101.5,-426 1095.5,-426"/>
<text text-anchor="middle" x="1067.5" y="-404.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__new</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;Lock__new -->
<g id="edge5" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;Lock__new</title>
<path fill="none" stroke="#666666" d="M880.02,-428.81C921.48,-424.18 977.63,-417.92 1017.45,-413.47"/>
<polygon fill="#666666" stroke="#666666" points="1017.9,-416.94 1027.45,-412.36 1017.13,-409.99 1017.9,-416.94"/>
</g>
<!-- is_short_value -->
<g id="node7" class="node">
<title>is_short_value</title>
<path fill="none" stroke="#1c2123" d="M993,-287C993,-287 1142,-287 1142,-287 1148,-287 1154,-293 1154,-299 1154,-299 1154,-359 1154,-359 1154,-365 1148,-371 1142,-371 1142,-371 993,-371 993,-371 987,-371 981,-365 981,-359 981,-359 981,-299 981,-299 981,-293 987,-287 993,-287"/>
<text text-anchor="middle" x="1067.5" y="-355.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">is_short_value</text>
<polyline fill="none" stroke="#1c2123" points="981,-348 1154,-348 "/>
<text text-anchor="start" x="989" y="-332.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">short value优化</text>
<polyline fill="none" stroke="#1c2123" points="981,-325 1154,-325 "/>
<text text-anchor="start" x="989" y="-309.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果是short value</text>
<text text-anchor="start" x="989" y="-294.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> value可以直接存在lock上</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;is_short_value -->
<g id="edge6" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;is_short_value</title>
<path fill="none" stroke="#666666" d="M880.14,-417.33C899.04,-410.86 920.15,-403.12 939,-395 952.61,-389.13 966.78,-382.43 980.52,-375.6"/>
<polygon fill="#666666" stroke="#666666" points="982.11,-378.72 989.47,-371.09 978.96,-372.46 982.11,-378.72"/>
</g>
<!-- MvccTxn__put_value -->
<g id="node8" class="node">
<title>MvccTxn__put_value</title>
<path fill="#feed9b" stroke="#f7e495" d="M1208,-262.5C1208,-262.5 1258,-262.5 1258,-262.5 1264,-262.5 1270,-268.5 1270,-274.5 1270,-274.5 1270,-311.5 1270,-311.5 1270,-317.5 1264,-323.5 1258,-323.5 1258,-323.5 1208,-323.5 1208,-323.5 1202,-323.5 1196,-317.5 1196,-311.5 1196,-311.5 1196,-274.5 1196,-274.5 1196,-268.5 1202,-262.5 1208,-262.5"/>
<text text-anchor="start" x="1204" y="-308.3" font-family="Times,serif" font-size="14.00" fill="#40575d">MvccTxn</text>
<text text-anchor="start" x="1204" y="-293.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> put_value</text>
<polyline fill="none" stroke="#f7e495" points="1196,-285.5 1270,-285.5 "/>
<text text-anchor="start" x="1204" y="-270.3" font-family="Times,serif" font-size="14.00" fill="#40575d">写入value</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_value -->
<g id="edge7" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_value</title>
<path fill="none" stroke="#666666" d="M880.12,-426.53C901.01,-420.79 923.44,-411.15 939,-395 976.74,-355.81 931.24,-310.32 975,-278 1036.56,-232.54 1130.73,-254.6 1186.36,-274.2"/>
<polygon fill="#666666" stroke="#666666" points="1185.36,-277.55 1195.95,-277.68 1187.75,-270.98 1185.36,-277.55"/>
</g>
<!-- async_commit_timestamps -->
<g id="node9" class="node">
<title>async_commit_timestamps</title>
<path fill="none" stroke="#1c2123" d="M1139,-534C1139,-534 996,-534 996,-534 990,-534 984,-528 984,-522 984,-522 984,-510 984,-510 984,-504 990,-498 996,-498 996,-498 1139,-498 1139,-498 1145,-498 1151,-504 1151,-510 1151,-510 1151,-522 1151,-522 1151,-528 1145,-534 1139,-534"/>
<text text-anchor="middle" x="1067.5" y="-512.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">async_commit_timestamps</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;async_commit_timestamps -->
<g id="edge8" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;async_commit_timestamps</title>
<path fill="none" stroke="#666666" d="M880.34,-455.9C908.58,-466.25 943.47,-478.7 975,-489 980.99,-490.96 987.23,-492.93 993.5,-494.87"/>
<polygon fill="#666666" stroke="#666666" points="992.76,-498.3 1003.35,-497.88 994.81,-491.61 992.76,-498.3"/>
</g>
<!-- MvccTxn__put_locks_for_1pc -->
<g id="node10" class="node">
<title>MvccTxn__put_locks_for_1pc</title>
<path fill="none" stroke="#1c2123" d="M1148,-480C1148,-480 987,-480 987,-480 981,-480 975,-474 975,-468 975,-468 975,-456 975,-456 975,-450 981,-444 987,-444 987,-444 1148,-444 1148,-444 1154,-444 1160,-450 1160,-456 1160,-456 1160,-468 1160,-468 1160,-474 1154,-480 1148,-480"/>
<text text-anchor="middle" x="1067.5" y="-458.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn__put_locks_for_1pc</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_locks_for_1pc -->
<g id="edge9" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_locks_for_1pc</title>
<path fill="none" stroke="#666666" d="M880.02,-441.19C905.11,-443.99 935.58,-447.39 964.55,-450.63"/>
<polygon fill="#666666" stroke="#666666" points="964.39,-454.13 974.72,-451.76 965.17,-447.17 964.39,-454.13"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node11" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#feed9b" stroke="#f7e495" d="M1210,-436.5C1210,-436.5 1256,-436.5 1256,-436.5 1262,-436.5 1268,-442.5 1268,-448.5 1268,-448.5 1268,-485.5 1268,-485.5 1268,-491.5 1262,-497.5 1256,-497.5 1256,-497.5 1210,-497.5 1210,-497.5 1204,-497.5 1198,-491.5 1198,-485.5 1198,-485.5 1198,-448.5 1198,-448.5 1198,-442.5 1204,-436.5 1210,-436.5"/>
<text text-anchor="start" x="1206" y="-482.3" font-family="Times,serif" font-size="14.00" fill="#40575d">MvccTxn</text>
<text text-anchor="start" x="1206" y="-467.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> put_lock</text>
<polyline fill="none" stroke="#f7e495" points="1198,-459.5 1268,-459.5 "/>
<text text-anchor="start" x="1206" y="-444.3" font-family="Times,serif" font-size="14.00" fill="#40575d">写入lock</text>
</g>
<!-- PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_lock -->
<g id="edge10" class="edge">
<title>PrewriteMutation__write_lock&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="#666666" d="M854.68,-465.55C882.97,-491.83 927.85,-527.83 975,-543 1053.27,-568.18 1084.47,-575.49 1160,-543 1178.17,-535.18 1193.91,-520.27 1205.99,-505.72"/>
<polygon fill="#666666" stroke="#666666" points="1208.87,-507.73 1212.32,-497.71 1203.38,-503.39 1208.87,-507.73"/>
</g>
<!-- is_short_value&#45;&gt;MvccTxn__put_value -->
<g id="edge26" class="edge">
<title>is_short_value&#45;&gt;MvccTxn__put_value</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1154.08,-310.16C1164.98,-307.76 1175.78,-305.38 1185.72,-303.19"/>
<polygon fill="green" stroke="green" points="1186.71,-306.56 1195.73,-300.99 1185.21,-299.72 1186.71,-306.56"/>
</g>
<!-- is_short_value&#45;&gt;MvccTxn__put_lock -->
<g id="edge27" class="edge">
<title>is_short_value&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1147.15,-371.14C1151.61,-374.31 1155.93,-377.61 1160,-381 1176.43,-394.7 1192.01,-412.48 1204.45,-428.31"/>
<polygon fill="green" stroke="green" points="1201.79,-430.59 1210.66,-436.38 1207.34,-426.32 1201.79,-430.59"/>
</g>
<!-- Lock__use_async_commit&#45;&gt;Lock__min_commit_ts -->
<g id="edge24" class="edge">
<title>Lock__use_async_commit&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M905.08,-79.66C930.69,-82.09 959.04,-84.79 984.73,-87.23"/>
<polygon fill="green" stroke="green" points="984.52,-90.72 994.81,-88.19 985.19,-83.76 984.52,-90.72"/>
</g>
<!-- LockStatus__None&#45;&gt;amend_pessimistic_lock -->
<g id="edge18" class="edge">
<title>LockStatus__None&#45;&gt;amend_pessimistic_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M458.02,-345.55C466.56,-342.96 475.43,-340.28 484.32,-337.59"/>
<polygon fill="green" stroke="green" points="485.41,-340.91 493.96,-334.66 483.38,-334.21 485.41,-340.91"/>
</g>
<!-- LockStatus__None&#45;&gt;PrewriteMutation__write_lock -->
<g id="edge21" class="edge">
<title>LockStatus__None&#45;&gt;PrewriteMutation__write_lock</title>
<path fill="none" stroke="#666666" d="M458.48,-376.86C540.17,-389.9 676.28,-411.65 756.9,-424.52"/>
<polygon fill="#666666" stroke="#666666" points="756.5,-428 766.93,-426.12 757.61,-421.09 756.5,-428"/>
</g>
<!-- LockStatus__Some&#45;&gt;PrewriteMutation__check_lock -->
<g id="edge20" class="edge">
<title>LockStatus__Some&#45;&gt;PrewriteMutation__check_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M433.95,-252.81C455.67,-240.22 482.57,-224.64 507.45,-210.21"/>
<polygon fill="green" stroke="green" points="509.26,-213.21 516.16,-205.17 505.75,-207.15 509.26,-213.21"/>
</g>
</g>
</svg>
