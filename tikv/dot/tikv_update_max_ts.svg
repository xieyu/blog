<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1745pt" height="938pt"
 viewBox="0.00 0.00 1745.00 938.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 934)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-934 1741,-934 1741,4 -4,4"/>
<!-- Storage__scan -->
<g id="node1" class="node">
<title>Storage__scan</title>
<path fill="none" stroke="#1c2123" d="M1443.5,-930C1443.5,-930 1372.5,-930 1372.5,-930 1366.5,-930 1360.5,-924 1360.5,-918 1360.5,-918 1360.5,-906 1360.5,-906 1360.5,-900 1366.5,-894 1372.5,-894 1372.5,-894 1443.5,-894 1443.5,-894 1449.5,-894 1455.5,-900 1455.5,-906 1455.5,-906 1455.5,-918 1455.5,-918 1455.5,-924 1449.5,-930 1443.5,-930"/>
<text text-anchor="middle" x="1408" y="-908.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Storage__scan</text>
</g>
<!-- ConcurrencyManager__update_max_ts -->
<g id="node15" class="node">
<title>ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M1603,-369C1603,-369 1725,-369 1725,-369 1731,-369 1737,-375 1737,-381 1737,-381 1737,-441 1737,-441 1737,-447 1731,-453 1725,-453 1725,-453 1603,-453 1603,-453 1597,-453 1591,-447 1591,-441 1591,-441 1591,-381 1591,-381 1591,-375 1597,-369 1603,-369"/>
<text text-anchor="start" x="1599" y="-437.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager</text>
<text text-anchor="start" x="1599" y="-422.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> update_max_ts</text>
<polyline fill="none" stroke="#1c2123" points="1591,-415 1737,-415 "/>
<text text-anchor="start" x="1599" y="-399.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新Arc&lt;AtomicU64&gt;</text>
<polyline fill="none" stroke="#1c2123" points="1591,-392 1737,-392 "/>
<text text-anchor="start" x="1599" y="-376.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">max_ts</text>
</g>
<!-- Storage__scan&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge1" class="edge">
<title>Storage__scan&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1455.51,-914C1487.64,-912.78 1529.08,-905.64 1555,-880 1613.83,-821.79 1646.29,-572.8 1657.95,-463.17"/>
<polygon fill="#666666" stroke="#666666" points="1661.46,-463.32 1659.02,-453.01 1654.5,-462.59 1661.46,-463.32"/>
</g>
<!-- Storage__scan_lock -->
<g id="node2" class="node">
<title>Storage__scan_lock</title>
<path fill="none" stroke="#1c2123" d="M873.5,-884C873.5,-884 772.5,-884 772.5,-884 766.5,-884 760.5,-878 760.5,-872 760.5,-872 760.5,-860 760.5,-860 760.5,-854 766.5,-848 772.5,-848 772.5,-848 873.5,-848 873.5,-848 879.5,-848 885.5,-854 885.5,-860 885.5,-860 885.5,-872 885.5,-872 885.5,-878 879.5,-884 873.5,-884"/>
<text text-anchor="middle" x="823" y="-862.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Storage__scan_lock</text>
</g>
<!-- Storage__scan_lock&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge2" class="edge">
<title>Storage__scan_lock&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M885.73,-868.6C1052.59,-875.04 1503.51,-888.38 1555,-847 1614.63,-799.07 1646.3,-568.48 1657.84,-463.39"/>
<polygon fill="#666666" stroke="#666666" points="1661.33,-463.64 1658.92,-453.32 1654.37,-462.88 1661.33,-463.64"/>
</g>
<!-- CheckTxnStatus__process_write -->
<g id="node3" class="node">
<title>CheckTxnStatus__process_write</title>
<path fill="none" stroke="#1c2123" d="M1347,-585C1347,-585 1469,-585 1469,-585 1475,-585 1481,-591 1481,-597 1481,-597 1481,-649 1481,-649 1481,-655 1475,-661 1469,-661 1469,-661 1347,-661 1347,-661 1341,-661 1335,-655 1335,-649 1335,-649 1335,-597 1335,-597 1335,-591 1341,-585 1347,-585"/>
<text text-anchor="start" x="1343" y="-645.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus</text>
<text text-anchor="start" x="1343" y="-630.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="1335,-623 1481,-623 "/>
<text text-anchor="start" x="1343" y="-607.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务t2遇到t1的lock时</text>
<text text-anchor="start" x="1343" y="-592.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查t1事务状态</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge3" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1481.22,-609.53C1506.36,-602.3 1533.6,-591.37 1555,-575 1593.28,-545.72 1622.21,-498.76 1640.45,-462.59"/>
<polygon fill="#666666" stroke="#666666" points="1643.81,-463.68 1645.09,-453.17 1637.53,-460.6 1643.81,-463.68"/>
</g>
<!-- AcquirePessimisticLock__process_write -->
<g id="node4" class="node">
<title>AcquirePessimisticLock__process_write</title>
<path fill="none" stroke="#1c2123" d="M1345.5,-504.5C1345.5,-504.5 1470.5,-504.5 1470.5,-504.5 1476.5,-504.5 1482.5,-510.5 1482.5,-516.5 1482.5,-516.5 1482.5,-553.5 1482.5,-553.5 1482.5,-559.5 1476.5,-565.5 1470.5,-565.5 1470.5,-565.5 1345.5,-565.5 1345.5,-565.5 1339.5,-565.5 1333.5,-559.5 1333.5,-553.5 1333.5,-553.5 1333.5,-516.5 1333.5,-516.5 1333.5,-510.5 1339.5,-504.5 1345.5,-504.5"/>
<text text-anchor="start" x="1341.5" y="-550.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">AcquirePessimisticLock</text>
<text text-anchor="start" x="1341.5" y="-535.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="1333.5,-527.5 1482.5,-527.5 "/>
<text text-anchor="start" x="1341.5" y="-512.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取悲观Lock</text>
</g>
<!-- AcquirePessimisticLock__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge4" class="edge">
<title>AcquirePessimisticLock__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1482.74,-520.8C1506.54,-514.66 1532.56,-506.24 1555,-495 1573.89,-485.54 1592.69,-472.51 1609.19,-459.54"/>
<polygon fill="#666666" stroke="#666666" points="1611.48,-462.18 1617.09,-453.19 1607.1,-456.73 1611.48,-462.18"/>
</g>
<!-- CheckSecondaryLocks__process_write -->
<g id="node5" class="node">
<title>CheckSecondaryLocks__process_write</title>
<path fill="none" stroke="#1c2123" d="M1341,-761C1341,-761 1475,-761 1475,-761 1481,-761 1487,-767 1487,-773 1487,-773 1487,-825 1487,-825 1487,-831 1481,-837 1475,-837 1475,-837 1341,-837 1341,-837 1335,-837 1329,-831 1329,-825 1329,-825 1329,-773 1329,-773 1329,-767 1335,-761 1341,-761"/>
<text text-anchor="start" x="1337" y="-821.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks</text>
<text text-anchor="start" x="1337" y="-806.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="1329,-799 1487,-799 "/>
<text text-anchor="start" x="1337" y="-783.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">async commit的txn</text>
<text text-anchor="start" x="1337" y="-768.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 检查它的seconary locks</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge5" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1487.31,-787.63C1511.68,-780.62 1536.89,-769.3 1555,-751 1633.03,-672.18 1654.74,-537.26 1660.74,-463.3"/>
<polygon fill="#666666" stroke="#666666" points="1664.24,-463.51 1661.49,-453.28 1657.26,-462.99 1664.24,-463.51"/>
</g>
<!-- Cleanup__process_write -->
<g id="node6" class="node">
<title>Cleanup__process_write</title>
<path fill="none" stroke="#1c2123" d="M1372.5,-680.5C1372.5,-680.5 1443.5,-680.5 1443.5,-680.5 1449.5,-680.5 1455.5,-686.5 1455.5,-692.5 1455.5,-692.5 1455.5,-729.5 1455.5,-729.5 1455.5,-735.5 1449.5,-741.5 1443.5,-741.5 1443.5,-741.5 1372.5,-741.5 1372.5,-741.5 1366.5,-741.5 1360.5,-735.5 1360.5,-729.5 1360.5,-729.5 1360.5,-692.5 1360.5,-692.5 1360.5,-686.5 1366.5,-680.5 1372.5,-680.5"/>
<text text-anchor="start" x="1368.5" y="-726.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Cleanup</text>
<text text-anchor="start" x="1368.5" y="-711.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="1360.5,-703.5 1455.5,-703.5 "/>
<text text-anchor="start" x="1368.5" y="-688.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">清理lock</text>
</g>
<!-- Cleanup__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge6" class="edge">
<title>Cleanup__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1455.78,-708.66C1487.2,-704.8 1527.69,-695.06 1555,-671 1616.54,-616.78 1643.8,-521.94 1655.29,-463.02"/>
<polygon fill="#666666" stroke="#666666" points="1658.73,-463.64 1657.13,-453.17 1651.85,-462.36 1658.73,-463.64"/>
</g>
<!-- ReplicaReadLockChecker__on_step -->
<g id="node7" class="node">
<title>ReplicaReadLockChecker__on_step</title>
<path fill="none" stroke="#1c2123" d="M1341,-329C1341,-329 1475,-329 1475,-329 1481,-329 1487,-335 1487,-341 1487,-341 1487,-393 1487,-393 1487,-399 1481,-405 1475,-405 1475,-405 1341,-405 1341,-405 1335,-405 1329,-399 1329,-393 1329,-393 1329,-341 1329,-341 1329,-335 1335,-329 1341,-329"/>
<text text-anchor="start" x="1337" y="-389.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReplicaReadLockChecker</text>
<text text-anchor="start" x="1337" y="-374.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_step</text>
<polyline fill="none" stroke="#1c2123" points="1329,-367 1487,-367 "/>
<text text-anchor="start" x="1337" y="-351.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用replica read start_ts</text>
<text text-anchor="start" x="1337" y="-336.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新max_ts</text>
</g>
<!-- ReplicaReadLockChecker__on_step&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge7" class="edge">
<title>ReplicaReadLockChecker__on_step&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1487.28,-380.56C1516.88,-385.69 1550.64,-391.54 1580.6,-396.73"/>
<polygon fill="#666666" stroke="#666666" points="1580.15,-400.2 1590.6,-398.46 1581.35,-393.3 1580.15,-400.2"/>
</g>
<!-- BackupRange__backup -->
<g id="node8" class="node">
<title>BackupRange__backup</title>
<path fill="none" stroke="#1c2123" d="M1468.5,-310C1468.5,-310 1347.5,-310 1347.5,-310 1341.5,-310 1335.5,-304 1335.5,-298 1335.5,-298 1335.5,-286 1335.5,-286 1335.5,-280 1341.5,-274 1347.5,-274 1347.5,-274 1468.5,-274 1468.5,-274 1474.5,-274 1480.5,-280 1480.5,-286 1480.5,-286 1480.5,-298 1480.5,-298 1480.5,-304 1474.5,-310 1468.5,-310"/>
<text text-anchor="middle" x="1408" y="-288.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">BackupRange__backup</text>
</g>
<!-- BackupRange__backup&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge8" class="edge">
<title>BackupRange__backup&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1480.73,-298.33C1505.15,-302.39 1532.05,-309.06 1555,-320 1576.78,-330.38 1597.78,-346.24 1615.38,-361.81"/>
<polygon fill="#666666" stroke="#666666" points="1613.46,-364.8 1623.21,-368.93 1618.17,-359.62 1613.46,-364.8"/>
</g>
<!-- Endpoint__register_min_ts_event -->
<g id="node9" class="node">
<title>Endpoint__register_min_ts_event</title>
<path fill="none" stroke="#1c2123" d="M1496,-256C1496,-256 1320,-256 1320,-256 1314,-256 1308,-250 1308,-244 1308,-244 1308,-232 1308,-232 1308,-226 1314,-220 1320,-220 1320,-220 1496,-220 1496,-220 1502,-220 1508,-226 1508,-232 1508,-232 1508,-244 1508,-244 1508,-250 1502,-256 1496,-256"/>
<text text-anchor="middle" x="1408" y="-234.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint__register_min_ts_event</text>
</g>
<!-- Endpoint__register_min_ts_event&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge9" class="edge">
<title>Endpoint__register_min_ts_event&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1508.19,-245.93C1524.64,-250.11 1540.9,-256.19 1555,-265 1591.42,-287.75 1619.65,-327.62 1638.11,-359.95"/>
<polygon fill="#666666" stroke="#666666" points="1635.13,-361.81 1643.05,-368.85 1641.25,-358.41 1635.13,-361.81"/>
</g>
<!-- AppliedLockCollector__start_collecting -->
<g id="node10" class="node">
<title>AppliedLockCollector__start_collecting</title>
<path fill="none" stroke="#1c2123" d="M1513.5,-202C1513.5,-202 1302.5,-202 1302.5,-202 1296.5,-202 1290.5,-196 1290.5,-190 1290.5,-190 1290.5,-178 1290.5,-178 1290.5,-172 1296.5,-166 1302.5,-166 1302.5,-166 1513.5,-166 1513.5,-166 1519.5,-166 1525.5,-172 1525.5,-178 1525.5,-178 1525.5,-190 1525.5,-190 1525.5,-196 1519.5,-202 1513.5,-202"/>
<text text-anchor="middle" x="1408" y="-180.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">AppliedLockCollector__start_collecting</text>
</g>
<!-- AppliedLockCollector__start_collecting&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge10" class="edge">
<title>AppliedLockCollector__start_collecting&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1525.78,-195.56C1536.2,-199.5 1546.14,-204.55 1555,-211 1604.59,-247.1 1633.78,-313.1 1649.05,-359.38"/>
<polygon fill="#666666" stroke="#666666" points="1645.73,-360.47 1652.11,-368.94 1652.4,-358.35 1645.73,-360.47"/>
</g>
<!-- Runner__handle_update_max_timestamp -->
<g id="node11" class="node">
<title>Runner__handle_update_max_timestamp</title>
<path fill="none" stroke="#1c2123" d="M1317,-424.5C1317,-424.5 1499,-424.5 1499,-424.5 1505,-424.5 1511,-430.5 1511,-436.5 1511,-436.5 1511,-473.5 1511,-473.5 1511,-479.5 1505,-485.5 1499,-485.5 1499,-485.5 1317,-485.5 1317,-485.5 1311,-485.5 1305,-479.5 1305,-473.5 1305,-473.5 1305,-436.5 1305,-436.5 1305,-430.5 1311,-424.5 1317,-424.5"/>
<text text-anchor="start" x="1313" y="-470.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Runner</text>
<text text-anchor="start" x="1313" y="-455.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_update_max_timestamp</text>
<polyline fill="none" stroke="#1c2123" points="1305,-447.5 1511,-447.5 "/>
<text text-anchor="start" x="1313" y="-432.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理Task::UpdateMaxTimestamp</text>
</g>
<!-- Runner__handle_update_max_timestamp&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge11" class="edge">
<title>Runner__handle_update_max_timestamp&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1511.21,-437.29C1534.29,-433.3 1558.49,-429.1 1580.63,-425.27"/>
<polygon fill="#666666" stroke="#666666" points="1581.38,-428.69 1590.64,-423.53 1580.19,-421.79 1581.38,-428.69"/>
</g>
<!-- Endpoint__check_memory_locks -->
<g id="node12" class="node">
<title>Endpoint__check_memory_locks</title>
<path fill="none" stroke="#1c2123" d="M1350,-109C1350,-109 1466,-109 1466,-109 1472,-109 1478,-115 1478,-121 1478,-121 1478,-135 1478,-135 1478,-141 1472,-147 1466,-147 1466,-147 1350,-147 1350,-147 1344,-147 1338,-141 1338,-135 1338,-135 1338,-121 1338,-121 1338,-115 1344,-109 1350,-109"/>
<text text-anchor="start" x="1346" y="-131.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint</text>
<text text-anchor="start" x="1346" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> check_memory_locks</text>
</g>
<!-- Endpoint__check_memory_locks&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge12" class="edge">
<title>Endpoint__check_memory_locks&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1478.37,-128.36C1504.79,-131.71 1533.64,-139.64 1555,-157 1617.09,-207.46 1644.13,-300.15 1655.43,-358.52"/>
<polygon fill="#666666" stroke="#666666" points="1652.04,-359.45 1657.3,-368.65 1658.92,-358.18 1652.04,-359.45"/>
</g>
<!-- AdvanceTsWorker_advance_ts_for_regions -->
<g id="node13" class="node">
<title>AdvanceTsWorker_advance_ts_for_regions</title>
<path fill="none" stroke="#1c2123" d="M1523.5,-90C1523.5,-90 1292.5,-90 1292.5,-90 1286.5,-90 1280.5,-84 1280.5,-78 1280.5,-78 1280.5,-66 1280.5,-66 1280.5,-60 1286.5,-54 1292.5,-54 1292.5,-54 1523.5,-54 1523.5,-54 1529.5,-54 1535.5,-60 1535.5,-66 1535.5,-66 1535.5,-78 1535.5,-78 1535.5,-84 1529.5,-90 1523.5,-90"/>
<text text-anchor="middle" x="1408" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">AdvanceTsWorker_advance_ts_for_regions</text>
</g>
<!-- AdvanceTsWorker_advance_ts_for_regions&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge13" class="edge">
<title>AdvanceTsWorker_advance_ts_for_regions&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1535.75,-86.19C1542.64,-89.73 1549.14,-93.96 1555,-99 1631.68,-164.94 1653.97,-288.2 1660.41,-358.44"/>
<polygon fill="#666666" stroke="#666666" points="1656.96,-359.15 1661.28,-368.82 1663.93,-358.56 1656.96,-359.15"/>
</g>
<!-- cdc__endpoint__EndPoint__register_min_ts_event -->
<g id="node14" class="node">
<title>cdc__endpoint__EndPoint__register_min_ts_event</title>
<path fill="none" stroke="#1c2123" d="M1543,-36C1543,-36 1273,-36 1273,-36 1267,-36 1261,-30 1261,-24 1261,-24 1261,-12 1261,-12 1261,-6 1267,0 1273,0 1273,0 1543,0 1543,0 1549,0 1555,-6 1555,-12 1555,-12 1555,-24 1555,-24 1555,-30 1549,-36 1543,-36"/>
<text text-anchor="middle" x="1408" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cdc__endpoint__EndPoint__register_min_ts_event</text>
</g>
<!-- cdc__endpoint__EndPoint__register_min_ts_event&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge14" class="edge">
<title>cdc__endpoint__EndPoint__register_min_ts_event&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M1543.35,-36.15C1547.46,-38.78 1551.36,-41.72 1555,-45 1645.09,-126.17 1661.56,-278.36 1663.64,-358.53"/>
<polygon fill="#666666" stroke="#666666" points="1660.14,-358.95 1663.83,-368.88 1667.14,-358.81 1660.14,-358.95"/>
</g>
<!-- Command__process_write -->
<g id="node16" class="node">
<title>Command__process_write</title>
<path fill="none" stroke="#1c2123" d="M1059.5,-641C1059.5,-641 1142.5,-641 1142.5,-641 1148.5,-641 1154.5,-647 1154.5,-653 1154.5,-653 1154.5,-765 1154.5,-765 1154.5,-771 1148.5,-777 1142.5,-777 1142.5,-777 1059.5,-777 1059.5,-777 1053.5,-777 1047.5,-771 1047.5,-765 1047.5,-765 1047.5,-653 1047.5,-653 1047.5,-647 1053.5,-641 1059.5,-641"/>
<text text-anchor="start" x="1055.5" y="-761.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Command</text>
<text text-anchor="start" x="1055.5" y="-746.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="1047.5,-739 1154.5,-739 "/>
<text text-anchor="start" x="1055.5" y="-723.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">执行write命令</text>
<text text-anchor="start" x="1055.5" y="-708.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 使用请求中的</text>
<text text-anchor="start" x="1055.5" y="-693.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> start_ts</text>
<text text-anchor="start" x="1055.5" y="-678.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> for_update_ts</text>
<text text-anchor="start" x="1055.5" y="-663.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> min_commit_ts</text>
<text text-anchor="start" x="1055.5" y="-648.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新max_ts</text>
</g>
<!-- Command__process_write&#45;&gt;CheckTxnStatus__process_write -->
<g id="edge15" class="edge">
<title>Command__process_write&#45;&gt;CheckTxnStatus__process_write</title>
<path fill="none" stroke="#666666" d="M1154.78,-694.12C1201.65,-680.9 1270.89,-661.38 1324.98,-646.13"/>
<polygon fill="#666666" stroke="#666666" points="1326.22,-649.41 1334.89,-643.33 1324.32,-642.68 1326.22,-649.41"/>
</g>
<!-- Command__process_write&#45;&gt;AcquirePessimisticLock__process_write -->
<g id="edge16" class="edge">
<title>Command__process_write&#45;&gt;AcquirePessimisticLock__process_write</title>
<path fill="none" stroke="#666666" d="M1154.81,-654.99C1183.92,-627.9 1222,-596.56 1261,-576 1280.3,-565.82 1302.41,-557.94 1323.48,-551.93"/>
<polygon fill="#666666" stroke="#666666" points="1324.68,-555.23 1333.4,-549.21 1322.83,-548.48 1324.68,-555.23"/>
</g>
<!-- Command__process_write&#45;&gt;CheckSecondaryLocks__process_write -->
<g id="edge17" class="edge">
<title>Command__process_write&#45;&gt;CheckSecondaryLocks__process_write</title>
<path fill="none" stroke="#666666" d="M1154.78,-724.57C1199.96,-737.91 1265.94,-757.38 1319.09,-773.06"/>
<polygon fill="#666666" stroke="#666666" points="1318.27,-776.47 1328.85,-775.94 1320.25,-769.75 1318.27,-776.47"/>
</g>
<!-- Command__process_write&#45;&gt;Cleanup__process_write -->
<g id="edge18" class="edge">
<title>Command__process_write&#45;&gt;Cleanup__process_write</title>
<path fill="none" stroke="#666666" d="M1154.78,-709.35C1209.35,-709.7 1294.26,-710.26 1350.25,-710.63"/>
<polygon fill="#666666" stroke="#666666" points="1350.34,-714.13 1360.36,-710.69 1350.38,-707.13 1350.34,-714.13"/>
</g>
<!-- Scheduler__process_write -->
<g id="node17" class="node">
<title>Scheduler__process_write</title>
<path fill="none" stroke="#1c2123" d="M787.5,-690C787.5,-690 858.5,-690 858.5,-690 864.5,-690 870.5,-696 870.5,-702 870.5,-702 870.5,-716 870.5,-716 870.5,-722 864.5,-728 858.5,-728 858.5,-728 787.5,-728 787.5,-728 781.5,-728 775.5,-722 775.5,-716 775.5,-716 775.5,-702 775.5,-702 775.5,-696 781.5,-690 787.5,-690"/>
<text text-anchor="start" x="783.5" y="-712.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Scheduler</text>
<text text-anchor="start" x="783.5" y="-697.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
</g>
<!-- Scheduler__process_write&#45;&gt;Command__process_write -->
<g id="edge19" class="edge">
<title>Scheduler__process_write&#45;&gt;Command__process_write</title>
<path fill="none" stroke="#666666" d="M870.51,-709C916.21,-709 986.29,-709 1036.98,-709"/>
<polygon fill="#666666" stroke="#666666" points="1037.17,-712.5 1047.17,-709 1037.17,-705.5 1037.17,-712.5"/>
</g>
<!-- CoprocessorHost__on_step_read_index -->
<g id="node18" class="node">
<title>CoprocessorHost__on_step_read_index</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M770.5,-280C770.5,-280 875.5,-280 875.5,-280 881.5,-280 887.5,-286 887.5,-292 887.5,-292 887.5,-344 887.5,-344 887.5,-350 881.5,-356 875.5,-356 875.5,-356 770.5,-356 770.5,-356 764.5,-356 758.5,-350 758.5,-344 758.5,-344 758.5,-292 758.5,-292 758.5,-286 764.5,-280 770.5,-280"/>
<text text-anchor="start" x="766.5" y="-340.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">CoprocessorHost</text>
<text text-anchor="start" x="766.5" y="-325.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> on_step_read_index</text>
<polyline fill="none" stroke="#8a8898" points="758.5,-318 887.5,-318 "/>
<text text-anchor="start" x="766.5" y="-302.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">处理follower发来</text>
<text text-anchor="start" x="766.5" y="-287.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的read_index 消息</text>
</g>
<!-- ReadIndexObserver__on_step -->
<g id="node19" class="node">
<title>ReadIndexObserver__on_step</title>
<path fill="none" stroke="#1c2123" d="M1038,-312.5C1038,-312.5 1164,-312.5 1164,-312.5 1170,-312.5 1176,-318.5 1176,-324.5 1176,-324.5 1176,-361.5 1176,-361.5 1176,-367.5 1170,-373.5 1164,-373.5 1164,-373.5 1038,-373.5 1038,-373.5 1032,-373.5 1026,-367.5 1026,-361.5 1026,-361.5 1026,-324.5 1026,-324.5 1026,-318.5 1032,-312.5 1038,-312.5"/>
<text text-anchor="start" x="1034" y="-358.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReadIndexObserver</text>
<text text-anchor="start" x="1034" y="-343.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_step</text>
<polyline fill="none" stroke="#1c2123" points="1026,-335.5 1176,-335.5 "/>
<text text-anchor="start" x="1034" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">trait ReadIndexObserver</text>
</g>
<!-- CoprocessorHost__on_step_read_index&#45;&gt;ReadIndexObserver__on_step -->
<g id="edge20" class="edge">
<title>CoprocessorHost__on_step_read_index&#45;&gt;ReadIndexObserver__on_step</title>
<path fill="none" stroke="#666666" d="M887.67,-323.77C925.76,-327.22 974.62,-331.64 1015.87,-335.38"/>
<polygon fill="#666666" stroke="#666666" points="1015.63,-338.87 1025.9,-336.29 1016.26,-331.9 1015.63,-338.87"/>
</g>
<!-- ReadIndexObserver__on_step&#45;&gt;ReplicaReadLockChecker__on_step -->
<g id="edge21" class="edge">
<title>ReadIndexObserver__on_step&#45;&gt;ReplicaReadLockChecker__on_step</title>
<path fill="none" stroke="#666666" d="M1176.22,-348.84C1219.25,-352.23 1273.69,-356.51 1318.89,-360.07"/>
<polygon fill="#666666" stroke="#666666" points="1318.74,-363.57 1328.98,-360.86 1319.28,-356.59 1318.74,-363.57"/>
</g>
<!-- Peer__step -->
<g id="node20" class="node">
<title>Peer__step</title>
<path fill="none" stroke="#1c2123" d="M544,-318.5C544,-318.5 612,-318.5 612,-318.5 618,-318.5 624,-324.5 624,-330.5 624,-330.5 624,-367.5 624,-367.5 624,-373.5 618,-379.5 612,-379.5 612,-379.5 544,-379.5 544,-379.5 538,-379.5 532,-373.5 532,-367.5 532,-367.5 532,-330.5 532,-330.5 532,-324.5 538,-318.5 544,-318.5"/>
<text text-anchor="start" x="540" y="-364.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="540" y="-349.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> step</text>
<polyline fill="none" stroke="#1c2123" points="532,-341.5 624,-341.5 "/>
<text text-anchor="middle" x="578" y="-326.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理raft消息</text>
</g>
<!-- Peer__step&#45;&gt;CoprocessorHost__on_step_read_index -->
<g id="edge22" class="edge">
<title>Peer__step&#45;&gt;CoprocessorHost__on_step_read_index</title>
<path fill="none" stroke="#666666" d="M624.14,-343.24C658.93,-338.8 707.78,-332.57 748.23,-327.41"/>
<polygon fill="#666666" stroke="#666666" points="748.85,-330.86 758.32,-326.12 747.96,-323.92 748.85,-330.86"/>
</g>
<!-- future_scan_lock -->
<g id="node21" class="node">
<title>future_scan_lock</title>
<path fill="none" stroke="#1c2123" d="M621,-884C621,-884 535,-884 535,-884 529,-884 523,-878 523,-872 523,-872 523,-860 523,-860 523,-854 529,-848 535,-848 535,-848 621,-848 621,-848 627,-848 633,-854 633,-860 633,-860 633,-872 633,-872 633,-878 627,-884 621,-884"/>
<text text-anchor="middle" x="578" y="-862.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">future_scan_lock</text>
</g>
<!-- future_scan_lock&#45;&gt;Storage__scan_lock -->
<g id="edge23" class="edge">
<title>future_scan_lock&#45;&gt;Storage__scan_lock</title>
<path fill="none" stroke="#666666" d="M633.23,-866C667.63,-866 712.52,-866 749.9,-866"/>
<polygon fill="#666666" stroke="#666666" points="750.23,-869.5 760.23,-866 750.23,-862.5 750.23,-869.5"/>
</g>
<!-- Service__handle_request -->
<g id="node22" class="node">
<title>Service__handle_request</title>
<path fill="#bcffb9" stroke="#8a8898" d="M330,-839.5C330,-839.5 408,-839.5 408,-839.5 414,-839.5 420,-845.5 420,-851.5 420,-851.5 420,-880.5 420,-880.5 420,-886.5 414,-892.5 408,-892.5 408,-892.5 330,-892.5 330,-892.5 324,-892.5 318,-886.5 318,-880.5 318,-880.5 318,-851.5 318,-851.5 318,-845.5 324,-839.5 330,-839.5"/>
<text text-anchor="start" x="326" y="-877.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Service</text>
<text text-anchor="start" x="326" y="-862.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> handle_request</text>
<text text-anchor="start" x="326" y="-847.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> GRPC 接口</text>
</g>
<!-- Service__handle_request&#45;&gt;future_scan_lock -->
<g id="edge24" class="edge">
<title>Service__handle_request&#45;&gt;future_scan_lock</title>
<path fill="none" stroke="#666666" d="M420.11,-866C447.83,-866 482.59,-866 512.34,-866"/>
<polygon fill="#666666" stroke="#666666" points="512.63,-869.5 522.63,-866 512.63,-862.5 512.63,-869.5"/>
</g>
<!-- Endpoint__parse_request_and_check_memory_locks -->
<g id="node23" class="node">
<title>Endpoint__parse_request_and_check_memory_locks</title>
<path fill="none" stroke="#1c2123" d="M989,-109C989,-109 1213,-109 1213,-109 1219,-109 1225,-115 1225,-121 1225,-121 1225,-135 1225,-135 1225,-141 1219,-147 1213,-147 1213,-147 989,-147 989,-147 983,-147 977,-141 977,-135 977,-135 977,-121 977,-121 977,-115 983,-109 989,-109"/>
<text text-anchor="start" x="985" y="-131.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint</text>
<text text-anchor="start" x="985" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> parse_request_and_check_memory_locks</text>
</g>
<!-- Endpoint__parse_request_and_check_memory_locks&#45;&gt;Endpoint__check_memory_locks -->
<g id="edge25" class="edge">
<title>Endpoint__parse_request_and_check_memory_locks&#45;&gt;Endpoint__check_memory_locks</title>
<path fill="none" stroke="#666666" d="M1225.18,-128C1259.64,-128 1296.17,-128 1327.39,-128"/>
<polygon fill="#666666" stroke="#666666" points="1327.76,-131.5 1337.76,-128 1327.75,-124.5 1327.76,-131.5"/>
</g>
<!-- pd__Runner__run -->
<g id="node24" class="node">
<title>pd__Runner__run</title>
<path fill="none" stroke="#1c2123" d="M1146.5,-529C1146.5,-529 1055.5,-529 1055.5,-529 1049.5,-529 1043.5,-523 1043.5,-517 1043.5,-517 1043.5,-505 1043.5,-505 1043.5,-499 1049.5,-493 1055.5,-493 1055.5,-493 1146.5,-493 1146.5,-493 1152.5,-493 1158.5,-499 1158.5,-505 1158.5,-505 1158.5,-517 1158.5,-517 1158.5,-523 1152.5,-529 1146.5,-529"/>
<text text-anchor="middle" x="1101" y="-507.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pd__Runner__run</text>
</g>
<!-- pd__Runner__run&#45;&gt;Runner__handle_update_max_timestamp -->
<g id="edge26" class="edge">
<title>pd__Runner__run&#45;&gt;Runner__handle_update_max_timestamp</title>
<path fill="none" stroke="#666666" d="M1158.65,-500.6C1196.85,-493.58 1248.54,-484.09 1294.87,-475.59"/>
<polygon fill="#666666" stroke="#666666" points="1295.78,-478.98 1304.98,-473.73 1294.51,-472.1 1295.78,-478.98"/>
</g>
<!-- PeerFsmDelegate__on_ready_commit_merge -->
<g id="node25" class="node">
<title>PeerFsmDelegate__on_ready_commit_merge</title>
<path fill="none" stroke="#1c2123" d="M732,-375.5C732,-375.5 914,-375.5 914,-375.5 920,-375.5 926,-381.5 926,-387.5 926,-387.5 926,-522.5 926,-522.5 926,-528.5 920,-534.5 914,-534.5 914,-534.5 732,-534.5 732,-534.5 726,-534.5 720,-528.5 720,-522.5 720,-522.5 720,-387.5 720,-387.5 720,-381.5 726,-375.5 732,-375.5"/>
<text text-anchor="start" x="728" y="-519.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="728" y="-504.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_ready_commit_merge</text>
<polyline fill="none" stroke="#1c2123" points="720,-496.5 926,-496.5 "/>
<text text-anchor="start" x="728" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理ExecResult::CommitMerge</text>
<text text-anchor="start" x="728" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 消息</text>
<polyline fill="none" stroke="#1c2123" points="720,-458.5 926,-458.5 "/>
<text text-anchor="start" x="728" y="-443.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">If a follower merges into a leader,</text>
<text text-anchor="start" x="728" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> a more recent read may happen</text>
<text text-anchor="start" x="728" y="-413.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on the leader of the follower.</text>
<text text-anchor="start" x="728" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> So max ts should be updated after</text>
<text text-anchor="start" x="728" y="-383.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> a region merge.</text>
</g>
<!-- Peer__require_updating_max_ts -->
<g id="node27" class="node">
<title>Peer__require_updating_max_ts</title>
<path fill="none" stroke="#1c2123" d="M1033.5,-436C1033.5,-436 1168.5,-436 1168.5,-436 1174.5,-436 1180.5,-442 1180.5,-448 1180.5,-448 1180.5,-462 1180.5,-462 1180.5,-468 1174.5,-474 1168.5,-474 1168.5,-474 1033.5,-474 1033.5,-474 1027.5,-474 1021.5,-468 1021.5,-462 1021.5,-462 1021.5,-448 1021.5,-448 1021.5,-442 1027.5,-436 1033.5,-436"/>
<text text-anchor="start" x="1029.5" y="-458.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="1029.5" y="-443.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> require_updating_max_ts</text>
</g>
<!-- PeerFsmDelegate__on_ready_commit_merge&#45;&gt;Peer__require_updating_max_ts -->
<g id="edge27" class="edge">
<title>PeerFsmDelegate__on_ready_commit_merge&#45;&gt;Peer__require_updating_max_ts</title>
<path fill="none" stroke="#666666" d="M926.38,-455C954.13,-455 983.94,-455 1010.9,-455"/>
<polygon fill="#666666" stroke="#666666" points="1011.08,-458.5 1021.08,-455 1011.08,-451.5 1011.08,-458.5"/>
</g>
<!-- Peer__on_role_changed -->
<g id="node26" class="node">
<title>Peer__on_role_changed</title>
<path fill="none" stroke="#1c2123" d="M717,-554C717,-554 929,-554 929,-554 935,-554 941,-560 941,-566 941,-566 941,-656 941,-656 941,-662 935,-668 929,-668 929,-668 717,-668 717,-668 711,-668 705,-662 705,-656 705,-656 705,-566 705,-566 705,-560 711,-554 717,-554"/>
<text text-anchor="start" x="713" y="-652.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="713" y="-637.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_role_changed</text>
<polyline fill="none" stroke="#1c2123" points="705,-630 941,-630 "/>
<text text-anchor="start" x="713" y="-614.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">变为了leader</text>
<polyline fill="none" stroke="#1c2123" points="705,-607 941,-607 "/>
<text text-anchor="start" x="713" y="-591.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">A more recent read may happen</text>
<text text-anchor="start" x="713" y="-576.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on the old leader. So max ts should</text>
<text text-anchor="start" x="713" y="-561.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> be updated after a peer becomes leader.</text>
</g>
<!-- Peer__on_role_changed&#45;&gt;Peer__require_updating_max_ts -->
<g id="edge28" class="edge">
<title>Peer__on_role_changed&#45;&gt;Peer__require_updating_max_ts</title>
<path fill="none" stroke="#666666" d="M929.89,-553.98C933.77,-550.77 937.49,-547.44 941,-544 963.21,-522.24 951.89,-502.35 977,-484 987.27,-476.49 999.21,-470.9 1011.52,-466.74"/>
<polygon fill="#666666" stroke="#666666" points="1012.91,-469.97 1021.45,-463.7 1010.86,-463.28 1012.91,-469.97"/>
</g>
<!-- Peer__require_updating_max_ts&#45;&gt;Runner__handle_update_max_timestamp -->
<g id="edge38" class="edge">
<title>Peer__require_updating_max_ts&#45;&gt;Runner__handle_update_max_timestamp</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1180.55,-455C1215.3,-455 1256.81,-455 1294.75,-455"/>
<polygon fill="green" stroke="green" points="1294.83,-458.5 1304.83,-455 1294.83,-451.5 1294.83,-458.5"/>
</g>
<!-- Peer__handle_raft_ready_append -->
<g id="node28" class="node">
<title>Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#1c2123" d="M299,-537C299,-537 439,-537 439,-537 445,-537 451,-543 451,-549 451,-549 451,-563 451,-563 451,-569 445,-575 439,-575 439,-575 299,-575 299,-575 293,-575 287,-569 287,-563 287,-563 287,-549 287,-549 287,-543 293,-537 299,-537"/>
<text text-anchor="start" x="295" y="-559.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Peer</text>
<text text-anchor="start" x="295" y="-544.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_raft_ready_append</text>
</g>
<!-- Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed -->
<g id="edge29" class="edge">
<title>Peer__handle_raft_ready_append&#45;&gt;Peer__on_role_changed</title>
<path fill="none" stroke="#666666" d="M451.07,-565.86C518.66,-574.09 616.17,-585.95 694.24,-595.45"/>
<polygon fill="#666666" stroke="#666666" points="694.29,-598.99 704.64,-596.72 695.14,-592.04 694.29,-598.99"/>
</g>
<!-- PeerFsmDelegate__on_apply_res -->
<g id="node29" class="node">
<title>PeerFsmDelegate__on_apply_res</title>
<path fill="none" stroke="#1c2123" d="M324,-417C324,-417 414,-417 414,-417 420,-417 426,-423 426,-429 426,-429 426,-481 426,-481 426,-487 420,-493 414,-493 414,-493 324,-493 324,-493 318,-493 312,-487 312,-481 312,-481 312,-429 312,-429 312,-423 318,-417 324,-417"/>
<text text-anchor="start" x="320" y="-477.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="320" y="-462.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_apply_res</text>
<polyline fill="none" stroke="#1c2123" points="312,-455 426,-455 "/>
<text text-anchor="start" x="320" y="-439.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply fsm保存完</text>
<text text-anchor="start" x="320" y="-424.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 毕后的回调</text>
</g>
<!-- PeerFsmDelegate__on_ready_result -->
<g id="node30" class="node">
<title>PeerFsmDelegate__on_ready_result</title>
<path fill="none" stroke="#1c2123" d="M499,-428.5C499,-428.5 657,-428.5 657,-428.5 663,-428.5 669,-434.5 669,-440.5 669,-440.5 669,-469.5 669,-469.5 669,-475.5 663,-481.5 657,-481.5 657,-481.5 499,-481.5 499,-481.5 493,-481.5 487,-475.5 487,-469.5 487,-469.5 487,-440.5 487,-440.5 487,-434.5 493,-428.5 499,-428.5"/>
<text text-anchor="start" x="495" y="-466.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="495" y="-451.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_ready_result</text>
<text text-anchor="start" x="495" y="-436.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 处理apply fsm的ready result</text>
</g>
<!-- PeerFsmDelegate__on_apply_res&#45;&gt;PeerFsmDelegate__on_ready_result -->
<g id="edge30" class="edge">
<title>PeerFsmDelegate__on_apply_res&#45;&gt;PeerFsmDelegate__on_ready_result</title>
<path fill="none" stroke="#666666" d="M426.02,-455C441.63,-455 459.09,-455 476.43,-455"/>
<polygon fill="#666666" stroke="#666666" points="476.62,-458.5 486.62,-455 476.62,-451.5 476.62,-458.5"/>
</g>
<!-- PeerFsmDelegate__on_ready_result&#45;&gt;PeerFsmDelegate__on_ready_commit_merge -->
<g id="edge31" class="edge">
<title>PeerFsmDelegate__on_ready_result&#45;&gt;PeerFsmDelegate__on_ready_commit_merge</title>
<path fill="none" stroke="#666666" d="M669.14,-455C682.27,-455 695.93,-455 709.43,-455"/>
<polygon fill="#666666" stroke="#666666" points="709.72,-458.5 719.72,-455 709.72,-451.5 709.72,-458.5"/>
</g>
<!-- PeerFsmDelegate__handle_msgs -->
<g id="node31" class="node">
<title>PeerFsmDelegate__handle_msgs</title>
<path fill="none" stroke="#1c2123" d="M150,-436C150,-436 239,-436 239,-436 245,-436 251,-442 251,-448 251,-448 251,-462 251,-462 251,-468 245,-474 239,-474 239,-474 150,-474 150,-474 144,-474 138,-468 138,-462 138,-462 138,-448 138,-448 138,-442 144,-436 150,-436"/>
<text text-anchor="start" x="146" y="-458.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="146" y="-443.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_msgs</text>
</g>
<!-- PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_apply_res -->
<g id="edge32" class="edge">
<title>PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_apply_res</title>
<path fill="none" stroke="#666666" d="M251.03,-455C267.18,-455 284.98,-455 301.72,-455"/>
<polygon fill="#666666" stroke="#666666" points="301.98,-458.5 311.98,-455 301.98,-451.5 301.98,-458.5"/>
</g>
<!-- PeerFsmDelegate__on_raft_message -->
<g id="node32" class="node">
<title>PeerFsmDelegate__on_raft_message</title>
<path fill="none" stroke="#1c2123" d="M324.5,-360C324.5,-360 413.5,-360 413.5,-360 419.5,-360 425.5,-366 425.5,-372 425.5,-372 425.5,-386 425.5,-386 425.5,-392 419.5,-398 413.5,-398 413.5,-398 324.5,-398 324.5,-398 318.5,-398 312.5,-392 312.5,-386 312.5,-386 312.5,-372 312.5,-372 312.5,-366 318.5,-360 324.5,-360"/>
<text text-anchor="start" x="320.5" y="-382.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="320.5" y="-367.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> on_raft_message</text>
</g>
<!-- PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_raft_message -->
<g id="edge33" class="edge">
<title>PeerFsmDelegate__handle_msgs&#45;&gt;PeerFsmDelegate__on_raft_message</title>
<path fill="none" stroke="#666666" d="M230.18,-435.83C247.07,-426.84 267.83,-416.31 287,-408 292.05,-405.81 297.33,-403.65 302.66,-401.55"/>
<polygon fill="#666666" stroke="#666666" points="304.2,-404.71 312.29,-397.86 301.7,-398.17 304.2,-404.71"/>
</g>
<!-- PeerFsmDelegate__on_raft_message&#45;&gt;Peer__step -->
<g id="edge34" class="edge">
<title>PeerFsmDelegate__on_raft_message&#45;&gt;Peer__step</title>
<path fill="none" stroke="#666666" d="M425.74,-370.92C455.52,-366.61 492.06,-361.31 521.76,-357.01"/>
<polygon fill="#666666" stroke="#666666" points="522.56,-360.43 531.96,-355.53 521.56,-353.5 522.56,-360.43"/>
</g>
<!-- PeerFsmDelegate__collect_ready -->
<g id="node33" class="node">
<title>PeerFsmDelegate__collect_ready</title>
<path fill="none" stroke="#1c2123" d="M150,-522C150,-522 239,-522 239,-522 245,-522 251,-528 251,-534 251,-534 251,-548 251,-548 251,-554 245,-560 239,-560 239,-560 150,-560 150,-560 144,-560 138,-554 138,-548 138,-548 138,-534 138,-534 138,-528 144,-522 150,-522"/>
<text text-anchor="start" x="146" y="-544.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PeerFsmDelegate</text>
<text text-anchor="start" x="146" y="-529.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> collect_ready</text>
</g>
<!-- PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append -->
<g id="edge35" class="edge">
<title>PeerFsmDelegate__collect_ready&#45;&gt;Peer__handle_raft_ready_append</title>
<path fill="none" stroke="#666666" d="M251.03,-545.83C259.24,-546.54 267.88,-547.29 276.59,-548.05"/>
<polygon fill="#666666" stroke="#666666" points="276.56,-551.56 286.82,-548.94 277.17,-544.59 276.56,-551.56"/>
</g>
<!-- PollHandler__handle_normal -->
<g id="node34" class="node">
<title>PollHandler__handle_normal</title>
<path fill="none" stroke="#1c2123" d="M12,-445C12,-445 90,-445 90,-445 96,-445 102,-451 102,-457 102,-457 102,-509 102,-509 102,-515 96,-521 90,-521 90,-521 12,-521 12,-521 6,-521 0,-515 0,-509 0,-509 0,-457 0,-457 0,-451 6,-445 12,-445"/>
<text text-anchor="start" x="8" y="-505.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PollHandler</text>
<text text-anchor="start" x="8" y="-490.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> handle_normal</text>
<polyline fill="none" stroke="#1c2123" points="0,-483 102,-483 "/>
<text text-anchor="start" x="8" y="-467.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">raft poller处理</text>
<text text-anchor="start" x="8" y="-452.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> normal消息</text>
</g>
<!-- PollHandler__handle_normal&#45;&gt;PeerFsmDelegate__handle_msgs -->
<g id="edge36" class="edge">
<title>PollHandler__handle_normal&#45;&gt;PeerFsmDelegate__handle_msgs</title>
<path fill="none" stroke="#666666" d="M102.29,-473.05C110.51,-471.42 119.13,-469.72 127.66,-468.03"/>
<polygon fill="#666666" stroke="#666666" points="128.47,-471.44 137.6,-466.06 127.11,-464.57 128.47,-471.44"/>
</g>
<!-- PollHandler__handle_normal&#45;&gt;PeerFsmDelegate__collect_ready -->
<g id="edge37" class="edge">
<title>PollHandler__handle_normal&#45;&gt;PeerFsmDelegate__collect_ready</title>
<path fill="none" stroke="#666666" d="M102.29,-503.61C113.58,-508.24 125.64,-513.18 137.16,-517.91"/>
<polygon fill="#666666" stroke="#666666" points="136.11,-521.26 146.69,-521.81 138.76,-514.78 136.11,-521.26"/>
</g>
<!-- Endpoint__parse_and_handle_unary_request -->
<g id="node35" class="node">
<title>Endpoint__parse_and_handle_unary_request</title>
<path fill="none" stroke="#1c2123" d="M734.5,-69C734.5,-69 911.5,-69 911.5,-69 917.5,-69 923.5,-75 923.5,-81 923.5,-81 923.5,-95 923.5,-95 923.5,-101 917.5,-107 911.5,-107 911.5,-107 734.5,-107 734.5,-107 728.5,-107 722.5,-101 722.5,-95 722.5,-95 722.5,-81 722.5,-81 722.5,-75 728.5,-69 734.5,-69"/>
<text text-anchor="start" x="730.5" y="-91.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint</text>
<text text-anchor="start" x="730.5" y="-76.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> parse_and_handle_unary_request</text>
</g>
<!-- Endpoint__parse_and_handle_unary_request&#45;&gt;Endpoint__parse_request_and_check_memory_locks -->
<g id="edge39" class="edge">
<title>Endpoint__parse_and_handle_unary_request&#45;&gt;Endpoint__parse_request_and_check_memory_locks</title>
<path fill="none" stroke="#666666" d="M923.64,-102.44C937.69,-104.48 952.32,-106.6 966.88,-108.71"/>
<polygon fill="#666666" stroke="#666666" points="966.53,-112.19 976.93,-110.16 967.54,-105.27 966.53,-112.19"/>
</g>
<!-- Endpoint__parse_and_handle_stream_request -->
<g id="node36" class="node">
<title>Endpoint__parse_and_handle_stream_request</title>
<path fill="none" stroke="#1c2123" d="M731.5,-129C731.5,-129 914.5,-129 914.5,-129 920.5,-129 926.5,-135 926.5,-141 926.5,-141 926.5,-155 926.5,-155 926.5,-161 920.5,-167 914.5,-167 914.5,-167 731.5,-167 731.5,-167 725.5,-167 719.5,-161 719.5,-155 719.5,-155 719.5,-141 719.5,-141 719.5,-135 725.5,-129 731.5,-129"/>
<text text-anchor="start" x="727.5" y="-151.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint</text>
<text text-anchor="start" x="727.5" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> parse_and_handle_stream_request</text>
</g>
<!-- Endpoint__parse_and_handle_stream_request&#45;&gt;Endpoint__parse_request_and_check_memory_locks -->
<g id="edge40" class="edge">
<title>Endpoint__parse_and_handle_stream_request&#45;&gt;Endpoint__parse_request_and_check_memory_locks</title>
<path fill="none" stroke="#666666" d="M926.77,-140.55C939.72,-139.61 953.11,-138.64 966.44,-137.68"/>
<polygon fill="#666666" stroke="#666666" points="966.9,-141.15 976.62,-136.94 966.39,-134.17 966.9,-141.15"/>
</g>
<!-- Service__coprocessor_stream -->
<g id="node37" class="node">
<title>Service__coprocessor_stream</title>
<path fill="#bcffb9" stroke="#8a8898" d="M317,-120.5C317,-120.5 421,-120.5 421,-120.5 427,-120.5 433,-126.5 433,-132.5 433,-132.5 433,-169.5 433,-169.5 433,-175.5 427,-181.5 421,-181.5 421,-181.5 317,-181.5 317,-181.5 311,-181.5 305,-175.5 305,-169.5 305,-169.5 305,-132.5 305,-132.5 305,-126.5 311,-120.5 317,-120.5"/>
<text text-anchor="start" x="313" y="-166.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Service</text>
<text text-anchor="start" x="313" y="-151.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> coprocessor_stream</text>
<polyline fill="none" stroke="#8a8898" points="305,-143.5 433,-143.5 "/>
<text text-anchor="start" x="313" y="-128.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">GRPC 接口</text>
</g>
<!-- Service__coprocessor_stream&#45;&gt;Endpoint__parse_and_handle_stream_request -->
<g id="edge41" class="edge">
<title>Service__coprocessor_stream&#45;&gt;Endpoint__parse_and_handle_stream_request</title>
<path fill="none" stroke="#666666" d="M433.32,-150.58C504.61,-150.11 621.82,-149.33 708.92,-148.75"/>
<polygon fill="#666666" stroke="#666666" points="709.14,-152.25 719.12,-148.68 709.09,-145.25 709.14,-152.25"/>
</g>
<!-- Service__coprocessor -->
<g id="node38" class="node">
<title>Service__coprocessor</title>
<path fill="#bcffb9" stroke="#8a8898" d="M338.5,-40.5C338.5,-40.5 399.5,-40.5 399.5,-40.5 405.5,-40.5 411.5,-46.5 411.5,-52.5 411.5,-52.5 411.5,-89.5 411.5,-89.5 411.5,-95.5 405.5,-101.5 399.5,-101.5 399.5,-101.5 338.5,-101.5 338.5,-101.5 332.5,-101.5 326.5,-95.5 326.5,-89.5 326.5,-89.5 326.5,-52.5 326.5,-52.5 326.5,-46.5 332.5,-40.5 338.5,-40.5"/>
<text text-anchor="start" x="334.5" y="-86.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">Service</text>
<text text-anchor="start" x="334.5" y="-71.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> coprocessor</text>
<polyline fill="none" stroke="#8a8898" points="326.5,-63.5 411.5,-63.5 "/>
<text text-anchor="start" x="334.5" y="-48.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">GRPC接口</text>
</g>
<!-- future_copr -->
<g id="node39" class="node">
<title>future_copr</title>
<path fill="none" stroke="#1c2123" d="M606,-95C606,-95 550,-95 550,-95 544,-95 538,-89 538,-83 538,-83 538,-71 538,-71 538,-65 544,-59 550,-59 550,-59 606,-59 606,-59 612,-59 618,-65 618,-71 618,-71 618,-83 618,-83 618,-89 612,-95 606,-95"/>
<text text-anchor="middle" x="578" y="-73.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">future_copr</text>
</g>
<!-- Service__coprocessor&#45;&gt;future_copr -->
<g id="edge42" class="edge">
<title>Service__coprocessor&#45;&gt;future_copr</title>
<path fill="none" stroke="#666666" d="M411.89,-72.21C445.44,-73.19 492.56,-74.55 527.88,-75.58"/>
<polygon fill="#666666" stroke="#666666" points="527.88,-79.08 537.97,-75.87 528.08,-72.08 527.88,-79.08"/>
</g>
<!-- future_copr&#45;&gt;Endpoint__parse_and_handle_unary_request -->
<g id="edge43" class="edge">
<title>future_copr&#45;&gt;Endpoint__parse_and_handle_unary_request</title>
<path fill="none" stroke="#666666" d="M618.04,-78.77C643.64,-79.93 678.47,-81.5 712.11,-83.03"/>
<polygon fill="#666666" stroke="#666666" points="712.35,-86.54 722.5,-83.5 712.67,-79.55 712.35,-86.54"/>
</g>
<!-- Endpoint__new -->
<g id="node40" class="node">
<title>Endpoint__new</title>
<path fill="none" stroke="#1c2123" d="M1140,-275C1140,-275 1062,-275 1062,-275 1056,-275 1050,-269 1050,-263 1050,-263 1050,-251 1050,-251 1050,-245 1056,-239 1062,-239 1062,-239 1140,-239 1140,-239 1146,-239 1152,-245 1152,-251 1152,-251 1152,-263 1152,-263 1152,-269 1146,-275 1140,-275"/>
<text text-anchor="middle" x="1101" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint__new</text>
</g>
<!-- Endpoint__new&#45;&gt;Endpoint__register_min_ts_event -->
<g id="edge44" class="edge">
<title>Endpoint__new&#45;&gt;Endpoint__register_min_ts_event</title>
<path fill="none" stroke="#666666" d="M1152.02,-253.88C1191.47,-251.43 1247.95,-247.91 1297.72,-244.81"/>
<polygon fill="#666666" stroke="#666666" points="1298.14,-248.29 1307.91,-244.17 1297.71,-241.3 1298.14,-248.29"/>
</g>
<!-- Endpoint__run -->
<g id="node41" class="node">
<title>Endpoint__run</title>
<path fill="none" stroke="#1c2123" d="M1138,-221C1138,-221 1064,-221 1064,-221 1058,-221 1052,-215 1052,-209 1052,-209 1052,-197 1052,-197 1052,-191 1058,-185 1064,-185 1064,-185 1138,-185 1138,-185 1144,-185 1150,-191 1150,-197 1150,-197 1150,-209 1150,-209 1150,-215 1144,-221 1138,-221"/>
<text text-anchor="middle" x="1101" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Endpoint__run</text>
</g>
<!-- Endpoint__run&#45;&gt;Endpoint__register_min_ts_event -->
<g id="edge45" class="edge">
<title>Endpoint__run&#45;&gt;Endpoint__register_min_ts_event</title>
<path fill="none" stroke="#666666" d="M1150.33,-208.55C1189.85,-213.08 1247.26,-219.67 1297.77,-225.47"/>
<polygon fill="#666666" stroke="#666666" points="1297.44,-228.95 1307.77,-226.61 1298.24,-222 1297.44,-228.95"/>
</g>
<!-- Scheduler__execute -->
<g id="node42" class="node">
<title>Scheduler__execute</title>
<path fill="none" stroke="#1c2123" d="M336,-678.5C336,-678.5 402,-678.5 402,-678.5 408,-678.5 414,-684.5 414,-690.5 414,-690.5 414,-727.5 414,-727.5 414,-733.5 408,-739.5 402,-739.5 402,-739.5 336,-739.5 336,-739.5 330,-739.5 324,-733.5 324,-727.5 324,-727.5 324,-690.5 324,-690.5 324,-684.5 330,-678.5 336,-678.5"/>
<text text-anchor="start" x="332" y="-724.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Scheduler</text>
<text text-anchor="start" x="332" y="-709.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> execute</text>
<polyline fill="none" stroke="#1c2123" points="324,-701.5 414,-701.5 "/>
<text text-anchor="start" x="332" y="-686.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">执行txn cmd</text>
</g>
<!-- Scheduler__process_by_worker -->
<g id="node43" class="node">
<title>Scheduler__process_by_worker</title>
<path fill="none" stroke="#1c2123" d="M512.5,-678.5C512.5,-678.5 643.5,-678.5 643.5,-678.5 649.5,-678.5 655.5,-684.5 655.5,-690.5 655.5,-690.5 655.5,-727.5 655.5,-727.5 655.5,-733.5 649.5,-739.5 643.5,-739.5 643.5,-739.5 512.5,-739.5 512.5,-739.5 506.5,-739.5 500.5,-733.5 500.5,-727.5 500.5,-727.5 500.5,-690.5 500.5,-690.5 500.5,-684.5 506.5,-678.5 512.5,-678.5"/>
<text text-anchor="start" x="508.5" y="-724.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Scheduler</text>
<text text-anchor="start" x="508.5" y="-709.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_by_worker</text>
<polyline fill="none" stroke="#1c2123" points="500.5,-701.5 655.5,-701.5 "/>
<text text-anchor="start" x="508.5" y="-686.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在worker线程池中执行</text>
</g>
<!-- Scheduler__execute&#45;&gt;Scheduler__process_by_worker -->
<g id="edge46" class="edge">
<title>Scheduler__execute&#45;&gt;Scheduler__process_by_worker</title>
<path fill="none" stroke="#666666" d="M414.15,-709C436.27,-709 463.85,-709 489.99,-709"/>
<polygon fill="#666666" stroke="#666666" points="490.31,-712.5 500.31,-709 490.31,-705.5 490.31,-712.5"/>
</g>
<!-- Scheduler__process_by_worker&#45;&gt;Scheduler__process_write -->
<g id="edge47" class="edge">
<title>Scheduler__process_by_worker&#45;&gt;Scheduler__process_write</title>
<path fill="none" stroke="#666666" d="M655.55,-709C690.95,-709 732.28,-709 764.9,-709"/>
<polygon fill="#666666" stroke="#666666" points="765.16,-712.5 775.16,-709 765.16,-705.5 765.16,-712.5"/>
</g>
</g>
</svg>
