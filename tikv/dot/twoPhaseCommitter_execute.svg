<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: execute Pages: 1 -->
<svg width="1501pt" height="252pt"
 viewBox="0.00 0.00 1501.00 252.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 248)">
<title>execute</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-248 1497,-248 1497,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_twoPhaseCommitter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M118,-8C118,-8 1473,-8 1473,-8 1479,-8 1485,-14 1485,-20 1485,-20 1485,-224 1485,-224 1485,-230 1479,-236 1473,-236 1473,-236 118,-236 118,-236 112,-236 106,-230 106,-224 106,-224 106,-20 106,-20 106,-14 112,-8 118,-8"/>
<text text-anchor="middle" x="795.5" y="-216" font-family="Times,serif" font-size="20.00">twoPhaseCommitter</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_KVTxn</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-39C20,-39 74,-39 74,-39 80,-39 86,-45 86,-51 86,-51 86,-109 86,-109 86,-115 80,-121 74,-121 74,-121 20,-121 20,-121 14,-121 8,-115 8,-109 8,-109 8,-51 8,-51 8,-45 14,-39 20,-39"/>
<text text-anchor="middle" x="47" y="-101" font-family="Times,serif" font-size="20.00">KVTxn</text>
</g>
<!-- execute -->
<g id="node1" class="node">
<title>execute</title>
<path fill="none" stroke="#1c2123" d="M160,-83C160,-83 126,-83 126,-83 120,-83 114,-77 114,-71 114,-71 114,-59 114,-59 114,-53 120,-47 126,-47 126,-47 160,-47 160,-47 166,-47 172,-53 172,-59 172,-59 172,-71 172,-71 172,-77 166,-83 160,-83"/>
<text text-anchor="middle" x="143" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">execute</text>
</g>
<!-- prewriteMutations -->
<g id="node2" class="node">
<title>prewriteMutations</title>
<path fill="none" stroke="#1c2123" d="M606,-22C606,-22 752,-22 752,-22 758,-22 764,-28 764,-34 764,-34 764,-56 764,-56 764,-62 758,-68 752,-68 752,-68 606,-68 606,-68 600,-68 594,-62 594,-56 594,-56 594,-34 594,-34 594,-28 600,-22 606,-22"/>
<text text-anchor="middle" x="679" y="-52.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewriteMutations</text>
<polyline fill="none" stroke="#1c2123" points="594,-45 764,-45 "/>
<text text-anchor="start" x="602" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">由batchExecutor 并发执行</text>
</g>
<!-- execute&#45;&gt;prewriteMutations -->
<g id="edge1" class="edge">
<title>execute&#45;&gt;prewriteMutations</title>
<path fill="none" stroke="#666666" d="M172.31,-61.4C183.42,-60.12 196.29,-58.8 208,-58 338.04,-49.1 488.72,-46.25 583.69,-45.36"/>
<polygon fill="#666666" stroke="#666666" points="583.88,-48.86 593.85,-45.27 583.82,-41.86 583.88,-48.86"/>
</g>
<!-- commitTxn -->
<g id="node3" class="node">
<title>commitTxn</title>
<path fill="none" stroke="#1c2123" d="M408,-73.5C408,-73.5 546,-73.5 546,-73.5 552,-73.5 558,-79.5 558,-85.5 558,-85.5 558,-160.5 558,-160.5 558,-166.5 552,-172.5 546,-172.5 546,-172.5 408,-172.5 408,-172.5 402,-172.5 396,-166.5 396,-160.5 396,-160.5 396,-85.5 396,-85.5 396,-79.5 402,-73.5 408,-73.5"/>
<text text-anchor="middle" x="477" y="-157.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitTxn</text>
<polyline fill="none" stroke="#1c2123" points="396,-149.5 558,-149.5 "/>
<text text-anchor="start" x="404" y="-134.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">等primary ke提交成功后</text>
<text text-anchor="start" x="404" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 才会返回, </text>
<polyline fill="none" stroke="#1c2123" points="396,-111.5 558,-111.5 "/>
<text text-anchor="start" x="404" y="-96.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">其他的secondaries keys</text>
<text text-anchor="start" x="404" y="-81.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 由go rutine异步提交</text>
</g>
<!-- execute&#45;&gt;commitTxn -->
<g id="edge2" class="edge">
<title>execute&#45;&gt;commitTxn</title>
<path fill="none" stroke="#666666" d="M172.02,-63.25C213.61,-61.33 293.86,-60.26 360,-75 368.58,-76.91 377.33,-79.41 385.99,-82.27"/>
<polygon fill="#666666" stroke="#666666" points="385.12,-85.67 395.72,-85.63 387.41,-79.06 385.12,-85.67"/>
</g>
<!-- getTimestampWithRetry -->
<g id="node4" class="node">
<title>getTimestampWithRetry</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M220,-84.5C220,-84.5 348,-84.5 348,-84.5 354,-84.5 360,-90.5 360,-96.5 360,-96.5 360,-171.5 360,-171.5 360,-177.5 354,-183.5 348,-183.5 348,-183.5 220,-183.5 220,-183.5 214,-183.5 208,-177.5 208,-171.5 208,-171.5 208,-96.5 208,-96.5 208,-90.5 214,-84.5 220,-84.5"/>
<text text-anchor="middle" x="284" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">getTimestampWithRetry</text>
<polyline fill="none" stroke="#8a8898" points="208,-160.5 360,-160.5 "/>
<text text-anchor="start" x="216" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">在提交事务之前</text>
<text text-anchor="start" x="216" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 先获取commit_ts</text>
<polyline fill="none" stroke="#8a8898" points="208,-122.5 360,-122.5 "/>
<text text-anchor="start" x="216" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">从time Oracle服务</text>
<text text-anchor="start" x="216" y="-92.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 获取commitTs</text>
</g>
<!-- execute&#45;&gt;getTimestampWithRetry -->
<g id="edge3" class="edge">
<title>execute&#45;&gt;getTimestampWithRetry</title>
<path fill="none" stroke="#666666" d="M172.13,-78.96C180.06,-82.9 189.13,-87.4 198.58,-92.1"/>
<polygon fill="#666666" stroke="#666666" points="197.23,-95.33 207.74,-96.64 200.34,-89.06 197.23,-95.33"/>
</g>
<!-- doActionOnGroupMutations -->
<g id="node6" class="node">
<title>doActionOnGroupMutations</title>
<path fill="none" stroke="#1c2123" d="M812,-55.5C812,-55.5 997,-55.5 997,-55.5 1003,-55.5 1009,-61.5 1009,-67.5 1009,-67.5 1009,-142.5 1009,-142.5 1009,-148.5 1003,-154.5 997,-154.5 997,-154.5 812,-154.5 812,-154.5 806,-154.5 800,-148.5 800,-142.5 800,-142.5 800,-67.5 800,-67.5 800,-61.5 806,-55.5 812,-55.5"/>
<text text-anchor="middle" x="904.5" y="-139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnGroupMutations</text>
<polyline fill="none" stroke="#1c2123" points="800,-131.5 1009,-131.5 "/>
<text text-anchor="start" x="808" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primaryBatch的size 为1</text>
<text text-anchor="start" x="808" y="-101.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并且是最先提交的</text>
<polyline fill="none" stroke="#1c2123" points="800,-93.5 1009,-93.5 "/>
<text text-anchor="start" x="808" y="-78.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primayBatch后面会同步直调用</text>
<text text-anchor="start" x="808" y="-63.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> actionCommit::handleSingleBatch</text>
</g>
<!-- prewriteMutations&#45;&gt;doActionOnGroupMutations -->
<g id="edge7" class="edge">
<title>prewriteMutations&#45;&gt;doActionOnGroupMutations</title>
<path fill="none" stroke="#666666" d="M764.18,-67.6C772.63,-69.87 781.3,-72.2 789.99,-74.53"/>
<polygon fill="#666666" stroke="#666666" points="789.23,-77.95 799.8,-77.16 791.05,-71.19 789.23,-77.95"/>
</g>
<!-- actionPrewrite_handleSingleBatch -->
<g id="node7" class="node">
<title>actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1284,-62C1284,-62 1465,-62 1465,-62 1471,-62 1477,-68 1477,-74 1477,-74 1477,-86 1477,-86 1477,-92 1471,-98 1465,-98 1465,-98 1284,-98 1284,-98 1278,-98 1272,-92 1272,-86 1272,-86 1272,-74 1272,-74 1272,-68 1278,-62 1284,-62"/>
<text text-anchor="middle" x="1374.5" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionPrewrite::handleSingleBatch</text>
</g>
<!-- prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge8" class="edge">
<title>prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M764.21,-31.11C873.87,-15.57 1071.03,3.69 1236,-27 1267.92,-32.94 1301.99,-46.02 1328.22,-57.69"/>
<polygon fill="green" stroke="green" points="1326.97,-60.97 1337.52,-61.92 1329.86,-54.59 1326.97,-60.97"/>
</g>
<!-- commitMutations -->
<g id="node5" class="node">
<title>commitMutations</title>
<path fill="none" stroke="#1c2123" d="M724.5,-141C724.5,-141 633.5,-141 633.5,-141 627.5,-141 621.5,-135 621.5,-129 621.5,-129 621.5,-117 621.5,-117 621.5,-111 627.5,-105 633.5,-105 633.5,-105 724.5,-105 724.5,-105 730.5,-105 736.5,-111 736.5,-117 736.5,-117 736.5,-129 736.5,-129 736.5,-135 730.5,-141 724.5,-141"/>
<text text-anchor="middle" x="679" y="-119.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitMutations</text>
</g>
<!-- commitTxn&#45;&gt;commitMutations -->
<g id="edge5" class="edge">
<title>commitTxn&#45;&gt;commitMutations</title>
<path fill="none" stroke="#666666" d="M558.2,-123C575.74,-123 594.14,-123 611.11,-123"/>
<polygon fill="#666666" stroke="#666666" points="611.46,-126.5 621.46,-123 611.46,-119.5 611.46,-126.5"/>
</g>
<!-- getTimestampWithRetry&#45;&gt;commitTxn -->
<g id="edge4" class="edge">
<title>getTimestampWithRetry&#45;&gt;commitTxn</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M360.21,-129.67C368.62,-129.18 377.24,-128.69 385.81,-128.19"/>
<polygon fill="green" stroke="green" points="386.04,-131.69 395.82,-127.62 385.64,-124.7 386.04,-131.69"/>
</g>
<!-- commitMutations&#45;&gt;doActionOnGroupMutations -->
<g id="edge6" class="edge">
<title>commitMutations&#45;&gt;doActionOnGroupMutations</title>
<path fill="none" stroke="#666666" d="M736.69,-118.43C752.95,-117.13 771.28,-115.65 789.68,-114.17"/>
<polygon fill="#666666" stroke="#666666" points="790.22,-117.63 799.9,-113.34 789.66,-110.66 790.22,-117.63"/>
</g>
<!-- actionCommit_handleSingleBatch -->
<g id="node8" class="node">
<title>actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1284,-145C1284,-145 1465,-145 1465,-145 1471,-145 1477,-151 1477,-157 1477,-157 1477,-169 1477,-169 1477,-175 1471,-181 1465,-181 1465,-181 1284,-181 1284,-181 1278,-181 1272,-175 1272,-169 1272,-169 1272,-157 1272,-157 1272,-151 1278,-145 1284,-145"/>
<text text-anchor="middle" x="1374.5" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit::handleSingleBatch</text>
</g>
<!-- commitMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge9" class="edge">
<title>commitMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M724.59,-141.04C746.89,-149.33 774.49,-158.53 800,-164 989.73,-204.72 1042.68,-203.75 1236,-187 1248.1,-185.95 1260.73,-184.4 1273.21,-182.57"/>
<polygon fill="green" stroke="green" points="1273.83,-186.02 1283.19,-181.05 1272.77,-179.1 1273.83,-186.02"/>
</g>
<!-- primaryBatch -->
<g id="node9" class="node">
<title>primaryBatch</title>
<path fill="none" stroke="#1c2123" d="M1084,-36.5C1084,-36.5 1197,-36.5 1197,-36.5 1203,-36.5 1209,-42.5 1209,-48.5 1209,-48.5 1209,-85.5 1209,-85.5 1209,-91.5 1203,-97.5 1197,-97.5 1197,-97.5 1084,-97.5 1084,-97.5 1078,-97.5 1072,-91.5 1072,-85.5 1072,-85.5 1072,-48.5 1072,-48.5 1072,-42.5 1078,-36.5 1084,-36.5"/>
<text text-anchor="middle" x="1140.5" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primaryBatch</text>
<polyline fill="none" stroke="#1c2123" points="1072,-74.5 1209,-74.5 "/>
<text text-anchor="start" x="1080" y="-59.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">b.batches[:1]</text>
<text text-anchor="start" x="1080" y="-44.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> primayBatch size为1</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;primaryBatch -->
<g id="edge10" class="edge">
<title>doActionOnGroupMutations&#45;&gt;primaryBatch</title>
<path fill="none" stroke="#666666" d="M1009.16,-88.17C1026.77,-85.31 1044.8,-82.38 1061.6,-79.65"/>
<polygon fill="#666666" stroke="#666666" points="1062.59,-83.04 1071.9,-77.98 1061.47,-76.13 1062.59,-83.04"/>
</g>
<!-- doActionOnMutations -->
<g id="node10" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M1057,-116.5C1057,-116.5 1224,-116.5 1224,-116.5 1230,-116.5 1236,-122.5 1236,-128.5 1236,-128.5 1236,-165.5 1236,-165.5 1236,-171.5 1230,-177.5 1224,-177.5 1224,-177.5 1057,-177.5 1057,-177.5 1051,-177.5 1045,-171.5 1045,-165.5 1045,-165.5 1045,-128.5 1045,-128.5 1045,-122.5 1051,-116.5 1057,-116.5"/>
<text text-anchor="middle" x="1140.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="1045,-154.5 1236,-154.5 "/>
<text text-anchor="start" x="1053" y="-139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对Mutation根据region 做分组</text>
<text text-anchor="start" x="1053" y="-124.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后每个组做batch</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;doActionOnMutations -->
<g id="edge11" class="edge">
<title>doActionOnGroupMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M1009.16,-123.61C1017.68,-125.13 1026.3,-126.68 1034.83,-128.21"/>
<polygon fill="#666666" stroke="#666666" points="1034.33,-131.68 1044.79,-130 1035.57,-124.79 1034.33,-131.68"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge12" class="edge">
<title>doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1236.2,-119.65C1257.94,-113.37 1280.71,-106.8 1301.32,-100.84"/>
<polygon fill="#666666" stroke="#666666" points="1302.31,-104.2 1310.94,-98.07 1300.36,-97.48 1302.31,-104.2"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge13" class="edge">
<title>doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1236.2,-153.53C1244.66,-154.11 1253.28,-154.71 1261.87,-155.3"/>
<polygon fill="#666666" stroke="#666666" points="1261.72,-158.8 1271.93,-156 1262.2,-151.82 1261.72,-158.8"/>
</g>
<!-- Commit -->
<g id="node11" class="node">
<title>Commit</title>
<path fill="none" stroke="#1c2123" d="M66,-83C66,-83 28,-83 28,-83 22,-83 16,-77 16,-71 16,-71 16,-59 16,-59 16,-53 22,-47 28,-47 28,-47 66,-47 66,-47 72,-47 78,-53 78,-59 78,-59 78,-71 78,-71 78,-77 72,-83 66,-83"/>
<text text-anchor="middle" x="47" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commit</text>
</g>
<!-- Commit&#45;&gt;execute -->
<g id="edge14" class="edge">
<title>Commit&#45;&gt;execute</title>
<path fill="none" stroke="#666666" d="M78,-65C86.18,-65 95.14,-65 103.71,-65"/>
<polygon fill="#666666" stroke="#666666" points="103.88,-68.5 113.88,-65 103.88,-61.5 103.88,-68.5"/>
</g>
</g>
</svg>
