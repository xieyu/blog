<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: unlock_key Pages: 1 -->
<svg width="1242pt" height="392pt"
 viewBox="0.00 0.00 1242.00 391.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 387.81)">
<title>unlock_key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-387.81 1238,-387.81 1238,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_Commit</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M506,-55.62C506,-55.62 1066.5,-55.62 1066.5,-55.62 1072.5,-55.62 1078.5,-61.62 1078.5,-67.62 1078.5,-67.62 1078.5,-125.62 1078.5,-125.62 1078.5,-131.62 1072.5,-137.62 1066.5,-137.62 1066.5,-137.62 506,-137.62 506,-137.62 500,-137.62 494,-131.62 494,-125.62 494,-125.62 494,-67.62 494,-67.62 494,-61.62 500,-55.62 506,-55.62"/>
<text text-anchor="middle" x="786.25" y="-117.62" font-family="Times,serif" font-size="20.00">Commit</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Rollback</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M641,-145.62C641,-145.62 1114,-145.62 1114,-145.62 1120,-145.62 1126,-151.62 1126,-157.62 1126,-157.62 1126,-345.62 1126,-345.62 1126,-351.62 1120,-357.62 1114,-357.62 1114,-357.62 641,-357.62 641,-357.62 635,-357.62 629,-351.62 629,-345.62 629,-345.62 629,-157.62 629,-157.62 629,-151.62 635,-145.62 641,-145.62"/>
<text text-anchor="middle" x="877.5" y="-337.62" font-family="Times,serif" font-size="20.00">Rollback</text>
</g>
<!-- commit -->
<g id="node1" class="node">
<title>commit</title>
<path fill="none" stroke="#1c2123" d="M549,-99.62C549,-99.62 514,-99.62 514,-99.62 508,-99.62 502,-93.62 502,-87.62 502,-87.62 502,-75.62 502,-75.62 502,-69.62 508,-63.62 514,-63.62 514,-63.62 549,-63.62 549,-63.62 555,-63.62 561,-69.62 561,-75.62 561,-75.62 561,-87.62 561,-87.62 561,-93.62 555,-99.62 549,-99.62"/>
<text text-anchor="middle" x="531.5" y="-77.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit</text>
</g>
<!-- unlock_key -->
<g id="node2" class="node">
<title>unlock_key</title>
<path fill="none" stroke="#1c2123" d="M1222,-200.62C1222,-200.62 1166,-200.62 1166,-200.62 1160,-200.62 1154,-194.62 1154,-188.62 1154,-188.62 1154,-176.62 1154,-176.62 1154,-170.62 1160,-164.62 1166,-164.62 1166,-164.62 1222,-164.62 1222,-164.62 1228,-164.62 1234,-170.62 1234,-176.62 1234,-176.62 1234,-188.62 1234,-188.62 1234,-194.62 1228,-200.62 1222,-200.62"/>
<text text-anchor="middle" x="1194" y="-178.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">unlock_key</text>
</g>
<!-- commit&#45;&gt;unlock_key -->
<g id="edge1" class="edge">
<title>commit&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M561.2,-69.96C651.99,-35.1 938.05,59.14 1126,-54.62 1161.7,-76.23 1179.3,-123.82 1187.24,-154.49"/>
<polygon fill="#666666" stroke="#666666" points="1183.92,-155.66 1189.66,-164.56 1190.73,-154.02 1183.92,-155.66"/>
</g>
<!-- handle_1pc_locks -->
<g id="node3" class="node">
<title>handle_1pc_locks</title>
<path fill="none" stroke="#1c2123" d="M1058.5,-99.62C1058.5,-99.62 968.5,-99.62 968.5,-99.62 962.5,-99.62 956.5,-93.62 956.5,-87.62 956.5,-87.62 956.5,-75.62 956.5,-75.62 956.5,-69.62 962.5,-63.62 968.5,-63.62 968.5,-63.62 1058.5,-63.62 1058.5,-63.62 1064.5,-63.62 1070.5,-69.62 1070.5,-75.62 1070.5,-75.62 1070.5,-87.62 1070.5,-87.62 1070.5,-93.62 1064.5,-99.62 1058.5,-99.62"/>
<text text-anchor="middle" x="1013.5" y="-77.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_1pc_locks</text>
</g>
<!-- handle_1pc_locks&#45;&gt;unlock_key -->
<g id="edge2" class="edge">
<title>handle_1pc_locks&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M1049.43,-99.78C1071.54,-111.43 1100.65,-127.06 1126,-141.62 1135.69,-147.19 1146.04,-153.39 1155.63,-159.25"/>
<polygon fill="#666666" stroke="#666666" points="1153.84,-162.26 1164.19,-164.51 1157.5,-156.29 1153.84,-162.26"/>
</g>
<!-- PessimisticRollback_process_write -->
<g id="node4" class="node">
<title>PessimisticRollback_process_write</title>
<path fill="none" stroke="#1c2123" d="M1106,-319.62C1106,-319.62 921,-319.62 921,-319.62 915,-319.62 909,-313.62 909,-307.62 909,-307.62 909,-295.62 909,-295.62 909,-289.62 915,-283.62 921,-283.62 921,-283.62 1106,-283.62 1106,-283.62 1112,-283.62 1118,-289.62 1118,-295.62 1118,-295.62 1118,-307.62 1118,-307.62 1118,-313.62 1112,-319.62 1106,-319.62"/>
<text text-anchor="middle" x="1013.5" y="-297.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">PessimisticRollback_process_write</text>
</g>
<!-- PessimisticRollback_process_write&#45;&gt;unlock_key -->
<g id="edge3" class="edge">
<title>PessimisticRollback_process_write&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M1109.88,-283.54C1115.52,-280.95 1120.95,-278 1126,-274.62 1150.07,-258.52 1168.54,-230.71 1179.93,-209.86"/>
<polygon fill="#666666" stroke="#666666" points="1183.12,-211.33 1184.66,-200.84 1176.92,-208.07 1183.12,-211.33"/>
</g>
<!-- check_txn_status_lock_exists -->
<g id="node5" class="node">
<title>check_txn_status_lock_exists</title>
<path fill="none" stroke="#1c2123" d="M649,-220.12C649,-220.12 861,-220.12 861,-220.12 867,-220.12 873,-226.12 873,-232.12 873,-232.12 873,-307.12 873,-307.12 873,-313.12 867,-319.12 861,-319.12 861,-319.12 649,-319.12 649,-319.12 643,-319.12 637,-313.12 637,-307.12 637,-307.12 637,-232.12 637,-232.12 637,-226.12 643,-220.12 649,-220.12"/>
<text text-anchor="middle" x="755" y="-303.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_txn_status_lock_exists</text>
<polyline fill="none" stroke="#1c2123" points="637,-296.12 873,-296.12 "/>
<text text-anchor="start" x="645" y="-280.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">check whether there&#39;s an overlapped</text>
<text text-anchor="start" x="645" y="-265.92" font-family="Times,serif" font-size="14.00" fill="#2f3638"> write record, and then perform rollback</text>
<polyline fill="none" stroke="#1c2123" points="637,-258.12 873,-258.12 "/>
<text text-anchor="start" x="645" y="-242.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">检查lock ttl，如果lock expire了</text>
<text text-anchor="start" x="645" y="-227.92" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 就rollback lock</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;unlock_key -->
<g id="edge4" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M873.2,-229.78C885.21,-226.39 897.3,-223.26 909,-220.62 990.09,-202.36 1086.32,-191.75 1143.38,-186.58"/>
<polygon fill="#666666" stroke="#666666" points="1143.91,-190.05 1153.56,-185.68 1143.29,-183.07 1143.91,-190.05"/>
</g>
<!-- rollback_lock -->
<g id="node6" class="node">
<title>rollback_lock</title>
<path fill="none" stroke="#1c2123" d="M1047,-265.62C1047,-265.62 980,-265.62 980,-265.62 974,-265.62 968,-259.62 968,-253.62 968,-253.62 968,-241.62 968,-241.62 968,-235.62 974,-229.62 980,-229.62 980,-229.62 1047,-229.62 1047,-229.62 1053,-229.62 1059,-235.62 1059,-241.62 1059,-241.62 1059,-253.62 1059,-253.62 1059,-259.62 1053,-265.62 1047,-265.62"/>
<text text-anchor="middle" x="1013.5" y="-243.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_lock</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;rollback_lock -->
<g id="edge5" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M873.37,-259.56C902.8,-257.03 933,-254.44 957.71,-252.32"/>
<polygon fill="#666666" stroke="#666666" points="958.29,-255.78 967.95,-251.44 957.69,-248.81 958.29,-255.78"/>
</g>
<!-- rollback_lock&#45;&gt;unlock_key -->
<g id="edge6" class="edge">
<title>rollback_lock&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M1059.05,-236.79C1079.7,-231.27 1104.4,-223.97 1126,-215.62 1133.91,-212.57 1142.15,-208.92 1150.04,-205.18"/>
<polygon fill="#666666" stroke="#666666" points="1151.63,-208.3 1159.1,-200.78 1148.57,-202 1151.63,-208.3"/>
</g>
<!-- CheckSecondaryLocks_process_write -->
<g id="node7" class="node">
<title>CheckSecondaryLocks_process_write</title>
<path fill="none" stroke="#1c2123" d="M655.5,-154.62C655.5,-154.62 854.5,-154.62 854.5,-154.62 860.5,-154.62 866.5,-160.62 866.5,-166.62 866.5,-166.62 866.5,-188.62 866.5,-188.62 866.5,-194.62 860.5,-200.62 854.5,-200.62 854.5,-200.62 655.5,-200.62 655.5,-200.62 649.5,-200.62 643.5,-194.62 643.5,-188.62 643.5,-188.62 643.5,-166.62 643.5,-166.62 643.5,-160.62 649.5,-154.62 655.5,-154.62"/>
<text text-anchor="middle" x="755" y="-185.42" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks_process_write</text>
<polyline fill="none" stroke="#1c2123" points="643.5,-177.62 866.5,-177.62 "/>
<text text-anchor="middle" x="755" y="-162.42" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
</g>
<!-- CheckSecondaryLocks_process_write&#45;&gt;unlock_key -->
<g id="edge7" class="edge">
<title>CheckSecondaryLocks_process_write&#45;&gt;unlock_key</title>
<path fill="none" stroke="#666666" d="M866.56,-178.89C955.72,-179.91 1076.92,-181.29 1143.72,-182.06"/>
<polygon fill="#666666" stroke="#666666" points="1143.93,-185.56 1153.97,-182.18 1144.01,-178.56 1143.93,-185.56"/>
</g>
<!-- CheckTxnStatus_process_write -->
<g id="node8" class="node">
<title>CheckTxnStatus_process_write</title>
<path fill="none" stroke="#1c2123" d="M205,-240.62C205,-240.62 414,-240.62 414,-240.62 420,-240.62 426,-246.62 426,-252.62 426,-252.62 426,-304.62 426,-304.62 426,-310.62 420,-316.62 414,-316.62 414,-316.62 205,-316.62 205,-316.62 199,-316.62 193,-310.62 193,-304.62 193,-304.62 193,-252.62 193,-252.62 193,-246.62 199,-240.62 205,-240.62"/>
<text text-anchor="middle" x="309.5" y="-301.42" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus::process_write</text>
<polyline fill="none" stroke="#1c2123" points="193,-293.62 426,-293.62 "/>
<text text-anchor="start" x="201" y="-278.42" font-family="Times,serif" font-size="14.00" fill="#2f3638">check the status of a transaction</text>
<text text-anchor="start" x="201" y="-263.42" font-family="Times,serif" font-size="14.00" fill="#2f3638"> this is usually invoked by a transaction</text>
<text text-anchor="start" x="201" y="-248.42" font-family="Times,serif" font-size="14.00" fill="#2f3638"> that meets another transaction&#39;s lock</text>
</g>
<!-- CheckTxnStatus_process_write&#45;&gt;check_txn_status_lock_exists -->
<g id="edge8" class="edge">
<title>CheckTxnStatus_process_write&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="#666666" d="M426.16,-276.28C487.67,-275.03 563.43,-273.49 626.63,-272.21"/>
<polygon fill="#666666" stroke="#666666" points="626.73,-275.71 636.66,-272 626.59,-268.71 626.73,-275.71"/>
</g>
<!-- Prewriter_process_write -->
<g id="node9" class="node">
<title>Prewriter_process_write</title>
<path fill="none" stroke="#1c2123" d="M247,-146.62C247,-146.62 372,-146.62 372,-146.62 378,-146.62 384,-152.62 384,-158.62 384,-158.62 384,-170.62 384,-170.62 384,-176.62 378,-182.62 372,-182.62 372,-182.62 247,-182.62 247,-182.62 241,-182.62 235,-176.62 235,-170.62 235,-170.62 235,-158.62 235,-158.62 235,-152.62 241,-146.62 247,-146.62"/>
<text text-anchor="middle" x="309.5" y="-160.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">Prewriter::process_write</text>
</g>
<!-- Prewriter_write_result -->
<g id="node10" class="node">
<title>Prewriter_write_result</title>
<path fill="none" stroke="#1c2123" d="M474,-146.62C474,-146.62 589,-146.62 589,-146.62 595,-146.62 601,-152.62 601,-158.62 601,-158.62 601,-170.62 601,-170.62 601,-176.62 595,-182.62 589,-182.62 589,-182.62 474,-182.62 474,-182.62 468,-182.62 462,-176.62 462,-170.62 462,-170.62 462,-158.62 462,-158.62 462,-152.62 468,-146.62 474,-146.62"/>
<text text-anchor="middle" x="531.5" y="-160.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">Prewriter::write_result</text>
</g>
<!-- Prewriter_process_write&#45;&gt;Prewriter_write_result -->
<g id="edge9" class="edge">
<title>Prewriter_process_write&#45;&gt;Prewriter_write_result</title>
<path fill="none" stroke="#666666" d="M384.06,-164.62C405.84,-164.62 429.76,-164.62 451.84,-164.62"/>
<polygon fill="#666666" stroke="#666666" points="451.84,-168.12 461.84,-164.62 451.84,-161.12 451.84,-168.12"/>
</g>
<!-- one_pc_commit_ts -->
<g id="node11" class="node">
<title>one_pc_commit_ts</title>
<path fill="none" stroke="#1c2123" d="M803.5,-99.62C803.5,-99.62 706.5,-99.62 706.5,-99.62 700.5,-99.62 694.5,-93.62 694.5,-87.62 694.5,-87.62 694.5,-75.62 694.5,-75.62 694.5,-69.62 700.5,-63.62 706.5,-63.62 706.5,-63.62 803.5,-63.62 803.5,-63.62 809.5,-63.62 815.5,-69.62 815.5,-75.62 815.5,-75.62 815.5,-87.62 815.5,-87.62 815.5,-93.62 809.5,-99.62 803.5,-99.62"/>
<text text-anchor="middle" x="755" y="-77.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">one_pc_commit_ts</text>
</g>
<!-- Prewriter_write_result&#45;&gt;one_pc_commit_ts -->
<g id="edge10" class="edge">
<title>Prewriter_write_result&#45;&gt;one_pc_commit_ts</title>
<path fill="none" stroke="#666666" d="M587.17,-146.54C591.86,-144.9 596.52,-143.25 601,-141.62 634.12,-129.57 670.91,-115.18 700.11,-103.51"/>
<polygon fill="#666666" stroke="#666666" points="701.72,-106.64 709.7,-99.67 699.12,-100.14 701.72,-106.64"/>
</g>
<!-- one_pc_commit_ts&#45;&gt;handle_1pc_locks -->
<g id="edge11" class="edge">
<title>one_pc_commit_ts&#45;&gt;handle_1pc_locks</title>
<path fill="none" stroke="#666666" d="M815.81,-81.62C854.76,-81.62 905.62,-81.62 945.86,-81.62"/>
<polygon fill="#666666" stroke="#666666" points="946.11,-85.12 956.11,-81.62 946.11,-78.12 946.11,-85.12"/>
</g>
<!-- Commit_process_write -->
<g id="node12" class="node">
<title>Commit_process_write</title>
<path fill="none" stroke="#1c2123" d="M249,-77.62C249,-77.62 370,-77.62 370,-77.62 376,-77.62 382,-83.62 382,-89.62 382,-89.62 382,-101.62 382,-101.62 382,-107.62 376,-113.62 370,-113.62 370,-113.62 249,-113.62 249,-113.62 243,-113.62 237,-107.62 237,-101.62 237,-101.62 237,-89.62 237,-89.62 237,-83.62 243,-77.62 249,-77.62"/>
<text text-anchor="middle" x="309.5" y="-91.92" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commit::process_write</text>
</g>
<!-- Commit_process_write&#45;&gt;commit -->
<g id="edge12" class="edge">
<title>Commit_process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M382.23,-91.06C418.69,-88.74 461.55,-86.01 491.78,-84.09"/>
<polygon fill="#666666" stroke="#666666" points="492.16,-87.57 501.92,-83.44 491.72,-80.58 492.16,-87.57"/>
</g>
<!-- Command_process_write -->
<g id="node13" class="node">
<title>Command_process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-188.62C12,-188.62 145,-188.62 145,-188.62 151,-188.62 157,-194.62 157,-200.62 157,-200.62 157,-222.62 157,-222.62 157,-228.62 151,-234.62 145,-234.62 145,-234.62 12,-234.62 12,-234.62 6,-234.62 0,-228.62 0,-222.62 0,-222.62 0,-200.62 0,-200.62 0,-194.62 6,-188.62 12,-188.62"/>
<text text-anchor="middle" x="78.5" y="-219.42" font-family="Times,serif" font-size="14.00" fill="#2f3638">Command::process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-211.62 157,-211.62 "/>
<text text-anchor="middle" x="78.5" y="-196.42" font-family="Times,serif" font-size="14.00" fill="#2f3638"> </text>
</g>
<!-- Command_process_write&#45;&gt;PessimisticRollback_process_write -->
<g id="edge13" class="edge">
<title>Command_process_write&#45;&gt;PessimisticRollback_process_write</title>
<path fill="none" stroke="#666666" d="M94.11,-235.08C113,-262.96 148.79,-308.02 193,-326.62 451.43,-435.36 797.33,-361.96 943.11,-322.34"/>
<polygon fill="#666666" stroke="#666666" points="944.12,-325.69 952.83,-319.66 942.26,-318.94 944.12,-325.69"/>
</g>
<!-- Command_process_write&#45;&gt;CheckSecondaryLocks_process_write -->
<g id="edge14" class="edge">
<title>Command_process_write&#45;&gt;CheckSecondaryLocks_process_write</title>
<path fill="none" stroke="#666666" d="M157.33,-210.27C259.32,-208.17 443.71,-203.19 601,-192.62 611.5,-191.92 622.4,-191.07 633.31,-190.15"/>
<polygon fill="#666666" stroke="#666666" points="633.68,-193.63 643.34,-189.28 633.07,-186.66 633.68,-193.63"/>
</g>
<!-- Command_process_write&#45;&gt;CheckTxnStatus_process_write -->
<g id="edge15" class="edge">
<title>Command_process_write&#45;&gt;CheckTxnStatus_process_write</title>
<path fill="none" stroke="#666666" d="M157.03,-234.31C165.51,-236.79 174.29,-239.36 183.16,-241.95"/>
<polygon fill="#666666" stroke="#666666" points="182.23,-245.33 192.82,-244.78 184.2,-238.61 182.23,-245.33"/>
</g>
<!-- Command_process_write&#45;&gt;Prewriter_process_write -->
<g id="edge16" class="edge">
<title>Command_process_write&#45;&gt;Prewriter_process_write</title>
<path fill="none" stroke="#666666" d="M157.03,-195.71C178.86,-191.23 202.7,-186.34 224.87,-181.79"/>
<polygon fill="#666666" stroke="#666666" points="225.83,-185.16 234.92,-179.72 224.42,-178.31 225.83,-185.16"/>
</g>
<!-- Command_process_write&#45;&gt;Commit_process_write -->
<g id="edge17" class="edge">
<title>Command_process_write&#45;&gt;Commit_process_write</title>
<path fill="none" stroke="#666666" d="M110.62,-188.54C132.8,-172.79 163.75,-152.23 193,-137.62 208.1,-130.08 224.89,-123.19 240.89,-117.27"/>
<polygon fill="#666666" stroke="#666666" points="242.51,-120.4 250.72,-113.71 240.13,-113.82 242.51,-120.4"/>
</g>
</g>
</svg>
