<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: wait_manager_handle_wait_for Pages: 1 -->
<svg width="1147pt" height="368pt"
 viewBox="0.00 0.00 1147.00 368.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 364)">
<title>wait_manager_handle_wait_for</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-364 1143,-364 1143,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_WaitTable</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M360,-244C360,-244 996,-244 996,-244 1002,-244 1008,-250 1008,-256 1008,-256 1008,-340 1008,-340 1008,-346 1002,-352 996,-352 996,-352 360,-352 360,-352 354,-352 348,-346 348,-340 348,-340 348,-256 348,-256 348,-250 354,-244 360,-244"/>
<text text-anchor="middle" x="678" y="-332" font-family="Times,serif" font-size="20.00">WaitTable</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_detector_scheduler</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M833,-8C833,-8 975,-8 975,-8 981,-8 987,-14 987,-20 987,-20 987,-78 987,-78 987,-84 981,-90 975,-90 975,-90 833,-90 833,-90 827,-90 821,-84 821,-78 821,-78 821,-20 821,-20 821,-14 827,-8 833,-8"/>
<text text-anchor="middle" x="904" y="-70" font-family="Times,serif" font-size="20.00">detector_scheduler</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_Waiter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M563,-98C563,-98 1119,-98 1119,-98 1125,-98 1131,-104 1131,-110 1131,-110 1131,-224 1131,-224 1131,-230 1125,-236 1119,-236 1119,-236 563,-236 563,-236 557,-236 551,-230 551,-224 551,-224 551,-110 551,-110 551,-104 557,-98 563,-98"/>
<text text-anchor="middle" x="841" y="-216" font-family="Times,serif" font-size="20.00">Waiter</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_WaitManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-112C20,-112 495.5,-112 495.5,-112 501.5,-112 507.5,-118 507.5,-124 507.5,-124 507.5,-224 507.5,-224 507.5,-230 501.5,-236 495.5,-236 495.5,-236 20,-236 20,-236 14,-236 8,-230 8,-224 8,-224 8,-124 8,-124 8,-118 14,-112 20,-112"/>
<text text-anchor="middle" x="257.75" y="-216" font-family="Times,serif" font-size="20.00">WaitManager</text>
</g>
<!-- add_waiter -->
<g id="node1" class="node">
<title>add_waiter</title>
<path fill="none" stroke="#1c2123" d="M368,-252.5C368,-252.5 511,-252.5 511,-252.5 517,-252.5 523,-258.5 523,-264.5 523,-264.5 523,-301.5 523,-301.5 523,-307.5 517,-313.5 511,-313.5 511,-313.5 368,-313.5 368,-313.5 362,-313.5 356,-307.5 356,-301.5 356,-301.5 356,-264.5 356,-264.5 356,-258.5 362,-252.5 368,-252.5"/>
<text text-anchor="middle" x="439.5" y="-298.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">add_waiter</text>
<polyline fill="none" stroke="#1c2123" points="356,-290.5 523,-290.5 "/>
<text text-anchor="start" x="364" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将wait_table加入lock.hash</text>
<text text-anchor="start" x="364" y="-260.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应的的队列中</text>
</g>
<!-- remove_waiter -->
<g id="node2" class="node">
<title>remove_waiter</title>
<path fill="none" stroke="#1c2123" d="M820,-253C820,-253 988,-253 988,-253 994,-253 1000,-259 1000,-265 1000,-265 1000,-287 1000,-287 1000,-293 994,-299 988,-299 988,-299 820,-299 820,-299 814,-299 808,-293 808,-287 808,-287 808,-265 808,-265 808,-259 814,-253 820,-253"/>
<text text-anchor="middle" x="904" y="-283.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">remove_waiter</text>
<polyline fill="none" stroke="#1c2123" points="808,-276 1000,-276 "/>
<text text-anchor="start" x="816" y="-260.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">从wait_table队列总去掉waiter</text>
</g>
<!-- clean_up_wait_for -->
<g id="node3" class="node">
<title>clean_up_wait_for</title>
<path fill="none" stroke="#1c2123" d="M951,-52C951,-52 857,-52 857,-52 851,-52 845,-46 845,-40 845,-40 845,-28 845,-28 845,-22 851,-16 857,-16 857,-16 951,-16 951,-16 957,-16 963,-22 963,-28 963,-28 963,-40 963,-40 963,-46 957,-52 951,-52"/>
<text text-anchor="middle" x="904" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">clean_up_wait_for</text>
</g>
<!-- on_timeout -->
<g id="node4" class="node">
<title>on_timeout</title>
<path fill="none" stroke="#1c2123" d="M571,-106.5C571,-106.5 760,-106.5 760,-106.5 766,-106.5 772,-112.5 772,-118.5 772,-118.5 772,-185.5 772,-185.5 772,-191.5 766,-197.5 760,-197.5 760,-197.5 571,-197.5 571,-197.5 565,-197.5 559,-191.5 559,-185.5 559,-185.5 559,-118.5 559,-118.5 559,-112.5 565,-106.5 571,-106.5"/>
<text text-anchor="middle" x="665.5" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">on_timeout</text>
<polyline fill="none" stroke="#1c2123" points="559,-174.5 772,-174.5 "/>
<text text-anchor="start" x="567" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">等待lock超时了</text>
<text text-anchor="start" x="567" y="-144.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 1.从waiter队列中去掉该waiter</text>
<text text-anchor="start" x="567" y="-129.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 2.从deadlock检测中去掉该waiter</text>
<text text-anchor="start" x="567" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 3.调用cb</text>
</g>
<!-- on_timeout&#45;&gt;remove_waiter -->
<g id="edge1" class="edge">
<title>on_timeout&#45;&gt;remove_waiter</title>
<path fill="none" stroke="#666666" d="M733.7,-197.5C756.71,-212.07 782.98,-227.62 808,-240 814.36,-243.14 821.06,-246.19 827.85,-249.09"/>
<polygon fill="#666666" stroke="#666666" points="826.55,-252.34 837.13,-252.95 829.24,-245.88 826.55,-252.34"/>
</g>
<!-- on_timeout&#45;&gt;clean_up_wait_for -->
<g id="edge2" class="edge">
<title>on_timeout&#45;&gt;clean_up_wait_for</title>
<path fill="none" stroke="#666666" d="M757.94,-106.38C792.04,-89.36 829.28,-70.78 857.49,-56.71"/>
<polygon fill="#666666" stroke="#666666" points="859.3,-59.71 866.69,-52.12 856.18,-53.45 859.3,-59.71"/>
</g>
<!-- notify -->
<g id="node5" class="node">
<title>notify</title>
<path fill="none" stroke="#1c2123" d="M919,-170C919,-170 889,-170 889,-170 883,-170 877,-164 877,-158 877,-158 877,-146 877,-146 877,-140 883,-134 889,-134 889,-134 919,-134 919,-134 925,-134 931,-140 931,-146 931,-146 931,-158 931,-158 931,-164 925,-170 919,-170"/>
<text text-anchor="middle" x="904" y="-148.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">notify</text>
</g>
<!-- on_timeout&#45;&gt;notify -->
<g id="edge3" class="edge">
<title>on_timeout&#45;&gt;notify</title>
<path fill="none" stroke="#666666" d="M772.3,-152C806.09,-152 841.25,-152 866.58,-152"/>
<polygon fill="#666666" stroke="#666666" points="866.8,-155.5 876.8,-152 866.8,-148.5 866.8,-155.5"/>
</g>
<!-- delay_cancel -->
<g id="node6" class="node">
<title>delay_cancel</title>
<path fill="none" stroke="#1c2123" d="M1111,-143C1111,-143 1048,-143 1048,-143 1042,-143 1036,-137 1036,-131 1036,-131 1036,-119 1036,-119 1036,-113 1042,-107 1048,-107 1048,-107 1111,-107 1111,-107 1117,-107 1123,-113 1123,-119 1123,-119 1123,-131 1123,-131 1123,-137 1117,-143 1111,-143"/>
<text text-anchor="middle" x="1079.5" y="-121.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">delay_cancel</text>
</g>
<!-- notify&#45;&gt;delay_cancel -->
<g id="edge4" class="edge">
<title>notify&#45;&gt;delay_cancel</title>
<path fill="none" stroke="#666666" d="M931.35,-147.9C956.22,-144.03 994.24,-138.11 1025.4,-133.26"/>
<polygon fill="#666666" stroke="#666666" points="1026.33,-136.66 1035.67,-131.66 1025.26,-129.74 1026.33,-136.66"/>
</g>
<!-- cb_execute -->
<g id="node7" class="node">
<title>cb_execute</title>
<path fill="none" stroke="#1c2123" d="M1106,-197C1106,-197 1053,-197 1053,-197 1047,-197 1041,-191 1041,-185 1041,-185 1041,-173 1041,-173 1041,-167 1047,-161 1053,-161 1053,-161 1106,-161 1106,-161 1112,-161 1118,-167 1118,-173 1118,-173 1118,-185 1118,-185 1118,-191 1112,-197 1106,-197"/>
<text text-anchor="middle" x="1079.5" y="-175.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cb_execute</text>
</g>
<!-- notify&#45;&gt;cb_execute -->
<g id="edge5" class="edge">
<title>notify&#45;&gt;cb_execute</title>
<path fill="none" stroke="#666666" d="M931.35,-156.1C957.7,-160.2 998.8,-166.6 1030.87,-171.59"/>
<polygon fill="#666666" stroke="#666666" points="1030.52,-175.08 1040.94,-173.15 1031.6,-168.16 1030.52,-175.08"/>
</g>
<!-- WaitManager_run -->
<g id="node8" class="node">
<title>WaitManager_run</title>
<path fill="none" stroke="#1c2123" d="M120,-177C120,-177 28,-177 28,-177 22,-177 16,-171 16,-165 16,-165 16,-153 16,-153 16,-147 22,-141 28,-141 28,-141 120,-141 120,-141 126,-141 132,-147 132,-153 132,-153 132,-165 132,-165 132,-171 126,-177 120,-177"/>
<text text-anchor="middle" x="74" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WaitManager_run</text>
</g>
<!-- handle_wait_for -->
<g id="node9" class="node">
<title>handle_wait_for</title>
<path fill="none" stroke="#1c2123" d="M180,-124.5C180,-124.5 308,-124.5 308,-124.5 314,-124.5 320,-130.5 320,-136.5 320,-136.5 320,-181.5 320,-181.5 320,-187.5 314,-193.5 308,-193.5 308,-193.5 180,-193.5 180,-193.5 174,-193.5 168,-187.5 168,-181.5 168,-181.5 168,-136.5 168,-136.5 168,-130.5 174,-124.5 180,-124.5"/>
<text text-anchor="middle" x="244" y="-178.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_wait_for</text>
<polyline fill="none" stroke="#1c2123" points="168,-170.5 320,-170.5 "/>
<text text-anchor="start" x="176" y="-155.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理Task::WaitFor</text>
<polyline fill="none" stroke="#1c2123" points="168,-147.5 320,-147.5 "/>
<text text-anchor="start" x="176" y="-132.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">生成一个timeout future</text>
</g>
<!-- WaitManager_run&#45;&gt;handle_wait_for -->
<g id="edge6" class="edge">
<title>WaitManager_run&#45;&gt;handle_wait_for</title>
<path fill="none" stroke="#666666" d="M132.35,-159C140.54,-159 149.12,-159 157.72,-159"/>
<polygon fill="#666666" stroke="#666666" points="157.79,-162.5 167.79,-159 157.79,-155.5 157.79,-162.5"/>
</g>
<!-- handle_wait_for&#45;&gt;add_waiter -->
<g id="edge7" class="edge">
<title>handle_wait_for&#45;&gt;add_waiter</title>
<path fill="none" stroke="#666666" d="M284.57,-193.5C303.12,-208.78 325.96,-226.33 348,-240 352.13,-242.56 356.43,-245.07 360.82,-247.51"/>
<polygon fill="#666666" stroke="#666666" points="359.46,-250.76 369.93,-252.43 362.79,-244.6 359.46,-250.76"/>
</g>
<!-- handle_wait_for&#45;&gt;on_timeout -->
<g id="edge8" class="edge">
<title>handle_wait_for&#45;&gt;on_timeout</title>
<path fill="none" stroke="#666666" d="M309.76,-124.43C322.14,-119.28 335.23,-114.78 348,-112 424,-95.48 445.96,-101.32 523,-112 531.54,-113.18 540.3,-114.75 549.05,-116.58"/>
<polygon fill="#666666" stroke="#666666" points="548.42,-120.03 558.93,-118.75 549.92,-113.19 548.42,-120.03"/>
</g>
<!-- spawn_local -->
<g id="node10" class="node">
<title>spawn_local</title>
<path fill="none" stroke="#1c2123" d="M391.5,-121C391.5,-121 487.5,-121 487.5,-121 493.5,-121 499.5,-127 499.5,-133 499.5,-133 499.5,-185 499.5,-185 499.5,-191 493.5,-197 487.5,-197 487.5,-197 391.5,-197 391.5,-197 385.5,-197 379.5,-191 379.5,-185 379.5,-185 379.5,-133 379.5,-133 379.5,-127 385.5,-121 391.5,-121"/>
<text text-anchor="middle" x="439.5" y="-181.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">spawn_local</text>
<polyline fill="none" stroke="#1c2123" points="379.5,-174 499.5,-174 "/>
<text text-anchor="start" x="387.5" y="-158.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将future放入自己</text>
<text text-anchor="start" x="387.5" y="-143.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 本地队列中</text>
<text text-anchor="start" x="387.5" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 开始poll</text>
</g>
<!-- handle_wait_for&#45;&gt;spawn_local -->
<g id="edge9" class="edge">
<title>handle_wait_for&#45;&gt;spawn_local</title>
<path fill="none" stroke="#666666" d="M320.09,-159C336.21,-159 353.18,-159 369.07,-159"/>
<polygon fill="#666666" stroke="#666666" points="369.35,-162.5 379.35,-159 369.35,-155.5 369.35,-162.5"/>
</g>
<!-- spawn_local&#45;&gt;on_timeout -->
<g id="edge10" class="edge">
<title>spawn_local&#45;&gt;on_timeout</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M499.65,-157.15C514.67,-156.68 531.35,-156.16 548.15,-155.64"/>
<polygon fill="green" stroke="green" points="548.74,-159.12 558.62,-155.31 548.52,-152.12 548.74,-159.12"/>
</g>
</g>
</svg>
