<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: handle_apply Pages: 1 -->
<svg width="1942pt" height="906pt"
 viewBox="0.00 0.00 1942.00 905.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 901.6)">
<title>handle_apply</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-901.6 1938,-901.6 1938,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_SnapManager</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M281.5,-322C281.5,-322 1265,-322 1265,-322 1271,-322 1277,-328 1277,-334 1277,-334 1277,-446 1277,-446 1277,-452 1271,-458 1265,-458 1265,-458 281.5,-458 281.5,-458 275.5,-458 269.5,-452 269.5,-446 269.5,-446 269.5,-334 269.5,-334 269.5,-328 275.5,-322 281.5,-322"/>
<text text-anchor="middle" x="773.25" y="-438" font-family="Times,serif" font-size="20.00">SnapManager</text>
</g>
<!-- handle_apply -->
<g id="node1" class="node">
<title>handle_apply</title>
<path fill="none" stroke="#1c2123" d="M77,-461C77,-461 12,-461 12,-461 6,-461 0,-455 0,-449 0,-449 0,-437 0,-437 0,-431 6,-425 12,-425 12,-425 77,-425 77,-425 83,-425 89,-431 89,-437 89,-437 89,-449 89,-449 89,-455 83,-461 77,-461"/>
<text text-anchor="middle" x="44.5" y="-439.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">handle_apply</text>
</g>
<!-- apply_snap -->
<g id="node2" class="node">
<title>apply_snap</title>
<path fill="none" stroke="#1c2123" d="M191,-461C191,-461 137,-461 137,-461 131,-461 125,-455 125,-449 125,-449 125,-437 125,-437 125,-431 131,-425 137,-425 137,-425 191,-425 191,-425 197,-425 203,-431 203,-437 203,-437 203,-449 203,-449 203,-455 197,-461 191,-461"/>
<text text-anchor="middle" x="164" y="-439.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_snap</text>
</g>
<!-- handle_apply&#45;&gt;apply_snap -->
<g id="edge1" class="edge">
<title>handle_apply&#45;&gt;apply_snap</title>
<path fill="none" stroke="#666666" d="M89.25,-443C97.51,-443 106.19,-443 114.58,-443"/>
<polygon fill="#666666" stroke="#666666" points="114.62,-446.5 124.62,-443 114.62,-439.5 114.62,-446.5"/>
</g>
<!-- register -->
<g id="node3" class="node">
<title>register</title>
<path fill="none" stroke="#1c2123" d="M329,-420C329,-420 296,-420 296,-420 290,-420 284,-414 284,-408 284,-408 284,-396 284,-396 284,-390 290,-384 296,-384 296,-384 329,-384 329,-384 335,-384 341,-390 341,-396 341,-396 341,-408 341,-408 341,-414 335,-420 329,-420"/>
<text text-anchor="middle" x="312.5" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">register</text>
</g>
<!-- apply_snap&#45;&gt;register -->
<g id="edge3" class="edge">
<title>apply_snap&#45;&gt;register</title>
<path fill="none" stroke="#666666" d="M203.11,-432.33C224.92,-426.23 252.18,-418.6 273.9,-412.52"/>
<polygon fill="#666666" stroke="#666666" points="275.08,-415.83 283.76,-409.76 273.19,-409.09 275.08,-415.83"/>
</g>
<!-- deregister -->
<g id="node4" class="node">
<title>deregister</title>
<path fill="none" stroke="#1c2123" d="M335.5,-366C335.5,-366 289.5,-366 289.5,-366 283.5,-366 277.5,-360 277.5,-354 277.5,-354 277.5,-342 277.5,-342 277.5,-336 283.5,-330 289.5,-330 289.5,-330 335.5,-330 335.5,-330 341.5,-330 347.5,-336 347.5,-342 347.5,-342 347.5,-354 347.5,-354 347.5,-360 341.5,-366 335.5,-366"/>
<text text-anchor="middle" x="312.5" y="-344.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">deregister</text>
</g>
<!-- apply_snap&#45;&gt;deregister -->
<g id="edge4" class="edge">
<title>apply_snap&#45;&gt;deregister</title>
<path fill="none" stroke="#666666" d="M181.08,-424.71C195.12,-409.67 216.69,-388.68 239,-375 247.85,-369.58 257.96,-364.97 267.76,-361.18"/>
<polygon fill="#666666" stroke="#666666" points="269.21,-364.37 277.4,-357.66 266.81,-357.8 269.21,-364.37"/>
</g>
<!-- get_snapshot_for_applying_to_engine -->
<g id="node5" class="node">
<title>get_snapshot_for_applying_to_engine</title>
<path fill="none" stroke="#1c2123" d="M1257,-420C1257,-420 1057,-420 1057,-420 1051,-420 1045,-414 1045,-408 1045,-408 1045,-396 1045,-396 1045,-390 1051,-384 1057,-384 1057,-384 1257,-384 1257,-384 1263,-384 1269,-390 1269,-396 1269,-396 1269,-408 1269,-408 1269,-414 1263,-420 1257,-420"/>
<text text-anchor="middle" x="1157" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_snapshot_for_applying_to_engine</text>
</g>
<!-- apply_snap&#45;&gt;get_snapshot_for_applying_to_engine -->
<g id="edge5" class="edge">
<title>apply_snap&#45;&gt;get_snapshot_for_applying_to_engine</title>
<path fill="none" stroke="#666666" d="M168.5,-461.13C175.78,-494.04 195.62,-563.82 239,-603 411.44,-758.74 526.3,-683.44 758,-666 870.51,-657.53 914.14,-689.09 1009,-628 1083.76,-579.85 1128.52,-478.7 1146.63,-429.73"/>
<polygon fill="#666666" stroke="#666666" points="1150,-430.7 1150.09,-420.11 1143.41,-428.33 1150,-430.7"/>
</g>
<!-- apply -->
<g id="node6" class="node">
<title>apply</title>
<path fill="none" stroke="#1c2123" d="M1317,-739.5C1317,-739.5 1427,-739.5 1427,-739.5 1433,-739.5 1439,-745.5 1439,-751.5 1439,-751.5 1439,-796.5 1439,-796.5 1439,-802.5 1433,-808.5 1427,-808.5 1427,-808.5 1317,-808.5 1317,-808.5 1311,-808.5 1305,-802.5 1305,-796.5 1305,-796.5 1305,-751.5 1305,-751.5 1305,-745.5 1311,-739.5 1317,-739.5"/>
<text text-anchor="start" x="1313" y="-793.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">store/snap.rs</text>
<polyline fill="none" stroke="#1c2123" points="1305,-785.5 1439,-785.5 "/>
<text text-anchor="middle" x="1372" y="-770.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply</text>
<polyline fill="none" stroke="#1c2123" points="1305,-762.5 1439,-762.5 "/>
<text text-anchor="start" x="1313" y="-747.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">将snapshot写入db中</text>
</g>
<!-- apply_snap&#45;&gt;apply -->
<g id="edge6" class="edge">
<title>apply_snap&#45;&gt;apply</title>
<path fill="none" stroke="#666666" d="M166.4,-461.12C171.62,-523.92 192.16,-730.77 239,-774 323.44,-851.92 380.1,-810 495,-810 495,-810 495,-810 902.5,-810 1069.16,-810 1111.44,-810.09 1277,-791 1282.8,-790.33 1288.79,-789.52 1294.8,-788.63"/>
<polygon fill="#666666" stroke="#666666" points="1295.57,-792.05 1304.91,-787.05 1294.49,-785.14 1295.57,-792.05"/>
</g>
<!-- region_state_key -->
<g id="node7" class="node">
<title>region_state_key</title>
<path fill="none" stroke="#1c2123" d="M355,-502C355,-502 270,-502 270,-502 264,-502 258,-496 258,-490 258,-490 258,-478 258,-478 258,-472 264,-466 270,-466 270,-466 355,-466 355,-466 361,-466 367,-472 367,-478 367,-478 367,-490 367,-490 367,-496 361,-502 355,-502"/>
<text text-anchor="middle" x="312.5" y="-480.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_state_key</text>
</g>
<!-- apply_snap&#45;&gt;region_state_key -->
<g id="edge7" class="edge">
<title>apply_snap&#45;&gt;region_state_key</title>
<path fill="none" stroke="#666666" d="M203.11,-453.67C216.81,-457.5 232.66,-461.94 247.94,-466.21"/>
<polygon fill="#666666" stroke="#666666" points="247.29,-469.67 257.87,-468.99 249.18,-462.92 247.29,-469.67"/>
</g>
<!-- region_state -->
<g id="node8" class="node">
<title>region_state</title>
<path fill="none" stroke="#1c2123" d="M711.5,-744C711.5,-744 652.5,-744 652.5,-744 646.5,-744 640.5,-738 640.5,-732 640.5,-732 640.5,-720 640.5,-720 640.5,-714 646.5,-708 652.5,-708 652.5,-708 711.5,-708 711.5,-708 717.5,-708 723.5,-714 723.5,-720 723.5,-720 723.5,-732 723.5,-732 723.5,-738 717.5,-744 711.5,-744"/>
<text text-anchor="middle" x="682" y="-722.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_state</text>
</g>
<!-- apply_snap&#45;&gt;region_state -->
<g id="edge8" class="edge">
<title>apply_snap&#45;&gt;region_state</title>
<path fill="none" stroke="#666666" d="M167.66,-461.12C175.75,-513.6 201.83,-663.93 239,-694 352.6,-785.91 540.93,-759.05 630.57,-739.07"/>
<polygon fill="#666666" stroke="#666666" points="631.52,-742.44 640.49,-736.8 629.96,-735.62 631.52,-742.44"/>
</g>
<!-- get_msg_cf -->
<g id="node9" class="node">
<title>get_msg_cf</title>
<path fill="none" stroke="#1c2123" d="M449.5,-513.5C449.5,-513.5 542.5,-513.5 542.5,-513.5 548.5,-513.5 554.5,-519.5 554.5,-525.5 554.5,-525.5 554.5,-592.5 554.5,-592.5 554.5,-598.5 548.5,-604.5 542.5,-604.5 542.5,-604.5 449.5,-604.5 449.5,-604.5 443.5,-604.5 437.5,-598.5 437.5,-592.5 437.5,-592.5 437.5,-525.5 437.5,-525.5 437.5,-519.5 443.5,-513.5 449.5,-513.5"/>
<text text-anchor="middle" x="496" y="-589.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">get_msg_cf</text>
<polyline fill="none" stroke="#1c2123" points="437.5,-581.5 554.5,-581.5 "/>
<text text-anchor="start" x="445.5" y="-566.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">从CF_RAFT中读</text>
<text text-anchor="start" x="445.5" y="-551.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> state_key</text>
<text text-anchor="start" x="445.5" y="-536.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region_key</text>
<text text-anchor="start" x="445.5" y="-521.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 对应数据</text>
</g>
<!-- apply_snap&#45;&gt;get_msg_cf -->
<g id="edge9" class="edge">
<title>apply_snap&#45;&gt;get_msg_cf</title>
<path fill="none" stroke="#666666" d="M179.44,-461.05C193.08,-476.81 214.97,-498.97 239,-511 271.29,-527.17 362.92,-541.84 427.29,-550.6"/>
<polygon fill="#666666" stroke="#666666" points="427,-554.09 437.37,-551.95 427.93,-547.15 427,-554.09"/>
</g>
<!-- enc_start_key -->
<g id="node10" class="node">
<title>enc_start_key</title>
<path fill="none" stroke="#1c2123" d="M346.5,-274C346.5,-274 278.5,-274 278.5,-274 272.5,-274 266.5,-268 266.5,-262 266.5,-262 266.5,-250 266.5,-250 266.5,-244 272.5,-238 278.5,-238 278.5,-238 346.5,-238 346.5,-238 352.5,-238 358.5,-244 358.5,-250 358.5,-250 358.5,-262 358.5,-262 358.5,-268 352.5,-274 346.5,-274"/>
<text text-anchor="middle" x="312.5" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">enc_start_key</text>
</g>
<!-- apply_snap&#45;&gt;enc_start_key -->
<g id="edge10" class="edge">
<title>apply_snap&#45;&gt;enc_start_key</title>
<path fill="none" stroke="#666666" d="M169.24,-424.77C177.5,-393.03 198.56,-327.25 239,-288 244.29,-282.86 250.55,-278.47 257.14,-274.74"/>
<polygon fill="#666666" stroke="#666666" points="258.96,-277.74 266.26,-270.06 255.76,-271.51 258.96,-277.74"/>
</g>
<!-- enc_end_key -->
<g id="node11" class="node">
<title>enc_end_key</title>
<path fill="none" stroke="#1c2123" d="M344.5,-182C344.5,-182 280.5,-182 280.5,-182 274.5,-182 268.5,-176 268.5,-170 268.5,-170 268.5,-158 268.5,-158 268.5,-152 274.5,-146 280.5,-146 280.5,-146 344.5,-146 344.5,-146 350.5,-146 356.5,-152 356.5,-158 356.5,-158 356.5,-170 356.5,-170 356.5,-176 350.5,-182 344.5,-182"/>
<text text-anchor="middle" x="312.5" y="-160.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">enc_end_key</text>
</g>
<!-- apply_snap&#45;&gt;enc_end_key -->
<g id="edge11" class="edge">
<title>apply_snap&#45;&gt;enc_end_key</title>
<path fill="none" stroke="#666666" d="M165.45,-424.71C167.51,-380.09 178.72,-264.3 239,-196 244.63,-189.62 251.76,-184.46 259.35,-180.3"/>
<polygon fill="#666666" stroke="#666666" points="260.97,-183.4 268.41,-175.86 257.89,-177.12 260.97,-183.4"/>
</g>
<!-- check_abort -->
<g id="node12" class="node">
<title>check_abort</title>
<path fill="none" stroke="#1c2123" d="M342,-90C342,-90 283,-90 283,-90 277,-90 271,-84 271,-78 271,-78 271,-66 271,-66 271,-60 277,-54 283,-54 283,-54 342,-54 342,-54 348,-54 354,-60 354,-66 354,-66 354,-78 354,-78 354,-84 348,-90 342,-90"/>
<text text-anchor="middle" x="312.5" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">check_abort</text>
</g>
<!-- apply_snap&#45;&gt;check_abort -->
<g id="edge12" class="edge">
<title>apply_snap&#45;&gt;check_abort</title>
<path fill="none" stroke="#666666" d="M166.79,-424.89C173.34,-362.04 197.74,-154.5 239,-104 245.07,-96.57 253.22,-90.81 261.86,-86.36"/>
<polygon fill="#666666" stroke="#666666" points="263.34,-89.54 270.98,-82.19 260.43,-83.17 263.34,-89.54"/>
</g>
<!-- cleanup_overlap_ranges -->
<g id="node13" class="node">
<title>cleanup_overlap_ranges</title>
<path fill="none" stroke="#1c2123" d="M558,-228C558,-228 434,-228 434,-228 428,-228 422,-222 422,-216 422,-216 422,-204 422,-204 422,-198 428,-192 434,-192 434,-192 558,-192 558,-192 564,-192 570,-198 570,-204 570,-204 570,-216 570,-216 570,-222 564,-228 558,-228"/>
<text text-anchor="middle" x="496" y="-206.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleanup_overlap_ranges</text>
</g>
<!-- apply_snap&#45;&gt;cleanup_overlap_ranges -->
<g id="edge13" class="edge">
<title>apply_snap&#45;&gt;cleanup_overlap_ranges</title>
<path fill="none" stroke="#666666" d="M165.09,-424.92C166.38,-382.67 176.07,-277.43 239,-229 287.38,-191.77 357.27,-188.94 411.81,-194.36"/>
<polygon fill="#666666" stroke="#666666" points="411.49,-197.84 421.81,-195.46 412.25,-190.88 411.49,-197.84"/>
</g>
<!-- delete_all_in_range -->
<g id="node14" class="node">
<title>delete_all_in_range</title>
<path fill="none" stroke="#1c2123" d="M731.5,-251C731.5,-251 632.5,-251 632.5,-251 626.5,-251 620.5,-245 620.5,-239 620.5,-239 620.5,-227 620.5,-227 620.5,-221 626.5,-215 632.5,-215 632.5,-215 731.5,-215 731.5,-215 737.5,-215 743.5,-221 743.5,-227 743.5,-227 743.5,-239 743.5,-239 743.5,-245 737.5,-251 731.5,-251"/>
<text text-anchor="middle" x="682" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">delete_all_in_range</text>
</g>
<!-- apply_snap&#45;&gt;delete_all_in_range -->
<g id="edge14" class="edge">
<title>apply_snap&#45;&gt;delete_all_in_range</title>
<path fill="none" stroke="#666666" d="M170.37,-424.72C179.56,-396.87 201.08,-344.3 239,-318 269.7,-296.71 533.41,-266.54 570,-259 583.05,-256.31 596.92,-253.24 610.27,-250.17"/>
<polygon fill="#666666" stroke="#666666" points="611.4,-253.5 620.35,-247.83 609.82,-246.68 611.4,-253.5"/>
</g>
<!-- apply_state_key -->
<g id="node15" class="node">
<title>apply_state_key</title>
<path fill="none" stroke="#1c2123" d="M352.5,-594C352.5,-594 272.5,-594 272.5,-594 266.5,-594 260.5,-588 260.5,-582 260.5,-582 260.5,-570 260.5,-570 260.5,-564 266.5,-558 272.5,-558 272.5,-558 352.5,-558 352.5,-558 358.5,-558 364.5,-564 364.5,-570 364.5,-570 364.5,-582 364.5,-582 364.5,-588 358.5,-594 352.5,-594"/>
<text text-anchor="middle" x="312.5" y="-572.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_state_key</text>
</g>
<!-- apply_snap&#45;&gt;apply_state_key -->
<g id="edge15" class="edge">
<title>apply_snap&#45;&gt;apply_state_key</title>
<path fill="none" stroke="#666666" d="M174.47,-461.31C186.74,-483.47 210.03,-520.71 239,-544 243.05,-547.26 247.49,-550.25 252.1,-552.98"/>
<polygon fill="#666666" stroke="#666666" points="250.7,-556.21 261.15,-557.93 254.05,-550.06 250.7,-556.21"/>
</g>
<!-- ApplyOptions -->
<g id="node16" class="node">
<title>ApplyOptions</title>
<path fill="none" stroke="#1c2123" d="M1191.5,-782C1191.5,-782 1122.5,-782 1122.5,-782 1116.5,-782 1110.5,-776 1110.5,-770 1110.5,-770 1110.5,-758 1110.5,-758 1110.5,-752 1116.5,-746 1122.5,-746 1122.5,-746 1191.5,-746 1191.5,-746 1197.5,-746 1203.5,-752 1203.5,-758 1203.5,-758 1203.5,-770 1203.5,-770 1203.5,-776 1197.5,-782 1191.5,-782"/>
<text text-anchor="middle" x="1157" y="-760.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ApplyOptions</text>
</g>
<!-- apply_snap&#45;&gt;ApplyOptions -->
<g id="edge16" class="edge">
<title>apply_snap&#45;&gt;ApplyOptions</title>
<path fill="none" stroke="#666666" d="M166.93,-461.11C173.52,-519.23 197.04,-699.44 239,-737 324.57,-813.58 380.16,-772 495,-772 495,-772 495,-772 683,-772 833.89,-772 1011.83,-767.88 1100.27,-765.55"/>
<polygon fill="#666666" stroke="#666666" points="1100.44,-769.05 1110.34,-765.29 1100.25,-762.05 1100.44,-769.05"/>
</g>
<!-- put_msg_cf -->
<g id="node17" class="node">
<title>put_msg_cf</title>
<path fill="none" stroke="#1c2123" d="M1765,-794.5C1765,-794.5 1922,-794.5 1922,-794.5 1928,-794.5 1934,-800.5 1934,-806.5 1934,-806.5 1934,-843.5 1934,-843.5 1934,-849.5 1928,-855.5 1922,-855.5 1922,-855.5 1765,-855.5 1765,-855.5 1759,-855.5 1753,-849.5 1753,-843.5 1753,-843.5 1753,-806.5 1753,-806.5 1753,-800.5 1759,-794.5 1765,-794.5"/>
<text text-anchor="middle" x="1843.5" y="-840.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">put_msg_cf</text>
<polyline fill="none" stroke="#1c2123" points="1753,-832.5 1934,-832.5 "/>
<text text-anchor="start" x="1761" y="-817.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">put_msg_cf(CF_RAFT, </text>
<text text-anchor="start" x="1761" y="-802.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &amp;region_key, &amp;region_state)</text>
</g>
<!-- apply_snap&#45;&gt;put_msg_cf -->
<g id="edge17" class="edge">
<title>apply_snap&#45;&gt;put_msg_cf</title>
<path fill="none" stroke="#666666" d="M165.59,-461.09C168.33,-532.59 182.13,-794.18 239,-849 321.77,-928.78 380.04,-886 495,-886 495,-886 495,-886 1373,-886 1501.61,-886 1648.39,-863.21 1743.09,-845.49"/>
<polygon fill="#666666" stroke="#666666" points="1743.77,-848.93 1752.94,-843.63 1742.47,-842.05 1743.77,-848.93"/>
</g>
<!-- delete_cf -->
<g id="node18" class="node">
<title>delete_cf</title>
<path fill="none" stroke="#1c2123" d="M517,-86C517,-86 475,-86 475,-86 469,-86 463,-80 463,-74 463,-74 463,-62 463,-62 463,-56 469,-50 475,-50 475,-50 517,-50 517,-50 523,-50 529,-56 529,-62 529,-62 529,-74 529,-74 529,-80 523,-86 517,-86"/>
<text text-anchor="middle" x="496" y="-64.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">delete_cf</text>
</g>
<!-- apply_snap&#45;&gt;delete_cf -->
<g id="edge18" class="edge">
<title>apply_snap&#45;&gt;delete_cf</title>
<path fill="none" stroke="#666666" d="M166.96,-424.78C173.71,-365.37 197.88,-178.77 239,-137 286.34,-88.91 320.88,-116.68 386,-99 408.09,-93 432.61,-86.06 452.8,-80.26"/>
<polygon fill="#666666" stroke="#666666" points="453.98,-83.56 462.62,-77.43 452.05,-76.83 453.98,-83.56"/>
</g>
<!-- set_state_Normal -->
<g id="node19" class="node">
<title>set_state_Normal</title>
<path fill="none" stroke="#1c2123" d="M1487,-765.5C1487,-765.5 1705,-765.5 1705,-765.5 1711,-765.5 1717,-771.5 1717,-777.5 1717,-777.5 1717,-814.5 1717,-814.5 1717,-820.5 1711,-826.5 1705,-826.5 1705,-826.5 1487,-826.5 1487,-826.5 1481,-826.5 1475,-820.5 1475,-814.5 1475,-814.5 1475,-777.5 1475,-777.5 1475,-771.5 1481,-765.5 1487,-765.5"/>
<text text-anchor="middle" x="1596" y="-811.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">region_state.set_state(PeerState::Normal)</text>
<polyline fill="none" stroke="#1c2123" points="1475,-803.5 1717,-803.5 "/>
<text text-anchor="start" x="1483" y="-788.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在apply完后，</text>
<text text-anchor="start" x="1483" y="-773.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将Region状态设置为normal</text>
</g>
<!-- apply_snap&#45;&gt;set_state_Normal -->
<g id="edge19" class="edge">
<title>apply_snap&#45;&gt;set_state_Normal</title>
<path fill="none" stroke="#666666" d="M165.97,-461.23C169.94,-528.58 187.29,-762.06 239,-811 322.49,-890.03 380.04,-848 495,-848 495,-848 495,-848 1158,-848 1261.73,-848 1378.35,-833.37 1465.01,-819.64"/>
<polygon fill="#666666" stroke="#666666" points="1465.57,-823.09 1474.89,-818.05 1464.46,-816.18 1465.57,-823.09"/>
</g>
<!-- snapshot_raft_state_key -->
<g id="node20" class="node">
<title>snapshot_raft_state_key</title>
<path fill="none" stroke="#1c2123" d="M374,-36C374,-36 251,-36 251,-36 245,-36 239,-30 239,-24 239,-24 239,-12 239,-12 239,-6 245,0 251,0 251,0 374,0 374,0 380,0 386,-6 386,-12 386,-12 386,-24 386,-24 386,-30 380,-36 374,-36"/>
<text text-anchor="middle" x="312.5" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">snapshot_raft_state_key</text>
</g>
<!-- apply_snap&#45;&gt;snapshot_raft_state_key -->
<g id="edge20" class="edge">
<title>apply_snap&#45;&gt;snapshot_raft_state_key</title>
<path fill="none" stroke="#666666" d="M166.06,-424.64C170.44,-354.43 189.36,-104.04 239,-45 239.62,-44.26 240.27,-43.54 240.94,-42.83"/>
<polygon fill="#666666" stroke="#666666" points="243.52,-45.23 248.8,-36.05 238.94,-39.93 243.52,-45.23"/>
</g>
<!-- get_snapshot_for_applying_to_engine&#45;&gt;apply -->
<g id="edge2" class="edge">
<title>get_snapshot_for_applying_to_engine&#45;&gt;apply</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1168.42,-420.19C1200.63,-476.45 1299.24,-648.68 1345.96,-730.26"/>
<polygon fill="green" stroke="green" points="1343.11,-732.34 1351.12,-739.28 1349.19,-728.86 1343.11,-732.34"/>
</g>
<!-- apply&#45;&gt;set_state_Normal -->
<g id="edge24" class="edge">
<title>apply&#45;&gt;set_state_Normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1439.01,-780.54C1447.27,-781.36 1455.94,-782.22 1464.77,-783.09"/>
<polygon fill="green" stroke="green" points="1464.5,-786.59 1474.8,-784.09 1465.19,-779.62 1464.5,-786.59"/>
</g>
<!-- region_state_key&#45;&gt;get_msg_cf -->
<g id="edge34" class="edge">
<title>region_state_key&#45;&gt;get_msg_cf</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M357.44,-502.16C378.65,-510.92 404.55,-521.63 428.14,-531.37"/>
<polygon fill="green" stroke="green" points="426.82,-534.61 437.4,-535.2 429.49,-528.14 426.82,-534.61"/>
</g>
<!-- region_state&#45;&gt;set_state_Normal -->
<g id="edge25" class="edge">
<title>region_state&#45;&gt;set_state_Normal</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M723.74,-720.67C838.05,-706.9 1170.95,-674.89 1439,-730 1469.53,-736.28 1501.53,-748.67 1528.54,-761.04"/>
<polygon fill="green" stroke="green" points="1527.33,-764.34 1537.87,-765.41 1530.3,-758 1527.33,-764.34"/>
</g>
<!-- region -->
<g id="node23" class="node">
<title>region</title>
<path fill="none" stroke="#1c2123" d="M916.5,-744C916.5,-744 886.5,-744 886.5,-744 880.5,-744 874.5,-738 874.5,-732 874.5,-732 874.5,-720 874.5,-720 874.5,-714 880.5,-708 886.5,-708 886.5,-708 916.5,-708 916.5,-708 922.5,-708 928.5,-714 928.5,-720 928.5,-720 928.5,-732 928.5,-732 928.5,-738 922.5,-744 916.5,-744"/>
<text text-anchor="middle" x="901.5" y="-722.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">region</text>
</g>
<!-- region_state&#45;&gt;region -->
<g id="edge27" class="edge">
<title>region_state&#45;&gt;region</title>
<path fill="none" stroke="#666666" d="M723.65,-726C764,-726 825.27,-726 864.08,-726"/>
<polygon fill="#666666" stroke="#666666" points="864.39,-729.5 874.39,-726 864.39,-722.5 864.39,-729.5"/>
</g>
<!-- get_msg_cf&#45;&gt;region_state -->
<g id="edge35" class="edge">
<title>get_msg_cf&#45;&gt;region_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M520.72,-604.5C539.72,-636.71 569.24,-678.54 606,-704 613.38,-709.11 621.94,-713.05 630.6,-716.08"/>
<polygon fill="green" stroke="green" points="629.76,-719.48 640.34,-719.13 631.85,-712.8 629.76,-719.48"/>
</g>
<!-- apply_state -->
<g id="node21" class="node">
<title>apply_state</title>
<path fill="none" stroke="#1c2123" d="M618,-467C618,-467 746,-467 746,-467 752,-467 758,-473 758,-479 758,-479 758,-639 758,-639 758,-645 752,-651 746,-651 746,-651 618,-651 618,-651 612,-651 606,-645 606,-639 606,-639 606,-479 606,-479 606,-473 612,-467 618,-467"/>
<text text-anchor="middle" x="682" y="-635.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">apply_state</text>
<polyline fill="none" stroke="#1c2123" points="606,-628 758,-628 "/>
<text text-anchor="middle" x="682" y="-612.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftApplyState</text>
<polyline fill="none" stroke="#1c2123" points="606,-605 758,-605 "/>
<text text-anchor="start" x="614" y="-589.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub applied_index: u64,</text>
<polyline fill="none" stroke="#1c2123" points="606,-582 758,-582 "/>
<text text-anchor="start" x="614" y="-566.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub commit_index: u64,</text>
<polyline fill="none" stroke="#1c2123" points="606,-559 758,-559 "/>
<text text-anchor="start" x="614" y="-543.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub commit_term: u64,</text>
<polyline fill="none" stroke="#1c2123" points="606,-536 758,-536 "/>
<text text-anchor="middle" x="682" y="-520.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftTruncatedState</text>
<polyline fill="none" stroke="#1c2123" points="606,-513 758,-513 "/>
<text text-anchor="start" x="614" y="-497.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub index: u64,</text>
<polyline fill="none" stroke="#1c2123" points="606,-490 758,-490 "/>
<text text-anchor="start" x="614" y="-474.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub term: u64,</text>
</g>
<!-- get_msg_cf&#45;&gt;apply_state -->
<g id="edge37" class="edge">
<title>get_msg_cf&#45;&gt;apply_state</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M554.71,-559C567.77,-559 581.91,-559 595.84,-559"/>
<polygon fill="green" stroke="green" points="595.92,-562.5 605.92,-559 595.92,-555.5 595.92,-562.5"/>
</g>
<!-- enc_start_key&#45;&gt;cleanup_overlap_ranges -->
<g id="edge30" class="edge">
<title>enc_start_key&#45;&gt;cleanup_overlap_ranges</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M358.83,-244.51C375.55,-240.27 395.04,-235.33 413.97,-230.54"/>
<polygon fill="green" stroke="green" points="414.96,-233.9 423.79,-228.05 413.24,-227.11 414.96,-233.9"/>
</g>
<!-- enc_start_key&#45;&gt;delete_all_in_range -->
<g id="edge31" class="edge">
<title>enc_start_key&#45;&gt;delete_all_in_range</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M358.56,-253.18C421.35,-249.25 535.79,-242.09 610.08,-237.44"/>
<polygon fill="green" stroke="green" points="610.53,-240.92 620.29,-236.8 610.09,-233.93 610.53,-240.92"/>
</g>
<!-- enc_end_key&#45;&gt;cleanup_overlap_ranges -->
<g id="edge32" class="edge">
<title>enc_end_key&#45;&gt;cleanup_overlap_ranges</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M356.51,-174.9C373.73,-179.27 394.15,-184.44 413.95,-189.46"/>
<polygon fill="green" stroke="green" points="413.36,-192.92 423.92,-191.98 415.08,-186.14 413.36,-192.92"/>
</g>
<!-- enc_end_key&#45;&gt;delete_all_in_range -->
<g id="edge33" class="edge">
<title>enc_end_key&#45;&gt;delete_all_in_range</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M356.89,-162.66C408.5,-162.1 496.86,-164.43 570,-183 593.98,-189.09 619.24,-200.06 639.6,-210.18"/>
<polygon fill="green" stroke="green" points="638.08,-213.34 648.58,-214.75 641.26,-207.1 638.08,-213.34"/>
</g>
<!-- cleanup_overlap_ranges&#45;&gt;delete_all_in_range -->
<g id="edge38" class="edge">
<title>cleanup_overlap_ranges&#45;&gt;delete_all_in_range</title>
<path fill="none" stroke="#666666" d="M570.25,-219.16C583.51,-220.81 597.31,-222.54 610.48,-224.19"/>
<polygon fill="#666666" stroke="#666666" points="610.06,-227.66 620.42,-225.43 610.93,-220.71 610.06,-227.66"/>
</g>
<!-- apply_state_key&#45;&gt;get_msg_cf -->
<g id="edge36" class="edge">
<title>apply_state_key&#45;&gt;get_msg_cf</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M364.54,-571.22C384,-569.4 406.5,-567.29 427.28,-565.34"/>
<polygon fill="green" stroke="green" points="427.69,-568.82 437.32,-564.4 427.03,-561.85 427.69,-568.82"/>
</g>
<!-- ApplyOptions&#45;&gt;apply -->
<g id="edge29" class="edge">
<title>ApplyOptions&#45;&gt;apply</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1203.69,-766.15C1230.16,-767.39 1264.16,-768.98 1294.6,-770.41"/>
<polygon fill="green" stroke="green" points="1294.61,-773.92 1304.76,-770.89 1294.94,-766.93 1294.61,-773.92"/>
</g>
<!-- set_state_Normal&#45;&gt;put_msg_cf -->
<g id="edge26" class="edge">
<title>set_state_Normal&#45;&gt;put_msg_cf</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1717.23,-810.2C1725.78,-811.21 1734.35,-812.22 1742.77,-813.22"/>
<polygon fill="green" stroke="green" points="1742.61,-816.72 1752.95,-814.42 1743.43,-809.77 1742.61,-816.72"/>
</g>
<!-- snapshot_raft_state_key&#45;&gt;delete_cf -->
<g id="edge23" class="edge">
<title>snapshot_raft_state_key&#45;&gt;delete_cf</title>
<path fill="none" stroke="#666666" d="M379.03,-36.05C403.68,-42.84 431.03,-50.38 452.98,-56.42"/>
<polygon fill="#666666" stroke="#666666" points="452.09,-59.81 462.66,-59.09 453.94,-53.06 452.09,-59.81"/>
</g>
<!-- snap_key -->
<g id="node22" class="node">
<title>snap_key</title>
<path fill="none" stroke="#1c2123" d="M806,-495.5C806,-495.5 997,-495.5 997,-495.5 1003,-495.5 1009,-501.5 1009,-507.5 1009,-507.5 1009,-552.5 1009,-552.5 1009,-558.5 1003,-564.5 997,-564.5 997,-564.5 806,-564.5 806,-564.5 800,-564.5 794,-558.5 794,-552.5 794,-552.5 794,-507.5 794,-507.5 794,-501.5 800,-495.5 806,-495.5"/>
<text text-anchor="middle" x="901.5" y="-549.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">snap_key</text>
<polyline fill="none" stroke="#1c2123" points="794,-541.5 1009,-541.5 "/>
<text text-anchor="start" x="802" y="-526.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapKey::new(region_id, term, idx)</text>
<polyline fill="none" stroke="#1c2123" points="794,-518.5 1009,-518.5 "/>
<text text-anchor="start" x="802" y="-503.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">term, idx来自apply_state</text>
</g>
<!-- apply_state&#45;&gt;snap_key -->
<g id="edge21" class="edge">
<title>apply_state&#45;&gt;snap_key</title>
<path fill="none" stroke="#666666" d="M758.16,-548.98C766.45,-547.87 775.04,-546.73 783.69,-545.57"/>
<polygon fill="#666666" stroke="#666666" points="784.42,-549.01 793.87,-544.22 783.49,-542.07 784.42,-549.01"/>
</g>
<!-- snap_key&#45;&gt;get_snapshot_for_applying_to_engine -->
<g id="edge22" class="edge">
<title>snap_key&#45;&gt;get_snapshot_for_applying_to_engine</title>
<path fill="none" stroke="#666666" d="M999.49,-495.41C1002.71,-493.96 1005.89,-492.49 1009,-491 1048.97,-471.8 1092.08,-444.9 1121.21,-425.71"/>
<polygon fill="#666666" stroke="#666666" points="1123.38,-428.46 1129.78,-420.01 1119.51,-422.63 1123.38,-428.46"/>
</g>
<!-- region&#45;&gt;ApplyOptions -->
<g id="edge28" class="edge">
<title>region&#45;&gt;ApplyOptions</title>
<path fill="none" stroke="#666666" d="M928.67,-729.92C968.96,-735.96 1047.08,-747.67 1100.39,-755.66"/>
<polygon fill="#666666" stroke="#666666" points="1099.96,-759.14 1110.37,-757.16 1101,-752.22 1099.96,-759.14"/>
</g>
</g>
</svg>
